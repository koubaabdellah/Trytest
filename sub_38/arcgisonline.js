// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.41/esri/copyright.txt for details.
// See https://www.arcgis.com/home/copyright.txt for further details.
//>>built
/*
 *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
**************************************************************************** Calcite Web - Calcite Design Components in CSS, JS and HTML
 @version v1.2.5
 @license Apache-2.0
 @copyright 2018 Esri
 @link https://github.com/Esri/calcite-web
*/
require({cache:{"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(a,w){return a("dijit.form.VerticalRule",w,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare","./HorizontalRuleLabels"],function(a,w){return a("dijit.form.VerticalRuleLabels",
w,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(e){return 100-e},_isHorizontal:!1})})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da,R){var M=a([A,F],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:R,onLoad:function(){},constructor:function(r,N){r=r||{};this._settings=r.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var r=this._settings.layerInfos;this.featureReductionEnabledLayers=[];e.forEach(r,function(W){W=W.featureLayer;
W.isFeatureReductionEnabled()&&(W.disableFeatureReduction(),this.featureReductionEnabledLayers.push(W))},this);if(e.every(r,function(W){return W.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var N=r.length;e.forEach(r,function(W){W=W.featureLayer;if(W.loaded)N--;else var fa=b.connect(W,"onLoad",this,function(ba){b.disconnect(fa);fa=null;N--;N||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=
!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(r){this._updateCurrentFeature(w.hitch(this,function(){this._clearSelection(!1);r&&r()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();
this._disableMapClickHandler();e.forEach(this._eConnects,b.disconnect);b.disconnect(this._dtConnect);b.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();e.forEach(this.featureReductionEnabledLayers,
function(r){r.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new u(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new n(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=w.mixin({reshapeVisible:!1,cutVisible:!1,
mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=w.mixin({polylineDrawTools:[M.CREATE_TOOL_POLYLINE],polygonDrawTools:[M.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var r=L.defaults;this._settings.geometryService=this._settings.geometryService||r.geometryService;r.geometryService=r.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};e.forEach(this._settings.layerInfos,function(r){if(r.featureLayer&&r.featureLayer.loaded){this._settings.layers.push(r.featureLayer);var N=r.featureLayer.id;r.featureLayer.credential&&
(this._settings.userIds[N]=r.featureLayer.credential.userId);r.userId&&(this._settings.userIds[N]=r.userId);var W=r.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[N]=W.canCreate&&!W.canUpdate?!0:!1;this._isTextSymbolPointLayer(r.featureLayer)&&(r.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(r){var N=this.templatePicker.getSelected();var W=N.template?N.featureLayer.renderer.getSymbol(N.template.prototype):N.symbolInfo.symbol;this._tempGraphic=new f(r,W,null,null);this._tempGraphic.setAttributes(w.mixin({},N.template.prototype.attributes));W=this._settings.map;W.graphics.add(this._tempGraphic);r=this._findCenterPoint(r);this._createAttributeInspector();W.infoWindow.setTitle(N.featureLayer?N.featureLayer.name:da.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,
N.featureLayer);this._showInfoWindow(r,W.getInfoWindowAnchor(r));if(this._settings.createOnlyLayer[N.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=b.connect(W.infoWindow,"onHide",this,"_infoWindowHide");b.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,
"onSelectionChange",w.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(r,N,W){this._tempGraphic.attributes[N]="number"===typeof W&&isNaN(W)?null:W},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);b.disconnect(this._infoWindowHideEvent)},_createFeature:function(r,N){this._editClickPoint=this._findCenterPoint(r);r.rings?this._simplify(r,w.hitch(this,function(W){this._drawingTool!==z.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(W,N)]}],w.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(W,w.hitch(this,function(fa){fa&&fa.length&&this._applyEdits([{layer:this._layer,adds:e.map(fa,w.hitch(this,function(ba){return this._createGraphic(ba,N)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(r,N)]}],w.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(r,N){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(r,N)},_updateCurrentFeature:function(r){var N=
this._isModified();N?this._updateFeature(N,r):r&&r(!1)},_updateFeature:function(r,N,W){var fa=r.geometry,ba=r.getLayer();ba.hasZ&&!ba.enableZDefaults||ba.hasM&&!ba.allowUpdateWithoutMValues||W&&!this._isModified()?(W=new f,W.setAttributes(r.attributes),this._applyEdits([{layer:r.getLayer(),updates:[W]}],N)):fa.rings?this._simplify(fa,w.hitch(this,function(Z){this._applyEdits([{layer:r.getLayer(),updates:[w.mixin(r,{geometry:Z})]}],N)})):this._applyEdits([{layer:r.getLayer(),updates:[r]}],N)},_deleteFeature:function(r,
N){if(this._settings.invalidTemplate&&r===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var W=[];r?W.push({layer:r.getLayer(),deletes:[r]}):(W=e.map(e.filter(this._settings.layers,function(fa){return 0<fa.getSelectedFeatures().length}),function(fa){return{layer:fa,deletes:fa.getSelectedFeatures()}}))&&W.length||!this._currentGraphic||W.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(W,N)}},_stopEditing:function(r,
N,W,fa){g.hide(this.progressBar.domNode);this._settings.createOnlyLayer[r.id]||this._undoRedoAdd();if(!0===r._isSelOnly||1===r.mode||6===r.mode){if(N&&N.length){this.templatePicker.clearSelection();var ba=new l;ba.objectIds=[N[0].objectId];this._settings.createOnlyLayer[r.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([r],ba,w.hitch(this,"_onEditFeature"))}}else(ba=this._selectionHelper.findMapService(this._settings.map,r))&&ba.refresh(),
N&&N.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[r.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):H.findFeatures(N,r,w.hitch(this,"_onEditFeature")));fa&&fa.length&&(this._clearSelection(!0),this._undoRedo&&(ba=this._selectionHelper.findMapService(r,this._settings.map))&&ba.refresh());this._undoRedo&&W&&W.length&&((ba=this._selectionHelper.findMapService(r,this._settings.map))&&ba.refresh(),this.attributeInspector.refresh(),
this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var r=this._edits&&this._edits.length?this._edits[0]:null;if(r){var N=r.adds||[],W=r.updates||[],fa=r.deletes||[],ba=r.preUpdates||[];r={featureLayer:r.layer};"CUT"===this._activeTool?N.length&&W.length&&ba.length&&this.undoManager.add(new T(w.mixin(r,{preUpdatedGraphics:ba,addedGraphics:N,
postUpdatedGraphics:W}))):"UNION"===this._activeTool?fa.length&&W.length&&ba.length&&this.undoManager.add(new V(w.mixin(r,{preUpdatedGraphics:ba,deletedGraphics:fa,postUpdatedGraphics:W}))):N.length?this.undoManager.add(new Q(w.mixin(r,{addedGraphics:N}))):fa.length?this.undoManager.add(new P(w.mixin(r,{deletedGraphics:fa}))):W.length&&(this._rollbackGraphic||ba.length)&&this.undoManager.add(new O(w.mixin(r,{preUpdatedGraphics:ba.length?ba:[this._rollbackGraphic],postUpdatedGraphics:W})));this._rollbackGraphic=
this._edits=null}}},_activateDrawToolbar:function(r){this._layer=r.featureLayer;this._activeType=r.type;this._drawingTool=(this._activeTemplate=r.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,r.featureLayer);b.disconnect(this._dtConnect);var N=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var W=w.mixin({},this._activeTemplate.prototype.attributes);N=N.filter(function(fa){return!1===
fa.nullable&&!0===fa.editable});this._settings.invalidTemplate=N.some(function(fa){fa=W[fa.name];return null===fa||void 0===fa})}this._dtConnect=this._settings.createOnlyLayer[r.featureLayer.id]||this._settings.invalidTemplate?b.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):b.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):
this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(r,N){var W=r.getLayer(),fa=W?W.geometryType:null,ba=this._isTextSymbolPoint(r),Z=n.MOVE;"esriGeometryPoint"!==fa&&!0===this._isNotesFeature(r)?(Z=Z|n.ROTATE|n.SCALE,this._editVertices=!1):"esriGeometryPoint"!==fa&&!0===this._editVertices?(Z=Z|n.ROTATE|n.SCALE,this._editVertices=!1):ba?(Z=Z|n.ROTATE|n.SCALE|n.EDIT_TEXT,this._editVertices=!1):(Z|=n.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();
this._rollbackGraphic=new f(r.toJson());fa=W.getEditCapabilities({feature:r,userId:this._settings.userIds[W.id]});var ja=e.filter(this._settings.layerInfos,function(ma){return ma.featureLayer.layerId===W.layerId})[0];fa.canUpdate&&!ja.disableGeometryUpdate&&fa.canUpdateGeometry&&(this.editToolbar.activate(Z,r),ba&&(this.editToolbar._textEditor._addTextBox(r),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(r)||
(ba=N&&N.screenPoint||this._findCenterPoint(r),this._showInfoWindow(ba,this._settings.map.getInfoWindowAnchor(ba)))},_createGraphic:function(r,N){var W=new f(r,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,N);this._activeTemplate||N?W.attributes=N||w.mixin({},this._activeTemplate.prototype.attributes):(W.attributes=W.attributes||[],e.forEach(this._layer.fields,function(fa){W.attributes[fa.name]=null},this));return W},_connectEvents:function(){var r=this._settings.layers;e.forEach(r,
function(N){this._connect(N,"onEditsComplete",w.hitch(this,"_stopEditing",N))},this);e.forEach(r,function(N){this._connect(N,"onBeforeApplyEdits",w.hitch(this,function(){g.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",w.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",w.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",w.hitch(this,"_hideAttributeInspector"));
this._connect(this.editToolbar,"onScaleStart",w.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",w.hitch(this,"_hideAttributeInspector"))},_connect:function(r,N,W){this._eConnects.push(b.connect(r,N,W))},_createWidgets:function(){this._selectionHelper=new I(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=
this._settings.templatePicker,g.hide(this.templatePickerDiv);else{var r=e.filter(this._settings.layers,function(N){return N.getEditCapabilities().canCreate});this.templatePicker=new U({"class":"esriTemplatePicker",featureLayers:r,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,"onSelectionChange",
w.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var r=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new B({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},G.create("div")),this.attributeInspector.startup(),r.infoWindow.setContent(this.attributeInspector.domNode),r.infoWindow.setTitle(da.widgets.attributeInspector.NLS_title),
r.infoWindow.resize(350,375),t.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",w.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",w.hitch(this,function(N){this._updateCurrentFeature(w.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(N)}))}));this._usePopup&&r.infoWindow._setPagerCallbacks(this.attributeInspector,w.hitch(this.attributeInspector,"previous"),w.hitch(this.attributeInspector,
"next"));this._connect(this.attributeInspector,"onAttributeChange",w.hitch(this,function(N,W,fa){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(N,W,fa);else{var ba=N.getLayer();(ba=e.filter(ba.fields,function(Z){return Z.name===W})[0])&&""===fa&&(fa=null);this._rollbackGraphic=new f(w.clone(N.toJson()));this.attributeInspector._rollbackInfo={field:ba,graphic:this._rollbackGraphic};this._currentGraphic.attributes[W]="number"===typeof fa&&
isNaN(fa)?null:fa;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new X({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:w.hitch(this,"_deleteFeature"),onApplyEdits:w.hitch(this,"_applyEdits"),onShowAttributeInspector:w.hitch(this,"_onEditFeature")},
this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new c({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",w.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",w.hitch(this,this._updateUndoRedoOperations)),
this._connect(document,"onkeypress",w.hitch(this,function(r){if(r.metaKey||r.ctrlKey)"z"===r.charOrCode&&this._undo(),"y"===r.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(r){if(r&&r.addedIds){var N;for(N=0;N<this.undoManager.length;N++){var W=this.undoManager.get(N);W&&r.layer===W._featureLayer&&W.updateObjectIds(r.oldIds,r.addedIds)}}r&&"Update Features"===r.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=b.connect(this._settings.map,
"onClick",w.hitch(this,function(r){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(w.hitch(this,function(){this._reset();this._updateSelection(r)})))}))},_disableMapClickHandler:function(){b.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var r=this.templatePicker.getSelected();r?this._updateCurrentFeature(w.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(r)})):
(this._reset(),b.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(r){if("point"===r.geometry.type||"multipoint"===r.geometry.type){var N=r.getLayer(),W=N.renderer;r=r.symbol||N._getSymbol(r);!r&&(W.hasVisualVariables("sizeInfo",!1)||W.hasVisualVariables("colorInfo",!1)||W.hasVisualVariables("opacityInfo",!1))&&W.addBreak&&W.infos&&1===W.infos.length&&(r=W.infos[0].symbol||W.defaultSymbol);
if(r&&"textsymbol"===r.type)return!0}return!1},_isTextSymbolPointLayer:function(r){return"esriGeometryPoint"===r.geometryType&&r.renderer&&r.renderer._symbols&&r.renderer._symbols[0]&&r.renderer._symbols[0].symbol&&"textsymbol"===r.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(r){r=r.getLayer();if(!r)return!1;var N,W=!1;for(N=0;N<this._settings.layerInfos.length;N++){var fa=this._settings.layerInfos[N];if(fa.featureLayer==r){W=fa.disableAttributeUpdate;break}}return W},
_onEditFeature:function(r,N){if(r=(w.isArray(r)?r[0]:r)||null){this._layer=r.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(r)){N=N||this._editClickPoint||this._findCenterPoint(r);if(1<this._currentFeatureCount){var W=this._popupFeatures.indexOf(r);W=D.substitute(da.widgets.popup.NLS_pagingInfo,{index:W+1,total:this._currentFeatureCount})}else W=this._layer?this._layer.name:da.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(W);if(this.drawingToolbar||
!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(N,this._settings.map.getInfoWindowAnchor(N));this._editClickPoint=null}r!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=r,r.getDojoShape()&&r.getDojoShape().moveToFront(),W=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||W&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(r))}},_applyEdits:function(r,N){r=r||[];if(!(0>=r.length)){this._edits=this._oEdits=
r;var W=[];e.forEach(r,function(fa){fa.layer&&W.push(fa.layer.applyEdits(fa.adds,fa.updates,fa.deletes))});0<W.length&&(this._deferredsList=(new y(W)).addCallback(w.hitch(this,function(){g.hide(this.progressBar.domNode);N&&N();var fa=this._settings.map;fa&&fa.infoWindow.reposition&&fa.infoWindow.isShowing&&fa.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},
_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(r,N){h.prototype.isSelfIntersecting(r)?this._settings.geometryService.simplify([r],function(W){var fa=W&&W.length?W[0]:fa;N&&N(fa)}):N&&N(r)},_autoComplete:function(r,N){var W=this._getLayers("esriGeometryPolygon"),fa=new l;fa.geometry=r;fa.returnGeometry=!0;this._selectFeatures(W,fa,w.hitch(this,function(ba){!ba||0>=
ba.length?N&&N([r]):this._settings.geometryService.autoComplete(v.getGeometries(ba),this._toPolylines([fa.geometry]),function(Z){N&&N(Z)})}))},_getLayers:function(r){return e.filter(this._settings.layers,function(N){return N.geometryType===r})},_selectFeatures:function(r,N,W,fa){this._selectionHelper.selectFeatures(r,N,fa||k.SELECTION_NEW,W)},_updateSelection:function(r){var N=r.mapPoint,W=r.graphic,fa=this._settings.layerInfos,ba;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,
N,k.SELECTION_NEW,w.hitch(this,function(Z){var ja=e.some(Z,w.hitch(this,function(aa){return aa==W}));if(W&&!ja)if(ja=W.getLayer(),this._isValidLayer(ja)){var ma=new l;ma.objectIds=[W.attributes[ja.objectIdField]];this._selectionHelper.selectFeatures([ja],ma,k.SELECTION_ADD,w.hitch(this,function(aa){aa&&aa.length&&(aa=aa.concat(Z),ba=H.sortFeaturesById(fa,aa),this._updatePopupButtons(ba),this._onEditFeature(ba,N))}))}else Z&&Z.length?(ba=H.sortFeaturesById(fa,Z),this._updatePopupButtons(ba),this._onEditFeature(ba,
N)):this._clearSelection();else Z&&Z.length?(ba=H.sortFeaturesById(fa,Z),this._updatePopupButtons(ba),this._onEditFeature(ba,N)):this._clearSelection()}));W&&this._isTextSymbolPoint(W)&&this._isValidLayer(W.getLayer())&&this.editToolbar.activate(0|n.MOVE|n.ROTATE|n.SCALE|n.EDIT_TEXT,W)},_updatePopupButtons:function(r){if(this._usePopup&&r){var N=r.length;e.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],w.hitch(this,function(fa){1<N?J.remove(fa,
"hidden"):J.add(fa,"hidden")}));var W=1<N?"block":"none";t.query(".esriAttributeInspector .atiLayerName").style({display:W});this._currentFeatureCount=N;this._popupFeatures=r}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(r){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(r||!1);this._reset()},_findCenterPoint:function(r){r=r.geometry||r;switch(r.type){case "point":var N=r;break;case "polyline":N=r.getPoint(0,Math.ceil(r.paths[0].length/
2));break;case "polygon":N=r.rings.length-1,N=r.getPoint(N,r.rings[N].length-1)}return this._settings.map.toScreen(N)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(r){return e.map(r,function(N){var W=new m(N.spatialReference);e.forEach(N.rings,function(fa){W.addPath(fa)});return W})},_isNotesFeature:function(r){var N=r.getLayer(),W=N?N.types||null:null;if(!W)return!1;var fa=r.attributes[N.typeIdField],
ba;e.some(W,function(Z){return Z.id===fa?(ba=Z.templates,!0):!1});return ba?(r=ba[0]||null)?this._isShapeTool(r.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(r){var N,W=this._settings.layerInfos;for(N=0;N<W.length;N++){var fa=W[N];if(r.id==(fa.featureLayer?fa.featureLayer.id:fa.layerId))return!0}return!1},_isShapeTool:function(r){switch(r){case z.TOOL_ARROW:return u.ARROW;case z.TOOL_LEFT_ARROW:return u.LEFT_ARROW;case z.TOOL_RIGHT_ARROW:return u.RIGHT_ARROW;case z.TOOL_UP_ARROW:return u.UP_ARROW;
case z.TOOL_DOWN_ARROW:return u.DOWN_ARROW;case z.TOOL_CIRCLE:return u.CIRCLE;case z.TOOL_ELLIPSE:return u.ELLIPSE;case z.TOOL_TRIANGLE:return u.TRIANGLE;case z.TOOL_RECTANGLE:return u.RECTANGLE;default:return null}},_toDrawTool:function(r,N){var W=N.geometryType;switch(r){case z.TOOL_POINT:return u.POINT;case z.TOOL_ARROW:return u.ARROW;case z.TOOL_LEFT_ARROW:return u.LEFT_ARROW;case z.TOOL_RIGHT_ARROW:return u.RIGHT_ARROW;case z.TOOL_UP_ARROW:return u.UP_ARROW;case z.TOOL_DOWN_ARROW:return u.DOWN_ARROW;
case z.TOOL_CIRCLE:return u.CIRCLE;case z.TOOL_ELLIPSE:return u.ELLIPSE;case z.TOOL_TRIANGLE:return u.TRIANGLE;case z.TOOL_RECTANGLE:return u.RECTANGLE;case z.TOOL_LINE:return u.POLYLINE;case z.TOOL_POLYGON:return u.POLYGON;case z.TOOL_FREEHAND:return"esriGeometryPolyline"===W?u.FREEHAND_POLYLINE:u.FREEHAND_POLYGON;default:var fa=u.POINT;"esriGeometryPolyline"===W?(fa=u.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===M.CREATE_TOOL_FREEHAND_POLYLINE&&(fa=u.FREEHAND_POLYLINE)):"esriGeometryPolygon"===
W&&(fa=u.POLYGON,this._settings.createOptions.polygonDrawTools[0]===M.CREATE_TOOL_FREEHAND_POLYGON&&(fa=u.FREEHAND_POLYGON));return fa}},_isModified:function(){var r=this.editToolbar.getCurrentState();return(r.isModified||this._attributeChanged)&&r.graphic?r.graphic:null},_showInfoWindow:function(r,N){this._customAttributeInspector||this._settings.map.infoWindow.show(r,N)}});w.mixin(M,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",
CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});w.setObject("dijit.editing.Editor",M,E);return M})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),
function(a,w,e,b,t,p){a=a([p],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(x){x=x||{};x.maxOperations&&(this.maxOperations=x.maxOperations);this._historyStack=[]},add:function(x){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,x);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var x=this.peekUndo();this.position--;x?(x=x.performUndo(),this.onUndo(),this._checkAvailability(),b(x).then(w.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var x=this.peekRedo();this.position++;x?(x=x.performRedo(),this.onRedo(),this._checkAvailability(),b(x).then(w.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(x){return this._historyStack[x]},remove:function(x){0<this._historyStack.length&&(this._historyStack.splice(x,1),0<this.position&&x<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});return t.UndoManager=a})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(a,w,e){a=a(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(b){b=b||{};b.label&&(this.label=b.label)},performUndo:function(){},performRedo:function(){}});return e.OperationBase=a})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k){var z=w(F,{declaredClass:"esri.toolbars.Edit",constructor:function(u,n){this._map=u;this._tool=0;if(this._map.loaded)this._scratchGL=u.graphics;else var B=b.connect(this._map,"onLoad",this,function(){b.disconnect(B);B=null;this._scratchGL=this._map.graphics});var H=x("esri-mobile");this._defaultOptions=e.mixin({vertexSymbol:new f(f.STYLE_CIRCLE,H?20:12,new c(c.STYLE_SOLID,new p([0,0,0,.5]),1),new p([128,128,128])),ghostVertexSymbol:new f(f.STYLE_CIRCLE,
H?18:10,new c(c.STYLE_SOLID,new p([0,0,0,.5]),1),new p([255,255,255,.75])),ghostLineSymbol:new c(c.STYLE_DOT,new p([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:H?24:16,boxLineSymbol:new c(c.STYLE_DASH,new p([64,64,64]),1),boxHandleSymbol:new f(f.STYLE_SQUARE,H?16:9,new c(c.STYLE_SOLID,new p([0,0,0,.5]),1),new p([255,255,255,.75])),textAnchorSymbol:new f(f.STYLE_CIRCLE,10,null,new p([255,0,0]))},n||{})},activate:function(u,n,B){this.deactivate();this._graphic=n;this._options=
e.mixin(e.mixin({},this._defaultOptions),B||{});var H=z.MOVE;B=z.EDIT_VERTICES;var Q=z.SCALE,O=z.ROTATE,P=z.EDIT_TEXT,T=!1,V=!1,X=!1,I=this._map,U=I.spatialReference,E=n.geometry.spatialReference;this._geo=!(!U||!E||U.equals(E)||!U.isWebMercator()||4326!==E.wkid);this._isTextPoint=this._prepareTextSymbolEditing(n,u);(u&H)===H&&(T=this._enableMove(n));H=(u&Q)===Q;O=(u&O)===O;if(H||O)X=this._enableBoxEditing(n,H,O);(u&B)===B&&(V=this._enableVertexEditing(n));(u&P)===P&&this._enableTextEditing(n);if(!(T||
V||X))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=u)this._mapPanEndHandle=b.connect(I,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=b.connect(I,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,n);I.snappingManager&&(T||V)&&I.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var u=this._tool,n=this._graphic;if(u){var B=
!!this._modified;this._clear();b.disconnect(this._mapPanEndHandle);b.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(u,n,{isModified:B});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(u,n){},onDeactivate:function(u,n,B){},
onGraphicMoveStart:function(u){},onGraphicFirstMove:function(u){this._modified=!0},onGraphicMove:function(u,n){},onGraphicMoveStop:function(u,n){},onGraphicClick:function(u,n){},onVertexMoveStart:function(u,n){},onVertexFirstMove:function(u,n){this._modified=!0},onVertexMove:function(u,n,B){},onVertexMoveStop:function(u,n,B){},onVertexAdd:function(u,n){this._modified=!0},onVertexClick:function(u,n){},onVertexMouseOver:function(u,n){},onVertexMouseOut:function(u,n){},onVertexDelete:function(u,n){this._modified=
!0},onTextEditStart:function(u,n){},onTextEditEnd:function(u){},onScaleStart:function(u){},onScaleFirstMove:function(u){this._modified=!0},onScale:function(u,n){},onScaleStop:function(u,n){},onRotateStart:function(u){},onRotateFirstMove:function(u){this._modified=!0},onRotate:function(u,n){},onRotateStop:function(u,n){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(u,n){if("point"===u.geometry.type||"multipoint"===u.geometry.type){var B=u.getLayer(),H=B.renderer;B=u.symbol||B._getSymbol(u);!B&&(H.hasVisualVariables("sizeInfo",!1)||H.hasVisualVariables("colorInfo",!1)||H.hasVisualVariables("opacityInfo",!1))&&H.addBreak&&
H.infos&&1===H.infos.length&&(B=H.infos[0].symbol||H.defaultSymbol);if(B&&"textsymbol"===B.type){if((n&z.SCALE)===z.SCALE||(n&z.ROTATE)===z.ROTATE||(n&z.EDIT_TEXT)===z.EDIT_TEXT){u.setSymbol(new l(B.toJson()));var Q=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(u),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){Q._boxEditor&&Q._boxEditor.refresh()})):
a(["../dijit/SymbolEditor"],function(O){if(!Q._textSymbolEditor){var P=Q._options.textSymbolEditorHolder?y.create("div",null,Q._options.textSymbolEditorHolder):y.create("div",null,Q._map.root);Q._textSymbolEditor=new O({graphic:u},P);O=Q._textSymbolEditor.domNode.parentNode.id;J.set(Q._textSymbolEditor.domNode,{position:"map_root"===O?"absolute":"relative",left:"map_root"===O?Q._map.width/2-100+"px":"5px",top:"20px","z-index":50});Q._textSymbolEditor.startup();Q._textSymbolEditor.createForm(u);Q._textSymbolEditor.show();
Q._textSymbolEditor.on("symbol-change",function(){Q._boxEditor&&Q._boxEditor.refresh()})}})}if((n&z.MOVE)===z.MOVE||(n&z.ROTATE)===z.ROTATE||(n&z.SCALE)===z.SCALE)this._textAnchor=new k(u.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(u){var n=this._map;switch(u.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new v(u,n,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(u){var n=
this._map;switch(u.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=m.create(u,n,this),!0}return!1},_enableBoxEditing:function(u,n,B){var H=this._map,Q=u.geometry.type;return"polyline"===Q||"polygon"===Q||this._isTextPoint?(this._boxEditor=new g(u,H,this,n,B,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(u){return this._isTextPoint?(this._textEditor=new h(u,this._map,this),b.connect(this._textEditor,"onEditStart",e.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var u=this._graphicMover;u&&(u.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var u=this._vertexEditor;u&&(u.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var u=this._boxEditor;u&&(u.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(u,n,B){B&&this._refreshMoveables()},_refreshMoveables:function(u){var n=t.filter([this._graphicMover,this._vertexEditor,this._boxEditor],D.isDefined);t.forEach(n,function(B){B.refresh(u)})},_beginOperation:function(u){t.forEach(this._getAffectedTools(u),function(n){n.suspend()})},_endOperation:function(u){t.forEach(this._getAffectedTools(u),function(n){n.resume()})},_getAffectedTools:function(u){var n=[];switch(u){case "MOVE":n=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":n=[this._boxEditor];break;case "BOX":n=[this._vertexEditor]}return n=t.filter(n,D.isDefined)}});e.mixin(z,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});e.setObject("toolbars.Edit",z,G);return z})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h){a=a(null,{declaredClass:"esri.toolbars._Box",constructor:function(f,c,l,k,z,u,n){this._graphic=f;this._map=c;this._toolbar=l;this._scale=k;this._rotate=z;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=u;f=l._options;this._markerSymbol=f.boxHandleSymbol;this._lineSymbol=f.boxLineSymbol;this._moveStartHandler=w.hitch(this,this._moveStartHandler);this._firstMoveHandler=w.hitch(this,this._firstMoveHandler);
this._moveStopHandler=w.hitch(this,this._moveStopHandler);this._moveHandler=w.hitch(this,this._moveHandler);this._isTextPoint=n;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){e.forEach(this._getAllGraphics(),function(f){f.hide()})},resume:function(){e.forEach(this._getAllGraphics(),function(f){f.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
e.forEach(this._connects,b.disconnect);var f=this._toolbar._scratchGL;this._anchors&&e.forEach(this._anchors,function(c){f.remove(c.graphic);(c=c.moveable)&&c.destroy()});this._box&&f.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var f=this._map,c=this._toolbar._scratchGL,l=this._getBoxCoords(),k=new F(f.spatialReference),z=w.clone(e.filter(l,function(u,n){return 8!==n&&0===n%2}));z[0]&&z.push([z[0][0],z[0][1]]);k.addPath(z);this._rotate&&
k.addPath([l[1],l[8]]);this._box?this._box.setGeometry(k):(this._box=new h(k,this._lineSymbol),c.add(this._box));this._anchors?e.forEach(this._anchors,function(u,n){this._scale||(n=8);var B=new A(l[n],f.spatialReference);u.graphic.setGeometry(B);B=u.moveable;var H=u.graphic.getDojoShape();H&&(B?H!==B.shape&&(B.destroy(),u.moveable=this._getMoveable(u.graphic,n)):u.moveable=this._getMoveable(u.graphic,n))},this):(this._anchors=[],this._connects=[],e.forEach(l,function(u,n){if(this._scale||!(8>n)){u=
new A(u,f.spatialReference);var B=new h(u,this._markerSymbol);this._isTextPoint&&1===n%2&&B.hide();c.add(B);this._anchors.push({graphic:B,moveable:this._getMoveable(B,n)})}},this))}else this._cleanUp()},_getBoxCoords:function(f){var c=this._map,l=[],k,z,u;if(this._isTextPoint){var n=this._graphic.getNode().getBoundingClientRect();var B=c.__container.getBoundingClientRect();n=[{x:n.left-B.left,y:n.top-B.top},{x:n.right-B.left,y:n.top-B.top},{x:n.right-B.left,y:n.bottom-B.top},{x:n.left-B.left,y:n.bottom-
B.top}]}else n=this._getTransformedBoundingBox(this._graphic);e.forEach(n,function(H,Q,O){k=H;(z=O[Q+1])||(z=O[0]);u={x:(k.x+z.x)/2,y:(k.y+z.y)/2};f||(k=c.toMap(k),u=c.toMap(u));l.push([k.x,k.y]);l.push([u.x,u.y])});this._rotate&&(n=w.clone(l[1]),n=f?{x:n[0],y:n[1]}:c.toScreen({x:n[0],y:n[1],spatialReference:c.spatialReference}),n.y-=this._toolbar._options.rotateHandleOffset,f||(n=c.toMap(n)),l.push([n.x,n.y]));return l},_getTransformedBoundingBox:function(f){var c=this._map,l=f.geometry.getExtent(),
k=f.geometry.spatialReference;f=new A(l.xmin,l.ymax,k);l=new A(l.xmax,l.ymin,k);f=c.toScreen(f);l=c.toScreen(l);return[{x:f.x,y:f.y},{x:l.x,y:f.y},{x:l.x,y:l.y},{x:f.x,y:l.y}]},_getAllGraphics:function(){var f=[this._box];this._anchors&&e.forEach(this._anchors,function(c){f.push(c.graphic)});return f=e.filter(f,D.isDefined)},_getMoveable:function(f,c){var l=f.getDojoShape();if(l){var k=new y(l);k._index=c;this._connects.push(b.connect(k,"onMoveStart",this._moveStartHandler));this._connects.push(b.connect(k,
"onFirstMove",this._firstMoveHandler));this._connects.push(b.connect(k,"onMoveStop",this._moveStopHandler));k.onMove=this._moveHandler;(l=l.getEventSource())&&x.set(l,"cursor",this._toolbar._cursors["box"+c]);return k}},_moveStartHandler:function(f){this._toolbar["on"+(8===f.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(f){this._toolbar._deactivateScrollWheel();var c=f.host._index,l=this._wrapOffset=f.host.shape._wrapOffsets[0]||0,k=this._graphic.getLayer().getNavigationTransform();
f=e.map(this._getBoxCoords(!0),function(u){return{x:u[0]+l,y:u[1]}});var z=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:f[1].x,y:f[3].y};this._centerCoord=J.multiplyPoint(J.invert(k),z);if(8===c)z=J.multiplyPoint(J.invert(k),f[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,z)),this._startLine=[this._centerCoord,z],this._moveLine=w.clone(this._startLine);else if(z=J.multiplyPoint(J.invert(k),f[c]),k=J.multiplyPoint(J.invert(k),f[(c+4)%8]),this._isTextPoint&&
(this._centerCoord=this._deNormalizePoint(this._centerCoord,z)),this._firstMoverToAnchor=Math.sqrt((z.x-this._centerCoord.x)*(z.x-this._centerCoord.x)+(z.y-this._centerCoord.y)*(z.y-this._centerCoord.y)),this._startBox=k,this._startBox.width=f[4].x-f[0].x,this._startBox.height=f[4].y-f[0].y,this._moveBox=w.clone(this._startBox),this._xfactor=z.x>k.x?1:-1,this._yfactor=z.y>k.y?1:-1,1===c||5===c)this._xfactor=0;else if(3===c||7===c)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+
(8===c?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(f,c){var l=f.host._index,k=this._defaultEventArgs,z;k.angle=0;k.scaleX=1;k.scaleY=1;if(8===l){var u=this._startLine;var n=this._moveLine;var B=n[1];B.x+=c.dx;B.y+=c.dy;B=this._getAngle(u,n);this._isTextPoint&&(B+=this._graphic.symbol.angle);n=J.rotategAt(B,u[0]);this._graphic.getDojoShape().setTransform(n);k.transform=n;k.angle=B;k.around=u[0]}else{u=this._startBox;n=this._moveBox;n.width+=c.dx*this._xfactor;
n.height+=c.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(u=n.x+this._xfactor*n.width,n=n.y+this._yfactor*n.height,u=Math.sqrt((u-this._centerCoord.x)*(u-this._centerCoord.x)+(n-this._centerCoord.y)*(n-this._centerCoord.y)),this._scaleRatio=B=z=u/this._firstMoverToAnchor,u=this._centerCoord):(B=n.width/u.width,z=n.height/u.height,u={x:u.x,y:u.y});if(isNaN(B)||Infinity===B||-Infinity===B)B=1;if(isNaN(z)||Infinity===z||-Infinity===z)z=1;n=J.scaleAt(B,z,u);if(this._isTextPoint){var H=J.rotategAt(this._graphic.symbol.angle,
u);this._graphic.getDojoShape().setTransform([H,n])}else this._graphic.getDojoShape().setTransform(n);k.transform=n;k.scaleX=B;k.scaleY=z;k.around=u}this._toolbar["on"+(8===l?this._rotateEvent:this._scaleEvent)](this._graphic,k)},_moveStopHandler:function(f){this._toolbar._activateScrollWheel();var c=this._graphic,l=this._toolbar,k=l._geo?v.geographicToWebMercator(c.geometry):c.geometry,z=k.spatialReference,u=c.getDojoShape(),n=u.getTransform(),B=c.getLayer().getNavigationTransform();this._isTextPoint?
(c=this._graphic.symbol,8===f.host._index?c.angle+=this._getAngle(this._startLine,this._moveLine):c.font.setSize(Math.round(c.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(c)):(k=k.toJson(),this._updateSegments(k.paths||k.rings,n,B,z),u.setTransform(null),k=m.fromJson(k),c.setGeometry(l._geo?v.webMercatorToGeographic(k,!0):k));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;l._endOperation("BOX");this._defaultEventArgs.transform=
n;l["on"+(8===f.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(f,c,l,k){var z=this._map,u=this._wrapOffset||0;e.forEach(f,function(n){e.forEach(n,function(B){this._updatePoint(B,k,u,J,z,l,c)},this)},this)},_updatePoint:function(f,c,l,k,z,u,n){c=z.toScreen({x:f[0],y:f[1],spatialReference:c},!0);c.x+=l;c=k.multiplyPoint([u,n,k.invert(u)],c);c.x-=l;l=z.toMap(c);f[0]=l.x;f[1]=l.y},_getAngle:function(f,c){return 180*Math.atan2(c[0].y-
c[1].y,c[0].x-c[1].x)/Math.PI-180*Math.atan2(f[0].y-f[1].y,f[0].x-f[1].x)/Math.PI},_deNormalizePoint:function(f,c){var l=this._map._getFrameWidth();if(-1===l)return f;for(var k={x:f.x,y:f.y};Math.abs(k.x-c.x)>=l;)k.x=k.x<c.x?k.x+l:k.x-l;var z=Math.abs(k.x-c.x);Math.abs(k.x-c.x+l)<z?k.x+=l:Math.abs(k.x-c.x-l)<z&&(k.x-=l);return k}});w.setObject("toolbars._Box",a,G);return a})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(a,w,e,b,t,p,x,y,J,G){return w("dojox.gfx.Moveable",null,{constructor:function(D,A){this.shape=D;this.delay=A&&0<A.delay?A.delay:0;this.mover=A&&A.mover?A.mover:J;this.leftButtonOnly=A&&A.leftButtonOnly;this.events=[this.shape.on(p.press,a.hitch(this,"onMouseDown"))]},destroy:function(){e.forEach(this.events,function(D){D.remove()});this.events=this.shape=null},onMouseDown:function(D){this.delay?(this.events.push(this.shape.on(p.move,a.hitch(this,"onMouseMove")),this.shape.on(p.release,a.hitch(this,
"onMouseUp"))),this._lastX=D.clientX,this._lastY=D.clientY):this.leftButtonOnly&&!G.isLeft(D)||new this.mover(this.shape,D,this);b.stop(D)},onMouseMove:function(D){var A=D.clientY;if(Math.abs(D.clientX-this._lastX)>this.delay||Math.abs(A-this._lastY)>this.delay)this.onMouseUp(D),new this.mover(this.shape,D,this);b.stop(D)},onMouseUp:function(D){this.events.pop().remove()},onMoveStart:function(D){t.publish("/gfx/move/start",D);x.add(y.body(),"dojoMove")},onMoveStop:function(D){t.publish("/gfx/move/stop",
D);x.remove(y.body(),"dojoMove")},onFirstMove:function(D){},onMove:function(D,A,F){this.onMoving(D,A,F);this.shape.applyLeftTransform(A);this.onMoved(D,A)},onMoving:function(D,A){},onMoved:function(D,A){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(a,w,e,b,t,p){return e("dojox.gfx.Mover",null,{constructor:function(x,y,J){this.shape=x;this.lastX=y.clientX;this.lastY=y.clientY;x=this.host=J;y=
document;J=b(y,t.move,a.hitch(this,"onFirstMove"));this.events=[b(y,t.move,a.hitch(this,"onMouseMove")),b(y,t.release,a.hitch(this,"destroy")),b(y,"dragstart",a.hitch(p,"stop")),b(y,"selectstart",a.hitch(p,"stop")),J];if(x&&x.onMoveStart)x.onMoveStart(this)},onMouseMove:function(x){var y=x.clientX,J=x.clientY;this.host.onMove(this,{dx:y-this.lastX,dy:J-this.lastY},x);this.lastX=y;this.lastY=J;p.stop(x)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){w.forEach(this.events,
function(y){y.remove()});var x=this.host;if(x&&x.onMoveStop)x.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g){var v=a(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(m,h,f,c){this.graphic=m;this.map=h;this.toolbar=f;this.tempPt=c;this._enableGraphicMover();this._moved=!1},refresh:function(m){var h=this.graphic.getDojoShape();!h||!m&&h._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var m=this.graphic,h=m.getDojoShape();h&&(h._hostGraphic=m,this._moveable=new p(h,{mover:v.Mover}),this._moveStartHandle=
e.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=e.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=e.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=e.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(m=h.getEventSource())&&t.set(m,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var m=this._moveable;if(m){e.disconnect(this._moveStartHandle);e.disconnect(this._firstMoveHandle);
e.disconnect(this._movingHandle);e.disconnect(this._moveStopHandle);var h=m.shape;h&&(h._hostGraphic=null,(h=h.getEventSource())&&t.set(h,"cursor","inherit"));m.destroy()}this._moveable=null},_moveStartHandler:function(){var m=this.graphic,h=this.map;this._startTx=m.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&h.snappingManager&&h.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(m)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(m,h,f){m=m.shape.getTransform();h=this.map;var c;D("esri-pointer")?c=h.navigationManager.pointerEvents._processTouchEvent(f,f):f&&"pointermove"===f.type&&(c=G.prototype._processTouchEvent.call({map:h},f,f));c&&h.snappingManager&&h.snappingManager._onSnappingMouseMoveHandler(c);this.tempPt&&this.tempPt.getDojoShape().setTransform(m);this.toolbar.onGraphicMove(this.graphic,m)},_moveStopHandler:function(m){var h=this.graphic,f=this.toolbar,c=this.map,l=f._geo?A.geographicToWebMercator(h.geometry):
h.geometry,k=l.type,z=h.getDojoShape(),u=z.getTransform();if(b.toJson(u)!==b.toJson(this._startTx)){this._moved=!0;switch(k){case "point":k=[u,y.invert(this._startTx)];if(c.snappingManager)var n=c.snappingManager._snappingPoint;l=n||c.toMap(y.multiplyPoint(k,c.toScreen(l,!0)));c.snappingManager&&c.snappingManager._killOffSnapping();break;case "polyline":l=this._updatePolyGeometry(l,l.paths,u);break;case "polygon":l=this._updatePolyGeometry(l,l.rings,u)}z.setTransform(null);h.setGeometry(f._geo?A.webMercatorToGeographic(l,
!0):l);this.tempPt&&this.tempPt.setGeometry(new g(h.geometry.toJson()))}else this._moved=!1;f._endOperation("MOVE");f.onGraphicMoveStop(h,u);this._moved||(m=m.__e,c=this.map.position,m=new F(m.pageX-c.x,m.pageY-c.y),f.onGraphicClick(h,{screenPoint:m,mapPoint:this.map.toMap(m)}))},_updatePolyGeometry:function(m,h,f){var c=this.map,l=m.getPoint(0,0);c=c.toMap(c.toScreen(l).offset(f.dx,f.dy));f=c.x-l.x;l=c.y-l.y;var k;for(c=0;c<h.length;c++){var z=h[c];for(k=0;k<z.length;k++){var u=m.getPoint(c,k);m.setPoint(c,
k,u.offset(f,l))}}return m}});v.Mover=a(x,{declaredClass:"esri.toolbars._Mover",constructor:function(m,h,f){this.__e=h}});w.setObject("toolbars._GraphicMover",v,J);w.setObject("toolbars._Mover",v.Mover,J);return v})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(a,w,e,b,t,p,x,y,J,G,
D,A){var F=a(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(g,v,m){this.graphic=g;this.map=v;this.toolbar=m;g=m._options;this._symbol1=g.vertexSymbol;this._symbol2=g.ghostVertexSymbol;v=g.ghostLineSymbol;this._lineStroke={style:v.style,width:v.width,color:v.color};this._canDel=g.allowDeleteVertices;this._canAdd=g.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(g){g?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=e.connect(J,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=e.connect(J,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var g=this._getGraphicsLayer();this._mouseOverHandle=e.connect(g,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=e.connect(g,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new p({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),g=this._ctxDelete=new x({label:A.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
e.connect(g,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(g),this._ctxMenu.startup())},_removeControllers:function(){e.disconnect(this._firstMoveHandle);e.disconnect(this._moveStopHandle);e.disconnect(this._mouseOverHandle);e.disconnect(this._mouseOutHandle);e.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(g,v,m){var h,f,c=this.graphic,l=[];for(h=0;h<g.length;h++){var k=g[h],z=[];for(f=0;f<k.length;f++)z.push(new J(k[f],v,c,h,f,k.length,this,m));l.push(z)}return l},_remove:function(g){g&&b.forEach(g,function(v){b.forEach(v,function(m){m.destroy()})})},_refresh:function(g){g&&b.forEach(g,function(v){b.forEach(v,function(m){m.refresh()})})},_isNew:function(g){return-1===b.indexOf(this._vertexMovers[g.segIndex],g)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(g){g=this._selectedMover;this._updateRelatedGraphic(g,g.relatedGraphic,g.graphic.geometry,g.segIndex,g.ptIndex,g.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(g);this._deleteVertex(g);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(g){g=g.graphic;var v=this._findMover(g);v&&(this.toolbar.onVertexMouseOver(this.graphic,v._getInfo()),v._placeholder||(this._selectedMover=v,this._canDel&&this._bindCtxNode(g.getDojoShape().getNode())))},_mouseOutHandler:function(g){if(g=
this._findMover(g.graphic))this.toolbar.onVertexMouseOut(this.graphic,g._getInfo())},_bindCtxNode:function(g){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(g);this._bindNode=g},_unbindCtxNode:function(){var g=this._bindNode;g&&this._ctxMenu.unBindDomNode(g)},_findMover:function(g){var v=[];var m=this._mpVertexMovers;b.forEach(this._vertexMovers,function(f){v=v.concat(f)});m&&b.forEach(m,function(f){v=v.concat(f)});
for(m=0;m<v.length;m++){var h=v[m];if(h.graphic===g)return h}},_firstMoveHandler:function(g){!this._isNew(g)&&this._canAdd&&this._hideRelatedMidpoints(g);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(g,v){var m=this._isNew(g);v&&(v.dx||v.dy)?(this._updateRelatedGraphic(g,g.relatedGraphic,g.graphic.geometry,g.segIndex,g.ptIndex,g.segLength,m),this._canAdd&&(m?this._addMidpoints(g):(this._repositionRelatedMidpoints(g),this._showRelatedMidpoints(g))),this.toolbar._endOperation("VERTICES")):
!m&&this._canAdd&&this._showRelatedMidpoints(g)},_showRelatedMidpoints:function(g){var v=this._getAdjacentMidpoints(g.ptIndex,g.segLength),m=this._mpVertexMovers[g.segIndex];for(g=0;g<v.length;g++){var h=m[v[g]];h.graphic.show();h.refresh()}},_hideRelatedMidpoints:function(g){var v=this._getAdjacentMidpoints(g.ptIndex,g.segLength),m=this._mpVertexMovers[g.segIndex];for(g=0;g<v.length;g++)m[v[g]].graphic.hide()},_repositionRelatedMidpoints:function(g){var v,m=this._getAdjacentMidpoints(g.ptIndex,g.segLength),
h=this._mpVertexMovers[g.segIndex];for(v=0;v<m.length;v++){var f=this._getAdjacentVertices(m[v],g.segLength),c=g.relatedGraphic.geometry.getPoint(g.segIndex,f[0]);f=g.relatedGraphic.geometry.getPoint(g.segIndex,f[1]);c=new G({x:(c.x+f.x)/2,y:(c.y+f.y)/2,spatialReference:c.spatialReference.toJson()});h[m[v]].graphic.setGeometry(c)}},_addMidpoints:function(g){var v=g.segIndex,m=g.ptIndex,h=g.segLength,f=m+1,c,l=h+1;this._mpVertexMovers[v].splice(m,1);var k=this._vertexMovers[v];for(c=0;c<f;c++)k[c].segLength+=
1;for(c=f;c<k.length;c++)k[c].ptIndex+=1,k[c].segLength+=1;g.ptIndex=f;g.segLength=k.length+1;k.splice(f,0,g);g.graphic.setSymbol(this._symbol1);k=this._mpVertexMovers[v];for(c=0;c<m;c++)k[c].segLength+=1;for(c=m;c<h-1;c++)k[c].ptIndex+=1,k[c].segLength+=1;f=this._getAdjacentVertices(m,l);v=this._getAdjacentVertices(m+1,l);h=g.relatedGraphic.geometry.getPoint(g.segIndex,f[0]);c=g.relatedGraphic.geometry.getPoint(g.segIndex,f[1]);f=new G({x:(h.x+c.x)/2,y:(h.y+c.y)/2,spatialReference:h.spatialReference.toJson()});
h=g.relatedGraphic.geometry.getPoint(g.segIndex,v[0]);c=g.relatedGraphic.geometry.getPoint(g.segIndex,v[1]);v=new G({x:(h.x+c.x)/2,y:(h.y+c.y)/2,spatialReference:h.spatialReference.toJson()});h=new J(f,this._symbol2,this.graphic,g.segIndex,m,l,this,!0);g=new J(v,this._symbol2,this.graphic,g.segIndex,m+1,l,this,!0);k.splice(m,0,h,g)},_deleteVertex:function(g){var v,m=g.ptIndex,h=this._vertexMovers[g.segIndex];for(v=0;v<m;v++)--h[v].segLength;for(v=m+1;v<h.length;v++){var f=h[v];--f.ptIndex;--f.segLength}h.splice(m,
1);v=g._getInfo();g.destroy();this.toolbar.onVertexDelete(this.graphic,v)}});w.mixin(F,{create:function(g,v,m){switch(g.geometry.type){case "multipoint":return new F.MultipointVertexEditor(g,v,m);case "polyline":return new F.PolylineVertexEditor(g,v,m);case "polygon":return new F.PolygonVertexEditor(g,v,m)}}});F.MultipointVertexEditor=a(F,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=e.connect(J,"onMoveStart",this,this._moveStartHandler);
e.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);e.disconnect(this._moveStartHandle)},_getSegments:function(g){var v=g.points,m=[],h=g.spatialReference;for(g=0;g<v.length;g++){var f=v[g];m.push(new G({x:f[0],y:f[1],spatialReference:h.toJson()}))}return[m]},_getMidpointSegments:function(g){return[]},_getControlPoints:function(g,v,m,h,f){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(g){var v=g.graphic;if(g=this._findMover(g))this.toolbar.onVertexMouseOver(v,
g._getInfo()),this._selectedMover=g,this._canDel&&this._bindCtxNode(g.graphic.getDojoShape().getNode())},_mouseOutHandler:function(g){var v=g.graphic;if(g=this._findMover(g))this.toolbar.onVertexMouseOut(v,g._getInfo())},_findMover:function(g){var v=[].concat(this._vertexMovers[0]),m=g.target;for(g=0;g<v.length;g++){var h=v[g];if(h.graphic.getDojoShape().getNode()===m)return h}},_moveStartHandler:function(g){var v=g.ptIndex,m=g.segLength-1,h=g.relatedGraphic.geometry.points;g=h.splice(v,1);h.push(g[0]);
h=this._vertexMovers[0];for(g=m;g>v;g--)--h[g].ptIndex;g=h.splice(v,1);h.push(g[0]);g[0].ptIndex=m},_moveStopHandler:function(g){this._updateRelatedGraphic(g,g.relatedGraphic,g.graphic.geometry,g.segIndex,g.ptIndex,g.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(g,v,m,h,f,c,l,k){g=v.geometry;k?g.removePoint(f):g.setPoint(f,m);v.setGeometry(g)},_deleteMidpoints:function(g){}});F.PolylineVertexEditor=a(F,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(g){var v,m,h=g.paths,f=[];for(v=0;v<h.length;v++){var c=h[v],l=[];for(m=0;m<c.length;m++)l.push(g.getPoint(v,m));f.push(l)}return f},_getMidpointSegments:function(g){var v,m,h=g.paths,f=[],c=g.spatialReference;for(v=0;v<h.length;v++){var l=h[v],k=[];for(m=0;m<l.length-1;m++){var z=g.getPoint(v,m),u=g.getPoint(v,m+1);z=new G({x:(z.x+u.x)/2,y:(z.y+u.y)/2,spatialReference:c.toJson()});k.push(z)}f.push(k)}return f},_getControlPoints:function(g,v,m,h,f){var c=this.map,l,k;this._isNew(g)?
(g=h,h+=1,0<=g&&(l=c.toScreen(v.getPoint(m,g))),h<=f&&(k=c.toScreen(v.getPoint(m,h)))):(g=h-1,h+=1,0<=g&&(l=c.toScreen(v.getPoint(m,g))),h<f&&(k=c.toScreen(v.getPoint(m,h))));return[l,k]},_getAdjacentMidpoints:function(g,v){var m=[],h=g-1;0<=h&&m.push(h);g<v-1&&m.push(g);return m},_getAdjacentVertices:function(g,v){return[g,g+1]},_deleteMidpoints:function(g){var v=this._mpVertexMovers[g.segIndex],m=v.length-1,h=this._getAdjacentMidpoints(g.ptIndex,g.segLength).sort(),f,c=h[0];for(f=0;f<c;f++)--v[f].segLength;
for(f=c+1;f<v.length;f++){var l=v[f];--l.ptIndex;--l.segLength}if(1===h.length)v.splice(c,1)[0].destroy();else for(l=this._getAdjacentVertices(c,m),f=g.relatedGraphic.geometry.getPoint(g.segIndex,l[0]),l=g.relatedGraphic.geometry.getPoint(g.segIndex,l[1]),f=new G({x:(f.x+l.x)/2,y:(f.y+l.y)/2,spatialReference:f.spatialReference.toJson()}),g=new J(f,this._symbol2,this.graphic,g.segIndex,c,m,this,!0),v=v.splice(c,h.length,g),f=0;f<v.length;f++)v[f].destroy()},_updateRelatedGraphic:function(g,v,m,h,f,
c,l,k){g=v.geometry;l?g.insertPoint(h,f+1,D.fromJson(m.toJson())):k?g.removePoint(h,f):g.setPoint(h,f,D.fromJson(m.toJson()));v.setGeometry(g)}});F.PolygonVertexEditor=a(F,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(g){var v,m,h=g.rings,f=[];for(v=0;v<h.length;v++){var c=h[v],l=[];for(m=0;m<c.length-1;m++)l.push(g.getPoint(v,m));f.push(l)}return f},_getMidpointSegments:function(g){var v,m,h=g.rings,f=[],c=g.spatialReference;for(v=0;v<h.length;v++){var l=h[v],
k=[];for(m=0;m<l.length-1;m++){var z=g.getPoint(v,m),u=g.getPoint(v,m+1);z=new G({x:(z.x+u.x)/2,y:(z.y+u.y)/2,spatialReference:c.toJson()});k.push(z)}f.push(k)}return f},_getControlPoints:function(g,v,m,h,f){var c=this.map;this._isNew(g)?g=h:(g=h-1,g=0>g?(f+g)%f:g);h=(h+1)%f;f=c.toScreen(v.getPoint(m,g));v=c.toScreen(v.getPoint(m,h));return[f,v]},_getAdjacentMidpoints:function(g,v){var m=g-1;return[0>m?(v+m)%v:m,g]},_getAdjacentVertices:function(g,v){return[g,(g+1)%v]},_deleteMidpoints:function(g){var v=
g.ptIndex,m=this._mpVertexMovers[g.segIndex],h=m.length-1,f=this._getAdjacentMidpoints(v,g.segLength).sort();var c=f[0];var l=f[f.length-1];if(0===v){var k=this._getAdjacentVertices(h-1,h);v=g.relatedGraphic.geometry.getPoint(g.segIndex,k[0]);k=g.relatedGraphic.geometry.getPoint(g.segIndex,k[1]);v=new G({x:(v.x+k.x)/2,y:(v.y+k.y)/2,spatialReference:v.spatialReference.toJson()});g=new J(v,this._symbol2,this.graphic,g.segIndex,h-1,h,this,!0);m.splice(l,1,g)[0].destroy();m.splice(c,1)[0].destroy();for(f=
0;f<m.length-1;f++)c=m[f],--c.ptIndex,--c.segLength}else{k=this._getAdjacentVertices(c,h);v=g.relatedGraphic.geometry.getPoint(g.segIndex,k[0]);k=g.relatedGraphic.geometry.getPoint(g.segIndex,k[1]);v=new G({x:(v.x+k.x)/2,y:(v.y+k.y)/2,spatialReference:v.spatialReference.toJson()});g=new J(v,this._symbol2,this.graphic,g.segIndex,c,h,this,!0);l=m.splice(c,f.length,g);for(f=0;f<l.length;f++)l[f].destroy();for(f=0;f<c;f++)--m[f].segLength;for(f=c+1;f<m.length;f++)c=m[f],--c.ptIndex,--c.segLength}},_updateRelatedGraphic:function(g,
v,m,h,f,c,l,k){g=v.geometry;l?g.insertPoint(h,f+1,D.fromJson(m.toJson())):k?(g.removePoint(h,f),0===f&&g.setPoint(h,c-1,D.fromJson(g.getPoint(h,0).toJson()))):(g.setPoint(h,f,D.fromJson(m.toJson())),0===f&&g.setPoint(h,c,D.fromJson(m.toJson())));v.setGeometry(g)}});w.setObject("toolbars._GraphicVertexEditor",F,y);w.setObject("toolbars._MultipointVertexEditor",F.MultipointVertexEditor,y);w.setObject("toolbars._PolylineVertexEditor",F.PolylineVertexEditor,y);w.setObject("toolbars._PolygonVertexEditor",
F.PolygonVertexEditor,y);return F})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F){a=a(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(g,v,m,h,f,c,l,k){this.point=g;this.symbol=v;this.relatedGraphic=m;this.segIndex=h;this.ptIndex=
f;this.segLength=c;this.editor=l;this.map=l.map;this._scratchGL=l.toolbar._scratchGL;this._placeholder=k||!1;this._type=m.geometry.type;this._init();this._enable()},refresh:function(g){if(g||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var g=new D(this.point.toJson());
g=new A(g,this.symbol);switch(this._type){case "multipoint":g._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(g)}this.graphic=g},_enable:function(){var g=this.graphic.getDojoShape();g&&(g._hasMover=!0,this._moveable=this._getMoveable(g),(g=g.getEventSource())&&t.set(g,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var g=this._moveable;if(g){e.disconnect(this._startHandle);
e.disconnect(this._firstHandle);e.disconnect(this._movingHandle);e.disconnect(this._stopHandle);var v=g.shape;v&&(v=v.getEventSource())&&t.set(v,"cursor","inherit");g.destroy();this._moveable=null}},_needRefresh:function(){var g=this.graphic.getDojoShape(),v=!1;if(g)switch(this._type){case "multipoint":var m=this.relatedGraphic.getDojoShape();m&&(m=m.children[this.ptIndex],g!==m&&(this.graphic._shape=m,v=!0));break;case "polyline":case "polygon":v=!g._hasMover}return v},_getMoveable:function(g){g=
new p(g,b("mac")&&b("ff")&&!G("esri-touch")&&{leftButtonOnly:!0});this._startHandle=e.connect(g,"onMoveStart",this,this._moveStartHandler);this._firstHandle=e.connect(g,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=e.connect(g,"onMoving",this,this._movingHandler);this._stopHandle=e.connect(g,"onMoveStop",this,this._moveStopHandler);return g},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(g){var v=this.map;v.snappingManager&&v.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();g.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(g){var v=g.shape,m=this._getControlEdges(),h=this._scratchGL._div,f,c=[],l=g.host.shape._wrapOffsets[0]||
0;for(f=0;f<m.length;f++){var k=m[f];k.x1+=l;k.x2+=l;c.push([h.createLine({x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2}).setStroke(this.editor._lineStroke),k.x1,k.y1,k.x2,k.y2])}v._lines=c;g.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(g,v,m){v=this.map;var h;G("esri-pointer")?h=v.navigationManager.pointerEvents._processTouchEvent(m,m):m&&"pointermove"===m.type&&(h=J.prototype._processTouchEvent.call({map:v},
m,m));h&&v.snappingManager&&v.snappingManager._onSnappingMouseMoveHandler(h);m=g.shape;g=m.getTransform();m=m._lines;for(h=0;h<m.length;h++)v=m[h],v[0].setShape({x1:v[1]+g.dx,y1:v[2]+g.dy,x2:v[3],y2:v[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),g)},_moveStopHandler:function(g){g=g.shape;var v=this.editor.toolbar,m=g.getTransform(),h=this.map,f=this.graphic,c=v._geo?F.geographicToWebMercator(f.geometry):f.geometry;v._activateScrollWheel();var l,k=g._lines;if(k){for(l=
0;l<k.length;l++)k[l][0].removeShape();g._lines=null}l=!1;k=!0;var z=this._getInfo();m&&(m.dx||m.dy)?this._placeholder&&(this._placeholder=!1,l=!0):k=!1;if(h.snappingManager)var u=h.snappingManager._snappingPoint;var n=[m,x.invert(this._startTx)];u=u||h.toMap(x.multiplyPoint(n,h.toScreen(c,!0)));h.snappingManager&&h.snappingManager._killOffSnapping();g.setTransform(null);f.setGeometry(v._geo?F.webMercatorToGeographic(u,!0):u);this.constructor.onMoveStop(this,m);v.onVertexMoveStop(this.relatedGraphic,
z,m);if(!k)v.onVertexClick(this.relatedGraphic,z);if(l)v.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var g=this.map,v=this.relatedGraphic.geometry,m=this.segIndex,h=this.ptIndex,f=this.segLength,c=this._scratchGL.getNavigationTransform(),l=c.dx;c=c.dy;var k=g.toScreen(this.graphic.geometry);g=k.x-l;k=k.y-c;var z=[];v=this.editor._getControlPoints(this,v,m,h,f);v[0]&&z.push({x1:g,y1:k,x2:v[0].x-l,y2:v[0].y-c});v[1]&&z.push({x1:g,y1:k,x2:v[1].x-l,y2:v[1].y-c});return z}});
w.setObject("toolbars.VertexMover",a,y);w.mixin(a,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return a})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(a,w,e,b,t,p,x,y,J,G){a=a(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(D,A,F){this._graphic=D;this._map=A;this._toolbar=F;this._enable(this._graphic)},
destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(D){this._editBox?(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=e.connect(D.getLayer(),"onDblClick",this,function(A){this._map.navigationManager.setImmediateClick(!1);A.graphic==D&&(b.stop(A),e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(D))}))},_disable:function(){this._applyEdit();
this._addEditBoxHandler&&(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(D,A){if(!this._editBox){if(!D.symbol.text){D.symbol.text="Tempt text";D.setSymbol(D.symbol);var F=""}var g=this._createInputTextStyle(D,this._map);""!==F&&(F=A||D.symbol.text);this._editBox=p.create("input",{type:"text",value:F});y.set(this._editBox,g);x.add(this._editBox,"esriTextEditorInput");
this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=e.connect(this._editBox,"onkeyup",w.hitch(this,function(m){m.keyCode!=J.ENTER&&m.keyCode!==J.TAB||this._disable()}));this._editBoxBlurHandler=e.connect(this._editBox,"onblur",w.hitch(this,function(m){this._disable()}));D.symbol.text="";D.setSymbol(D.symbol);D.hide();var v=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",w.hitch(this,function(){this._disable()})));this._moveBoxHandler=
this._map.on("pan",function(m){y.set(v,{left:this._editBoxLeft+m.delta.x+"px",top:this._editBoxTop+m.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(y.get(v,"left"));this._editBoxTop=parseFloat(y.get(v,"top"))});this.onEditStart(D,this._editBox);this._toolbar.onTextEditStart(D,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(e.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(e.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(D,A){var F=D.getDojoShape().getTransformedBoundingBox(),g=D.getLayer();g=g.hasLocalNavigationTransform()?
{dx:0,dy:0}:g.getNavigationTransform();var v=D.symbol.font;return{"font-family":v.family,"font-size":v.size+"px","font-style":v.style,"font-variant":v.variant,"font-weight":v.weight,left:F[0].x+g.dx+"px",top:F[0].y+g.dy+"px",width:Math.abs(F[0].x-F[1].x)/Math.cos(D.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var D=this._graphic.symbol;D.text=this._editBox.value;this._graphic.setSymbol(D)}else this._graphic.getLayer().remove(this._graphic)}});
w.setObject("toolbars.TextEditor",a,G);return a})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(a,w,e,b,t,p){w=w(p,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(x){x=x||{};x.featureLayer&&(this._featureLayer=x.featureLayer,x.addedGraphics&&(this._addedGraphics=x.addedGraphics))},updateObjectIds:function(x,y){this.updateIds(this._featureLayer,
this._addedGraphics,x,y)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(e.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var x=a.map(this._addedGraphics,function(y){return y.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(e.hitch(this,function(y,J,G){y=a.map(y,function(D){return D.objectId});return{oldIds:x,addedIds:y,layer:this._featureLayer,
operation:this}}))}});e.setObject("dijit.editing.Add",w,t);return w})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(a,w,e,b,t){w=w(t,{declaredClass:"esri.EditOperationBase",updateIds:function(p,x,y,J){a.forEach(x,function(G,D){var A=G[p.objectIdField];a.forEach(y,function(F,g){A===F&&(G[p.objectIdField]=J[g])})})}});return b.EditOperationBase=w})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(a,w,e,b,t,p,x){a=w(x,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(y){var J;y=y||{};if(y.featureLayer&&(this._featureLayer=y.featureLayer,y.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(J=0;J<y.preUpdatedGraphics.length;J++)this._preUpdatedGraphicsGeometries.push(y.preUpdatedGraphics[J].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(y.preUpdatedGraphics[J].attributes);
if(y.postUpdatedGraphics)for(this._postUpdatedGraphics=y.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],J=0;J<y.postUpdatedGraphics.length;J++)y.postUpdatedGraphics[J].geometry?this._postUpdatedGraphicsGeometries.push(y.postUpdatedGraphics[J].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(y.postUpdatedGraphics[J].geometry),this._postUpdatedGraphicsAttributes.push(e.clone(y.postUpdatedGraphics[J].attributes))}},updateObjectIds:function(y,
J){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,y,J);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,y,J)},performUndo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._preUpdatedGraphicsGeometries[y]?this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._preUpdatedGraphicsGeometries[y])):this._postUpdatedGraphics[y].setGeometry(this._preUpdatedGraphicsGeometries[y]),this._postUpdatedGraphics[y].setAttributes(this._preUpdatedGraphicsAttributes[y]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(e.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._postUpdatedGraphicsGeometries[y]?this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._postUpdatedGraphicsGeometries[y])):this._postUpdatedGraphics[y].setGeometry(this._postUpdatedGraphicsGeometries[y]),this._postUpdatedGraphics[y].setAttributes(this._postUpdatedGraphicsAttributes[y]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(e.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});e.setObject("dijit.editing.Update",a,t);return a})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(a,w,e,b,t,p){w=w(p,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(x){x=x||{};
x.featureLayer&&(this._featureLayer=x.featureLayer,x.deletedGraphics&&(this._deletedGraphics=x.deletedGraphics))},updateObjectIds:function(x,y){this.updateIds(this._featureLayer,this._deletedGraphics,x,y)},performUndo:function(){var x=a.map(this._deletedGraphics,function(y){return y.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(e.hitch(this,function(y,J,G){y=a.map(y,function(D){return D.objectId});return{oldIds:x,addedIds:y,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(e.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});e.setObject("dijit.editing.Delete",w,t);return w})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(a,w,e,b,t,p,x){w=w(x,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(y){var J;y=y||{};if(y.featureLayer&&(this._featureLayer=y.featureLayer,y.addedGraphics&&(this._addedGraphics=y.addedGraphics,y.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(J=0;J<y.preUpdatedGraphics.length;J++)this._preUpdatedGraphicsGeometries.push(y.preUpdatedGraphics[J].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(y.preUpdatedGraphics[J].attributes);if(y.postUpdatedGraphics)for(this._postUpdatedGraphics=
y.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],J=0;J<y.postUpdatedGraphics.length;J++)this._postUpdatedGraphicsGeometries.push(y.postUpdatedGraphics[J].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(e.clone(y.postUpdatedGraphics[J].attributes))}},updateObjectIds:function(y,J){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,y,J);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,y,J);this.updateIds(this._featureLayer,
this._addedGraphics,y,J)},performUndo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._preUpdatedGraphicsGeometries[y])),this._postUpdatedGraphics[y].setAttributes(this._preUpdatedGraphicsAttributes[y]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(e.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._postUpdatedGraphicsGeometries[y])),
this._postUpdatedGraphics[y].setAttributes(this._postUpdatedGraphicsAttributes[y]);var J=a.map(this._addedGraphics,function(G){return G.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(e.hitch(this,function(G,D,A){G=a.map(G,function(F){return F.objectId});return{oldIds:J,addedIds:G,layer:this._featureLayer,operation:this}}))}});e.setObject("dijit.editing.Cut",w,t);return w})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(a,w,e,b,t,p,x){w=w(x,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(y){y=y||{};this._featureLayer=y.featureLayer;this._deletedGraphics=y.deletedGraphics;this._preUpdatedGraphics=y.preUpdatedGraphics;this._postUpdatedGraphics=y.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var J;for(J=0;J<y.preUpdatedGraphics.length;J++)this._preUpdatedGraphicsGeometries.push(y.preUpdatedGraphics[J].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(y.preUpdatedGraphics[J].attributes);for(J=0;J<y.postUpdatedGraphics.length;J++)this._postUpdatedGraphicsGeometries.push(y.postUpdatedGraphics[J].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(e.clone(y.postUpdatedGraphics[J].attributes))},updateObjectIds:function(y,J){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,y,J);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,y,J);this.updateIds(this._featureLayer,
this._deletedGraphics,y,J)},performUndo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._preUpdatedGraphicsGeometries[y])),this._postUpdatedGraphics[y].setAttributes(this._preUpdatedGraphicsAttributes[y]);var J=a.map(this._deletedGraphics,function(G){return G.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(e.hitch(this,function(G,
D,A){G=a.map(G,function(F){return F.objectId});return{oldIds:J,addedIds:G,layer:this._featureLayer,operation:this}}))},performRedo:function(){var y;for(y=0;y<this._postUpdatedGraphics.length;y++)this._postUpdatedGraphics[y].setGeometry(p.fromJson(this._postUpdatedGraphicsGeometries[y])),this._postUpdatedGraphics[y].setAttributes(this._postUpdatedGraphicsAttributes[y]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(e.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});e.setObject("dijit.editing.Union",w,t);return w})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h){a=a([y,p],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(f,c){this._settings.editor._activeTool=f;"EDITING"!==f&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==f&&this._settings.editor._hideAttributeInspector();"CLEAR"!==f&&this.inherited(arguments)},_initializeToolbar:function(){e.forEach(this._settings.layers,function(f){this._tbConnects.push(b.connect(f,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(f,c){this._tools.EDITING._activateTool(f,c.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=x.getSelection(this._settings.layers);var f=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=f);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=f);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=f);this._tools.UNION&&this._tools.UNION.set("disabled",2>f)},_toolFinished:function(f){if("ATTRIBUTES"===f&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===f||"CUT"===f||"RESHAPING"===f||"EDITING"===f)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===f)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new v({settings:this._settings,onClick:w.hitch(this,"_activateTool","SELECT",!0),onFinished:w.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new J(w.mixin(m.selectClear,{settings:this._settings,onClick:w.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new J(w.mixin(g.attributes,{settings:this._settings,onClick:w.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new F({settings:this._settings,onClick:w.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:w.hitch(this,"onApplyEdits"),onFinished:w.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new J(w.mixin(g.del,{settings:this._settings,onClick:w.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new G({settings:this._settings,onFinished:w.hitch(this,"_toolFinished","CUT"),onClick:w.hitch(this,"_activateTool","CUT",!0),onApplyEdits:w.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new D({settings:this._settings,onFinished:w.hitch(this,"_toolFinished","UNION"),onApplyEdits:w.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new A({settings:this._settings,onClick:w.hitch(this,"_activateTool","RESHAPING",!0),onFinished:w.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:w.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new J(w.mixin(g.undo,{settings:this._settings,disabled:!0,onClick:w.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new J(w.mixin(g.redo,{settings:this._settings,disabled:!0,onClick:w.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});w.setObject("dijit.editing.toolbars.Drawing",a,h);return a})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(a,w,e,b,t,p,x,y,J){a=a([p],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(G,D){G&&G.settings&&(this._tools=[],this._tbConnects=[],this._initialize(G.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var G,D=this._tools;for(G in D)D.hasOwnProperty(G)&&J.isDefined(this._tools[G])&&this._tools[G].destroy();e.forEach(this._tbConnects,
b.disconnect);this.inherited(arguments)},activate:function(G){this._enabled=!0},deactivate:function(){var G;this._enabled=!1;this._geometryType=this._layer=null;var D=this._tools;for(G in D)D.hasOwnProperty(G)&&(this._tools[G].deactivate(),this._tools[G].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(G){this._activeSymbol=G},_getSymbol:function(){},_createTools:function(){},_initialize:function(G){this._settings=G;this._toolbar=G.drawToolbar;this._editToolbar=
G.editToolbar;this._initializeToolbar()},_activateTool:function(G,D){this._activeTool&&this._activeTool.deactivate();!0===D&&this._activeTool==this._tools[G]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[G],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new x)}});w.setObject("dijit.editing.toolbars.ToolbarBase",a,y);return a})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(a,w,e,b,t,p){a=a([b,t],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)}});w.setObject("dijit.editing.tools.ButtonToolBase",a,p);return a})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(a,w,e,b,t){a=a(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(p,x){p=p||{};w.mixin(this,p);this.label=this._label?t.widgets.editor.tools[this._label]:"";this._settings=p.settings;this._toolbar=p.settings.drawToolbar;this._editToolbar=p.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(p){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=p,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(p){this._enabled=p;this._updateUI()},setChecked:function(p){this._checked=p},enable:function(p){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});w.setObject("dijit.editing.tools.ToolBase",a,b);return a})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g){a=a([F],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:D.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);e.forEach(this._cutConnects,b.disconnect);this._cutConnects=[];this._edits=[]},
_onDrawEnd:function(v){var m=this._cutLayers=e.filter(this._settings.layers,function(f){return"esriGeometryPolygon"===f.geometryType||"esriGeometryPolyline"===f.geometryType&&f.visible&&f._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(e.map(m,w.hitch(this,function(f){return b.connect(f,"onEditsComplete",w.hitch(this,function(c,l,k){if(this._settings.undoRedoManager){var z=this._settings.undoRedoManager;e.forEach(this._edits,w.hitch(this,function(u){z.add(new A({featureLayer:u.layer,
addedGraphics:u.adds,preUpdatedGraphics:u.preUpdates,postUpdatedGraphics:u.updates}))}),this)}this.onFinished()}))})));var h=new J;h.geometry=v;e.forEach(m,function(f,c){this._settings.editor._selectionHelper.selectFeatures([f],h,G.SELECTION_NEW,w.hitch(this,"_cutFeatures",f,h))},this)},_cutFeatures:function(v,m,h){if(h&&h.length){this._edits=[];var f=[];f.push(this._settings.geometryService.cut(x.getGeometries(h),m.geometry,w.hitch(this,"_cutHandler",v,h)));(new p(f)).addCallback(w.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(v,m,h){var f=[],c=[],l=e.map(m,function(u){return new y(w.clone(u.toJson()))}),k,z;e.forEach(h.cutIndexes,function(u,n){k!=u?(k=u,1<e.filter(h.cutIndexes,function(B){return B===u}).length&&c.push(m[u].setGeometry(h.geometries[n]))):(z=new y(h.geometries[n],null,w.mixin({},m[u].attributes),null),z.attributes[m[0].getLayer().objectIdField]=null,f.push(z))},this);this._edits.push({layer:v,adds:f,updates:c,preUpdates:l})}});w.setObject("dijit.editing.tools.Cut",a,g);return a})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(a,w,e,b,t,p){a=a([b,t],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)},setChecked:function(x){b.prototype.setChecked.apply(this,arguments)}});w.setObject("dijit.editing.tools.ToggleToolBase",a,p);return a})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(a,w,e,b,t,p,x,y,J,G){a=a([J],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:x.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(D){this._settings.editor._activeTool="UNION";D=e.filter(this._settings.layers,function(g){return"esriGeometryPolygon"===g.geometryType&&g.visible&&g._isMapAtVisibleScale()});var A=[],F=0;e.forEach(D,function(g,v){var m=g.getSelectedFeatures();2<=
m.length&&(F++,this._settings.geometryService.union(t.getGeometries(m),w.hitch(this,function(h){var f=m.shift(),c=[],l=[];c.push(new p(f.toJson()));l.push(f.setGeometry(h));A.push({layer:g,updates:l,deletes:m,preUpdates:c});F--;if(0>=F)this.onApplyEdits(A,w.hitch(this,function(){if(this._settings.undoRedoManager){var k=this._settings.undoRedoManager;e.forEach(this._edits,w.hitch(this,function(z){k.add(new y({featureLayer:z.layer,deletedGraphics:z.deletes,preUpdatedGraphics:z.preUpdates,postUpdatedGraphics:z.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});w.setObject("dijit.editing.tools.Union",a,G);return a})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(a,w,e,b,t,p,x,y,J,G,D){a=a([G],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:J.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){b.disconnect(this._rConnect);this._rConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);b.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(A){var F=this._settings.layers,g=new y;g.geometry=A;A=this._reshapeLayers=e.filter(F,
function(v){return"esriGeometryPolygon"===v.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(A,g,x.SELECTION_NEW,w.hitch(this,"_reshape",g))},_reshape:function(A,F){if(1===F.length){var g=[],v=[],m=[],h=F[0],f=h.getLayer();this._settings.geometryService.reshape(h.geometry,A.geometry,w.hitch(this,function(c){"polyline"===c.type&&c.paths&&0===c.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===c.type&&c.rings&&
0===c.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(m.push(new p(h.toJson())),v.push(h.setGeometry(c)),g.push({layer:f,updates:v,preUpdates:m}),this.onApplyEdits(g,w.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});w.setObject("dijit.editing.tools.Reshape",a,D);return a})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(a,w,e,b,t,p,x,y,J,G){a=a([y],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(D,A){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=t.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(D,A){var F;this.enable(A);for(F in this._tools)this._tools.hasOwnProperty(F)&&(this.dropDown.removeChild(this._tools[F]),
!0===this._tools[F]._enabled&&this.dropDown.addChild(this._tools[F]));if(this._geometryType!==A||!1===this._activeTool._enabled)this._activeTool=this._tools[D.toUpperCase()];this._geometryType=A;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(D){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var D=this._settings.layers,A=this._settings.editor,F=!1,g=!1,v=!1,m=this._toolTypes=[],h;e.forEach(D,function(f){h=f.geometryType;
F=F||"esriGeometryPoint"===h;g=g||"esriGeometryPolyline"===h;v=v||"esriGeometryPolygon"===h;m=m.concat(e.map(this._getTemplatesFromLayer(f),w.hitch(this,function(c){return A._toDrawTool(c.drawingTool,f)})))},this);D=this._settings.createOptions;F&&this._toolTypes.push("point");g&&(this._toolTypes=this._toolTypes.concat(D.polylineDrawTools));v&&(this._toolTypes=this._toolTypes.concat(D.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(m))},_toUnique:function(D){var A={};return e.filter(D,
function(F){return A[F]?!1:A[F]=!0})},_getTemplatesFromLayer:function(D){var A=D.templates||[];e.forEach(D.types,function(F){A=A.concat(F.templates)});return e.filter(A,G.isDefined)},_createTools:function(){e.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(D){var A=w.mixin(x[D],{settings:this._settings,onClick:w.hitch(this,"onItemClicked",x[D].id)});this._tools[D.toUpperCase()]=new p(A)}});w.setObject("dijit.editing.tools.Editing",a,J);return a})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(a,w,e,b,t){a=a([b],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(p){this._enabled=p===this._geomType;this.inherited(arguments)}});w.setObject("dijit.editing.tools.Edit",a,t);return a})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(a,w,e,b,t,p){a=a([b,t],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){b.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)}});w.setObject("dijit.editing.tools.MenuItemBase",a,p);return a})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(a,w,e,b){w={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:e.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:e.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:e.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:e.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:e.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:e.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:e.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:e.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:e.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:e.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:e.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:e.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:e.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:e.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:e.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};a.setObject("dijit.editing.tools.EditingTools",w,b);return w})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(a,w,e,b,t,p,x,y,J,G){a=a([x,y],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var D,A=this._tools;for(D in A)A.hasOwnProperty(D)&&G.isDefined(A[D])&&A[D].destroy();this.inherited(arguments)},_createTools:function(){var D,A=new p;this.dropDown=A;for(D in this._tools)this._tools.hasOwnProperty(D)&&A.addChild(this._tools[D]);
this._activeTool=A.getChildren()[0];this._updateUI()},activate:function(D){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(D){for(var A in this._tools)this._tools.hasOwnProperty(A)&&this._tools[A].enable(D);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(D){this._checked=D;this._updateUI()},_onDrawEnd:function(D){},
onLayerChange:function(D,A,F){this._activeTool=null;this._activeType=A;this._activeTemplate=F;this._activeLayer=D},onItemClicked:function(D,A){this._activeTool&&this._activeTool.deactivate();this._activeTool=t.byId(D);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(D){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
b.set(this.focusNode,{outline:"none"});b.set(this.titleNode,{padding:"0px",border:"none"});this._checked?b.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):b.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});w.setObject("dijit.editing.tools.DropDownToolBase",a,J);return a})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F){a=a([A],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);b.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(g){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var v=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(v,g,this._selectMethod,w.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new x(x.STYLE_CIRCLE,10,new y(y.STYLE_SOLID,new t([0,0,0]),1),new t([255,0,0,.5]));this._polylineSelectionSymbol=new y(y.STYLE_SOLID,new t([0,200,255]),2);this._polygonSelectionSymbol=new J(J.STYLE_SOLID,new y(y.STYLE_SOLID,
new t([0,0,0]),1),new t([0,200,255,.5]))},_initializeLayers:function(){e.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(g){var v=null;switch(g.geometryType){case "esriGeometryPoint":v=this._pointSelectionSymbol;break;case "esriGeometryPolyline":v=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":v=this._polygonSelectionSymbol}g.setSelectionSymbol(g._selectionSymbol||v)},_createTools:function(){e.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(g){var v=w.mixin(D[g],{settings:this._settings,onClick:w.hitch(this,"onItemClicked",D[g].id)});this._tools[g.toUpperCase()]=new G(v)}});w.setObject("dijit.editing.tools.Selection",a,F);return a})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(a,w,e,b,t){w={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:b.EXTENT,_selectMethod:e.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:b.EXTENT,_selectMethod:e.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:b.EXTENT,_selectMethod:e.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};a.setObject("dijit.editing.tools.SelectionTools",w,t);return w})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A){a=a(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(F){this._settings=F||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var F in this._sConnects)this._sConnects.hasOwnProperty(F)&&e.disconnect(this._sConnects[F])},selectFeatures:function(F,g,v,m){v===G.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(F));var h=[];b.forEach(F,function(f){if(!0===f.visible&&!0===f._isMapAtVisibleScale()){var c=v;f._isSelOnly&&c===G.SELECTION_NEW&&(c=G.SELECTION_ADD);h.push(f.selectFeatures(g,c))}});(new p(h)).addCallback(w.hitch(this,function(f){var c=[];b.forEach(f,function(l,k){b.forEach(l[1],function(z){(z=F[k]._mode._getFeature(z.attributes[F[k].objectIdField])||null)&&c.push(z)},this)},this);this._mapServiceCount?((f=v===G.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(F))):
this._createLayerDefs(this._getLayerInfosFromFeatures(c)),this._updateLayerDefs(this._mapServiceInfos,!1,!(c&&c.length||f),w.hitch(this,m,c))):m(c)}))},selectFeaturesByGeometry:function(F,g,v,m){var h=g;-1!==g.declaredClass.indexOf("Extent")&&g.xmax===g.xmin&&g.ymax===g.ymin&&(h=new y(g.xmax,g.ymax,g.spatialReference));h=-1!==h.declaredClass.indexOf("Point")?this._extentFromPoint(h):h;g=new D;g.geometry=h;this.selectFeatures(F,g,v,m)},clearSelection:function(F){b.forEach(this._nonSelOnlyLayers,function(v){v.clearSelection&&
v.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var g=this._getLayerInfosFromSelection(this._settings.layers);b.some(g,function(v){return v.oids&&v.oids.length})&&(this._createLayerDefs(g),this._updateLayerDefs(this._mapServiceInfos,!0,F||!1))}},findMapService:function(F){var g=this._map,v=g.layerIds;F=F&&F._url&&F._url.path?F._url.path.toLowerCase():"";var m;for(m in v)if(v.hasOwnProperty(m)){var h=g.getLayer(v[m]);var f=h._url?h._url.path?h._url.path.toLowerCase().replace("mapserver",
"featureserver"):h._url.toLowerCase().replace("mapserver","featureserver"):"";if(F.substr(0,f.length)===f&&"esri.layers.ArcGISDynamicMapServiceLayer"===h.declaredClass)return h}},getSelection:function(F){var g=[];b.forEach(F,function(v){v._isSelOnly&&g.push(this._createLayerInfo(v))},this);b.forEach(g,function(v){var m=this._createMapServiceInfo(this.findMapService(v.layer));m&&(m.layerInfos[v.layer.layerId]=v)},this)},_initMapServiceInfos:function(F){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];b.forEach(F,function(g){var v=this.findMapService(g);v?(this._mapServiceCount++,this._createMapServiceInfo(v),v&&v.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(g)},this)},_createMapServiceInfo:function(F){if(!F)return null;var g=this._mapServiceInfos,v=g[F.id];v||(v=g[F.id]={mapService:F,layerInfos:[],layerDefs:w.mixin([],F.layerDefinitions||[]),origLayerDefs:w.mixin([],F.layerDefinitions||[])});return v},_resetMapServiceInfo:function(F){b.forEach(F.layerInfos,this._resetLayerInfo);
F.layerDefs=w.mixin([],F.origLayerDefs||[])},_resetMapServiceInfos:function(){var F=this._mapServiceInfos,g;for(g in F)F.hasOwnProperty(g)&&this._resetMapServiceInfo(F[g])},_createLayerInfo:function(F,g){var v=F.objectIdField,m=g?[]:F.getSelectedFeatures();return{layer:F,selectedFeatures:m||[],oids:b.map(m,function(h){return h.attributes[v]})}},_resetLayerInfo:function(F){F&&(F.selectedFeatures=[],F.oids=[])},_updateLayerDefs:function(F,g,v,m){for(var h in F)if(F.hasOwnProperty(h)){var f=F[h],c=f.mapService,
l=f.layerDefs=g?w.mixin([],f.origLayerDefs||[]):f.layerDefs;l?(v?m&&m():this._sConnects[c.id]=e.connect(c,"onUpdateEnd",w.hitch(this,"_onMapServiceUpdate",f,g,m)),c.setLayerDefinitions(l,v||!1)):m&&m()}},_onMapServiceUpdate:function(F,g,v){e.disconnect(this._sConnects[F.mapService.id]);b.forEach(F.layerInfos,function(m){if(g)m&&m.layer.clearSelection();else{var h=new D;h.objectIds=m?m.oids:[];h.objectIds.length&&m.layer.selectFeatures(h,G.SELECTION_SUBTRACT)}},this);g&&this._resetMapServiceInfo(F);
v&&v()},_createLayerDefs:function(F){b.forEach(F,function(g){var v=g.layer,m=this._createMapServiceInfo(this.findMapService(g.layer));if(m){m=m.layerDefs;var h=v.layerId,f='("'+v.objectIdField+'" NOT IN (',c=g.oids;c&&c.length&&(b.forEach(g.oids,function(l,k){c=!0;k&&(f+=",");f+="'"+l+"'"}),f+="))",m[h]=m.length&&m[h]&&m[h].length?m[h]+(" AND"+f):f)}},this)},_getLayerInfosFromFeatures:function(F){var g=[];b.forEach(F,function(m){var h=m.getLayer();h&&h._isSelOnly&&(g[h.id]||(g[h.id]=this._createLayerInfo(h,
!0)),g[h.id].selectedFeatures.push(m),g[h.id].oids.push(m.attributes[h.objectIdField]))},this);F=[];for(var v in g)g.hasOwnProperty(v)&&F.push(g[v]);return F},_getLayerInfosFromSelection:function(F){var g=[];b.forEach(F,function(v){v._isSelOnly&&g.push(this._createLayerInfo(v,!1))},this);return g},_extentFromPoint:function(F){var g=this._tolerance,v=this._map,m=v.toScreen(F);F=new J(m.x-g,m.y+g);g=new J(m.x+g,m.y-g);F=v.toMap(F);g=v.toMap(g);return new x(F.x,F.y,g.x,g.y,v.spatialReference)}});w.setObject("dijit.editing.SelectionHelper",
a,A);return a})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c){var l=a([f,A,F,g,h],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,
templateString:c,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(k){this.inherited(arguments);G.place(this.domNode,k.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[l.ANCHOR_UPPERRIGHT,l.ANCHOR_LOWERRIGHT,l.ANCHOR_LOWERLEFT,l.ANCHOR_UPPERLEFT];if(7>p("ie")){var k="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
D.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",z=G.create("div",null,b.body());D.set(z,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:k});var u=setTimeout(function(){G.destroy(z);clearTimeout(u);u=z=null},100);t.query(".sprite",this.domNode).forEach(function(n){n.style.backgroundImage="none";n.style.filter=k})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(k,z){if(k&&z){var u=D.set;u(this._topleft,{height:z+"px",marginLeft:k+"px"});u(this._topright,{width:k+"px",height:z+"px"});u(this._user,"width",k-8+"px");u(this._hide,"marginLeft",k-22+"px");u(this._title,"width",k-25+"px");u(this._content,"height",z-37+"px");u(this._bottomleft,{marginLeft:k+"px",marginTop:z+"px"});u(this._bottomright,{width:k-
5+"px",marginTop:z+"px"});this.width=k;this.height=z;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(k,z)}},_adjustPosition:function(k,z){var u=D.set;u(this._infowindow,{left:Math.round(k.x)+"px",top:Math.round(k.y)+"px"});z===l.ANCHOR_UPPERLEFT?u(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):z===l.ANCHOR_UPPERRIGHT?u(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):z===l.ANCHOR_LOWERRIGHT?u(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):z===l.ANCHOR_LOWERLEFT&&u(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(k){var z=this.map;return z&&k?(k.y<z.height/2?"lower":"upper")+(k.x<z.width/2?"right":"left"):"upperright"},show:function(k,z,u){if(k){k.spatialReference?(this.mapCoords=k,k=this.coords=this.map.toScreen(k,!0)):(this.mapCoords=null,this.coords=k);var n=this.map._getFrameWidth();if(-1!==n&&(k.x%=n,0>k.x&&(k.x+=n),this.map.width>n))for(var B=(this.map.width-
n)/2;k.x<B;)k.x+=n;z&&-1!==e.indexOf(this._ANCHORS,z)||(z=this._getAnchor(k));J.remove(this._pointer,this.anchor);z=this.anchor=this.fixedAnchor||z;this._adjustPosition(k,z);J.add(this._pointer,z);m.show(this.domNode);this.isShowing=!0;if(!u)this.onShow()}},hide:function(k,z){m.hide(this.domNode);this.isShowing=!1;if(!z)this.onHide()},showTitleBar:function(){m.show(this._titlebar);m.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){m.hide(this._titlebar);m.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){m.show(this._content);m.show(this._border);this.isContentShowing=!0},hideContent:function(){m.hide(this._content);m.hide(this._border);this.isContentShowing=!1},move:function(k,z){z?k=this.coords.offset(k.x,k.y):(this.coords=k,this.mapCoords&&(this.mapCoords=this.map.toMap(k)));D.set(this._infowindow,{left:Math.round(k.x)+"px",top:Math.round(k.y)+"px"})},setFixedAnchor:function(k){k&&-1===e.indexOf(this._ANCHORS,k)||(this.fixedAnchor=k,this.isShowing&&this.show(this.mapCoords||
this.coords,k),this.onAnchorChange(k))},setTitle:function(k){this.destroyDijits(this._title);this.__setValue("_title",k);return this},setContent:function(k){this.destroyDijits(this._content);this.__setValue("_content",k);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});w.mixin(l,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});w.setObject("dijit.InfoWindow",l,v);return l})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q){a=a([J,G],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:H,constructor:function(O,P){w.mixin(this,Q.widgets.overviewMap);O=O||{};if(O.map){var T={};P&&(this._detached=!0,T=b.coords(P,!0));this.map=O.map;this.baseLayer=O.baseLayer;this.width=O.width||T.w||this.map.width/4;this.height=O.height||T.h||this.map.height/4;this.attachTo=O.attachTo||"top-right";this.expandFactor=O.expandFactor||2;this.color=O.color||
"#000000";this.opacity=O.opacity||.5;this.maximizeButton=!!O.maximizeButton;this.visible=!!O.visible;if(this.map.loaded)this._initialSetup();else var V=e.connect(this.map,"onLoad",this,function(){e.disconnect(V);V=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>t("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(x.set(this._body,
"display","block"),x.set(this._controllerDiv,"display","none"),x.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():e.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||p.add(this._maximizerDiv,"ovwDisabledButton"),p.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),p.add(this._controllerDiv,
"ovwShow"),p.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));x.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(O){!O||0>=O.w||0>=O.h||this._resize(O.w,O.h)},show:function(){if(!this.visible){var O=this._controllerDiv;O.title=this.NLS_hide;p.remove(O,"ovwShow");p.add(O,"ovwHide");B.show(this._body);
B.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var O=this._controllerDiv;O.title=this.NLS_show;p.remove(O,"ovwHide");p.add(O,"ovwShow");this._maximized&&this._maximizeHandler();B.hide(this._body);B.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var O=this.baseLayer||this._mainMapLayer,P=this.map.spatialReference,T=O.spatialReference;if(T.wkid===P.wkid||
T.wkt===P.wkt){P=O.declaredClass;if(O instanceof g)if(-1!==P.indexOf("VETiledLayer"))this.baseLayer=new z({resourceInfo:O.getResourceInfo(),culture:O.culture,mapStyle:O.mapStyle,bingMapsKey:O.bingMapsKey});else if(-1!==P.indexOf("OpenStreetMapLayer"))this.baseLayer=new k({tileServers:O.tileServers});else if(-1!==P.indexOf("WebTiledLayer")){P=O.initialExtent;T=O.fullExtent;var V=O.tileInfo;this.baseLayer=new O.constructor(O.urlTemplate,{initialExtent:P&&new P.constructor(P.toJson()),fullExtent:T&&
new T.constructor(T.toJson()),tileInfo:V&&new V.constructor(V.toJson()),tileServers:O.tileServers&&O.tileServers.slice(0)})}else this.baseLayer=new h(O.url,{resourceInfo:O.getResourceInfo()});else if(O instanceof v)-1!==P.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new c(O.url):(this.baseLayer=new f(O.url),this.baseLayer.setImageFormat("png24"));else if(O instanceof l)this.baseLayer=new l(O.url);else if(O instanceof m)this.baseLayer=new h("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",
{});else return;!this._detached&&this.visible&&this._controllerDiv&&(O=function(){this.visible=!1;this.show()},this.baseLayer.loaded?O.call(this):e.connect(this.baseLayer,"onLoad",this,O))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var O=this._maximizerDiv;this._maximized?(O.title=this.NLS_maximize,p.remove(O,"ovwRestore"),p.add(O,"ovwMaximize"),this._resize(this.width,this.height)):(O.title=this.NLS_restore,p.remove(O,"ovwMaximize"),p.add(O,
"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(O,P){x.set(this._body,{width:O+"px",height:P+"px"});var T=n.defaults.map.panDuration,V=this.overviewMap;n.defaults.map.panDuration=0;V&&(V.resize(!0),V.centerAt(this._focusExtent.getCenter()));n.defaults.map.panDuration=T},_initialize:function(){if(this.overviewMap)this._activate();else{var O;var P=9>t("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=O=new D(P,{slider:!1,
showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});e.connect(O,"onLoad",this,function(){this._map_resize_override=w.hitch(O,this._map_resize_override);O.disableMapNavigation();this._activate()});O.addLayer(this.baseLayer)}},_activate:function(){var O=this.map,P=this.overviewMap;this._moveableHandle=new y(this._focusDiv);this._soeConnect=e.connect(O,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=e.connect(O,"onPan",this,this._updateFocus);this._oecConnect=
e.connect(P,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=e.connect(P,"onPan",this,this._ovwPanHandler);this._ozsConnect=e.connect(P,"onZoomStart",this,function(){B.hide(this._focusDiv)});this._ozeConnect=e.connect(P,"onZoomEnd",this,function(){B.show(this._focusDiv)});this._omsConnect=e.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(O.extent,null,null,null)},_deactivate:function(){e.disconnect(this._soeConnect);e.disconnect(this._ufoConnect);
e.disconnect(this._oecConnect);e.disconnect(this._opaConnect);e.disconnect(this._ozsConnect);e.disconnect(this._ozeConnect);e.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(O,P,T,V){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=O,this.overviewMap.setExtent(O.expand(this.expandFactor),!0))},_updateFocus:function(O){this._suspendPanHandling||(this._focusExtent=O,this._drawFocusDiv(O))},
_drawFocusDiv:function(O,P){var T=this.overviewMap,V=T.toScreen(new A(O.xmin,O.ymax,T.spatialReference)),X=T.toScreen(new A(O.xmax,O.ymin,T.spatialReference));T=X.x-V.x;X=X.y-V.y;var I=!0;T>this.overviewMap.width&&X>this.overviewMap.height&&(I=!1);x.set(this._focusDiv,{left:V.x+(P?P.x:0)+"px",top:V.y+(P?P.y:0)+"px",width:T+"px",height:X+"px",display:I?"block":"none"})},_moveStopHandler:function(O){var P=this._moveableHandle.node.style;O=this._focusExtent;var T=this.overviewMap;P=T.toMap(new F(parseInt(P.left,
10),parseInt(P.top,10)));var V=new A(O.xmin,O.ymax,T.spatialReference);this._focusExtent=O.offset(P.x-V.x,P.y-V.y);this._maximized?this._maximizeHandler():T.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(O,P){this._drawFocusDiv(this._focusExtent,P)}});w.setObject("dijit.OverviewMap",a,u);return a})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v){a=a(F,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(m){try{if(m=w.mixin({bingMapsKey:null,culture:"en-US"},m||{}),this.url=G.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=G.urlToObject(this.url),this.spatialReference=new D({wkid:102100}),this.tileInfo=new A({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new g(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new D({wkid:102100})),w.mixin(this,m),this.hasAttributionData=this.showAttribution,this._initLayer=w.hitch(this,this._initLayer),this._errorHandler=w.hitch(this,this._errorHandler),this._getTileInfo=w.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(h){throw this.onError(h),h;}},_unsetMap:function(m,h){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var m=this._url.path+"/Imagery/Metadata/"+this.mapStyle,h=window.location.protocol;if(this.bingMapsKey){var f=this.resourceInfo;!this.loaded&&f?this._initLayer(f):v({url:m,content:w.mixin({},{uriScheme:"https:"===h?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(m,h){if(200!==m.statusCode){var f=Error();f.code=m.statusCode;f.message=m.statusDescription;f.details=m.errorDetails;f.authenticationResultCode=m.authenticationResultCode;this.onError(f)}else try{this.resourceInfo=e.toJson(m);f=m.resourceSets[0].resources[0];var c=f.imageUrl.replace("{","${");this.tileServers=b.map(f.imageUrlSubdomains,function(k){var z=G.getProtocolForWebResource();return x.substitute(c,{subdomain:k}).replace("http:",z)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var l=this.loadCallback;l&&(delete this.loadCallback,l(this))}}catch(k){this.onError(k)}},getAttributionData:function(){var m=new y,h=e.fromJson(this.resourceInfo),f;this.hasAttributionData&&h&&(f=w.getObject("resourceSets.0.resources.0.imageryProviders",!1,h));f?m.callback({contributors:f}):
(h=Error("Layer does not have attribution data"),h.log=t.isDebug,m.errback(h));return m},getTileUrl:function(m,h,f){return x.substitute(this.tileServers[h%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(m,h,f),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(m,h,f){var c="",l;for(l=m;0<l;l--){m="0";var k=1<<l-1;0!=(f&k)&&m++;0!=(h&k)&&(m++,m++);c+=m}return c},setMapStyle:function(m){this.mapStyle=m;this._getTileInfo()},setCulture:function(m){this.culture=m;this._getTileInfo()},
setBingMapsKey:function(m){this.bingMapsKey=m},onMapStyleChange:function(){}});w.mixin(a,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});w.setObject("virtualearth.VETiledLayer",a,J);return a})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f){a=a(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(c,l){try{w.mixin(this,c);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var k=this.domNode=y.byId(l),z=this.map,u="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";
k&&(J.set(k,"innerHTML",u),this.listNode=t.query(".esriAttributionList",k)[0],this.itemNodes={});this._eventConnections=[b.connect(z,"onLayerAdd",this,this._onLayerAdd),b.connect(z,"onLayerRemove",this,this._onLayerRemove),b.connect(z,"onLayerSuspend",this,this._onLayerSuspend),b.connect(z,"onLayerResume",this,this._onLayerResume),b.connect(z,"onResize",this,this._adjustFocus),b.connect(z,"onExtentChange",this,this._onExtentChange)];if(z.loaded){var n=z.layerIds.concat(z.graphicsLayerIds),B,H=n.length;
for(B=0;B<H;B++){var Q=z.getLayer(n[B]);Q.loaded&&this._onLayerAdd(Q)}}}catch(O){}},startup:function(){},destroy:function(){e.forEach(this._eventConnections,b.disconnect);G.destroy(this.listNode);var c=this._layerHandles,l;for(l in c)c[l]&&c[l].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(c){try{var l=this._attributions,k=c.id;
if(!v.isDefined(l[k])&&c.showAttribution){if(c.hasAttributionData){var z=c.getAttributionData();this._pendingDfds[k]=1;l[k]=z;z.addBoth(w.partial(this._onAttributionLoad,this,c))}else l[k]=c.copyright||c.copyrightText||"",l[k]?(c.suspended||this._activeLayers.push(k),this._createNode(k)):this._onLayerRemove(c);-1<c.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[k]=c.on("map-style-change",w.hitch(this,function(){this._onLayerRemove(c);this._onLayerAdd(c)})))}}catch(u){}},
_onAttributionLoad:function(c,l,k){var z=c._attributions,u=c._pendingDfds,n=l.id;if(u&&u[n]){delete u[n];if(!k||k instanceof Error)k="";z[n]=k?c._createIndexByLevel(k,-1!==l.declaredClass.toLowerCase().indexOf("vetiledlayer")):l.copyright||l.copyrightText||"";z[n]?(l.suspended||c._activeLayers.push(n),c._createNode(n)):c._onLayerRemove(l)}},_onLayerRemove:function(c){try{var l=c.id,k=this.itemNodes,z=-1;this._onLayerSuspend(c);this._layerHandles[l]&&this._layerHandles[l].remove();delete this._attributions[l];
delete this._pendingDfds[l];delete this._layerHandles[l];var u=this._getGroupIndex(l);-1!==u&&(z=e.indexOf(this._sharedLayers[u],l),-1!==z&&(this._sharedLayers[u].splice(z,1),1>=this._sharedLayers[u].length&&this._sharedLayers.splice(u,1)));k[l]&&-1===z&&G.destroy(k[l]);delete k[l];this._updateLastItem()}catch(n){}},_onLayerSuspend:function(c){try{var l=c.id;if(this._attributions[l]){var k=e.indexOf(this._activeLayers,l),z=this.itemNodes[l];-1!==k&&this._activeLayers.splice(k,1);z&&this._toggleItem(z,
!1,this._getGroupIndex(l))}}catch(u){}},_adjustFocus:function(){var c=this.domNode.scrollWidth>this.domNode.clientWidth,l=A.contains(this.domNode,"esriAttributionOpen");J.set(this.domNode,"tabIndex",c||l?"0":"")},_onLayerResume:function(c){try{var l=c.id,k=this._attributions[l],z=this.itemNodes[l];if(k&&(-1===e.indexOf(this._activeLayers,l)&&this._activeLayers.push(l),z)){var u=w.isString(k)?k:this._getContributorsList(k,this.map.extent,this.map.getLevel());w.isString(k)||J.set(z,"innerHTML",u?u+
this._getDelimiter():"");u&&this._toggleItem(z,!0,this._getGroupIndex(l))}}catch(n){}},_onExtentChange:function(c,l,k,z){try{var u=this._activeLayers,n=this._attributions,B=this.itemNodes,H,Q,O=u.length||0;for(Q=0;Q<O;Q++){var P=u[Q];var T=n[P];if((H=B[P])&&!w.isString(T)){var V=this._getContributorsList(T,c,z?z.level:-1);J.set(H,"innerHTML",V?V+this._getDelimiter():"");this._toggleItem(H,!!V,-1)}}}catch(X){}this._adjustCursorStyle()},_createNode:function(c){if(this.domNode){var l=this._checkShareInfo(c),
k=l&&l.sharedWith;k=k&&this.itemNodes[k];var z=this.map,u=this._attributions[c];u=w.isString(u)?u:this._getContributorsList(u,z.extent,z.getLevel());z=!!u&&!z.getLayer(c).suspended;k?(this.itemNodes[c]=k,this._toggleItem(k,z,l.index)):(c=this.itemNodes[c]=G.create("span",{"class":this.itemClass,innerHTML:u?u+this._getDelimiter():"",style:{display:z?"inline":"none"}},this.listNode),z&&this._setLastItem(c));this._adjustCursorStyle()}},_checkShareInfo:function(c){var l=this._attributions,k,z=-1,u=l[c];
if(u&&w.isString(u)){for(k in l){var n=l[k];if(k!==c&&n&&w.isString(n)&&n.length===u.length&&n.toLowerCase()===u.toLowerCase()){var B=k;break}}l=this._sharedLayers;n=l.length;if(B){for(k=0;k<n;k++)if(u=l[k],-1!==e.indexOf(u,B)){z=k;u.push(c);break}-1===z&&(z=l.push([B,c])-1)}}return-1<z?{index:z,sharedWith:B}:null},_getGroupIndex:function(c){var l=this._sharedLayers,k,z=l.length,u=-1;for(k=0;k<z;k++)if(-1!==e.indexOf(l[k],c)){u=k;break}return u},_getDelimiter:function(){var c=this.itemDelimiter;return c?
"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+c+"\x3c/span\x3e":""},_toggleItem:function(c,l,k){if(-1<k&&!l){k=this._sharedLayers[k];var z,u=k.length,n=this._activeLayers;for(z=0;z<u;z++)if(-1!==e.indexOf(n,k[z]))return}D.set(c,"display",l?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var c=this.listNode.childNodes;var l=c.length;if(l)for(--l;0<=l;l--){var k=c[l];if("none"!==D.get(k,"display")){this._setLastItem(k);break}}this._adjustCursorStyle()},_setLastItem:function(c){var l=
this.itemClass,k=this.lastItemClass;this._lastItem&&A.replace(this._lastItem,l,k);c&&(A.replace(c,k,l),this._lastItem=c)},_createIndexByLevel:function(c,l){var k=c.contributors,z,u,n=k?k.length:0,B,H=new m(4326),Q={};for(u=0;u<n;u++){var O=k[u];var P=(z=O.coverageAreas)?z.length:0;for(B=0;B<P;B++){var T=z[B];var V=T.bbox;V={extent:h.geographicToWebMercator(new f(V[1],V[0],V[3],V[2],H)),attribution:O.attribution||"",zoomMin:T.zoomMin-(l&&T.zoomMin?1:0),zoomMax:T.zoomMax-(l&&T.zoomMax?1:0),score:v.isDefined(T.score)?
T.score:100,objectId:u};for(T=V.zoomMin;T<=V.zoomMax;T++)Q[T]=Q[T]||[],Q[T].push(V)}}return Q},_getContributorsList:function(c,l,k){var z="";if(l&&v.isDefined(k)&&-1<k){c=c[k];k=l.getCenter().normalize();var u=c?c.length:0,n=[],B={};for(z=0;z<u;z++)l=c[z],!B[l.objectId]&&l.extent.contains(k)&&(B[l.objectId]=1,n.push(l));n.sort(function(H,Q){return Q.score-H.score||H.objectId-Q.objectId});u=n.length;for(z=0;z<u;z++)n[z]=n[z].attribution;z=n.join(", ")}return z},_adjustCursorStyle:function(){var c=
F.position(this.listNode.parentNode,!0).h;A.contains(this.listNode.parentNode,"esriAttributionOpen")?(A.remove(this.listNode.parentNode,"esriAttributionOpen"),c>F.position(this.listNode.parentNode,!0).h?(D.set(this.listNode.parentNode,"cursor","pointer"),A.add(this.listNode.parentNode,"esriAttributionOpen")):D.set(this.listNode.parentNode,"cursor","default")):(A.add(this.listNode.parentNode,"esriAttributionOpen"),c<F.position(this.listNode.parentNode,!0).h?D.set(this.listNode.parentNode,"cursor",
"pointer"):D.set(this.listNode.parentNode,"cursor","default"),A.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});w.setObject("dijit.Attribution",a,g);return a})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u){t=a([k,G,D],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:z,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(n,B){w.mixin(this,u.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=w.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},n.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new v.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=w.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var n=this._sliderToTimeExtent();this.onTimeExtentChange(n)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var n=this._getSliderValue();this._offset=w.isArray(n)?
n[1]-n[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(n,B){n&&n.startTime&&n.endTime&&(B=B||this._defaultCount,this.createTimeStopsByTimeInterval(n,Math.ceil((n.endTime-n.startTime)/(B-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(n,B,H,Q){if(n&&n.startTime&&n.endTime){this.fullTimeExtent=
new l(n.startTime,n.endTime);Q&&!0===Q.resetStartTime&&this._resetStartTime(this.fullTimeExtent,H);this._timeIntervalUnits=H;Q=this.fullTimeExtent.startTime;for(var O=[];Q<=n.endTime;)O.push(Q),Q=n._getOffsettedDate(Q,B,H);0<O.length&&O[O.length-1]<n.endTime&&O.push(Q);this.setTimeStops(O)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(n){this.timeStops=n||[];this._numTicks=this._numStops=this.timeStops.length;!1===c.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new l(n[0],n[n.length-1]))},setLoop:function(n){this.loop=n},setThumbCount:function(n){this.thumbCount=n;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(n){this.thumbIndexes=w.clone(n)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(n){this.thumbMovingRate=n;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(n){this.labels=n;this._slider&&this._createSlider()},setTickCount:function(n){this._numTicks=
n;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(n){this._createTimeInstants=n&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(n){this.intermediateChanges=!!n;this._slider&&this._slider.set("intermediateChanges",!!n)},_updateUI:function(){p.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";p.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var n=this.domNode;n.parentNode&&!n.dir;)n=n.parentNode;n={onChange:w.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=x.create("div",{},b.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=x.create("div",{},this._ts,"first");this._timeSliderLabels=x.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(n):this._createSingleSlider(n);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&b.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(B){y.set(B,{background:"none"})});this._initializeThumbs();e.disconnect(this._onChangeConnect);this._onChangeConnect=e.connect(this._slider,"onChange",w.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(n){this._isRangeSlider=!0;this._slider=new (a([A,m],{templateString:h}))(n,this._ts)},_createSingleSlider:function(n){this._isRangeSlider=!1;this._slider=new A(n,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new F({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new g({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var n=this._toSliderValue(this.thumbIndexes[0]);
n=n>this._slider.maximum||n<this._slider.minimum?this._slider.minimum:n;if(!0===this._isRangeSlider){var B=this._toSliderValue(this.thumbIndexes[1]);B=B>this._slider.maximum||B<this._slider.minimum?this._slider.maximum:B;this._setSliderValue([n,B<n?n:B])}else this._setSliderValue(n);this._onHorizontalChange()}},_bumpSlider:function(n){var B=this._getSliderValue(),H=B,Q=H,O=n;w.isArray(B)&&(Q=B[0],H=B[1],O=[{change:n,useMaxValue:!0},{change:n,useMaxValue:!1}]);1E-10>Math.abs(Q-this._slider.minimum)&&
0>n||1E-10>Math.abs(H-this._slider.maximum)&&0<n?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),n=this._sliderToTimeExtent(),this.onTimeExtentChange(n),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(O)},_updateThumbIndexes:function(){var n=this._getSliderValue();w.isArray(n)?(this.thumbIndexes[0]=this._toSliderIndex(n[0]),this.thumbIndexes[1]=this._toSliderIndex(n[1])):this.thumbIndexes[0]=this._toSliderIndex(n)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var n=new l,B=this._getSliderValue();if(w.isArray(B)){if(B[0]>B[1]){var H=B[0];var Q=B[1]}else Q=B[0],H=B[1];n.startTime=new Date(this.timeStops[this._toSliderIndex(Q)]);n.endTime=new Date(this.timeStops[this._toSliderIndex(H)]);this._adjustTimeExtent(n)}else n.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(B)]):new Date(this.fullTimeExtent.startTime),n.endTime=!0===this._createTimeInstants?n.startTime:new Date(this.timeStops[this._toSliderIndex(B)]);
return n}},_adjustTimeExtent:function(n){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&n.startTime.getTime()!==n.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var B=n.startTime;B.setUTCSeconds(B.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(n=n.endTime,n.setUTCSeconds(n.getUTCSeconds()-1))}},_resetStartTime:function(n,B){switch(B){case "esriTimeUnitsSeconds":n.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":n.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":n.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":n.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":n.startTime.setUTCDate(n.startTime.getUTCDate()-n.startTime.getUTCDay());break;case "esriTimeUnitsMonths":n.startTime.setUTCDate(1);n.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":n.startTime.setUTCFullYear(n.startTime.getUTCFullYear()-n.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":n.startTime.setUTCFullYear(n.startTime.getUTCFullYear()-
n.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(n){n=Math.floor((n-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>n&&(n=0);n>=this._numStops&&(n=this._numStops-1);return n},_toSliderValue:function(n){return n*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(n){this._slider._setValueAttr(n,!1,!1)}});w.setObject("dijit.TimeSlider",t,f);return t})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I){var U={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};g=a([n,g,v],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:B,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(E,L){a.safeMixin(this,E);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===U.LAYOUT_HORIZONTAL&&(this.templateString=
H);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=Q;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var E=this;this._getAllLayersMDInfo().then(function(){E._sortDimensionValues();E.dimensionValues=E.dimensionValues&&E.dimensionValues.length&&!E.useLayersDimSlices?E.dimensionValues:E._mapSortedDimensionValues;E.getUnit();E._setupSlider()});this._timer=new m.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
w.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===U.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",w.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var E=X(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=I.create("div");O.add(this._passiveLbl1,"esriMdSliderPassiveLbl");I.place(this._passiveLbl1,E[0]);2===this._thumbCount&&(this._passiveLbl2=I.create("div"),
O.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),I.place(this._passiveLbl2,E[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(b(this.domNode,"mouseover",w.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,"mouseleave",w.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.domNode,V.press,w.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,V.release,w.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.prevBtn.domNode,
V.press,w.hitch(this,"activateSlider")));this._eventHandles.push(b(this.playPauseBtn.domNode,V.press,w.hitch(this,"activateSlider")));this._eventHandles.push(b(this.nextBtn.domNode,V.press,w.hitch(this,"activateSlider")));var E=X(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);h.forEach(E,function(L){this._eventHandles.push(b(L,V.press,w.hitch(this,"activateSlider")));this._eventHandles.push(b(L,V.release,w.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){h.forEach(this._eventHandles,
function(E){E&&E.remove()})},activateSlider:function(){9>e("ie")&&P.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);O.remove(this.domNode,"esriMdSliderPassive");O.add(this.domNode,"esriMdSliderActive");P.set(this._passiveLbl1,"display","none");this._passiveLbl2&&P.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>e("ie"))){var E=this;this.deactivateTimer=setTimeout(function(){E.sliderActive=!1;E.updatePassiveLabels();
O.remove(E.domNode,"esriMdSliderActive");O.add(E.domNode,"esriMdSliderPassive");E._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&u.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){u.isDefined(this.value)&&(P.set(this._passiveLbl1,"display","inline-block"),this.value.length?
P.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&P.set(this._passiveLbl2,"display","none"))},increment:function(){var E=1;!this.playDirectionAscending&&this.playing&&(E=-1);this._bumpSlider(E)},decrement:function(){var E=-1;!this.playDirectionAscending&&this.playing&&(E=1);this._bumpSlider(E)},_setDimensionAttr:function(E){this._slider&&(E.dimension&&(this.dimension=E.dimension),this.dimensionValues=E.dimensionValues&&E.dimensionValues.length?E.dimensionValues:[],this.update())},
update:function(){var E=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){E._sortDimensionValues();E.getUnit();E.dimensionValues&&E.dimensionValues.length&&!E.useLayersDimSlices||(E.dimensionValues=E._mapSortedDimensionValues);E._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(E){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===U.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===U.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new J({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new y({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new F({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new A({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(E){E=E?E:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new G({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:w.hitch(this,"increment"),decrement:w.hitch(this,"decrement"),value:E||0,onChange:w.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(E){E=E?E:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new D({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:w.hitch(this,"increment"),decrement:w.hitch(this,"decrement"),value:E||[0,1],onChange:w.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();b(this._slider.incrementButton,"click",this._slider.increment);b(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(E){E=u.isDefined(E)?E:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new p({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:w.hitch(this,
"increment"),decrement:w.hitch(this,"decrement"),value:E||0,onChange:w.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(E){E=E?E:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new x({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:w.hitch(this,
"increment"),decrement:w.hitch(this,"decrement"),value:E||[0,1],onChange:w.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(E){var L=this.dimensionValues[E];this.setDimensionInfoText(L);h.forEach(this._layers,function(da){this._updateMosaicRule(da,L);this.prefetch&&this.playing&&"esri.layers.RasterXLayer"!==da.declaredClass&&this._prefetchData(E,da)},this);this._oldValue=E;this.value=
L;this.updatePassiveLabels();this.onChange(L)},_onRangeSliderChange:function(E){if(this._update){this._snap&&(E=this._snapToNearestRange(E));var L=[this.dimensionValues[E[1]],this.dimensionValues[E[0]]];L.sort(this._sortCompareFunction);this.value=L;this.setDimensionInfoText(L);this.updatePassiveLabels();h.forEach(this._layers,function(da){this._updateMosaicRule(da,L);this.prefetch&&this.playing&&this._prefetchData(E,da)},this);this._update=!0;this._oldValue=w.clone(E);this.onChange(L)}},destroy:function(){this.inherited(arguments);
this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(E){this._slider.domNode&&I.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=h.indexOf(this.dimensionValues,this.value[0])&&0<=h.indexOf(this.dimensionValues,this.value[1]))var E=[h.indexOf(this.dimensionValues,this.value[0]),h.indexOf(this.dimensionValues,
this.value[1])];else if(u.isDefined(this.value)){var L=h.indexOf(this.dimensionValues,this.value);0<=L&&(E=L)}u.isDefined(E)||(E=this._getDefaultSliderValue());this.useDefaults&&u.isDefined(E)&&(E===this.dimensionValues.length-1||E.length&&0<=h.indexOf(E,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===U.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(E):this._createVerticalRangeSlider(E):this.layout===U.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(E):
this._createVerticalSingleSlider(E)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var E=Infinity,L=1,da;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(da=0;da<this.dimensionValues.length;da++){var R=this.dimensionValues[da];var M=Math.abs(R-0);if(M<E){E=M;var r=R}if(0===M)break}else r=this.dimensionValues[0];r=h.indexOf(this.dimensionValues,r);r=0>r?0:r;2===this._thumbCount&&(r===this.dimensionValues.length-1&&(L=-1),r=[r,r+L]);return r}},_getMultidimensionalInfo:function(E){function L(){E.getMultidimensionalInfo().then(function(R){E.multidimensionalInfo=
R;da.resolve(E)},function(R){da.reject(R)})}var da=new f;if(E.multidimensionalInfo)da.resolve(E);else if(E.loaded)L();else E.on("load",function(){L()});return da},_getAllLayersMDInfo:function(){var E=[];h.forEach(this._layers,function(L){E.push(this._getMultidimensionalInfo(L))},this);return new c(E)},_getImageLayers:function(){var E=this.map.layerIds.concat(this.map.graphicsLayerIds),L;this._layers=[];h.forEach(E,function(da){L=this.map.getLayer(da);"esri.layers.ArcGISImageServiceLayer"!==L.declaredClass&&
"esri.layers.ArcGISImageServiceVectorLayer"!==L.declaredClass&&"esri.layers.RasterLayer"!==L.declaredClass&&"esri.layers.WCSLayer"!==L.declaredClass&&"esri.layers.RasterXLayer"!==L.declaredClass||this._layers.push(L)},this);return this._layers},_sortCompareFunction:function(E,L){return u.isDefined(E)&&u.isDefined(L)?E-L:!1},_getDimensionObjects:function(){function E(R){if(R&&R.values&&R.hasRanges){var M=[];h.forEach(R.values,function(r){r.length?M=L(M,r):M.push.apply(L(M.sort(this._sortCompareFunction),
[r]))},this);M=M.sort(da._sortCompareFunction);R.decodedValues=M}return R}var L=this._merge,da=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();h.forEach(this._layers,function(R){R.multidimensionalInfo&&h.some(R.multidimensionalInfo.variables,function(M){h.some(M.dimensions,function(r){r.name!==this.dimension||r.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&
this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;h.forEach(this._layers,function(R){R.multidimensionalInfo&&h.some(R.multidimensionalInfo.variables,function(M){h.some(M.dimensions,function(r){r.name===this.dimension&&(this._allRangeValues&&r.hasRanges||this.useRanges?this._dimensionObjects.push(E(w.clone(r))):this._dimensionObjects.push(w.clone(r)))},this)},this)},this)},_merge:function(E,L){for(var da=[],R=0,M=0;R<E.length&&M<L.length;)E[R]<L[M]?da.push(E[R++]):E[R]>L[M]?
da.push(L[M++]):(da.push(L[M++]),R++);da=da.concat(E.slice(R)).concat(L.slice(M));return da=h.filter(da,function(r,N,W){return W.indexOf(r)===N})},_mergeRangeArrays:function(E,L){for(var da=[],R=0,M=0;R<E.length&&M<L.length;)E[R][0]<L[M][0]||E[R][0]===L[M][0]&&E[R][1]<L[M][1]?da.push(E[R++]):E[R][0]>L[M][0]||E[R][0]===L[M][0]&&E[R][1]>L[M][1]?da.push(L[M++]):(da.push(L[M++]),R++);da=da.concat(E.slice(R)).concat(L.slice(M));return da=h.filter(da,function(r,N,W){return W.indexOf(r)===N},this)},_sortDimensionValues:function(){var E=
0,L=this._merge,da=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(E=1;E<this._dimensionObjects.length;E++)this._mapSortedDimensionValues=L(this._mapSortedDimensionValues,this._dimensionObjects[E].decodedValues||this._dimensionObjects[E].values),
this._allRangeValues&&(this._dimensionRangeValues=da(this._dimensionRangeValues,this._dimensionObjects[E].values))},_createDimensionalDefinition:function(E,L){var da=[E];return new k({variableName:L,dimensionName:this.dimension,values:da,isSlice:1===da.length})},_updateMosaicRule:function(E,L){var da=!1,R=E.mosaicRule||E.defaultMosaicRule||new l({multidimensionalDefinition:[]}),M="esri.layers.WCSLayer"===E.declaredClass,r="esri.layers.RasterXLayer"===E.declaredClass,N=(M?E.multidimensionalDefinition:
R.multidimensionalDefinition)||[];L.length&&L.sort(this._sortCompareFunction);h.forEach(N,function(ba){ba.dimensionName===this.dimension&&(ba.values=[L],ba.isSlice=!this.useRanges,da=!0)},this);if(!da){var W="",fa=h.filter(E.multidimensionalInfo.variables,function(ba){return h.some(N,function(Z){return Z.variableName&&Z.variableName.toLowerCase()===ba.name.toLowerCase()},this)},this);0===fa.length&&(fa=E.multidimensionalInfo.variables);r&&E.raster&&E.raster.defaultMultidimensionalDefinition&&E.raster.defaultMultidimensionalDefinition[0]&&
E.raster.defaultMultidimensionalDefinition[0].variableName&&h.forEach(E.raster.defaultMultidimensionalDefinition,function(ba){ba.dimensionName===this.dimension&&(W=ba.variableName)},this);W.length?(N.push(this._createDimensionalDefinition(L,W)),da=!0):h.some(fa,function(ba){if(h.some(ba.dimensions,function(Z){if(Z.name===this.dimension){if(M||r)W=ba.name;return!0}},this))return!0},this)&&(N.push(this._createDimensionalDefinition(L,W)),da=!0)}da&&(M&&E.setMultidimensionalDefinition(N),r?E.setMultiDimensionalDefinition(R):
(R.multidimensionalDefinition=N,E.setMosaicRule(R)))},_prefetchData:function(E,L){if(L&&(L.mosaicRule||L.multidimensionalDefinition)){var da,R,M=!1,r,N=this,W;this.prefetchedValues[L.id]||(this.prefetchedValues[L.id]=[]);this.prefetchImgNodes[L.id]=[];var fa=w.clone(L._params);var ba=(R=w.clone(L.mosaicRule))&&R.multidimensionalDefinition||w.clone(L.multidimensionalDefinition);for(da=1;da<=this.prefetchFactor;da++)M=!1,h.forEach(ba,function(Z){Z.dimensionName===this.dimension&&(this.playDirectionAscending?
E.length?(this.snap?(r=this._getNextRangeIndex(E)||E,Z.values=[this.dimensionValues[r[0]],this.dimensionValues[r[1]]]):Z.values=[this.dimensionValues[(E[0]+da)%this.dimensionValues.length],this.dimensionValues[(E[1]+da)%this.dimensionValues.length]],Z.values.sort(this._sortCompareFunction)):Z.values=[this.dimensionValues[(E+da)%this.dimensionValues.length]]:E.length?(this.snap?(r=this._getNextRangeIndex(E,-1)||E,Z.values=[this.dimensionValues[r[0]],this.dimensionValues[r[1]]]):Z.values=[this.dimensionValues[(this.dimensionValues.length+
E[0]-da)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+E[1]-da)%this.dimensionValues.length]],Z.values.sort(this._sortCompareFunction)):Z.values=[this.dimensionValues[(this.dimensionValues.length+E-da)%this.dimensionValues.length]],h.some(this.prefetchedValues[L.id],function(ja){if(t.stringify(ja)===t.stringify(Z.values))return!0})||(M=!0,this.prefetchedValues[L.id].push(Z.values)))},this),M&&"esri.layers.WCSLayer"!==L.declaredClass&&(fa.mosaicRule=t.stringify(R.toJson()),
L.getImageUrl(this.map.extent,this.map.width,this.map.height,function(Z){W=new Image;N.prefetchImgNodes[L.id].push(W);W.src=Z},fa))}},setDimensionInfoText:function(E){if(u.isDefined(E)){var L=this.unitSymbol||this.unit;if("number"!==typeof E){E=w.clone(E.sort(this._sortCompareFunction));if(0!==E[0]%1||0!==E[1]%1)E[0]=parseFloat(E[0].toFixed(2)),E[1]=parseFloat(E[1].toFixed(2));E="["+E[0]+", "+E[1]+"]"}else 0!==E%1&&(E=E.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+
this.dimensionAlias+" ("+L+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===U.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+E):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+E)}},setLabels:function(E){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&this.dimensionValues.length){var E=Math.ceil(this.dimensionValues.length/this.nLabels);return h.map(this.dimensionValues,function(L,da){return 0===
da%E||da===this.dimensionValues.length-1?(0!==L%1&&(L=parseFloat(L.toFixed(2))),L):""},this)}},_filterLayers:function(){return h.filter(this._layers,function(E){if(E.multidimensionalInfo&&E.visible&&E.useMapDimensionValue&&h.some(E.multidimensionalInfo.variables,function(L){if(h.some(L.dimensions,function(da){if(da.name===this.dimension)return!0},this))return!0},this))return!0},this)},_updateUI:function(){O.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":
"mdsButton mdsPlayButton";O.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(E){var L=this._slider.value;if(0<=E)!this._snap&&(0>L||L>=this.dimensionValues.length-1||L[0]>=this.dimensionValues.length-1||L[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(L)):this._slider.set("value",[0,Math.abs(L[0]-L[1])]):this._slider.set("value",
0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&L[0]<this.dimensionValues.length-1&&L[1]<this.dimensionValues.length-1?this._slider.set("value",[L[0]+1,L[1]+1]):1===this._thumbCount&&L<this.dimensionValues.length-1?this._slider.set("value",L+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(L));else if(0>=L||0>=L[0]||0>=L[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",
this._getNextRangeIndex(L,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(L[0]-L[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=L||0<=L[1])2===this._thumbCount&&0<L[1]&&0<L[0]?this._snap?this._slider.set("value",this._getNextRangeIndex(L,-1)):this._slider.set("value",[L[0]-1,L[1]-1]):1===this._thumbCount&&0<L&&this._slider.set("value",L-1)},setThumbMovingRate:function(E){this.thumbMovingRate=
E;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(E){E=E||this.dimension;var L,da;h.forEach(this._layers,function(R){R.multidimensionalInfo&&R.multidimensionalInfo.variables&&h.forEach(R.multidimensionalInfo.variables,function(M){h.forEach(M.dimensions,function(r){if(r.name===E&&r.extent&&r.extent.length&&1<r.extent.length){if(!u.isDefined(L)||r.extent[0]<L)L=r.extent[0];if(!u.isDefined(da)||r.extent[1]>da)da=r.extent[1]}},this)},this)},this);return[L,da]},
setThumbCount:function(E){this._thumbCount=2==E?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(E){var L=[];if(E&&E.mosaicRule&&E.mosaicRule.multidimensionalDefinition){var da=E.mosaicRule;var R=da.multidimensionalDefinition;h.forEach(R,function(M){M.dimensionName!==this.dimension&&L.push(M)},this);da.multidimensionalDefinition=L;E.setMosaicRule(da)}},getUnit:function(){var E=null,L=!1;this.unit=null;h.forEach(this._layers,function(da){da.multidimensionalInfo&&
h.forEach(da.multidimensionalInfo.variables,function(R){h.forEach(R.dimensions,function(M){M.name===this.dimension&&M.unit&&(null!=E||L?u.isDefined(M.unit)&&M.unit.replace("esri","").toLowerCase()!==E.toLowerCase()&&(E=null,L=!0):E=M.unit.replace("esri",""))},this)},this)},this);E&&(E=E.replace("esri",""));this.unit=E;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=L;return E},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;h.some(this._layers,function(E){if(E.fields&&
E.fields.length&&h.some(E.fields,function(L){if(L.name&&L.name===this.dimension&&L.alias)return this.dimensionAlias=L.alias,!0},this))return!0},this)},_readMosaicRule:function(){var E;h.forEach(this._layers,function(L){(L=L.mosaicRule&&L.mosaicRule.multidimensionalDefinition||L.multidimensionalDefinition)&&h.forEach(L,function(da){da&&da.dimensionName===this.dimension&&da.values&&(E=da.values.length&&da.values[0]&&da.values[0].length?da.values[0]:da.values)},this)},this);this.useRanges=u.isDefined(this.useRanges)?
this.useRanges:E&&1!==E.length?!0:!1;E&&(this.useRanges?(this._thumbCount=2,this.value=1===E.length?[E[0],this.dimensionValues[this.dimensionValues.length-1]]:E):1<E.length&&this._snap?(this._thumbCount=2,this.value=E):(this._thumbCount=1,this.useRanges=!1,this.value=E[0]))},hasUnitConflict:function(){this.getUnit();return this._hasUnitConflict},resizeSlider:function(E,L){P.set(this.domNode,{height:E+"px",width:L+"px"});P.set(this.mdSliderTable,{height:E+"px",width:L+"px"});this.computeSliderStyle()},
computeSliderStyle:function(){var E=T.getContentBox(this.domNode).h-T.getContentBox(this.dimensionInfo).h-(T.getContentBox(this.playPauseBtnRow).h+20);10>=e("ie")&&(E-=53);var L="height: "+E+"px;";this._slider&&this._slider.domNode&&P.set(this._slider.domNode,"height",E+"px");return L},getUnitSymbol:function(){if(!u.isDefined(this.unit))return null;var E=this.unit.toLowerCase();if("meters"===E||"meter"===E)return this.unitSymbols.meter;if("pascal"===E||"pascals"===E)return this.unitSymbols.pascal},
_snapToNearestRange:function(E){if(E&&E.length&&this._snap){var L,da,R,M=this;var r=[this.dimensionValues[E[1]],this.dimensionValues[E[0]]];r.sort(this._sortCompareFunction);if(h.some(this._dimensionObjects,function(Z){if(h.some(Z.values,function(ja){if(ja&&ja.length&&ja[0]===r[0]&&ja[1]===r[1])return!0}))return!0},this))return E;if(h.some(this._dimensionObjects,function(Z){if(h.some(Z.values,function(ja){if(ja&&ja.length&&ja[0]===r[0])return L=w.clone(ja.sort(this._sortCompareFunction)),!0},this))return!0},
this)){h.some(this.dimensionValues,function(Z,ja){Z===L[0]&&(da=ja);Z===L[1]&&(R=ja)});var N=Math.abs(E[0]-da);var W=[da,R]}if(h.some(this._dimensionObjects,function(Z){if(h.some(Z.values,function(ja){if(ja&&ja.length&&ja[1]===r[1])return L=w.clone(ja.sort(this._sortCompareFunction)),!0},this))return!0},this)){h.some(this.dimensionValues,function(Z,ja){Z===L[1]&&(R=ja);Z===L[0]&&(da=ja)});var fa=Math.abs(E[1]-R);var ba=[da,R]}E=N&&fa?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,
W)?ba:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,ba)?W:N<=fa?W:ba:W||ba||E;this._update=!1;setTimeout(function(){M._slider.set("value",E)},100);return E}},_arraysEqual:function(E,L){var da;if(!u.isDefined(E)||!u.isDefined(L))return!1;if(E===L)return!0;if(E.length!==L.length)return!1;E.sort(this._sortCompareFunction);L.sort(this._sortCompareFunction);for(da=0;da<E.length;++da)if(E[da]!==L[da])return!1;return!0},_getNextRangeIndex:function(E,L){if(!this._dimensionRangeValues||
!this._dimensionRangeValues.length)return null;var da,R,M;L=u.isDefined(L)?L:1;h.some(this._dimensionRangeValues,function(N,W){if(this._arraysEqual(N,[this.dimensionValues[E[0]],this.dimensionValues[E[1]]]))return da=W,!0},this);var r=this._dimensionRangeValues[0<L?(da+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+da-1)%this._dimensionRangeValues.length];h.some(this.dimensionValues,function(N,W){N===r[0]&&(R=W);N===r[1]&&(M=W);if(R&&M)return!0},this);return[R,M]}});w.mixin(g,
U);w.setObject("dijit.MultidimensionalSlider",g,z);return g})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da){w=w([L,v,m],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:da,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(R,M){R=R||{};this.map=R.map;this._hasUI=M?!0:!1;this.bingMapsKey=R.bingMapsKey&&
0<R.bingMapsKey.length?R.bingMapsKey:null;this.showArcGISBasemaps=!1!==R.showArcGISBasemaps;this.basemaps=R.basemaps||[];this.basemapIds=R.basemapIds;this.referenceIds=R.referenceIds;this.basemapsGroup=R.basemapsGroup;this.arcgisUrl=h.dijit._arcgisUrl;R.portalUrl&&(this.arcgisUrl=R.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=c.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(t.hitch(this,function(R){this._supportsVTL=R}));e.forEach(this.basemaps,function(R){R.id&&0!==R.id.length||(R.id=this._getUniqueId());e.forEach(R.layers,function(M){M.opacity=0<=M.opacity?M.opacity:1;M.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&e.forEach(this.basemapIds,function(R){this.map.getLayer(R)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&
e.forEach(this.referenceIds,function(R){R=this.map.getLayer(R);R._basemapGalleryLayerType="reference";R.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(t.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(t.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():b.connect(this,"onLoad",
t.hitch(this,function(){this._refreshUI()}))},select:function(R){this._select(R)},getSelected:function(){return this._selectedBasemap},get:function(R){var M;for(M=0;M<this.basemaps.length;M++)if(this.basemaps[M].id===R)return this.basemaps[M];return null},add:function(R){return R&&!R.id?(R.id=this._getUniqueId(),this.basemaps.push(R),this._refreshUI(),this.onAdd(R),!0):R&&this._isUniqueId(R.id)?(this.basemaps.push(R),this._refreshUI(),this.onAdd(R),!0):!1},remove:function(R){var M;for(M=0;M<this.basemaps.length;M++){var r=
this.basemaps[M];if(r.id===R)return this._selectedBasemap&&this._selectedBasemap.id===r.id&&(this._selectedBasemap=null),this.basemaps.splice(M,1),this._refreshUI(),this.onRemove(r),r}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(R){},onRemove:function(R){},onError:function(R){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&
0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(R){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,R):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(R))},_findArcGISBasemapsGroup:function(R){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(R);else{var M=this.arcgisUrl+"/portals/self",
r={f:"json"};r.culture=p.locale;l({url:M,content:r,callbackParamName:"callback",load:t.hitch(this,function(N,W){N&&N.useVectorBasemaps&&N.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(t.hitch(this,function(fa){this._basemapGalleryGroupQuery=fa?N.vectorBasemapGalleryGroupQuery:N&&N.basemapGalleryGroupQuery?N.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(R)})):(this._basemapGalleryGroupQuery=N&&N.basemapGalleryGroupQuery?N.basemapGalleryGroupQuery:
this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(R))}),error:t.hitch(this,function(N,W){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(R){var M=t.hitch(this,"_findArcGISBasemaps"),r=this.arcgisUrl+"/community/groups",N={};N.q=this._basemapGalleryGroupQuery;N.f="json";l({url:r,content:N,callbackParamName:"callback",load:t.hitch(this,function(W,fa){if(0<W.results.length)M(W.results[0].id,R,W.results[0].sortField,
W.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:t.hitch(this,function(W){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(R,M,r,N){var W=t.hitch(this,function(fa,ba,Z,ja){var ma=this.arcgisUrl+"/search",aa={};aa.q="group:"+fa+' AND type:"web map" NOT type:"web mapping application"';aa.sortField=Z;aa.sortOrder="asc"===ja?"desc":"asc";aa.num=100;aa.f="json";l({url:ma,content:aa,
callbackParamName:"callback",load:t.hitch(this,function(ka,oa){if(0<ka.results.length)ba(ka.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:t.hitch(this,function(ka,oa){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});r&&N?W(R,M,r,N):l({url:this.arcgisUrl+"/community/groups/"+R,content:{f:"json"},callbackParamName:"callback",load:t.hitch(this,function(fa,ba){fa.sortField?W(R,M,fa.sortField,fa.sortOrder):W(R,M,"name",
"desc")}),error:t.hitch(this,function(fa,ba){W(R,M,"name","desc")})})},_handleArcGISBasemapsResponse:function(R){0<R.length&&(e.forEach(R,function(M,r){if(this.bingMapsKey||!this.bingMapsKey&&M.title&&-1===M.title.indexOf("Bing Maps")){var N={};N.id=this._getUniqueId();N.title=M.title;N.thumbnailUrl="";if(M.thumbnail&&M.thumbnail.length&&(N.thumbnailUrl=this.arcgisUrl+"/content/items/"+M.id+"/info/"+M.thumbnail,h.id)){var W=h.id.findCredential(c.urlToObject(this.arcgisUrl).path);W&&(N.thumbnailUrl+=
"?token\x3d"+W.token)}N.itemId=M.id;N=new E(N,this);this.basemaps.splice(0,0,N)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(F.empty(this.flowContainer),e.forEach(this.basemaps,function(R,M){R.id||(R.id="basemap_"+M);this.flowContainer.appendChild(this._buildNodeLayout(R))},this),F.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(R){var M=F.create("div",{id:"galleryNode_"+R.id,"class":"esriBasemapGalleryNode"}),
r=F.create("a",{href:"javascript:void(0);"},M);b.connect(r,"onclick",t.hitch(this,"_onNodeClick",R));var N=R.title||"";R.thumbnailUrl?F.create("img",{"class":"esriBasemapGalleryThumbnail",src:R.thumbnailUrl,title:N,alt:N},r):F.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.toUrl("./images/transparent.gif"),title:N,alt:N},r);R=F.create("div",{"class":"esriBasemapGalleryLabelContainer"},M);F.create("span",{innerHTML:N,alt:N,title:N},R);return M},_onNodeClick:function(R,M){M.preventDefault();
this._markSelected(R);this.select(R.id)},_markSelected:function(R){R&&(e.forEach(p.query(".esriBasemapGallerySelectedNode",this.domNode),function(M){g.remove(M,"esriBasemapGallerySelectedNode")}),(R=A.byId("galleryNode_"+R.id))&&g.add(R,"esriBasemapGallerySelectedNode"))},_select:function(R){this._selectBasemapInProgress=!0;var M=this.get(R);M?(M.layers?this._getServiceInfos(M):(R=M.getLayers(this.arcgisUrl),t.isArray(R)?this._getServiceInfos(M):R.addCallback(t.hitch(this,function(r){this._getServiceInfos(M)}))),
this._markSelected(M)):this._selectBasemapInProgress=!1},_getServiceInfos:function(R){"https:"===location.protocol&&e.forEach(R.layers,function(r){if(this._isAgolService(r.url)||this._isHostedService(r.url))r.url=r.url.replace("http:","https:")},this);this._selectedBasemap=R;var M=[];e.forEach(R.layers,function(r){r.url&&0<r.url.length&&!r.isReference&&!r.type&&(r.deferredsPos=M.length,M.push(this._getServiceInfo(r.url)))},this);0<M.length?(new D(M)).addCallback(t.hitch(this,function(r){var N=null;
e.forEach(R.layers,function(W){if(0===W.deferredsPos||W.deferredsPos){W.serviceInfoResponse=r[W.deferredsPos][1];var fa=W.serviceInfoResponse.fullExtent;fa||(fa=W.serviceInfoResponse.extent);N=N?N.union(new k(fa)):new k(fa)}},this);this.map.extent&&5>this._getIntersectionPercent(N,this.map.extent)&&this.map.setExtent(N,!0);this._switchBasemapLayers(R);this._updateReferenceLayer(R)})):(this._switchBasemapLayers(R),this._updateReferenceLayer(R))},_checkVTLSupport:function(){var R=new G;x("ie")?R.resolve(!1):
R.resolve(O.supported());return R},_switchBasemapLayers:function(R){var M=R.layers,r=!1,N,W,fa;e.forEach(M,function(Z){"VectorTileLayer"===Z.type&&(r=!0)});if(r&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===M[0].type||M[0].type&&-1<M[0].type.indexOf("BingMaps")||"WebTiledLayer"===M[0].type||"VectorTileLayer"===
M[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{e.forEach(M,function(Z){if(!Z.isReference&&Z.type&&-1<Z.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var ba=0;e.forEach(M,function(Z,ja){if(!Z.isReference){if("OpenStreetMap"===Z.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var ma=new n({id:"layer_osm",opacity:Z.opacity})}else if(Z.type&&-1<Z.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ma=u.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===Z.type?ma=u.MAP_STYLE_AERIAL:"BingMapsRoad"===Z.type&&(ma=u.MAP_STYLE_ROAD);ma=new u({id:"layer_bing",bingMapsKey:this.bingMapsKey,
mapStyle:ma,opacity:Z.opacity})}else if("WebTiledLayer"===Z.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ma=Z.initialExtent||Z.fullExtent;ma=new Q(Z.templateUrl||Z.url,{visible:Z.visibility,opacity:Z.opacity,copyright:Z.copyright,fullExtent:Z.fullExtent&&new k(Z.fullExtent),initialExtent:ma&&new k(ma),subDomains:Z.subDomains,
tileInfo:Z.tileInfo?new P(Z.tileInfo):null,tileServers:Z.tileServers,wmtsInfo:Z.wmtsInfo})}else if("VectorTileLayer"===Z.type){ma=new O(Z.styleUrl,{visible:Z.visibility,opacity:Z.opacity});0===ja&&1<M.length&&this._removeBasemapLayers();var aa=this;b.connect(ma,"onLoad",t.hitch(this,function(ka,oa,ra){var ya=aa._sameSpatialReference(ra.spatialReference,aa.map.spatialReference);if(aa.map.spatialReference&&!ya)aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<aa.map.getNumLevels()){if(ya=aa._sameTilingScheme(ra.tileInfo,aa.map.__tileInfo),!ya){aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(aa.map.loaded){aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===oa&&1===M.length&&aa._removeBasemapLayers();ra._basemapGalleryLayerType="basemap";aa.map.addLayer(ra,
ka)}},ba,ja))}else if(Z.serviceInfoResponse&&Z.serviceInfoResponse.mapName){N=new z(Z.serviceInfoResponse.spatialReference);W=this._sameSpatialReference(N,this.map.spatialReference);if(this.map.spatialReference&&!W){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===Z.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(fa=this._sameTilingScheme(Z.serviceInfoResponse.tileInfo,this.map.__tileInfo),
!fa){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===Z.serviceInfoResponse.singleFusedMapCache&&-1<Z.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ma=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===Z.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(Z):this._loadAsDynamic(Z)}else if(Z.serviceInfoResponse&&Z.serviceInfoResponse.pixelSizeX){N=new z(Z.serviceInfoResponse.spatialReference);W=this._sameSpatialReference(N,this.map.spatialReference);if(this.map.spatialReference&&!W){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===Z.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&
(fa=this._sameTilingScheme(Z.serviceInfoResponse.tileInfo,this.map.__tileInfo),!fa)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}Z.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==Z.type?ma="Raster"===Z.serviceInfoResponse.cacheType?new U(Z.url,{serviceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,bandIds:Z.bandIds&&0<Z.bandIds.length?Z.bandIds:null}):new B(Z.url,{resourceInfo:Z.serviceInfoResponse,
opacity:Z.opacity,visible:Z.visibility}):Z.serviceInfoResponse.pixelSizeX?(ma=new V,ma.bandIds=Z.bandIds,Z.renderingRule?ma.renderingRule=new I(Z.renderingRule):!Z.bandIds&&Z.serviceInfoResponse.bandCount&&3<parseInt(Z.serviceInfoResponse.bandCount,10)&&(ma.bandIds=[0,1,2]),ma=new T(Z.url,{resourceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,imageServiceParameters:ma})):(ma=new X,ma.format="png24",Z.serviceInfoResponse.supportedImageFormatTypes&&-1<Z.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&
(ma.format="png32"),ma=new H(Z.url,{resourceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,imageParameters:ma}))}"VectorTileLayer"===Z.type?ba++:ma&&(0===ja&&this._removeBasemapLayers(),ma._basemapGalleryLayerType="basemap",this.map.addLayer(ma,ba),ba++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var R=this.map.layerIds,M=[];e.forEach(R,function(r){r=this.map.getLayer(r);"basemap"===r._basemapGalleryLayerType&&M.push(r)},
this);0===M.length&&0<R.length&&M.push(this.map.getLayer(R[0]));0<M.length&&e.forEach(M,function(r){this.map.removeLayer(r)},this)},_updateReferenceLayer:function(R){var M;this._removeReferenceLayer();for(M=0;M<R.layers.length;M++)!0===R.layers[M].isReference&&this._addReferenceLayer(R.layers[M])},_removeReferenceLayer:function(){var R;for(R=this.map.layerIds.length-1;0<=R;R--){var M=this.map.getLayer(this.map.layerIds[R]);"reference"===M._basemapGalleryLayerType&&this.map.removeLayer(M)}},_addReferenceLayer:function(R){"VectorTileLayer"===
R.type?this._handleReferenceServiceInfoResponse(R):this._getServiceInfo(R.url,t.hitch(this,"_handleReferenceServiceInfoResponse",R))},_handleReferenceServiceInfoResponse:function(R,M,r){R.serviceInfoResponse=M;if("VectorTileLayer"===R.type)var N=new O(R.styleUrl,{visible:R.visibility,opacity:R.opacity});else M&&M.mapName?N=!0===M.singleFusedMapCache?this._loadAsCached(R):this._loadAsDynamic(R):M&&M.pixelSizeX&&(R.serviceInfoResponse.singleFusedMapCache?N=new B(R.url,{resourceInfo:R.serviceInfoResponse,
opacity:R.opacity,visible:R.visibility}):R.serviceInfoResponse.pixelSizeX?(r=new V,r.bandIds=R.bandIds,R.renderingRule?r.renderingRule=new I(R.renderingRule):!R.bandIds&&M.bandCount&&3<parseInt(M.bandCount,10)&&(r.bandIds=[0,1,2]),N=new T(R.url,{resourceInfo:M,opacity:R.opacity,visible:R.visibility,imageServiceParameters:r})):(M=new X,M.format="png24",R.serviceInfoResponse.supportedImageFormatTypes&&-1<R.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(M.format="png32"),M.transparent=
!0,N=new H(R.url,{resourceInfo:R.serviceInfoResponse,opacity:R.opacity,visible:R.visibility,imageParameters:M})));N&&(N._basemapGalleryLayerType="reference",N.attr("data-reference",!0),this.map.addLayer(N))},_getServiceInfo:function(R,M){return l({url:R,content:{f:"json"},callbackParamName:"callback",load:function(r,N){M&&M(r,N)},error:t.hitch(this,function(r,N){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(R){var M=[];R.displayLevels||(M=e.map(R.serviceInfoResponse.tileInfo.lods,
function(N){return N.level}));var r=null;R.exclusionAreas&&R.exclusionAreas.length&&(r=[],e.forEach(R.exclusionAreas,function(N){r.push({minZoom:N.minZoom,maxZoom:N.maxZoom,minScale:N.minScale,maxScale:N.maxScale,geometry:new k(N.geometry)})}));return new B(R.url,{resourceInfo:R.serviceInfoResponse,opacity:R.opacity,visible:R.visibility,exclusionAreas:r,displayLevels:R.displayLevels||M})},_loadAsDynamic:function(R){var M=new H(R.url,{resourceInfo:R.serviceInfoResponse,opacity:R.opacity,visible:R.visibility});
R.visibleLayers&&M.setVisibleLayers(R.visibleLayers);return M},_getIntersectionPercent:function(R,M){var r=M.intersects(R);if(r){r=r.getWidth()*r.getHeight();var N=M.getWidth()*M.getHeight();return r/N*100}return 0},_getIds:function(){var R=[];e.forEach(this.basemaps,function(M){R.push(M.id)},this);return R},_getUniqueId:function(){for(var R=","+this._getIds().toString()+",",M=0;;)if(-1<R.indexOf(",basemap_"+M+","))M++;else return"basemap_"+M},_isUniqueId:function(R){return-1===(","+this._getIds().toString()+
",").indexOf(","+R+",")?!0:!1},_isAgolService:function(R){return R?-1!==R.indexOf("/services.arcgisonline.com/")||-1!==R.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(R){return R?-1!==R.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(R,M){return R&&M&&R.wkt==M.wkt&&(R.wkid===M.wkid||f.isDefined(R.latestWkid)&&R.latestWkid===M.wkid||f.isDefined(M.latestWkid)&&R.wkid===M.latestWkid||f.isDefined(R.latestWkid)&&R.latestWkid===M.latestWkid)||R&&M&&R.isWebMercator()&&M.isWebMercator()?
!0:!1},_sameTilingScheme:function(R,M){var r=this.map;r=r.width>r.height?r.width:r.height;var N=!1,W=!1,fa,ba;for(fa=0;fa<R.lods.length;fa++){var Z=R.lods[fa].scale;R.dpi!==M.dpi&&(Z=R.lods[fa].scale/R.dpi);for(ba=0;ba<M.lods.length;ba++){var ja=M.lods[ba].scale;R.dpi!==M.dpi&&(ja=M.lods[ba].scale/M.dpi);if(Math.abs(ja-Z)/ja<1/r)if(N){W=!0;break}else N=!0;if(ja<Z)break}if(W)break}return W||N&&(1===R.lods.length||1===M.lods.length)?!0:!1}});t.setObject("dijit.BasemapGallery",w,h);return w})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g){function v(m,h){var f=[];if(m&&h&&(h.customLayerParameters||h.customParameters)){var c=w.clone(h.customParameters||{});w.mixin(c,h.customLayerParameters||{});var l=G.urlToObject(m);for(var k in l.query)c.hasOwnProperty(k)||f.push(k+"\x3d"+l.query[k]);m=l.path+(f.length?"?"+f.join("\x26"):"")}return m}a=a(F,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(m,h){h||(h={});this.urlTemplate=m=v(m,h.wmtsInfo);var f=new A(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new D({wkid:102100})),c=new A(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new D({wkid:102100}));this.initialExtent=h.initialExtent||f;this.fullExtent=h.fullExtent||c;this.tileInfo=h.tileInfo?h.tileInfo:new g({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new D(this.tileInfo.spatialReference.toJson());this.copyright=h.copyright||"";var l=new b(m);f=l.scheme+"://"+l.authority+"/";this.urlPath=m.substring(f.length);this.tileServers=h.tileServers||[];-1===l.authority.indexOf("{subDomain}")&&
this.tileServers.push(f);if(h.subDomains&&0<h.subDomains.length&&1<l.authority.split(".").length){this.subDomains=h.subDomains;var k;e.forEach(h.subDomains,function(B){-1<l.authority.indexOf("${subDomain}")?k=l.scheme+"://"+p.substitute(l.authority,{subDomain:B})+"/":-1<l.authority.indexOf("{subDomain}")&&(k=l.scheme+"://"+l.authority.replace(/\{subDomain\}/gi,B)+"/");this.tileServers.push(k)},this)}this.tileServers=e.map(this.tileServers,function(B){"/"!==B.charAt(B.length-1)&&(B+="/");return B});
this._levelToLevelValue=[];var z=0;e.forEach(this.tileInfo.lods,function(B,H){this._levelToLevelValue[B.level]=B.levelValue||B.level;0===H&&(z=this._levelToLevelValue[B.level])},this);this._wmtsInfo=h.wmtsInfo;var u=w.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(t("chrome")){f=this.getTileUrl(z,0,0);c=x.defaults.io;var n="with-credentials"===c.useCors?G.canUseXhr(f,!0):-1;(c=-1<n?c.corsEnabledServers[n]:null)&&c.withCredentials?J({url:f,handleAs:"arraybuffer"}).addBoth(function(){u()}):
u()}else u()},getTileUrl:function(m,h,f){m=this._levelToLevelValue[m];var c=this.tileServers[h%this.tileServers.length]+p.substitute(this.urlPath,{level:m,z:m,col:f,x:f,row:h,y:h});c=c.replace(/\{level\}/gi,m).replace(/\{row\}/gi,h).replace(/\{col\}/gi,f).replace(/\{z\}/gi,m).replace(/\{x\}/gi,f).replace(/\{y\}/gi,h);c=this._appendCustomLayerParameters(c);c=this.addTimestampToURL(c);return G.addProxy(c)},_appendCustomLayerParameters:function(m){var h;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var f=w.clone(this._wmtsInfo.customParameters||{});w.mixin(f,this._wmtsInfo.customLayerParameters||{});for(h in f)m+=(-1===m.indexOf("?")?"?":"\x26")+h+"\x3d"+encodeURIComponent(f[h])}return m}});w.setObject("layers.WebTiledLayer",a,y);return a})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.dijit.Basemap",id:null,
title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(y,J){y=y||{};this.id=y.id;this.itemId=y.itemId;this.layers=y.layers;this.title=y.title||"";this.thumbnailUrl=y.thumbnailUrl;this.basemapGallery=J},getLayers:function(y){if(this.layers)return this.layers;if(this.itemId)return y=p({url:(y||t.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:e.hitch(this,function(J,G){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),
y.addCallback(e.hitch(this,function(J,G){if(J.baseMap)return this.layers=[],w.forEach(J.baseMap.baseMapLayers,function(D){this.layers.push(new x(D))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");return[]})),y}});e.setObject("dijit.Basemap",a,t);return a})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(a,w,e,b){a=a(null,{declaredClass:"esri.dijit.BasemapLayer",
constructor:function(t){t=t||{};this.url=t.url;this.type=t.type;this.isReference=!0===t.isReference?!0:!1;this.opacity=t.opacity;this.visibleLayers=t.visibleLayers;this.displayLevels=t.displayLevels;this.exclusionAreas=t.exclusionAreas;this.bandIds=t.bandIds;this.renderingRule=t.renderingRule;this.templateUrl=t.templateUrl;this.copyright=t.copyright;this.subDomains=t.subDomains;this.fullExtent=t.fullExtent;this.initialExtent=t.initialExtent;this.tileInfo=t.tileInfo;this.tileServers=t.tileServers;
this.styleUrl=t.styleUrl}});w.setObject("dijit.BasemapLayer",a,b);return a})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g){a=w("esri.dijit.HomeButton",[p,y,a],{templateString:D,options:{theme:"HomeButton",map:null,extent:null,
fit:!1,visible:!0},constructor:function(v,m){var h=e.mixin({},this.options,v);this.domNode=m;this._i18n=A;this.set("map",h.map);this.set("theme",h.theme);this.set("visible",h.visible);this.set("extent",h.extent);this.set("fit",h.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",loading:"loading"}},postCreate:function(){this.inherited(arguments);this.own(J(this._homeNode,x,e.hitch(this,this.home)))},startup:function(){this.inherited(arguments);
this.map||this.destroy();if(this.map.loaded)this._init();else J.once(this.map,"load",e.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var v=new G,m=this.get("extent");this._showLoading();var h={extent:m};m?this.map.extent!==m?this.map.setExtent(m,this.get("fit")).then(e.hitch(this,function(){this._hideLoading();this.emit("home",h);v.resolve(h)}),e.hitch(this,function(f){f||(f=Error("HomeButton::Error setting map extent"));h.error=f;this.emit("home",
h);v.reject(f)})):(this._hideLoading(),this.emit("home",h),v.resolve(h)):(this._hideLoading(),m=Error("HomeButton::home extent is undefined"),h.error=m,this.emit("home",h),v.reject(m));return v.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||this.set("extent",this.map.extent);this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){F.add(this._homeNode,this._css.loading)},_hideLoading:function(){F.remove(this._homeNode,
this._css.loading)},_updateThemeWatch:function(v,m,h){F.remove(this.domNode,m);F.add(this.domNode,h)},_visible:function(){this.get("visible")?g.set(this.domNode,"display","block"):g.set(this.domNode,"display","none")}});e.setObject("dijit.HomeButton",a,t);return a})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u){a=e("esri.dijit.LocateButton",[y,G,w],{templateString:F,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new z(a.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(n,B){var H=b.mixin({},this.options,n);this.domNode=
B;this._i18n=g;var Q=navigator.geolocation,O=window.hasOwnProperty("isSecureContext");(O&&window.isSecureContext||!O&&"https:"===window.location.protocol)&&Q||(H.visible=!1);this.set("map",H.map);this.set("theme",H.theme);this.set("visible",H.visible);this.set("scale",H.scale);this.set("highlightLocation",H.highlightLocation);this.set("symbol",H.symbol);this.set("infoTemplate",H.infoTemplate);this.set("geolocationOptions",H.geolocationOptions);this.set("useTracking",H.useTracking);this.set("setScale",
H.setScale);this.set("centerAt",H.centerAt);this.set("timeout",H.timeout);this.set("graphicsLayer",H.graphicsLayer);this.set("clearOnTrackingStop",H.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",b.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(D(this._locateNode,J,b.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else D.once(this.get("map"),"load",b.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var n=this.get("highlightGraphic"),
B=this.get("graphicsLayer");n&&(B?B.remove(n):this.get("map").graphics.remove(n),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?h.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):h.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
h.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){v.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(n){return n?{coords:b.mixin({},n.coords),timestamp:n.timestamp}:{}},_startTracking:function(){v.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var n=navigator.geolocation.watchPosition(b.hitch(this,function(B){B=this._positionToObject(B);this._setPosition(B).then(b.hitch(this,function(H){this._locateEvent(H)}),b.hitch(this,function(H){H||(H=Error("LocateButton::Error setting the position."));this._locateError(H)}))}),b.hitch(this,function(B){this.set("tracking",!1);B||(B=Error("LocateButton::Could not get tracking position."));this._locateError(B)}),this.get("geolocationOptions"));this.set("watchId",
n)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var n=new A;this._removePrivateVars();var B=setTimeout(b.hitch(this,function(){clearTimeout(B);n.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(b.hitch(this,function(H){H=this._positionToObject(H);clearTimeout(B);this._setPosition(H).then(b.hitch(this,function(Q){n.resolve(Q)}),b.hitch(this,function(Q){Q||
(Q=Error("LocateButton::Error setting map position."));n.reject(Q)}))}),b.hitch(this,function(H){H||(H=Error("LocateButton::Could not get current position."));n.reject(H)}),this.get("geolocationOptions"));return n.promise},_locate:function(){var n=new A;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),n.resolve({tracking:!0})):(this._stopTracking(),n.resolve({tracking:!1})):this._getCurrentPosition().then(b.hitch(this,function(H){this._locateEvent(H);
n.resolve(H)}),b.hitch(this,function(H){H||(H=Error("LocateButton::Could not get current position."));this._locateError(H);n.reject(H)}));else{var B=Error("LocateButton::geolocation unsupported");this._locateError(B);n.reject(B)}this._setTitle();return n.promise},_projectPoint:function(n){var B=new A,H=this.get("map").spatialReference,Q=H.wkid;H.isWebMercator()?(n=f.geographicToWebMercator(n),B.resolve(n)):x.defaults.geometryService&&4326!==Q?(Q=new u,Q.geometries=[n],Q.outSR=H,x.defaults.geometryService.project(Q).then(b.hitch(this,
function(O){O&&O.length?B.resolve(O[0]):B.reject(Error("LocateButton::Point was not projected."))}),function(O){O||(O=Error("LocateButton::please specify a geometry service on esri/config to project."));B.reject(O)})):B.resolve(n);return B.promise},_getScale:function(n){var B=this.get("scale");return n&&n.coords?B||n.coords.accuracy||5E4:B||5E4},_createPoint:function(n){var B;n&&n.coords&&(B=new c([n.coords.longitude,n.coords.latitude],new l({wkid:4326})));return B},_setPosition:function(n){var B=
new A,H,Q;this._removePrivateVars();if((this._position=n)&&n.coords){if(H=this._createPoint(n))this._graphic=Q=this._createGraphic(H,n);var O=this._getScale(n);this._scale=O;H?this._projectPoint(H).then(b.hitch(this,function(P){this._graphic=Q=this._createGraphic(P,n);var T={graphic:Q,scale:O,position:n};this.get("setScale")&&this.get("map").setScale(O);this.get("centerAt")?this.get("map").centerAt(P).then(b.hitch(this,function(){B.resolve(T)}),b.hitch(this,function(V){V||(V=Error("LocateButton::Could not center map."));
B.reject(V)})):B.resolve(T)}),b.hitch(this,function(P){P||(P=Error("LocateButton::Error projecting point."));B.reject(P)})):(H=Error("LocateButton::Invalid point"),B.reject(H))}else H=Error("LocateButton::Invalid position"),B.reject(H);return B.promise},_createGraphic:function(n,B){if(n){var H={position:B};H=new k(n,this.get("symbol"),H,this.get("infoTemplate"))}return H},_locateEvent:function(n){if(n.graphic){var B=this.get("highlightGraphic"),H=this.get("graphicsLayer");B?(B.setGeometry(n.graphic.geometry),
B.setAttributes(n.graphic.attributes),B.setInfoTemplate(n.graphic.infoTemplate),B.setSymbol(n.graphic.symbol)):(B=n.graphic,this.get("highlightLocation")&&(H?H.add(B):this.get("map").graphics.add(B)));this.set("highlightGraphic",B)}this._hideLoading();this.emit("locate",n)},_locateError:function(n){n={graphic:this._graphic,scale:this._scale,position:this._position,error:n};this._hideLoading();this.emit("locate",n)},_showLoading:function(){this.get("useTracking")||v.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||v.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(n,B,H){v.remove(this.domNode,B);v.add(this.domNode,H)},_visible:function(){this.get("visible")?m.set(this.domNode,"display","block"):m.set(this.domNode,"display","none")}});b.setObject("dijit.LocateButton",a,p);return a})},
"esri/layers/graphics":function(){define(["./GraphicsLayer","../graphic","../renderer"],function(){return{}})},"esri/renderer":function(){define("./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/ClassBreaksRenderer ./renderers/TemporalRenderer ./renderers/SymbolAger ./renderers/TimeClassBreaksAger ./renderers/TimeRampAger ./renderers/StretchRenderer ./renderers/jsonUtils".split(" "),function(a,w,e,b,t,p,x,y,J,G){return{Renderer:a,SimpleRenderer:w,UniqueValueRenderer:e,
ClassBreaksRenderer:b,TemporalRenderer:t,SymbolAger:p,TimeClassBreaksAger:x,TimeRampAger:y,StretchRenderer:J,jsonUtils:G}})},"esri/layers/agstiled":function(){define(["./agscommon","./ArcGISTiledMapServiceLayer"],function(){return{}})},"esri/layers/agsdynamic":function(){define(["./agscommon","./ArcGISDynamicMapServiceLayer","../_time"],function(){return{}})},"esri/_time":function(){define(["./TimeExtent"],function(){return{}})},"esri/layers/agsimageservice":function(){define("./agscommon ./ArcGISImageServiceLayer ./ImageServiceParameters ./MosaicRule ./RasterFunction ../utils".split(" "),
function(){return{}})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u){var n=
w([c],{declaredClass:"esri.layers.KMLLayer",serviceUrl:v.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(B,H){this._url=v.urlToObject(this.url=B);this._outSR=H&&H.outSR||new m({wkid:4326});this._options=b.mixin({},H);A.defaults.kmlService&&(this.serviceUrl=A.defaults.kmlService);var Q=this.linkInfo=H&&H.linkInfo;Q&&(this.visible=!!Q.visibility,this._waitingForMap=!!Q.viewFormat);(!Q||Q&&Q.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=b.hitch(this,
this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(B){if(B){var H=B.type,Q=B.id,O;switch(H){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(B=this["_"+H])&&(O=b.getObject("_mode._featureMap."+Q,!1,B));break;case "GroundOverlay":if(B=this._groundLyr){var P=B.getImages();H=P.length;for(B=0;B<H;B++)if(P[B].id===Q){O=P[B];break}}break;case "NetworkLink":t.some(this._links,function(T){return T.linkInfo&&T.linkInfo.id===Q?(O=T,!0):!1});
break;case "Folder":for(H=(P=this.folders)?P.length:0,B=0;B<H;B++)if(P[B].id===Q){O=P[B];break}}return O}},getLayers:function(){var B=[];this._groundLyr&&B.push(this._groundLyr);this._fLayers&&(B=B.concat(this._fLayers));this._links&&t.forEach(this._links,function(H){H.declaredClass&&B.push(H)});return B},setFolderVisibility:function(B,H){B&&(this._fireUpdateStart(),(B.visible=H)&&(H=this._areLocalAncestorsVisible(B)),this._setState(B,H),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},
onRefresh:function(){},onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(B){var H=this;this._fireUpdateStart();this._io=g({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(B),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:p.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(Q){H._io=null;H._initLayer(Q)},error:function(Q){H._io=null;Q=b.mixin(Error(),Q);Q.message="Unable to load KML: "+(Q.message||"");H._fireUpdateEnd(Q);
H._errorHandler(Q)}})},_initLayer:function(B){if(this.loaded){var H=[];t.forEach(this.folders,function(I){I.visible&&H.push(I.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=B.name;this.description=B.description;this.snippet=B.snippet;this.visibility=B.visibility;this.featureInfos=B.featureInfos;var Q,O=this.folders=B.folders,P=[];if(O){var T=O.length;for(Q=0;Q<T;Q++){var V=O[Q]=new l(O[Q]);-1===
V.parentFolderId&&P.push(V)}}O=this._links=B.networkLinks;T=O?O.length:0;for(Q=0;Q<T;Q++)if(!O[Q].viewRefreshMode||-1===O[Q].viewRefreshMode.toLowerCase().indexOf("onregion")){var X=b.mixin({},this._options);X.linkInfo=O[Q];X.id&&(X.id=X.id+"_"+Q);V=O[Q]=new n(O[Q].href,X);V._parentLayer=this;V._parentFolderId=this._getLinkParentId(V.linkInfo.id);V._linkErrorHandle=V.on("error,network-link-error",b.hitch(V,function(I){this._parentLayer.onNetworkLinkError(I.error)}))}if((O=B.groundOverlays)&&0<O.length)for(X=
b.mixin({},this._options),X.id&&(X.id+="_mapImage"),V=this._groundLyr=new z(X),T=O.length,Q=0;Q<T;Q++)V.addImage(new k(O[Q]));(B=b.getObject("featureCollection.layers",!1,B))&&0<B.length&&(this._fLayers=[],t.forEach(B,function(I,U){var E=b.getObject("featureSet.features",!1,I);E&&0<E.length&&(X=b.mixin({outFields:["*"],infoTemplate:I.popupInfo?new f(I.popupInfo):null,editable:!1},this._options),X.id&&(X.id=X.id+"_"+U),X.webgl=!1,I.layerDefinition.capabilities="Query,Data",E=new u(I,X),E.geometryType&&
(this["_"+E.geometryType]=E),this._fLayers.push(E))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(T=P.length,Q=0;Q<T;Q++)V=P[Q],this._setState(V,V.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),t.forEach(this.folders,function(I){-1<t.indexOf(H,I.id)?this.setFolderVisibility(I,!0):this.setFolderVisibility(I,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var B=this._map;this._fireUpdateStart();this._links&&
t.forEach(this._links,function(P){P.declaredClass&&(B.addLayer(P),P._waitingForMap&&(P._waitingForMap=null,P.visible?P._parseKml(B):P._wMap=B))});var H=B.spatialReference,Q=this._outSR;if(!H.equals(Q))if(H.isWebMercator()&&4326===Q.wkid)var O=h.geographicToWebMercator;else if(Q.isWebMercator()&&4326===H.wkid)O=h.webMercatorToGeographic;else return;this._groundLyr&&(O&&t.forEach(this._groundLyr.getImages(),function(P){P.extent=O(P.extent)}),B.addLayer(this._groundLyr));(H=this._fLayers)&&0<H.length&&
t.forEach(H,function(P){if(O){var T=P.graphics,V,X,I=T?T.length:0;for(V=0;V<I;V++)(X=T[V].geometry)&&T[V].setGeometry(O(X))}B.addLayer(P)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var B=this._map;this._links&&t.forEach(this._links,function(H){H.declaredClass&&H._io&&H._io.cancel();H._linkErrorHandle&&(H._linkErrorHandle.remove(),H._linkErrorHandle=null)});B&&t.forEach(this.getLayers(),B.removeLayer,B)},_setState:function(B,H){var Q=B.featureInfos,O,P,T=Q?Q.length:0,
V=H?"show":"hide",X=H?"_resume":"_suspend";for(P=0;P<T;P++){var I=Q[P];if(O=this.getFeature(I))if("Folder"===I.type)this._setState(O,H&&O.visible);else if("NetworkLink"===I.type)this._setInternalVisibility(O,H);else if(O[X])O[X]();else O[V]()}},_areLocalAncestorsVisible:function(B){var H=B.parentFolderId;for(B=B.visible;B&&-1!==H;)H=this.getFeature({type:"Folder",id:H}),B=B&&H.visible,H=H.parentFolderId;return B},_setInternalVisibility:function(B,H){var Q=B._parentLayer,O=B._parentFolderId;for(H=
H&&B.visible;H&&Q;)H=H&&Q.visible,-1<O&&(H=H&&Q._areLocalAncestorsVisible(Q.getFeature({type:"Folder",id:O}))),O=Q._parentFolderId,Q=Q._parentLayer;this._setIntState(B,H)},_setIntState:function(B,H){B&&t.forEach(B.getLayers(),function(Q){Q.linkInfo?B._setIntState(Q,H&&Q.visible&&B._areLocalAncestorsVisible(B.getFeature({type:"Folder",id:Q._parentFolderId}))):Q.setVisibility(H)})},_getLinkParentId:function(B){var H=-1;this.folders&&t.some(this.folders,function(Q){return Q.networkLinkIds&&-1!==t.indexOf(Q.networkLinkIds,
B)?(H=Q.id,!0):!1});return H},_checkAutoRefresh:function(){var B=this.linkInfo;if(B)if(this.visible){if(this.loaded&&this._map){var H=B.refreshMode,Q=B.refreshInterval,O=B.viewRefreshMode;B=B.viewRefreshTime;H&&-1!==H.toLowerCase().indexOf("oninterval")&&0<Q&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*Q));O&&-1!==O.toLowerCase().indexOf("onstop")&&0<B&&!this._extChgHandle&&(this._extChgHandle=e.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),
e.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(B){B=B||this._map;var H={},Q=this.linkInfo,O=B&&B.extent;if(this._url.query){b.mixin(H,this._url.query);var P=!!this._url.query.token}D.id&&!P&&(P=D.id.findCredential(this._url.path))&&(H.token=P.token);if(Q){P=Q.viewFormat;var T=Q.httpQuery;Q=Q.viewBoundScale;if(O&&P){var V=O,X=O,I=O.spatialReference;I&&(I.isWebMercator()?
V=h.webMercatorToGeographic(O):4326===I.wkid&&(X=h.geographicToWebMercator(O)));O=V.getCenter();X=Math.max(X.getWidth(),X.getHeight());Q&&(V=V.expand(Q));P=P.replace(/\[bboxWest\]/ig,V.xmin).replace(/\[bboxEast\]/ig,V.xmax).replace(/\[bboxSouth\]/ig,V.ymin).replace(/\[bboxNorth\]/ig,V.ymax).replace(/\[lookatLon\]/ig,O.x).replace(/\[lookatLat\]/ig,O.y).replace(/\[lookatRange\]/ig,X).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,O.x).replace(/\[lookatTerrainLat\]/ig,
O.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,O.x).replace(/\[cameraLat\]/ig,O.y).replace(/\[cameraAlt\]/ig,X).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,B.width).replace(/\[vertPixels\]/ig,B.height).replace(/\[terrainEnabled\]/ig,0);b.mixin(H,y.queryToObject(P))}T&&(T=T.replace(/\[clientVersion\]/ig,D.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,a.locale),b.mixin(H,
y.queryToObject(T)))}B=[];for(var U in H)F.isDefined(H[U])&&B.push(U+"\x3d"+H[U]);return(B=B.join("\x26"))?"?"+B:""},setScaleRange:function(B,H){this.inherited(arguments);t.forEach(this.getLayers(),function(Q){Q.setScaleRange(B,H)})},setOpacity:function(B){this.opacity!=B&&(t.forEach(this.getLayers(),function(H){H.setOpacity(B)}),this.opacity=B,this.onOpacityChange(B))},_setMap:function(B,H){this.inherited(arguments);this._map=B;var Q=this._div=J.create("div",null,H);G.set(Q,"position","absolute");
this._addInternalLayers();this.evaluateSuspension();return Q},_unsetMap:function(B,H){this._io&&this._io.cancel();this._stopAutoRefresh();e.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var Q=this._div;Q&&(H.removeChild(Q),J.destroy(Q));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(B){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,B),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&B&&(this._waitingForMap||
this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(B){var H,Q=[];(B=this.getFeature({type:"Folder",id:B}))&&(H=t.map(B.featureInfos,function(O){if("esriGeometryPoint"===O.type||"esriGeometryPolyline"===O.type||"esriGeometryPolygon"===O.type)return O.id},this))&&0<H.length&&t.forEach(this._fLayers,function(O){var P;var T=O.toJson();T.featureSet.features&&0<T.featureSet.features.length&&(P=t.filter(T.featureSet.features,
function(V){if(-1!==t.indexOf(H,V.attributes[O.objectIdField]))return V},this));P&&0<P.length&&(T.featureSet.features=P,Q.push(T))},this);return Q},getFeatureCount:function(B){B=this.getFeature({type:"Folder",id:B});var H={points:0,polylines:0,polygons:0};B&&t.forEach(B.featureInfos,function(Q){"esriGeometryPoint"===Q.type&&(H.points+=1);"esriGeometryPolyline"===Q.type&&(H.polylines+=1);"esriGeometryPolygon"===Q.type&&(H.polygons+=1)});return H},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=
setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});b.setObject("layers.KMLLayer",n,D);return n})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(a,w,e,b,t){a=a(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(p){w.mixin(this,p);t.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});w.setObject("layers.KMLFolder",a,b);return a})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(a,w,e,b,t,p){a=a([p],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(x){t.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});w.setObject("layers.KMLGroundOverlay",a,b);return a})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],function(){return{}})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v){a=a(null,{declaredClass:"esri.SnappingManager",constructor:function(m){m=m||{};this.map=m.map;this.tolerance=m.tolerance||15;this.layerInfos=[];if(m.layerInfos)this.layerInfos=m.layerInfos;else{var h;for(h=0;h<this.map.graphicsLayerIds.length;h++){var f=this.map.getLayer(this.map.graphicsLayerIds[h]);this.layerInfos.push({layer:f})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var c=w.connect(this.map,"onLoad",this,function(l){w.disconnect(c);
c=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=m.snapPointSymbol?m.snapPointSymbol:new F(F.STYLE_CROSS,15,new g(g.STYLE_SOLID,new t([0,255,255]),1),new t([0,255,0,0]));this.alwaysSnap=m.alwaysSnap?m.alwaysSnap:!1;this.snapKey=m.snapKey?m.snapKey:x("mac")?y.META:y.CTRL;this._SelectionLyrQuery=new v;this._SelectionLyrQuery.spatialRelationship=v.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new G;this.setLayerInfos(this.layerInfos);this._currentGraphicOption=
{snapToPoint:!0,snapToVertex:!0,snapToLastVertex:!0,snapToEdge:!0};this._snappingCallback=e.hitch(this,this._snappingCallback)},getSnappingPoint:function(m){var h=this.layers,f=this.tolerance,c=this.map,l=this.layerOptions,k=c.toMap(m.offset(-f,f));f=c.toMap(m.offset(f,-f));k=new A(k.x,k.y,f.x,f.y,c.spatialReference);var z=new v;z.geometry=k;z.spatialRelationship=v.SPATIAL_REL_INTERSECTS;var u=[],n=[],B=this._extractPointsAndLines,H=new p,Q=0,O;f=k.xmin;var P=k.xmax;b.forEach(h,function(U,E){U.visible&&
U.loaded&&"esri.layers.FeatureLayer"===U.declaredClass&&U.mode!==U.constructor.MODE_SELECTION&&Q++});c.spatialReference._isWrappable()&&(f=A.prototype._normalizeX(k.xmin,c.spatialReference._getInfo()).x,P=A.prototype._normalizeX(k.xmax,c.spatialReference._getInfo()).x);var T=new A(f,k.ymin,P,k.ymax,c.spatialReference);b.forEach(h,function(U,E){if("esri.layers.GraphicsLayer"===U.declaredClass&&U.visible){var L=[];b.forEach(U.graphics,function(R){R&&R.visible&&T.intersects(R.geometry)&&L.push(R)});
var da=B(L,l[E]);u=u.concat(da[0]);n=n.concat(da[1])}});var V=e.hitch(this,function(U){Q--;U instanceof Error||(U=B(U.features,l[O]),u=u.concat(U[0]),n=n.concat(U[1]));Q||(I=this._getSnappingPoint(u,n,m),H.callback(I))}),X=!1;b.forEach(h,function(U,E){U.visible&&U.loaded&&(O=E,"esri.layers.FeatureLayer"===U.declaredClass&&U.mode!==U.constructor.MODE_SELECTION&&(X=!0,U.queryFeatures(z,V,V)))});if(!X){var I=this._getSnappingPoint(u,n,m);H.callback(I)}return H},setLayerInfos:function(m){this.layers=
[];this.layerOptions=[];var h;for(h=0;h<m.length;h++)this.layers.push(m[h].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===m[h].snapToPoint&&(this.layerOptions[h].snapToPoint=m[h].snapToPoint),!1===m[h].snapToVertex&&(this.layerOptions[h].snapToVertex=m[h].snapToVertex),!1===m[h].snapToEdge&&(this.layerOptions[h].snapToEdge=m[h].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=
[];b.forEach(this.layers,function(f,c){"esri.layers.FeatureLayer"===f.declaredClass&&f.mode===f.constructor.MODE_SELECTION&&(this._selectionLayers.push(f),this._selectionLayerOptions.push(this.layerOptions[c]))},this);this.layerInfos=m},destroy:function(){w.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){w.disconnect(this._onExtentChangeConnect);
this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=w.connect(this.map,"onExtentChange",e.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){w.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(m,h,f){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var c;this._SelectionLyrQuery.geometry=f;var l=e.hitch(this,
function(k){k instanceof Error||(k=this._extractPointsAndLines(k.features,h[c]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(k[0]),this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(k[1]))});b.forEach(m,function(k,z){k.visible&&k.loaded&&(c=z,k.queryFeatures(this._SelectionLyrQuery,l,l))},this)},_extractPointsAndLines:function(m,h){var f=h&&!1===h.snapToLastVertex?!1:!0,c=[],l=[],k,z;b.forEach(m,function(u,n){if((!u._graphicsLayer||u.visible)&&
u.geometry&&u._isSnapTarget)if("point"===u.geometry.type&&h.snapToPoint)c.push(u.geometry);else if("polyline"===u.geometry.type)for(k=0;k<u.geometry.paths.length;k++){l.push("lineStart");var B=u.geometry.paths[k].length;for(z=0;z<B;z++)if(f||z!==B-1){var H=u.geometry.getPoint(k,z);h.snapToVertex&&c.push(H);h.snapToEdge&&l.push(H)}l.push("lineEnd")}else if("polygon"===u.geometry.type)for(k=0;k<u.geometry.rings.length;k++){l.push("lineStart");B=u.geometry.rings[k].length;for(z=0;z<B;z++)if(f||z!==B-
1)H=u.geometry.getPoint(k,z),h.snapToVertex&&c.push(H),h.snapToEdge&&l.push(H);l.push("lineEnd")}});return[c,l]},_getSnappingPoint:function(m,h,f){var c,l=this.tolerance,k=this.map,z=this.map._getFrameWidth();m=m.concat(this._featurePtsFromSelectionLayer);h=h.concat(this._featureLinesFromSelectionLayer);if(this._currentGraphic){var u=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);m=m.concat(u[0]);h=h.concat(u[1])}var n,B;b.forEach(m,function(M,r){var N=k.toScreen(M,
!0);if(-1!==z&&(N.x%=z,0>N.x&&(N.x+=z),k.width>z))for(var W=(k.width-z)/2;N.x<W;)N.x+=z;c=Math.sqrt((N.x-f.x)*(N.x-f.x)+(N.y-f.y)*(N.y-f.y));c<=l&&(l=c,n=N.x,B=N.y)});if(n){h=new D(n,B);var H=h=k.toMap(h)}else{l=this.tolerance;for(m=0;m<h.length;m++)if("lineStart"===h[m])for(u=m+1;u<h.length;u++){if("lineEnd"!==h[u+1]&&"lineStart"!==h[u+1]&&"lineEnd"!==h[u]&&"lineStart"!==h[u]){var Q=k.toScreen(h[u],!0),O=k.toScreen(h[u+1],!0),P=Q.x>=O.x?Q:O,T=Q.x>=O.x?O:Q;-1!==z&&(P.x%=z,0>P.x&&(P.x+=z),T.x%=z,0>
T.x&&(T.x+=z),T.x>P.x&&(T.x-=z));Q=P.x;P=P.y;O=T.x;T=T.y;var V;if(Q===O){var X=Q;var I=f.y;var U=V=Q;var E=P<=T?P:T;var L=P<=T?T:P}else P===T?(X=f.x,I=P,U=Q<=O?Q:O,V=Q<=O?O:Q,E=L=P):(I=(T-P)/(O-Q),U=(P*O-Q*T)/(O-Q),X=(U-(f.y*T-f.y*P-f.x*Q+f.x*O)/(T-P))/((Q-O)/(T-P)-I),I=I*X+U,U=Q<=O?Q:O,V=Q<=O?O:Q,E=P<=T?P:T,L=P<=T?T:P);if(X>=U&&X<=V&&I>=E&&I<=L){if(Q=Math.sqrt((f.x-X)*(f.x-X)+(f.y-I)*(f.y-I)),Q<=l){l=Q;var da=X;var R=I}}else X=Math.sqrt((Q-f.x)*(Q-f.x)+(P-f.y)*(P-f.y)),I=Math.sqrt((O-f.x)*(O-f.x)+
(T-f.y)*(T-f.y)),X<=I?(U=X,X=Q,I=P):(U=I,X=O,I=T),U<=l&&(l=U,da=X,R=I)}if("lineEnd"===h[u]){m=u;break}}da&&(h=new D(da,R),H=h=k.toMap(h))}return H},_setGraphic:function(m,h){this._currentGraphic=m;this._currentGraphicOption.snapToLastVertex=h&&!1===h.snapToLastVertex?!1:!0},_addSnappingPointGraphic:function(){var m=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);m.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var m=this.map;this._onSnapKeyDown_connect=w.connect(m,"onKeyDown",
this,"_onSnapKeyDownHandler");this._onSnapKeyUp_connect=w.connect(m,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=w.connect(m,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=w.connect(m,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){w.disconnect(this._onSnapKeyDown_connect);w.disconnect(this._onSnapKeyUp_connect);w.disconnect(this._onSnappingMouseMove_connect);w.disconnect(this._onSnappingMouseDrag_connect);
this._deactivateSnapping()},_onSnapKeyDownHandler:function(m){m.keyCode===this.snapKey&&(w.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(m){m.keyCode===this.snapKey&&(this._onSnapKeyDown_connect=w.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),
this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(m){this._currentLocation=m;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(m.screenPoint).addCallback(this._snappingCallback))},_snappingCallback:function(m){if(this._snappingPoint=
m)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(m)}});return J.SnappingManager=a})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(a,w,e,b,t,p){a=a(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var x=e.map(this.polylines,function(J){return J.toJson()}),y={};y.polylines=b.toJson(x);y.trimExtendTo=b.toJson(this.trimExtendTo.toJson());y.sr=b.toJson(this.polylines[0].spatialReference.toJson());y.extendHow=this.extendHow||0;return y}});w.mixin(a,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,
NO_EXTEND_AT_TO:16});w.setObject("tasks.TrimExtendParameters",a,p);return a})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(a,w,e,b,t,p,x,y){a=a(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var J={unit:this.unit,
unionResults:this.unionResults,geodesic:this.geodesic},G=this.distances,D=this.outSpatialReference,A=this.bufferSpatialReference,F=e.map(this.geometries,function(m){m="extent"===m.type?x.fromExtent(m):m;return m.toJson()},this),g=this.geometries;if(g&&0<g.length){var v="extent"===g[0].type?"esriGeometryPolygon":y.getJsonType(g[0]);J.geometries=b.toJson({geometryType:v,geometries:F});J.inSR=g[0].spatialReference.wkid?g[0].spatialReference.wkid:b.toJson(g[0].spatialReference.toJson())}G&&(J.distances=
G.join(","));D&&(J.outSR=D.wkid?D.wkid:b.toJson(D.toJson()));A&&(J.bufferSR=A.wkid?A.wkid:b.toJson(A.toJson()));return J}});w.setObject("tasks.BufferParameters",a,p);return a})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var y=
e.map(this.geometries1,function(A){return A.toJson()}),J=e.map(this.geometries2,function(A){return A.toJson()}),G={},D=this.geometries1;D&&0<D.length&&(G.geometries1=b.toJson({geometryType:x.getJsonType(D[0]),geometries:y}),y=this.geometries1[0].spatialReference,G.sr=y.wkid?y.wkid:b.toJson(y.toJson()));(y=this.geometries2)&&0<y.length&&(G.geometries2=b.toJson({geometryType:x.getJsonType(y[0]),geometries:J}));this.relation&&(G.relation=this.relation);this.relationParam&&(G.relationParam=this.relationParam);
return G}});w.mixin(a,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",
SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});w.setObject("tasks.RelationParameters",a,p);return a})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,
toJson:function(){var y=e.map(this.geometries,function(G){return G.toJson()}),J={};this.geometries&&0<this.geometries.length&&(J.geometries=b.toJson({geometryType:x.getJsonType(this.geometries[0]),geometries:y}),J.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(J.geodesic=this.geodesic);this.lengthUnit&&(J.lengthUnit=this.lengthUnit);this.maxSegmentLength&&(J.maxSegmentLength=this.maxSegmentLength);return J}});w.setObject("tasks.DensifyParameters",a,p);return a})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var y=e.map(this.geometries,function(G){return G.toJson()}),J={};this.geometries&&0<this.geometries.length&&(J.geometries=b.toJson({geometryType:x.getJsonType(this.geometries[0]),geometries:y}),J.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(J.deviationUnit=this.deviationUnit);this.maxDeviation&&(J.maxDeviation=this.maxDeviation);
return J}});w.setObject("tasks.GeneralizeParameters",a,p);return a})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var y=e.map(this.geometries,function(G){return G.toJson()}),J={};this.geometries&&
0<this.geometries.length&&(J.geometries=b.toJson({geometryType:x.getJsonType(this.geometries[0]),geometries:y}),J.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(J.bevelRatio=this.bevelRatio);this.offsetDistance&&(J.offsetDistance=this.offsetDistance);this.offsetHow&&(J.offsetHow=this.offsetHow);this.offsetUnit&&(J.offsetUnit=this.offsetUnit);return J}});w.mixin(a,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});
w.setObject("tasks.OffsetParameters",a,p);return a})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(a,w,e,b,t,p){a=a(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var x={},y=this.geometry1;y&&(x.geometry1=e.toJson({geometryType:p.getJsonType(y),geometry:y}));if(y=this.geometry2)x.geometry2=e.toJson({geometryType:p.getJsonType(y),
geometry:y});x.sr=e.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(x.distanceUnit=this.distanceUnit);this.geodesic&&(x.geodesic=this.geodesic);return x}});w.setObject("tasks.DistanceParameters",a,t);return a})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),
function(a,w,e,b,t,p,x,y,J){a=a(y,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(G,D){this._url.path+="/identify";this._handler=w.hitch(this,this._handler);this.gdbVersion=D&&D.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(G,D,A,F,g){try{var v=[];e.forEach(G.results,function(m,h){v[h]=new J(m)});this._successHandler([v],"onComplete",A,g)}catch(m){this._errorHandler(m,F,g)}},execute:function(G,
D,A,F){var g=F.assembly;G=this._encode(w.mixin({},this._url.query,{f:"json"},G.toJson(g&&g[0])));var v=this._handler,m=this._errorHandler;this.gdbVersion&&(G.gdbVersion=this.gdbVersion);return p({url:this._url.path,content:G,callbackParamName:"callback",load:function(h,f){v(h,f,D,A,F.dfd)},error:function(h){m(h,A,F.dfd)}})},onComplete:function(){}});x._createWrappers(a);w.setObject("tasks.IdentifyTask",a,t);return a})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(a,w,e,b,t,p){a=a(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(x){w.mixin(this,x);this.feature=new t(x.geometry?p.fromJson(x.geometry):null,null,x.attributes);delete this.geometry;delete this.attributes}});w.setObject("tasks.IdentifyResult",a,b);return a})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(a,
w,e,b,t,p,x,y,J){var G=a(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=G.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(D){var A=D&&D.geometry||this.geometry,F=this.mapExtent,g=this.spatialReference,v=this.layerIds;
D={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(A){var m=A.toJson();delete m.spatialReference;D.geometry=b.toJson(m);D.geometryType=y.getJsonType(A)}g?D.sr=g.wkid||b.toJson(g.toJson()):A&&A.spatialReference?D.sr=A.spatialReference.wkid||b.toJson(A.spatialReference.toJson()):
F&&F.spatialReference&&(D.sr=F.spatialReference.wkid||b.toJson(F.spatialReference.toJson()));F&&(D.mapExtent=F.xmin+","+F.ymin+","+F.xmax+","+F.ymax);D.layers=this.layerOption;v&&(D.layers+=":"+v.join(","));D.layerDefs=x._serializeLayerDefinitions(this.layerDefinitions,!0);A=this.timeExtent;D.time=A?A.toJson().join(","):null;D.layerTimeOptions=x._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){F=J.getScale({extent:F,width:this.width,spatialReference:F.spatialReference});
var h=x._getLayersForScale(F,this.dynamicLayerInfos),f=[];e.forEach(this.dynamicLayerInfos,function(c){if(!c.subLayerIds){var l=c.id;if((!this.layerIds||this.layerIds&&-1!==e.indexOf(this.layerIds,l))&&-1!==e.indexOf(h,l)){var k={id:l};k.source=c.source&&c.source.toJson();var z;this.layerDefinitions&&this.layerDefinitions[l]&&(z=this.layerDefinitions[l]);z&&(k.definitionExpression=z);var u;this.layerTimeOptions&&this.layerTimeOptions[l]&&(u=this.layerTimeOptions[l]);u&&(k.layerTimeOptions=u.toJson());
f.push(k)}}},this);F=b.toJson(f);"[]"===F&&(F="[{}]");D.dynamicLayers=F}return D}});w.mixin(G,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});w.setObject("tasks.IdentifyParameters",G,p);return G})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),function(a,w,e,b,t,p,x,y,J,G,D){a=a(y,{declaredClass:"esri.virtualearth.VEGeocoder",
constructor:function(A){try{if(A=w.mixin({bingMapsKey:null},A||{}),this.url=x.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=x.urlToObject(this.url),this._queue=[],this.bingMapsKey=A.bingMapsKey,this.culture=A.culture||"en-US",this._errorHandler=w.hitch(this,this._errorHandler),this._addressToLocationsHandler=w.hitch(this,this._addressToLocationsHandler),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(F){throw this.onError(F),
F;}},addressToLocations:function(A,F,g){if(this.bingMapsKey){var v=w.mixin({},this._url.query,{query:A,token:this.bingMapsKey,culture:this.culture}),m=this._addressToLocationsHandler,h=this._errorHandler,f=new b(G._dfdCanceller);f._pendingDfd=D({url:this._url.path,content:v,callbackParamName:"callback",load:function(c,l){m(c,l,F,g,f)},error:function(c){h(c,g,f)}});return f}this._queue.push(arguments)},_addressToLocationsHandler:function(A,F,g,v,m){try{e.forEach(A,function(h,f){A[f]=new J(h)}),this._successHandler([A],
"onAddressToLocationsComplete",g,m)}catch(h){this._errorHandler(h,v,m)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(A){this.bingMapsKey=A},setCulture:function(A){this.culture=A}});w.setObject("virtualearth.VEGeocoder",a,p);return a})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",
constructor:function(y){w.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},y);this.address&&(this.address=new x(this.address));this.bestView&&(this.bestView=new p(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new t(this.locationArray[0]))}});w.setObject("virtualearth.VEGeocodeResult",a,b);return a})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(a,w,e,b){a=a(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(t){w.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},t)}});w.setObject("virtualearth.VEAddress",a,b);return a})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X){w=w("esri.dijit.Geocoder",[H,f,l],{templateString:g,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(I,U){m.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new B(a.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};var E=e.mixin({},this.options,I);this.set("autoComplete",E.autoComplete);this.set("arcgisGeocoder",E.arcgisGeocoder);this.set("value",E.value);this.set("theme",
E.theme);this.set("activeGeocoderIndex",E.activeGeocoderIndex);this.set("maxLocations",E.maxLocations);this.set("minCharacters",E.minCharacters);this.set("searchDelay",E.searchDelay);this.set("geocoderMenu",E.geocoderMenu);this.set("autoNavigate",E.autoNavigate);this.set("showResults",E.showResults);this.set("map",E.map);this.set("activeGeocoder",E.activeGeocoder);this.set("geocoders",E.geocoders);this.set("zoomScale",E.zoomScale);this.set("highlightLocation",E.highlightLocation);this.set("symbol",
E.symbol);this.set("graphicsLayer",E.graphicsLayer);this.set("results",[]);this._i18n=F;this._deferreds=[];this._defaultSR=new u(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=U},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else D.once(this.get("map"),"load",e.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(D(this.submitNode,h,e.hitch(this,this._findThenSelect)));this.own(D(this.geocoderMenuArrowNode,h,e.hitch(this,this._toggleGeolocatorMenu)));this.own(D(this.inputNode,
h,e.hitch(this,this._inputClick)));this.own(D(this.clearNode,h,e.hitch(this,this.clear)));this.own(D(this.geocoderMenuCloseNode,h,e.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();J.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var I=this.get("highlightGraphic"),U=this.get("graphicsLayer");I&&(U?U.remove(I):this.get("map").graphics.remove(I),
this.set("highlightGraphic",null));p.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);x.remove(this.containerNode,this._css.hasValueClass);p.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){y.set(this.domNode,"display","block")},hide:function(){y.set(this.domNode,"display","none")},find:function(I){var U=new b;if(I)if("string"===typeof I)this._findQuery(I).then(function(L){U.resolve(L)});else if("object"===typeof I&&I.hasOwnProperty("geometry")){switch(I.geometry.type){case "extent":var E=
I.geometry.getCenter();break;case "multipoint":E=I.geometry.getExtent().getCenter();break;case "point":E=I.geometry;break;case "polygon":E=I.geometry.getExtent().getCenter();break;case "polyline":E=I.geometry.getExtent().getCenter()}E&&this._reverseGeocodePoint(E,I.geometry).then(function(L){L.results[0]&&(I.hasOwnProperty("attributes")&&L.results[0].feature.setAttributes(e.mixin(L.results[0].feature.attributes,I.attributes)),I.hasOwnProperty("infoTemplate")&&L.results[0].feature.setInfoTemplate(I.infoTemplate),
I.hasOwnProperty("symbol")&&L.results[0].feature.setSymbol(I.symbol));U.resolve(L)},function(L){U.reject(L)})}else"object"===typeof I&&"point"===I.type?this._reverseGeocodePoint(I).then(function(L){U.resolve(L)},function(L){U.reject(L)}):I instanceof Array&&2===I.length?(E=new Q(I,new u({wkid:4326})),this._reverseGeocodePoint(E).then(function(L){U.resolve(L)},function(L){U.reject(L)})):U.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(L){U.resolve(L)});
return U.promise},focus:function(){c.focus(this.inputNode);var I=this.get("map");I&&I.disableKeyboardNavigation()},blur:function(){c.curNode&&c.curNode.blur();this.inputNode.blur();this._hideMenus();var I=this.get("map");I&&I.enableKeyboardNavigation()},select:function(I){this.onSelect(I);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&I&&I.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(I.extent);if(I.feature){var U=this.get("highlightGraphic"),E=this.get("graphicsLayer"),
L=this.get("symbol")||I.feature.symbol;U?(U.setGeometry(I.feature.geometry),U.setAttributes(I.feature.attributes),U.setInfoTemplate(I.feature.infoTemplate),U.setSymbol(L)):(U=I.feature,this.get("highlightLocation")&&(U.setSymbol(L),E?E.add(U):this.get("map").graphics.add(U)));this.set("highlightGraphic",U)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var I=this.get("activeGeocoder"),U=this.reHostedFS.test(I.url);("query"!==I.type||U)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(e.hitch(this,function(E){this.onAutoComplete(E);this.get("showResults")&&this._showResults(E)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(I){for(var U=0;U<I.length;U++)if(255<
I.charCodeAt(U))return!0;return!1},_findQuery:function(I){var U=new b;this._query({delay:0,search:I}).then(e.hitch(this,function(E){this.onFindResults(E);U.resolve(E)}),e.hitch(this,function(E){this.onFindResults(E);U.reject(E)}));return U.promise},_reverseGeocodePoint:function(I,U){var E=new b;if(I&&this.get("activeGeocoder")){var L=U||I,da=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(I,da,e.hitch(this,function(R){R={results:[this._hydrateResult(R)],geometry:L};this.onFindResults(R);E.resolve(R)}),e.hitch(this,function(R){E.reject(R)}))}else E.reject("Geocoder:: no point or active geocoder defined");return E.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=z.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=F.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new V(this.get("activeGeocoder").url):new P(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var I=[];this.get("arcgisGeocoder")&&(I=I.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(I=I.concat(this.get("geocoders")));this._geocoders=
I},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);p.set(this.inputNode,"placeholder",this._placeholder);p.set(this.submitNode,"title",this._placeholder)},_updateValue:function(I,U,E){this._ignoreUpdateValue||
(p.set(this.inputNode,"value",E),this._checkStatus())},_updateTheme:function(I,U,E){x.remove(this.domNode,U);x.add(this.domNode,E)},_setActiveGeocoderIndex:function(I,U,E){this.set("activeGeocoderIndex",E);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();I={attr:this.get("activeGeocoder"),oldVal:U,newVal:E};this.onGeocoderSelect(I)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(I){I||(I={delay:0});I.search||(I.search=this.get("value"));
var U=new b;this._deferreds.push(U);I.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(e.hitch(this,function(){this._performTask(U,I)}),I.delay)):this._performTask(U,I);return U.promise},_performTask:function(I,U){if(U.search){this._hideGeolocatorMenu();this._showLoading();var E="";this.get("activeGeocoder").prefix&&(E+=this.get("activeGeocoder").prefix);E+=U.search;this.get("activeGeocoder").suffix&&(E+=this.get("activeGeocoder").suffix);var L=this.get("activeGeocoder").outFields;L&&
(L instanceof Array||(L=[L]));var da=this.get("maxLocations")||6,R=this.get("activeGeocoder").searchExtent,M=this._defaultSR;this.get("map")&&(M=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var r=new T;r.outSpatialReference=M;r.returnGeometry=!0;r.num=da;R&&(r.geometry=R);da=this.get("activeGeocoder").exactMatch;R=this.get("activeGeocoder").field;M="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(E)&&(M="N");r.where=da?R+" \x3d "+
M+"'"+E+"'":"UPPER("+R+") LIKE "+M+"'%"+E.toUpperCase()+"%'";L&&(r.outFields=L);this._task.execute(r,e.hitch(this,function(N){this._receivedResults(N.features,I,U)}),e.hitch(this,function(N){this._receivedResults([],I,U)}))}else r={},this.get("activeGeocoder").categories&&(r.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=M,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&
(M=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||M&&M<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(r.location=this.get("map").extent.getCenter(),r.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&U.autoComplete?(r.text=E,R&&(r.searchExtent=R),this._task.suggestLocations(r).then(e.hitch(this,function(N){this._receivedResults(N,I,U)}),e.hitch(this,function(N){this._receivedResults(N,I,
U)}))):(r.address={},r.maxLocations=da,R&&(r.searchExtent=R),this.get("activeGeocoder").sourceCountry&&(r.countryCode=this.get("activeGeocoder").sourceCountry),U.magicKey&&(r.magicKey=U.magicKey),this.get("activeGeocoder").singleLineFieldName?r.address[this.get("activeGeocoder").singleLineFieldName]=E:r.address["Single Line Input"]=E,L&&(r.outFields=L),this._task.addressToLocations(r,e.hitch(this,function(N){this._receivedResults(N,I,U)}),e.hitch(this,function(N){this._receivedResults(N,I,U)})))}else this._hideLoading(),
I.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var I="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var U=this.get("value"),E=new RegExp("("+U+")","gi");I+='\x3cul role\x3d"presentation"\x3e';for(U=0;U<this.get("results").length&&5>U;++U){var L=this.get("results")[U].text||this.get("results")[U].name,da=this._css.resultsItemClass+" ";da=0===U%2?da+this._css.resultsItemOddClass:da+this._css.resultsItemEvenClass;0===U?da+=" "+
this._css.resultsItemFirstClass:U===this.get("results").length-1&&(da+=" "+this._css.resultsItemLastClass);I+='\x3cli title\x3d"'+L+'" data-text\x3d"'+L+'" data-item\x3d"true" data-index\x3d"'+U+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+da+'"\x3e'+L.replace(E,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}I+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=I);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&
(this.resultsNode.innerHTML=I),this._hideResultsMenu()},_receivedResults:function(I,U){this._hideLoading();var E=this._hydrateResults(I);this.set("results",E);E={results:E,value:this.get("value")};U.resolve(E)},_showLoading:function(){x.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){x.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){x.add(this.containerNode,this._css.activeMenuClass);x.add(this.domNode,this._css.GeocoderMenuOpenClass);y.set(this.geocoderMenuNode,
"display","block");p.set(this.geocoderMenuInsertNode,"aria-hidden","false");p.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){x.remove(this.containerNode,this._css.activeMenuClass);x.remove(this.domNode,this._css.GeocoderMenuOpenClass);y.set(this.geocoderMenuNode,"display","none");p.set(this.geocoderMenuInsertNode,"aria-hidden","true");p.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===
y.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){x.add(this.containerNode,this._css.GeocoderActiveClass);x.add(this.domNode,this._css.GeocoderResultsOpenClass);y.set(this.resultsNode,"display","block");p.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){y.set(this.resultsNode,"display","none");x.remove(this.containerNode,this._css.GeocoderActiveClass);x.remove(this.domNode,this._css.GeocoderResultsOpenClass);
p.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var I="",U;var E='\x3cul role\x3d"presentation"\x3e';for(U=0;U<this._geocoders.length;U++){I=this._css.resultsItemClass+" ";I=0===U%2?I+this._css.resultsItemOddClass:I+this._css.resultsItemEvenClass;U===this.get("activeGeocoderIndex")&&(I+=" "+this._css.geocoderSelectedClass);
0===U?I+=" "+this._css.resultsItemFirstClass:U===this._geocoders.length-1&&(I+=" "+this._css.resultsItemLastClass);var L=this._geocoders[U].name||F.widgets.Geocoder.main.untitledGeocoder;E+='\x3cli data-index\x3d"'+U+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+I+'"\x3e';E+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';E+=L;E+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';E+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=
E+"\x3c/ul\x3e";this._geocoderMenuEvent();y.set(this.geocoderMenuNode,"display","none");y.set(this.geocoderMenuArrowNode,"display","block");x.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",y.set(this.geocoderMenuNode,"display","none"),y.set(this.geocoderMenuArrowNode,"display","none"),x.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(x.add(this.containerNode,this._css.hasValueClass),p.set(this.clearNode,
"title",F.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var I=A('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=D(I,"click, keydown",e.hitch(this,function(U){this._clearQueryTimeout();var E=parseInt(p.get(U.currentTarget,"data-index"),10),L=p.get(U.currentTarget,"data-text");"click"===U.type||"keydown"===U.type&&U.keyCode===G.ENTER?(p.set(this.inputNode,"value",L),this.set("value",L),this.get("results")&&this.get("results")[E]&&
(U=this.get("results")[E],U.name?this.select(U):this._query({delay:0,search:U.text,magicKey:U.magicKey||null}).then(e.hitch(this,function(da){this.select(da.results[0])})))):"keydown"!==U.type||U.keyCode!==G.BACKSPACE&&U.keyCode!==G.DELETE?"keydown"===U.type&&U.keyCode===G.UP_ARROW?(t.stop(U),U=E-1,0>U?this.inputNode.focus():I[U].focus()):"keydown"===U.type&&U.keyCode===G.DOWN_ARROW?(t.stop(U),U=E+1,U>=I.length?this.inputNode.focus():I[U].focus()):U.keyCode===G.ESCAPE&&this._hideMenus():(t.stop(U),
this.inputNode.focus(),U=this.inputNode.value.slice(0,-1),p.set(this.inputNode,"value",U),this.set("value",U))}))},_geocoderMenuEvent:function(){var I=A('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=D(I,"click, keydown",e.hitch(this,function(U){var E=parseInt(p.get(U.currentTarget,"data-index"),10);"click"===U.type||"keydown"===U.type&&U.keyCode===G.ENTER?(this._setActiveGeocoderIndex(null,null,E),this._hideGeolocatorMenu()):"keydown"===U.type&&
U.keyCode===G.UP_ARROW?(t.stop(U),U=E-1,0>U?this.geocoderMenuArrowNode.focus():I[U].focus()):"keydown"===U.type&&U.keyCode===G.DOWN_ARROW?(t.stop(U),U=E+1,U>=I.length?this.geocoderMenuArrowNode.focus():I[U].focus()):U.keyCode===G.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var I;if(this._events&&this._events.length)for(I=0;I<this._events.length;I++)this._events[I].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();
var I=D(document,"click",e.hitch(this,function(U){this._hideResultsMenu(U)}));this._events.push(I);I=D(this.inputNode,"keyup",e.hitch(this,function(U){this._inputKeyUp(U)}));this._events.push(I);I=D(this.inputNode,"keydown",e.hitch(this,function(U){this._inputKeyDown(U)}));this._events.push(I);I=D(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(I);this.get("map")&&(I=D(this.get("map"),"mouse-down",e.hitch(this,function(){this.blur()})),this._events.push(I));
this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(e.hitch(this,function(I){I.results&&I.results.length&&(this.select(I.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(I){if(I){this._clearQueryTimeout();var U=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",U);this._ignoreUpdateValue=!1;var E=0;U&&(E=U.length);if(I.ctrlKey||I.metaKey||I.altKey||I.keyCode===G.copyKey||I.keyCode===G.ALT||I.keyCode===G.CTRL||I.keyCode===G.META||
I.keyCode===G.SHIFT||I.keyCode===G.UP_ARROW||I.keyCode===G.DOWN_ARROW||I.keyCode===G.LEFT_ARROW||I.keyCode===G.RIGHT_ARROW)return I;I&&I.keyCode===G.ENTER?(this._cancelDeferreds(),this._findThenSelect()):I&&I.keyCode===G.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):I&&I.keyCode===G.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&E>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var I=
0;I<this._deferreds.length;I++)this._deferreds[I].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(I){var U=A('[data-item\x3d"true"]',this.resultsNode);I&&I.keyCode===G.TAB?(this._cancelDeferreds(),this._hideMenus()):I&&I.keyCode===G.UP_ARROW?(t.stop(I),(I=U.length)&&U[I-1].focus()):I&&I.keyCode===G.DOWN_ARROW&&(t.stop(I),U[0]&&U[0].focus())},_geocoderMenuButtonKeyDown:function(I){var U=A('[data-item\x3d"true"]',this.geocoderMenuInsertNode);I&&I.keyCode===G.UP_ARROW?(t.stop(I),
this._showGeolocatorMenu(),(I=U.length)&&U[I-1].focus()):I&&I.keyCode===G.DOWN_ARROW&&(t.stop(I),this._showGeolocatorMenu(),U[0]&&U[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(I){var U={},E=this._defaultSR,L;this.get("map")&&(E=this.get("map").spatialReference);if(I.hasOwnProperty("text")&&I.hasOwnProperty("magicKey"))return I;if(I.hasOwnProperty("feature"))U.feature=new n(I.feature),(L=U.feature.geometry)&&L.setSpatialReference(E);else if(I.hasOwnProperty("geometry")){var da=
I.symbol||null;L=I.attributes||{};U.feature=new n(I.geometry,da,L,I.infoTemplate||null);(L=U.feature.geometry)&&L.setSpatialReference(E)}else I.hasOwnProperty("location")?(da=new Q(I.location.x,I.location.y,E),L={},I.hasOwnProperty("attributes")&&(L=I.attributes),I.hasOwnProperty("score")&&(L.score=I.score),U.feature=new n(da,null,L,null)):U.feature=null;if(I.hasOwnProperty("extent"))U.extent=new O(I.extent),U.extent.setSpatialReference(new u(E));else if(U.feature&&U.feature.geometry)switch(U.feature.geometry.type){case "extent":U.extent=
U.feature.geometry;break;case "multipoint":U.extent=U.feature.geometry.getExtent();break;case "polygon":U.extent=U.feature.geometry.getExtent();break;case "polyline":U.extent=U.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?U.extent=X.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(U.feature.geometry):U.extent=this.get("map").extent.centerAt(U.feature.geometry):U.extent=new O({xmin:U.feature.geometry.x-.25,ymin:U.feature.geometry.y-
.25,xmax:U.feature.geometry.x+.25,ymax:U.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else U.extent=null;I.hasOwnProperty("name")?U.name=I.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&I.hasOwnProperty("attributes")&&I.attributes.hasOwnProperty(this.activeGeocoder.field)?U.name=I.attributes[this.activeGeocoder.field]:I.hasOwnProperty("Match_addr")&&"string"===typeof I.Match_addr?U.name=I.Match_addr:I.hasOwnProperty("address")&&"object"===typeof I.address&&I.address.hasOwnProperty("Match_addr")?
U.name=I.address.Match_addr:I.hasOwnProperty("address")&&"string"===typeof I.address?U.name=I.address:I.hasOwnProperty("address")&&"object"===typeof I.address&&I.address.hasOwnProperty("Address")?U.name=I.address.Address:U.name=U.feature&&U.feature.geometry?U.feature.geometry.x+","+U.feature.geometry.y:"";return U},_hydrateResults:function(I){var U=[],E=0;if(I&&I.length)for(E;E<I.length;E++){var L=this._hydrateResult(I[E]);U.push(L)}return U}});e.setObject("dijit.Geocoder",w,k);return w})},"dojox/lang/functional":function(){define(["./functional/lambda",
"./functional/array","./functional/object"],function(a){return a})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(a,w,e,b){var t={};w.mixin(b,{filter:function(p,x,y){"string"==typeof p&&(p=p.split(""));y=y||a.global;x=b.lambda(x);var J=[],G;if(w.isArray(p)){var D=0;for(G=p.length;D<G;++D){var A=p[D];x.call(y,A,D,p)&&J.push(A)}}else if("function"==typeof p.hasNext&&"function"==typeof p.next)for(D=0;p.hasNext();)A=p.next(),
x.call(y,A,D++,p)&&J.push(A);else for(D in p)D in t||(A=p[D],x.call(y,A,D,p)&&J.push(A));return J},forEach:function(p,x,y){"string"==typeof p&&(p=p.split(""));y=y||a.global;x=b.lambda(x);var J;if(w.isArray(p)){var G=0;for(J=p.length;G<J;x.call(y,p[G],G,p),++G);}else if("function"==typeof p.hasNext&&"function"==typeof p.next)for(G=0;p.hasNext();x.call(y,p.next(),G++,p));else for(G in p)G in t||x.call(y,p[G],G,p);return y},map:function(p,x,y){"string"==typeof p&&(p=p.split(""));y=y||a.global;x=b.lambda(x);
var J,G;if(w.isArray(p)){var D=Array(J=p.length);for(G=0;G<J;D[G]=x.call(y,p[G],G,p),++G);}else if("function"==typeof p.hasNext&&"function"==typeof p.next)for(D=[],G=0;p.hasNext();D.push(x.call(y,p.next(),G++,p)));else for(G in D=[],p)G in t||D.push(x.call(y,p[G],G,p));return D},every:function(p,x,y){"string"==typeof p&&(p=p.split(""));y=y||a.global;x=b.lambda(x);var J;if(w.isArray(p)){var G=0;for(J=p.length;G<J;++G)if(!x.call(y,p[G],G,p))return!1}else if("function"==typeof p.hasNext&&"function"==
typeof p.next)for(G=0;p.hasNext();){if(!x.call(y,p.next(),G++,p))return!1}else for(G in p)if(!(G in t||x.call(y,p[G],G,p)))return!1;return!0},some:function(p,x,y){"string"==typeof p&&(p=p.split(""));y=y||a.global;x=b.lambda(x);var J;if(w.isArray(p)){var G=0;for(J=p.length;G<J;++G)if(x.call(y,p[G],G,p))return!0}else if("function"==typeof p.hasNext&&"function"==typeof p.next)for(G=0;p.hasNext();){if(x.call(y,p.next(),G++,p))return!0}else for(G in p)if(!(G in t)&&x.call(y,p[G],G,p))return!0;return!1}});
return b})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(a,w,e,b,t){var p=a.getObject("dojox.charting.axis2d.common",!0),x=function(y){y.marginLeft="0px";y.marginTop="0px";y.marginRight="0px";y.marginBottom="0px";y.paddingLeft="0px";y.paddingTop="0px";y.paddingRight="0px";y.paddingBottom="0px";y.borderLeftWidth="0px";y.borderTopWidth="0px";y.borderRightWidth="0px";y.borderBottomWidth="0px"};return a.mixin(p,
{createText:{gfx:function(y,J,G,D,A,F,g,v){return J.createText({x:G,y:D,text:F,align:A}).setFont(g).setFill(v)},html:function(y,J,G,D,A,F,g,v,m){J=w.doc.createElement("div");var h=J.style;y.getTextDir&&(J.dir=y.getTextDir(F));x(h);h.font=g;J.innerHTML=String(F).replace(/\s/g,"\x26nbsp;");h.color=v;h.position="absolute";h.left="-10000px";w.body().appendChild(J);var f=b.normalizedLength(b.splitFontString(g).size);if(!m)if(J.getBoundingClientRect){var c=J.getBoundingClientRect();c=c.width||c.right-c.left}else c=
e.getMarginBox(J).w;"rtl"==J.dir&&(G+=m?m:c);w.body().removeChild(J);h.position="relative";if(m)switch(h.width=m+"px",A){case "middle":h.textAlign="center";h.left=G-m/2+"px";break;case "end":h.textAlign="right";h.left=G-m+"px";break;default:h.left=G+"px",h.textAlign="left"}else switch(A){case "middle":h.left=Math.floor(G-c/2)+"px";break;case "end":h.left=Math.floor(G-c)+"px";break;default:h.left=Math.floor(G)+"px"}h.top=Math.floor(D-f)+"px";h.whiteSpace="nowrap";m=w.doc.createElement("div");h=m.style;
x(h);h.width="0px";h.height="0px";m.appendChild(J);y.node.insertBefore(m,y.node.firstChild);t("dojo-bidi")&&y.htmlElementsRegistry.push([m,G,D,A,F,g,v]);return m}}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A){a=a([J,A],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},
constructor:function(F){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=w.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(F,g,v,m,h){try{var f=[],c=[],l=F.directions||[],k=F.routes?F.routes.features:[],z=F.stops?F.stops.features:[],u=F.barriers?F.barriers.features:[],n=F.polygonBarriers?F.polygonBarriers.features:[],
B=F.polylineBarriers?F.polylineBarriers.features:[],H=F.messages,Q=e.forEach,O=e.indexOf,P=!0,T,V,X=F.routes&&F.routes.spatialReference||F.stops&&F.stops.spatialReference||F.barriers&&F.barriers.spatialReference||F.polygonBarriers&&F.polygonBarriers.spatialReference||F.polylineBarriers&&F.polylineBarriers.spatialReference;this._chk=F.checksum;Q(l,function(E){f.push(T=E.routeName);c[T]={directions:E}});Q(k,function(E){-1===O(f,T=E.attributes.Name)&&(f.push(T),c[T]={});c[T].route=E});Q(z,function(E){V=
E.attributes;-1===O(f,T=V.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(f.push(T),c[T]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==T&&(P=!1);void 0===c[T].stops&&(c[T].stops=[]);c[T].stops.push(E)});0<z.length&&!0===P&&(c[f[0]].stops=c["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete c["esri.tasks.RouteTask.NULL_ROUTE_NAME"],f.splice(e.indexOf(f,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var I=[];Q(f,function(E,L){c[E].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===E?null:E;c[E].spatialReference=
X;I.push(new G(c[E]))});F=function(E){Q(E,function(L,da){L.geometry&&(L.geometry.spatialReference=X);E[da]=new p(L)});return E};Q(H,function(E,L){H[L]=new D(E)});var U={routeResults:I,barriers:F(u),polygonBarriers:F(n),polylineBarriers:F(B),messages:H};this._successHandler([U],"onSolveComplete",v,h)}catch(E){this._errorHandler(E,m,h)}},solve:function(F,g,v,m){var h=m.assembly;F=this._encode(w.mixin({},this._url.query,{f:"json"},F.toJson(h&&h[0]),this._chk?{checksum:this._chk}:{}));var f=this._handler,
c=this._errorHandler;return x({url:this._url.path,timeout:25E4,content:F,callbackParamName:"callback",load:function(l,k){f(l,k,g,v,m.dfd)},error:function(l){c(l,v,m.dfd)}})},onSolveComplete:function(){}});y._createWrappers(a);w.setObject("tasks.RouteTask",a,t);return a})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),function(a,w,e,b,t,p,x){a=a(null,{declaredClass:"esri.tasks.RouteResult",
constructor:function(y){var J=y.spatialReference,G=y.route;if(y.directions){var D=[],A=[],F=[];e.forEach(y.directions.features,function(v,m){A[m]=v.compressedGeometry;D[m]=v.strings;F[m]=v.events});y.directions.strings=D;y.directions.events=F;this.directions=new x(y.directions,A)}this.routeName=y.routeName;G&&(G.geometry&&(G.geometry.spatialReference=J),this.route=new p(G));if(y.stops){var g=this.stops=[];e.forEach(y.stops,function(v,m){v.geometry&&(v.geometry.spatialReference=J);g[v.attributes.Sequence-
1]=new p(v)})}},routeName:null,directions:null,route:null,stops:null});w.setObject("tasks.RouteResult",a,t);return a})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(a,w,e,b,t,p,x,y,J,G,D){a=a(D,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(A,F){this.routeId=A.routeId;this.routeName=A.routeName;
w.mixin(this,A.summary);this.extent=new x(this.envelope);var g=this._fromCompressedGeometry,v=this.features,m=this.extent.spatialReference,h=[];e.forEach(F,function(f,c){v[c].setGeometry(h[c]=f?g(f,m):v[c].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(h,m);this.geometryType="esriGeometryPolyline";e.forEach(A.events,function(f,c){e.forEach(f,function(l,k){f[k]=new G(new J(l.point.x,l.point.y,m),null,{ETA:l.ETA,strings:t.stringify(l.strings),arriveTimeUTC:l.arriveTimeUTC})});A.events[c]=
f});delete this.envelope},_fromCompressedGeometry:function(A,F){var g=0,v=0,m=0,h=0,f=[],c,l=0,k=0,z=0;(c=A.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(c=[]);if(0===parseInt(c[l],32)){l=2;var u=parseInt(c[l],32);l++;var n=parseInt(c[l],32);l++;if(u&1){k=e.indexOf(c,"|")+1;var B=parseInt(c[k],32);k++}if(u&2){z=e.indexOf(c,"|",k)+1;var H=parseInt(c[z],32);z++}}else n=parseInt(c[l],32),l++;for(;l<c.length&&"|"!==c[l];){u=parseInt(c[l],32)+g;l++;g=u;var Q=parseInt(c[l],32)+v;l++;v=Q;u=[u/n,Q/n];k&&(Q=parseInt(c[k],
32)+m,k++,m=Q,u.push(Q/B));z&&(Q=parseInt(c[z],32)+h,z++,h=Q,u.push(Q/H));f.push(u)}g=new y({paths:[f],hasZ:0<k,hasM:0<z});g.setSpatialReference(F);return g},_mergePolylinesToSinglePath:function(A,F){var g=[],v=!1;e.forEach(A,function(f){e.forEach(f.paths,function(c){v=v||f.hasM;g=g.concat(c)})});var m=[],h=[0,0];e.forEach(g,function(f){if(f[0]!==h[0]||f[1]!==h[1])m.push(f),h=f});return new y({paths:[m],spatialReference:F,hasM:v})}});w.setObject("tasks.DirectionsFeatureSet",a,p);return a})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(a,w,e,b){a=a(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(t){w.mixin(this,t)}});w.mixin(a,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});w.setObject("tasks.NAMessage",a,b);return a})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(a,
w,e,b,t){return a(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(p,x){var y=new e;if(this._sd)y.resolve(this._sd);else if(this._url&&this._url.orig){var J=this._url.orig,G=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",D,A=function(F){t({url:F+("/"===F[F.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:G},callbackParamName:"callback"}).then(function(g){var v=
[],m=null;if(g&&g.results&&g.results.length)for(var h=0;h<g.results.length;h++)if("supportedTravelModes"===g.results[h].paramName){if(g.results[h].value&&g.results[h].value.features)for(var f=0;f<g.results[h].value.features.length;f++)if(g.results[h].value.features[f].attributes){var c=w.parse(g.results[h].value.features[f].attributes.TravelMode);v.push(c)}}else"defaultTravelMode"===g.results[h].paramName&&(m=g.results[h].value);D.supportedTravelModes=v;D.defaultTravelMode=m;y.resolve(D)},function(g){y.reject(g)})};
t({url:J,content:{f:"json"},callbackParamName:"callback"}).then(function(F){D=F;D.supportedTravelModes||(D.supportedTravelModes=[]);for(F=0;F<D.supportedTravelModes.length;F++)D.supportedTravelModes[F].id||(D.supportedTravelModes[F].id=D.supportedTravelModes[F].itemId);x?y.resolve(D):p?A(p):10.4<=D.currentVersion?t({url:J+("/"===J[J.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(g){D.supportedTravelModes=g.supportedTravelModes;D.defaultTravelMode=
g.defaultTravelMode;y.resolve(D)},function(g){y.reject(g)}):t({url:J.substring(0,J.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(g){g.owningSystemUrl?(J=g.owningSystemUrl,t({url:J+("/"===J[J.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(v){v&&v.helperServices&&v.helperServices.routingUtilities&&v.helperServices.routingUtilities.url?A(v.helperServices.routingUtilities.url):y.resolve(D)},function(v){y.reject(v)})):
y.resolve(D)},function(g){y.reject(g)})},function(F){y.reject(F)})}else y.reject("NA Task has no URL specified.");y.then(b.hitch(this,function(F){this._sd=F}),b.hitch(this,function(){this._sd=null}));return y.promise},getOwningSystemUrl:function(){var p=new e;if(this._url&&this._url.orig){var x=this._url.orig;t({url:x.substring(0,x.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(y){p.resolve(y.owningSystemUrl)})}else p.resolve(void 0);return p.promise}})})},
"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(a,w,e,b,t,p,x,y){a=a(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,
ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,
stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(J){var G={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&e.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
e.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:y.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?e.toJson(this.travelMode):this.travelMode},D=this.stops;"esri.tasks.FeatureSet"===D.declaredClass&&0<D.features.length?G.stops=e.toJson({type:"features",features:x._encodeGraphics(D.features,J&&J["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===D.declaredClass?G.stops=D:"esri.tasks.DataFile"===D.declaredClass&&(G.stops=e.toJson({type:"features",url:D.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":G.directionsOutputType="esriDOTComplete";break;case "complete-no-events":G.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":G.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":G.directionsOutputType="esriDOTStandard";break;case "summary-only":G.directionsOutputType="esriDOTSummaryOnly";break;default:G.directionsOutputType=this.directionsOutputType}D=function(A,
F){return A?"esri.tasks.FeatureSet"===A.declaredClass?0<A.features.length?e.toJson({type:"features",features:x._encodeGraphics(A.features,J&&J[F])}):null:"esri.tasks.DataLayer"===A.declaredClass?A:"esri.tasks.DataFile"===A.declaredClass?e.toJson({type:"features",url:A.url}):e.toJson(A):null};this.barriers&&(G.barriers=D(this.barriers,"barriers.features"));this.polygonBarriers&&(G.polygonBarriers=D(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(G.polylineBarriers=D(this.polylineBarriers,
"polylineBarriers.features"));return p.filter(G,function(A){if(null!==A)return!0})}});w.setObject("tasks.RouteParameters",a,t);return a})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(a,w,e){w={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var b={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},t={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},p={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},x={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},y={LengthUnit:w,OutputLine:b,
UTurn:t,OutputPolygon:p,TravelDirection:x};a.setObject("tasks._NALengthUnit",w,e);a.setObject("tasks.NAOutputLine",b,e);a.setObject("tasks.NAUTurn",t,e);a.setObject("tasks.NAOutputPolygon",p,e);a.setObject("tasks.NATravelDirection",x,e);return y})},"esri/layers/wmts":function(){define(["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f){w=w([m],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(c,l){this.version="1.0.0";this.tileUrl=this._url=c;this.serviceMode="RESTful";this._parseCapabilities=e.hitch(this,this._parseCapabilities);this._getCapabilitiesError=e.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};l||(l={});if(l.serviceMode)if("KVP"===l.serviceMode||"RESTful"===l.serviceMode)this.serviceMode=l.serviceMode;else return;this.customParameters=l.customParameters;this.customLayerParameters=l.customLayerParameters;this.layerInfo=new f;l.layerInfo&&(this.layerInfo=l.layerInfo,this._identifier=l.layerInfo.identifier,this._tileMatrixSetId=l.layerInfo.tileMatrixSet,
l.layerInfo.format&&(this.format="image/"+l.layerInfo.format),this._style=l.layerInfo.style,this.title=l.layerInfo.title,this._dimension=l.layerInfo.dimension,this._dimension2=l.layerInfo.dimension2);l.resourceInfo?(this.version=l.resourceInfo.version,l.resourceInfo.getTileUrl&&(this._url=this.tileUrl=l.resourceInfo.getTileUrl),this.copyright=l.resourceInfo.copyright,this.layerInfos=l.resourceInfo.layerInfos,this.customParameters=l.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=
l.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(c){this.setVisibleLayer(c)},setVisibleLayer:function(c){this._setActiveLayer(c);this.refresh(!0)},setCustomParameters:function(c,l){this.customParameters=c;this.customLayerParameters=l;this.refresh(!0)},getTileUrl:function(c,l,k){c=this._levelToLevelValue[c];c=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[l%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,c).replace(/\{TileRow\}/gi,l).replace(/\{TileCol\}/gi,k).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,c).replace(/\{row\}/gi,l).replace(/\{col\}/gi,k);c=this._appendCustomLayerParameters(c);c=this.addTimestampToURL(c);return G.addProxy(c)},getTileUrlTemplate:function(c){var l=
c.identifier,k=c.tileMatrixSet,z=c.format,u=c.style,n=c.dimension,B=c.dimension2;l?c=b.filter(this.layers,function(Q){return Q.identifier===l})[0]:(c=this.layers[0],l=this.layers[0].identifier);if(c){if(!z)z=c.formats[0];else if(!(-1===z.indexOf("image/")&&-1<b.indexOf(c.formats,z))&&(-1===z.indexOf("image/")&&(z="image/"+z),-1===b.indexOf(c.formats,z))){this.onError(Error("The layer doesn't support the format of "+z));return}if(!u)u=c.styles[0];else if(-1===b.indexOf(c.styles,u)){this.onError(Error("The layer doesn't support the style of "+
u));return}if(!n&&c.dimensions)n=c.dimensions[0];else if(-1===b.indexOf(c.dimensions,n)){this.onError(Error("The layer doesn't support the dimension of "+n));return}if(!B&&c.dimensions2)B=c.dimensions2[0];else if(-1===b.indexOf(c.dimensions2,B)){this.onError(Error("The layer doesn't support the dimension of "+B));return}if(k){var H=b.filter(c.tileMatrixSetInfos,function(Q){return Q.tileMatrixSet===k})[0];if(!H){this.onError(Error("The tileMatrixSetId "+k+" is not supported by the layer of "+l));return}}else(H=
b.filter(c.tileMatrixSetInfos,function(Q){return"GoogleMapsCompatible"===Q.tileMatrixSet})[0])||(H=c.tileMatrixSetInfos[0]),k=H.tileMatrixSet;return this._getTileUrlTemplate(l,k,z,u,n,B)}this.onError(Error("couldn't find the layer "+l))},_getTileUrlTemplate:function(c,l,k,z,u,n){c||(c=this._identifier);l||(l=this._tileMatrixSetId);k||(k=this.format);z||""===z||(z=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var B=this.resourceUrls[0].template;B.indexOf(".xxx")===B.length-4&&(B=B.slice(0,
B.length-4));B=B.replace(/\{Style\}/gi,z);B=B.replace(/\{TileMatrixSet\}/gi,l);B=B.replace(/\{TileMatrix\}/gi,"{level}");B=B.replace(/\{TileRow\}/gi,"{row}");B=B.replace(/\{TileCol\}/gi,"{col}");B=B.replace(/\{dimensionValue\}/gi,u);return B=B.replace(/\{dimensionValue2\}/gi,n)}"KVP"===this.serviceMode?B=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+c+"\x26STYLE\x3d"+z+"\x26FORMAT\x3d"+k+"\x26TILEMATRIXSET\x3d"+l+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(u="",this._formatDictionary[k.toLowerCase()]&&(u=this._formatDictionary[k.toLowerCase()]),B=this._url+c+"/"+z+"/"+l+"/{level}/{row}/{col}"+u);return B},_parseResourceInfo:function(){var c=this.layerInfos,l;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(l=0;l<c.length;l++)if(!(this._identifier&&c[l].identifier!==this._identifier||this.title&&c[l].title!==this.title||this._tileMatrixSetId&&c[l].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+c[l].format!==this.format||this._style&&c[l].style!==this._style)){e.mixin(this,{description:c[l].description,tileInfo:c[l].tileInfo,spatialReference:c[l].tileInfo.spatialReference,fullExtent:c[l].fullExtent,initialExtent:c[l].initialExtent,_identifier:c[l].identifier,_tileMatrixSetId:c[l].tileMatrixSet,format:"image/"+c[l].format,_style:c[l].style});break}for(l=0;l<c.length;l++){var k=c[l].tileInfo;96!==k.dpi&&(b.forEach(k.lods,function(z){z.scale=96*z.scale/k.dpi}),k.dpi=96);b.forEach(k.lods,
function(z){z.resolution=this._getResolution(k.spatialReference.wkid,90.71428571428571*z.scale/96,c[l].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(z){this._levelToLevelValue[z.level]=z.levelValue?z.levelValue:z.level},this)},_getCapabilities:function(){var c;"KVP"===this.serviceMode?c=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(c=this._url+"/"+this.version+"/WMTSCapabilities.xml");c=this._appendCustomParameters(c);J({url:c,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(c){c=c.replace(/ows:/gi,"");c=p.parse(c);var l=a.query("Contents",c)[0];if(l){var k=a.query("OperationsMetadata",c)[0],z=a.query("[name\x3d'GetTile']",k)[0];k=this._url;z=a.query("Get",
z);var u,n=!1;for(u=0;u<z.length;u++){var B=a.query("Constraint",z[u])[0];if(!B||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,B)){k=z[u].attributes[0].nodeValue;n=!0;break}else if(!B||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",B))var H=z[u].attributes[0].nodeValue;else if(!B||this._getTagWithChildTagValue("AllowedValues","Value","KVP",B))var Q=z[u].attributes[0].nodeValue}n||("KVP"===this.serviceMode&&H?(k=H,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
Q&&(k=Q,this.serviceMode="KVP"));-1===k.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(k+="/");"KVP"===this.serviceMode&&(k+=-1<k.indexOf("?")?"":"?");this._url=k;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",c)[0];H=a.query("Layer",l);var O,P=[];this.layers=[];b.forEach(H,function(T){O=this._getTagValues("Identifier",T)[0];P.push(O);this.layers.push(this._getWMTSLayerInfo(O,T,l))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(c){c||(c={});c.identifier&&(this._identifier=c.identifier);c.tileMatrixSet&&(this._tileMatrixSetId=c.tileMatrixSet);c.format&&(this.format=c.format);c.style&&(this._style=c.style);c.dimension&&(this._dimension=c.dimension);c.dimension2&&(this._dimension2=c.dimension2);if(this.layers)if(this._identifier?c=b.filter(this.layers,function(k){return k.identifier===this._identifier},this)[0]:(c=this.layers[0],this._identifier=this.layers[0].identifier),c){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===b.indexOf(c.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=c.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=c.styles[0];else if(-1===b.indexOf(c.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&c.dimensions)this._dimension=
c.dimensions[0];else if(-1===b.indexOf(c.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&c.dimensions2)this._dimension2=c.dimensions2[0];else if(-1===b.indexOf(c.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var l=b.filter(c.tileMatrixSetInfos,function(k){return k.tileMatrixSet===this._tileMatrixSetId},this)[0];
if(!l){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(l=b.filter(c.tileMatrixSetInfos,function(k){return"GoogleMapsCompatible"===k.tileMatrixSet})[0])||(l=c.tileMatrixSetInfos[0]),this._tileMatrixSetId=l.tileMatrixSet;this.description=c.description;this.title=c.title;this.spatialReference=l.tileInfo.spatialReference;this.tileInfo=l.tileInfo;this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(k){this._levelToLevelValue[k.level]=
k.levelValue?k.levelValue:k.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=v.geographicToWebMercator(c.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=c.gcsExtent:(this.fullExtent=l.fullExtent,this.initialExtent=l.initialExtent);this.resourceUrls=c.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(c,l,k){var z=this._getTagValues("Abstract",l)[0],u=this._getTagValues("Title",l)[0],n=a.query("WGS84BoundingBox",l)[0],B=n?this._getTagValues("LowerCorner",n)[0].split(" "):["-180","-90"],H=n?this._getTagValues("UpperCorner",n)[0].split(" "):["180","90"];
n=parseFloat(B[0]);B=parseFloat(B[1]);var Q=parseFloat(H[0]);H=parseFloat(H[1]);n=new g(n,B,Q,H,new A({wkid:4326}));H=this._getTagValues("Identifier",a.query("Style",l)[0]);var O=this._getTagValues("Identifier",a.query("Dimension",l)[0]),P=this._getTagValues("Default",a.query("Dimension",l)[0])||this._getTagValues("Value",a.query("Dimension",l)[0]),T=1<a.query("Dimension",l).length?this._getTagValues("Identifier",a.query("Dimension",l)[1]):[],V=1<a.query("Dimension",l).length?this._getTagValues("Default",
a.query("Dimension",l)[1])||this._getTagValues("Value",a.query("Dimension",l)[1]):[];B=this._getTagValues("Format",l);k=this._getLayerMatrixInfos(l,k);c={identifier:c,tileMatrixSetInfos:k,formats:B,styles:H,title:u,description:z,gcsExtent:n,dimensions:P,dimensions2:V};l=a.query("ResourceURL",l);var X=[],I;b.forEach(l,function(U){I=U.getAttribute("template");if(O&&P&&O[0]&&P[0])if(-1<I.indexOf("{"+O+"}"))I=I.replace("{"+O+"}","{dimensionValue}");else{var E=I.toLowerCase().indexOf("{"+O[0].toLowerCase()+
"}");-1<E&&(I=I.substring(0,E)+"{dimensionValue}"+I.substring(E+O[0].length+2))}T&&V&&T[0]&&V[0]&&(-1<I.indexOf("{"+T+"}")?I=I.replace("{"+T+"}","{dimensionValue2}"):(E=I.toLowerCase().indexOf("{"+T[0].toLowerCase()+"}"),-1<E&&(I=I.substring(0,E)+"{dimensionValue2}"+I.substring(E+T[0].length+2))));X.push({template:I,format:U.getAttribute("format"),resourceType:U.getAttribute("resourceType")})});X&&0<X.length&&(c.resourceUrls=X);return c},_getLayerMatrixInfos:function(c,l){var k=[],z=this._getTagValues("TileMatrixSet",
c);if(z&&0!==z.length)return b.forEach(z,function(u){u=this._getLayerMatrixInfo(u,c,l);k.push(u)},this),k},_getLayerMatrixInfo:function(c,l,k){var z=[];l=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",c,l);var u=this._getTagValues("TileMatrix",l),n=this._getTagWithChildTagValue("TileMatrixSet","Identifier",c,k),B=this._getTagValues("SupportedCRS",n)[0];var H=parseInt(B.split(":").pop(),10);if(900913==H||3857==H)H=102100;if(-1<B.toLowerCase().indexOf("crs84")||-1<B.toLowerCase().indexOf("crs:84")){H=
4326;var Q=!0}else if(-1<B.toLowerCase().indexOf("crs83")||-1<B.toLowerCase().indexOf("crs:83"))H=4269,Q=!0;else if(-1<B.toLowerCase().indexOf("crs27")||-1<B.toLowerCase().indexOf("crs:27"))H=4267,Q=!0;var O=new A({wkid:H}),P=a.query("TileMatrix",n)[0];k=parseInt(this._getTagValues("TileWidth",P)[0],10);l=parseInt(this._getTagValues("TileHeight",P)[0],10);var T=this._getTagValues("TopLeftCorner",P)[0].split(" ");var V=T[0],X=T[1];1<V.split("E").length&&(T=V.split("E"),V=T[0]*Math.pow(10,T[1]));1<
X.split("E").length&&(T=X.split("E"),X=T[0]*Math.pow(10,T[1]));V=parseFloat(V);X=parseFloat(X);var I=Q&&4326===H&&90===V&&-180===X;for(T=0;T<this._flippingAxisForWkids.length;T++)if(B.split(":").pop()>=this._flippingAxisForWkids[T][0]&&B.split(":").pop()<=this._flippingAxisForWkids[T][1]||4326===H&&(!Q||I)){4326===H&&90<V&&(V="90");var U=new F(X,V,O);break}T===this._flippingAxisForWkids.length&&(U=new F(V,X,O));if(0===u.length)for(u=a.query("TileMatrix",n),T=0;T<u.length;T++)Q=this._getLodFromTileMatrix(u[T],
H,T,c),z.push(Q);else for(T=0;T<u.length;T++)Q=this._getTagWithChildTagValue("TileMatrix","Identifier",u[T],n),Q=this._getLodFromTileMatrix(Q,H,T,c),z.push(Q);H=a.query("BoundingBox",n)[0];if(H){var E=this._getTagValues("LowerCorner",H)[0].split(" ");var L=this._getTagValues("UpperCorner",H)[0].split(" ")}E&&1<E.length&&L&&1<L.length?(P=parseFloat(E[0]),H=parseFloat(E[1]),E=parseFloat(L[0]),L=parseFloat(L[1])):(E=this._getTagValues("MatrixWidth",P)[0],H=this._getTagValues("MatrixHeight",P)[0],P=U.x,
L=U.y,E=P+E*l*z[0].resolution,H=L-H*k*z[0].resolution);L=E=new g(P,H,E,L,O);U=new h({dpi:96,spatialReference:O,format:this.format,rows:k,cols:l,origin:U,lods:z});return{tileMatrixSet:c,fullExtent:L,initialExtent:E,tileInfo:U}},_getCapabilitiesError:function(c){this.onError(c)},_getLodFromTileMatrix:function(c,l,k,z){var u=this._getTagValues("Identifier",c)[0];c=this._getTagValues("ScaleDenominator",c)[0];1<c.split("E").length?(c=c.split("E"),c=c[0]*Math.pow(10,c[1])):c=parseFloat(c);l=this._getResolution(l,
c,z);return{level:k,levelValue:u,scale:1.058267716535433*c,resolution:l}},_getResolution:function(c,l,k){c=y.isDefined(D[c])?D.values[D[c]]:"default028mm"===k?6370997*Math.PI/180:6378137*Math.PI/180;return 7*l/25E3/c},_getTag:function(c,l){var k=a.query(c,l);return k&&0<k.length?k[0]:null},_getTagValues:function(c,l){var k=[],z=c.split("\x3e"),u;var n=a.query(z[0],l)[0];if(1<z.length){for(u=1;u<z.length-1;u++)n=a.query(z[u],n)[0];z=a.query(z[z.length-1],n)}else z=a.query(z[0],l);z&&0<z.length&&b.forEach(z,
function(B){9>t("ie")?k.push(B.childNodes.length?B.childNodes[0].nodeValue:""):k.push(B.textContent)});return k},_getAttributeValues:function(c,l,k){c=a.query(c,k);var z=[];c&&0<c.length&&b.forEach(c,function(u){z.push(u.getAttribute(l))});return z},_getTagWithChildTagValue:function(c,l,k,z){z=z.childNodes;var u;for(u=0;u<z.length;u++)if(-1<z[u].nodeName.indexOf(c)){if(9>t("ie")){if(y.isDefined(a.query(l,z[u])[0]))var n=a.query(l,z[u])[0].childNodes[0].nodeValue}else y.isDefined(a.query(l,z[u])[0])&&
(n=a.query(l,z[u])[0].textContent);if(n===k||k.split(":")&&n===k.split(":")[1])return z[u]}},_appendCustomParameters:function(c){var l;if(this.customParameters)for(l in this.customParameters)c+=(-1===c.indexOf("?")?"?":"\x26")+l+"\x3d"+encodeURIComponent(this.customParameters[l]);return c},_appendCustomLayerParameters:function(c){var l;if(this.customLayerParameters||this.customParameters){var k=e.clone(this.customParameters||{});e.mixin(k,this.customLayerParameters||{});for(l in k)c+=(-1===c.indexOf("?")?
"?":"\x26")+l+"\x3d"+encodeURIComponent(k[l])}return c},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,
5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,
3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],
[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});e.setObject("layers.WMTSLayer",w,x);return w})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(a,w,e,b){a=a(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(t){t&&(this.title=t.title,this.tileMatrixSet=
t.tileMatrixSet,this.format=t.format,this.style=t.style,this.tileInfo=t.tileInfo,this.fullExtent=t.fullExtent,this.initialExtent=t.initialExtent,this.identifier=t.identifier,this.description=t.description,this.dimension=t.dimension)}});w.setObject("layers.WMTSLayerInfo",a,b);return a})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da,R,M,r,N,W,fa,ba,Z,ja,ma,aa,ka,oa,ra,ya,Ca,Ea,Da,xa,Pa,Oa,Ra,Sa,Ya,$a,Za,Ga,Ta,Xa,Ua,Qa){var Na=E.getProtocolForWebResource(),Va=O.createSubclass({_setSourcesAttr:function(d){d&&(d=d.map(function(q){q.locator&&null==q.locationType&&(q=e.mixin({locationType:"street"},q));return q}));this.inherited(arguments,[d])}});w=w("esri.dijit.Directions",[xa,y],{templateString:Q,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(d,q){if(!d.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!q)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=H;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",
activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Na+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Na+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Na+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new M(H.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new M(H.widgets.directions.maneuver,H.widgets.directions.waypoint),segmentInfoTemplate:new M(H.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new Da("11px",Da.STYLE_NORMAL,Da.VARIANT_NORMAL,Da.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new p([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new ra({url:a.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new ra({url:a.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new ra({url:a.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new ra({url:a.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new ra({url:a.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new ra({url:a.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new ra({url:a.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new ra({url:a.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new oa({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new oa({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new ya).setColor(new p([20,89,127,.75])).setWidth(10).setCap(ya.CAP_ROUND).setJoin(ya.JOIN_ROUND),segmentSymbol:(new ya).setColor(new p([255,255,255,1])).setWidth(6).setCap(ya.CAP_ROUND).setJoin(ya.JOIN_ROUND),barrierRenderer:new Ea({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new Ea({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new Ea({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=d;this.defaults=e.mixin({},this.options,d,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(var C=2;C<this.defaults.minStops;C++)this.defaults.stops.splice(0,0,"");this.domNode=q},postCreate:function(){this.inherited(arguments);this.own(h(this._activateButtonNode,x,e.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(h(this._lineBarrierButtonNode,x,e.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(h(this._addDestinationNode,
x,e.hitch(this,this._addStopButton)));this.own(h(this._optionsButtonNode,x,e.hitch(this,this._toggleOptionsMenu)));this.own(h(this._saveMenuButton,x,e.hitch(this,this._toggleSaveMenu)));this.own(h(this._saveButton,x,e.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(h(this._saveAsButton,x,e.hitch(this,function(){e.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(h(this._findOptimalOrderNode,x,e.hitch(this,this._toggleCheckbox)));
this.own(h(this._returnToStartNode,x,e.hitch(this,this._toggleCheckbox)));this.own(h(this._useTrafficNode,x,e.hitch(this,this._toggleCheckbox)));this.own(h(this._useMilesNode,x,e.hitch(this,this._toggleUnits)));this.own(h(this._useKilometersNode,x,e.hitch(this,this._toggleUnits)));this.own(h(this._getDirectionsButtonNode,x,e.hitch(this,this.getDirections)));this.own(h(this._clearDirectionsButtonNode,x,e.hitch(this,function(){this.clearDirections()})));var d=e.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(e.hitch(this,function(){k.set(this._startTimeMenu,"display","none")}),100)});this.own(h(this._startTimeButtonNode,x,e.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===k.get(this._startTimeMenu,"display")?k.set(this._startTimeMenu,"display","none"):(k.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(h(this._startTimeMenuLeaveNow,
"blur",d));this.own(h(this._startTimeMenuDepartAt,"blur",d));this.own(h(this._startTimeMenuNone,"blur",d));this.own(h(this._startTimeMenuLeaveNow,"mousedown",e.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(h(this._startTimeMenuDepartAt,"mousedown",e.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(h(this._startTimeMenuNone,"mousedown",e.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new ya).setColor(new p([0,255,0,0])).setWidth(20).setCap(ya.CAP_ROUND);this._stopLayer=new W({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new W({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new W({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new W({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new W({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new W({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var q=new L(null,this.waypointSymbol,{});d=e.hitch(this,function(){this._moveInProgress||this._solveInProgress||!q._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(q),clearTimeout(q._solveTimeout),q._solveTimeout=null,q.attributes.isWaypoint=!0,q._isStopIcon&&this.stopGraphics[q._index]&&(this._stopLayer.add(this.stopGraphics[q._index]),this._stopLayer.add(this.textGraphics[q._index])));q._showTooltip()});this._handle=e.mixin(q,{_isHandle:!0,_tooltip:P.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:d},this.map.container),_showTooltip:e.hitch(this,function(C){q._tooltip.style.display=!C||C instanceof MouseEvent?
"none":"inline";C&&(C="string"===typeof C?C:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(C)+"\x3c/table\x3e",q._tooltip.innerHTML!==C&&(q._tooltip.innerHTML=C))}),_isShown:e.hitch(this,function(){return-1<t.indexOf(this._stopLayer.graphics,q)}),_remove:d});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();P.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(e.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(e.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(d,q){return this._enqueue(function(){return this._modifyStopSequence(d,
q)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(d,q,C){return this._enqueue(function(){this.clearMessages();return this._removeStop(d,q,C)})},updateStops:function(d){return this._enqueue(function(){return this._updateStops(d)})},addStops:function(d,q){return this._enqueue(function(){return this._addStops(d,q)}).then(e.hitch(this,this.zoomToFullRoute))},addStop:function(d,
q){return this._enqueue(function(){return this._addStop(d,q)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(d,q,C){return this._enqueue(function(){return this._updateStop(d,q,C)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(d){this.routeParams.barriers=d;return this._getDirections().then(e.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(d){this.routeParams.polylineBarriers=d;return this._getDirections().then(e.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(d){this.routeParams.polygonBarriers=d;return this._getDirections().then(e.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(d){return this._enqueue(function(){return this._getDirections().then(e.hitch(this,function(){!0!==d&&this.zoomToFullRoute()}))})},selectSegment:function(d){if(!(!this.directions||!this.directions.features||
0>d||d>=this.directions.features.length))for(var q=n("[data-segment]",this._resultsNode),C=0;C<q.length;C++){var S=parseInt(u.get(q[C],"data-segment"),10);if(d===S&&q[C]!==this._focusedDirectionsItem){this._focusedDirectionsItem=q[C];this.centerAtSegmentStart(d);this.onSegmentSelect(this.directions.features[d]);q[C].focus();break}}},unhighlightSegment:function(d){var q=this._segmentGraphics;if(q&&(!this._focusedDirectionsItem||d)){for(d=0;d<q.length;d++)this._routeLayer.remove(q[d]);this._segmentGraphics=
[]}},highlightSegment:function(d,q){if(!(this._focusedDirectionsItem&&!q||d>=this.directions.features.length)){d=d||0;var C=e.hitch(this,function(qa){var ua=this.map.toMap({x:0,y:0});return this.map.toScreen(ua.offset(qa,0)).x}),S=e.hitch(this,function(qa){for(var ua=0,Aa=0;Aa<qa.length;Aa++)for(var Ja=1;Ja<qa[Aa].length;Ja++){var Ha=qa[Aa][Ja-1],Ia=qa[Aa][Ja];ua+=C(Math.sqrt((Ha[0]-Ia[0])*(Ha[0]-Ia[0])+(Ha[1]-Ia[1])*(Ha[1]-Ia[1])))}return ua}),K=e.hitch(this,function(qa){var ua=this.map.toMap({x:0,
y:0});return this.map.toMap({x:qa,y:0}).x-ua.x}),Y=function(qa,ua,Aa){ua=Math.max(1,ua);for(var Ja=Aa?qa[0].length-1:0,Ha=0,Ia,Ba,sa,wa=[[qa[0][Aa?Ja:0]]];Aa&&0<Ja||!Aa&&Ja<qa[0].length-1;){Ba=qa[0][Aa?Ja-1:Ja];sa=qa[0][Aa?Ja:Ja+1];if(Ia=C(Math.sqrt((Ba[0]-sa[0])*(Ba[0]-sa[0])+(Ba[1]-sa[1])*(Ba[1]-sa[1]))))if(Ha+Ia<ua)Aa?wa[0].splice(0,0,Ba):wa[0].push(sa),Ha+=Ia;else{ua=(ua-Ha)/Ia;Aa?wa[0].splice(0,0,[sa[0]-(sa[0]-Ba[0])*ua,sa[1]-(sa[1]-Ba[1])*ua]):wa[0].push([Ba[0]+(sa[0]-Ba[0])*ua,Ba[1]+(sa[1]-
Ba[1])*ua]);break}Ja+=Aa?-1:1}return 0<Ha+Ia?wa:qa},ca=this.get("directions").features[d],ha=new aa(ca.geometry),ea=40*Math.PI/180;e.mixin(ca.attributes,{_index:d});if(d){var ia=Y(this.get("directions").features[d-1].geometry.paths,25,!0),la="esriDMTStop"!==ca.attributes.maneuverType?Y(ha.paths,25,!1):ia;ia=la!==ia?[ia[0].concat(la[0])]:la;var na=(new aa(la)).getExtent();if(1<la[0].length&&15<=C(Math.max(na.getWidth(),na.getHeight()))){Y=15*Math.cos(ea/2);S=15*Math.sin(ea/2);var pa=la[0].length-2;
ea=la[0][pa+1];for(na=0;0<=pa&&!na;){var ta=la[0][pa];na=C(Math.sqrt((ta[0]-ea[0])*(ta[0]-ea[0])+(ta[1]-ea[1])*(ta[1]-ea[1])));pa--}22>na&&(la=na+(22-na)/3,pa=na+2*(22-na)/3,pa=[ta[0]+pa/na*(ea[0]-ta[0]),ta[1]+pa/na*(ea[1]-ta[1])],ta=[ea[0]-la/na*(ea[0]-ta[0]),ea[1]-la/na*(ea[1]-ta[1])],ea=pa,na=22);Y/=na;la=[ea[0]-(ea[0]-ta[0])*Y,ea[1]-(ea[1]-ta[1])*Y];ta[1]!==ea[1]?(Y=(ea[0]-ta[0])/(ea[1]-ta[1]),ta=K(S/Math.sqrt(1+Y*Y)),K=Y*ta):(ta=0,K=K(S));Infinity===Math.abs(ta)||Infinity===Math.abs(K)||isNaN(ta)||
isNaN(K)||(ia[0].push(ea),ia[0].push([la[0]-ta,la[1]+K]),ia[0].push([la[0]+ta,la[1]-K]),ia[0].push(ea))}else ia=Y(ia,2*S(la),!0);ha.paths=ia}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);K=e.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new p([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new L(ca.geometry,K,ca.attributes,this.get("segmentInfoTemplate")),
new L(ha,this.routeSymbol,ca.attributes,this.get("segmentInfoTemplate")),new L(ha,this.segmentSymbol,ca.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));ca=e.hitch(this,function(qa){if(0<qa&&qa<this.directions.features.length){qa=this.directions.features[qa]._associatedFeaturesWithWaypoints;for(var ua=0;ua<qa.length;ua++)qa[ua]._associatedSnapFeature&&
qa[ua]._associatedSnapFeature.getDojoShape()&&qa[ua]._associatedSnapFeature.getDojoShape().moveToFront()}});ca(d-1);ca(d);this.onSegmentHighlight(this.directions.features[d])}},zoomToSegment:function(d){var q=new V;if(this.directions&&this.directions.features){var C=Math.max(0,Math.min(this.directions.features.length-1,d||0));this.map.setExtent(this.get("directions").features[C].geometry.getExtent(),!0).promise.always(e.hitch(this,function(){this.highlightSegment(C);q.resolve()}))}else q.reject(Error("No directions."));
return q.promise},centerAtSegmentStart:function(d){var q=new V;if(this.directions&&this.directions.features){var C=Math.max(0,Math.min(this.directions.features.length-1,d||0));var S=this.directions.features[C];this.map.centerAt(S.geometry.getPoint(0,0)).promise.always(e.hitch(this,function(){this.highlightSegment(C,!0);this._showSegmentPopup(S,C);q.resolve()}))}else q.reject(Error("No directions."));return q.promise},zoomToFullRoute:function(){var d=new V;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(d.resolve)):d.resolve();return d.promise},setListIcons:function(){var d,q=this._dnd.getAllNodes();for(d=0;d<q.length;d++){var C=n("."+this._css.stopIconClass,q[d])[0];C&&(C.innerHTML=this._getLetter(d));z.remove(q[d],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);C=this._getStopSymbol(this.stops[d]);
C===this.fromSymbol?z.add(q[d],this._css.stopOriginClass):C===this.toSymbol?z.add(q[d],this._css.stopDestinationClass):C===this.unreachedSymbol&&z.add(q[d],this._css.stopUnreachedClass)}d=n("[data-reverse-td]",this._dndNode)[0];P.destroy(d);this.get("showReverseStopsButton")&&P.create("td",{"data-reverse-td":"true",rowspan:q.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
H.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(S){S.stopPropagation()},onmouseout:function(S){S.stopPropagation()}},q[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var d=0;d<this.stopGraphics.length;d++)if(this.stopGraphics[d]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==d)){this._stopLayer.add(this.stopGraphics[d]);var q=this.stopGraphics[d].getDojoShape();q&&q.moveToFront();this._stopLayer.add(this.textGraphics[d]);
(q=this.textGraphics[d].getDojoShape())&&q.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var d=this.stops,q=function(ha){var ea={},ia;for(ia in ha)ha.hasOwnProperty(ia)&&0===ia.indexOf("Attr_")&&(ea[ia]=ha[ia]);return ea},C=0;C<d.length;C++){var S=d[C];if(S&&S.feature){var K=S.feature.attributes,Y=K?K.Status:void 0,ca=null;this._isStopAWaypoint(S)||
(ca=new Ca(this._getLetter(C),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&ca.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));ca=new L(S.feature.geometry,ca,{address:S.name},this.get("stopsInfoTemplate"));ca._isStopLabel=!0;ca._index=C;S=new L(S.feature.geometry,this._getStopSymbol(S),e.mixin({address:S.name,Status:void 0===Y?0:Y,CurbApproach:K&&K.CurbApproach?K.CurbApproach:null,TimeWindowStart:K&&K.TimeWindowStart?K.TimeWindowStart:
null,TimeWindowEnd:K&&K.TimeWindowEnd?K.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(S)},q(K)),this.get(this._isStopAWaypoint(S)?"waypointInfoTemplate":"stopsInfoTemplate"));S._isStopIcon=!0;S._index=C;this.stopGraphics[C]=S;this.textGraphics[C]=ca}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(d){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(d);
return this._setTravelMode(d)})},getSupportedTravelModeNames:function(){var d=[],q=this.serviceDescription;if(q&&q.supportedTravelModes&&q.supportedTravelModes.length){q=q.supportedTravelModes;for(var C=0;C<q.length;C++)d.push(q[C].name)}return d},setDirectionsLengthUnits:function(){var d=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(d)})},setDirectionsLanguage:function(){var d=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(d)})},useMyCurrentLocation:function(d){this.clearMessages();return this._createLocateButton(this.geocoders[d],!0,!0)},loadRoute:function(d){return this._enqueue(e.hitch(this,function(){return this._loadRoute(d)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var d=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(e.hitch(this,function(){this.mapClickActive=!d;this.set("mapClickActive",d);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var d=this.get("mapClickActive"),q=e.hitch(this,function(C){for(var S=C?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],K=0;K<S.length;K++)for(var Y=S[K],ca=0;ca<Y.length;ca++){var ha=Y[ca].getDojoShape();ha&&ha[C?"moveToBack":"moveToFront"].call(ha)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),z.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();d?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=h(this.map,"click",e.hitch(this,function(C){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new L(C.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),z.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
z.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());q(!d);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(Xa.FREEHAND_POLYLINE),z.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),z.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var d=this.get("map"),q=d.graphicsLayerIds.length-1;d.reorderLayer(this._routeLayer,q);d.reorderLayer(this._polygonBarriersLayer,q);d.reorderLayer(this._polylineBarriersLayer,q);d.reorderLayer(this._barriersLayer,q);d.reorderLayer(this._waypointsEventLayer,q);
d.reorderLayer(this._stopLayer,q)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(d){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var d=this._clearDirections(!0),q;if(this._watchEvents&&this._watchEvents.length)for(q=0;q<this._watchEvents.length;q++)this._watchEvents[q].unwatch();if(this._onEvents&&this._onEvents.length)for(q=0;q<this._onEvents.length;q++)this._onEvents[q].remove();
if(this._geocoderEvents)for(q=0;q<this._geocoderEvents.length;q++)this._geocoderEvents[q].value.unwatch(),this._geocoderEvents[q].blur.remove(),this._geocoderEvents[q].select.remove(),this._geocoderEvents[q].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return d},_getDirections:function(){var d=new V;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(e.hitch(this,function(q){this.stops=q;this._setStops();this._configureRoute().always(e.hitch(this,function(C){d.resolve(C)}))}),e.hitch(this,function(q){this.set("directions",null);this._clearRouteGraphics();d.reject(q);this.onDirectionsFinish(q)}))):this._clearDirections(!0).always(e.hitch(this,function(){this.createRouteSymbols();d.resolve()}));return d.promise},
_clearDirections:function(){var d=new V;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),d.resolve()):arguments.length?d.resolve():this._reset().then(d.resolve,d.reject):d.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return d.promise},_setTravelMode:function(d){var q=new V,C=this.serviceDescription,S=function(){q.resolve(d)};if(C&&C.supportedTravelModes&&C.supportedTravelModes.length){var K=C.supportedTravelModes,Y=!1;for(C=0;C<K.length;C++)if(K[C].name===d){Y=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==d?(this.routeParams.travelMode=K[C].impedanceAttributeName?K[C]:K[C].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(S)):S();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=K[C].description);break}Y||q.reject(d)}else q.reject(d);return q.promise},_setDirectionsLengthUnits:function(d){this._clearDisplayBeforeSolve();var q=new V;z.remove(this._useMilesNode,this._css.stopsPressedButtonClass);z.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);d===da.KILOMETERS?z.add(this._useKilometersNode,this._css.stopsPressedButtonClass):d===da.MILES&&z.add(this._useMilesNode,this._css.stopsPressedButtonClass);
d===da.KILOMETERS||d===da.METERS||d===da.MILES||d===da.FEET||d===da.YARDS||d===da.NAUTICAL_MILES?(this.directionsLengthUnits=d,q.resolve(d)):q.reject(d);return q.promise},_setDirectionsLanguage:function(d){this._clearDisplayBeforeSolve();var q=new V;d=this._setDirectionsLanguageByLocale(d);this._solveAndZoom().always(function(){q.resolve(d)},q.reject);return q.promise},_showLoadingSpinner:function(d){void 0===d&&(d=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);
d?(z.add(this._widgetContainer,this._css.resultsLoadingClass),z.add(this._resultsNode,"esriRoutesContainerBusy")):(z.remove(this._widgetContainer,this._css.resultsLoadingClass),z.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(d,q){var C=new V;this._requestQueueTail||(this._requestQueueTail=new V,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(e.hitch(this,function(){try{e.mixin(this,{_incrementalSolveStopRange:null},q);var S=d.call(this);S&&"object"===
typeof S&&S.hasOwnProperty("isFulfilled")?S.then(e.hitch(this,function(K){C.resolve(K);this._showLoadingSpinner()}),e.hitch(this,function(K){C.reject(K);this._showLoadingSpinner()})):(C.resolve(S),this._showLoadingSpinner())}catch(K){C.reject(K),this._showLoadingSpinner()}}));this._requestQueueTail=C;this._showLoadingSpinner();return C.promise},_createDnD:function(){this._dnd=new X(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){P.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),
this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=H.widgets.directions.trafficLabelLive,z.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var d=this,q=function(){this._keepDirections||d._clearDisplayBeforeSolve();this._keepDirections=!1},C=e.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),S=e.hitch(this,function(){this.map&&
this.map.enableKeyboardNavigation()});this._departAtTime=new A({required:!0,value:new Date,onChange:q,onFocus:C,onBlur:S},this._departAtTimeContainer);this._departAtDate=new D({required:!0,value:new Date,onChange:q,onFocus:C,onBlur:S,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(d,q,C){if(isNaN(C))this.startTime="now"===C?C:"none";else{q=C instanceof Date?C:new Date(C);C=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;
var S=6E4*-q.getTimezoneOffset();q=new Date(q-S+(C&&C.arriveTimeUTC?C.ETA-C.arriveTimeUTC:S));this._departAtTime._keepDirections=!d;this._departAtDate._keepDirections=!d;this._departAtTime.setValue(q);this._departAtDate.setValue(q)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var d=this._getImpedanceAttribute();d=this._isTimeUnits(d?d.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!d;z[d?"remove":"add"].apply(this,
[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);z[d?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);d||this.set("startTime","now")},_usingAGOL:function(d){d||(d=this.routeTaskUrl);return-1<d.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var d={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,
enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=e.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,d)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var d="EN-US"===b.locale.toUpperCase()?da.MILES:da.KILOMETERS;this.defaults.directionsLengthUnits?d=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(d=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",
d)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new N(Na+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(d,q){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);q||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(d,q){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);q||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,z.remove(this._startTimeButtonNodeContainer,"departAtButton"),z.remove(this._departAtContainer,"departAtContainerVisible")):(z.add(this._startTimeButtonNodeContainer,"departAtButton"),z.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=e.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(d){var q=new V;d?this.get("loaded")?this._reset().then(e.hitch(this,
function(){this._addStops(d).then(q.resolve,q.reject)}),q.reject):this._addStops(d).then(q.resolve,q.reject):q.reject();return q.promise},_removeStop:function(d,q,C,S){var K=new V,Y=e.hitch(this,function(ha){this.stops.splice(ha,1);var ea=this._dnd.getAllNodes()[ha],ia=this.get("geocoders");this._geocoderEvents[ea.id]&&(this._geocoderEvents[ea.id].blur.remove(),this._geocoderEvents[ea.id].select.remove(),this._geocoderEvents[ea.id].suggest.remove(),this._geocoderEvents[ea.id].value.unwatch());ia[ha].destroy();
ia.splice(ha,1);this.set("geocoders",ia);P.destroy(ea);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>d||d>=this.stops.length||void 0===d)d=this.stops.length-1;var ca=!1;for(S=this.stopGraphics[d]&&this._isStopAWaypoint(this.stops[d])||S;!ca;)Y(d),S?ca=!0:(d-=0>=d||d<this.stops.length&&this._isStopAWaypoint(this.stops[d])?0:1,ca=!this._isStopAWaypoint(this.stops[d]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();C?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),K.resolve()):this._solveAndZoom(q).then(K.resolve,K.reject);return K.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(d,q){var C=new V,S=[],K=this.autoSolve;this.autoSolve=!1;void 0===q&&(q=this._getStopCount());
for(var Y=0;Y<Math.min(d.length,this.maxStops-this._getStopCount());Y++){var ca=new V;this._addStop(d[Y],q+Y,!0).always(ca.resolve);S.push(ca)}T(S).always(e.hitch(this,function(){this.autoSolve=K;this._getDirections().always(function(){C.resolve(d)})}));return C.promise},_addStop:function(d,q,C){var S=new V;this._checkMaxStops();this.maxStopsReached?(this._showMessage(H.widgets.directions.error.maximumStops),S.reject(Error(H.widgets.directions.error.maximumStops))):(void 0===d&&void 0===q&&(q=this.stops.length),
d instanceof L&&d.attributes&&d.attributes.isWaypoint&&(!q||q===this.stops.length||2>this._getStopCount())&&!C?(this._showMessage(H.widgets.directions.error.waypointShouldBeInBetweenStops),S.reject(Error(H.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(d).then(e.hitch(this,function(K){this._isStopAWaypoint(K)&&K&&K.feature&&(K.feature.attributes=e.mixin({},K.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(K,q);this.autoSolve&&""!==K.name?this._getDirections().always(function(){S.resolve(K,
q)}):S.resolve(K,q)}),e.hitch(this,function(K){S.reject(K)})));return S.promise},_removeEmptyStops:function(){for(var d=0,q=this.stops.length-this._getWaypointCount()-this.minStops;d<this.stops.length&&0<q;)this.stops[d]&&this.stops[d].name?d++:(this._removeStop(d,!0,!0,!0),q--,this._moveInProgress&&this._handle._index>=d&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(d,q,C){if(d.feature.geometry&&-1<C){var S={address:d.name};this.stopGraphics[C]&&(e.mixin(this.stopGraphics[C].attributes,
S),this.stopGraphics[C].setGeometry(q));this.textGraphics[C]&&(e.mixin(this.textGraphics[C].attributes,S),this.textGraphics[C].setGeometry(q));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(S=this.geocoders[C])&&S.inputNode&&(S.value=d.name,S.inputNode.value=d.name);e.mixin(d.feature.attributes,this.stops[C].feature.attributes);this.stops[C]=d;this.stops[C].feature.setGeometry(q);this._setStops();return this._enqueue(function(){return this._getDirections()})}},
_insertStop:function(d,q){var C;if(void 0===q)for(C=0;C<this.geocoders.length;C++){if(!this.geocoders[C].get("value")){var S=this.geocoders[C];break}}else C=q,this.geocoders[C]&&!this.geocoders[C].get("value")&&(S=this.geocoders[C]);!S||void 0!==q&&q!==C||this._isStopAWaypoint(d)?(void 0===q&&(q=this.geocoders.length),this.stops.splice(q,0,d),this._createGeocoder(d,q)):(this.stops[C]=d,S.set("value",d.name),S._stopReference=d);this._optionsMenu()},_createGeocoder:function(d,q){var C=this._dnd.getAllNodes(),
S=!1,K=!1,Y=C.length;C[q]?(K=C[q],S=!0):S=K=!1;var ca=e.hitch(this,function(la,na){var pa=na?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,ta=na?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;z.replace(la.children[0],pa,ta);2<this.geocoders.length&&(pa=na?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,ta=na?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,z.replace(la.children[3].children[0],pa,ta))}),ha=P.create("tr",{className:this._css.stopClass,
style:this._isStopAWaypoint(d)?"display:none;":"",onmouseover:function(){ca(this,!0)},onmouseout:function(){ca(this,!1)}});P.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},ha);C=P.create("td",{className:this._css.stopIconColumnClass},ha);P.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(Y),"data-center-at":"true"},C);Y=P.create("td",{className:this._css.esriStopGeocoderColumnClass},ha);Y=P.create("div",{},Y);C=P.create("td",{className:this._css.stopIconRemoveColumnClass},
ha);P.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},C);this._dnd.insertNodes(!1,[ha],S,K);S=e.mixin({},this.get("searchOptions"),{value:d.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ea=new Va(S,Y),ia=e.hitch(this,function(la,na){this._enqueue(function(){if(na!==la&&ea._stopReference&&ea._stopReference.name!==na){var pa=t.indexOf(this.stops,ea._stopReference);this.stops[pa]={name:na};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(pa));
this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ea._tr=ha;ea._stopReference=d;ea.startup();this.geocoders.splice(q,0,ea);this._geocoderEvents[ha.id]={blur:ea.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&this.search()}),select:ea.on("select-result",e.hitch(this,function(la){var na=!0;if(la&&(la.results||la.result)){var pa=this._dnd.getAllNodes();pa=t.indexOf(pa,ha);var ta=ea.value,qa=la.results&&
la.results.results&&la.results.results.length?la.results.results[0]:la.result;qa?(qa.name=ta,this.stops[pa]=this._toPointGeometry(qa),this.geocoders[pa]._stopReference=this.stops[pa],ia("",ta)):(this.removeStop(pa),this.set("directions",null),this._showMessage(H.widgets.directions.error.unknownStop.replace("\x3cname\x3e",la.target.get("value"))),this._clearRouteGraphics(),na=!1);na&&this.getDirections()}})),suggest:ea.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var la=
n("LI[role\x3d'menuitem']",this.suggestionsNode),na=0;na<la.length;na++)u.set(la[na],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ea.watch("value",function(la,na,pa){ia(na,pa)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var d=0;d<this.geocoders.length;d++)if(this.geocoders[d].inputNode===document.activeElement){this.geocoders[d]._hideSuggestionsMenu();this.geocoders[d].inputNode.blur();
1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(d){d&&", , "===d.name&&(d.name=d.feature&&d.feature.attributes&&d.feature.attributes.Match_addr?d.feature.attributes.Match_addr+("POI"===d.feature.attributes.Addr_type&&d.feature.attributes.City&&-1===d.feature.attributes.Match_addr.indexOf(d.feature.attributes.City)?", "+d.feature.attributes.City:""):"");return d},_toPointGeometry:function(d){var q=d.feature.geometry;q&&(q.getCentroid?
d.feature.geometry=q.getCentroid():q.getExtent&&(q=q.getExtent())&&(d.feature.geometry=q.getCenter()));return d},_removeLocateButtonVisibilityEvents:function(){for(var d=0;d<this.geocoders.length;d++){var q=this.geocoders[d];q._onMouseEnter&&q._onMouseEnter.remove();q._onMouseOut&&q._onMouseOut.remove();q._onKeyPress&&q._onKeyPress.remove();q._locateButton&&(q._locateButton._onMouseEnter&&q._locateButton._onMouseEnter.remove(),q._locateButton._onMouseOut&&q._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();
for(var d=this,q=function(ea){ea instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;d._createLocateButton(this._geocoder,!0)},C=function(ea){ea instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(e.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||d._destroyLocateButton(this._locateButton)}),400)},S=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);
this._destroyTimeout=setTimeout(e.hitch(this,function(){""===this.value?d._createLocateButton(this._geocoder,!0):d._destroyLocateButton(this._locateButton)}),400)},K=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},Y=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(e.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||d._destroyLocateButton(this._geocoder.inputNode._locateButton)}),
400)},ca=0;ca<this.geocoders.length;ca++){var ha=this.geocoders[ca];ha&&ha.inputNode&&(ha.inputNode._geocoder=ha,ha._onMouseEnter=h(ha.inputNode,f.enter,q),ha._onMouseOut=h(ha.inputNode,[f.leave,"blur"],C),ha._onKeyPress=h(ha.inputNode,"keydown",S),ha.inputNode._locateButton&&(ha=ha.inputNode._locateButton,ha._onMouseEnter=h(ha.domNode,f.enter,K),ha._onMouseOut=h(ha.domNode,f.leave,Y)))}},_createLocateButton:function(d,q,C){var S=new V;d.inputNode._locateButton&&d.inputNode._locateButton._locating?
S.resolve():a(["./LocateButton"],e.hitch(this,function(K){this._destroyLocateButton(d.inputNode._locateButton);if(d&&!this._solveInProgress){var Y=P.create("div",{},d.domNode);z.add(d.domNode,this._css.stopsInnerGeocoderClass);var ca=new K({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},Y);ca.startup();d.inputNode._locateButton=ca;ca.domNode._geocoder=d;this._setLocateButtonVisibilityEvents();K=e.hitch(this,function(){ca._locating=!0;d.set("value","");d.inputNode.placeholder=
H.widgets.directions.retrievingMyLocation.toUpperCase()});ca._onBeforeLocate=h(ca._locateNode,x,K);ca._onLocate=h(ca,"locate",e.hitch(this,function(ha){ca._locating=!1;ha.graphic?(q&&this._destroyLocateButton(d.inputNode._locateButton),this.updateStop(new L(ha.graphic.geometry),t.indexOf(this.geocoders,d)).then(e.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){S.resolve(ha)}):S.resolve(ha)}))):(d.set("value",""),d.inputNode.placeholder=H.widgets.directions.myLocationError.toUpperCase(),
S.reject(ha.error))}));C?(K(),ca.locate().then(null,S.reject)):S.resolve()}else S.resolve()}));return S.promise},_destroyLocateButton:function(d){if(d){var q=d.domNode._geocoder;clearTimeout(q._destroyTimeout);d._locating?q._destroyTimeout=setTimeout(e.hitch(this,function(){q._lbShown_lb||q._lbShown_f||this._destroyLocateButton(d)}),100):(d.clear(),d._onBeforeLocate.remove(),d._onLocate.remove(),d._onMouseEnter&&d._onMouseEnter.remove(),d._onMouseOut&&d._onMouseOut.remove(),d.destroy(),q.inputNode&&
(q.inputNode._locateButton=null,q._setPlaceholder(q.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(e.hitch(this,function(d,q){for(var C,S,K=0;K<this.get("geocoders").length;K++)this.geocoders[K]._stopReference===d?C=K:this.geocoders[K]._stopReference===q&&(S=K);return C>S?1:S>C?-1:0})),this._setStops())},_getCandidate:function(d){var q=new V,C=typeof d;d?"object"===C&&d.hasOwnProperty("feature")&&d.hasOwnProperty("name")?(d.feature.attributes&&void 0!==d.feature.attributes.displayName&&
!this._isStopAWaypoint(d)&&(d.name=d.feature.attributes.displayName,d.feature.attributes.Name=this._userDefinedStopName),d.name=this._isStopAWaypoint(d)?this._waypointName:String(d.name),"point"!==d.feature.geometry.type&&(d.feature.geometry=new ja([d.feature.geometry.x,d.feature.geometry.y],this.map.spatialReference)),q.resolve(d)):"object"===C&&d.hasOwnProperty("address")&&d.hasOwnProperty("location")?(d=this._globalGeocoder._hydrateResult(d),q.resolve(d)):"object"!==C||!d.hasOwnProperty("name")||
null!==d.name&&""!==d.name?d instanceof L&&d.attributes&&(void 0!==d.attributes.Name||d.attributes.isWaypoint)?(C=this._addStopWrapperToGraphic(d,d.attributes.isWaypoint?this._waypointName:String(d.attributes.Name)),String(d.attributes.Name)&&(C.feature.attributes.Name=this._userDefinedStopName),q.resolve(C)):("object"===C&&d.hasOwnProperty("name")&&(d=String(d.name)),this._reverseGeocode(d).then(q.resolve,q.reject)):q.resolve(e.clone(this._emptyStop)):q.resolve(e.clone(this._emptyStop));return q.promise},
_reverseGeocode:function(d){var q=new V,C,S=d.geometry?d.geometry:d;if(this._globalGeocoder){var K=e.hitch(this,function(ea){var ia=new V,la=500;if(this.map){var na=this.map.toScreen(S);na.x+=Z._calculateClickTolerance([ea]);this.map.spatialReference.isWebMercator()?(la=Math.abs(this.map.toMap(na).x-S.x),ia.resolve(la)):4326===this.map.spatialReference.wkid?(la=Math.abs(fa.geographicToWebMercator(this.map.toMap(na)).x-fa.geographicToWebMercator(S).x),ia.resolve(la)):this._geometryService&&(ea=new Ya,
ea.distanceUnit=Sa.UNIT_METER,ea.geometry1=S,ea.geometry2=this.map.toMap(na),this._geometryService.distance(ea,function(pa){la=pa;ia.resolve(la)},function(){ia.resolve(la)}))}return ia.promise}),Y=[],ca=this._globalGeocoder.sources,ha=function(){ca[C].featureLayer&&Y.push(K(ca[C].featureLayer).then(e.hitch(ca[C],function(ea){this.searchQueryParams=e.mixin(this.searchQueryParams,{distance:ea})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(C=0;C<ca.length;C++)ha();else C=this._globalGeocoder.activeSourceIndex,
ha();T(Y).always(e.hitch(this,function(){this._globalGeocoder.search(S).then(e.hitch(this,function(ea){var ia=!1;if(ea){var la=null;for(C=0;C<this._globalGeocoder.sources.length;C++)if(ea[C]&&ea[C].length){var na=ea[C];break}if(na.length&&(ia=!0,la=na[0],this._globalGeocoder.sources[C].featureLayer))for(ea=Number.POSITIVE_INFINITY,C=0;C<na.length;C++){na[C]=this._toPointGeometry(na[C]);var pa=ba.geodesicLengths([new aa({paths:[[fa.xyToLngLat(S.x,S.y),fa.xyToLngLat(na[C].feature.geometry.x,na[C].feature.geometry.y)]],
spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ea>pa&&(ea=pa,la=na[C])}(la=this._decorateEmptyAGOLGeocoderResponse(la))&&""!==la.name&&null!==la.name&&void 0!==la.name?(la.name=String(la.name),isNaN(S.x)||isNaN(S.y)||this.map.spatialReference.wkid!==S.spatialReference.wkid?!la.feature.geometry||isNaN(la.feature.geometry.x)||isNaN(la.feature.geometry.y)?(this._showMessage(H.widgets.directions.error.locator),q.reject(Error(H.widgets.directions.error.locator))):q.resolve(la):
(la.feature.geometry=S,q.resolve(la))):ia=!1}ia||(d instanceof ja?d=new L(d):d instanceof Array&&(d=new L(new ja(d[0],d[1]))),d instanceof L?this._decorateUngeocodedStop(d).then(q.resolve,q.reject):(this._showMessage(H.widgets.directions.error.unknownStop.replace("\x3cname\x3e",d.toString())),q.reject(Error(H.widgets.directions.error.unknownStop.replace("\x3cname\x3e",d.toString())))))}))}))}else this._showMessage(H.widgets.directions.error.locatorUndefined),q.reject(Error(H.widgets.directions.error.locatorUndefined));
return q.promise},_updateStop:function(d,q,C){var S=new V;this.stops&&this.stops[q]?d instanceof L&&d.attributes&&d.attributes.isWaypoint&&(!q||q===this.stops.length-1||2>this._getStopCount())?(this._showMessage(H.widgets.directions.error.waypointShouldBeInBetweenStops),S.reject(Error(H.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(d).then(e.hitch(this,function(K){var Y=K.feature;Y=Y?Y.geometry:null;var ca=this.stops[q].feature;ca=ca?ca.geometry:null;Y=Y&&ca&&(Y.x!==
ca.x||Y.y!==ca.y)||!Y&&ca;this.stops[q]=K;this.geocoders[q]||this._createGeocoder(K,q);ca=this.geocoders[q];ca._stopReference=K;ca._tr.style.display=this._isStopAWaypoint(K)?"none":"";ca.value=K.name;ca.inputNode&&(ca.inputNode.value=K.name);Y&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||C?this._getDirections().then(S.resolve,S.reject):(this._setStops(),S.resolve(K))}),e.hitch(this,function(K){S.reject(K)})):(this._showMessage(H.widgets.directions.error.couldNotUpdateStop),S.reject(Error(H.widgets.directions.error.couldNotUpdateStop)));
this._optionsMenu();return S.promise},_renderDirections:function(){var d=this.get("directions");if(this._resultsNode){var q='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';q+=this._renderDirectionsSummary(d);q+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';q+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';q+=this._renderDirectionsTable(d);q+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=q);this._disconnectResults();(d=n("[data-segment]",this._resultsNode))&&
d.length&&t.forEach(d,e.hitch(this,function(C){this._resultEvents.push(h(C,f.enter,e.hitch(this,function(){if(!this._focusedDirectionsItem){var S=parseInt(u.get(C,"data-segment"),10);this.highlightSegment(S)}})));this._resultEvents.push(h(C,"focusout",e.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(h(C,f.leave,this.unhighlightSegment));this._resultEvents.push(h(C,"click, keydown",e.hitch(this,function(S){S&&("click"===S.type||"keydown"===
S.type&&S.keyCode===v.ENTER)&&(this._focusedDirectionsItem!==C?this.selectSegment(parseInt(u.get(C,"data-segment"),10)):(C.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(d){var q="",C=e.hitch(this,function(){for(var ca={},ha=this._getDirectionsTimeAttribute()||{},ea=this._getTimeNeutralAttribute()||{},ia=0,la=0,na=this.get("stops"),pa=na.length-1;0<=pa;pa--)if(null!==na[pa].feature.attributes.ArriveCurbApproach){ca=
na[pa].feature.attributes;break}for(var ta in ca)ca.hasOwnProperty(ta)&&(ta==="Cumul_"+ha.name&&(ia=ca[ta]),ta==="Cumul_"+ea.name&&(la=ca[ta]));ca="esriTrafficLabelHidden";na=H.widgets.directions.noTraffic;pa=d.totalTime-d.totalDriveTime;pa=(la-this._convertCostValue(pa,ha.units,ea.units))/(ia-pa||1);0<pa&&.8>pa?(ca="esriTrafficLabelHeavy",na=H.widgets.directions.heavyTraffic):1===pa?(ca="esriTrafficLabelNone",na=H.widgets.directions.noTraffic):1.25<pa&&(ca="esriTrafficLabelLight",na=H.widgets.directions.ligthTraffic);
ea=this._formatTime(la,!1,ea.units);return{label:na,labelClass:ca,ratio:pa,noTrafficCostStr:1!==pa&&ea?ea+" "+H.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:ia,noTrafficCost:la,timeAtt:ha}});if(d.totalLength||d.totalTime){C=C();var S=this._getImpedanceAttribute();q+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(S.units))q+=this._formatTime(C.trafficCost,!0,C.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+
H.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+H.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(C.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+C.labelClass+"'\x3e"+C.label+"\x3c/div\x3e"+C.noTrafficCostStr:"")+this._formatDistance(d.totalLength);else{S=(S=H.widgets.directions.units[this.directionsLengthUnits])?S.name:"";var K=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,
Y=this.directions.features[0].attributes;q+=B.format(d.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+S+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(C.noTrafficCost&&K?"\x3cdiv class\x3d'esriTrafficLabel "+C.labelClass+"'\x3e"+C.label+"\x3c/div\x3e"+C.noTrafficCostStr:"")+this._formatTime(d.totalTime)+" "+("none"!==this.startTime&&C.noTrafficCost&&K?H.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(Y.arriveTimeUTC,Y.ETA):"")}q+="\x3c/div\x3e\x3c/div\x3e"}return q},
_renderDirectionsTable:function(d){for(var q=0,C=0,S=0,K='\x3ctable summary\x3d"'+d.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',Y=0;Y<d.features.length;Y++){var ca=d.features[Y].attributes;"esriDMTDepart"===ca.maneuverType&&(C=S=0);S+=ca.length;C+=ca.time;q+=ca.time;K+=this._renderDirectionsItemTR(d.features[Y],S,C,q)}return K+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(d,q,C,S){var K=this.directions,Y=K?t.indexOf(K.features,d):-1;S="";var ca=this._css.routeClass,ha=d._associatedStopWithReturnToStart&&
d._associatedStopWithReturnToStart.attributes,ea=d.attributes;if(-1<Y){ea&&(ea.step=Y+1);ea.maneuverType&&(ca+=" "+ea.maneuverType);ha&&null===ha.ArriveCurbApproach&&null!==ha.DepartCurbApproach?ca+=" "+this._css.routeOriginClass:ha&&null!==ha.ArriveCurbApproach&&null===ha.DepartCurbApproach&&(ca+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);S+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ca+" "+this._css.routeZoomClass+'" data-segment\x3d"'+Y+'"\x3e';S+='\x3ctd class\x3d"'+
this._css.routeIconColumnClass+'"\x3e';S+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';S+=this._getLetter(d._associatedStop);S=S+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');S+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';S+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';d=(K.strings[Y]||[]).slice();if("esriDMTDepart"===ea.maneuverType||"esriDMTStop"===ea.maneuverType)for(K=0;K<this.stops.length;K++)this.stops[K]&&this.stops[K].name&&
d.push({string:this.stops[K].name});if(d){ca=ea.text;for(K=0;K<d.length;K++)ca=this._boldText(ca,d[K].string);ea.formattedText=ca}else ea.formattedText=ea.text;if("esriDMTStop"===ea.maneuverType&&(q||C)||"esriDMTDepart"===ea.maneuverType&&0===Y)q=this._formatDistance(q-ea.length,!0),C=this._formatTime(C-ea.time),Y=this._formatTime(ea.time),d=this._formatDistance(ea.length,!0),ea.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+q+(q&&C?" \x26middot; ":"")+C+(q||C?"\x3cbr\x3e":
"")+(Y?H.widgets.directions.serviceTime+":\x26nbsp;"+Y:"")+(Y&&d?"\x3cbr\x3e":"")+(d?H.widgets.directions.serviceDistance+":\x26nbsp;"+d:"")+"\x3c/div\x3e";S+="\x3cstrong\x3e"+B.format(ea.step)+".\x3c/strong\x3e "+ea.formattedText;S+="\x3c/div\x3e";q=this._formatDistance(ea.length,!0);C=this._formatTime(ea.time);"esriDMTStop"!==ea.maneuverType&&"esriDMTDepart"!==ea.maneuverType||!this.routeParams.startTime||-22091616E5===ea.ETA?q&&(S+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',S+=q,C&&
(S+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+C),S+="\x3c/div\x3e"):S+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ea.arriveTimeUTC,ea.ETA)+"\x3c/div\x3e";S+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return S},_toSpatiallyLocalTimeString:function(d,q){var C=new Date(q),S=new Date(C.getTime()+6E4*C.getTimezoneOffset());S=b.date.locale.format(S,{selector:"time"});var K="";d?(K=(q-d)/1E3/60/60,C=Math.floor(K),K=60*(K-C),C=H.widgets.directions.GMT+(0>C?"":"+")+
B.format(C,{pattern:"00"})+B.format(K,{pattern:"00"}),K=S+" "+C):K="now"===this.startTime?b.date.locale.format(C,{selector:"time"}):S;return K},_addStopWrapperToGraphic:function(d,q){return{extent:new ma({xmin:d.geometry.x-.25,ymin:d.geometry.y-.25,xmax:d.geometry.x+.25,ymax:d.geometry.y+.25,spatialReference:d.geometry.spatialReference}),feature:d,name:q}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();
var d=this.routeParams,q=d.polylineBarriers&&d.polylineBarriers.features||[],C=d.polygonBarriers&&d.polygonBarriers.features||[];t.forEach(d.barriers&&d.barriers.features||[],e.hitch(this,function(S){this._barriersLayer.add(S)}));t.forEach(q,e.hitch(this,function(S){this._polylineBarriersLayer.add(S)}));t.forEach(C,e.hitch(this,function(S){this._polygonBarriersLayer.add(S)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(d){this._clearDisplayAfterSolve();
var q=d.routeResults[0].directions,C=new V;if(q){this.set("solveResult",d);this.set("directions",q);var S=d.routeResults[0].stops,K,Y;if(S&&S.length){var ca=[];for(K=0;K<S.length;K++){var ha=S[K];ha.attributes.isWaypoint=ha.attributes.Name===this._waypointName||ha.attributes.isWaypoint;ha=this._addStopWrapperToGraphic(ha,ha.attributes.Name);this.stops[K]&&this.stops[K].feature&&this.stops[K].feature.attributes&&this.stops[K].feature.attributes.Name===this._userDefinedStopName&&(ha.feature.attributes.Name=
this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===K?this._returnToStartStop=ha:ca.push(ha)}if(this.stops.length>ca.length)for(K=0;K<this.stops.length;K++)this.stops[K].feature||""!==this.stops[K].name||ca.splice(K,0,this._emptyStop);this.stops=ca;for(K=0;K<this.stops.length;K++)this._updateStop(this.stops[K],K);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new L(q.mergedGeometry,this.get("routeSymbol")));S=[];ca=[];for(K=ha=
0;K<q.featuresWithWaypoints.length;K++){var ea=q.featuresWithWaypoints[K];if("esriDMTDepart"===ea.attributes.maneuverType)for(Y=0;Y<this.stops.length;Y++)if(this.stops[Y].feature===ea._associatedStop){ha=Y+1;break}ea.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ea);S.push(ea);(Y=ea.getDojoShape())&&Y.moveToBack();Y=new L(ea.geometry,this._symbolEventPaddingDirections,ea.attributes);Y._nextStopIndex=ha-.5;Y._isSnapFeature=!0;ea._associatedSnapFeature=Y;this._waypointsEventLayer.add(Y);"esriDMTDepart"!==
ea.attributes.maneuverType&&(Y=ea.geometry.getPoint(0,0))&&(Y=new L(Y,this.maneuverSymbol),Y._directionsFeature=ea._associatedFeatureNoWaypoints,ca.push(Y),this._waypointsEventLayer.add(ca[ca.length-1]))}this.set("displayedRouteGraphics",S);this.set("displayedManeuverPointGraphics",ca);this._renderDirections();for(K=0;K<this.stops.length;K++)if(this._isStopAWaypoint(this.stops[K])&&this._modifiedWaypointIndex===K){for(Y=0;Y<q.featuresWithWaypoints.length;Y++)if(S=q.featuresWithWaypoints[Y],S._associatedStop===
this.stops[K].feature){if("esriDMTStop"===S.attributes.maneuverType||"esriDMTDepart"===S.attributes.maneuverType)this.stops[K].feature.geometry.x=S.geometry.paths[0][0][0],this.stops[K].feature.geometry.y=S.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}k.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(d)}else d=d.routeResults[0].route,d.setSymbol(this.routeSymbol),this._routeLayer.add(d),this._incrementalRouteSegment=d;C.resolve();this._moveLayersToFront();
this.createRouteSymbols();return C.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var d=0;d<this.geocoders.length;d++)this.geocoders[d]&&this.stops[d]&&(this.geocoders[d]._stopReference=this.stops[d])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(d){var q=[];if(d&&d.length){for(var C=0;C<d.length;C++)q.push(this._getCandidate(d[C]));return T(q)}d=new V;d.resolve([]);
return d.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";k.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(d){if(d&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var q=d.geometry.getPoint(0,0);d=new L(q,null,d.attributes,this.get("segmentInfoTemplate"));var C=this.get("map").infoWindow;C.setFeatures([d]);C.show(q)}},_addStopButton:function(){this.addStop().then(e.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-
1].focus()}))},_sortGeocoders:function(){var d=this._dnd.getAllNodes();this.geocoders.sort(e.hitch(this,function(C,S){return C.domNode&&C.domNode.parentNode&&C.domNode.parentNode.parentNode&&S.domNode&&S.domNode.parentNode&&S.domNode.parentNode.parentNode?t.indexOf(d,C.domNode.parentNode.parentNode)>t.indexOf(d,S.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var q=0;q<this.geocoders.length;q++)this.geocoders[q]&&this.geocoders[q].inputNode&&
(this.geocoders[q].inputNode.title=H.widgets.directions.stopNoTitle+(q+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var d=0;d<this._resultEvents.length;d++)this._resultEvents[d]&&this._resultEvents[d].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(d){var q="",C;for(C in d)if(0===C.indexOf("Total_")&&d.hasOwnProperty(C)){var S=this._getCostAttribute(C.substr(6));S&&(q+=this._isTimeUnits(S.units)?
this._formatTime(d[C],!1,S.units):this._formatDistance(d[C],!0,S.units),q+=q?" \x26middot; ":"")}q&&(q=H.widgets.directions.toNearbyStops+": \x3cb\x3e"+q.substr(0,q.length-10)+"\x3c/b\x3e");return q},_formatTime:function(d,q,C){C||(C=(this._getDirectionsTimeAttribute()||{}).units);var S="";C=Math.round(this._convertCostValue(d,C,"esriNAUMinutes"));d=Math.floor(C/60);C=Math.floor(C%60);q?S=B.format(d,{pattern:100>d?"00":"000"})+":"+B.format(C,{pattern:"00"}):(d&&(S+=d+" "+H.widgets.directions.time.hr+
" "),S+=d||C?C+" "+H.widgets.directions.time.min:"");return S},_formatDistance:function(d,q,C){C||(C=this.directionsLengthUnits);var S=this.directionsLengthUnits,K=H.widgets.directions.units[S],Y=S.replace("esri","").toLowerCase();d=this._convertCostValue(d,C,S);K&&(Y=q?K.abbr:K.name);return d?B.format(d,{locale:"root",places:2})+" "+Y:""},_projectToGeographic:function(d){var q=new V;if(!d)return q.reject("Directions:: 'geometry' is not defined.",{geometry:d}),q.promise;if(4326==d.spatialReference.wkid)return q.resolve(d),
q.promise;if(!this._geometryService)return q.reject("Directions:: Geometry service is not defined."),q.promise;var C=new Qa;C.outSR=new r(4326);C.geometries=[d];this._geometryService.project(C).then(function(S){q.resolve(S&&S[0])},q.reject);return q.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Ta(this.map));this.drawToolbar||(this.drawToolbar=new Xa(this.map),H.toolbars.draw.freehand=H.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=e.hitch(this,
function(d){var q=new L(d.geometry,null,{BarrierType:0});this._projectToGeographic(d.geographicGeometry||d.geometry).then(e.hitch(this,function(C){1<ba.geodesicLengths([C],da.METERS)[0]&&(this._polylineBarriersLayer.add(q),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new Pa),this.routeParams.polylineBarriers.features.push(q),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=
null)},_createGlobalGeocoder:function(){var d=new V;this._globalGeocoder=new Va(this.get("searchOptions"));h.once(this._globalGeocoder,"load",d.resolve,d.reject);this._globalGeocoder.startup();return d.promise},_init:function(){var d=new V;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);k.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(d.resolve);else h.once(this.get("map"),"load",e.hitch(this,function(){this._configure().always(d.resolve)}));
return d.promise},_setDefaultStops:function(){var d=new V;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(e.hitch(this,function(){this._removeEmptyStops();d.resolve()}),d.reject):d.resolve();return d.promise},_configure:function(){var d=new V;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(e.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=
this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var q=[this._createRouteTask(),this._setDefaultStops()];T(q).then(e.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var C=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||b.locale.toLowerCase();
this._setDirectionsLanguageByLocale(C);this._setupTravelModes().then(e.hitch(this,function(){this.set("loaded",!0);this.onLoad();d.resolve(!0)}),function(S){d.reject(S)})}),function(C){d.reject(C)})}),function(q){d.reject(q)});this._naRouteSharing=null;return d.promise},_setDirectionsLanguageByLocale:function(d){var q=this.serviceDescription.directionsSupportedLanguages,C=function(K){if(q)for(var Y=0;Y<q.length;Y++)if(q[Y].toLowerCase().substr(0,2)===K)return q[Y];return null},S=C(d);S||(d=d.substr(0,
2),S=C(d));this.directionsLanguage=S;return this.routeParams.directionsLanguage=S},_getStopSymbol:function(d,q){var C=d&&(d.feature&&d.feature.attributes||d.attributes),S=this.stopSymbol;C&&(S=this._isStopAWaypoint(d)?this.waypointSymbol:void 0===C.Status||0===C.Status||6===C.Status?null===C.ArriveCurbApproach&&null!==C.DepartCurbApproach?this.get(q?"fromSymbolDrag":"fromSymbol"):null!==C.ArriveCurbApproach&&null===C.DepartCurbApproach?this.get(q?"toSymbolDrag":"toSymbol"):this.get(q?"stopSymbolDrag":
"stopSymbol"):this.get(q?"unreachedSymbolDrag":"unreachedSymbol"));return S},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(d){d.target===this._useMilesNode?this.setDirectionsLengthUnits(da.MILES):d.target===this._useKilometersNode&&this.setDirectionsLengthUnits(da.KILOMETERS)},_toggleCheckbox:function(d){var q=u.get(d.target,"checked");d.target===this._findOptimalOrderNode?
this.set("optimalRoute",q):d.target===this._useTrafficNode?this.set("traffic",q):d.target===this._returnToStartNode&&this.set("returnToStart",q)},_isStopLocated:function(d){return d&&d.feature&&d.feature.attributes&&(!d.feature.attributes.Status||6===d.feature.attributes.Status)},_configureRouteOptions:function(){var d=this.get("routeParams"),q;this.get("directionsLengthUnits")?d.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",d.directionsLengthUnits);d.findBestSequence=
this.get("optimalRoute");if(d.findBestSequence)for(d.preserveFirstStop=this._isStopLocated(this.stops[0]),d.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),q=0;q<this.stops.length;)this._isStopAWaypoint(this.stops[q])?this._removeStop(q,!0,!0):q++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(q=this.stops.length-1;0<q;)this._isStopAWaypoint(this.stops[q])&&
this._removeStop(q,!0,!0),q--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(d.useTimeWindows=!0,"now"===this.startTime)d.timeWindowsAreUTC=!0,d.startTimeIsUTC=!0,d.startTime=new Date;else if("none"===this.startTime)d.startTime=null;else{d.timeWindowsAreUTC=!1;d.startTimeIsUTC=!1;var C=this._departAtTime,S=6E4*C.getValue().getTimezoneOffset();C=new Date(C.getValue().getTime()+this._departAtDate.getValue().getTime()-
S);C=new Date(C.getTime()-6E4*C.getTimezoneOffset());d.startTime=C}else d.startTime=null,d.useTimeWindows=!1;C=this._getImpedanceAttribute();S=this._getTimeNeutralAttribute();var K=this._getDirectionsTimeAttribute();q=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;S&&-1===t.indexOf(q,S.name)&&q.push(S.name);!this._isTimeUnits(C.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&K&&-1===t.indexOf(q,K.name)&&q.push(K.name);this.routeParams.accumulateAttributes=
q;d.returnStops=!0;K=[];for(q=0;q<this.stopGraphics.length;q++)if(this.stopGraphics[q]&&(K.push(new L(this.stopGraphics[q].toJson())),q)){var Y=K[0].attributes,ca=K[q].attributes;for(ha in ca)ca.hasOwnProperty(ha)&&!Y.hasOwnProperty(ha)&&(Y[ha]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var ha=new L(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(ha,ha.attributes.Name);K.push(ha)}else this._returnToStartStop=
null;d.stops.features=K;if(S)for(q=0;q<K.length;q++)K[q].attributes["Attr_"+S.name]=this._convertCostValue(K[q].attributes["Attr_"+C.name],C.units,S.units);this.set("routeParams",d)},_configureRoute:function(){var d=new V;d.promise.always(e.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var q=this._incrementalSolveStopRange;q.start<q.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(q.start,
q.end+1):q.start>q.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(q.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,q.end+1)))}else this._incrementalSolveStopRange=null;var C={},S=this.routeParams.stops.features;for(q=0;q<S.length;q++){var K=S[q].attributes.address;var Y=(q===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:K)+"_"+this._stopSequence++;S[q].attributes.Name=
Y;C[Y]=K;delete S[q].attributes.address;delete S[q].attributes.isWaypoint;delete S[q].attributes.Status}this._solveInProgress=!0;var ca={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,e.hitch(this,function(ha){this._solveResultProcessing(ha,C,ca).then(d.resolve,d.reject)}),e.hitch(this,function(ha){e.mixin(this,ca);this._solveInProgress=!1;for(var ea=0;ea<this.stops.length;ea++)this.stops[ea].feature&&(this.stops[ea].feature.attributes=e.mixin(this.stops[ea].feature.attributes,
{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(ha);d.reject(ha)}));return d.promise},_solveResultProcessing:function(d,q,C){var S=new V;e.mixin(this,C);this._solveInProgress=!1;C=d.routeResults[0];var K=C.directions;C=C.stops;if(K){this._solverMessages=d.messages;var Y=function(la){for(var na in q)if(la&&0===K.routeName.indexOf(na)||!la&&0<K.routeName.indexOf(na))return q[na];return""};var ca=Y(!0);Y=Y(!1);K.routeName=(ca!==this._waypointName?
ca:H.widgets.directions.waypoint)+" \u2014 "+(Y!==this._waypointName?Y:H.widgets.directions.waypoint);for(ca=0;ca<K.features.length;ca++)if(Y=K.features[ca].attributes,"esriDMTDepart"===Y.maneuverType||"esriDMTStop"===Y.maneuverType)for(var ha in q)if(q.hasOwnProperty(ha)&&-1<Y.text.indexOf(ha)){Y.text=Y.text.replace(ha,q[ha]);for(var ea=0;ea<C.length;ea++){var ia=C[ea].attributes;if(ia.Name===ha){e.mixin(K.features[ca],{_associatedStop:C[this.returnToStart&&ea===C.length-1?0:ea],_associatedStopWithReturnToStart:C[ea]});
if(!ia.ArriveTime&&!ia.ArriveTimeUTC&&Y.ETA&&Y.arriveTimeUTC){ia.ArriveTime=Y.ETA;ia.ArriveTimeUTC=Y.arriveTimeUTC;ea=0;if(0==ca&&"esriDMTDepart"===Y.maneuverType||0<ca&&"esriDMTStop"===Y.maneuverType)ea=this._convertCostValue(Y.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ia.DepartTime=ia.ArriveTime+ea;ia.DepartTimeUTC=ia.ArriveTimeUTC+ea}break}}}for(ca=0;ca<C.length;ca++)this._returnToStartStop&&C[ca].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=
ca),C[ca].attributes.Name=q[C[ca].attributes.Name];this._directionsPostprocessing(K);this.traffic&&this._updateMapTimeExtent()}this._showRoute(d).always(e.hitch(this,function(){this._incrementalSolveStopRange=null;S.resolve(d)}));return S.promise},_directionsPostprocessing:function(d){var q,C=function(Y,ca){var ha=d.features[Y]._associatedFeaturesWithWaypoints||[];ha.push(d.featuresWithWaypoints[ca]);d.features[Y]._associatedFeaturesWithWaypoints=ha;d.featuresWithWaypoints[ca]._associatedFeatureNoWaypoints=
d.features[Y]};var S=e.hitch(this,function(Y){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(Y._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});d.featuresWithWaypoints=[];for(q=0;q<d.features.length;q++){var K=new L(d.features[q].toJson());K.setInfoTemplate(new M({title:this._i18n.widgets.directions.maneuver,content:S}));d.featuresWithWaypoints.push(K);d.featuresWithWaypoints[q]._associatedStop=d.features[q]._associatedStop;
d.featuresWithWaypoints[q]._associatedStopWithReturnToStart=d.features[q]._associatedStopWithReturnToStart}d.stringsWithWaypoints=e.mixin([],d.strings);d.eventsWithWaypoints=e.mixin([],d.events);for(S=q=0;q<d.features.length;)d.features[q]._associatedStop&&d.features[q]._associatedStop.attributes.Name===this._waypointName?(d.features.splice(q,q?2:1),d.strings.splice(q,q?2:1),d.events.splice(q,q?2:1),q&&d.features[q]&&"esriDMTStraight"===d.features[q].attributes.maneuverType?(K=d.features.splice(q,
1)[0],d.strings[q-1]=(d.strings[q-1]||[]).concat(d.strings.splice(q,1)[0]||[]),d.strings[q-1].length||(d.strings[q-1]=void 0),d.events[q-1]=(d.events[q-1]||[]).concat(d.events.splice(q,1)[0]||[]),d.events[q-1].length||(d.events[q-1]=void 0),d.features[q-1].attributes.length+=K.attributes.length,d.features[q-1].attributes.time+=K.attributes.time,d.features[q-1].geometry.paths[0]=d.features[q-1].geometry.paths[0].concat(K.geometry.paths[0]),C(q-1,S++),C(q-1,S++),C(q-1,S++)):(q&&C(q-1,S++),q<d.features.length&&
C(q,S++))):(C(q,S++),q++)},_boldText:function(d,q){var C=d;try{var S=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+q.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");C=(" "+C+" ").replace(S,"\x3cstrong\x3e\x26nbsp;"+q+"\x26nbsp;\x3c/strong\x3e");C=C.trim()}catch(K){}return C},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var d=0;d<this.stopGraphics.length;d++)this._stopLayer.remove(this.stopGraphics[d]),this._stopLayer.remove(this.textGraphics[d]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var d=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},q=(new Date).getTime();q="none"==this.startTime?q:d.arriveTimeUTC||q;this._useTrafficItemNode.title="none"!==this.startTime&&d.arriveTimeUTC?H.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(d.arriveTimeUTC,d.ETA):"";this._myTimeExtentUpdate=!0;d=new Date(q);this.map.setTimeExtent(new R(d,
d))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var d=this.displayedRouteGraphics,q=this.displayedManeuverPointGraphics,C=this._routeLayer,S=this._waypointsEventLayer,K=0,Y=0,ca=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};d&&Y<d.length;){if(d[Y]._associatedStop)for(var ha=0;ha<this.stops.length;ha++)if(this.stops[ha].feature===
d[Y]._associatedStop){K=ha;break}K>=ca.start&&K<ca.end||ca.start>=ca.end&&(K>=ca.start||K<ca.end)?(C.remove(d[Y]),d.splice(Y,1)):Y++}C.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",d?d:[]);q&&q.length&&t.forEach(q,function(ea){S.remove(ea)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var d=this.get("map").infoWindow;d&&(d.hide(),d.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(d){var q=this.alphabet,C="",S=function(ca){var ha="";"0123456789"===q||"1234567890"===q?ha=String(ca+1):(ca=ca||0,ca>=q.length&&(ha=S(Math.floor(ca/q.length)-1),ca%=q.length),ha+=q[ca]);return ha},K=d instanceof L?e.hitch(this,function(){for(var ca=this.get("returnToStart")?0:-1,ha=0;ha<this.stops.length;ha++)if(this.stops[ha].feature===
d){ca=ha;break}return ca})():d;if(-1<K&&q&&q.length){q instanceof Array&&(q=q.toString().replace(/,/g,""));C=-1;for(var Y=0;Y<=K;Y++)C+=this._isStopAWaypoint(this.stops[Y])?0:1;C=S(C)}return C},_solveAndZoom:function(d){if(this.autoSolve)return this._getDirections().then(e.hitch(this,function(){d||this.zoomToFullRoute()}));var q=new V;q.resolve();return q.promise},_setupEvents:function(){this._onEvents.push(h(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(h(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",e.hitch(this,function(K){K&&("click"===K.type||"keydown"===K.type&&K.keyCode===v.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(h(this._printButton,"click, keydown",e.hitch(this,function(K){K&&("click"===K.type||"keydown"===K.type&&K.keyCode===v.ENTER)&&this._printDirections()})));this._onEvents.push(h(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",e.hitch(this,function(K){K&&("click"===K.type||"keydown"===
K.type&&K.keyCode===v.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(h(this._dndNode,"[data-remove]:click, [data-remove]:keydown",e.hitch(this,function(K){if(K&&("click"===K.type||"keydown"===K.type&&K.keyCode===v.ENTER)){var Y=n("[data-remove]",this._dndNode);K=t.indexOf(Y,K.target);this.removeStop(K)}})));this._onEvents.push(h(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",e.hitch(this,function(K){if(K&&("click"===K.type||"keydown"===K.type&&K.keyCode===v.ENTER)){var Y=
n("[data-center-at]",this._dndNode);K=t.indexOf(Y,K.target);this.stops[K]&&this.stops[K].feature&&this.stops[K].feature.geometry&&this.map.centerAndZoom(this.stops[K].feature.geometry)}})));this._onEvents.push(h(this.map,"zoom-end",e.hitch(this,function(){var K=this._segmentGraphics;K&&K[0]&&void 0!==K[0].attributes._index&&this.highlightSegment(K[0].attributes._index,!0)})));this._onEvents.push(h(this._dnd,"Drop",e.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var K,Y=!1,ca=
[],ha=this._dnd.getAllNodes();for(K=0;K<this.geocoders.length;K++){var ea=t.indexOf(ha,this.geocoders[K]._tr);if(-1<ea&&K!==ea&&K!==ea-1){for(;0<ea&&this._isStopAWaypoint(this.stops[ea]);)ea--;Y=!0;break}}Y&&(ca=this._markWPsForRemovalAfterUserChangedStopSequence(K,ea));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ca);this.stops[ea].name&&this.getDirections()})));this._onEvents.push(h(this._dnd,"DndStart",e.hitch(this,function(){var K=n("body")[0];z.add(K,this._css.dndDragBodyClass);
this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(h(this._dnd,"DndDrop, DndCancel",e.hitch(this,function(){var K=n("body")[0];z.remove(K,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var d=this._handle,q=e.hitch(this,function(K){var Y=e.hitch(this,function(ha,ea,ia,la,na){var pa=d._isShown();d.setGeometry(ha);d._tooltip.style.left=K.screenPoint.x+"px";d._tooltip.style.top=K.screenPoint.y+"px";!pa||d._index===ia&&d.attributes.isWaypoint===la||(d._remove(),
pa=!1);d.setSymbol(ea);d._index=ia;d._isStopIcon=d._index===Math.floor(d._index);d.attributes.isWaypoint=la;d._isStopIcon&&(d.attributes.address=this.stopGraphics[ia].attributes.address,d.setInfoTemplate(this.stopGraphics[ia].infoTemplate));if(this.canModifyWaypoints||d._isStopIcon)pa||(this._stopLayer.add(d),(ha=d.getDojoShape())&&ha[la?"moveToBack":"moveToFront"].call(ha)),this.editToolbar.activate(Ta.MOVE,d);la=la?d._isStopIcon?H.widgets.directions.dragWaypoint:this.canModifyWaypoints?H.widgets.directions.dragRoute:
"":H.widgets.directions.dragStop;d._showTooltip(na||la)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!d._solveTimeout)if(clearTimeout(d._removeTimeout),(K.graphic._isStopIcon||K.graphic._isStopLabel)&&!K.graphic.attributes.isWaypoint&&this.canModifyStops||K.graphic._isStopIcon&&K.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ca=K.graphic._isStopLabel?this.stopGraphics[K.graphic._index]:K.graphic;Y(ca.geometry,this._getStopSymbol(this.stops[ca._index],
!0),ca._index,!0===ca.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ca._index]);this._stopLayer.remove(this.textGraphics[ca._index])}else if(K.graphic._isSnapFeature||K.graphic._isHandle&&!K.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(K.screenPoint).then(e.hitch(this,function(ha){if(!this.maxStopsReached&&!this._moveInProgress&&ha){for(var ea=this.displayedManeuverPointGraphics,ia=null,la=0;la<
ea.length;la++)if(ea[la].geometry.x===ha.x&&ea[la].geometry.y===ha.y){ia=ea[la]._directionsFeature;ea=t.indexOf(this.directions.features,ia);-1<ea&&this.highlightSegment(ea);break}Y(ha,K.graphic._isHandle?d.symbol:this.waypointSymbol,K.graphic._isHandle?d._index:K.graphic._nextStopIndex,K.graphic._isHandle?d.attributes.isWaypoint:!0,ia)}}))}),C=e.hitch(this,function(){clearTimeout(d._removeTimeout);d._removeTimeout=setTimeout(d._remove,100);this.unhighlightSegment()}),S=e.hitch(this,function(K){if(this.barrierToolActive){K=
K.graphic;var Y=this.routeParams,ca=Y.barriers?t.indexOf(Y.barriers.features,K):-1,ha=Y.polygonBarriers?t.indexOf(Y.polygonBarriers.features,K):-1,ea=Y.polylineBarriers?t.indexOf(Y.polylineBarriers.features,K):-1;-1<ca&&Y.barriers.features.splice(ca,1);-1<ha&&Y.polygonBarriers.features.splice(ha,1);-1<ea&&Y.polylineBarriers.features.splice(ea,1);this._barriersLayer.remove(K);this._polygonBarriersLayer.remove(K);this._polylineBarriersLayer.remove(K);this._clearStopsStatusAttr();this.getDirections(!0)}});
this._onEvents.push(this._waypointsEventLayer.on("mouse-move",q));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",C));this._onEvents.push(this._stopLayer.on("mouse-move",q));this._onEvents.push(this._stopLayer.on("mouse-out",C));this._onEvents.push(this._barriersLayer.on("click",S));this._onEvents.push(this._polylineBarriersLayer.on("click",S));this._onEvents.push(this._polygonBarriersLayer.on("click",S));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));
this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",
this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",e.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",e.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",e.hitch(this,function(){this._createGeometryTask()})));
this._watchEvents.push(this.watch("routeParams",e.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",e.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var K=this.get("searchOptions").sources;if(K)for(var Y=0;Y<this.geocoders.length;Y++)this.geocoders[Y].set("sources",K)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",
this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){k.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){k.set(this._saveMenuButton,"display",
this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var d=e.hitch(this,function(C){var S="";if((C=C.routeResults?C.routeResults[0]:null)&&C.route){C=C.route.attributes;var K=this.routeParams.travelMode;if(K){S+="\x3cb\x3e"+K.name+"\x3c/b\x3e "+H.widgets.directions.toNearbyStops+": ";var Y=void 0!==C["Total_"+K.timeAttributeName]?this._formatTime(C["Total_"+K.timeAttributeName],!1,(this._getCostAttribute(K.timeAttributeName)||{}).units):"";S+=(void 0!==
C["Total_"+K.distanceAttributeName]?this._formatDistance(C["Total_"+K.distanceAttributeName],!0,(this._getCostAttribute(K.distanceAttributeName)||{}).units):"")+(Y?" \x26middot; "+Y:"")}else S=this._formatArbitraryCostsForRouteTooltip(C)}this._handle._showTooltip(S)}),q=e.hitch(this,function(C,S){var K=new V,Y=this._handle,ca=this.map.toScreen(Y._origPoint).offset(C.transform.dx+Y.symbol.xoffset,C.transform.dy+Y.symbol.yoffset);C.origMapPoint||(C.origMapPoint=this.map.toMap(ca));k.set(Y._tooltip,
"left",ca.x+"px");k.set(Y._tooltip,"top",ca.y+"px");clearTimeout(Y._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())Y._solveTimeout=setTimeout(function(){q(C,S).always(K.resolve)},100);else if(Y._isStopIcon){ca=C.graphic._index;var ha=this.stops[ca];(ha=ha?{name:ha.name,extent:ha.extent,feature:new L(ha.feature.toJson())}:null)?(ha.feature.setGeometry(C.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ca])?ca:null,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+ca-1)%this.stops.length:Math.max(0,ca-1),end:this.returnToStart?(ca+1)%this.stops.length:Math.min(this.stops.length-1,ca+1)},this.updateStop(ha,ca,S).always(e.hitch(this,function(ea){Y._solveTimeout=null;ea.routeResults&&d(ea);K.resolve()}))):K.resolve()}else K.resolve();return K.promise});this._onEvents.push(h(this.editToolbar,"graphic-click",e.hitch(this,function(C){if(C.graphic.attributes.isWaypoint)!C.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||
(this._handle._remove(),this._moveInProgress=!0,this.removeStop(C.graphic._index,!0).always(e.hitch(this,function(){this._moveInProgress=!1})));else{var S=this.get("map").infoWindow;S&&(S.setFeatures([C.graphic]),S.show(C.graphic.geometry))}})));this._onEvents.push(h(this.editToolbar,"graphic-move-start",e.hitch(this,function(C){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;C=C.graphic;C._origPoint=new ja(C.geometry.toJson());
C._maxDeviation=0;C._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(h(this.editToolbar,"graphic-move-stop",e.hitch(this,function(C){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)q(C,!0).always(e.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));
else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var S=this.stops[C.graphic._index],K=(S&&S.feature&&S.feature.attributes&&S.feature.attributes.Name)===this._userDefinedStopName,Y=S&&S.name;this._reverseGeocode(new L(C.graphic.toJson())).then(e.hitch(this,function(ca){K&&(ca.name=Y,ca.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ca,ca.feature.geometry,C.graphic._index).always(e.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();
this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(h(this.editToolbar,"graphic-move",e.hitch(this,function(C){var S=this._handle,K=C.transform;K.dx&&K.dy&&(C.graphic._maxDeviation=Math.max(S._maxDeviation,Math.sqrt(K.dx*K.dx+K.dy*K.dy)));10<S._maxDeviation&&(S._solveHasHappened=!0,C.graphic===S&&S.attributes.isWaypoint&&!S._isStopIcon?(this.set("optimalRoute",!1),S._index+=.5,S._isStopIcon=!0,C.graphic._stopIndex=S._index,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+S._index-1)%this.stops.length:Math.max(0,S._index-1),end:this.returnToStart?(S._index+1)%(this.stops.length+1):Math.min(this.stops.length,S._index+1)},this.addStop({name:this._waypointName,feature:new L(S.geometry,S.symbol,{isWaypoint:!0,CurbApproach:3})},C.graphic._stopIndex)):((S=C.graphic.getDojoShape())&&S.moveToFront(),q(C)))})))},_isStopAWaypoint:function(d){return d&&d.feature&&d.feature.attributes&&d.feature.attributes.isWaypoint},_getStopCount:function(){var d=
0,q;for(q=0;q<this.stops.length;q++)d+=!this._isStopAWaypoint(this.stops[q])&&this.stops[q].name?1:0;return d},_getWaypointCount:function(){var d=0,q;for(q=0;q<this.stops.length;q++)d+=this._isStopAWaypoint(this.stops[q])?1:0;return d},_decorateUngeocodedStop:function(d){var q=new V,C=function(K,Y){q.resolve({name:void 0===K?H.widgets.directions.unlocatedStop:K.toFixed(6)+" "+Y.toFixed(6),feature:d})};if(d.geometry)if(d.geometry.spatialReference&&4326!==d.geometry.spatialReference.wkid)if(this.map&&
this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var S=fa.xyToLngLat(d.geometry.x,d.geometry.y);C(S[0],S[1])}else this._geometryService?(S=new Qa,S.outSR=new r(4326),S.geometries=[d.geometry],this._geometryService.project(S).then(e.hitch(this,function(K){K&&K.length?C(K[0].x,K[0].y):C(d.geometry.x,d.geometry.y)}),e.hitch(this,function(){C()}))):C(d.geometry.x,d.geometry.y);else C(d.geometry.x,d.geometry.y);else C();return q.promise},_trafficLayerUpdate:function(d,q,C){d=this.get("map");
q&&this._trafficLayerAdded&&(d.removeLayer(q),this._trafficLayerAdded=!1);C&&this.get("traffic")&&!this._trafficLayerAdded&&(d.addLayer(C),C.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(d){var q=H.widgets.directions.error.routeTask,C=d.details,S=function(K){return(res=K.match(/(\d+)/))?": "+res[0]:"."};C&&1===C.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===C[0]?q=H.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
C[0]?q=H.widgets.directions.error.nonNAmTruckingMode:0===C[0].indexOf("The number of input locations loaded into Barriers")?q=H.widgets.directions.error.tooManyBarriers+S(C[0]):0===C[0].indexOf("The number of input locations loaded into PolygonBarriers")?q=H.widgets.directions.error.tooManyPolygonBarriers+S(C[0]):0===C[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(q=H.widgets.directions.error.tooManyPolylineBarriers+S(C[0])));this._showMessage(q);this.onDirectionsFinish(d)},
_showMessage:function(d,q){var C="";this.messages.push({msg:d,error:!q});if(this.messages.length){C+="\x3cul\x3e";for(var S=0;S<this.messages.length;S++)C+='\x3cli class\x3d"'+(this.messages[S].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[S].msg+"\x3c/li\x3e";C+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=C);if(!q)this.onError(d)},_isTimeUnits:function(d){return"milliseconds"===d||"esriNAUSeconds"===d||"esriNAUMinutes"===d||"esriNAUHours"===d||"esriNAUDays"===
d},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var d=
(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(d)},_getCostAttribute:function(d){for(var q=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],C,S=0;S<q.length;S++)if(q[S].name===d&&"esriNAUTCost"===q[S].usageType){C=q[S];break}return C},_convertCostValue:function(d,q,C){var S=this._isTimeUnits(q),K=this._isTimeUnits(C);q=S?this._toMinutes(d,q):this._toMeters(d,q);return S===K?K?this._fromMinutes(q,C):this._fromMeters(q,
C):d},_toMinutes:function(d,q,C){d=d||0;switch(q){case "milliseconds":d/=Math.pow(6E4,C?-1:1);break;case "esriNAUSeconds":d/=Math.pow(60,C?-1:1);break;case "esriNAUHours":d*=Math.pow(60,C?-1:1);break;case "esriNAUDays":d*=Math.pow(1440,C?-1:1)}return d},_fromMinutes:function(d,q){return this._toMinutes(d,q,!0)},_toMeters:function(d,q,C){d=d||0;switch((q||"").replace("esriNAU","esri")){case "esriInches":d*=Math.pow(.0254,C?-1:1);break;case "esriFeet":d*=Math.pow(.3048,C?-1:1);break;case "esriYards":d*=
Math.pow(.9144,C?-1:1);break;case "esriMiles":d*=Math.pow(1609.344,C?-1:1);break;case "esriNauticalMiles":d*=Math.pow(1851.995396854,C?-1:1);break;case "esriMillimeters":d/=Math.pow(1E3,C?-1:1);break;case "esriCentimeters":d/=Math.pow(100,C?-1:1);break;case "esriKilometers":d*=Math.pow(1E3,C?-1:1);break;case "esriDecimeters":d/=Math.pow(10,C?-1:1)}return d},_fromMeters:function(d,q){return this._toMeters(d,q,!0)},_createRouteTask:function(){var d=new V;this.set("routeTask",new Oa(this.get("routeTaskUrl")));
this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(e.hitch(this,function(q){q.networkDataset?(this.set("serviceDescription",q),this.set("maxStops",parseInt(this.userOptions.maxStops||q.serviceLimits&&q.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,d.resolve()):this.routeTask.getOwningSystemUrl().then(e.hitch(this,function(C){this.owningSystemUrl=
C;d.resolve()}),d.reject)):(this._showMessage(H.widgets.directions.error.cantFindRouteServiceDescription),d.reject(Error(H.widgets.directions.error.cantFindRouteServiceDescription)))}),e.hitch(this,function(){this._showMessage(H.widgets.directions.error.cantFindRouteServiceDescription);d.reject(Error(H.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return d.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&
1<this._globalGeocoder.sources.length){var d=e.hitch(this,function(S){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",S);for(var K=0;K<this.geocoders.length;K++)this.geocoders[K].set("activeSourceIndex",S);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var q=[{value:"all",label:H.widgets.Search.main.all,selected:!0}],C=0;C<this._globalGeocoder.sources.length;C++)q.push({value:String(C),label:this._globalGeocoder.sources[C].name});
this._searchSourceSelector=new J({className:"esriSearchSourcesDDL",style:"width:100%;",options:q},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",d);this._searchSourceSelector.domNode.style.width=""}d("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new J({className:"esriTravelModesDDL",style:"width:100%;"},
this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",e.hitch(this,function(d){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(d).always(e.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var d=this.get("serviceDescription"),q=d.supportedTravelModes,C=new V;if(q&&q.length&&
this._travelModeSelector){for(var S=q[0].name,K=[],Y=0;Y<q.length;Y++){for(var ca="AUTOMOBILE"===q[Y].type?"Driving":"TRUCK"===q[Y].type?"Trucking":"WALK"===q[Y].type?"Walking":"Other",ha="",ea=d.networkDataset.networkAttributes,ia=0;ia<ea.length;ia++){var la=ea[ia];if(la.name===q[Y].impedanceAttributeName){if("esriNAUCentimeters"===la.units||"esriNAUDecimalDegrees"===la.units||"esriNAUDecimeters"===la.units||"esriNAUFeet"===la.units||"esriNAUInches"===la.units||"esriNAUKilometers"===la.units||"esriNAUMeters"===
la.units||"esriNAUMiles"===la.units||"esriNAUMillimeters"===la.units||"esriNAUNauticalMiles"===la.units||"esriNAUYards"===la.units)ha="Distance";else if("esriNAUDays"===la.units||"esriNAUHours"===la.units||"esriNAUMinutes"===la.units||"esriNAUSeconds"===la.units)ha="Time";break}}K.push({id:q[Y].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ca+ha+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+q[Y].description+'"\x3e'+q[Y].name+"\x3c/div\x3e"});
!d.defaultTravelMode||q[Y].id!==d.defaultTravelMode&&q[Y].itemId!==d.defaultTravelMode||(S=q[Y].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new g({objectStore:new F({data:K})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(S);this._setTravelMode(S).always(C.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),C.resolve();return C.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?
this.printTaskUrl:this.defaults.printTaskUrl)?new $a(this.printTaskUrl,{async:!1}):null;var d=new Ga;d.exportOptions={width:670,height:750,dpi:96};d.format="PNG32";d.layout="MAP_ONLY";d.preserveScale=!1;d.showAttribution=!1;var q=new Za;q.map=this.map;q.outSpatialReference=this.map.spatialReference;q.template=d;this._printParams=q},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new Sa(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=
this.defaults.geometryTaskUrl?new Sa(this.defaults.geometryTaskUrl):Ua.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var d=this.get("serviceDescription");k.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&d&&d.supportedTravelModes&&d.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){k.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){k.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){k.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){k.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var d=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new Pa,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var q=new Ra;this.routeParams=e.mixin(q,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),d)},
_markWPsForRemovalAfterUserChangedStopSequence:function(d,q){for(var C=d-1,S=[];0<=C&&this._isStopAWaypoint(this.stops[C]);)S.push(this.stops[C]),C--;for(C=d+1;C<this.stops.length&&this._isStopAWaypoint(this.stops[C]);)S.push(this.stops[C]),C++;if(q>d)for(C=q+1;C<this.stops.length&&this._isStopAWaypoint(this.stops[C]);)S.push(this.stops[C]),C++;else if(void 0!==q)for(C=q-1;0<=C&&this._isStopAWaypoint(this.stops[C]);)S.push(this.stops[C]),C--;else if(this.returnToStart&&0===d)for(C=this.stops.length-
1;0<=C&&this._isStopAWaypoint(this.stops[C]);)S.push(this.stops[C]),C--;return S},_removeSomeWaypoints:function(d){for(var q=new V,C=[],S=0;S<d.length;S++){var K=t.indexOf(this.stops,d[S]);-1<K&&C.push(this._removeStop(K,!0,!0))}T(C).always(q.resolve);return q.promise},_modifyStopSequence:function(d,q){var C=this._dnd.getAllNodes(),S=new V,K,Y=[];if(C.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==d)if(0<=d&&0<=q&&d<this.stops.length&&q<this.stops.length&&d!==q){C=
this._markWPsForRemovalAfterUserChangedStopSequence(d,q);var ca=this.stops.splice(d,1);this.stops.splice(q,0,ca[0]);for(K=0;K<this.stops.length;K++)Y.push(this._updateStop(this.stops[K],K));Y.push(this._removeSomeWaypoints(C));T(Y).always(e.hitch(this,function(){this._solveAndZoom().always(S.resolve)}))}else S.reject("Invalid From and To values.");else{for(K=0;K<this.stops.length;)this._isStopAWaypoint(this.stops[K])?Y.push(this._removeStop(K,!0,!0)):K++;T(Y).always(e.hitch(this,function(){Y=[];this.stops.reverse();
for(K=0;K<this.stops.length;K++)Y.push(this._updateStop(this.stops[K],K));T(Y).always(e.hitch(this,function(){this._solveAndZoom().always(S.resolve)}))}))}else S.resolve();return S.promise},_setMenuNodeValues:function(d){"traffic"!==d&&this._clearDisplayBeforeSolve();d=this.get("optimalRoute");this._findOptimalOrderNode&&u.set(this._findOptimalOrderNode,"checked",d);this._returnToStartNode&&(d=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),
u.set(this._returnToStartNode,"checked",d),this.set("returnToStart",d),this.maxStopsReached&&this.returnToStart&&this._showMessage(H.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,d=this.stops.length;0<d--&&this._isStopAWaypoint(this.stops[d]);)this._removeSomeWaypoints([this.stops[d]]);
this._useTrafficNode&&(u.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case da.KILOMETERS:u.set(this._useKilometersNode,"checked",!0);u.set(this._useMilesNode,"checked",!1);break;case da.MILES:u.set(this._useKilometersNode,"checked",!1),u.set(this._useMilesNode,"checked",!0)}k.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");k.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&k.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&k.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&k.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?z.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(z.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===k.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?z.add(this._widgetContainer,this._css.stopsRemovableClass):
z.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(d,q,C){z.remove(this.domNode,q);z.add(this.domNode,C)},_toggleOptionsMenu:function(){"block"===k.get(this._optionsMenuNode,"display")?(k.set(this._optionsMenuNode,"display","none"),z.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
H.widgets.directions.showOptions):(k.set(this._optionsMenuNode,"display","block"),z.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=H.widgets.directions.hideOptions)},_toggleSaveMenu:function(d){"block"===k.get(this._saveMenuNode,"display")||!1===d?(k.set(this._saveMenuNode,"display","none"),z.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),k.set(this._saveMenuNode,"display","block"),z.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(e.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var q=this._folderSelector.store.objectStore.data,C=0;C<q.length;C++)if(q[C].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==q[C].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(q[C].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){z[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(P,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(d){d=a.toUrl(d);return/^https?:/i.test(d)?d:/^\/\//i.test(d)?Na+d:/^\//i.test(d)?Na+"//"+window.location.host+d:d},_getManeuverImage:function(d){return d?"esriDMTStop"===d||"esriDMTDepart"===d?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+d+".png"):""},_loadPrintDirections:function(d){var q=this.get("printTemplate"),C=new V;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(C.resolve,
C.reject):C.resolve();C.then(e.hitch(this,function(){if(!q&&this.directions){var S=this._getAbsoluteUrl("./css/Directions.css"),K=this._getAbsoluteUrl("./css/DirectionsPrint.css"),Y=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ca=l.isBodyLtr()?"ltr":"rtl";q="";q+="\x3c!DOCTYPE HTML\x3e";q+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ca+'"\x3e';q+="\x3chead\x3e";q+='\x3cmeta charset\x3d"utf-8"\x3e';q+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
q+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";q+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+S+'" /\x3e';q+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+K+'" /\x3e';q+="\x3c/head\x3e";q+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';q+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';q+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+H.common.close+'" onclick\x3d"window.close();"\x3e'+
H.common.close+"\x3c/div\x3e";q+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+H.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+H.widgets.directions.print+"\x3c/div\x3e";q+="\x3c/div\x3e";q+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';q+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';q+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+Y+'" /\x3e';q+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";q+=this._renderDirectionsSummary(this.directions);d&&(q+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',q+='\x3chr class\x3d"esriNoPrint"/\x3e');q+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';q+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+H.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
q+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';q+="\x3c/div\x3e";q+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';q+=this._renderDirectionsTable(this.directions);q+="\x3c/div\x3e";q+="\x3c/div\x3e";q+="\x3c/div\x3e";q+="\x3c/body\x3e";q+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(q);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var d=
this._searchSourceSelector;if(this._searchSourceSelector){var q=d.containerNode.firstChild;k.set(q,"width","");d.domNode.clientWidth>this.domNode.clientWidth&&k.set(q,"width",this._searchSourceContainerNode.clientWidth-20+"px")}},_printDirections:function(){if(this.directions){var d=screen.width/2,q=screen.height/1.5;d="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+d+", height\x3d"+q+", top\x3d"+(screen.height/2-q/2)+
", left\x3d"+(screen.width/2-d/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",d,!0)):(this._printWindow=window.open("","directions_widget_print",d,!0),this._loadPrintDirections(!!this._printService),this._printService&&a(["dojo/_base/window"],e.hitch(this,function(C){this.zoomToFullRoute().then(e.hitch(this,function(){this._printService.execute(this._printParams,e.hitch(this,function(S){C.withDoc(this._printWindow.document,
function(){var K=c.byId("divMap");K&&(z.remove(K,"esriPrintWait"),z.add(K,"esriPageBreak"),P.create("img",{src:S.url,"class":"esriPrintMapImg"},K))})}),e.hitch(this,function(S){C.withDoc(this._printWindow.document,function(){var K=c.byId("divMap");K&&z.remove(K,"esriPrintWait")})}))}))})))}},_enableButton:function(d,q){var C=q||void 0===q;z[C?"remove":"add"].apply(this,[d,"esriDisabledDirectionsButton"]);d._enabled=C},_clearStopsStatusAttr:function(){for(var d=0;d<this.stops.length;d++)this.stops[d].feature&&
this.stops[d].feature.attributes&&(this.stops[d].feature.attributes.Status=void 0)},_enableSharing:function(){var d=new V;!this._naRouteSharing&&this.owningSystemUrl?a(["../tasks/NARouteSharing"],e.hitch(this,function(q){this._naRouteSharing=new q(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new J({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:e.hitch(this,function(){this._folderSelector._interractive?
this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new G({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:e.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:e.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),
onBlur:e.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(e.hitch(this,function(C){for(var S=[],K=0;K<C.length;K++)S.push({id:C[K].url,folderId:C[K].id,label:C[K].title});this._folderSelector.setStore(new g({objectStore:new F({data:S})}));this._naRouteSharing.canCreateItem().then(e.hitch(this,function(Y){this._folderSelector.set("disabled",!Y);this._userCanCreatePortalItem=Y}));this._enableButton(this._saveButton);
d.resolve()}),e.hitch(this,function(C){this._naRouteSharing=null;this._toggleSaveMenu(!1);d.reject(C)}))})):this.owningSystemUrl?d.resolve():(d.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return d.promise},_storeRouteUI:function(){var d=new V;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(d.resolve,
d.reject):(this._outputLayer&&this._outputLayer.focus(),d.reject(Error("Need result layer name specified.")));return d.promise},_storeRoute:function(d,q,C){var S=new V,K=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),S.reject(Error("Not ready to store route.")),S.promise;this.clearMessages();S.then(null,e.hitch(this,function(va){this._showMessage(H.widgets.directions.error.cantSaveRoute)}));S.promise.always(e.hitch(this,function(){this._enableButton(this._saveButton);
k.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(K&&K.features&&K.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(d&&q){var Y=e.hitch(this,function(va){return this._naRouteSharing.getAttributeUnits(va,this.serviceDescription)});var ca=this.routeParams.travelMode.timeAttributeName;var ha=this.routeParams.travelMode.distanceAttributeName,
ea=Y(ca),ia=Y(ha),la=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,na=this._naRouteSharing.toMeters,pa=this._naRouteSharing.toMinutes,ta=function(va,za,Fa){var Ka;for(Ka in va)if(va.hasOwnProperty(Ka)&&0===Ka.indexOf(za)&&-1===t.indexOf(Fa,Ka.substr(za.length))){var ab=ab||{};ab[Ka.substr(za.length)]=va[Ka]}return ab},qa=[],ua=[],Aa=[];if(ca&&ea&&ha&&ia){var Ja=[],Ha=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],
Ia=this.serviceDescription.networkDataset.networkAttributes;for(Y=0;Y<Ia.length;Y++)"esriNAUTCost"===Ia[Y].usageType&&-1===t.indexOf(Ha,Ia[Y].name)&&Ia[Y].name!==ca&&Ia[Y].name!==ha&&Ja.push(Ia[Y].name);Ha=this.get("stops");var Ba={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(Y=0;Y<Ha.length;Y++)if(Ha[Y].feature&&Ha[Y].feature.toJson){Ia=Ha[Y].feature.toJson();var sa=Ia.attributes;var wa=Ia.geometry,La=this._naRouteSharing.getUTCOffset(sa.ArriveTime,sa.ArriveTimeUTC),Ma=this._naRouteSharing.getUTCOffset(sa.DepartTime,
sa.DepartTimeUTC);e.mixin(Ba,{xmin:Ba.xmin>wa.x?wa.x:Ba.xmin,ymin:Ba.ymin>wa.y?wa.y:Ba.ymin,xmax:Ba.xmax<wa.x?wa.x:Ba.xmax,ymax:Ba.ymax<wa.y?wa.y:Ba.ymax});Ia.attributes={__OBJECTID:Y+1,CurbApproach:sa.CurbApproach,ArrivalCurbApproach:sa.ArriveCurbApproach,DepartureCurbApproach:sa.DepartCurbApproach,Name:sa.Name===this._waypointName?H.widgets.directions.waypoint:sa.Name===this._userDefinedStopName?Ha[Y].name:sa.Name,RouteName:K.routeName,Sequence:sa.Sequence,Status:sa.Status,LocationType:sa.isWaypoint?
1:0,TimeWindowStart:sa.TimeWindowStart,TimeWindowEnd:sa.TimeWindowEnd,TimeWindowStartUTCOffset:La,TimeWindowEndUTCOffset:La,ServiceMinutes:pa(sa["Attr_"+ca],ea),ServiceMeters:na(sa["Attr_"+ha],ia),ServiceCosts:I.stringify(ta(sa,"Attr_",Ja)),CumulativeMinutes:pa(sa["Cumul_"+ca],ea),CumulativeMeters:na(sa["Cumul_"+ha],ia),CumulativeCosts:I.stringify(ta(sa,"Cumul_",Ja)),LateMinutes:pa(sa["Violation_"+ca],ea),WaitMinutes:pa(sa["Wait_"+ca],ea),ArrivalTime:this._naRouteSharing.toUTCTime(sa.ArriveTime,La),
DepartureTime:this._naRouteSharing.toUTCTime(sa.DepartTime,Ma),ArrivalUTCOffset:La,DepartureUTCOffset:Ma};qa.push(Ia)}ha=0;ia=function(va){try{va.strings=I.parse(va.strings)}catch(Fa){bb.strings=void 0}if(va.strings&&va.strings.length)for(var za=0;za<va.strings.length;za++)if("esriDSTGeneral"===va.strings[za].stringType)return va.strings[za].string};Ha=function(va,za){for(var Fa=[],Ka=0;Ka<(va||[]).length;Ka++)va[Ka].stringType!==za&&za||Fa.push(va[Ka].string);return Fa.length?Fa.toString():void 0};
Ia=function(va){switch(va){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";
case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";
case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};
for(Y=0;Y<K.featuresWithWaypoints.length;Y++){var Wa=K.featuresWithWaypoints[Y];wa=Wa.toJson();La=wa.attributes;Ma=wa.geometry&&wa.geometry.paths&&wa.geometry.paths[0]||[];var cb=wa.geometry.hasM||Ma[0]&&3===Ma[0].length;sa=this._naRouteSharing.getUTCOffset(La.ETA,La.arriveTimeUTC);wa.attributes={__OBJECTID:Y+1,Sequence:++ha,StopID:function(){var va=void 0,za=Wa._associatedStopWithReturnToStart&&Wa._associatedStopWithReturnToStart.attributes.Sequence;if(za)for(var Fa=0;Fa<qa.length;Fa++)if(qa[Fa].attributes.Sequence===
za){va=qa[Fa].attributes.__OBJECTID;break}return va}(),DirectionPointType:Ia(La.maneuverType),DisplayText:Wa._associatedStopWithReturnToStart&&Wa._associatedStopWithReturnToStart.attributes.isWaypoint?La.text.replace(this._waypointName,H.widgets.directions.waypoint):La.text,ArrivalTime:this._naRouteSharing.toUTCTime(La.ETA,sa),ArrivalUTCOffset:sa,Azimuth:void 0,Name:Ha(K.stringsWithWaypoints[Y],"esriDSTStreetName"),AlternateName:Ha(K.stringsWithWaypoints[Y],"esriDSTAltName"),ExitName:Ha(K.stringsWithWaypoints[Y],
"esriDSTExit"),IntersectingName:Ha(K.stringsWithWaypoints[Y],"esriDSTCrossStreet"),BranchName:Ha(K.stringsWithWaypoints[Y],"esriDSTBranch"),TowardName:Ha(K.stringsWithWaypoints[Y],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete wa.symbol;delete wa.infoTemplate;Ma.length?(wa.geometry={x:Ma[0][0],y:Ma[0][1],spatialReference:wa.geometry.spatialReference},cb&&e.mixin(wa.geometry,{m:Ma[0][2]})):delete wa.geometry;ua.push(wa);wa=Wa.toJson();La=wa.attributes;Ma=
wa.geometry&&wa.geometry.paths&&wa.geometry.paths[0]||[];sa=!0;for(ca=0;ca<Ma.length-1;ca++)if(Ma[ca][0]!==Ma[ca+1][0]||Ma[ca][1]!==Ma[ca+1][1]){sa=!1;break}sa||(wa.attributes={DirectionPointID:Y+1,DirectionLineType:"esriDLTSegment",Meters:na(La.length,la),Minutes:pa(La.time,ea),FromLevel:void 0,ToLevel:void 0},wa.geometry.hasM=cb,delete wa.symbol,delete wa.infoTemplate,Aa.push(wa));var bb=K.eventsWithWaypoints[wa.attributes.Sequence]||[];for(ca=0;ca<bb.length;ca++)wa=bb[ca].toJson(),La=wa.attributes,
sa=this._naRouteSharing.getUTCOffset(La.ETA,La.arriveTimeUTC),wa.attributes={Sequence:++ha,DirectionPointType:"esriDPTEvent",DisplayText:ia(La),ArrivalTime:this._naRouteSharing.toUTCTime(La.ETA,sa),ArrivalUTCOffset:sa,Name:La.strings},ua.push(wa)}ca=this.routeParams.barriers&&this.routeParams.barriers.features||[];var db=[];for(Y=0;Y<ca.length;Y++)ha=ca[Y].toJson(),ia=ha.attributes,ha.attributes={BarrierType:ia.BarrierType||0,FullEdge:ia.FullEdge||!1,AddedCost:ia["Attr_"+this._getImpedanceAttribute().name]||
0,Costs:I.stringify(ta(ia,"Attr_",Ja)),CurbApproach:ia.CurbApproach||0,Name:ia.Name},db.push(ha);ca=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var eb=[];for(Y=0;Y<ca.length;Y++)ha=ca[Y].toJson(),ia=ha.attributes,ha.attributes={BarrierType:ia.BarrierType||0,ScaleFactor:ia["Attr_"+this._getImpedanceAttribute().name]||1,Costs:I.stringify(ta(ia,"Attr_",Ja)),Name:ia.Name},eb.push(ha);ca=this.routeParams.polygonBarriers&&this.routeParams.polygonBarriers.features||
[];var fb=[];for(Y=0;Y<ca.length;Y++)ha=ca[Y].toJson(),ia=ha.attributes,ha.attributes={BarrierType:ia.BarrierType||0,ScaleFactor:ia["Attr_"+this._getImpedanceAttribute().name]||1,Costs:I.stringify(ta(ia,"Attr_",Ja)),Name:ia.Name},fb.push(ha);var gb={geometry:K.mergedGeometry,attributes:{RouteName:K.routeName,TotalMinutes:pa(K.totalTime,ea),TotalMeters:na(K.totalLength,la),TotalLateMinutes:function(){for(var va=0,za=0;za<qa.length;za++)va+=qa[za].attributes.LateMinutes||0;return va}(),TotalWaitMinutes:function(){for(var va=
0,za=0;za<qa.length;za++)va+=qa[za].attributes.WaitMinutes||0;return va}(),TotalCosts:qa[qa.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?qa[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?qa[qa.length-1].attributes.DepartureTime:null,StartUTCOffset:qa[0].attributes.ArrivalUTCOffset,EndUTCOffset:qa[qa.length-1].attributes.DepartureUTCOffset,Messages:I.stringify(this._solverMessages),AnalysisSettings:I.stringify({travelMode:e.hitch(this,function(){var va=e.clone(this.routeParams.travelMode);
"\x26lt;"===va.name.substr(0,4)&&"\x26gt;"===va.name.substr(va.name.length-4,4)&&(va.name=va.name.substr(4,va.name.length-8));return va})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,accumulateAttributeNames:this.routeParams.accumulateAttributes||
this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);e.hitch(this,function(){var va=new V;this._printService?this.zoomToFullRoute().then(e.hitch(this,function(){var za=this._printParams.template,Fa=za.exportOptions;za.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Ka){za.exportOptions=Fa;va.resolve(Ka.url)},function(Ka){za.exportOptions=Fa;va.resolve()})})):
va.resolve();return va.promise})().then(e.hitch(this,function(va){var za={folder:q,name:d,stops:qa,directionPoints:ua,directionLines:Aa,barriers:db,polylineBarriers:eb,polygonBarriers:fb,extent:e.mixin(e.clone(K.extent),{xmin:Ba.xmin>K.extent.xmin?K.extent.xmin:Ba.xmin,ymin:Ba.ymin>K.extent.ymin?K.extent.ymin:Ba.ymin,xmax:Ba.xmax<K.extent.xmax?K.extent.xmax:Ba.xmax,ymax:Ba.ymax<K.extent.ymax?K.extent.ymax:Ba.ymax}),routeInfo:gb,thumbnail:va};this._userCanCreatePortalItem?this._naRouteSharing.store(za,
this.routeLayer.itemId,"1.0.0").then(e.hitch(this,function(Fa){if(Fa.success){var Ka=this._naRouteSharing.portal;Ka="//"+(Ka.isPortal?Ka.portalHostname:Ka.urlKey+"."+Ka.customBaseUrl);this._toggleSaveMenu();this._showMessage(H.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Ka+"/home/item.html?id\x3d"+Fa.id+"'\x3e"+H.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Fa.id);else this.onRouteItemCreated(Fa.id);
e.mixin(this.routeLayer,{itemId:Fa.id,title:za.name,isItemOwner:!0,ownerFolder:C});S.resolve(Fa)}else S.reject(Fa)}),S.reject):this._naRouteSharing.createFeatureCollection(za,"1.0.0").then(e.hitch(this,function(Fa){S.resolve(Fa);this._toggleSaveMenu();this.onFeatureCollectionCreated(Fa)}),S.reject)}))}else S.reject(Error("Cannot deduce the impedance used."))}else S.reject(Error("Missing required parameter: layerName, folder must be specified."));else S.reject(Error("Shared route must be built using a Travel Mode."));
else S.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else S.reject(Error("No route to share. Build a route first."));return S.promise},_loadRoute:function(d){var q=new V;q.promise.always(e.hitch(this,function(){this._showLoadingSpinner(!1);k.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(e.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(e.hitch(this,function(){var C=e.clone(this.serviceDescription),S=e.hitch(this,function(ea){e.mixin(this.routeLayer,{itemId:d,title:ea.title,isItemOwner:ea.isItemOwner,ownerFolder:ea.ownerFolder})}),K,Y,ca,ha;C.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(d,C).then(e.hitch(this,function(ea){if(ea.routeParameters){e.mixin(this.routeParams,ea.routeParameters);this.routeParams.accumulateAttributes=
ea.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ia=ea.routeParameters.travelMode,la=ia?this._getCostAttribute(ia.impedanceAttributeName):void 0;la=la?this._isTimeUnits(la.units)?"Time":"Distance":"";ha=C.supportedTravelModes&&C.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==ea.successCode&&la){var na="AUTOMOBILE"===ia.type?"Driving":"TRUCK"===ia.type?"Trucking":"WALK"===ia.type?"Walking":"Other";ia.name="\x26lt;"+ia.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(C.supportedTravelModes||[]).concat(ia);ha.push({id:ia.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+na+la+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ia.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new g({objectStore:new F({data:ha})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ia.name)}else{la=!1;if(ia&&ia.name)for(ha=C.supportedTravelModes||[],K=0;K<ha.length;K++)if(ha[K].name===ia.name){la=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ia.name);this.routeParams.travelMode=ha[K].impedanceAttributeName?ha[K]:ha[K].itemId;ea.loadMessages.push({message:H.widgets.directions.error.tmFromPortalSameName+" "+ia.name,messageType:"Warning"});break}if(!la)if((ia=C.defaultTravelMode)&&
ha)for(K=0;K<ha.length;K++){if(ha[K].id===ia){this.routeParams.travelMode=ha[K].impedanceAttributeName?ha[K]:ha[K].itemId;ea.loadMessages.push({message:H.widgets.directions.error.tmFromPortalDefault+" "+(ha[K].name?ha[K].name:ha[K].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ea.solveResult&&ea.solveResult.routeResults){var pa=Infinity,ta=-Infinity;ia=ea.solveResult.routeResults[0].stops;var qa=ea.solveResult.routeResults[0].directions.features;
la={};for(K=0;K<ia.length;K++){var ua=ia[K].attributes;if(ua.isWaypoint)for(Y=0;Y<qa.length;Y++)na=qa[Y].attributes,na._stopSequence===ua.Sequence&&(na.text=na.text.replace(ua.Name,this._waypointName));ca=ua.Name+"_"+this._stopSequence++;la[ca]=ua.isWaypoint?this._waypointName:ua.Name;ua.Name=ca;if(ua.Sequence<pa&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Aa=ua.Name;pa=ua.Sequence}if(ua.Sequence>ta&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Ja=ua.Name;
ta=ua.Sequence}}ca=Aa+" - "+Ja;ea.solveResult.routeResults[0].routeName=ca;ea.solveResult.routeResults[0].directions.routeName=ca;for(K=0;K<qa.length;K++)if(na=qa[K].attributes,void 0!==na._stopSequence)for(Y=0;Y<ia.length;Y++)if(na._stopSequence===ia[Y].attributes.Sequence){ca=ia[Y].attributes.Name;na.text=(na.text||"").replace(la[ca],ca);delete na._stopSequence;break}Aa=ia[ia.length-1];ia[0].geometry.x===Aa.geometry.x&&ia[0].geometry.y===Aa.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new L(Aa.geometry,
null,Aa.attributes),la[Aa.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ea.solveResult,la).then(e.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);S(ea);this.zoomToFullRoute();q.resolve(ea)}),q.reject)}else{if(ea.routeParameters){Aa=ea.routeParameters.stops.features;this.stops=[];for(K=0;K<Aa.length;K++)this.stops.push(this._addStopWrapperToGraphic(Aa[K],Aa[K].attributes.Name)),this._updateStop(this.stops[K],K);this._setStops();ea.loadMessages.push({message:H.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ea.loadMessages.push({message:H.widgets.directions.routeLayerEmpty,messageType:"Warning"});S(ea);q.resolve(ea)}for(K=0;K<ea.loadMessages.length;K++)this._showMessage(ea.loadMessages[K].message)}),e.hitch(this,function(ea){q.reject(ea);this._showMessage("GWM_0003"===ea.messageCode?H.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:H.widgets.directions.error.loadError)}))}),q.reject)}),q.reject);return q.promise}});e.setObject("dijit.Directions",
w,U);return w})},"dijit/layout/AccordionPane":function(){define(["dojo/_base/declare","dojo/_base/kernel","./ContentPane"],function(a,w,e){return a("dijit.layout.AccordionPane",e,{constructor:function(){w.deprecated("dijit.layout.AccordionPane deprecated, use ContentPane instead","","2.0")},onSelected:function(){}})})},"arcgisonline/sharing/geow/MemberReadStore":function(){define("require exports tslib ../util ../../tsutils/declareDecorator dojo/topic dojox/data/QueryReadStore".split(" "),function(a,
w,e,b,t,p,x){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);return function(){function y(){}y.prototype._fetchItems=function(J,G,D){var A=this,F=J.serverQuery||J.query||{};F.start=J.start||0;F.start++;J.count&&(F.num=J.count);b["default"].getJson(this.url,function(g){A._items=[];var v=null,m="";if(g.users){m="groupMembers";A._total=g.users.length+g.admins.length;p["default"].publish("onMemberCount",[A._total]);var h={name:g.owner,memberType:"owner",requestType:m,
groupowner:g.owner||"",groupadmins:g.admins||[]};A._items.push({i:h,r:A});(g.admins||[]).forEach(function(f){f!==g.owner&&(h={name:f,memberType:"admin",requestType:m,groupowner:g.owner||"",groupadmins:g.admins||[]},A._items.push({i:h,r:A}))},A);(g.users||[]).forEach(function(f){h={name:f,memberType:"member",requestType:m,groupowner:g.owner||"",groupadmins:g.admins||[]};A._items.push({i:h,r:A})},A)}else v=g.applications,m="groupApplications",p["default"].publish("onAppCount",[g.applications.length]),
A._total=v.length,(v||[]).forEach(function(f){A._items.push({i:{name:f.username,fullname:f.fullname,requestType:m,groupowner:g.owner||"",groupadmins:g.admins||[],received:f.received||-1},r:A})},A);A._itemsByIdentity={};A._identifier="name";A._items.forEach(function(f){f=f.i;var c=f.name;A._itemsByIdentity.name||(A._itemsByIdentity[c]=f)});G(A._items,J,A._total);A.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);A._lastServerQuery=e.__assign({},F)}.bind(this))};return y=
e.__decorate([t["default"](x["default"])],y)}()})},"arcgisonline/sharing/dijit/DataGrid":function(){define(["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.DataGrid");a.require("dojox.grid.DataGrid");a.declare("arcgisonline.sharing.dijit.DataGrid",e.grid.DataGrid,{sort:function(){this.inherited(arguments);setTimeout(a.hitch(this,"update"),300)},_onFetchComplete:function(b,t){var p=!this._isLoaded;this.inherited(arguments);p&&this.update()}})})},
"arcgisonline/sharing/dijit/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array esri/IdentityManager".split(" "),function(a,w,e,b,t,p,x,y){var J=function(G){function D(A){G[A]||(G[A]=function(){var F=arguments;return p.when(G,function(g){Array.prototype.unshift.call(F,g.features||g);return J(t[A].apply(t,F))})})}if(!G)return G;G.then&&(G=b.delegate(G));G.total||(G.total=p.when(G,
function(A){return a._isDefined(A.total)?A.total:A.length||0}));D("forEach");D("filter");D("map");D("some");D("every");return G};b.setObject("arcgisonline.sharing.dijit.FeatureLayerQueryResult",J);return J})},"arcgisonline/sharing/dijit/FeatureLayerQueryStore":function(){define(["dojo","dijit","dojox","dojo/require!arcgisonline/sharing/dijit/FeatureLayerQueryResult"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.FeatureLayerQueryStore");a.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");
a.declare("arcgisonline.sharing.dijit.FeatureLayerQueryStore",null,{queryUrl:"",idProperty:"id",data:[],constructor:function(b){a.mixin(this,b);this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField},get:function(b,t){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(b,t){var p=new esri.tasks.Query,x=t.start||0,y=this.batchCount;
this.objectIds?p.objectIds=this.objectIds.length>=x+this.batchCount?this.objectIds.slice(x,x+y):this.objectIds.slice(x):(p.start=x,p.num=y,p.where=this.where,p.orderByFields=this.orderByFields);p.returnGeometry=!1;p.outFields=["*"];var J=this.totalCount;x=this.layer.queryFeatures(p);x.total=x.then(a.hitch(this,function(G){if(this.objectIds){var D=G.objectIdFieldName;if(!D)for(var A=0;A<G.fields.length;A++)if("esriFieldTypeOID"==G.fields[A].type){D=G.fields[A].name;break}var F={};for(A=0;A<G.features.length;A++)F[G.features[A].attributes[D]]=
G.features[A];G.features=a.map(p.objectIds,function(g){return F[g]})}for(A=0;A<G.features.length;A++)G.features[A]=G.features[A].attributes,this.data[G.features[A][D]]=G.features[A];G=G.features;return J}),function(){return 0});return arcgisonline.sharing.dijit.FeatureLayerQueryResult(x)}})})},"arcgisonline/sharing/dijit/OrganizationSetup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/cookie dojo/debounce dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dijit/a11yclick dojo/string dojo/when dojox/html/entities dojo/io-query dojo/Deferred dojo/data/ItemFileReadStore dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/CheckBox dijit/form/FilteringSelect dijit/form/TextBox dijit/layout/ContentPane dijit/Tooltip esri/lang esri/request esri/IdentityManager esri/arcgis/OAuthInfo ../../esriGeowConfig ../util ../../pages/pageUtil ../../pages/utils/culture ../../pages/utils/dom ../../pages/utils/signin ../../pages/utils/storage ../../pages/utils/tooltips ../geow/Account ../geow/Geow ./dialog/GeneralDlg dojo/i18n!../../nls/arcgisonline dojo/text!./templates/OrganizationSetup.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da,R,M,r,N,W,fa){return a("arcgisonline.sharing.dijit.OrganizationSetup",[f,c,l],{declaredClass:"arcgisonline.sharing.dijit.OrganizationSetup",templateString:fa,widgetsInTemplate:!0,DEFAULT_ACCOUNT_NAME:"My Account",ACCOUNT_ADMIN_ROLE:"account_admin",BROWSER_DEFAULT:"browser",ACCESS_DENIED_ERROR_PATH:"error.html?c\x3dAccessDenied",_user:null,_onlineDefaults:null,_settings:null,_validUrlKey:!1,_urlKeyAlreadySet:!1,_tooltips:[],
postMixInProperties:function(){this.inherited(arguments);this.i18n=w.mixin(W.common,W.organizationSetup);w.mixin(this.i18n,{usageTrackingDesc:W.myOrganization.generalTab.usageTrackingDesc,usageTrackingSetting:W.myOrganization.generalTab.usageTrackingSetting,allowArcgisOnlineToCollectInfo:W.usageTracking.allowArcgisOnlineToCollectInfo})},destroy:function(){this.inherited(arguments);this._tooltips.forEach(function(ba){ba&&ba.destroyRecursive&&ba.destroyRecursive()})},startup:function(){this.inherited(arguments);
var ba=new v;L.checkSignInStatus().then(function(Z){Z&&(V.userInfo={username:Z.userId,credential:Z,token:Z.token});this._checkAccess(Z);this._initHandlers();this._initImages();this._initRedirects();this._initLocalization();this._initTooltips();M.getSupportedLanguagesAndRegions().then(function(ja){ja&&(this._initLanguage(ja.languages),this._initRegion(ja.regions),this._loadOrganization())}.bind(this),this._handleError.bind(this));ba.resolve()}.bind(this));return ba},getClientId:function(){try{return da.getLocalStorageItem("portalAppClientId")||
da.getSessionStorageItem("portalAppClientId")||V.clientId||"arcgisonline"}catch(ba){return V.clientId||"arcgisonline"}},_handleError:function(ba){},_showAlert:function(ba,Z){var ja=new N;J.once(ja._dialog,"hide",function(){ja._dialog.destroyRecursive();ja.destroyRecursive()});ja.show({title:ba,message:Z})},_urlContainsInvalidChars:function(ba){return!ba.match(/^[a-zA-Z0-9\-]*$/)},_handleUrlKeyCheck:function(ba){!ba||ba.code||ba.message?(this._validUrlKey=!1,this._clearUrlKeyStatus()):ba.available?
this._setGoodUrlKeyStatus(this.i18n.available):this._setBadUrlKeyStatus(this.i18n.unavailable)},_initHandlers:function(){var ba=this.checkUrlKey.bind(this);this.own(G(this._sslCheckBox,this.onSSLCheck.bind(this)),G(this._saveBtn,this.onSave.bind(this)),G(this._signOutBtn,this.onSignOut.bind(this)),J(this._urlKeyTextBox,"change",ba),I.registerKeystrokeHandler(this._urlKeyTextBox,t(ba,500)),J(this._languageSelect,"change",this.onLanguageChange.bind(this)))},_initImages:function(){this._orgNameImg&&
p.set(this._orgNameImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._orgAbbrImg&&p.set(this._orgAbbrImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._languageImg&&p.set(this._languageImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-language.png"));this._languageFormatImg&&p.set(this._languageFormatImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png"));
this._regionImg&&p.set(this._regionImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-region.png"));this._securityImg&&p.set(this._securityImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-https.png"));this._linkImg&&p.set(this._linkImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-links.png"));this._usageTrackingImg&&p.set(this._usageTrackingImg,"src",X.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb_euei.png"))},
_checkAccess:function(ba){ba?M.getSelf(function(Z){V.userInfo&&(V.userInfo.credential=ba,V.userInfo.token=ba.token);this._user=Z.user;this._user.orgId||this._user.role===this.ACCOUNT_ADMIN_ROLE||(window.location=V.baseUrl+this.ACCESS_DENIED_ERROR_PATH)}.bind(this),function(Z){}.bind(this)):this._showUser||X.requireAuthentication()},_initRedirects:function(){this.geodeUrl=V.baseUrl+"geoanalyticsengine.html";this.redirectUrl=V.baseUrl+"index.html";this.orgRedirectUrl=V.baseUrl+"organization.html"},
_initLocalization:function(){p.set(dojo.byId("item-title"),"innerHTML",this.i18n.setupYourOrg);this._sslCheckBoxLabel.innerHTML=D.substitute(this.i18n.securityDesc,{span:'\x3cspan id\x3d"sslTooltip" style\x3d"border-bottom: 1px dotted #487696;"\x3e',spanEnd:"\x3c/span\x3e"});p.set(this._linkTooltip,"innerHTML",D.substitute(this.i18n.contactUs,{startSpan:'\x3cspan class\x3d"orgSettingTooltip"\x3e',endSpan:"\x3c/span\x3e"}));this._link.set("placeholder",this.i18n.contactUsExample)},_initTooltips:function(){this._tooltips.push(R.createTooltip("linkTooltip",
this.i18n.contactUsTooltip));this._tooltips.push(R.createTooltip("sslTooltip",this.i18n.sslTooltip));this._tooltips.push(R.createTooltip("languageFormatTooltip",this.i18n.learnNumDateFormat))},_initLanguage:function(ba){if(ba){var Z=[{culture:this.BROWSER_DEFAULT,displayName:this.i18n.browserDefaultSelection,language:this.i18n.browserDefaultSelection,localizedName:this.i18n.browserDefaultSelection}];ba.forEach(function(ja){ja=w.mixin({displayName:F.decode((ja.localizedName?ja.localizedName+" - ":
"")+ja.language+"\x26lrm;")},ja);ja.cultureFormats&&ja.cultureFormats.length&&ja.cultureFormats.forEach(function(ma){ma.displayName=F.decode((ma.localizedName?ma.localizedName+" - ":"")+ma.name+"\x26lrm;")});Z.push(ja)});ba=new h({idProperty:"culture",label:"displayName",data:Z});this._languageSelect.set("store",ba);this._languageSelect.set("searchAttr","displayName")}},_initLanguageFormat:function(ba,Z){if(ba&&ba!==this.BROWSER_DEFAULT&&Z&&Z.length){var ja=U.getSelectedFormat(this._settings.cultureFormat,
Z||[]),ma=new h({idProperty:"format",label:"displayName",data:Z});this._languageFormatSelect.set("store",ma);this._languageFormatSelect.set("searchAttr","displayName");ja?this._languageFormatSelect.set("displayedValue",ja.displayName):this._languageFormatSelect.set("displayedValue",Z[0].displayName);E.showNode(this._languageFormatContainer)}else E.hideNode(this._languageFormatContainer)},_initRegion:function(ba){ba&&(ba=new h({idProperty:"region",label:"localizedName",data:ba}),this._regionSelect.set("store",
ba),this._regionSelect.set("searchAttr","localizedName"))},_loadOrganization:function(){O({url:X.getSecureUrl(V.restBaseUrl)+"portals/self",content:{f:"json"}}).then(function(ba){this._onlineDefaults=ba;M.getSelf(function(Z){if(!Z||Z.code||Z.message)this._handleError(Z);else{this._settings=Z;this._settings.customBaseUrl=this._settings.customBaseUrl||this._onlineDefaults.customBaseUrl;this._sslCheckBox.set("checked",!0);this._settings.name&&this.DEFAULT_ACCOUNT_NAME!==this._settings.name&&this._nameTextBox.set("value",
this._settings.name);this._settings.urlKey?(this._urlKeyAlreadySet=this._validUrlKey=!0,this._settings.customBaseUrl?p.set(this._sampleUrlTextBox,"innerHTML","https://"+this._settings.urlKey+"."+this._settings.customBaseUrl):p.set(this._sampleUrlTextBox,"innerHTML",X.getSecureUrl(V.baseUrl)),this._urlKeyTextBox.set("disabled",!0),this._urlKeyTextBox.set("value",this._settings.urlKey)):(this._validUrlKey=!1,p.set(this._sampleUrlTextBox,"innerHTML",""));var ja=this._languageSelect.get("store");this._settings.culture=
U.getActualCulture(Z.culture,ja.query());ja=(ja=ja.query({culture:Z.culture||this.BROWSER_DEFAULT}).shift())?ja.displayName:this.i18n.browserDefaultSelection;this._languageSelect.set("displayedValue",ja);p.set(this._languageFormatHelpLink,"href",V.self.helpBase+(V.self.helpMap.m["120001487"]||""));(Z=this._regionSelect.get("store").query({region:Z.region}).shift())&&Z.localizedName?this._regionSelect.set("displayedValue",Z.localizedName):this._regionSelect.set("value",V.self&&V.self.ipCntryCode||
"WO");this._settings.portalProperties&&this._settings.portalProperties.links&&this._settings.portalProperties.links.contactUs&&(this._linkCheckBox.set("checked",!!this._settings.portalProperties.links.contactUs.visible),this._link.set("value",this._settings.portalProperties.links.contactUs.url));Z=V.restBaseUrl.replace("http:","https:").replace("/rest/","/geoip.jsp");X.getJson(Z,this._setUsageTrackingCheckbox.bind(this),this._setUsageTrackingCheckbox.bind(this))}}.bind(this))}.bind(this))},_setUsageTrackingCheckbox:function(ba){this._usageTrackingCheckBox.set("checked",
V.urlKey?!!this._settings.eueiEnabled:"US"===ba.country)},_makeAuthorizeRequest:function(ba,Z,ja){var ma=L.getClientId();ba={portalUrl:L.getPortalUrl(),returnUrl:ba,useLandingPage:!1,initialAdmin:!0,clientId:ma};ja=ja?ja:V.baseUrl;ma={client_id:ma,display:"default",response_type:"token",state:JSON.stringify(ba),expiration:V.expiration||20160,locale:this._settings.culture?this._settings.culture.toLowerCase():e.locale,redirect_uri:ja.replace("http:","https:")+"accountswitcher-callback.html",force_login:!1,
hideCancel:!0,showSignupOption:!1,canHandleCrossOrgSignIn:!0,signuptype:"esri",redirectToUserOrgUrl:!0};Z=(Z?Z+"/sharing/rest/":V.restBaseUrl).replace(/^http:/i,"https:")+"oauth2/authorize?"+g.objectToQuery(ma);document.location.replace(Z)},_handleUpdateAccount:function(ba){if(!ba||ba.code||ba.message)this._handleError(ba),this._showAlert(this.i18n.errorTitle,this.i18n.errors.unableToSave),this._saveBtn.set("disabled",!1),this._saveBtn.set("label",this.i18n.saveContinue);else{var Z=L.getClientId();
this._settings.urlKey&&this._settings.customBaseUrl?(ba="https://"+this._settings.urlKey+"."+this._settings.customBaseUrl,"geoanalyticsengine"===Z?ba=this.geodeUrl.replace("http:","https:"):(Z=V.baseUrl.indexOf(location.host),ba=-1<Z?V.isDebug?this.orgRedirectUrl.replace("http:","https:"):ba+(V.baseUrl.substring(Z+location.host.length).replace("http:","https:")+"organization.html"):this.redirectUrl.replace("http:","https:")),this._makeAuthorizeRequest(ba)):window.location="geoanalyticsengine"===Z?
this.geodeUrl.replace("http:","https:"):"account_admin"!==user.role||this._settings.urlKey?this.redirectUrl.replace("http:","https:"):this.orgRedirectUrl.replace("http:","https:")}},_validates:function(){var ba=this._nameTextBox.getValue(),Z=this._link.get("value"),ja=this._linkCheckBox.get("checked"),ma=this.i18n.errors.pleaseCorrect,aa=!1;ba?(ba=D.trim(ba),0<ba.length?-1<ba.indexOf("\x3c")||-1<ba.indexOf("\x3e")||-1<ba.indexOf("%")?(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.orgNameInvalidChars):55<
ba.length&&(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.orgNameTooLong):(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired)):(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired);this._validUrlKey||(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.urlKeyRequired);!ja||esri.isDefined(Z)&&0!==Z.length||(aa=!0,ma+="\x3cbr\x3e"+this.i18n.errors.finishContactUsSetup);aa&&this._showAlert(this.i18n.errorTitle,ma);return!aa},_setGoodUrlKeyStatus:function(ba){this._validUrlKey=!0;this._urlKeyStatusLabel.innerHTML=
ba;x.remove(this._urlKeyStatusLabel,"statusBad");x.add(this._urlKeyStatusLabel,"statusGood")},_setBadUrlKeyStatus:function(ba){this._validUrlKey=!1;this._urlKeyStatusLabel.innerHTML=ba;x.remove(this._urlKeyStatusLabel,"statusGood");x.add(this._urlKeyStatusLabel,"statusBad")},_clearUrlKeyStatus:function(){this._urlKeyStatusLabel.innerHTML="";x.remove(this._urlKeyStatusLabel,"statusGood");x.remove(this._urlKeyStatusLabel,"statusBad")},checkUrlKey:function(){if(!this._urlKeyAlreadySet){var ba=this._urlKeyTextBox.getValue(),
Z=this._handleUrlKeyCheck.bind(this);ba&&(ba=D.trim(ba));ba&&0<ba.length&&17>ba.length?this._urlContainsInvalidChars(ba)?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyInvalidChars):"-"===ba[0]||"-"===ba[ba.length-1]?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyEndHyphen):(p.set(this._sampleUrlTextBox,"innerHTML","https://"+ba+"."+this._settings.customBaseUrl),X.getJson(V.restBaseUrl+"portals/isUrlKeyAvailable?urlKey\x3d"+ba,Z,Z)):(this._validUrlKey=!1,p.set(this._sampleUrlTextBox,"innerHTML",
""),ba&&16<ba.length?this._setBadUrlKeyStatus(this.i18n.urlKeyTooLong):this._clearUrlKeyStatus())}},onLanguageChange:function(){var ba=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift();ba&&this._initLanguageFormat(ba.culture,ba.cultureFormats)},onSSLCheck:function(){var ba=this._sslCheckBox.attr("checked");this._showAlert(this.i18n.warning,ba?this.i18n.sslOnWarning:this.i18n.sslOffWarning)},onSave:function(){this._saveBtn.set("disabled",!0);
this._saveBtn.set("label",this.i18n.saving);if(this._validates()){var ba=this._handleUpdateAccount.bind(this),Z=this._nameTextBox.getValue(),ja=this._urlKeyTextBox.getValue(),ma=this._sslCheckBox.attr("checked");this._settings.name=D.trim(Z);this._settings.urlKey=D.trim(ja);this._settings.allSSL=ma;Z=(ja=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift())&&ja.culture?ja.culture:this.BROWSER_DEFAULT;this._settings.culture=Z===this.BROWSER_DEFAULT?
"":Z;ja&&ja.cultureFormats?(ja=(ja=this._languageFormatSelect.get("store").query({displayName:this._languageFormatSelect.get("displayedValue")}).shift())&&ja.format?ja.format:void 0)?(this._settings.culture=Z+"-"+ja,this._settings.cultureFormat=ja):this._settings.cultureFormat="":this._settings.cultureFormat="";Z=this._regionSelect.get("store").query({localizedName:this._regionSelect.get("displayedValue")}).shift();this._settings.region=Z&&Z.region||"";this._settings.portalProperties=this._settings.portalProperties||
{};this._settings.portalProperties.mustWelcome=!0;this._settings.portalProperties.links=this._settings.portalProperties.links||{};Z=this._link.get("value");Q.isDefined(Z)&&0<Z.length?(0!==Z.indexOf("http")&&0!==Z.indexOf("mailto:")&&0<Z.indexOf("@")?Z="mailto:"+Z:0!==Z.indexOf("http")&&0>Z.indexOf("mailto:")&&0>Z.indexOf("@")&&(Z="http://"+Z),this._settings.portalProperties.links.contactUs={url:Z,visible:!!this._linkCheckBox.get("checked")}):delete this._settings.portalProperties.links.contactUs;
this._settings.eueiEnabled=this._usageTrackingCheckBox.checked;this._settings.basemapGalleryGroupQuery=null;this._settings.colorSetsGroupQuery=null;this._settings.defaultBasemap=null;this._settings.defaultExtent=null;this._settings.featuredGroups=null;this._settings.featuredGroupsId=null;this._settings.featuredItemsGroupQuery=null;this._settings.homePageFeaturedContent=null;this._settings.layerTemplatesGroupQuery=null;this._settings.rotatorPanels=null;this._settings.symbolSetsGroupQuery=null;this._settings.templatesGroupQuery=
null;this._settings.contacts=this._settings.contacts||[];M.updateAccount(this._settings,ba,ba)}else this._saveBtn.set("disabled",!1),this._saveBtn.set("label",this.i18n.saveContinue)},onSignOut:function(){b("esri_webmap","",{expires:-1,path:"/"});var ba=this.allSSL?X.getSecureUrl():X.getHttpUrl();r.signout(ba+"index.html")}})})},"arcgisonline/pages/utils/culture":function(){define(["require","exports","tslib","dojo/string","dojo/_base/kernel"],function(a,w,e,b,t){b=e.__importDefault(b);t=e.__importDefault(t);
return function(){function p(){}p.getString=function(x,y,J){var G,D="id ja ko th vi zh-cn zh-hk zh-tw".split(" "),A="en ca da de el es et fi hi hu it nb nl pt-pt sv tr".split(" "),F=null!==(G=p.getRootLocale(t["default"].locale))&&void 0!==G?G:"en";J?J.number=y:J={number:y};return 1===y||-1<D.indexOf(F)?b["default"].substitute(x.single,J):1!==y&&-1<A.indexOf(F)?b["default"].substitute(x.multiple,J):b["default"].substitute(x.unknown,J)};p.stripCultureFormat=function(x,y){if((null===x||void 0===x?0:
x.length)&&(null===y||void 0===y?0:y.length)){var J=x.indexOf("-"+y);if(-1<J)return x.substring(0,J)}return x};p.getRootLocale=function(x){if(null===x||void 0===x?0:x.length){x=x.split("-")[0];if(null===x||void 0===x?0:x.length)x=x.toLowerCase();return x}return x};p.getLocaleFormat=function(x){if(null===x||void 0===x?0:x.length)if(x=x.split("-"),1<x.length)return x[1].toLowerCase()};p.getTrialLocale=function(x){var y=["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"];return-1<(null===x||void 0===x?void 0:
x.indexOf("-"))&&-1===y.indexOf(x)?this.getRootLocale(x):x};p.getActualCulture=function(x,y){var J,G=null!==(J=null===x||void 0===x?void 0:x.toLowerCase())&&void 0!==J?J:"",D=G.split("-");if(1<D.length){if(J=y.filter(function(A){return A.culture===G}).shift())return G;J=y.filter(function(A){return A.culture===D[0]}).shift();if(null===J||void 0===J?0:J.cultureFormats){if(J.cultureFormats.filter(function(A){return A.format===D[1]}).shift())return J.culture}else if(J)return J.culture}return x};p.getSelectedFormat=
function(x,y){return y.filter(function(J){return J.format===x}).shift()};p.getPercentString=function(x){var y=t["default"].locale.toLowerCase();return"ar"===y?"%"+100*x:x.toLocaleString(y,{style:"percent"})};return p}()})},"arcgisonline/sharing/dijit/dialog/ExportDlg":function(){define("require exports tslib ../../../esriGeowConfig ../../../pages/pageUtil ../../../pages/serviceUtil ../../../pages/utils/categories ../../../pages/utils/dom ../../util ../SaveItem ./GeneralDlg ../../../tsutils/declareDecorator dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/promise/all dojo/string dojo/on dojo/topic esri/config esri/lang esri/Evented dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ExportDlg.html ../ComboBox".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);D=e.__importDefault(D);A=e.__importDefault(A);F=e.__importDefault(F);g=e.__importDefault(g);v=e.__importDefault(v);m=e.__importDefault(m);h=e.__importDefault(h);f=e.__importDefault(f);c=e.__importDefault(c);l=e.__importDefault(l);k=e.__importDefault(k);z=e.__importDefault(z);u=
e.__importDefault(u);n=e.__importDefault(n);B=e.__importDefault(B);H=e.__importDefault(H);var Q;(function(O){O.ShapeFile="Shapefile";O.CSV="CSV";O.FileGDB="File Geodatabase";O.GeoJson="GeoJson";O.FeatureCollection="Feature Collection";O.KML="KML";O.Excel="Excel";O.TilePackage="Tile Package";O.GeoPackage="GeoPackage"})(Q||(Q={}));return function(){function O(){this.declaredClass="arcgisonline.sharing.dijit.dialog.ExportDlg";this.widgetsInTemplate=!0;this.templateString=H["default"];this.layerId=-1;
this.init=!1;this.checkStatusInterval=null;this.checkingStatus=!1;this.statusCheckIntervalTime=4E3;this._setMessageAttr={node:"_message",type:"innerHTML"};this.typeLookup={shapefileType:Q.ShapeFile,csvType:Q.CSV,fileGDB:Q.FileGDB,geoJson:Q.GeoJson,featureCollection:Q.FeatureCollection,kmlType:Q.KML,excelType:Q.Excel,CSV:"CSV Collection",KML:"KML Collection",Excel:"Microsoft Excel",tilePackage:Q.TilePackage};this.requiredBorder="1px dotted orangered";this.normalBorder="1px solid #bbb"}O.prototype.onDone=
function(P){};O.prototype.postMixInProperties=function(){this.inherited(arguments);this.i18n=e.__assign(e.__assign(e.__assign({},B["default"].common),B["default"].exportDlg),{defaultError:B["default"].errorWidget.defaultError,generalize:B["default"].addLayerFromFileDlg.generalize,keepOrig:B["default"].addLayerFromFileDlg.keepOrig,notEnoughCreditsTitle:B["default"].publishTileServiceDlg.notEnoughCreditsTitle,itemProperties:B["default"].itemProperties});this._webMercatorValues={3857:1,102113:1,102100:1,
900913:1}};O.prototype.postCreate=function(){this.inherited(arguments);this.init||(this.init=!0,this.saveItem=new G["default"]({},this.saveItemForm))};O.prototype.startup=function(){this.inherited(arguments);z["default"].defaults.io.proxyUrl=b["default"].proxyServer;b["default"].proxyUrl&&(z["default"].defaults.io.proxyUrl=b["default"].proxyUrl)};O.prototype.destroy=function(){this._onSaveItemValidateHandle&&(this._onSaveItemValidateHandle.remove(),this._onSaveItemValidateHandle=null);this.exportDialog.destroyRecursive();
this._pendingCanceller=this.exportDialog=null;this.inherited(arguments)};O.prototype.show=function(P,T,V,X){var I=this;this.showDlg(P,T,V);X&&setTimeout(function(){I._message.style.maxWidth=I.saveItem.domNode.clientWidth+"px";I.setWait(!0);X.waitForCredits.then(function(U){I._pendingCanceller=null;if(U.success)return I.set("message",U.message),I.unsetWait();I.displayError(U,I.i18n.notEnoughCreditsTitle)},function(U){I._pendingCanceller=null;I.displayError(U)});I._pendingCanceller=X.canceller},0)};
O.prototype.showShapefile=function(P,T){this.showDlg(P,T,Q.ShapeFile)};O.prototype.showCSV=function(P,T){this.showDlg(P,T,Q.CSV)};O.prototype.showFileGDB=function(P,T){this.showDlg(P,T,Q.FileGDB)};O.prototype.showGeoJson=function(P,T){this.showDlg(P,T,Q.GeoJson)};O.prototype.showFeatureCollection=function(P,T){this.showDlg(P,T,Q.FeatureCollection)};O.prototype.showDlg=function(P,T,V){this.clear();this.item=P;this.setDialogTitle(V);this.setLayerDetails(T);this.checkForStaleData(P,T);this.initTags();
this.initCategories();this.exportDialog.show();P=this.onCancel.bind(this);this.own(F["default"](this.exportDialog.closeButtonNode,P),l["default"](this.cancelBtn,"click",P),l["default"](this.exportBtn,"click",this.onExport.bind(this)));this.exportDialog.closeButtonNode.tabIndex=0};O.prototype.checkForStaleData=function(P,T){var V,X,I,U;(null===(V=P.layers)||void 0===V?0:V.length)&&"Feature Service"===P.type&&-1<P.typeKeywords.indexOf("Hosted Service")&&(T&&!T.length?U=null===(X=T.editingInfo)||void 0===
X?void 0:X.lastEditDate:P.layers.forEach(function(E){var L;(I=null===(L=E.editingInfo)||void 0===L?void 0:L.lastEditDate)&&(!U||U<I)&&(U=I)}))};O.prototype.initTags=function(){var P=this;this.saveItem.loadTags().then(function(){P.saveItem.set("tags",[])})};O.prototype.initCategories=function(){this.saveItem.loadCategories(this.item.categories)};O.prototype.setDialogTitle=function(P){this.exportType=P;P=this.i18n.itemProperties;var T=this.i18n.exportDialogTitle;Q.ShapeFile===this.exportType?T=P.exportToShapefile:
Q.CSV===this.exportType?T=P.exportToCSVFile:Q.FileGDB===this.exportType?T=P.exportToFileGDB:Q.GeoJson===this.exportType?T=P.exportToGeoJson:Q.FeatureCollection===this.exportType?T=P.exportToFeatureCollection:Q.KML===this.exportType?T=P.exportToKML:Q.Excel===this.exportType?T=P.exportToExcel:Q.TilePackage===this.exportType?T=P.exportToTilePackage:Q.GeoPackage===this.exportType&&(T=P.exportToGeoPackage);this.exportDialog.set("title",T)};O.prototype.setLayerDetails=function(P){var T,V,X,I;this._isTableLayer=
this._isWebMercator=!1;P&&u["default"].isDefined(P.id)?(this.layerId=P.id,this._layers=[P],this.saveItem.set("title",P.name),this._isWebMercator=(null===(V=null===(T=P.extent)||void 0===T?void 0:T.spatialReference)||void 0===V?void 0:V.wkid)in this._webMercatorValues,this._extent=P.extent):P&&P.length&&(this._layers=P,this._isWebMercator=(null===(I=null===(X=P[0].extent)||void 0===X?void 0:X.spatialReference)||void 0===I?void 0:I.wkid)in this._webMercatorValues,this._isTableLayer=P.every(function(U){return"Table"===
U.type}),this._extent=P[0].extent,this.saveItem.set("title",1===P.length?P[0].name:this.item.title));this._isWebMercator&&!this._isTableLayer&&this.exportType===Q.FeatureCollection&&(this.featureCollectionDiv.classList.remove("hide"),this.generalizeChk.checked=!0)};O.prototype.clear=function(){this.exportDialog.set("title",this.i18n.exportDialogTitle);this.item=null;this.layerId=-1;this.checkStatusInterval=this.exportResponse=this.exportType=null;this.checkingStatus=!1;this.saveItem.set("title","");
this.saveItem.set("tags",[]);this.saveItem.set("summary","");this.saveItem.set("requires",["title"]);this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!0;this._onSaveItemValidateHandle=k["default"].subscribe("onSaveItemValidate",this.validate.bind(this));this.saveItem.hideRow("folder");y["default"].forEachNode(this.saveItem.domNode.querySelectorAll(".select2-container.select2-container-multi"),function(P){P.style.minWidth="33px"});this.featureCollectionDiv.classList.add("hide");
this.generalizeChk.checked=!1};O.prototype.hide=function(){return this.exportDialog.hide()};O.prototype.validate=function(P){P=this.saveItem.get("title");this.exportBtn.disabled=!P};O.prototype.validates=function(){return!!this.saveItem.get("title")};O.prototype.setWait=function(P){this.exportDialog.domNode.style.cursor="wait";P?this.set("message",this.i18n.estimatingCredits):this.exportingLabel.style.visibility="visible";this.exportBtn.disabled=!0};O.prototype.unsetWait=function(){this.exportDialog.domNode.style.cursor=
"default";this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!1};O.prototype.exportImageryItem=function(){var P=this,T=this.saveItem.get("title");T=p["default"].exportImageryToTilePackage(this.item,T);var V=T.dfd;this._pendingCanceller=T.canceller;V.then(function(X){var I=X.success;X=X.outputValue;P._pendingCanceller=null;I&&X.itemId?(P.exportResponse={exportItemId:X.itemId},P.updateExportedItemDetails({itemId:X.itemId,statusMessage:""})):P.displayError(P.i18n.defaultError)},function(){P._pendingCanceller=
null;P.displayError(P.i18n.defaultError)})};O.prototype.exportItem=function(){var P=this;if(this._moveFailed)this.updateItem(this._moveFailed.itemId,"/").then(function(E){P.unsetWait();P.onDone(E)});else{this.setWait();if("Image Service"===this.item.type&&Q.TilePackage===this.exportType)return this.exportImageryItem();var T=this.saveItem.get("title"),V=this.generalizeChk.checked,X={maxAllowableOffset:1,quantizationParameters:{tolerance:1}},I=Q.ShapeFile;Q.CSV===this.exportType?I=Q.CSV:Q.FileGDB===
this.exportType?I=Q.FileGDB:Q.GeoJson===this.exportType?I=Q.GeoJson:Q.FeatureCollection===this.exportType?I=Q.FeatureCollection:Q.KML===this.exportType?I="kml":Q.Excel===this.exportType?I="excel":Q.GeoPackage===this.exportType&&(I="geoPackage");var U=this._layers.map(function(E){return V?e.__assign({id:E.id},X):{id:E.id}});T={itemId:this.item.id,title:T,exportFormat:I,exportParameters:-1<this.layerId?{layers:U}:V?X:null};this.item.isOwner&&this.item.isDataView&&(T.exportParameters=e.__assign(e.__assign({},
T.exportParameters||{}),{enforceFieldVisibility:!0}));Q.FileGDB===this.exportType&&(T.exportParameters=e.__assign(e.__assign({},T.exportParameters||{}),{exportContingentValues:!0}));T.exportParameters&&(T.exportParameters=JSON.stringify(T.exportParameters));I=J["default"].getUser();J["default"].request({url:b["default"].restBaseUrl+"content/users/"+I.username+"/export",content:T},{usePost:!0}).then(this.handleExport.bind(this),this.displayError.bind(this))}};O.prototype.handleExport=function(P){!P||
P.code||P.message?this.displayError(P):(this.exportResponse=P,this.checkStatusInterval=setInterval(this.checkStatus.bind(this),this.statusCheckIntervalTime))};O.prototype.checkStatus=function(){var P=this;if(this.exportResponse&&!this.checkingStatus){var T={jobId:this.exportResponse.jobId,jobType:"export"},V=J["default"].getUser();V=b["default"].restBaseUrl+"content/users/"+V.username+"/items/"+this.exportResponse.exportItemId+"/status";this.checkingStatus=!0;J["default"].request({url:V,content:T}).then(function(X){P.handleStatusCheck(X);
P.checkingStatus=!1},function(X){P.displayError(X);P.checkingStatus=!1})}};O.prototype.handleStatusCheck=function(P){"completed"===(null===P||void 0===P?void 0:P.status)?(clearInterval(this.checkStatusInterval),this.updateExportedItemDetails(P)):"failed"===P.status&&(clearInterval(this.checkStatusInterval),this.updateExportedItemDetailsAndFail(P))};O.prototype.updateExportedItemDetailsAndFail=function(P){var T=this;this.getItemDetails(this.exportResponse.exportItemId).then(function(V){var X=[],I=
b["default"].self.hasCategorySchema&&T.saveItem.get("categories")||[];0<I.length&&X.push(x["default"].setItemCategories([V.id],I));X.push(T.updateItem(V.id,V.ownerFolder));f["default"](X).then(function(){T.unsetWait();T.displayFailure(P.statusMessage)})})};O.prototype.updateExportedItemDetails=function(P){var T=this;this.getItemDetails(P.itemId).then(function(V){var X=[],I=b["default"].self.hasCategorySchema&&T.saveItem.get("categories")||[];0<I.length&&X.push(x["default"].setItemCategories([V.id],
I));X.push(T.updateItem(V.id,V.ownerFolder));f["default"](X).then(function(){T.unsetWait();T.onDone(P)})})};O.prototype.moveItem=function(P,T){var V=this,X=new h["default"],I=J["default"].getUser();I=b["default"].restBaseUrl+"content/users/"+I.username+"/items/"+P+"/move";var U={folder:T||"/"};this._moveFailed=null;T&&"/"!==T&&""!==T?J["default"].request({url:I,content:U},{usePost:!0}).then(function(E){X.resolve(E)},function(E){if(E&&"CONT_0011"===E.messageCode){var L=V.saveItem.get("title");L=c["default"].substitute(V.i18n.duplicateFound,
{type:V.exportType,title:L});t["default"].createSpecifiedDialog(D["default"]).show({title:V.i18n.errorTitle,message:L});V._moveFailed=e.__assign(e.__assign({},E),{itemId:P,folderId:T});V.unsetWait()}}):X.resolve({itemId:P});return X};O.prototype.updateItem=function(P,T){var V=this.saveItem.get("title"),X=this.saveItem.get("tags"),I=this.saveItem.get("summary"),U=this.saveItem.get("folderId"),E=b["default"].restBaseUrl+"content/items/"+this.exportResponse.exportItemId+"/data",L=J["default"].getUser();
L=b["default"].restBaseUrl+"content/users/"+L.username;T&&0<T.length&&(L+="/"+T);L+="/items/"+this.exportResponse.exportItemId+"/update";V={title:V,tags:X,snippet:I};this._moveFailed||(V.folderId=U);Q.KML===this.exportType&&(V.url=E);return J["default"].request({url:L,content:V},{usePost:!0}).then(this.moveItem.bind(this,P,U))};O.prototype.getItemDetails=function(P){return J["default"].request({url:b["default"].restBaseUrl+"content/items/"+P})};O.prototype.goToItem=function(P){var T=this;this.hide().then(function(){T.unsetWait();
window.location.href=b["default"].baseUrl+"item.html?id\x3d"+P})};O.prototype.checkTitle=function(){var P=this.saveItem.get("title"),T=this.saveItem.get("folderId"),V=this.typeLookup[this.exportType]||this.exportType,X=J["default"].getUser().username;return J["default"].request({url:b["default"].restBaseUrl+"search",content:{q:'title:"'+P+'" AND type:"'+V+'" AND owner:"'+X+'" AND ownerfolder:"'+(T&&"/"!==T?T:"root")+'"'}})};O.prototype.displayFailure=function(P){var T=this;if(P)try{var V=JSON.parse(P)}catch(U){V=
P}var X=t["default"].createSpecifiedDialog(D["default"]);X.onOkClick=function(){X.hide();T.onCancel()};var I=this.i18n.errorTitle;V.message&&(P=V.message);X.show({title:I,message:P})};O.prototype.displayError=function(P,T){var V=this;T=T||this.i18n.errorTitle;if(P){var X=t["default"].createSpecifiedDialog(D["default"]);X.onOkClick=function(){X.hide();V.onCancel()};X.show({title:T,message:(null===P||void 0===P?0:P.code)&&P.message?P.message:P})}};O.prototype.onExport=function(){var P=this;this.validates()&&
this.checkTitle().then(function(T){0<T.total?(T=P.saveItem.get("title"),T=c["default"].substitute(P.i18n.duplicateFound,{type:P.typeLookup[P.exportType]||P.exportType,title:T}),t["default"].createSpecifiedDialog(D["default"]).show({title:P.i18n.errorTitle,message:T})):P.exportItem()})};O.prototype.onCancel=function(P){var T,V;null===(T=null===P||void 0===P?void 0:P.preventDefault)||void 0===T?void 0:T.call(P);null===(V=this._pendingCanceller)||void 0===V?void 0:V.call(this);this.hide();this.destroy()};
return O=e.__decorate([A["default"](g["default"],v["default"],m["default"],n["default"])],O)}()})},"arcgisonline/pages/serviceUtil":function(){define("require exports tslib dojo/Deferred dojo/json dojo/promise/all dojo/sniff esri/lang esri/layers/FeatureLayer esri/request esri/tasks/Geoprocessor ./pageUtil ./utils/arrays arcgisonline/sharing/dijit/Role ../sharing/util ../esriGeowConfig".split(" "),function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);
x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);D=e.__importDefault(D);A=e.__importDefault(A);F=e.__importDefault(F);g=e.__importDefault(g);v=e.__importDefault(v);m=e.__importDefault(m);return function(){function h(){}h.getDateFields=function(f){return((null===f||void 0===f?void 0:f.fields)||[]).filter(function(c){return"esriFieldTypeDate"===(null===c||void 0===c?void 0:c.type)})};h.fetchServerToken=function(f,c){var l=f.portal,k=c||f.url;return k?v["default"].request({url:v["default"].getSecureUrl(l.portalUrl+
"generateToken"),content:{serverUrl:k}},{usePost:!0}).then(function(z){return z.token}):null};h.fetchItemAdminUrl=function(f,c){var l;return f.portal.isPortal?(null===c||void 0===c?0:c.adminUrl)&&c.url?this.getAdminUrl(f,c):f.url:(null===(l=f.url)||void 0===l?void 0:l.replace("/rest/","/rest/admin/"))||null};h.getAdminUrl=function(f,c){var l=f.url;l=l.replace(l.split("/rest/")[0],c.adminUrl);return f.isSDS||"Knowledge Graph"===f.type?l.replace("/rest/","/rest/admin/"):l.replace("/rest/","/admin/").replace("/FeatureServer",
".MapServer").replace("/MapServer",".MapServer").replace("/VectorTileServer",".VectorTileServer").replace("/SceneServer",".SceneServer").replace("/ImageServer",".ImageServer")};h.fetchServiceLayers=function(f){return v["default"].request({url:f+"/layers"}).then(function(c){return(null===c||void 0===c?void 0:c.layers)||[]})};h.renameServiceLayers=function(f,c){var l=new b["default"],k=c.adminUrl+"/"+f.layerId,z={name:f.layerRename};"Map Service"===c.type?(k+="/edit",z={layerDefinition:JSON.stringify(z)}):
(k+="/updateDefinition",z={updateDefinition:JSON.stringify(z),async:!1});v["default"].request({url:k,content:z},{usePost:!0}).then(function(){return l.resolve()},function(u){return l.reject(u)});return l};h.updateServiceDefinition=function(f){var c=f.layerId,l=f.item;f=f.definition;var k=new b["default"];v["default"].request({url:l.adminUrl+"/"+c+"/updateDefinition",content:{updateDefinition:JSON.stringify(f),async:!1}},{usePost:!0}).then(function(){return k.resolve()},function(z){return k.reject(z)});
return k};h.queryGeocodeCounts=function(f){var c=[],l=f.url,k={where:"1\x3d1",returnCountOnly:!0},z=f.reviewTable,u=l+"/"+(f.layers||[])[0].id+"/query",n=new b["default"];f.canUpdate&&f.isHostedService&&f.hasGeocodeReviewTable?(c.push(v["default"].request({url:u,content:k})),z&&(f=l+"/"+z.id+"/query",c.push(v["default"].request({url:f,content:k}))),p["default"](c).then(function(B){var H=(null===B||void 0===B?void 0:B.length)&&B[0].count||0;n.resolve({successful:H,total:H+(1<(null===B||void 0===B?
void 0:B.length)&&B[1].count||0)})},function(B){n.resolve(null)})):n.resolve(null);return n};h.adjustHostedServerForProtocol=function(f){return"https:"===location.protocol?f.replace("http:","https:").replace(":6080",":6443"):f.replace("https:","http:").replace(":6443",":6080")};h.checkForResources=function(f){var c=f.itemUrl+"/resources/styles/root.json";"Vector Tile Service"!==f.type||y["default"].isDefined(f.hasResources)?(c=new b["default"],c.resolve(!!f.hasResources)):c=v["default"].request({url:c}).then(function(){return!0},
function(){return!1});return c};h.setFeatureServiceScaleRanges=function(f){var c=this,l=new b["default"],k=f.url,z=f.sourceData||{},u=f.featureLayers||[];!f.numViews&&f.isHostedService&&"Feature Service"===f.type&&"Service Definition"!==z.type?p["default"](u.map(function(n){return c.setScaleRange(k+"/"+n.id,f,n.id)})).then(function(){return l.resolve(!0)}):l.resolve(!0);return l};h.setScaleRange=function(f,c,l){var k=new b["default"],z=new J["default"](f);f=c.adminUrl;l=y["default"].isDefined(l)?
"/"+l:"";var u=""+f+l+"/updateDefinition";z.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){z.statisticsPlugin.getSuggestedScaleRange().then(function(n){n={updateDefinition:t["default"].stringify({maxScale:n.maxScale||0,minScale:n.relaxedMinScale||0})};v["default"].request({url:u,content:n},{usePost:!0}).then(function(){return k.resolve(c)},function(){return k.resolve(c)})},function(n){k.resolve(c)})});return k};h.getSuggestedScaleRange=function(f){var c=new b["default"],l=new J["default"](f);
l.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){l.statisticsPlugin.getSuggestedScaleRange({sampleSize:100,forPublishingTiles:!0}).then(function(k){return c.resolve(k)},function(k){c.resolve(null)})},function(k){c.resolve(null)});return c};h.encodeServiceName=function(f,c){if(x["default"]("ie")||x["default"]("trident")||x["default"]("edge")){var l=f.indexOf("admin/services/Hosted/"),k=v["default"].isPortal()&&!c?-1<f.indexOf(".MapServer")?f.indexOf(".MapServer"):-1<f.indexOf(".VectorTileServer")?
f.indexOf(".VectorTileServer"):f.indexOf("/SceneServer"):f.indexOf("/FeatureServer");0<l&&(f=f.substring(0,l+22)+encodeURIComponent(f.substring(l+22,k))+f.substring(k))}return f};h.getImageryToTilePackageParams=function(f,c){var l,k=f.id,z=f.itemUrl||f.portal.portalUrl+"content/items/"+k,u=f.portal.getPortalUser();u=(null===(l=null===u||void 0===u?void 0:u.credential)||void 0===l?void 0:l.token)||(null===u||void 0===u?void 0:u.token);return{inputImageryLayer:JSON.stringify({itemId:k,url:z+"?token\x3d"+
u}),outputTilePackage:c||"tpk"+k,context:"{}"}};h.exportImageryToTilePackage=function(f,c,l){f=h.getImageryToTilePackageParams(f,c);f=e.__assign(e.__assign({},f),{f:"json"});return h.createImageryTask({taskName:"ExportToTilePackage",inputParameters:f,updateDelay:2E4,statusCallback:l,outputParameterName:"outTilePackage"})};h.fetchExportImageryCredits=function(f){f=h.getImageryToTilePackageParams(f);f={inputAnalysisTask:JSON.stringify({name:"ExportToTilePackage",parameters:f}),f:"json",context:"{}"};
return h.createImageryTask({taskName:"EstimateRasterAnalysisCost",inputParameters:f,updateDelay:2E3,outputParameterName:"outCost"})};h.createImageryTask=function(f){var c=f.taskName,l=f.updateDelay,k=f.inputParameters,z=f.outputParameterName,u=f.statusCallback,n=new b["default"],B=new D["default"](m["default"].self.helperServices.rasterAnalytics.url+"/"+c);l&&B.setUpdateDelay(l);var H,Q=!1,O=function(P){return!Q&&n.reject(P)};B.on("error",O);B.submitJob(k,function(P){if(!Q)if("esriJobSucceeded"===
P.jobStatus){if(!z)return n.resolve({success:!0});B.getResultData(P.jobId,z).then(function(T){n.resolve({success:null!=(null===T||void 0===T?void 0:T.value),outputValue:null===T||void 0===T?void 0:T.value})},O)}else n.resolve({success:!1})},function(P){H=P.jobId;null===u||void 0===u?void 0:u(P)},O);return{canceller:function(){H&&(Q=!0,B.cancelJobStatusUpdates(H),B.cancelJob(H,null,null))},dfd:n}};h.fetchBuildingSceneSubLayer=function(f,c,l){return new Promise(function(k){v["default"].request({url:f+
"/layers/"+c+"/sublayers/"+l}).then(function(z){k({layerId:c,subLayer:z})},function(){k({layerId:c,subLayer:{}})})})};h.fetchPartialUpdateBuildingScenePublishingCredits=function(f,c,l){var k=this,z=c.serviceInfo||{},u=z.layers||[],n=f.url+"/extractChanges",B={returnIdsOnly:!0,returnInserts:!0,returnUpdates:!0,returnDeletes:!0,layers:[],layerServerGens:[],async:!1,dataFormat:"json"},H={},Q={textured:0,untextured:0},O=(c.portal||{}).portalUrl+"portals/self/usageCost",P={name:z.name,etype:"tilegencnt",
stype:"scene"},T;return new Promise(function(V){var X=[];l.forEach(function(I){var U,E;T=u.find(function(L){return L.id===I.id});(null===(U=T.sublayers)||void 0===U?void 0:U.filter(function(L){return"3DObject"===L.layerType}).map(function(L){return L.id})).forEach(function(L){X.push(k.fetchBuildingSceneSubLayer(c.url,I.id,L))});T.isTextured=!(null===(E=null===T||void 0===T?void 0:T.multiPatchInfo)||void 0===E||!E.hasTexture);H[I.id]=T});Promise.all(X).then(function(I){var U={};I.forEach(function(E){var L=
E.subLayer,da=L.associatedLayerID;L=L.serviceUpdateTimeStamp.lastUpdate;U[da]=E.layerId;B.layers.push(da);B.layerServerGens.push({id:da,serverGen:L})});v["default"].request({url:n,content:e.__assign(e.__assign({},B),{layers:JSON.stringify(B.layers),layerServerGens:JSON.stringify(B.layerServerGens)})},{usePost:!0}).then(function(E){(null===E||void 0===E?0:E.edits)?(Object.keys(E.edits).forEach(function(L){L=E.edits[L];var da=L.objectIds;Q[H[U[L.id]].isTextured?"textured":"untextured"]+=da.adds.length+
da.updates.length+da.deletes.length}),p["default"]({textured:0<Q.textured?v["default"].request({url:O,content:e.__assign({num:Q.textured,task:"textured"},P)}):null,untextured:0<Q.untextured?v["default"].request({url:O,content:e.__assign({num:Q.untextured,task:"nontextured"},P)}):null}).then(function(L){var da,R;L=((null===(da=null===L||void 0===L?void 0:L.textured)||void 0===da?void 0:da.credits)||0)+((null===(R=null===L||void 0===L?void 0:L.untextured)||void 0===R?void 0:R.credits)||0);V(L)},function(){V(0)})):
V(0)},function(E){V(0)})},function(){V(0)})})};h.fetchPartialUpdateScenePublishingCredits=function(f,c,l){var k=new b["default"],z=(f.adminServiceInfo||{}).layers||[],u=c.serviceInfo||{},n=u.layers||[];f=f.url+"/extractChanges";var B={returnIdsOnly:!0,returnInserts:!0,returnUpdates:!0,returnDeletes:!0,layers:[],layerServerGens:[],async:!1,dataFormat:"json"},H={},Q={textured:0,untextured:0},O=(c.portal||{}).portalUrl+"portals/self/usageCost",P={name:u.name,etype:"tilegencnt",stype:"scene"},T;l.forEach(function(V){var X;
B.layers.push(V.id);(T=F["default"].find(z,function(U){return U.id===V.id}))||1!==z.length||(T=z[0]);if(T){var I=V.id;I!==T.id&&(I=T.id);T.isTextured=!(null===(X=null===T||void 0===T?void 0:T.multiPatchInfo)||void 0===X||!X.hasTexture);H[I]=T}});n.forEach(function(V){-1<B.layers.indexOf(V.id)&&V.serviceUpdateTimeStamp&&B.layerServerGens.push({id:V.id,serverGen:V.serviceUpdateTimeStamp.lastUpdate})});v["default"].request({url:f,content:e.__assign(e.__assign({},B),{layers:JSON.stringify(B.layers),layerServerGens:JSON.stringify(B.layerServerGens)})},
{usePost:!0}).then(function(V){(null===V||void 0===V?0:V.edits)?(Object.keys(V.edits).forEach(function(X){X=V.edits[X];var I=X.objectIds;Q[H[X.id].isTextured?"textured":"untextured"]+=I.adds.length+I.updates.length+I.deletes.length}),p["default"]({textured:0<Q.textured?v["default"].request({url:O,content:e.__assign({num:Q.textured,task:"textured"},P)}):null,untextured:0<Q.untextured?v["default"].request({url:O,content:e.__assign({num:Q.untextured,task:"nontextured"},P)}):null}).then(function(X){var I,
U;X=((null===(I=null===X||void 0===X?void 0:X.textured)||void 0===I?void 0:I.credits)||0)+((null===(U=null===X||void 0===X?void 0:X.untextured)||void 0===U?void 0:U.credits)||0);k.resolve(X)},function(){k.resolve(0)})):k.resolve(0)},function(V){k.resolve(0)});return k};h.fetchScenePublishingCredits=function(f,c,l){var k=new b["default"],z=f.adminServiceInfo||{},u=z.layers||[],n=f.url+"/query",B={},H={},Q={textured:0,untextured:0},O=(f.portal||{}).portalUrl+"portals/self/usageCost",P={name:z.name,
etype:"tilegencnt",stype:"scene"},T;c.length&&l?u.forEach(function(V){var X;V.isTextured=!(null===(X=null===V||void 0===V?void 0:V.multiPatchInfo)||void 0===X||!X.hasTexture);H[V.id]=V;B[V.id]="1\x3d1"}):c.forEach(function(V){var X;(T=F["default"].find(u,function(U){return U.id===V.id}))||1!==u.length||(T=u[0]);if(T){var I=V.id;I!==T.id&&(I=T.id);T.isTextured=!(null===(X=null===T||void 0===T?void 0:T.multiPatchInfo)||void 0===X||!X.hasTexture);H[I]=T;B[I]="1\x3d1"}});v["default"].request({url:n,content:e.__assign(e.__assign({},
{}),{layerDefs:JSON.stringify(B),returnCountOnly:!0})}).then(function(V){(null===V||void 0===V?0:V.layers)?(V.layers.forEach(function(X){Q[H[X.id].isTextured?"textured":"untextured"]+=X.count}),p["default"]({textured:0<Q.textured?v["default"].request({url:O,content:e.__assign({num:Q.textured,task:"textured"},P)}):null,untextured:0<Q.untextured?v["default"].request({url:O,content:e.__assign({num:Q.untextured,task:"nontextured"},P)}):null}).then(function(X){var I,U;X=((null===(I=null===X||void 0===
X?void 0:X.textured)||void 0===I?void 0:I.credits)||0)+((null===(U=null===X||void 0===X?void 0:X.untextured)||void 0===U?void 0:U.credits)||0);k.resolve(X)},function(){k.resolve(0)})):k.resolve(0)},function(){k.resolve(0)});return k};h.getServerLicenseInfo=function(f){f+="/admin/system/licenses";return v["default"].request({url:f},{useProxy:m["default"].isDebug||v["default"].shouldUseProxy(f)})};h.findManagedDataStoreItems=function(f){f+="/admin/data/findItems";return v["default"].request({url:f,
content:{managed:!0}},{useProxy:m["default"].isDebug||v["default"].shouldUseProxy(f)})};h.findRasterStoreItems=function(f){f+="/admin/data/findItems";return v["default"].request({url:f,content:{types:"rasterStore",decrypt:!0}},{useProxy:m["default"].isDebug||v["default"].shouldUseProxy(f)})};h.isBackedBySDS=function(f){var c,l=new b["default"],k=(null===(c=null===m["default"]||void 0===m["default"]?void 0:m["default"].self)||void 0===c?void 0:c.user)||{};c=new g["default"]({portalUser:k});var z=!1,
u;k&&(c.isBasedOnAdmin()||c.isBasedOnPublisher())&&f&&!A["default"].isEmptyObject(f)?this.findManagedDataStoreItems(f.adminUrl).then(function(n){u=((null===n||void 0===n?void 0:n.items)||n||[]).filter(function(B){var H;return"arcgis data store"===(null===(H=null===B||void 0===B?void 0:B.provider)||void 0===H?void 0:H.toLowerCase())});z=!(null===u||void 0===u||!u.length);l.resolve(z)},function(){l.resolve(z)}):l.resolve(z);return l};h.isImageManagementTask=function(f){if(!f||-1===f.indexOf("RasterAnalysisTools")||
-1===f.indexOf("GPServer/"))return!1;f=f.slice(f.indexOf("GPServer/")+9);-1<f.indexOf("/")&&(f=f.slice(0,f.indexOf("/")));var c="buildfootprints buildoverview calculatestatistics definenodata computecolorcorrection computeseamlines".split(" ");return f&&-1<c.indexOf(f.toLowerCase())};h.getBackingDataStoreInfo=function(f){var c,l=new b["default"],k=(null===(c=null===m["default"]||void 0===m["default"]?void 0:m["default"].self)||void 0===c?void 0:c.user)||{};c=new g["default"]({portalUser:k});var z=
!0,u=!1,n=!1,B=!1,H,Q,O;k&&(c.isBasedOnAdmin()||c.isBasedOnPublisher())&&f&&!A["default"].isEmptyObject(f)?this.findManagedDataStoreItems(f.adminUrl).then(function(P){P=(null===P||void 0===P?void 0:P.items)||P||[];H=P.filter(function(T){var V;return"arcgis data store"===(null===(V=null===T||void 0===T?void 0:T.provider)||void 0===V?void 0:V.toLowerCase())});Q=P.filter(function(T){var V,X,I;return"arcgis data store"===(null===(V=null===T||void 0===T?void 0:T.provider)||void 0===V?void 0:V.toLowerCase())&&
"spatiotemporal"===(null===(I=null===(X=T.info)||void 0===X?void 0:X.dsFeature)||void 0===I?void 0:I.toLowerCase())});O=P.filter(function(T){var V,X,I,U;return"arcgis data store"===(null===(V=null===T||void 0===T?void 0:T.provider)||void 0===V?void 0:V.toLowerCase())&&"nosql"===(null===(X=T.type)||void 0===X?void 0:X.toLowerCase())&&"graphstore"===(null===(U=null===(I=T.info)||void 0===I?void 0:I.dsFeature)||void 0===U?void 0:U.toLowerCase())});z=0===P.length;u=!(null===H||void 0===H||!H.length);
n=!(null===Q||void 0===Q||!Q.length);B=!(null===O||void 0===O||!O.length);l.resolve({isSDS:u,isSTDS:n,isGraph:B,none:z})},function(){l.resolve({isSDS:u,isSTDS:n,isGraph:B,none:z})}):l.resolve({isSDS:u,isSTDS:n,isGraph:B,none:z});return l};h.cacheMaxAgeCheck=function(f,c){var l;if(!f.ignoreCache&&f.layers&&"Feature Service"===f.type&&f.isHostedService&&0<(null===(l=null===c||void 0===c?void 0:c.adminServiceInfo)||void 0===l?void 0:l.cacheMaxAge)&&(f.ignoreCache=function(){var z=this;this.ignoreCacheFlagTimestamp=
(new Date).getTime();var u=function(n){n.content=n.content||{};n.content._ts=z.ignoreCacheFlagTimestamp;return n};this.ignoreCacheFlag||(G["default"].setRequestPreCallback(u),this.ignoreCacheFlag=!0)},f.layers)){var k=0;f.layers.forEach(function(z){var u;(null===(u=z.editingInfo)||void 0===u?0:u.lastEditDate)&&k<z.editingInfo.lastEditDate&&(k=z.editingInfo.lastEditDate)});0<k&&((new Date).getTime()-k)/1E3<c.adminServiceInfo.cacheMaxAge&&f.ignoreCache()}};h.isServiceProxy=function(f){var c=(f||"").toLowerCase();
f=-1<c.indexOf("/servers/")&&-1<c.indexOf("/rest/services/");var l=m["default"].self.isPortal&&-1<c.indexOf(m["default"].self.portalHostname);c=!m["default"].self.isPortal&&-1<c.indexOf(".arcgis.com");return f&&(l||c)};h.ASYNC_POLL_INTERVALS=[2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,15E3,15E3,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,12E4];return h}()})},"arcgisonline/sharing/dijit/SaveItem":function(){define("require exports tslib ../../esriGeowConfig ../../pages/pageUtil ../../pages/dijit/CategoryPicker ../../pages/utils/arrays ../../pages/utils/dom ../../pages/utils/storage ../util ../geow/Folder ../../tsutils/declareDecorator arcgis-components/wrappers/Tags dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/on dojo/topic dojo/data/ItemFileWriteStore dojo/i18n!../../nls/arcgisonline dojo/text!./templates/SaveItem.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);D=e.__importDefault(D);A=e.__importDefault(A);g=e.__importDefault(g);v=e.__importDefault(v);m=e.__importDefault(m);h=e.__importDefault(h);f=e.__importDefault(f);c=e.__importDefault(c);l=e.__importDefault(l);k=e.__importDefault(k);z=e.__importDefault(z);return function(){function u(n,B){this.declaredClass=
"arcgisonline.sharing.dijit.SaveItem";this.widgetsInTemplate=!0;this.templateString=z["default"];this.baseClass="esriAGOSaveItemForm";this.init=!1;this.folders={}}u.prototype.postMixInProperties=function(){this.i18n=e.__assign(e.__assign(e.__assign({},k["default"].common),k["default"].saveItem),{addTags:k["default"].itemCompleteness.addTags})};u.prototype.postCreate=function(){this.inherited(arguments);this.init||(this.saveItemTags=new F.TagsWrapper(this.saveItemTagsContainer,{activeTags:[],knownTags:[],
maxWidth:"100%",minWidth:"100%"}),this.getFolders(),this.init=!0)};u.prototype.startup=function(){this.inherited(arguments);this.initHandlers()};u.prototype.hideRow=function(n){y["default"].hideNodes(this.domNode.querySelectorAll(".save-item-"+n+"-row"))};u.prototype.loadTags=function(n){var B=G["default"].getUser();n&&(B=n);return G["default"].loadUserTags(B.username)};u.prototype.loadCategories=function(n){var B=this,H=new h["default"],Q=this.domNode.querySelectorAll(".categories-container");b["default"].self.hasCategorySchema?
G["default"].request({url:b["default"].restBaseUrl+"portals/self/categorySchema"}).then(function(O){B.categories=new p["default"]({categories:n||[],schema:O.categorySchema},B.saveItemCategories);B.categories.startup();y["default"].showNodes(Q);H.resolve()},function(){y["default"].hideNodes(Q);H.resolve()}):(y["default"].hideNodes(Q),H.resolve());return H};u.prototype.initHandlers=function(){var n=this.validate.bind(this);this.own(f["default"](this.saveItemFolder,"change",this.onFolderChange.bind(this)),
f["default"](this.saveItemTitle,"change",n),f["default"](this.saveItemSummary,"change",n),t["default"].registerKeystrokeHandler(this.saveItemTitle,n),t["default"].registerKeystrokeHandler(this.saveItemSummary,n))};u.prototype.validate=function(){var n,B;if(!this.beingDestroyed){var H=!0,Q=this.saveItemTitle.get("value"),O=(null===(B=null===(n=this.saveItemTags)||void 0===n?void 0:n.getTags())||void 0===B?void 0:B.join(","))||"";n=this.saveItemSummary.get("value");null===this.requires?H=!!(Q&&O&&n):
(x["default"].includes(this.requires,"title")&&(H=H&&!!Q),x["default"].includes(this.requires,"tags")&&(H=H&&0!==O.length),x["default"].includes(this.requires,"summary")&&(H=H&&!!n));c["default"].publish("onSaveItemValidate",[H])}};u.prototype.getFolders=function(){var n=this,B=G["default"].getUser();if(null!==B){var H=new l["default"]({url:null,data:{identifier:"name",items:[]}});H.newItem({name:B.username,id:""});this.saveItemFolder.set("store",H);this.saveItemFolder.set("value",B.username);D["default"].getFolders(function(Q){var O=
null,P=J["default"].getCookie("ESRI_Content");P&&P.folderId&&(O=P.folderId);n.foldersJson=Q.folders;Q.folders.forEach(function(T,V){H.newItem({name:T.title,id:T.id});n.folders["id"+T.id]=T.title.replace(/"/g,'\\"');O===T.id&&(n.saveItemFolder.set("value",T.title),n.folderId=O,n.folderName=T.title)});H.save({})},function(Q){})}};u.prototype.onFolderChange=function(n){var B=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(Q){Q.name[0]===n&&(B.folderId=Q.id[0],B.folderName=
Q.name[0])})}})};u.prototype._setTitleAttr=function(n){this.saveItemTitle.set("value",n)};u.prototype._getTitleAttr=function(){return this.saveItemTitle.get("value")};u.prototype._setTagsAttr=function(n){this.saveItemTags.setTags(n)};u.prototype._getTagsAttr=function(){return this.saveItemTags.getTags()};u.prototype._setCategoriesAttr=function(n){var B=this;n&&n.forEach(function(H){B.categories.addCategory(H)})};u.prototype._getCategoriesAttr=function(){return this.categories.getCategories(!0)};u.prototype._setSummaryAttr=
function(n){this.saveItemSummary.set("value",n)};u.prototype._getSummaryAttr=function(){return this.saveItemSummary.get("value")};u.prototype._setFolderAttr=function(n){var B=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(Q){Q.name[0]===n&&(B.folderId=Q.id[0],B.folderName=Q.name[0],B.saveItemFolder.set("value",B.folderName))})}})};u.prototype._getFolderAttr=function(){return this.folderName};u.prototype._setFolderIdAttr=function(n){var B=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(Q){Q.id[0]===
n&&(B.folderId=Q.id[0],B.folderName=Q.name[0],B.saveItemFolder.set("value",Q.name[0]))})}})};u.prototype._getFolderIdAttr=function(){return this.folderId};u.prototype._setRequiresAttr=function(n){this.requires=n?n:null};u.prototype._setTitlePlaceHolderAttr=function(n){this.saveItemTitle.set("placeHolder",n)};u.prototype._setTagsPlaceHolderAttr=function(n){this.saveItemTitle.set("placeHolder",n)};u.prototype._setSummaryPlaceHolderAttr=function(n){this.saveItemSummary.set("placeHolder",n)};return u=
e.__decorate([A["default"](v["default"],g["default"],m["default"])],u)}()})},"arcgis-components/wrappers/Tags":function(){define(["../Component","../Inputs/Tags/index"],function(a,w){return function(e){function b(p){if(t[p])return t[p].exports;var x=t[p]={i:p,l:!1,exports:{}};return e[p].call(x.exports,x,x.exports,b),x.l=!0,x.exports}var t={};return b.m=e,b.c=t,b.d=function(p,x,y){b.o(p,x)||Object.defineProperty(p,x,{enumerable:!0,get:y})},b.r=function(p){"undefined"!=typeof Symbol&&Symbol.toStringTag&&
Object.defineProperty(p,Symbol.toStringTag,{value:"Module"});Object.defineProperty(p,"__esModule",{value:!0})},b.t=function(p,x){if((1&x&&(p=b(p)),8&x)||4&x&&"object"==typeof p&&p&&p.__esModule)return p;var y=Object.create(null);if(b.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:p}),2&x&&"string"!=typeof p)for(var J in p)b.d(y,J,function(G){return p[G]}.bind(null,J));return y},b.n=function(p){var x=p&&p.__esModule?function(){return p["default"]}:function(){return p};return b.d(x,"a",
x),x},b.o=function(p,x){return Object.prototype.hasOwnProperty.call(p,x)},b.p="",b(b.s=987)}({0:function(e,b,t){function p(g,v){function m(){this.constructor=g}if("function"!=typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");A(g,v);g.prototype=null===v?Object.create(v):(m.prototype=v.prototype,new m)}function x(g,v){var m={},h;for(h in g)Object.prototype.hasOwnProperty.call(g,h)&&0>v.indexOf(h)&&(m[h]=g[h]);if(null!=g&&"function"==typeof Object.getOwnPropertySymbols){var f=
0;for(h=Object.getOwnPropertySymbols(g);f<h.length;f++)0>v.indexOf(h[f])&&Object.prototype.propertyIsEnumerable.call(g,h[f])&&(m[h[f]]=g[h[f]])}return m}function y(g,v,m,h){var f,c=arguments.length,l=3>c?v:null===h?h=Object.getOwnPropertyDescriptor(v,m):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(g,v,m,h);else for(var k=g.length-1;0<=k;k--)(f=g[k])&&(l=(3>c?f(l):3<c?f(v,m,l):f(v,m))||l);return 3<c&&l&&Object.defineProperty(v,m,l),l}function J(g,v,m,h){return new (m||
(m=Promise))(function(f,c){function l(u){try{z(h.next(u))}catch(n){c(n)}}function k(u){try{z(h["throw"](u))}catch(n){c(n)}}function z(u){var n;u.done?f(u.value):(n=u.value,n instanceof m?n:new m(function(B){B(n)})).then(l,k)}z((h=h.apply(g,v||[])).next())})}function G(g,v){function m(z){return function(u){return function(n){if(h)throw new TypeError("Generator is already executing.");for(;k;)try{if(h=1,f&&(c=2&n[0]?f["return"]:n[0]?f["throw"]||((c=f["return"])&&c.call(f),0):f.next)&&!(c=c.call(f,n[1])).done)return c;
switch(f=0,c&&(n=[2&n[0],c.value]),n[0]){case 0:case 1:c=n;break;case 4:return k.label++,{value:n[1],done:!1};case 5:k.label++;f=n[1];n=[0];continue;case 7:n=k.ops.pop();k.trys.pop();continue;default:if(!(c=k.trys,(c=0<c.length&&c[c.length-1])||6!==n[0]&&2!==n[0])){k=0;continue}if(3===n[0]&&(!c||n[1]>c[0]&&n[1]<c[3]))k.label=n[1];else if(6===n[0]&&k.label<c[1])k.label=c[1],c=n;else if(c&&k.label<c[2])k.label=c[2],k.ops.push(n);else{c[2]&&k.ops.pop();k.trys.pop();continue}}n=v.call(g,k)}catch(B){n=
[6,B],f=0}finally{h=c=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([z,u])}}var h,f,c,l,k={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return l={next:m(0),"throw":m(1),"return":m(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l}function D(g,v){for(var m=0,h=v.length,f=g.length;m<h;m++,f++)g[f]=v[m];return g}t.d(b,"d",function(){return p});t.d(b,"a",function(){return F});t.d(b,"f",function(){return x});t.d(b,"c",function(){return y});
t.d(b,"b",function(){return J});t.d(b,"e",function(){return G});t.d(b,"g",function(){return D});var A=function(g,v){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,h){m.__proto__=h}||function(m,h){for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(m[f]=h[f])})(g,v)},F=function(){return(F=Object.assign||function(g){for(var v,m=1,h=arguments.length;m<h;m++)for(var f in v=arguments[m])Object.prototype.hasOwnProperty.call(v,f)&&(g[f]=v[f]);return g}).apply(this,arguments)};
Object.create;Object.create},16:function(e,b){e.exports=a},713:function(e,b){e.exports=w},987:function(e,b,t){t.r(b);t.d(b,"TagsWrapper",function(){return G});var p=t(0),x=t(16);e=t(713);t=t.n(e);var y=function(D,A){switch(A.type){case "UPDATE_ACTIVE_TAGS":return Object(p.a)(Object(p.a)({},D),{activeTags:A.payload});case "UPDATE_KNOWN_TAGS":return Object(p.a)(Object(p.a)({},D),{knownTags:A.payload});default:return D}},J=Object(x.connect)(function(D){return{activeTags:D.activeTags,knownTags:D.knownTags}},
function(D){return{onChange:function(A){D({type:"UPDATE_ACTIVE_TAGS",payload:A})}}})(t.a),G=function(){function D(A,F){this.renderContainer=A;this.store=Object(x.createStore)(y,{activeTags:F.activeTags,knownTags:F.knownTags});this.projector=Object(x.createProjector)(this.store,function(g){return g(J,Object(p.a)({key:"wrapped-tags"},F))},this.renderContainer)}return D.prototype.destroy=function(){this.projector.stop();this.renderContainer.remove?this.renderContainer.remove():this.renderContainer.parentNode&&
this.renderContainer.parentNode.removeChild(this.renderContainer)},D.prototype.focus=function(){var A=this.renderContainer.querySelector("input");A&&A.focus()},D.prototype.getTags=function(){return this.store.getState().activeTags},D.prototype.setTags=function(A){this.store.dispatch({type:"UPDATE_ACTIVE_TAGS",payload:A})},D.prototype.getKnownTags=function(){return this.store.getState().knownTags},D.prototype.setKnownTags=function(A){this.store.dispatch({type:"UPDATE_KNOWN_TAGS",payload:A})},D.prototype.watchTags=
function(A){var F=this,g=this.store.getState().activeTags;return this.store.subscribe(function(){var v=F.store.getState().activeTags;v!==g&&A(g=v)})},D}()}})})},"arcgis-components/Inputs/Tags/index":function(){define(["../../Component","dojo/i18n!../../Inputs/Tags/nls/resources"],function(a,w){return function(e){function b(p){if(t[p])return t[p].exports;var x=t[p]={i:p,l:!1,exports:{}};return e[p].call(x.exports,x,x.exports,b),x.l=!0,x.exports}var t={};return b.m=e,b.c=t,b.d=function(p,x,y){b.o(p,
x)||Object.defineProperty(p,x,{enumerable:!0,get:y})},b.r=function(p){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"});Object.defineProperty(p,"__esModule",{value:!0})},b.t=function(p,x){if((1&x&&(p=b(p)),8&x)||4&x&&"object"==typeof p&&p&&p.__esModule)return p;var y=Object.create(null);if(b.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:p}),2&x&&"string"!=typeof p)for(var J in p)b.d(y,J,function(G){return p[G]}.bind(null,J));
return y},b.n=function(p){var x=p&&p.__esModule?function(){return p["default"]}:function(){return p};return b.d(x,"a",x),x},b.o=function(p,x){return Object.prototype.hasOwnProperty.call(p,x)},b.p="",b(b.s=859)}({0:function(e,b,t){function p(g,v){function m(){this.constructor=g}if("function"!=typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");A(g,v);g.prototype=null===v?Object.create(v):(m.prototype=v.prototype,new m)}function x(g,v){var m={},h;
for(h in g)Object.prototype.hasOwnProperty.call(g,h)&&0>v.indexOf(h)&&(m[h]=g[h]);if(null!=g&&"function"==typeof Object.getOwnPropertySymbols){var f=0;for(h=Object.getOwnPropertySymbols(g);f<h.length;f++)0>v.indexOf(h[f])&&Object.prototype.propertyIsEnumerable.call(g,h[f])&&(m[h[f]]=g[h[f]])}return m}function y(g,v,m,h){var f,c=arguments.length,l=3>c?v:null===h?h=Object.getOwnPropertyDescriptor(v,m):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(g,v,m,h);else for(var k=
g.length-1;0<=k;k--)(f=g[k])&&(l=(3>c?f(l):3<c?f(v,m,l):f(v,m))||l);return 3<c&&l&&Object.defineProperty(v,m,l),l}function J(g,v,m,h){return new (m||(m=Promise))(function(f,c){function l(u){try{z(h.next(u))}catch(n){c(n)}}function k(u){try{z(h["throw"](u))}catch(n){c(n)}}function z(u){var n;u.done?f(u.value):(n=u.value,n instanceof m?n:new m(function(B){B(n)})).then(l,k)}z((h=h.apply(g,v||[])).next())})}function G(g,v){function m(z){return function(u){return function(n){if(h)throw new TypeError("Generator is already executing.");
for(;k;)try{if(h=1,f&&(c=2&n[0]?f["return"]:n[0]?f["throw"]||((c=f["return"])&&c.call(f),0):f.next)&&!(c=c.call(f,n[1])).done)return c;switch(f=0,c&&(n=[2&n[0],c.value]),n[0]){case 0:case 1:c=n;break;case 4:return k.label++,{value:n[1],done:!1};case 5:k.label++;f=n[1];n=[0];continue;case 7:n=k.ops.pop();k.trys.pop();continue;default:if(!(c=k.trys,(c=0<c.length&&c[c.length-1])||6!==n[0]&&2!==n[0])){k=0;continue}if(3===n[0]&&(!c||n[1]>c[0]&&n[1]<c[3]))k.label=n[1];else if(6===n[0]&&k.label<c[1])k.label=
c[1],c=n;else if(c&&k.label<c[2])k.label=c[2],k.ops.push(n);else{c[2]&&k.ops.pop();k.trys.pop();continue}}n=v.call(g,k)}catch(B){n=[6,B],f=0}finally{h=c=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([z,u])}}var h,f,c,l,k={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return l={next:m(0),"throw":m(1),"return":m(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l}function D(g,v){for(var m=0,h=v.length,f=g.length;m<h;m++,f++)g[f]=
v[m];return g}t.d(b,"d",function(){return p});t.d(b,"a",function(){return F});t.d(b,"f",function(){return x});t.d(b,"c",function(){return y});t.d(b,"b",function(){return J});t.d(b,"e",function(){return G});t.d(b,"g",function(){return D});var A=function(g,v){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,h){m.__proto__=h}||function(m,h){for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(m[f]=h[f])})(g,v)},F=function(){return(F=Object.assign||function(g){for(var v,
m=1,h=arguments.length;m<h;m++)for(var f in v=arguments[m])Object.prototype.hasOwnProperty.call(v,f)&&(g[f]=v[f]);return g}).apply(this,arguments)};Object.create;Object.create},18:function(e,b){e.exports=a},417:function(e,b){e.exports=w},545:function(e,b,t){b.a=function(p,x){var y=p.name;return x("li",{"class":"inp-tags__tag",key:y},x("span",{title:y,"class":"inp-tags__tag-innards",onkeydown:p.onKeyDown,id:"tag-"+y,tabindex:"-1"},y,x("button",{"class":"inp-tags__tag-remove-btn","data-value":y,onclick:p.onRemove,
tabindex:"-1",type:"button"},x("svg",{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 32 32"},x("path",{d:"M18.404 16l9.9 9.9-2.404 2.404-9.9-9.9-9.9 9.9L3.696 25.9l9.9-9.9-9.9-9.898L6.1 3.698l9.9 9.899 9.9-9.9 2.404 2.406-9.9 9.898z"})))))}},546:function(e,b,t){var p=t(417);b.a=function(x,y){var J=x.onSuggestionFocus,G=x.onSuggestionBlur,D=x.onSuggestionClick,A=x.onSuggestionKeyDown;if(!x.visible)return null;var F=x.matchingTags.map(function(v,m){return y("li",{id:"suggestion-"+
m,classes:{"inp-tags__suggestion":!0,"inp-tags__suggestion--grey":0==m%2,"inp-tags__suggestion--white":0!=m%2},"data-value":v,"data-index":m,key:v,title:v,onfocus:J,onblur:G,onmousedown:D,onkeydown:A,tabindex:"0"},v)}),g=y("div",{"class":"inp-tags__no-suggestions",id:"no-matching-div"},y("div",{"class":"inp-tags__no-suggestions-text",id:"no-matching-text"},p.noTagsFound));return y("ul",{id:"tag-suggestions","class":"inp-tags__suggestions",key:"tag-suggestions"},F[0]?F:g)}},859:function(e,b,t){t.r(b);
var p=t(0);e=t(18);var x=t(417),y=t(545),J=t(546);t=function(G){function D(A){A=G.call(this,A)||this;return A.state={value:"",isFocused:!1,isTyping:!1,hasBeenFocused:!1},A.handleInputBlur=A.handleInputBlur.bind(A),A.handleInputChange=A.handleInputChange.bind(A),A.handleInputFocus=A.handleInputFocus.bind(A),A.handleInputKeyDown=A.handleInputKeyDown.bind(A),A.handleSuggestionBlur=A.handleSuggestionBlur.bind(A),A.handleSuggestionClick=A.handleSuggestionClick.bind(A),A.handleSuggestionFocus=A.handleSuggestionFocus.bind(A),
A.handleSuggestionKeyDown=A.handleSuggestionKeyDown.bind(A),A.handleWidgetClick=A.handleWidgetClick.bind(A),A.spliceTag=A.spliceTag.bind(A),A.handleTagInputKeyDown=A.handleTagInputKeyDown.bind(A),A}return Object(p.d)(D,G),D.prototype.render=function(A){var F=this,g={"inp-tags__active-tags":!0,"inp-tags__active-tags--focused":this.state.isFocused},v=this.props.knownTags.filter(function(m){return-1!==m.toLowerCase().indexOf(F.state.value.toLowerCase())&&-1===F.props.activeTags.indexOf(m)});return A("div",
{id:"tags-container",classes:{"inp-tags__container":!0},style:"\n                        min-width: "+(this.props.minWidth?this.props.minWidth:"auto")+";\n                        max-width: "+(this.props.maxWidth?this.props.maxWidth:"auto")+";\n                    "},A("ul",{classes:g,key:"active-tags",id:"active-tags"},this.props.activeTags.filter(function(m){return m}).map(function(m){return A(y.a,{name:m,onRemove:F.spliceTag,onKeyDown:F.handleTagInputKeyDown})}),A("input",{id:"tags-input","class":"inp-tags__input",
placeholder:x.addTags,value:this.state.value,onkeydown:this.handleInputKeyDown,onfocus:this.handleInputFocus,onblur:this.handleInputBlur,oninput:this.handleInputChange,afterCreate:this.handler})),A(J.a,{matchingTags:v,onSuggestionBlur:this.handleSuggestionBlur,onSuggestionClick:this.handleSuggestionClick,onSuggestionFocus:this.handleSuggestionFocus,onSuggestionKeyDown:this.handleSuggestionKeyDown,visible:this.state.isTyping}))},D.prototype.handler=function(A){},D.prototype.addTag=function(A,F){var g=
this;void 0===F&&(F=!0);var v=[];A.split(",").forEach(function(h){(h=g.stripHTML(h.trim()))&&-1===g.props.activeTags.indexOf(h)&&-1===v.indexOf(h)&&v.push(h)});this.props.onChange(this.props.activeTags.concat(v));var m=document.getElementById("tags-input");m&&F&&m.focus()},D.prototype.spliceTag=function(A){A=A.currentTarget||A.target;var F=Object(p.g)([],this.props.activeTags);F.splice(this.props.activeTags.indexOf(A.dataset.value),1);this.props.onChange(F)},D.prototype.handleInputBlur=function(A){var F=
this;setTimeout(function(){var g=document.getElementById("tags-container");(null==g?0:g.contains(document.activeElement))||(F.addTag(A.target.value,!1),F.setState({value:"",hasBeenFocused:!0,isFocused:!1,isTyping:!1}))})},D.prototype.handleInputChange=function(A){this.setState({value:A.target.value})},D.prototype.handleInputFocus=function(){this.setState({isFocused:!0})},D.prototype.handleInputKeyDown=function(A){switch(A.key){case "Enter":A.target.value&&(this.addTag(A.target.value),this.setState({value:"",
isTyping:!1}),(F=document.getElementById("tags-input"))&&(F.focus(),F.value=""));break;case "Tab":var F;A.target.value&&(A.preventDefault(),this.addTag(A.target.value),this.setState({value:"",isTyping:!1}),(F=document.getElementById("tags-input"))&&(F.focus(),F.value=""));break;case "Backspace":A.target.value||(A=Object(p.g)([],this.props.activeTags),A.pop(),this.props.onChange(A),this.setState({value:"",isTyping:!1}));break;case "Down":case "ArrowDown":F=document.getElementById("suggestion-0");this.state.isTyping&&
F?(A.preventDefault(),F.focus()):this.setState({isTyping:!0});break;case "Up":case "ArrowUp":case "Left":case "ArrowLeft":this.focusElement(document.getElementById("tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;default:this.setState({isTyping:!0})}},D.prototype.handleSuggestionBlur=function(A){A.preventDefault();this.setState({isFocused:!1,isTyping:!1})},D.prototype.handleSuggestionClick=function(A){A.preventDefault();this.addTag(A.target.dataset.value);this.setState({value:"",
isFocused:!0,isTyping:!1});(A=document.getElementById("tags-input"))&&(A.focus(),A.value="")},D.prototype.handleSuggestionFocus=function(A){A.preventDefault();this.setState({isFocused:!0,isTyping:!0})},D.prototype.handleSuggestionKeyDown=function(A){switch(A.preventDefault(),A.key){case "Up":case "ArrowUp":0===A.target["data-index"]?this.focusElement(document.getElementById("tags-input")):this.focusElement(document.getElementById("suggestion-"+(A.target["data-index"]-1)));break;case "Down":case "ArrowDown":(A=
document.getElementById("suggestion-"+(A.target["data-index"]+1)))?A.focus():this.focusElement(document.getElementById("suggestion-0"));break;case "Tab":case "Enter":this.handleSuggestionClick(A);break;case "Escape":A.preventDefault(),this.focusElement(document.getElementById("tags-input"))}},D.prototype.handleWidgetClick=function(A){(A=document.getElementById("tags-input"))&&A.focus()},D.prototype.handleTagInputKeyDown=function(A){var F=document.activeElement.getAttribute("title");if(F){var g=this.props.activeTags.indexOf(F);
switch(A.key){case "Left":case "ArrowLeft":this.focusElement(document.getElementById(0<g?"tag-"+this.props.activeTags[g-1]:"tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;case "Right":case "ArrowRight":this.focusElement(document.getElementById(g<this.props.activeTags.length-1?"tag-"+this.props.activeTags[g+1]:"tag-"+this.props.activeTags[0]));break;case "Down":case "ArrowDown":this.focusElement(document.getElementById("tags-input"));break;case "Backspace":case "Delete":A=Object(p.g)([],
this.props.activeTags),A.splice(this.props.activeTags.indexOf(F),1),this.props.onChange(A),this.focusElement(document.getElementById("tag-"+this.props.activeTags[g<this.props.activeTags.length-1?g+1:g-1]))}}},D.prototype.focusElement=function(A){A&&A.focus()},D.prototype.stripHTML=function(A){return A&&A.replace(/<(?:.|\s)*?>/g,"")},D}(e.Component);b["default"]=t}})})},"arcgisonline/sharing/dijit/dialog/InvitationsDlg":function(){define("require esri/declare esri/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query dojo/string dojo/topic dijit/a11yclick dojo/promise/all dojo/store/Memory dijit/Tooltip dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/pageUtil ../../../pages/utils/date ../../../pages/utils/formatters ../../../pages/utils/icons ../Grid ./ConfirmDialog ./GeneralDlg dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/InvitationsDlg.html dojo/text!./templates/InvitationsDlgGroup.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T){var V=w("arcgisonline.sharing.dijit.dialog.InvitationsDlg",[h,f,c,e],{basePath:a.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriInvitationsDlg",widgetsInTemplate:!0,templateString:P,invitations:null,groupsUser:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.mixin({},O.common);b.mixin(this.i18n,O.invitationsDlg);b.mixin(this.i18n,O.invitationsGrid)},postCreate:function(){this.loadConnections()},
show:function(X,I){this.clearStore();I&&(I.username||I.email)&&(this.groupsUser=I);this.invitations=X;this.getGroupInfos();this._dialog.show()},update:function(X){this.clearStore();this.invitations=X;this.getGroupInfos();this._dialog.show()},getGroupInfos:function(){var X=l.getUser(),I=[];if(null!==X){var U=this.groupsUser&&this.groupsUser.username?this.groupsUser.username:this.groupsUser&&this.groupsUser.email?this.groupsUser.email:X.username;for(X=0;X<this.invitations.length;X++)I.push(l.request({url:esriGeowConfig.restBaseUrl+
"community/users/"+U+"/invitations/"+this.invitations[X].groupId}));A(I).then(function(E){t.forEach(E,function(da,R){this.invitations[R].fromUsername=da.fromUsername.username;this.invitations[R].fromUserFullname=da.fromUsername.fullname;this.invitations[R].groupTitle=da.group.title;this.invitations[R].groupOwner=da.group.owner;this.invitations[R].groupIsPrivate="private"===da.group.access;this.invitations[R].groupAccess=da.group.access;this.invitations[R].groupDescription=da.group.description;this.invitations[R].groupThumbnail=
da.group.thumbnail;this.invitations[R].leavingDisallowed=da.group.leavingDisallowed;this.groupsUser&&(this.invitations[R].asUser=U)}.bind(this));var L=this._invitationsGrid._grid.store;t.forEach(this.invitations,function(da){L.put(da)}.bind(this));this.refresh()}.bind(this))}},loadConnections:function(){this.own(y(".jevent").on("click",function(X){X&&X instanceof Event&&X.preventDefault()}),x(this._closeBtn,"click",function(){this._dialog.hide()}.bind(this)),G.subscribe("onInvitationAccept",this.onInvitationAccept.bind(this)),
G.subscribe("onInvitationDecline",this.onInvitationDecline.bind(this)))},createGrid:function(){this._invitationsGrid=new B({id:"invitationsGrid",columns:this.getInvitationGridColumns(),noDataMessage:this.i18n.noGroupInvites,showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"invitations-grid",store:new F({idProperty:"id",label:"groupTitle",data:[]}),sort:[{attribute:"received",descending:!1}]},this._invitationsGridContainer);this._invitationsGrid.startup()},
clearStore:function(){this._invitationsGrid||this.createGrid();var X=this._invitationsGrid&&this._invitationsGrid._grid&&this._invitationsGrid._grid.store||void 0;X&&t.forEach(b.clone(X.query()),function(I){X.remove(I.id)})},getInvitationGridColumns:function(){return{groupTitle:{label:this.i18n.groupName,sortable:!1,renderCell:function(X){var I=!1;this.groupsUser&&(this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:admin:viewGroups")?I=!0:this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:user:viewOrgGroups")&&
"private"!==X.groupAccess?I=!0:"public"===X.groupAccess&&(I=!0));var U=X.groupThumbnail?esriGeowConfig.restBaseUrl+"community/groups/"+X.groupId+"/info/"+X.groupThumbnail+"?token\x3d"+l.getToken():"",E=z.format(new Date(X.received),"long-date");E=J.substitute(O.GroupWidget.invitedEventDescription,{fullName:X.fromUserFullname,fullDate:E});I={i18n:O,icons:n,id:X.groupId,title:X.groupTitle,thumbnail:X.groupThumbnail,thumbnailUrl:U,notificationSummary:E,fillColor:"#"+X.groupId.substr(X.groupId.length-
6),useLetter:X.groupTitle.charAt(0)&&X.groupTitle.charAt(0).match(/^\w+$/),isPrivate:!I};I=p.toDom(J.substitute(T,I,null,{hide:u.hide,show:u.show,firstChar:u.firstChar,stripHTML:u.stripHTML}));U=y(".js-accept-invitation",I).shift();E=y(".js-decline-invitation",I).shift();var L=X.asUser?X.asUser:null,da=X.leavingDisallowed?this.confirmLeavingDisallowed.bind(this,X,L):this.acceptInvitation.bind(this,X,L);X=this.declineInvitation.bind(this,X,L);this.own(D(U,da),D(E,X));return I}.bind(this)}}},confirmLeavingDisallowed:function(X,
I){var U=O.invitationsDlg.leavingDisabled,E=k.createSpecifiedDialog(H,{"class":"general-dialog",title:O.invitationsDlg.joinGroup,buttonOkLabel:O.invitationsDlg.joinGroup,style:{height:"auto"}});E.setContent(U);E.show().then(function(L){"onOk"===L&&(this.acceptInvitation(X,I),E.hide())}.bind(this))},acceptInvitation:function(X,I){var U=l.getUser(),E=this._invitationsGrid._grid.store,L=X.groupId;U&&l.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(I?I:U.username)+"/invitations/"+L+"/accept",
content:{}},{usePost:!0}).then(function(da){E.remove(X.id);G.publish("onInvitationAccept",{})}.bind(this),function(da){var R=l.getUser();R=R&&R.orgId?this.i18n.acceptFailure:this.i18n.acceptFailurePublic;"COM_1050"===da.messageCode?R=this.i18n.privilegeError:"ORG_3103"===da.messageCode&&(R=this.i18n.maxExternalOrgs);k.createSpecifiedDialog(Q).show({title:this.i18n.errorTitle,message:R})}.bind(this))},declineInvitation:function(X,I){var U=l.getUser(),E=X.groupId,L=this._invitationsGrid._grid.store;
U&&l.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(I?I:U.username)+"/invitations/"+E+"/decline"},{usePost:!0}).then(function(){L.remove(X.id);G.publish("onInvitationDecline",{})}.bind(this))},onInvitationAccept:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},onInvitationDecline:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},hide:function(){this._dialog.hide()},refresh:function(){if(this._invitationsGrid._grid&&
this._invitationsGrid._grid._started){var X=this._invitationsGrid._grid._currentPage||1,I=this._invitationsGrid._grid.store?this._invitationsGrid._grid.store.query().length:0;x.once(this._invitationsGrid._grid,"dgrid-refresh-complete",function(U){U.grid._currentPage!==X&&0<I&&U.grid.gotoPage(X)});this._invitationsGrid._grid.resize();this._invitationsGrid._grid.refresh()}}});V.prototype.statics={getInstance:function(){this._instance||(this._instance=new V);return this._instance}};return V})},"arcgisonline/sharing/dijit/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/string dojo/_base/array dojo/on dojo/aspect dijit/_WidgetBase dijit/TooltipDialog dijit/popup dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/extensions/ColumnResizer dgrid/Keyboard ./_RefreshMixin ./Rating dojo/query dojo/dom-class dojo/dom-style dojo/when dojo/store/Memory dgrid/Selection dgrid/selector dojo/store/Observable put-selector/put dgrid/util/mouse dgrid/util/touch arcgisonline/sharing/util ../../pages/utils/date ../../pages/utils/keys arcgisonline/sharing/geow/Content dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da,R){esri.i18nBundle=R;return a("arcgisonline.sharing.dijit.Grid",[x],{postMixInProperties:function(){this.inherited(arguments);this._util=U;this._content=da;this._supportedViews=["gallery","details","table"];this._favorites={};this._portalUser=this._util.getUser();this._galleryTemplate=this._galleryTemplate||"\x3cdiv style\x3d'opacity:0;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e${item:_formatItemTypeIcon}\x3c/div\x3e";
this._detailsTemplate=this._detailsTemplate||'\x3cdiv style\x3d\'opacity:0;\' class\x3d\'grid-item detail-view\'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e${item:_formatItemTypeIcon}\x3cp class\x3d"grid-item-type"\x3e${item:_formatType}\x3c/p\x3e\x3cp class\x3d"grid-item-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cspan class\x3d"openItem" id\x3d"openItem"\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.gallery.details}\x3c/a\x3e\x3c/div\x3e';
this._itemPopupTemplate=this._itemPopupTemplate||'\x3cdiv class\x3d"grid-item-hover"\x3e\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cspan id\x3d\'openItem\'\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.details}\x3c/a\x3e\x3cp class\x3d"item-hover-type"\x3e${item:_formatItemTypeIcon}${item:_formatType} by\x26nbsp;${item.owner:_formatOwnerLink}\x3c/p\x3e\x3cp class\x3d"item-hover-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
this._renderers=w.mixin(this._renderers||{},{gallery:w.hitch(this,function(M){M.snippet=M.snippet||"";var r=V("div"),N=new (a([x,G,D],{templateString:e.substitute(this._galleryTemplate,{item:M,i18n:R.gallery},null,this)}));M.widget=N;r.appendChild(N.domNode);return r}),details:w.hitch(this,function(M){M.snippet=M.snippet||"";var r=V("div"),N=new (a([x,G,D],{templateString:e.substitute(this._detailsTemplate,{item:M,i18n:R},null,this)})),W=new A({label:R.gallery.open,className:"btn calcite primary",
dropDown:this._getOpenInMenu(M)},u(".openItem",r)[0]);M.widget=N;r.appendChild(N.domNode);u(".openItem",r).replaceWith(W.domNode);0===W.dropDown.getChildren().length&&W.set("disabled",!0);return r}),table:function(){return V("div",v.prototype.renderRow.apply(this,arguments))}})},buildRendering:function(){this.inherited(arguments);var M=a([v,h,m,c,O,k]),r=this.columns||{title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},access:{label:"sharing"}};this._view=this.view||"table";
this._query=this.query;this._sort=this.sort||[{attribute:"title",descending:!1}];this._queryOptions=this.queryOptions||{sort:this.sort};this._store=this.store||new Q({data:[]});this._rowsPerPage=this.rowsPerPage||9;this._pagingLinks=this.pagingLinks?this.pagingLinks:3;this._showHeader=this.showHeader||!1;this._selectionMode=this.selectionMode||"extended";this._useTouchScroll=this.useTouchScroll||!1;this._grid=new M({columns:r,renderRow:this._renderers[this._view],noDataMessage:this.noDataMessage||
"",showHeader:this._showHeader,store:this._store,query:this._query,showLoadingMessage:!1,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,allowSelectAll:!0,selectionMode:this._selectionMode,sort:this._sort},this.domNode);this._grid.startup()},postCreate:function(){this.inherited(arguments);this.own(this._grid.on("refresh",w.hitch(this,function(){this._grid.showFooter=this._grid._total>this._grid.rowsPerPage;this._onGridRefresh()})),
p.before(this._grid,"removeRow",w.hitch(this,function(M){M&&(M=this._grid.row(M),(M=(M.data||M).widget)&&M.destroyRecursive())})),this._grid.on(".fav-icon a:click",w.hitch(this,function(M){M.preventDefault();var r=this._grid.row(M),N=M.target.parentNode.parentNode.parentNode,W=n.contains(M.target.parentNode,"fav-off");M=this._content[W?"addToFavorites":"removeFromFavorites"](r.data).then(w.hitch(this,function(){this._favorites[r.data.id].id=W?r.data.id:!1}));u(".fav-on",N).style({display:W?"":"none"});
u(".fav-off",N).style({display:W?"none":""});setTimeout(w.hitch(this,function(){u(".fav-on",N).style({width:W?"200px":"24px"});u(".fav-off",N).style({width:W?"24px":"200px"});setTimeout(w.hitch(this,function(){u(".fav-on, .fav-off").style({width:"24px"})}),2500)}),50);M.then(w.hitch(this,function(){}))})),this._grid.on(".fav-icon a:mouseout",w.hitch(this,function(M){B.set(M.target.parentNode,{width:"24px"})})));!esri.isTouchEnabled||"gallery"!==this._view&&"details"!==this._view?"gallery"!==this._view&&
"details"!==this._view||this.own(this._grid.on(X.enterRow,w.hitch(this,function(M){if(M.relatedTarget&&!1===n.contains(M.relatedTarget,"dijitMenu")&&!1===n.contains(M.relatedTarget,"dijitReset")){var r=this._grid.row(M),N=u("img",r.element)[0];clearTimeout(this._showPopupTimeout);N&&(this._showPopupTimeout=setTimeout(w.hitch(this,function(){this._portalUser?this._isFavorite(r.data.id).then(w.hitch(this,function(W){this._showPopup(r.data,N.parentNode)})):this._showPopup(r.data,N)}),400))}})),this._grid.on(X.leaveRow,
w.hitch(this,function(M){M.relatedTarget&&!1===n.contains(M.relatedTarget,"dijitTooltipDialog")&&!1===n.contains(M.relatedTarget,"dijitTooltipConnector")&&(clearTimeout(this._showPopupTimeout),clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(w.hitch(this,function(){u(".fav-on, .fav-off",this.domNode).style("display","none").style("width","24px");this._closePopup()}),10))}))):this.own(this._grid.on(I.selector(".dgrid-content .dgrid-row",I.tap),w.hitch(this,function(M){M.preventDefault();
var r=this._grid.row(M);this._portalUser?this._isFavorite(r.data.id).then(w.hitch(this,function(N){this._showPopup(r.data,u("img",r.element)[0].parentNode)})):this._showPopup(r.data,u("img",r.element)[0])})),this._grid.on(".dgrid-row:click",w.hitch(this,function(M){M.preventDefault();var r=this._grid.row(M);this._portalUser?this._isFavorite(r.data.id).then(w.hitch(this,function(N){this._showPopup(r.data,u("img",r.element)[0].parentNode)})):this._showPopup(r.data,u("img",r.element)[0])})))},_onGridRefresh:function(M){this.emit("onRefresh",
{currentPage:this._grid._currentPage});this._pagingLinks&&(u(".dgrid-navigation",this._grid.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),u(".dgrid-pagination",this._grid.domNode)[0===this._grid._total?"addClass":"removeClass"]("hide"))},_getGridAttr:function(){return this._grid},_showPopup:function(M,r){"details"===this._view?this._portalUser&&this._isFavorite(M.id).then(w.hitch(this,function(N){u(".fav-on",r.parentNode).style("display",N.id?"":"none");u(".fav-off",
r.parentNode).style("display",N.id?"none":"")})):"gallery"===this._view&&M.id&&M.id!==this._popupId&&(this._portalUser&&this._isFavorite(M.id).then(w.hitch(this,function(N){u(".fav-on",r.parentNode).style("display",N.id?"":"none");u(".fav-off",r.parentNode).style("display",N.id?"none":"")})),this._closePopup(),this._popupId=M.id,this._tooltip=new y({onMouseLeave:w.hitch(this,"_closePopup"),content:new (a([x,G,D],{templateString:e.substitute(this._itemPopupTemplate,{item:M,i18n:R.gallery},null,this)}))}),
J.open({popup:this._tooltip,around:r,orient:["after-centered","before-centered"]}),this._popupButton=new A({label:R.gallery.open,className:"calcite btn small primary",dropDown:this._getOpenInMenu(M)}),u("#openItem").replaceWith(this._popupButton.domNode),0===this._popupButton.dropDown.getChildren().length&&this._popupButton.set("disabled",!0))},_closePopup:function(M){M&&M.relatedTarget&&(!0===n.contains(M.relatedTarget,"dijitBackgroundIframe")||!0===n.contains(M.relatedTarget,"dijitMenu")||!0===
n.contains(M.relatedTarget,"dijitReset"))||!this._tooltip||(J.close(this._tooltip),this._popupConnect&&this._popupConnect.remove(),this._popupButton&&this._popupButton.destroyRecursive(),this._tooltip.destroyRecursive(),this._popupId=this._tooltip=null)},_isFavorite:function(M){return H(this._favorites[M]||this._searchItems('(group:"'+this._portalUser.favGroupId+'" AND id:"'+M+'")').then(w.hitch(this,function(r){this._favorites[M]=r.results[0]||{id:!1};return this._favorites[M]})))},_searchItems:function(M){return this._util.request({url:esriGeowConfig.restBaseUrl+
"search",content:{q:M,f:"json"}})},refresh:function(){this._grid&&(this._grid.set("query",this._query,this._queryOptions),u(".dgrid-row",this._grid.domNode).attr("tabindex","0"),this.own(t(this._grid.domNode.querySelector(".dgrid-content"),"keyup",function(M){var r=M.target;r.classList.contains("dgrid-row")&&M.keyCode===L.ENTER&&("single"===this._grid.selectionMode&&this._grid.clearSelection(),this._grid.select(r))}.bind(this))))},gotoPage:function(M){this._grid.query=this._query;this._grid.queryOptions=
this._queryOptions;this._grid._sort=this._queryOptions.sort;this._grid.gotoPage(M)},_formatItemTitle:function(M){return M.title||M.name||""},_formatType:function(M){return this._content.changeTypename({type:M.type,typeKeywords:M.typeKeywords},!1)||M.type},_formatLargeThumbnail:function(M){return M?"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+M+"'\x3e":"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+this._util.getStaticImagesUrl()+"/desktopapp.png'\x3e"},_getDefaultThumbnail:function(M){var r=
this._util.getStaticImagesUrl();return"web mapping application"==M?r+"/webapp.png":"mobile application"==M?r+"/mobileapp.png":"workforce project"===M?r+"/workforceproject.png":"hub initiative"===M?r+"/hubinitiative.png":"hub page"===M?r+"/hubpage.png":"hub site application"===M?r+"/hubsite.png":"dashboard"===M?r+"/opsdashboard.png":"geoprocessing service"===M&&esriGeowConfig.self&&esriGeowConfig.self.isPortal?r+"/webtool.png":"web scene"===M||"scene service"===M?r+"/scene.png":"ortho mapping project"===
M?r+"/orthomappingproject.png":"ortho mapping template"===M?r+"/orthomappingtemplate.png":r+"/desktopapp.png"},_formatThumbnail:function(M){var r=M.thumbnailUrl||this._getDefaultThumbnail(M.type&&M.type.toLowerCase()),N=this._util.getHomePageGalleryLinkInfo(M),W=-1<dojo.indexOf(M.typeKeywords,"Web AppBuilder for ArcGIS");W=esriGeowConfig.self&&esriGeowConfig.self.isPortal&&W||"Application"===M.type||"Web Mapping Application"===M.type&&!W||"Mobile Application"===M.type||"Document Link"===M.type;var fa=
"Application"===M.type||"Web Mapping Application"===M.type||"Mobile Application"===M.type||"Document Link"===M.type||"CityEngine Web Scene"===M.type||"Dashboard"===M.type;M='\x3ca href\x3d"'+(esri.isTouchEnabled?"#":W?M.url||"item.html?id\x3d"+M.id:N&&N.href&&N.href.replace(/"/g,"'")||"item.html?id\x3d"+M.id)+'" target\x3d"'+(fa?"_blank":"")+'"\x3e\x3cimg class\x3d"grid-item-thumb" alt\x3d"" src\x3d"'+r+'" /\x3e\x3c/a\x3e';r=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();r=!r||r&&esriGeowConfig.userRole.canShareItemToGroup();
N='\x3cdiv class\x3d"gallery-img"\x3e\x3cdiv class\x3d"fav-icon"\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-on" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-on"\x3e\x3c/div\x3e\x3cp id\x3d"addString"\x3e'+R.gallery.addFavorite+'\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-off" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-off"\x3e\x3c/div\x3e\x3cp id\x3d"remString"\x3e'+R.gallery.removeFavorite+"\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e"+M+"\x3c/div\x3e";
return r&&this._portalUser?N:M},_formatItemTypeIcon:function(M){return"\x3cimg class\x3d'grid-item-icon' alt\x3d'' src\x3d'"+this._content._getItemIconUrl(M)+"'\x3e"},_formatPremiumContentIcon:function(M){var r=M.isPremiumContent,N=M.getTypeInfo(),W=esriGeowConfig.self&&esriGeowConfig.self.isPortal?"portal":"";M=-1<b.indexOf(M.typeKeywords,"Requires Credits");return r?'\x3cp class\x3d"grid-item-type" title\x3d"'+(M?R.common["premiumcontentcreditstitle"+W]:R.common["premiumcontenttitle"+W])+"\"\x3e\x3cimg class\x3d'grid-premium-icon' alt\x3d'' src\x3d'"+
N.premiumIconUrl+"'\x3e"+(M?R.common.premiumcontent:R.common.subscriptioncontent)+"\x3c/p\x3e":""},_formatDate:function(M){!1===M instanceof Date&&(M=new Date(M));return M?E.format(M,"long-month-year"):""},_formatOwnerLink:function(M){return'\x3ca href\x3d"user.html?user\x3d'+M+'"\x3e'+M+"\x3c/a\x3e"},_getOpenInMenu:function(M){M=this._util.getItemOpenLinkObjects(M);var r;var N=new F({autoFocus:!0,_destroyOnRemove:!0,showTitle:!1});b.forEach(M,function(W){r=new g({label:W.label,onClick:function(){W.onClick()}});
N.addChild(r)});N.startup();return N},_setViewAttr:function(M){this._view=M=-1===b.indexOf(this._supportedViews,M)?this._view:M;this._grid&&(this._grid.renderRow=this._renderers[M],V(this._grid.domNode,"!table!gallery!details."+M),this._grid.set("showHeader","table"===this._view))},_setStoreAttr:function(M){this._store=M},_setQueryAttr:function(M,r){this._query=M||this._query;this._queryOptions=r||this._queryOptions},_setItemsAttr:function(M){(this._store=this._store||new T(new Q({data:M,identifier:"id",
label:"id"})),this._store.setData)?this._store.setData(M):this._store=new T(new Q({data:M}));this.set("store",this._store);this.set("view",this._view)}})})},"arcgisonline/sharing/dijit/Rating":function(){define("dojo/_base/declare dojox/form/Rating dojo/dom-attr dojo/dom-construct dojo/string ../../pages/utils/icons dojo/i18n!../../nls/arcgisonline".split(" "),function(a,w,e,b,t,p,x){return a([w],{constructor:function(y){a.safeMixin(this,y)},postCreate:function(){this.inherited(arguments);var y=t.substitute(x.common.ratingMsg2,
{stars:this.params.value});e.set(this.domNode,"aria-label",y);e.set(this.domNode,"tabindex",0);[].slice.call(this.domNode.querySelectorAll(".dojoxRatingInput")).forEach(function(J){b.place(p["star-f"]["16"],J,"after");b.place(p.star["16"],J,"after")})},_onMouse:function(){this.get("disabled")||this.inherited(arguments)},onStarClick:function(){this.get("disabled")||this.inherited(arguments)},_setValueAttr:function(y){y=Math.round(y);this.inherited(arguments)}})})},"dojox/form/Rating":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/mouse dojo/on dojo/string dojo/query dijit/form/_FormWidget".split(" "),
function(a,w,e,b,t,p,x,y,J){return a("dojox.form.Rating",J,{templateString:null,numStars:3,value:0,buildRendering:function(G){for(var D='\x3clabel class\x3d"dojoxRatingStar dijitInline ${hidden}"\x3e\x3cspan class\x3d"dojoxRatingLabel"\x3e${value} stars\x3c/span\x3e\x3cinput type\x3d"radio" name\x3d"rating-'+Math.random().toString(36).substring(2)+'" value\x3d"${value}" dojoAttachPoint\x3d"focusNode" class\x3d"dojoxRatingInput"\x3e\x3c/label\x3e',A='\x3cdiv dojoAttachPoint\x3d"domNode" class\x3d"dojoxRating dijitInline"\x3e\x3cdiv data-dojo-attach-point\x3d"list"\x3e'+
x.substitute(D,{value:0,hidden:"dojoxRatingHidden"})+"${stars}\x3c/div\x3e\x3c/div\x3e",F="",g=0;g<this.numStars;g++)F+=x.substitute(D,{value:g+1,hidden:""});this.templateString=x.substitute(A,{stars:F});this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._renderStars(this.value);this.own(p(this.list,p.selector(".dojoxRatingStar","mouseover"),w.hitch(this,"_onMouse")),p(this.list,p.selector(".dojoxRatingStar","click"),w.hitch(this,"_onClick")),p(this.list,p.selector(".dojoxRatingInput",
"change"),w.hitch(this,"onStarChange")),p(this.list,t.leave,w.hitch(this,function(){this._renderStars(this.value)})))},_onMouse:function(G){var D=+e.get(G.target.querySelector("input"),"value");this._renderStars(D,!0);this.onMouseOver(G,D)},_onClick:function(G){if("LABEL"===G.target.tagName){var D=+e.get(G.target.querySelector("input"),"value");G.target.value=D;this.onStarClick(G,D);D==this.value&&(G.preventDefault(),this.onStarChange(G))}},_renderStars:function(G,D){y(".dojoxRatingStar",this.domNode).forEach(function(A,
F){F>G?(b.remove(A,"dojoxRatingStarHover"),b.remove(A,"dojoxRatingStarChecked")):(b.remove(A,"dojoxRatingStar"+(D?"Checked":"Hover")),b.add(A,"dojoxRatingStar"+(D?"Hover":"Checked")))})},onStarChange:function(G){G=+e.get(G.target,"value");this.setAttribute("value",G==this.value?0:G);this._renderStars(this.value);this.onChange(this.value)},onStarClick:function(G,D){},onMouseOver:function(){},setAttribute:function(G,D){this.set(G,D)},_setValueAttr:function(G){this._set("value",G);this._renderStars(G);
var D=y("input[type\x3dradio]",this.domNode)[G];D&&(D.checked=!0);this.onChange(G)}})})},"arcgisonline/pages/utils/keys":function(){define(["require","exports"],function(a,w){Object.defineProperty(w,"__esModule",{value:!0});w.DOWN=w.RIGHT=w.UP=w.LEFT=w.TAB=w.SPACEBAR=w.ENTER=w.ESCAPE=void 0;w.ESCAPE=27;w.ENTER=13;w.SPACEBAR=32;w.TAB=9;w.LEFT=37;w.UP=38;w.RIGHT=39;w.DOWN=40;w["default"]={ESCAPE:w.ESCAPE,ENTER:w.ENTER,TAB:w.TAB,UP:w.UP,DOWN:w.DOWN,LEFT:w.LEFT,RIGHT:w.RIGHT,SPACEBAR:w.SPACEBAR}})},"arcgisonline/sharing/dijit/dialog/JoinGroupDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/utils/dom dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/JoinGroupDlg.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v){var m=w("arcgisonline.sharing.dijit.dialog.JoinGroupDlg",[J,G,D],{declaredClass:"arcgisonline.sharing.dijit.dialog.JoinGroupDlg",basePath:a.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:v,widgetsInTemplate:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n=e.mixin(g.common,g.joinGroupDlg)},postCreate:function(){this.inherited(arguments);this._loadConnections()},show:function(h,f,c){this.groupId=h;this.leavingDisallowed=f;c&&(this.successHandler=
c);this.leavingDisallowed&&F.showNode(this._administrativeGroup);this._dialog.show()},hide:function(h){h&&h.preventDefault();this._dialog.hide()},_loadConnections:function(){this.own(p(this._okBtn,e.hitch(this,"_submitRequest")),p(this._cancelBtn,e.hitch(this,"hide")))},_submitRequest:function(h){h&&h.preventDefault();var f=A.request({url:esriGeowConfig.restBaseUrl+"community/groups/"+this.groupId+"/join"},{usePost:!0}).then(dojo.hitch(this,function(c,l){this.hide();this.successHandler&&this.successHandler(c,
l)}),dojo.hitch(this,function(c){if(!f.canceled){var l=c.message;c.messageCode&&"COM_1082"===c.messageCode?l=this.i18n.levelOneSharedUpdateCapabilities:-1<l.indexOf("You have already applied to join this group.")?l=this.i18n.alreadyRequested+"\x3cbr\x3e"+this.i18n.applicationConsidered:-1<l.indexOf("Unable to apply to join group:")?l=this.i18n.cannotAccept:-1<l.indexOf(" is by invitation only.")&&(l=this.i18n.byInviteOnly);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.joinGroupError,
message:l})}this.hide()}))}});m.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new m);return this._instance}};return m})},"arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg":function(){define("require exports tslib dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/string dojo/on dojo/query ../../../esriGeowConfig ../../../pages/pageUtil ../../../pages/utils/dom ../../../pages/utils/subscription ../../util ./ChoiceDlg ./GeneralDlg ../../geow/Geow ../../../tsutils/declareDecorator dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageSubscriptionDlg.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);D=e.__importDefault(D);A=e.__importDefault(A);F=e.__importDefault(F);g=e.__importDefault(g);v=e.__importDefault(v);m=e.__importDefault(m);h=e.__importDefault(h);f=e.__importDefault(f);c=e.__importDefault(c);l=e.__importDefault(l);return function(){function k(){this.widgetsInTemplate=!0;this.templateString=
l["default"];this.i18n=e.__assign(e.__assign({},c["default"].common),c["default"].manageSubscriptionDlg);this._instance=null;this._converting=!1}var z=k;k.prototype.postCreate=function(){this.inherited(arguments);this.addListeners()};k.prototype.getInstance=function(){null==this._instance&&(this._instance=new z);return this._instance};k.prototype.show=function(u){this.portal=u;this._showManageView()};k.prototype.showManage=function(u){this.portal=u;this.clear();this._showManageView();this._dialog.show()};
k.prototype.showUpgrade=function(u){this.portal=u;this.clear();this._showUpgradeView();this._dialog.show()};k.prototype._showUpgradeView=function(){var u;this._dialog.set("title",this.i18n.upgradeSubscriptionTitle);var n=null===(u=this.portal.subscriptionInfo)||void 0===u?void 0:u.type;"Trial"!==n&&"Trial Press"!==n&&"Evaluation"!==n||this._dialog.set("title",this.i18n.manageSubscriptionTitle);u=this.portal.isPortal;F["default"].isPersonalUse(n,u)||F["default"].isStudentUse(n,u)?(this._inUSDiv.innerHTML=
x["default"].substitute(this.i18n.visitMyEsri,{startLink:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+G["default"].purchaseUrls.renew+'"\x3e',endLink:"\x3c/a\x3e\x3c/span\x3e"}),this._outsideUSDiv.innerHTML=x["default"].substitute(this.i18n.contactLocalOffice,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"})):(this._inUSDiv.innerHTML=x["default"].substitute(this.i18n.upgradeInsideUS,
{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),this._outsideUSDiv.innerHTML=x["default"].substitute(this.i18n.upgradeOutsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}));A["default"].hideNodes([this._manageSubscriptionDiv,this._convertSubscriptionDiv,
this._nextBtn,this._convertBtn,this._cancelBtn]);"active"!==this.portal.subscriptionInfo.state||"Trial"!==this.portal.subscriptionInfo.type&&"Trial Press"!==this.portal.subscriptionInfo.type&&"Evaluation"!==this.portal.subscriptionInfo.type||this._dialog.set("title",this.i18n.manageSubscriptionTitle);A["default"].showNodes([this._upgradeSubscriptionDiv,this._okBtn])};k.prototype._showManageView=function(){var u;this._dialog.set("title",this.i18n.manageSubscriptionTitle);A["default"].hideNodes([this._upgradeSubscriptionDiv,
this._convertSubscriptionDiv,this._okBtn,this._convertBtn]);"Evaluation"===(null===(u=this.portal.subscriptionInfo)||void 0===u?void 0:u.type)?(A["default"].hideNodes([this._convertOptionDiv,this._manageSubscriptionContainer]),A["default"].showNode(this._evalSubscriptionContainer),this._purchaseInUSDiv.innerHTML=x["default"].substitute(this.i18n.upgradeInsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),
this._purchaseOutsideUSDiv.innerHTML=x["default"].substitute(this.i18n.upgradeOutsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),A["default"].showNode(this._okBtn),A["default"].hideNodes([this._nextBtn,this._cancelBtn])):A["default"].showNodes([this._nextBtn,this._cancelBtn]);A["default"].showNode(this._manageSubscriptionDiv)};k.prototype._showConvertView=function(){this._dialog.set("title",
this.i18n.convertToPersonalTitle);this._importantMsgDiv.innerHTML=x["default"].substitute(this.i18n.completeDetailsWithLinkMsg,{helpLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+(""+this.portal.helpBase+this.portal.helpMap.m["120000592"])+'"\x3e',helpLinkEnd:"\x3c/a\x3e"});A["default"].hideNodes([this._upgradeSubscriptionDiv,this._manageSubscriptionDiv,this._okBtn,this._nextBtn]);A["default"].showNodes([this._convertSubscriptionDiv,this._convertBtn,this._cancelBtn])};
k.prototype.addListeners=function(){var u=this.onCancel.bind(this);this.own(y["default"](this._okBtn,"click",u),y["default"](this._nextBtn,"click",this.onNext.bind(this)),y["default"](this._convertBtn,"click",this.onConvert.bind(this)),y["default"](this._cancelBtn,"click",u));J["default"](".jevent").connect("onclick",function(n){n.preventDefault()})};k.prototype.clear=function(){var u;this._converting=!1;this._choiceDlg=D["default"].createSpecifiedDialog(v["default"]);null===(u=this._dialog)||void 0===
u?void 0:u.set("title","");if(u=this._dialog.domNode.querySelector(".dijitDialogCloseIcon"))u.tabIndex=0;A["default"].hideNodes([this._upgradeSubscriptionDiv,this._manageSubscriptionDiv,this._convertSubscriptionDiv]);A["default"].showNodes([this._convertOptionDiv,this._manageSubscriptionContainer]);A["default"].hideNode(this._evalSubscriptionContainer);this._upgradeRadioBtn.checked=!0};k.prototype.hide=function(){this._dialog.hide()};k.prototype.onNext=function(u){this._convertRadioBtn.checked?this._showConvertView():
this._showUpgradeView()};k.prototype.onConvert=function(u){this._converting||(u={title:this.i18n.convertToPersonalTitle,message:this.i18n.noReturnMsg,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:this.doConvert.bind(this)},this._choiceDlg.show(u))};k.prototype.doConvert=function(){var u=this,n;if(!this._converting&&(null===(n=G["default"].self)||void 0===n?0:n.id)){this._converting=!0;this._convertBtn.disabled=!0;var B=(""+G["default"].baseUrl.replace(location.host,
G["default"].self.portalHostname)+G["default"].signin).replace("http:","https:");g["default"].request({url:G["default"].restBaseUrl+"portals/self/convert",content:{target:"personal",timeout:12E4}},{usePost:!0}).then(function(H){h["default"].signout(B)},function(H){u._converting=!1;u._convertBtn.disabled=!1;var Q=D["default"].createSpecifiedDialog(m["default"]);Q.onOkClick=function(){Q.hide();u._dialog.hide()};Q.show({title:u.i18n.errorTitle,message:u.i18n.unableToConvert})})}};k.prototype.onCancel=
function(u){this.hide()};k.prototype.onHide=function(){};return k=z=e.__decorate([f["default"](b["default"],t["default"],p["default"])],k)}()})},"arcgisonline/sharing/dijit/dialog/ManageTilesDlg":function(){define("require esri/declare esri/Evented esri/config esri/lang esri/request dojo/_base/lang dojo/on dojo/query dojo/sniff dojo/topic dojo/json dijit/a11yclick dojo/string dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dojo/store/Memory dojo/store/Observable dgrid/OnDemandGrid dgrid/selector dgrid/Selection dgrid/extensions/DijitRegistry esri/geometry/Extent esri/geometry/webMercatorUtils ../../../map/core/projectExtent ../../../map/utils/clipOnHorizon ../DefineExtent ./GeneralDlg ./ChoiceDlg ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/utils/number ../../../pages/serviceUtil ../../util calcite-web/js/calcite-web dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageTilesDlg.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E,L,da,R,M,r,N,W,fa,ba,Z){var ja=w(null,{showFooter:!0,buildRendering:function(){this.inherited(arguments);var aa=this.summaryAreaNode=f.create("div",{className:"summary-row",role:"row",style:{overflow:"hidden"}},this.footerNode);this.on("scroll",function(){aa.scrollLeft=this.getScrollPosition().x}.bind(this));this.summary&&this._setSummary(this.summary)},_updateColumns:function(){this.inherited(arguments);this.summary&&
this._setSummary(this.summary)},_renderSummaryCell:function(aa,ka,oa){ka.appendChild(document.createTextNode(aa[oa.field]||""))},_setSummary:function(aa){var ka=this.summaryTableNode;this.summary=aa;ka&&f.destroy(ka);ka=this.summaryTableNode=this.createRowCells("td",this._renderSummaryCell.bind(this,aa));this.summaryAreaNode.appendChild(ka);this._started&&this.resize()}}),ma=w("arcgisonline.sharing.dijit.dialog.ManageTilesDlg",[l,k,z],{declaredClass:"arcgisonline.sharing.dijit.dialog.ManageTilesDlg",
templateString:Z,widgetsInTemplate:!0,basePath:a.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriManageTiles",PROCESSING:"PROCESSING",SUBMITTED:"SUBMITTED",DEFAULT_TILE_WIDTH:256,DEFAULT_TILE_HEIGHT:256,TIME_TO_NEXT_UPDATE:1E4,TABS:{LEVELS:"levels",EXTENT:"extent"},_noSourceData:!1,_isSourceTilePackage:!1,_isVisible:!1,_isProcessing:!1,_wasProcessing:!1,_allTilesComplete:!1,_createClicked:!1,_tab:"levels",postMixInProperties:function(){this.inherited(arguments);this.i18n=x.mixin({},ba.common);
this.i18n=x.mixin(this.i18n,ba.manageTilesDlg)},postCreate:function(){this.inherited(arguments);b.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(b.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);var aa=this.hide.bind(this);this.own(F(this._buildButton,this._createClick.bind(this)),F(this._cancelButton,this._cancelClick.bind(this)),F(this._closeButton,aa),F(this.dialog.closeButtonNode,aa),F(this._levelsTab,this._levelsTabClick.bind(this)),F(this._extentTab,this._extentTabClick.bind(this)))},
destroy:function(){this.inherited(arguments);this._defineExtent&&this._defineExtent.destroy()},setServerTokens:function(aa,ka,oa){this._hostedServer=aa;this._serverToken=ka;this._adminServerToken=oa},displayTabs:function(aa){this._mustDisplayTabs=aa},show:function(aa,ka,oa,ra){ka=this._handleServiceInfo.bind(this,ka);fa.tabs();this._setFlags();this.item=aa;this._isSourceTilePackage=!(!oa||!oa.tilePackage);this._isSourceServiceDefinition=!(!oa||!oa.serviceDefinition);this._isSourceTilePackage?(m.set(this._buildButton,
"innerHTML",this.i18n.publishButton),m.set(this.dialog,"title",this.i18n.publishButton),this._canShowTabs=!1):this._isPortal?this._canShowTabs=!1:(m.set(this.dialog,"title",this.i18n.buildTitle),this._canShowTabs=!(!esriGeowConfig.tilesOnDemandEnabled||!this._mustDisplayTabs));this._showTabs(this._canShowTabs);ra?ka(ra):(aa=this._isPortal?p({url:this.item.url,content:{f:"json",token:this._serverToken}}):W.request({url:this.item.url}),aa.then(ka,ka))},showNoSource:function(aa,ka){this._noSourceData=
!0;this.show(aa,ka,!1)},hide:function(aa){this._noSourceData=!1;this.dialog.hide();(this._createClicked||this._wasProcessing)&&D.publish("manage-tiles/update",{tileInfoChanged:!0,cacheJobId:aa});this._isVisible=this._wasProcessing=this._createClicked=!1},_showTabs:function(aa){M.showHide(this._tabNav,aa);J(".tab-contents").forEach(function(ka){h[aa?"remove":"add"](ka,"no-border")})},_setFlags:function(){this._isPortal=W.isPortal();this._roleCanPublishTiles=(this._roleCanCreateItem=esriGeowConfig.userRole.canCreateItem())&&
esriGeowConfig.userRole.canPublishTiles();this._createClicked=this._allTilesComplete=this._wasProcessing=this._isProcessing=this._isVisible=this._isSourceTilePackage=this._noSourceData=!1;this._refreshTilesEnabled=!this._isPortal&&esriGeowConfig.tilesOnDemandEnabled},_handleServiceInfo:function(aa,ka){!ka||ka.code||ka.message||(this._serviceFullExtent=ka.fullExtent,this._serviceTileInfo=ka.tileInfo,this._serviceTileInfo.width=this._serviceTileInfo.width||this.DEFAULT_TILE_WIDTH,this._serviceTileInfo.height=
this._serviceTileInfo.height||this.DEFAULT_TILE_HEIGHT,this.serviceMinScale=ka.minScale?ka.minScale:this._serviceTileInfo.lods[0].scale,this.serviceMaxScale=ka.maxScale?ka.maxScale:this._serviceTileInfo.lods[this._serviceTileInfo.lods.length-1].scale,this.serviceMinLOD=t.isDefined(ka.minLOD)?ka.minLOD:void 0,this.serviceMaxLOD=t.isDefined(ka.maxLOD)?ka.maxLOD:void 0,this.dialog.show(),this._isVisible=!0,this._updateStatus(aa))},_handleReportCacheStatus:function(aa){aa&&aa.results&&!aa.message?(aa=
aa.results[0],aa.serviceName=this._lastTileStatus.serviceName,aa.type=this._lastTileStatus.type,aa.lodInfos=aa.value.lodInfos,aa.cacheExecutionStatus=aa.value.cacheExecutionStatus,aa.minScale=this._lastTileStatus.minScale,aa.maxScale=this._lastTileStatus.maxScale,this._updateStatus(aa)):this._updateStatus(aa)},_getStatus:function(){var aa=this;if(this._isVisible)if(aa._isPortal){var ka=aa._handleReportCacheStatus.bind(aa),oa=aa.item.url.indexOf("/services/")+10,ra=aa.item.url.indexOf("/"+aa._lastTileStatus.serviceName+
"/")+1;oa=aa.item.url.substring(oa,ra)+aa._lastTileStatus.serviceName+":"+aa._lastTileStatus.type;var ya=N.adjustHostedServerForProtocol(aa._hostedServer.url)+"/rest/services/System/ReportingTools/GPServer/ReportCacheStatus/execute",Ca={service_url:oa,report_mode:"esriCacheStatus",f:"json",token:aa._serverToken,job_id:aa._jobId,ts:(new Date).getTime()};aa._jobId?p({url:ya,content:Ca}).then(ka,ka):(oa={service_url:oa,report_mode:"esriJobSummary",f:"json",token:aa._serverToken,ts:(new Date).getTime()},
p({url:ya,content:oa}).then(function(Ea){Ea&&Ea.results&&Ea.results[0]&&Ea.results[0].value.esriJobStatus&&Ea.results[0].value.esriJobStatus[0]&&(aa._jobId=Ea.results[0].value.esriJobStatus[0].cancelJobID,Ca.job_id=aa._jobId);p({url:ya,content:Ca}).then(ka,ka)}))}else oa=aa.item.url.replace("/rest/","/rest/admin/"),ra=aa._updateStatus.bind(aa),W.request({url:oa,content:{ts:(new Date).getTime()}}).then(ra,ra)},_updateStatus:function(aa){if(this._isVisible&&(!aa||"Error"!==aa.name||"Unknown runtime error"!==
aa.message)){this._lastTileStatus=aa;this._lastTileStatus.minScale=this._lastTileStatus.minScale||this.serviceMinScale;this._lastTileStatus.maxScale=this._lastTileStatus.maxScale||this.serviceMaxScale;this._lastTileStatus.minLOD=this._lastTileStatus.minLOD||this.serviceMinLOD||void 0;this._lastTileStatus.maxLOD=this._lastTileStatus.maxLOD||this.serviceMaxLOD||void 0;if(this._isProcessing=aa.cacheExecutionStatus===this.PROCESSING||aa.cacheExecutionStatus===this.SUBMITTED)this._wasProcessing=!0,setTimeout(this._getStatus.bind(this),
this.TIME_TO_NEXT_UPDATE);this._refreshUI()}},_refreshUI:function(){this._updateData();this._grid?this._updateGrid():this._createGrid();this._updateTotals();this._updateExtent();this._updateDescription();this._updateButtons();this._updateMessage();this._updateTabs()},_updateExtent:function(){if(this._defineExtent&&this._defineExtent._started&&!this._updatedExtent){var aa=[[],[]],ka;4326!==this._serviceFullExtent.spatialReference.wkid&&(ka=V.webMercatorToGeographic(new T(this._serviceFullExtent)));
aa[1][1]=parseFloat(ka.ymax);aa[0][0]=parseFloat(ka.xmin);aa[1][0]=parseFloat(ka.xmax);aa[0][1]=parseFloat(ka.ymin);this._defineExtent.set("extent",aa)}},_updateTabs:function(){this._isProcessing?(this._canShowTabs&&(h.remove(this._extentTab,"is-active"),h.remove(this._extentSection,"is-active"),h.add(this._levelsTab,"is-active"),h.add(this._levelsSection,"is-active")),this._showTabs(!1)):this._showTabs(this._canShowTabs)},_updateButtons:function(){this._roleCanPublishTiles?this._isProcessing||this._allTilesComplete&&
!this._refreshTilesEnabled?(this._hideButtons(),this._isProcessing&&this._isPortal&&this._jobId?this._showCancel():this._hideCancel()):(this._showButtons(),this._hideCancel()):this._hideButtons()},_updateMessage:function(){this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||(this._noSourceData?m.set(this._messageDiv,"innerHTML",this.i18n._noSourceData):m.set(this._messageDiv,"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange))},
_updateData:function(){var aa=this.i18n.totals,ka=this._lastTileStatus;this._gridStore=new B(new n({data:this._getTileStatusData(),identifier:"id"}));this._gridStore.getTotals||(this._gridStore.getTotals=function(){var ra={},ya=0,Ca=0,Ea=0;this.data.forEach(function(xa){ya+=parseInt(xa.created,10);Ca+=parseInt(xa.expected,10);Ea+=xa.storageSize?parseInt(xa.storageSize,10):0});var Da=(ya/Ca*100).toFixed(2)||0;Da=100<Da?100:Da;ra.selected="";ra.scaleLevel=aa;ra.created=r.format(ya);ra.expected=r.format(Ca);
ra.pctComplete=String(Da);ra.storageSize=da.sizeInMB(ka&&ka.size||Ea);return ra});if(this._noSourceData)M.hideNode(this._scalesSelectedSpan);else{var oa=g.substitute(this.i18n.scalesSelected,{scales:0});m.set(this._scalesSelectedSpan,"innerHTML",oa)}},_getTileStatusData:function(){var aa=this,ka=[],oa=0,ra=0,ya,Ca,Ea,Da;aa._serviceTileInfo.lods.forEach(function(xa){Math.floor(xa.scale)<=aa._lastTileStatus.minScale&&Math.ceil(xa.scale)>=aa._lastTileStatus.maxScale&&(ya=da.calculateExpectedTiles(aa._serviceTileInfo,
aa._serviceFullExtent,xa),ka.push({id:xa.level,selected:!1,scaleLevel:"1:"+r.format(Math.round(xa.scale)),scale:xa.scale,created:0,expected:ya,pctComplete:0,storageSize:0}))});aa._lastTileStatus&&aa._lastTileStatus.lodInfos&&0<aa._lastTileStatus.lodInfos.length&&aa._lastTileStatus.lodInfos.forEach(function(xa){for(Da=0;Da<ka.length;Da++)if(ka[Da]&&ka[Da].id===xa.levelID){Ca=Math.round(xa.tileCount/xa.expectedTileCount*100);100<Ca&&(Ca=100);aa._isPortal&&xa.pct&&(Ca=xa.pct);Ea=ka[Da];Ea.created=xa.tileCount;
Ea.expected=xa.expectedTileCount;Ea.pctComplete=Ca;Ea.storageSize=xa.tilesSize?xa.tilesSize:0;break}});ka.forEach(function(xa){oa+=xa.created;ra+=xa.expected});aa._allTilesComplete=oa===ra;aa._disableButtons();return ka},_updateTotals:function(){var aa=this,ka=aa._grid.on("dgrid-refresh-complete",function(){aa._scrollNode&&aa._currentScrollPos&&(aa._scrollNode.scrollTop=aa._currentScrollPos);ka.remove()});aa._scrollPos&&(aa._currentScrollPos=aa._scrollPos);aa._grid.set("summary",aa._gridStore.getTotals());
aa._grid.resize();aa._grid.refresh()},_updateDescription:function(){m.set(this._dialogDescription,"innerHTML","\x3cstrong\x3e"+(this._isProcessing?this._isSourceTilePackage?this.i18n.jobStatusPublishing:this.i18n.jobStatus:this.i18n.noJobStatus)+"\x3c/strong\x3e\x3cbr/\x3e")},_hideButtons:function(){M.hideNodes(J("div.messageContainer"));M.hideNodes(J("div.selected-scales-container"));M.hideNode(this._buildButton)},_showButtons:function(){M.showNode(this._buildButton);M.showNodes(J("div.selected-scales-container"));
M.showNodes(J("div.messageContainer"))},_hideCancel:function(){M.hideNode(this._cancelButton)},_showCancel:function(){M.showNode(this._cancelButton)},_updateGrid:function(){this._grid.set("columns",this._getGridLayout());this._grid.set("store",this._gridStore)},_createGrid:function(){this._grid=new (w([H,P,O,ja]))({id:"scaleGrid",columns:this._getGridLayout(),showLoadingMessage:!1,showFooter:!0,noDataMessage:"",selectionMode:"none",gridScope:this,allowSelectAll:!0,store:this._gridStore,sort:[{attribute:"id",
descending:!1}]},this._gridContainer);this._grid.startup();this.own(this._grid.on(".dgrid-header-row .field-selected:click",function(aa){this._toggleAll("INPUT"===aa.target.tagName?aa.target:aa.target.childNodes[0])}.bind(this)));this.own(this._grid.on(".dgrid-row .field-selected:click",function(aa){aa="INPUT"===aa.target.tagName?aa.target:aa.target.childNodes[0];var ka=aa.parentNode.parentNode.parentNode.parentNode.id;ka=ka.substring(ka.indexOf("scaleGrid-row-")+14);this._toggleScale(aa,ka)}.bind(this)));
this.own(this._grid.on("scroll",function(aa){this._scrollPos=(this._scrollNode=aa&&aa.scrollTarget||null)&&this._scrollNode.scrollTop||0}.bind(this)))},_getGridLayout:function(){var aa=[];this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||this._noSourceData||!this._roleCanPublishTiles||aa.push(Q({field:"selected",sortable:!1,selectorType:"checkbox"}));aa.push({field:"scaleLevel",label:this.i18n.grid.scaleLevel,sortable:!1,formatter:this._contentFormatter});aa.push({field:"created",
label:this._isSourceTilePackage?this.i18n.grid.tilesPublished:this.i18n.grid.tilesCreated,sortable:!1,formatter:this._tilesFormatter});aa.push({field:"expected",label:this.i18n.grid.totalTiles,sortable:!1,formatter:this._tilesFormatter});aa.push({field:"pctComplete",label:this.i18n.grid.percentComplete,sortable:!1,formatter:this._contentFormatter});aa.push({field:"storageSize",label:this.i18n.grid.storageSize,sortable:!1,formatter:this._sizeFormatter});return aa},_levelsTabClick:function(){this._tab=
this.TABS.LEVELS;this._updateMessage();this._checkToggled()},_extentTabClick:function(){var aa=[[],[]],ka;this._tab=this.TABS.EXTENT;this._defineExtent||(this._defineExtent=new U({id:"defineExtent"},this._extentContainer),this._defineExtent.startup(),4326!==this._serviceFullExtent.spatialReference.wkid&&(ka=V.webMercatorToGeographic(new T(this._serviceFullExtent))),aa[1][1]=parseFloat(ka.ymax),aa[0][0]=parseFloat(ka.xmin),aa[1][0]=parseFloat(ka.xmax),aa[0][1]=parseFloat(ka.ymin),this._defineExtent.set("extent",
aa),this.own(D.subscribe("define-extent/change",this._onExtentChange.bind(this))));m.set(this._messageDiv,"innerHTML",this.i18n.defineExtent);this._checkToggled()},_onExtentChange:function(aa){this._serviceFullExtent.spatialReference.wkid===aa.spatialReference.wkid?this._updatedExtent=aa:X(aa,this._serviceFullExtent.spatialReference,function(ka){ka&&ka.length&&(ka=ka.shift());this._updatedExtent=I(ka)}.bind(this),null,this._defineExtent.map);this._checkToggled()},_calculateIntersection:function(aa,
ka){var oa=new T(aa),ra=new T(ka);return(oa=oa.intersects(ra))?oa.toJson():null},_cancelClick:function(){var aa=this;M.disableNode(aa._cancelButton,!0);var ka=function(oa){t.isDefined(oa.error)&&(da.createSpecifiedDialog(E).show({title:aa.i18n.errorTitle,message:aa.i18n.cantCancelJob}),aa._cancelButton.set("disabled",!1))};p({url:aa._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/jobs/"+aa._jobId+"/cancel",content:{f:"json",token:aa._adminServerToken}},
{usePost:!0}).then(ka,ka)},_checkCredits:function(aa){var ka=new c,oa=esriGeowConfig.restBaseUrl+"portals/self/cost";aa={generatedTileCount:aa};this._isPortal||this._isSourceTilePackage?ka.resolve():W.request({url:oa,content:aa}).then(function(ra){ka.resolve(ra)},function(){ka.resolve()});return ka},_createClick:function(){var aa=this._getAvgTileSize(this._serviceTileInfo),ka=0,oa=0,ra=0,ya=[],Ca=[],Ea,Da,xa,Pa,Oa=0,Ra=0,Sa;this._grid.store.query().forEach(function(Ga){Da=parseInt(Ga.created,10);
xa=parseInt(Ga.expected,10);Pa=parseInt(Ga.storageSize,10);!0===Ga.selected&&(Ea=parseInt(Ga.expected,10)-parseInt(Ga.created,10),0<Ea&&(this._isPortal?ya.push(""+Ga.scale):ya.push(Ga.id)),esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Oa=(Sa=this._calculateIntersection(this._updatedExtent,this._serviceFullExtent))?Oa+da.calculateExpectedTiles(this._serviceTileInfo,Sa,this._serviceTileInfo.lods[Ga.id]):Oa+0:Oa+=Da<=xa?Da:xa,Ra+=xa);oa+=Da;ra+=Pa}.bind(this));Ca=this._grid.store.query().filter(function(Ga){return!0===
Ga.selected}.bind(this));var Ya=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?A.stringify(this._updatedExtent):this._serviceFullExtent.xmin+","+this._serviceFullExtent.ymin+","+this._serviceFullExtent.xmax+","+this._serviceFullExtent.ymax;if(0<ya.length){ka=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Oa:Ra-Oa;var $a=this._formatSizeWithUnits((0<ra&&0<oa?ra/oa:aa)*ka),Za=this._isPortal?ya.join(";"):ya.join(",");this._checkCredits(ka).then(function(Ga){var Ta=
"\x3cp\x3e"+g.substitute(this._isSourceTilePackage?this.i18n.aboutToPublish:this.i18n.aboutToCreate,{tiles:ka,storage:$a})+"\x3c/p\x3e",Xa=!1;!this._isPortal&&!this._isSourceTilePackage&&t.isDefined(Ga.transactionCreditCost)&&t.isDefined(Ga.availableCredits)&&(Ga.transactionCreditCost>Ga.availableCredits?Xa=!0:Ta+="\x3cp\x3e"+g.substitute(this.i18n.aboutToCreateCost,{credits:r.format(Ga.transactionCreditCost),creditsLeft:r.format(Ga.availableCredits)})+"\x3c/p\x3e");Ta+="\x3cp\x3e"+(this._isSourceTilePackage?
this.i18n.reallyPublishTiles:this.i18n.reallyCreateTiles)+"\x3c/p\x3e";!this._isPortal&&Xa?da.createSpecifiedDialog(E).show({title:this.i18n.notice,message:this.i18n.notEnoughCredits}):(Ga={title:this._isSourceTilePackage?this.i18n.publishTiles:this.i18n.createTiles,message:Ta,choiceOneTitle:this._isSourceTilePackage?this.i18n.yesPublishTiles:this.i18n.yesCreateTiles,choiceTwoTitle:this._isSourceTilePackage?this.i18n.noPublishTiles:this.i18n.noCreateTiles},Ga.choiceOneHandler=function(){this._createClicked=
!0;var Ua=Ca.length&&Ca[0]||R.find(this._serviceTileInfo.lods,function(ia){return this.serviceMinScale===ia.scale}),Qa=Ca.length&&Ca[Ca.length-1]||R.find(this._serviceTileInfo.lods,function(ia){return this.serviceMaxScale===ia.scale}),Na=t.isDefined(this.serviceMinLOD)||t.isDefined(this.serviceMaxLOD),Va=Na&&Ua&&Ua.id<this.serviceMinLOD;Na=Na&&Qa&&Qa.id>this.serviceMaxLOD;var d=this._isSourceServiceDefinition&&(Va||Na);if(this._isPortal){M.disableNode(this._cancelButton,!1);var q=this.item.url.indexOf("/services/")+
10,C=this.item.url.indexOf(this._lastTileStatus.serviceName);q=this.item.url.substring(q,C);var S=this._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/submitJob",K={f:"json",token:this._adminServerToken,service_url:q+this._lastTileStatus.serviceName+":"+this._lastTileStatus.type,constraining_extent:Ya,levels:Za,update_mode:"RECREATE_ALL_TILES",thread_count:-1},Y=function(ia){ia.code&&ia.message?da.createSpecifiedDialog(E).show({title:this.i18n.errorTitle,
message:ia.message}):(this._jobId=ia.jobId,this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(ia.jobId),this.hide(this._jobId)))}.bind(this);d?(d={},Va&&(d.minLOD=Ua.id),Na&&(d.maxLOD=Qa.id),W.request({url:this.item.url+"/edit",content:{serviceDefinition:JSON.stringify(d)}},{usePost:!0}).then(function(ia){p({url:S,content:K},{usePost:!0}).then(Y,Y)},function(ia){})):p({url:S,content:K},{usePost:!0}).then(Y,Y)}else{var ca=this.item.url.replace("/rest/","/rest/admin/")+
"/updateTiles";9>=G("ie")&&(q=ca.indexOf("admin/services/"),C=ca.indexOf("/MapServer"),ca=ca.substring(0,q+15)+encodeURIComponent(ca.substring(q+15,C))+ca.substring(C));var ha={levels:Za,extent:Ya},ea=function(ia){if(ia.code&&ia.message){var la=ia.message;ia.message&&-1<ia.message.toLowerCase().indexOf("credit")?la=this.i18n.notEnoughCredits:ia.message&&-1<ia.message.toLowerCase().indexOf("invalid extent")&&(la=this.i18n.invalidExtent);da.createSpecifiedDialog(E).show({title:this.i18n.errorTitle,
message:la})}else this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),this.hide(ia.jobId))}.bind(this);d?(d={},Va&&(d.minLOD=Ua.id),Na&&(d.maxLOD=Qa.id),W.request({url:ca.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(d)}},{usePost:!0}).then(function(ia){W.request({url:ca,content:ha},{usePost:!0}).then(ea,ea)},function(ia){})):W.request({url:ca,content:ha},{usePost:!0}).then(ea,ea)}}.bind(this),Ga.choiceTwoHandler=function(){}.bind(this),
this._createChoiceDlg().show(Ga))}.bind(this))}},_createChoiceDlg:function(){if(v.byId("choice-dialog"))var aa=L.prototype.statics.getInstance();else aa=new L,y.once(aa._dialog,"hide",function(){aa._dialog.destroyRecursive();aa.destroyRecursive()});return aa},_contentFormatter:function(aa){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+aa+"\x3c/span\x3e"},_tilesFormatter:function(aa){var ka="esriContentTypeName";aa&&1E10<=aa&&(ka="esriContentTypeNameSmall");return'\x3cspan class\x3d"'+ka+'"\x3e'+
r.format(aa)+"\x3c/span\x3e"},_sizeFormatter:function(aa){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+da.sizeInMB(aa)+"\x3c/span\x3e"},_getAvgTileSize:function(aa){return 1E3*(aa.rows?aa.rows/10:25.6)},_formatSizeWithUnits:function(aa){var ka=aa,oa=" "+this.i18n.megabytes;1048567E3<aa?(ka=aa/1048567E3,oa=" "+this.i18n.gigabytes):0<aa&&(ka=aa/1048567);ka=Math.round(100*ka)/100;return r.format(ka)+oa},_enableButtons:function(aa,ka,oa){var ra=this._tab===this.TABS.LEVELS?this.i18n.tilesToCreate:
this.i18n.tilesToCreateInExtent,ya=this.i18n.tilesToPublish,Ca=this.i18n.noTilesToCreate,Ea=this.i18n.noTilesToPublish,Da="";aa!==ka?(aa=ka-aa,oa=this._formatSizeWithUnits(oa*aa),Da=g.substitute(this._isSourceTilePackage?ya:ra,{tiles:aa,storage:oa}),M.disableNode(this._buildButton,!1)):(Da=g.substitute(this._isSourceTilePackage?Ea:Ca,{tiles:0}),M.disableNode(this._buildButton,!0));m.set(this._messageDiv,"innerHTML",Da)},_disableButtons:function(){m.set(this._messageDiv,"innerHTML",this._isSourceTilePackage?
this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange);M.disableNode(this._buildButton,!0)},_setScalesSelected:function(aa){aa=g.substitute(this.i18n.scalesSelected,{scales:aa});this._scalesSelectedSpan&&m.set(this._scalesSelectedSpan,"innerHTML",aa)},_toggleAll:function(aa){if(aa){var ka=m.get(aa,"checked");this._grid&&this._grid.store&&(this._grid.store.query().forEach(function(oa){oa.selected=ka}),this._checkToggled())}},_toggleScale:function(aa,ka){if(this._grid.store){var oa=
this._grid.store.query({id:ka}).shift();oa&&(oa.selected=m.get(aa,"checked"));this._checkToggled()}},_checkToggled:function(){var aa=this,ka=0,oa=0,ra=0,ya=0,Ca=0,Ea;if(aa._grid.store)if(aa._grid.store.query().forEach(function(xa){var Pa=parseInt(xa.created,10),Oa=parseInt(xa.expected,10),Ra=parseInt(xa.storageSize,10);xa.selected&&(ka++,esriGeowConfig.tilesOnDemandEnabled&&!aa._isPortal&&aa._updatedExtent?oa=(Ea=aa._calculateIntersection(aa._updatedExtent,aa._serviceFullExtent))?oa+da.calculateExpectedTiles(aa._serviceTileInfo,
Ea,aa._serviceTileInfo.lods[xa.id]):oa+0:oa+=Pa<=Oa?Pa:Oa,ra+=Oa);ya+=Pa;Ca+=Ra}),ka){var Da=0<Ca?Ca/ya:aa._getAvgTileSize(aa._serviceTileInfo);esriGeowConfig.tilesOnDemandEnabled&&!aa._isPortal&&aa._updatedExtent?aa._enableButtons(ra-oa,ra,Da):aa._enableButtons(oa,ra,Da)}else aa._disableButtons();else aa._disableButtons();aa._setScalesSelected(ka)}});ma.prototype.statics={getInstance:function(){this._instance||(this._instance=new ma);return this._instance}};return ma})},"calcite-web/js/calcite-web":function(){(function(a,
w){"object"===typeof exports&&"undefined"!==typeof module?module.exports=w():"function"===typeof define&&define.amd?define(w):a.calcite=w()})(this,function(){function a(r,N){var W;for(W=N;W;W=W.parentNode){var fa=W&&W.getAttribute&&W.getAttribute("class")||"";fa=(new RegExp("(\\s|^)"+r+"(\\s|$)")).test(fa);if(1===W.nodeType&&fa)break}return W}function w(r){return Array.isArray(r)?r:Array.prototype.slice.call(r)}function e(r,N){var W=(N||document).querySelectorAll(r);return w(W)}function b(r,N){return(new RegExp("(\\s|^)"+
N+"(\\s|$)")).test(r.getAttribute("class"))}function t(r,N){N.split(" ").forEach(function(W){if(!b(r,W)){var fa=r.getAttribute("class")||"";r.setAttribute("class",fa+" "+W)}})}function p(r,N){N.split(" ").forEach(function(W){var fa=(r.getAttribute("class")||"").replace(new RegExp("(\\s|^)"+W+"(\\s|$)","g"),"$2");b(r,W)&&r.setAttribute("class",fa)})}function x(r){r=w(r);r.forEach(function(N){p(N,"is-active")})}function y(r,N){x(r);t(N,"is-active")}function J(r,N,W){if(r.addEventListener)return r.addEventListener(N,
W,!1);if(r.attachEvent)return r.attachEvent("on"+N,W)}function G(r,N,W){if(r.removeEventListener)return r.removeEventListener(N,W,!1);if(r.detachEvent)return r.detachEvent("on"+N,W)}function D(r){if(r.preventDefault)return r.preventDefault();r.returnValue&&(r.returnValue=!1)}function A(r){r=r||window.event;if(r.stopPropagation)return r.stopPropagation();r.cancelBubble&&(r.cancelBubble=!0)}function F(){}function g(r){for(var N="",W=0;W<r;W++)N+=(65536*(1+Math.random())|0).toString(16).substring(1);
return N}function v(r){if(!r)throw new TypeError("Invalid argument `value` has no value.");this.value=v.EMPTY;r&&r instanceof v?this.value=r.toString():r&&"[object String]"===Object.prototype.toString.call(r)&&v.isGuid(r)&&(this.value=r);this.equals=function(N){return v.isGuid(N)&&this.value===N};this.isEmpty=function(){return this.value===v.EMPTY};this.toString=function(){return this.value};this.toJSON=function(){return this.value}}function m(r){A(r);r=a("accordion-section",r.target||r.srcElement);
L.emit("accordion:toggle",{node:r})}function h(r){var N=r.node;b(N,"is-active")?p(N,"is-active"):t(N,"is-active");(r=r.node.querySelector(".accordion-title"))&&("true"===r.getAttribute("aria-expanded")?r.setAttribute("aria-expanded","false"):r.setAttribute("aria-expanded","true"))}function f(r){13!==r.keyCode&&32!==r.keyCode||!b(r.target||r.srcElement,"accordion-title")||(D(r),A(r),m(r))}function c(r){var N=e(".js-accordion");r?l(r.node):N.forEach(function(W){l(W)})}function l(r){r.setAttribute("aria-live",
"polite");r.setAttribute("role","tablist");w(r.children).forEach(function(N){var W=N.querySelector(".accordion-title"),fa=N.querySelector(".accordion-content"),ba=fa.id||v.raw();fa.id=ba;W.setAttribute("role","tab");W.setAttribute("tabindex","0");W.setAttribute("aria-controls",ba);W.setAttribute("aria-expanded",b(N,"is-active")?"true":"false");var Z=!1;E.accordions.forEach(function(ja){ja.target===W&&"click"===ja.event&&ja.fn===m&&(Z=!0)});Z||(E.accordions.push({target:W,event:"click",fn:m}),E.accordions.push({target:N,
event:"keydown",fn:f}),J(W,"click",m),J(N,"keydown",f))})}function k(){R||(L.on("accordion:bind",c),L.on("accordion:toggle",h),R=!0);L.emit("accordion:bind")}function z(r){G(document.body,"click",z);e(".js-dropdown").forEach(function(N){p(N,"is-active")});e(".js-dropdown-toggle").forEach(function(N){N.setAttribute("aria-expanded","false")});G(document,"keydown",B);G(document.body,"focusin",u)}function u(r){r.target&&!a("js-dropdown",r.target)&&L.emit("dropdown:close")}function n(r){if(r){var N=b(r.node,
"is-active");L.emit("dropdown:close");N||(t(r.node,"is-active"),r.target&&r.target.setAttribute("aria-expanded","true"),J(document,"keydown",B));b(r.node,"is-active")&&(J(document.body,"click",z),J(document.body,"focusin",u))}}function B(r){40===r.keyCode|38===r.keyCode&&r.preventDefault()}function H(r){e(".js-dropdown-toggle").forEach(function(N){var W=!1;E.dropdowns.forEach(function(fa){fa.target===N&&"click"===fa.event&&fa.fn===V&&(W=!0)});W||(E.dropdowns.push({target:N,event:"click",fn:V}),J(N,
"click",V))})}function Q(){var r=document.querySelector(".js-dropdown.is-active");return r?r:!1}function O(r){var N=r.links.indexOf(document.activeElement);-1===N?N=r.forward?0:r.links.length-1:r.forward?(N+=1,N===r.links.length&&(N=0)):(--N,-1===N&&(N=r.links.length-1));r.links[N].focus()}function P(){var r=Q();r&&(r=e(".dropdown-link",r).filter(function(N){return null!==N.offsetParent}),L.emit("dropdown:focus",{links:r,forward:!0}))}function T(){var r=Q();r&&(r=e(".dropdown-link",r).filter(function(N){return null!==
N.offsetParent}),L.emit("dropdown:focus",{links:r,forward:!1}))}function V(r){D(r);A(r);var N=a("js-dropdown",r.target);L.emit("dropdown:toggle",{node:N,target:r.target})}function X(){M||(L.on("dropdown:toggle",n),L.on("dropdown:close",z),L.on("keyboard:escape",z),L.on("keyboard:arrow:down",P),L.on("keyboard:arrow:up",T),L.on("dropdown:focus",O),M=!0);H()}function I(){L.on("scrolling:at",function(N){r.forEach(function(W){var fa=W.element;b(W.element,"is-sticky")&&(fa=W.element.getAttribute("data-sticky-id"),
fa=document.querySelector('.js-shim[data-sticky-id\x3d"'+fa+'"]'));if(fa){var ba=fa.getAttribute("data-top")||0;W.top=fa.offsetTop-parseInt(ba,0)}W.top<N?L.emit("sticky:stick",W):L.emit("sticky:unstick",W)})});L.on("sticky:stick",function(N){var W=N.element.getAttribute("data-sticky-id"),fa=document.querySelector('.js-shim[data-sticky-id\x3d"'+W+'"]');W&&fa&&(t(N.element,"is-sticky"),fa.style.display="")});L.on("sticky:unstick",function(N){var W=N.element.getAttribute("data-sticky-id"),fa=document.querySelector('.js-shim[data-sticky-id\x3d"'+
W+'"]');W&&fa&&(p(N.element,"is-sticky"),fa.style.display="none")});var r=e(".js-sticky").map(function(N){var W=N.offsetTop,fa=N.getAttribute("data-top")||0;N.style.top=fa+"px";if(!N.getAttribute("data-sticky-id")){var ba=v.raw();N.setAttribute("data-sticky-id",ba);var Z=N.parentNode,ja=N.cloneNode("deep");t(ja,"js-shim");p(ja,"js-sticky");ja.setAttribute("data-sticky-id",ba);ja.style.visibility="hidden";ja.style.display="none";Z.insertBefore(ja,N)}return{top:W-parseInt(fa,0),element:N}})}function U(){function r(ba){var Z=
ba.getAttribute("data-tab");if(Z)return Z;Z=v.raw();ba.setAttribute("data-tab",Z);return Z}function N(ba){var Z=ba.target;b(Z,"js-tab")||(Z=ba.currentTarget);ba=a("js-tab-group",Z);var ja=r(ba);return{parent:ba,id:ja,active:Z}}function W(ba){ba.preventDefault();ba=N(ba);L.emit("tabs:active",ba)}function fa(ba){var Z=N(ba);if(13===ba.keyCode||32===ba.keyCode)ba.preventDefault(),L.emit("tabs:active",Z);if(39===ba.keyCode||37===ba.keyCode){var ja=w(Z.parent.querySelectorAll(".js-tab")),ma=ja.indexOf(document.activeElement);
-1<ma&&b(document.activeElement,"js-tab")&&(Z=ja[ma+1]||ja[0],ja=ja[ma-1]||ja[ja.length-1],(39===ba.keyCode?Z:ja).focus())}}L.on("tabs:bind",function(){var ba=e(".js-tab"),Z=e(".js-tab-group"),ja=e(".js-tab-section");Z.forEach(function(ma){ma.setAttribute("aria-live","polite");r(ma);ma.children[0].setAttribute("role","tablist");ma=ma.querySelectorAll(".js-tab");for(var aa=100/ma.length,ka=0;ka<ma.length;ka++)ma[ka].style.maxWidth=aa+"%"});ba.forEach(function(ma){ma.setAttribute("aria-expanded","false");
ma.setAttribute("role","tab");ma.setAttribute("tabindex","0");J(ma,"click",W);J(ma,"keydown",fa)});ja.forEach(function(ma){ma.setAttribute("role","tabpanel");b(ma,"is-active")?ma.setAttribute("aria-expanded",!0):ma.setAttribute("aria-expanded",!1)})});L.on("tabs:active",function(ba){var Z=ba.parent,ja=w(Z.querySelectorAll(".js-tab"));ba=ba.active;Z=w(Z.querySelectorAll(".js-tab-section"));var ma=ja.indexOf(ba);ma=Z[ma];ja.forEach(function(aa){aa.setAttribute("aria-expanded",!1)});ba.setAttribute("aria-expanded",
!0);y(ja,ba);Z.forEach(function(aa){aa.setAttribute("aria-expanded",!1)});ma.setAttribute("aria-expanded",!0);y(Z,ma);ba.focus()});L.emit("tabs:bind")}var E={dropdowns:[],accordions:[],modals:[]};F.prototype={on:function(r,N,W){var fa=this.e||(this.e={});(fa[r]||(fa[r]=[])).push({fn:N,ctx:W});return this},once:function(r,N,W){function fa(){ba.off(r,fa);N.apply(W,arguments)}var ba=this;fa._=N;return this.on(r,fa,W)},emit:function(r){var N=[].slice.call(arguments,1),W=((this.e||(this.e={}))[r]||[]).slice(),
fa=0,ba=W.length;for(fa;fa<ba;fa++)W[fa].fn.apply(W[fa].ctx,N);return this},off:function(r,N){var W=this.e||(this.e={}),fa=W[r],ba=[];if(fa&&N)for(var Z=0,ja=fa.length;Z<ja;Z++)fa[Z].fn!==N&&fa[Z].fn._!==N&&ba.push(fa[Z]);ba.length?W[r]=ba:delete W[r];return this}};var L=new F,da=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;v.EMPTY="00000000-0000-0000-0000-000000000000";v.isGuid=function(r){return r&&(r instanceof v||da.test(r.toString()))};v.create=function(){return new v([g(2),
g(1),g(1),g(1),g(3)].join("-"))};v.raw=function(){return[g(2),g(1),g(1),g(1),g(3)].join("-")};var R=!1,M=!1;J(document,"keyup",function(r){27===r.keyCode?L.emit("keyboard:escape"):13===r.keyCode?L.emit("keyboard:return"):32===r.keyCode?L.emit("keyboard:space"):38===r.keyCode?L.emit("keyboard:arrow:up"):40===r.keyCode?L.emit("keyboard:arrow:down"):37===r.keyCode?L.emit("keyboard:arrow:left"):39===r.keyCode&&L.emit("keyboard:arrow:right")});J(window,"scroll",function(r,N,W){var fa,ba,Z;var ja=function(){fa=
!1;ba&&(Z.apply(W,ba),ba=!1)};return Z=function(){fa?ba=arguments:(r.apply(W,arguments),setTimeout(ja,N),fa=!0)}}(function(){L.emit("scrolling:at",window.pageYOffset)},100));return{bus:L,accordion:k,dropdown:X,sticky:I,tabs:U,init:function(){[k,X,I,U].forEach(function(r){r()})}}})},"arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg":function(){define("require esri/declare esri/Evented dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dojo/query dojo/string dojo/topic dojo/store/Memory dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../../esriGeowConfig ../../../pages/utils/icons ../../../pages/utils/date ../../util ../Grid ./GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H){var Q=w("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg",[m,h,f,e],{baseClass:"esriMembershipRequestsDlg",widgetsInTemplate:!0,templateString:H,groupId:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.mixin({},B.common);b.mixin(this.i18n,B.membershipRequestsDlg);b.mixin(this.i18n,B.groupMembershipRequestsGrid);b.mixin(this.i18n,{error:B.inviteUsersDlg.error})},postCreate:function(){this.loadConnections()},
loadConnections:function(){this.own(J(".jevent").on("click",function(O){O.preventDefault()}),F(this._closeBtn,b.hitch(this,function(){this._dialog.hide()})),D.subscribe("onApplicationAccept",b.hitch(this,"onApplicationApprove")),D.subscribe("onApplicationDecline",b.hitch(this,"onApplicationDecline")))},show:function(O){this.groupId=O;this.clearStore();this.requestApplications();this._dialog.show()},approveApplication:function(O,P){var T=z.getUser(),V=this._requestsGrid._grid.store;T&&z.request({url:c.restBaseUrl+
"community/groups/"+this.groupId+"/applications/"+P+"/accept"},{usePost:!0}).then(b.hitch(this,function(){V.remove(O.id);D.publish("onApplicationAccept",{})}),b.hitch(this,function(){var X=new n;p.once(X._dialog,"hide",function(){X._dialog.destroyRecursive();X.destroyRecursive()});X.show({title:this.i18n.errorTitle,message:G.substitute(this.i18n.error.unableToAddPrivs,{user:P})});V.remove(O.id);D.publish("onApplicationAccept",{})}))},declineApplication:function(O,P){var T=z.getUser(),V=this._requestsGrid._grid.store;
T&&z.request({url:c.restBaseUrl+"community/groups/"+this.groupId+"/applications/"+P+"/decline"},{usePost:!0}).then(b.hitch(this,function(){V.remove(O.id);D.publish("onApplicationDecline",{})}))},onApplicationApprove:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},onApplicationDecline:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},requestApplications:function(){var O=this._requestsGrid._grid.store;return z.request({url:c.restBaseUrl+
"community/groups/"+this.groupId+"/applications"}).then(b.hitch(this,function(P){P.applications&&(t.forEach(P.applications,function(T,V){T.id=V;O.put(T)}),this.refresh())}))},clearStore:function(){this._requestsGrid||this.createGrid();var O=this._requestsGrid&&this._requestsGrid._grid&&this._requestsGrid._grid.store||void 0;O&&t.forEach(b.clone(O.query()),function(P){O.remove(P.id)})},createGrid:function(){this._requestsGrid=new u({id:"requestsGrid",columns:this.getRequestGridColumns(),noDataMessage:this.i18n.noMembershipRequests,
showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"requests-grid",store:new A({idProperty:"id",label:"fullname",data:[]}),sort:[{attribute:"received",descending:!1}]},this._requestsGridContainer);this._requestsGrid.startup();J(".dgrid-status").forEach(function(O){O.tabIndex=-1;x.add(O,"left")})},getRequestGridColumns:function(){return{fullname:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){return O})},username:{label:" ",sortable:!1,formatter:b.hitch(this,
function(O){return O})},received:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){O=new Date(parseFloat(O));return k.format(O,"long-date")})},yourResponse:{label:" ",sortable:!1,renderCell:b.hitch(this,function(O){var P=O.username,T=y.create("div",{className:"esriFloatTrailing"}),V=y.create("button",{innerHTML:"\x3cspan class\x3d'text-green'\x3e"+l.inline.check["16"]+"\x3c/span\x3e"+this.i18n.approve,className:"btn-link btn-link-off-black clickable margin-right-1"},T),X=y.create("button",
{innerHTML:"\x3cspan class\x3d'text-red'\x3e"+l.inline["minus-circle"]["16"]+"\x3c/span\x3e"+this.i18n.decline,className:"btn-link btn-link-off-black clickable"},T);this.own(F(V,b.hitch(this,"approveApplication",O,P)),F(X,b.hitch(this,"declineApplication",O,P)));return T})}}},hide:function(){this._dialog.hide()},refresh:function(){if(this._requestsGrid._grid&&this._requestsGrid._grid._started){var O=this._requestsGrid._grid._currentPage||1,P=this._requestsGrid._grid.store?this._requestsGrid._grid.store.query().length:
0;p.once(this._requestsGrid._grid,"dgrid-refresh-complete",function(T){T.grid._currentPage!==O&&0<P&&T.grid.gotoPage(O)});this._requestsGrid._grid.resize();this._requestsGrid._grid.refresh()}}});Q.prototype.statics={getInstance:function(){this._instance||(this._instance=new Q);return this._instance}};return Q})},"arcgisonline/sharing/dijit/dialog/RendererDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,arcgisonline/sharing/dijit/dialog/SymbolDlg"],
function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.RendererDlg");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.Dialog");a.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");a.declare("arcgisonline.sharing.dijit.dialog.RendererDlg",[w._Widget,w._Templated],{util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"renderer-dialog" title\x3d"${i18n.rendererDlgTitle}" execute\x3d""\x3e\r\n  \t\r\n    \x3cdiv\x3e\r\n      \x3ctable cellspacing\x3d"10" width\x3d"100%"\x3e\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.labelLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"rendererLabel" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:100%; padding:2px;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n      \x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.valueLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3clabel id\x3d"renderer-value"\x3e\x3c/label\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\x3c/table\x3e\r\n      \x3cdiv\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachPoint\x3d"_rendererSymbolUpdateButton" class\x3d"default esriFloatLeading" dojoAttachEvent\x3d"onClick:_onRendererSymbolUpdateButtonClick"\x3e\r\n          \x3cspan\x3e${i18n.changeSymbolBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onCancelClick" dojoAttachPoint\x3d"rendererCancelBtn" class\x3d"jevent cancel esriFloatTrailing" type\x3d"cancel" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.cancel}\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onOkClick" dojoAttachPoint\x3d"rendererOkBtn" class\x3d"jevent primary esriFloatTrailing" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.ok}\r\n        \x3c/button\x3e\r\n\t\t\t\x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\t\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,onRendererSymbolChangeHandler:null,onRendererSymbolChangeCancelHandler:null,applyRendererEditsHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.RendererDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel);
a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").rendererDlg)},postCreate:function(){this.loadConnections()},show:function(b){this.symbol=esri.symbol.fromJson(b.symbol.toJson());null===b.value?a.byId("renderer-value").innerHTML=this.i18n.other:a.byId("renderer-value").innerHTML=b.value;this.rendererLabel.set("value",b.label);this.applyRendererEditsHandler=a.subscribe("applyRendererEdits",a.hitch(this,"_onApplyEdits"));w.byId("renderer-dialog").show()},loadConnections:function(){a.query(".jevent").connect("onclick",
function(b){b.preventDefault()})},_onCancelClick:function(){a.publish("onRendererItemChange",[null,null]);w.byId("renderer-dialog").hide()},hide:function(){this.onRendererSymbolChangeHandler&&(a.unsubscribe(this.onRendererSymbolChangeHandler),a.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.applyRendererEditsHandler&&a.unsubscribe(this.applyRendererEditsHandler);this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);w.byId("renderer-dialog").hide()},
_onRendererSymbolUpdateButtonClick:function(b){this.onRendererSymbolChangeHandler&&(a.unsubscribe(this.onRendererSymbolChangeHandler),a.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.onRendererSymbolChangeHandler=a.subscribe("onSymbolChange",a.hitch(this,"_onRendererSymbolChange"));this.onRendererSymbolChangeCancelHandler=a.subscribe("onSymbolChangeCancel",a.hitch(this,function(){this.onRendererSymbolChangeHandler&&(a.unsubscribe(this.onRendererSymbolChangeHandler),a.unsubscribe(this.onRendererSymbolChangeCancelHandler));
this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1)}));this.rendererCancelBtn.set("disabled",!0);this._rendererSymbolUpdateButton.set("disabled",!0);arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{applyHandler:a.hitch(this,"_onApplyEdits"),okHandler:a.hitch(this,function(t){this._rendererSymbolUpdateButton.set("disabled",!1);this.symbol=t;a.publish("onRendererItemChange",[t,this.rendererLabel.get("value")]);
a.publish("saveRenderer",[])})})},_onRendererSymbolChange:function(b){this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);var t=b.toJson();"esriPMS"!=b.type||0!=t.url.length&&"http://"!=t.url||(b=esri.symbol.fromJson(this.markerJson));this.symbol=b},_onOkClick:function(b){b.preventDefault();a.publish("onRendererItemChange",[esri.symbol.fromJson(this.symbol.toJson()),this.rendererLabel.get("value")]);this.hide()},_onApplyEdits:function(b){a.publish("onRendererItemChange",
[b,this.rendererLabel.get("value")]);a.publish("saveRenderer",[])},onKeyDown:function(b){if(window.event)var t=b.keyCode;else b.which&&(t=b.which);13==t&&this._onOkClick(b)}})})},"arcgisonline/sharing/dijit/dialog/SymbolDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/SymbolOptions"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.SymbolDlg");a.require("dijit.Dialog");a.require("dijit._Widget");a.require("dijit._Templated");
a.require("arcgisonline.sharing.dijit.SymbolOptions");a.declare("arcgisonline.sharing.dijit.dialog.SymbolDlg",[w._Widget,w._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"symbol-dialog" title\x3d"${i18n.symbolDlgTitle}" execute\x3d""\x3e\r\n\t  \x3cdiv id\x3d"symbol-dialog-symboloptions" dojotype\x3d"arcgisonline.sharing.dijit.SymbolOptions" dojoAttachPoint\x3d"symbolOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cbutton dojoAttachPoint\x3d"cancelButton" dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton id\x3d"symbol-dialog-apply" dojoAttachPoint\x3d"applyButton" dojoAttachEvent\x3d"onClick:onApplyClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.apply}\x3c/button\x3e\r\n  \t  \x3cbutton id\x3d"symbol-dialog-done" dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both;"\x3e\r\n    \x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,applyHandler:null,okHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SymbolDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},show:function(b,t){this.cancelButton.set("disabled",!1);var p=b.getLayer();if(b.symbol)this.symbolOptions.symbol=
esri.symbol.fromJson(b.symbol.toJson());else{var x=p.renderer.getSymbol(b);this.symbolOptions.symbol=esri.symbol.fromJson(x.toJson())}for(x=0;x<p.types.length;x++)if(p.types[x].id==b.attributes.TYPEID&&p.types[x].templates&&0<p.types[x].templates.length){this.symbolOptions.template=p.types[x].templates[0];break}t?(this.symbolOptions.endSize=t.endSize,this.symbolOptions.showEndSize=0<t.endSize?!0:!1,this.symbolOptions.showNoBgColor=t.showNoBgColor,this.applyHandler=t.applyHandler,this.okHandler=t.okHandler):
(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(t?t.noPreDefSymbols:null);w.byId("symbol-dialog").show()},showSymbol:function(b,t){this.cancelButton.set("disabled",!1);this.symbolOptions.symbol=esri.symbol.fromJson(b.toJson());this.symbolOptions.symbol.color||(this.symbolOptions.symbol.color=new a.Color([255,255,255,0]));t?(this.symbolOptions.endSize=t.endSize,this.symbolOptions.showEndSize=
0<t.endSize?!0:!1,this.symbolOptions.showNoBgColor=t.showNoBgColor,this.applyHandler=t.applyHandler,this.okHandler=t.okHandler):(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(t?t.noPreDefSymbols:null);w.byId("symbol-dialog").show()},hide:function(){this.symbolOptions.hide();w.byId("symbol-dialog").hide()},onDoneClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&
8>this.symbolOptions.symbol.url.length||setTimeout(a.hitch(this,function(){var t=0;this.symbolOptions.urlChangesNotApplied&&(t=6E3);setTimeout(a.hitch(this,function(){if(this.okHandler){var p=this.symbolOptions.symbol.toJson();"esriPMS"!=this.symbolOptions.symbol.type||0!=p.url.length&&"http://"!=p.url||(this.symbolOptions.symbol=this.getMarkerJson());this.okHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()))}else this.symbolOptions.showEndSize?a.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),
this.symbolOptions.endSize]):a.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),setTimeout(a.hitch(this,function(){a.publish("applyRendererEdits",[])}),500);this.hide()}),t)}),100)},onApplyClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&8>this.symbolOptions.symbol.url.length||setTimeout(a.hitch(this,function(){var t=0;this.symbolOptions.urlChangesNotApplied&&(t=6E3);setTimeout(a.hitch(this,function(){if(this.applyHandler){var p=this.symbolOptions.symbol.toJson();
"esriPMS"!=this.symbolOptions.symbol.type&&"picturemarkersymbol"!=this.symbolOptions.symbol.type||0!=p.url.length&&"http://"!=p.url||(this.symbolOptions.symbol=this.getMarkerJson());this.applyHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()));this.cancelButton.set("disabled",!0)}else this.symbolOptions.showEndSize?a.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),this.symbolOptions.endSize]):a.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),
setTimeout(a.hitch(this,function(){a.publish("applyRendererEdits",[]);this.cancelButton.set("disabled",!0)}),500)}),t)}),100)},onCancelClick:function(b){a.publish("onSymbolChangeCancel",[]);this.hide()}})})},"arcgisonline/sharing/dijit/SymbolOptions":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/ColorPalette,dijit/form/HorizontalSlider,arcgisonline/sharing/dijit/dialog/ImgDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util"],function(a,
w,e){a.provide("arcgisonline.sharing.dijit.SymbolOptions");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.ColorPalette");a.require("dijit.form.HorizontalSlider");a.require("arcgisonline.sharing.dijit.dialog.ImgDlg");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.util");a.declare("arcgisonline.sharing.dijit.SymbolOptions",[w._Widget,w._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n  \x3ctable class\x3d"symbolDialogTable"\x3e\r\n   \x3ctbody\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv\x3e\x3clabel\x3e${i18n.previewLabel}\x3c/label\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd colspan\x3d"2" valign\x3d"middle" align\x3d"left"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolImage" style\x3d"height:100%; vertical-align:middle;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd colspan\x3d"3" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSmallTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolSimpleMarkerTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:50px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolSimpleMarkerTemplatePicker"\x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolFullTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesDiv" style\x3d"width:355px;line-height:normal;"\x3e\r\n            \x3cselect dojoAttachPoint\x3d"symbolColorClasses" style\x3d"width:355px;margin:0;" dojoType\x3d"arcgisonline.sharing.dijit.ComboBox"\x3e\r\n            \x3c/select\x3e       \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:130px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolClassesTemplatePicker" \x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolAddImageDiv" class\x3d"esriItemLinks" style\x3d"line-height:20px;"\x3e\r\n            \x3cA dojoAttachPoint\x3d"symbolAddImage" href\x3d"JavaScript:void(0);"\x3e${i18n.addImage}\x3c/A\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel dojoAttachPoint\x3d"symbolSizeLabel"\x3e${i18n.symbolSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolBackgroundColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.colorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolBackgroundColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolLinePatternRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.patternLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cselect dojoAttachPoint\x3d"symbolLinePatternSelect" id\x3d"symbolLinePatternSelect" dojoType\x3d"dijit.form.Select" class\x3d"symbolLinePatternSelect"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolTransparencyRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.transparencyLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd width\x3d"125" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparency" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" style\x3d"line-height:normal;margin-top:7px;" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"1" value\x3d"0" discretevalues\x3d"0.01" \x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"2" style\x3d"height:5px;"\x3e\x3c/div\x3e\r\n          \x3col dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"font-size:0.8em;"\x3e\r\n            \x3cli\x3e0\x3c/li\x3e\x3cli\x3e100%\x3c/li\x3e\r\n          \x3c/ol\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparencyInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e%\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolOutlineColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.outlineColorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolOutlineColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolWidthRow"\x3e \r\n      \x3ctd\x3e\x3clabel dojoAttachPoint\x3d"symbolWidthLabel" \x3e${i18n.outlineWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndWidthRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n   \x3c/tbody\x3e\r\n  \x3c/table\x3e                \r\n\r\n  \x3cimg id\x3d"${id}_testImage" style\x3d"position:absolute;top:0;left:-3000px"/\x3e\r\n\r\n  \x3cdiv dojoAttachPoint\x3d"symbolColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"symbolColorPaletteClose" dojoAttachPoint\x3d"symbolColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"symbolColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:onColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,template:null,colorPicker:"",savedSimpleMarkerSymbol:null,savedPictureMarkerSymbol:null,eventHandlers:null,testImageHandler:null,symbolListItems:null,symbolClassesTemplatePicker:null,simpleMarkerTemplatePicker:null,templatePickerOnSelectionChangeHandler:null,simpleMarkerTemplatePickerOnSelectionChangeHandler:null,templatePickerSymbolClass:null,symbolClassStore:null,urlChangesNotApplied:!1,cachedImages:[],onImageChangeHandler:null,showEndSize:!1,showNoBgColor:!1,endSize:0,simpleMarkerSymbols:[{name:"Circle",
type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",
color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],markerJson:{type:"esriPMS",url:"/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII\x3d",
contentType:"image/png",width:15,height:15},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.clone(a.i18n.getLocalization("arcgisonline","arcgisonline").common);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},postCreate:function(){this.symbolLinePatternSelect._getMenuItemForOption=
function(b){if(b.value||b.label){var t=a.hitch(this,"_setValueAttr",b);b=new w.MenuItem({option:b,label:b.label||this.emptyLabel,onClick:t,ownerDocument:this.ownerDocument,dir:this.dir,disabled:b.disabled||!1,iconClass:b.iconClass});b.focusNode.setAttribute("role","option");return b}return new w.MenuSeparator({ownerDocument:this.ownerDocument})};this.symbolLinePatternSelect.addOption({value:"solid",iconClass:"symbolLinePatternSolid"});this.symbolLinePatternSelect.addOption({value:"dot",iconClass:"symbolLinePatternDot"});
this.symbolLinePatternSelect.addOption({value:"dash",iconClass:"symbolLinePatternDash"});this.symbolLinePatternSelect.addOption({value:"dashdot",iconClass:"symbolLinePatternDashDot"});this.symbolLinePatternSelect.addOption({value:"dashdotdot",iconClass:"symbolLinePatternDashDotDot"});this._symbolCloseIcon&&a.attr(this._symbolCloseIcon,"src",arcgisonline.sharing.util.relativeToExplicitUrl("images/close.gif"));a.connect(this.symbolLinePatternSelect,"onChange",a.hitch(this,"onPatternChange"));this.loadConnections()},
init:function(b){this.savedPictureMarkerSymbol=this.savedSimpleMarkerSymbol=null;if(this.symbol){if(!b||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)if(b)a.style(this.symbolFullTemplatePicker,"display","none"),a.style(this.symbolSmallTemplatePicker,"display","none");else if(a.style(this.symbolSmallTemplatePicker,"display","none"),a.style(this.symbolFullTemplatePicker,"display","block"),this.symbolListItems)if(this.templatePickerSymbolClass!==this.symbol.type&&
("simplemarkersymbol"!==this.templatePickerSymbolClass&&"picturemarkersymbol"!==this.templatePickerSymbolClass||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)){if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)for(b=0;b<this.symbolListItems.length;b++){var t=this.symbolListItems[b];if(-1<t.typeKeywordsString.indexOf("marker")&&-1<t.typeKeywordsString.indexOf("default")){this.symbolColorClasses.set("value",t.title);break}}this.getSymbolListData(!0)}else this.getSymbolListData();
else this.getSymbolListGroup();else a.style(this.symbolFullTemplatePicker,"display","none"),a.style(this.symbolSmallTemplatePicker,"display","block"),setTimeout(a.hitch(this,function(){this.createSimpleMarkerTemplatePicker()}),0);this.updateUI();this.enableEvents();this.symbolClassesTemplatePicker&&this.symbolClassesTemplatePicker.clearSelection();this.simpleMarkerTemplatePicker&&this.simpleMarkerTemplatePicker.clearSelection()}},hide:function(){this.disableEvents();w.popup.close(this.symbolColorTooltip);
this.destroySymbolClassesTemplatePicker();this.destroySimpleMarkerTemplatePicker()},loadConnections:function(){a.query(".jevent").connect("onclick",function(b){b.preventDefault()});a.connect(this.symbolColorTooltipClose,"onclick",a.hitch(this,function(b){b.preventDefault();w.popup.close(this.symbolColorTooltip)}));a.connect(this.symbolBackgroundColor,"onclick",this,"onBackgroundColorClick");a.connect(this.symbolOutlineColor,"onclick",this,"onOutlineColorClick");a.connect(this.symbolAddImage,"onclick",
this,"onAddImage")},updateUI:function(){this.symbolImage.innerHTML="";if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)a.style(this.symbolClassesDiv,"display","block"),a.style(this.symbolClassesTemplatePickerDiv,"display","block"),a.style(this.symbolSizeRow,"display",""),this.symbolSizeLabel.innerHTML=this.i18n.symbolSizeLabel,a.style(this.symbolEndSizeRow,"display","none"),a.style(this.symbolEndWidthRow,"display","none"),a.style(this.symbolAddImageDiv,"display",
""),"simplemarkersymbol"===this.symbol.type?(a.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),a.style(this.symbolLinePatternRow,"display","none"),a.style(this.symbolOutlineColorRow,"display",""),a.style(this.symbolWidthRow,"display",""),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,a.style(this.symbolTransparencyRow,"display",""),this.symbolSize.set("value",this.symbol.size,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.size),!1),this.showEndSize&&
(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),a.style(this.symbolEndSizeRow,"display","")),a.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),a.style(this.symbolOutlineColor,"background",
this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.outline.width),!1)):"picturemarkersymbol"===this.symbol.type&&(a.style(this.symbolBackgroundColorRow,"display","none"),a.style(this.symbolLinePatternRow,"display","none"),a.style(this.symbolOutlineColorRow,"display","none"),a.style(this.symbolWidthRow,"display","none"),a.style(this.symbolTransparencyRow,"display","none"),this.symbolSize.set("value",
this.symbol.width,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),a.style(this.symbolEndSizeRow,"display","")));else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)a.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),a.style(this.symbolAddImageDiv,
"display","none"),a.style(this.symbolClassesDiv,"display","none"),a.style(this.symbolClassesTemplatePickerDiv,"display","block"),a.style(this.symbolSizeRow,"display","none"),a.style(this.symbolTransparencyRow,"display",""),a.style(this.symbolEndSizeRow,"display","none"),this.setLinePattern(),a.style(this.symbolLinePatternRow,"display",""),this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),a.style(this.symbolOutlineColorRow,"display","none"),a.style(this.symbolWidthRow,
"display",""),this.symbolWidthLabel.innerHTML=this.i18n.symbolWidthLabel,a.style(this.symbolEndWidthRow,"display","none"),a.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),this.symbolWidth.set("value",this.symbol.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&
(this.symbolWidthLabel.innerHTML=this.i18n.symbolStartWidthLabel,this.symbolEndWidth.set("value",this.endSize,!1),this.symbolEndWidthInput.set("value",Math.round(this.endSize),!1),a.style(this.symbolEndWidthRow,"display","")),this.onPatternChange();else if("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)a.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),a.style(this.symbolAddImageDiv,"display","none"),a.style(this.symbolClassesDiv,"display",
"none"),a.style(this.symbolClassesTemplatePickerDiv,"display","block"),a.style(this.symbolSizeRow,"display","none"),a.style(this.symbolTransparencyRow,"display",""),a.style(this.symbolEndSizeRow,"display","none"),a.style(this.symbolEndWidthRow,"display","none"),a.style(this.symbolLinePatternRow,"display","none"),a.style(this.symbolOutlineColorRow,"display",""),a.style(this.symbolWidthRow,"display",""),a.style(this.symbolEndWidthRow,"display","none"),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,
this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),a.style(this.symbolBackgroundColor,"backgroundColor",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),a.style(this.symbolOutlineColor,"backgroundColor",this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",
Math.round(this.symbol.outline.width),!1);this._drawSymbol()},enableEvents:function(){this.eventHandlers=[];this.eventHandlers.push(a.connect(this.symbolSize,"onChange",this,"onSizeChange"));this.eventHandlers.push(a.connect(this.symbolSize._movable,"onMoveStop",this,"onSizeChange"));this.eventHandlers.push(a.connect(this.symbolSizeInput,"onChange",this,"onSizeChangeByInput"));this.eventHandlers.push(a.connect(this.symbolEndSize,"onChange",this,"onEndSizeChange"));this.eventHandlers.push(a.connect(this.symbolEndSize._movable,
"onMoveStop",this,"onEndSizeChange"));this.eventHandlers.push(a.connect(this.symbolEndSizeInput,"onChange",this,"onEndSizeChangeByInput"));this.eventHandlers.push(a.connect(this.symbolTransparency,"onChange",this,"onTransparencyChange"));this.eventHandlers.push(a.connect(this.symbolTransparency._movable,"onMoveStop",this,"onTransparencyChange"));this.eventHandlers.push(a.connect(this.symbolTransparencyInput,"onChange",this,"onTransparencyChangeByInput"));this.eventHandlers.push(a.connect(this.symbolWidth,
"onChange",this,"onWidthChange"));this.eventHandlers.push(a.connect(this.symbolWidth._movable,"onMoveStop",this,"onWidthChange"));this.eventHandlers.push(a.connect(this.symbolWidthInput,"onChange",this,"onWidthChangeByInput"));this.eventHandlers.push(a.connect(this.symbolEndWidth,"onChange",this,"onEndWidthChange"));this.eventHandlers.push(a.connect(this.symbolEndWidth._movable,"onMoveStop",this,"onEndWidthChange"));this.eventHandlers.push(a.connect(this.symbolEndWidthInput,"onChange",this,"onEndWidthChangeByInput"));
this.eventHandlers.push(a.connect(this.symbolLinePatternSelect,"onChange",a.hitch(this,"onSymbolLinePatternChange")));this.eventHandlers.push(a.connect(this.symbolColorClasses,"onChange",this,"onSymbolListChange"))},disableEvents:function(){this.eventHandlers&&(a.forEach(this.eventHandlers,function(b){a.disconnect(b)}),this.eventHandlers=null)},onPatternChange:function(){a.removeClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid symbolLinePatternDot symbolLinePatternDash symbolLinePatternDashDot symbolLinePatternDashDotDot");
"solid"==this.symbolLinePatternSelect.get("value")?a.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid"):"dot"==this.symbolLinePatternSelect.get("value")?a.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDot"):"dash"==this.symbolLinePatternSelect.get("value")?a.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDash"):"dashdot"==this.symbolLinePatternSelect.get("value")?a.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDot"):
"dashdotdot"==this.symbolLinePatternSelect.get("value")&&a.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDotDot")},onBackgroundColorClick:function(b){this.colorPicker="background";w.popup.open({popup:this.symbolColorTooltip,around:b.target})},onOutlineColorClick:function(b){this.colorPicker="outline";w.popup.open({popup:this.symbolColorTooltip,around:b.target})},onColorSelection:function(b){w.popup.close(this.symbolColorTooltip);b=(new a.Color(b)).toRgba();"background"===
this.colorPicker||"simplelinesymbol"===this.symbol.type?(b[3]=this.symbol.color.toRgba()[3],this.symbol.color.setColor(b)):this.symbol.outline.color.setColor(b);this.updateUI()},onTransparencyChange:function(b){b=this.symbol.color.toRgba();var t=this.symbolTransparency.getValue();t=a.number.round(t,2);b[3]=1-t;this.symbol.color.setColor(b);this.updateUI()},onTransparencyChangeByInput:function(b){isNaN(b)?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):
(b=Math.round(b),0>b||100<b?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):this.symbolTransparency.set("value",b/100,!1))},onWidthChange:function(b){if(!isNaN(b)){var t=this.symbolWidth.getValue();t=Math.round(t);"simplefillsymbol"===this.symbol.type||"simplemarkersymbol"===this.symbol.type?this.symbol.outline.width!=b&&(this.symbol.outline.setWidth(t),this.symbol.outline.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),b=this.symbol.outline.color.toRgba(),
b[3]=1,this.symbol.outline.color.setColor(b),this.updateUI()):this.symbol.width!=b&&(this.symbol.setWidth(t),this.updateUI())}},onWidthChangeByInput:function(b){isNaN(b)?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):(b=Math.round(b),0>b||18<b?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):this.symbolWidth.set("value",b,!0))},onEndWidthChange:function(b){isNaN(b)||(b=this.symbolEndWidth.getValue(),b=Math.round(b),b<this.symbolWidthInput.getValue()?this.symbolEndWidth.set("value",
this.symbolEndWidthInput.getValue(),!1):(this.symbolEndWidthInput.set("value",b,!1),this.endSize=b))},onEndWidthChangeByInput:function(b){isNaN(b)?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolWidth.getValue()?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(this.symbolEndWidth.set("value",b,!1),this.endSize=b))},onSizeChange:function(b){if(!isNaN(b)){b=this.symbol.width;var t=this.symbolSize.getValue();
t=Math.round(t);if(b!=t)if(this.showEndSize&&t>this.symbolEndSizeInput.getValue())this.symbolSize.set("value",this.symbolSizeInput.getValue(),!1);else{if("picturemarkersymbol"===this.symbol.type){this.symbol.setHeight(this.symbol.height/this.symbol.width*t);this.symbol.setWidth(t);if(!this.symbol.url||"http://"===this.symbol.url||-1==this.symbol.url.indexOf("http://")&&-1==this.symbol.url.indexOf("data:"))return;if(this.symbol.xoffset||this.symbol.yoffset)t=this.symbol.width,b=t/b,this.symbol.setOffset(Math.round(this.symbol.xoffset*
b),Math.round(this.symbol.yoffset*b))}else this.symbol.setSize(t);this.updateUI()}}},onSizeChangeByInput:function(b){isNaN(b)?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):(b=Math.round(b),1>b||120<b||this.showEndSize&&b>this.symbolEndSize.getValue()?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):this.symbolSize.set("value",b,!0))},onEndSizeChange:function(b){isNaN(b)||(b=this.symbolEndSize.getValue(),b=Math.round(b),b<this.symbolSizeInput.getValue()?
this.symbolEndSize.set("value",this.symbolEndSizeInput.getValue(),!1):(this.symbolEndSizeInput.set("value",b,!1),this.endSize=b))},onEndSizeChangeByInput:function(b){isNaN(b)?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolSize.getValue()?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(this.symbolEndSize.set("value",b,!1),this.endSize=b))},onUrlChange:function(b){if(b&&!(10>b.length)&&0===
b.indexOf("http")){this.urlChangesNotApplied=!0;for(var t=function(J){clearTimeout(y);y=null;var G=a.style(a.byId(this.id+"_testImage"),"width"),D=a.style(a.byId(this.id+"_testImage"),"height");J.w&&J.h&&(G=J.w,D=J.h);1==G&&1==D?(this.urlChangesNotApplied=!1,this.updateUI(),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})):(0===G&&(G=40),0===D&&(D=G),J.w&&J.h||this.cachedImages.push({url:b,w:G,h:D}),
this.symbol=new esri.symbol.PictureMarkerSymbol,this.symbol.setWidth(Math.min(120,G)),this.symbolSize.set("value",this.symbol.width,!1),this.symbol.setHeight(D/G*this.symbol.width),this.symbol.setUrl(b),this.updateUI(),this.urlChangesNotApplied=!1)},p=0;p<this.cachedImages.length;p++){var x=this.cachedImages[p];if(x.url==b){a.hitch(this,t)(x);return}}this.testImageHandler&&a.disconnect(this.testImageHandler);this.testImageHandler=a.connect(a.byId(this.id+"_testImage"),"onload",this,t,{});var y=setTimeout(a.hitch(this,
function(){clearTimeout(y);y=null;this.urlChangesNotApplied=!1;arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})}),5E3);a.byId(this.id+"_testImage").src=b}},onAddImage:function(b){this.onImageChangeHandler&&a.unsubscribe(this.onImageChangeHandler);this.onImageChangeHandler=a.subscribe("onUrlChange",a.hitch(this,"onUrlChange"));arcgisonline.sharing.dijit.dialog.ImgDlg.prototype.statics.getInstance().show()},
onSymbolLinePatternChange:function(){if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type){switch(this.symbolLinePatternSelect.getValue()){case "dot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DOT);break;case "dash":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASH);break;case "dashdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT);break;case "dashdotdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT);
break;default:this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID)}this.updateUI()}},getSymbolListGroup:function(){arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.symbolSetsGroupQuery,a.hitch(this,function(b,t){b&&b.results&&0<b.results.length&&this.getSymbolListItems(b.results[0].id)}),a.hitch(this,function(b,t){}))},getSymbolListItems:function(b){b=esriGeowConfig.restBaseUrl+"search?num\x3d20\x26q\x3dgroup:"+b+' AND type:"Symbol Set"';b="vml"===e.gfx.renderer?b+' AND -typekeywords:"by value"':
b+' AND ((typekeywords:"by value" AND typekeywords:"marker") OR typekeywords:"fill" OR typekeywords:"line")';arcgisonline.sharing.util.getJson(b,a.hitch(this,function(t,p){t.results&&0<t.results.length&&(this.symbolListItems=t.results,this.symbolListItems.sort(function(x,y){return x.title==y.title?0:x.title<y.title?-1:1}),a.forEach(this.symbolListItems,function(x,y){x.typeKeywordsString=x.typeKeywords.toString();if(-1<x.typeKeywordsString.indexOf("default")&&-1<x.typeKeywordsString.indexOf("marker")){var J=
this.symbolListItems.splice(y,1);0<J.length&&(this.symbolListItems.splice(0,0,J[0]),this.symbolColorClasses.set("value",x.title))}},this),this.symbolClassStore=new a.data.ItemFileWriteStore({data:{identifier:"id",items:[]}}),a.forEach(this.symbolListItems,function(x){-1<x.typeKeywordsString.indexOf("marker")&&(this.symbolClassStore.newItem({name:x.title,id:x.id}),this.symbolColorClasses.set("store",this.symbolClassStore))},this),this.getSymbolListData(!0))}),a.hitch(this,function(t,p){}))},getSymbolListData:function(b){this.destroySymbolClassesTemplatePicker();
a.forEach(this.symbolListItems,function(t){if(("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)&&-1<t.typeKeywordsString.indexOf("marker")||("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)&&-1<t.typeKeywordsString.indexOf("line")||("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)&&-1<t.typeKeywordsString.indexOf("fill"))t.data?"simplemarkersymbol"!==this.symbol.type&&"picturemarkersymbol"!==this.symbol.type?
this.processSymbolListData(t):this.symbolColorClasses.get("value")==t.title&&this.processSymbolListData(t):arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"/content/items/"+t.id+"/data",a.hitch(this,function(p,x,y){x&&0<x.length&&(p.data=x,"simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type?(b&&-1<p.typeKeywordsString.indexOf("default")||!b)&&this.processSymbolListData(p):this.processSymbolListData(p))},t),a.hitch(this,function(p,x){}))},this)},processSymbolListData:function(b){setTimeout(a.hitch(this,
function(){this.createSymbolListTemplatePicker(b.data)}),0)},createSymbolListTemplatePicker:function(b){b=a.map(b,function(t){var p={};p.symbol=esri.symbol.fromJson(t);p.description=t.name;return p},this);this.symbolClassesTemplatePicker||(this.symbolClassesTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 120px;"},this.id+"_symbolClassesTemplatePicker"),this.symbolClassesTemplatePicker.startup(),
this.templatePickerSymbolClass=this.symbol.type,this.templatePickerOnSelectionChangeHandler=a.connect(this.symbolClassesTemplatePicker,"onSelectionChange",this,function(){var t=this.symbolClassesTemplatePicker.getSelected();if(t){var p=this.symbol;this.symbol=esri.symbol.fromJson(t.item.symbol.toJson());if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)"simplemarkersymbol"===this.symbol.type?this.symbol.size="simplemarkersymbol"===p.type?p.size:p.width:"simplemarkersymbol"===
p.type?(this.symbol.xoffset&&(this.symbol.xoffset=p.size/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*p.size/(this.symbol.height/this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*p.size,this.symbol.width=p.size):(this.symbol.xoffset&&(this.symbol.xoffset=p.width/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*p.width/(this.symbol.height/
this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*p.width,this.symbol.width=p.width);(this.symbol.width||this.symbol.size)>=this.endSize&&(this.endSize=(this.symbol.width?this.symbol.width:this.symbol.size)+("simplelinesymbol"==this.symbol.type?10:20),this.symbolEndSize.set("value",this.endSize,!1));this.updateUI()}}))},destroySymbolClassesTemplatePicker:function(){this.symbolClassesTemplatePicker&&(a.disconnect(this.templatePickerOnSelectionChangeHandler),this.symbolClassesTemplatePicker.destroy(),
this.symbolClassesTemplatePicker=null,a.byId("symbolClassesTemplatePicker")||a.create("div",{id:this.id+"_symbolClassesTemplatePicker"},this.symbolClassesTemplatePickerDiv))},onSymbolListChange:function(b){if(b){this.destroySymbolClassesTemplatePicker();for(var t=null,p=0;p<this.symbolListItems.length;p++)this.symbolListItems[p].title==b&&(t=this.symbolListItems[p]);t&&t.data&&setTimeout(a.hitch(this,function(){this.createSymbolListTemplatePicker(t.data)}),0)}},createSimpleMarkerTemplatePicker:function(){var b=
a.map(this.simpleMarkerSymbols,function(t){var p={};p.symbol=esri.symbol.fromJson(t);p.description=t.name;return p},this);this.simpleMarkerTemplatePicker||(this.simpleMarkerTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 45px;"},this.id+"_symbolSimpleMarkerTemplatePicker"),this.simpleMarkerTemplatePicker.startup(),this.simpleMarkerTemplatePickerOnSelectionChangeHandler=a.connect(this.simpleMarkerTemplatePicker,
"onSelectionChange",this,function(){var t=this.simpleMarkerTemplatePicker.getSelected();t&&(this.symbol=esri.symbol.fromJson(t.item.symbol.toJson()),this.updateUI())}))},destroySimpleMarkerTemplatePicker:function(){this.simpleMarkerTemplatePicker&&(a.disconnect(this.simpleMarkerTemplatePickerOnSelectionChangeHandler),this.simpleMarkerTemplatePicker.destroy(),this.simpleMarkerTemplatePicker=null,a.byId(this.id+"_symbolSimpleMarkerTemplatePicker")||a.create("div",{id:this.id+"_symbolSimpleMarkerTemplatePicker"},
this.symbolSimpleMarkerTemplatePickerDiv))},getSymbolUrl:function(){var b=this.symbol.url;0!==b.indexOf("http://")&&this.symbol.imageData&&0<this.symbol.imageData.length&&(b=this.symbol.imageData);return b},setLinePattern:function(){switch(this.symbol.style){case esri.symbol.SimpleLineSymbol.STYLE_DOT:this.symbolLinePatternSelect.set("value","dot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASH:this.symbolLinePatternSelect.set("value","dash",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOT:this.symbolLinePatternSelect.set("value",
"dashdot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT:this.symbolLinePatternSelect.set("value","dashdotdot",!1);break;default:this.symbolLinePatternSelect.set("value","solid",!1)}},getMarkerJson:function(){var b=this.markerJson;b.url=arcgisonline.sharing.util.getRedSphereUrl();return b},_drawSymbol:function(){var b=this.symbolImage,t=this.symbol,p=this.template,x=80,y=30;if("simplemarkersymbol"===t.type)y=x=Math.min(t.size+12,125);else if("picturemarkersymbol"===t.type){if(!this.symbol.url||
"http://"===t.url||-1==t.url.indexOf("http://")&&-1==t.url.indexOf("https://")&&-1==t.url.indexOf("data:"))return;y=x=Math.min(Math.max(t.width,t.height),125)}else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)x=190,y=20;b=e.gfx.createSurface(b,x,y);if("vml"===e.gfx.renderer){var J=b.getEventSource();a.style(J,"position","relative");a.style(J.parentNode,"position","relative")}t=this._getDrawingToolShape(t,p)||esri.symbol.getShapeDescriptors(t);try{var G=b.createShape(t.defaultShape).setFill(t.fill).setStroke(t.stroke)}catch(D){b.clear();
b.destroy();return}t=b.getDimensions();t={dx:t.width/2,dy:t.height/2};J=G.getBoundingBox();p=J.width;J=J.height;if(p>x||J>y)x=((x<y?x:y)-5)/(p>J?p:J),a.mixin(t,{xx:x,yy:x});G.applyTransform(t);return b},_getDrawingToolShape:function(b,t){if("simplelinesymbol"==b.type||"cartographiclinesymbol"==b.type){var p={type:"path",path:"M -90,0 L 90,0 E"};return{defaultShape:p,fill:null,stroke:b.getStroke()}}switch(t?t.drawingTool||null:null){case "esriFeatureEditToolArrow":p={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};
break;case "esriFeatureEditToolTriangle":p={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":p={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":p={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":p={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:p,fill:b.getFill(),stroke:b.getStroke()}},_repaintItems:function(){a.forEach(this._surfaceItems,
function(b){this._repaint(b)},this)},_repaint:function(b){b.getStroke&&b.setStroke&&b.setStroke(b.getStroke());b.getFill&&b.setFill&&b.setFill(b.getFill());b.children&&a.isArray(b.children)&&a.forEach(b.children,this._repaint,this)}})})},"arcgisonline/sharing/dijit/dialog/ImgDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.ImgDlg");a.require("dijit.Dialog");
a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.declare("arcgisonline.sharing.dijit.dialog.ImgDlg",[w._Widget,w._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"image-dialog" title\x3d"${i18n.imgDlgTitle}" execute\x3d""\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.specifyImage}\x3c/span\x3e\x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3clabel style\x3d"line-height:12px;"\x3e${i18n.urlLabel}\x3c/label\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"urlInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" value\x3d"http://" style\x3d"width:330px;" dir\x3d"ltr"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.imgDetailMessage}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t  \x3cbr /\x3e\x26nbsp;  \r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n\t  \x3cbr /\x3e\x26nbsp; \r\n\t\t\x3cbr/\x3e \r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ImgDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg)},postCreate:function(){this.loadConnections()},
show:function(b){w.byId("image-dialog").show()},hide:function(){this.urlInput.setValue("http://");w.byId("image-dialog").hide()},loadConnections:function(){a.query(".jevent").connect("onclick",function(b){b.preventDefault()})},onDoneClick:function(b){b=this.urlInput.getValue();10>b.length?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl}):(0!==b.indexOf("http")&&(b="http://"+b),a.publish("onUrlChange",
[b]),this.hide())},onCancelClick:function(b){a.publish("onUrlChange",[]);this.hide()}})})},"arcgisonline/sharing/dijit/dialog/SharingDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/ShareOptions"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.SharingDlg");a.require("dijit.Dialog");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing.dijit.ShareOptions");a.declare("arcgisonline.sharing.dijit.dialog.SharingDlg",
[w._Widget,w._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_shareDialog" id\x3d"share-dialog" title\x3d"${i18n.sharingDlgTitle}" execute\x3d""\x3e\r\n    \x3clabel class\x3d"trailer-half share-title"\x3e${i18n.shareItemsLabel}\x3c/label\x3e\r\n    \x3cdiv dojotype\x3d"arcgisonline.sharing.dijit.ShareOptions" dojoAttachPoint\x3d"_shareOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cp class\x3d"trailer-half font-size--1"\x3e\r\n        ${i18n.settingsMsg}\r\n      \x3c/p\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareNoGroupsDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notAMemberMsg}\r\n      \x3c/div\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareOwnerNoneDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notOwnerMsg}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_editableLayerMsg" class\x3d"label-yellow hide js-sharing-help"\x3e\r\n        ${i18n.layerIsEditable} \x3ca href\x3d"${_helpLink}" target\x3d"_blank"\x3e${i18n.learnHow}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_premiumContentMsg" class\x3d"label-yellow hide js-premium-help"\x3e\r\n      ${i18n.premiumLayerMsg} \x3ca href\x3d"${_helpLinkPremium}" target\x3d"_blank"\x3e${i18n.premiumLayerMsgLearnMore}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right clearfix share-action-bar leader-half" style\x3d"padding-bottom:1em;"\x3e\r\n      \x3cspan class\x3d"disabled padding-right-1" style\x3d"display:none;"\x3e${i18n.sharingItems}\x3c/span\x3e\r\n      \x3cbutton id\x3d"button_share-cancel" class\x3d"jevent cancel" type\x3d"cancel" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancelClick"\x3e\r\n        ${i18n.cancel}\r\n      \x3c/button\x3e\r\n      \x3cbutton class\x3d"jevent primary" dojotype\x3d"dijit.form.Button"  dojoAttachEvent\x3d"onClick:_handleOkResponse"\x3e\r\n        ${i18n.ok}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,_shareDialog:null,_shareOptions:null,_shareNoGroupsDiv:null,_shareOwnerNoneDiv:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SharingDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").sharingDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline",
"arcgisonline").shareCheckDlg);a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").shareMapDlg);this._helpLink=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001067"];this._helpLinkPremium=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001307"];this._handles=[]},postCreate:function(){this.loadConnections()},destroy:function(){a.forEach(this._handles,"item.remove();");this._shareDialog.destroyRecursive();this._shareDialog=null;this.inherited(arguments)},_setDisabledAttr:function(b){a.forEach(w.registry.findWidgets(this._shareDialog.domNode),
function(t){t.set("disabled",b)});a.query("input").forEach(function(t){a.attr(t,"disabled",b)});a.query(".disabled").forEach(function(t){a.style(t,"display",b?"":"none")})},loadConnections:function(){a.connect(this._shareDialog,"hide",a.hitch(this,function(b){(b=b&&b.target)&&a.hasClass(b,"dijitDialogCloseIcon")&&(this.isCancelled=!0);this.set("disabled",!1);this._shareOptions.clear()}));this._handles.push(a.subscribe("shareOptionsSetup",a.hitch(this,function(){this._shareDialog.show()})));this._handles.push(a.subscribe("onShareUpdate",
a.hitch(this,function(b){this.set("disabled",!1);b&&b.length&&"string"!==typeof b||this._shareDialog.hide()})));this._handles.push(a.subscribe("doesNotOwnGroups",a.hitch(this,function(){a.style(this._shareOwnerNoneDiv,"display","block")})));this._handles.push(a.subscribe("notMemberOfAnyGroups",a.hitch(this,function(){a.style(this._shareNoGroupsDiv,"display","block")})))},_handleOkResponse:function(b){b.preventDefault();this.set("disabled",!0);this._shareOptions.share(b)},_handleCancelClick:function(b){b.preventDefault();
this.isCancelled=!0;this._shareDialog.hide()},hide:function(){this._shareDialog.hide()},show:function(b,t,p,x){this._shareOptions.show(b,t,p,x)},showAdmin:function(b,t,p,x){this._shareOptions.showAdmin(b,t,p,x)},showGroups:function(b,t){this._shareOptions.showGroups(b,t)}})})},"arcgisonline/sharing/dijit/dialog/TagsDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,dijit/form/MultiSelect,dijit/form/SimpleTextarea,arcgisonline/sharing/geow/Content"],
function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.TagsDlg");a.require("dijit._Widget");a.require("dijit._Templated");a.require("dijit.Dialog");a.require("dijit.form.MultiSelect");a.require("dijit.form.SimpleTextarea");a.require("arcgisonline.sharing.geow.Content");a.declare("arcgisonline.sharing.dijit.dialog.TagsDlg",[w._Widget,w._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_tagsDialog" dojoAttachPoint\x3d"onHide:clear" title\x3d"${i18n.tagDlgTitle}" class\x3d"tagsForm"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_tagsErrorDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentTagsDiv" style\x3d"display:block;"\x3e\r\n\t\t\x3clabel \x3e${i18n.selectTag}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t    \x3cselect dojoAttachPoint\x3d"_tagsSelect" dojoType\x3d"dijit.form.MultiSelect" style\x3d"width:100%;height:150px;"\x3e\x3c/select\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_cancelBtn" dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.cancel}\x3c/div\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_submitBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" type\x3d"submit" dojoAttachEvent\x3d"onClick:getSelectedTags" style\x3d"float:right;"\x3e${i18n.useSelected}\x3c/div\x3e  \r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentNoTagsDiv" style\x3d"display:none;"\x3e\r\n\t\t\x3clabel\x3e${i18n.tagsNotAvailable}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv id\x3d"button_tags-ok" dojoAttachPoint\x3d"_okBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.ok}\x3c/div\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
_tagsDialog:null,_contentTagsDiv:null,_contentNoTagsDiv:null,_tagsSelect:null,i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TagsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").tagsDlg)},postCreate:function(){},_handleCancelClick:function(b){b.preventDefault();
this._tagsDialog.hide()},clear:function(){this._tagsSelect.reset();a.style(this._contentTagsDiv,"display","none");a.style(this._contentNoTagsDiv,"display","none")},hide:function(){this._tagsDialog.hide()},show:function(b){this.clear();var t=arcgisonline.sharing.util.getUser(),p=esriGeowConfig.restBaseUrl+"community/users/";p=b&&(b.username||b.email)?p+(b.username?b.username:b.email):p+t.username;arcgisonline.sharing.util.getJson(p+"/tags",a.hitch(this,this._handleTagResponse),a.hitch(this,this._handleError));
this._tagsDialog.show()},_handleTagResponse:function(b){0==b.tags.length?a.style(this._contentNoTagsDiv,"display",""):(a.style(this._contentTagsDiv,"display",""),a.empty(this._tagsSelect.domNode),a.forEach(b.tags,function(t){a.create("option",{innerHTML:t.tag,value:t.tag},this._tagsSelect.domNode)},this))},_handleError:function(b){},getSelectedTags:function(b){b.preventDefault();b=[];b=this._tagsSelect.get("value");a.publish("onSelectedTagsUpdate",[b.toString()])}})})},"arcgisonline/sharing/dijit/dialog/TermsOfUseDlg":function(){define(["dojo",
"dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,arcgisonline/sharing/util,dijit/Dialog"],function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.sharing.util");a.require("dijit.Dialog");a.declare("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg",[w._Widget,w._Templated],{util:arcgisonline.sharing.util,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" id\x3d"terms-of-use-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.title}" execute\x3d"" style\x3d"overflow-y:auto;"\x3e\r\n    \x3cform id\x3d"terms-of-use-form" method\x3d"POST" action\x3d"" style\x3d"height:100%;overflow-y:auto;padding-left:10px;"\x3e\r\n      \x3cdiv style\x3d"height:30px; text-align:center;"\x3e\r\n        \x3cspan style\x3d"font-size:1.1em; font-weight:bold"\x3e${i18n.termsOfUseTitle}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" id\x3d"tos" style\x3d"background:#FFF;border:solid 1px #000;overflow-x:hidden;overflow-y:hidden;width:400px;height:250px;"\x3e\r\n        \x3ca href\x3d\'\'\x3e\x3c/a\x3e\r\n        \x3ciframe id\x3d"termsFrame" src\x3d"termsofuse.html" style\x3d"width:100%;height:250px;max-width:100%;max-height:250px;"\x3e\x3c/iframe\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding-top:10px;"\x3e\r\n        \x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"http://www.esri.com/legal/licensing-translations" target\x3d"_blank"\x3e${i18n.otherLanguages}\x3c/a\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"height:40px; padding-top:10px;"\x3e\r\n        \x3cbutton id\x3d"button_accept" type\x3d"submit" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.accept}\r\n        \x3c/button\x3e\r\n        \x3cbutton id\x3d"button_decline" class\x3d"jevent cancel" type\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.noaccept}\r\n        \x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
_firstLoad:!0,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TermsOfUseDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").termsOfUseDlg)},postCreate:function(){this.loadConnections()},show:function(b){w.byId("terms-of-use-dialog").show();esri.isTouchEnabled?
(a.style(a.byId("terms-of-use-dialog"),"width","500px"),a.style(a.byId("tos"),"width","455px"),a.style(a.byId("tos"),"overflow-y","scroll")):this._firstLoad&&(a.style(a.byId("terms-of-use-dialog"),"width","455px"),a.isFF||10>a.isIE?(a.isFF&&a.style(a.byId("tos"),"height",parseInt(a.style(a.byId("terms-of-use-dialog"),"height"))-169+"px"),9>a.isIE&&a.style(a.byId("tos"),"height",parseInt(a.style(a.byId("terms-of-use-dialog"),"height"))-208+"px"),8>a.isIE&&a.style(a.byId("tos"),"height",parseInt(a.style(a.byId("terms-of-use-dialog"),
"height"))-133+"px")):a.style(a.byId("tos"),"height",parseInt(a.style(a.byId("terms-of-use-dialog"),"height"))-169+"px"),a.style(a.byId("terms-of-use-form"),"overflow-y","hidden"),this._firstLoad=!1)},loadConnections:function(){a.query(".jevent").connect("onclick",function(b){b.preventDefault()});a.connect(a.byId("button_decline"),"onclick",this,"declineTerms");a.connect(a.byId("terms-of-use-form"),"onsubmit",this,"registerUser")},hide:function(){w.byId("terms-of-use-dialog").hide()},registerUser:function(b){b.preventDefault();
this.hide();a.publish("registerUser",["true"])},declineTerms:function(b){b.preventDefault();this.hide();a.publish("declineTermsOfUse",["true"])}})})},"arcgisonline/sharing/dijit/dialog/UpdateItemDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/CheckBox,dijit/form/Button,dijit/InlineEditBox,dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/pages/pageUtil,arcgisonline/pages/utils/dom,arcgisonline/pages/dijit/UploadProgressBar,arcgisonline/sharing/util,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Item,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,dojo/promise/all,dojo/number"],
function(a,w,e){a.provide("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");a.require("dijit.form.SimpleTextarea");a.require("dijit.form.TextBox");a.require("dijit.form.CheckBox");a.require("dijit.form.Button");a.require("dijit.InlineEditBox");a.require("dijit.Dialog");a.require("dijit._Widget");a.require("dijit._Templated");a.require("arcgisonline.pages.pageUtil");a.require("arcgisonline.pages.utils.dom");a.require("arcgisonline.pages.dijit.UploadProgressBar");a.require("arcgisonline.sharing.util");
a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.geow.Content");a.require("arcgisonline.sharing.geow.Item");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.dialog.TagsDlg");a.require("dojo.promise.all");a.require("dojo.number");a.declare("arcgisonline.sharing.dijit.dialog.UpdateItemDlg",[w._Widget,w._Templated],{util:arcgisonline.sharing.util,community:arcgisonline.sharing.geow.Community,content:arcgisonline.sharing.geow.Content,
itemAPI:arcgisonline.sharing.geow.Item,pageUtil:arcgisonline.pages.pageUtil,domUtil:arcgisonline.pages.utils.dom,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_updateItemDialog" title\x3d"${i18n.updateItem}" dojoAttachEvent\x3d"hide:clear" execute\x3d"" class\x3d"update-item-dlg"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_errorDiv"\x3e\x3c/div\x3e\r\n    \x3cform dojoAttachPoint\x3d"_updateItemForm" enctype\x3d"multipart/form-data"\x3e\r\n      \x3cdiv dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemFolderInput" type\x3d"hidden" value\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"id" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemIdInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"name" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemNameInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"title" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTitleInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"tags" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTagsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"type" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTypeInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"typeKeywords" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemKeywordsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"description" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateDescriptionInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"snippet" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateSnippetInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"accessInformation" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateAccessInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"licenseInfo" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateLicenseInfoInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"extent" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateExtentInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"overwrite" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateOverwriteInput" type\x3d"hidden" value\x3d"true"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"async" dojotype\x3d"dijit.form.TextBox" type\x3d"hidden" dojoAttachPoint\x3d"_updateAsyncInput" value\x3d"true"\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv\x3e\x3clabel class\x3d"font-size--1" dojoAttachPoint\x3d"_replaceUpdateVerLabel"\x3e${i18n.replaceUpdatedVersionMsg}\x3c/label\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3clabel class\x3d"esriFloatLeading esriTrailingMargin2" style\x3d"margin-top:6px;" for\x3d"update-item-file"\x3e${i18n.itemLabel}\x3c/label\x3e\r\n        \x3cinput type\x3d"file" dojoAttachPoint\x3d"_updateItemFile" id\x3d"update-item-file" name\x3d"file" size\x3d"40" class\x3d"esriFileInput"\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"overwrite_section" class\x3d"hide" style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3cinput id\x3d"overwriteService" type\x3d"checkbox" name\x3d"overwriteService" dojotype\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_overwriteService"/\x3e\r\n        \x3clabel id\x3d"overwriteServiceLbl" for\x3d"overwriteService"\x3e${i18n.overwriteService} ${i18n.keepFieldsSame}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"update-item-keepdescription" style\x3d"width:100%;display:none;"\x3e\r\n        \x3cdiv style\x3d"padding-bottom:5px; padding-top:2px;"\x3e\r\n          \x3clabel\x3e${i18n.updateItemDescription}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"line-height:23px"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" checked\x3d"checked" dojoAttachPoint\x3d"_useDescKeepRadio" id\x3d"useDescription:keep"/\x3e\r\n          \x3clabel for\x3d"useDescription:keep"\x3e${i18n.keepExistingProperties}\x3c/label\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_useDescUpdateRadio" id\x3d"useDescription:update"/\x3e\r\n          \x3clabel for\x3d"useDescription:update"\x3e${i18n.useUploadedProperties}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"leader-half trailer-half flex"\x3e\r\n        \x3cdiv class\x3d"flex flex-1"\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_waitingSpan" class\x3d"hide flex-column-justify-center"\x3e${i18n.uploadingItem}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_uploadProgressBar"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancel" dojoAttachPoint\x3d"_cancelBtn" id\x3d"button_update-item-cancel" class\x3d"jevent cancel margin-right-half" type\x3d"cancel"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3cbutton id\x3d"button_update-item" type\x3d"button" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:uploadItem" class\x3d"primary" dojoAttachPoint\x3d"_updateItemBtn"\x3e${i18n.updateItem}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
item:null,admin:null,i18n:null,_replaceUpdateVerLabel:null,_updateItemDialog:null,_updateItemForm:null,_updateItemBtn:null,_cancelBtn:null,_waitingSpan:null,_useDescUpdateRadio:null,_useDescKeepRadio:null,_updateItemFile:null,_errorDiv:null,_updateItemFolderInput:null,_updateItemIdInput:null,_updateItemNameInput:null,_updateItemTitleInout:null,_updateItemTagsInput:null,_updateItemTypeInput:null,_updateItemKeywordsInput:null,_updateDescriptonInput:null,_updateSnippetInput:null,_updateAccessInput:null,
_updateLicenseInfoInput:null,_updateExtentInput:null,_updateOverwriteInput:null,_updateAsyncInput:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.UpdateItemDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=a.i18n.getLocalization("arcgisonline","arcgisonline").common;a.mixin(this.i18n,a.i18n.getLocalization("arcgisonline","arcgisonline").updateItemDlg);a.mixin(this.i18n,{updating:a.i18n.getLocalization("arcgisonline",
"arcgisonline").addItemFrm.updating})},postCreate:function(){},show:function(b,t){var p={Shapefile:1,"File Geodatabase":1,GeoJson:1,CSV:1,"Microsoft Excel":1},x=b&&b.publishParameters&&"address"===b.publishParameters.locationType;this.item=b;t&&null!==this.adminUser&&(this.admin=t);"Layer Package"==b.type&&a.style(a.byId("update-item-keepdescription"),"display","block");"Vector Tile Service"===b.type?(a.attr(this._replaceUpdateVerLabel,"innerHTML",this.i18n.overwriteStyle),this._updateItemDialog.set("title",
this.i18n.updateStyle),this._updateItemBtn.set("label",this.i18n.updateStyle)):(this.itemName=this.item.sourceData&&this.item.sourceData.name||this.item.name,a.attr(this._replaceUpdateVerLabel,"innerHTML",a.string.substitute(this.i18n.replaceUpdatedVersionMsg,[this.itemName])));b&&b.type in p&&b.relatedService?this._overwriteService.set("checked",!1):b&&b.sourceData?(this._updateItemDialog.set("title",this.i18n.updateFeatures),this._updateItemBtn.set("label",this.i18n.updateFeatures),p=a.string.substitute(x?
this.i18n.overwriteServiceWithCreditsMsg:this.i18n.overwriteServiceMsg,[b.title,b.sourceData.name]),a.attr(this._replaceUpdateVerLabel,"innerHTML",p)):this._overwriteService.set("checked",!1);b&&b.sourceData&&(esri.hide(this._overwriteService.domNode),a.attr("overwriteServiceLbl","innerHTML",this.i18n.keepFieldsSame),a.removeClass("overwrite_section","hide"));this._updateItemDialog.show();this._uploadProgressBar=new arcgisonline.pages.dijit.UploadProgressBar({},this._uploadProgressBar);this._uploadProgressBar.startup();
this._uploadProgressBar.hide()},clear:function(){this._updateItemFile.value="";this._useDescKeepRadio.set("checked",!0);this._useDescUpdateRadio.set("checked",!1);this._overwriteService.set("checked",!0)},_handleCancel:function(b){b.preventDefault();this._updateItemDialog.hide()},hide:function(){this._disable(!1);this._updateItemDialog.hide()},uploadItem:function(b){b.preventDefault();if(0===this._updateItemFile.value.length)return arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,
message:this.i18n.error.providePath}),!1;b=this._fetchItem(this.item).then(a.hitch(this,"loadFile"));if(this.item.sourceData||this.item.relatedService&&this._overwriteService.get("checked"))a.attr(this._waitingSpan,"innerHTML",this.i18n.updating),b=b.then(a.hitch(this,"_updateServiceData",this.item.sourceData||this.item)).then(a.hitch(this,"_resetServiceTitle",this.item));return b.then(a.hitch(this,function(t){t&&!t.success&&t.error&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:t.error.message||this.i18n.error.errorWhileUpdate});t&&t.serviceItemId?(this._disable(!1),this._updateItemDialog.hide(),window.location="item.html?id\x3d"+t.serviceItemId+(t.jobId?"\x26jobid\x3d"+t.jobId:"")):a.publish("itemData/update",[""]);return!0}),a.hitch(this,function(t){a.isObject(t)&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,message:t.message||this.i18n.error.errorWhileUpdate});this._disable(!1)}))},_updateServiceData:function(b){var t=
new a.Deferred;this._checkStatus(b,500,a.hitch(this,function(p){var x=esriGeowConfig.restBaseUrl+"content/users/"+p.owner+"/publish",y,J,G={itemid:p.id,filetype:{"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel"}[p.type.toLowerCase()],overwrite:!0,publishParameters:a.json.stringify({name:this.item.title?this.item.title.replace(/ /g,"_"):p.title.replace(/ /g,"_")})};a.attr(this._waitingSpan,"innerHTML",this.i18n.updating);a.promise.all([this._fetchPublishParameters(this.item),
this._fetchServiceInfo(this.item.relatedService||this.item)]).then(a.hitch(this,function(D){y=D[1];(J=D[0])&&"CSV"===p.type?(D=a.mixin(a.mixin({},y.layers&&y.layers[0]),{fields:J.layerInfo.fields}),G.publishParameters=a.mixin(J,{layerInfo:D,name:J.name||p.title.replace(/ /g,"_")})):J&&"Microsoft Excel"===p.type?(G.publishParameters=this._generateExcelOverwritePublishParameters(J,y),y=null):G.publishParameters={name:p.title?p.title.replace(/ /g,"_"):this.item.title.replace(/ /g,"_")};G.publishParameters=
y?a.json.stringify(a.mixin(G.publishParameters,y)):G.publishParameters;return this.util.request({url:x,content:G},{usePost:!0}).then(a.hitch(this,function(A){t.resolve(A&&A.services&&A.services[0]||{serviceItemId:p.id})}),a.hitch(this,function(A){t.reject(A)}))}))}));return t},_generateExcelOverwritePublishParameters:function(b,t){t.name=b.name;t.sourceSR=b.sourceSR;t.targetSR=b.targetSR;for(var p=0;p<t.tables.length;p++)"Review"!=t.tables[p].name&&(t.layers[t.layers.length]=t.tables[p]);for(p=0;p<
t.layers.length;p++)t.layers[p].excelSheetId=b.layers[p].excelSheetId,t.layers[p].locationType=b.layers[p].locationType,t.layers[p].latitudeFieldName=b.layers[p].latitudeFieldName,t.layers[p].longitudeFieldName=b.layers[p].longitudeFieldName,t.layers[p].geocodeServiceUrl=b.layers[p].geocodeServiceUrl,t.layers[p].sourceLocale=b.layers[p].sourceLocale,t.layers[p].sourceCountry=b.layers[p].sourceCountry,t.layers[p].standardizedFieldNames=b.layers[p].standardizedFieldNames,t.layers[p].addressFields=b.layers[p].addressFields;
return JSON.stringify(t)},_resetServiceTitle:function(b,t){var p=new a.Deferred,x=this.util.getUser(),y=b.title||"",J=b.folderId||b.ownerFolder;x=esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||x.username)+"/"+(J?J+"/":"")+"items/"+b.id+"/update";y=-1!==b.typeKeywords.indexOf("Involved Lookup")?{title:y,typeKeywords:b.typeKeywords.toString()+",showUnmatchedAddresses"}:{title:y};this.util.request({url:x,content:y},{usePost:!0}).then(a.hitch(this,function(){p.resolve(t)}),a.hitch(this,function(){p.resolve(t)}));
return p},_fetchServiceInfo:function(b){b=b.url;var t={addToken:(this.util.isHostedService(b)||this.util.isAgolService(b))&&!1!==esriGeowConfig.isMultiTenant},p=new a.Deferred,x;a.promise.all([this.util.request({url:b},t),this.util.request({url:b+"/layers"},t)]).then(a.hitch(this,function(y){var J={},G=y&&1<y.length&&y[1],D=G&&G.layers;G=G&&G.tables;D&&D.length&&(a.forEach(D,function(A){delete A.fields}),J.layers=D);G&&G.length&&(J.tables=G);x=a.mixin(y[0],J);p.resolve(x)}));return p},_fetchPublishParameters:function(b){var t=
esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/publishParameters.json";b.publishParameters?(t=new a.Deferred,t.resolve(b.publishParameters)):!b.sourceData||"CSV"!==b.sourceData.type&&"Microsoft Excel"!==b.sourceData.type?(t=new a.Deferred,t.resolve(!1)):t=this.util.request({url:t}).then(a.hitch(this,function(p){return p}));return t},_fetchItem:function(b){if(b.sourceData)var t=this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b.sourceData.id}).then(a.hitch(this,function(p){p.folderId=
p.ownerFolder;return p}));else t=new a.Deferred,t.resolve(b);return t},loadFile:function(b){var t=new a.Deferred,p=this._updateItemFile.value,x=p.lastIndexOf("\\"),y=b.type;-1<x&&(p=p.substring(x+1,p.length));p=p.replace(/ /g,"_");if("Vector Tile Service"!==b.type&&this.itemName!=p)return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:a.string.substitute(this.i18n.error.sameFileName,[this.itemName])}),this._updateItemFile.value=
"",t.reject(!0),t;if("Vector Tile Service"===b.type){x=/(?:\.([^.]+))?$/;var J=p.replace(/^.*(\\|\/|:)/,"");if("json"!==(p?x.exec(J)[1].toLowerCase():""))return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:this.i18n.error.invalidStyleFileExtension}),this._updateItemFile.value="",t.reject(!0),t}this._disable(!0);p=!0;"Layer Package"==y&&(p=a.byId("useDescription:keep").checked);this._updateItemNameInput.set("value",this.itemName);
this._updateItemTitleInput.set("value",b.title);this._updateItemTagsInput.set("value",b.tags);this._updateItemTypeInput.set("value",y);this._updateItemKeywordsInput.set("value",b.typeKeywords);this._updateAccessInput.set("value",b.accessInformation);this._updateLicenseInfoInput.set("value",b.licenseInfo);this._updateItemFolderInput.set("value",b.folderId);p?(this._updateDescriptionInput.set("value",b.description),this._updateSnippetInput.set("value",b.snippet),this._updateExtentInput.set("value",
b.extent)):(this._updateDescriptionInput.set("value",""),this._updateSnippetInput.set("value",""),this._updateExtentInput.set("value",""));var G=function(D,A){if(!D.success||"completed"!==D.status&&D.status){var F=this.i18n.error.errorWhileUpdate;D&&D.error&&D.error.message&&(F=D.error.message);-1<F.indexOf("The request size is greater than the max allowed of 1024MB")&&(F=this.i18n.error.exceedFileSizeLimit);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:F});t.reject(!0)}else t.resolve(!0)};y=function(D){this._disable(!1);t.reject(D)};b&&"Vector Tile Service"===b.type?this._updateItemResource(b,this._updateItemForm).then(a.hitch(this,G),a.hitch(this,y)):(this._uploadProgressBar.reset(),this._uploadProgressBar.show(),this.itemAPI.update.call(this.itemAPI,b,this._updateItemForm,this._updateItemFile.files[0]).then(function(D){this._uploadProgressBar.hide();G(D)}.bind(this),y.bind(this)));return t},_updateItemResource:function(b,t){var p=this.util.getUser(),
x=b.folderId||b.ownerFolder;p={url:esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||p.username)+"/"+(x?x+"/":"")+"/items/"+b.id+"/updateResources",form:t,content:{resourcesPrefix:"styles",filename:"root.json"}};a.query("input",t).forEach(a.hitch(this,function(y){y&&"file"!==y.name&&a.attr(y,"name","")}));return this.util.request(p,{usePost:!0}).then(a.hitch(this,function(y){return y}),a.hitch(this,function(y){throw{message:this.i18n.error.invalidStyleFile};}))},_checkStatus:function(b,t,p){this.util.request({url:esriGeowConfig.restBaseUrl+
"content/users/"+b.owner+(b.ownerFolder&&"/"!==b.ownerFolder?"/"+b.ownerFolder:"")+"/items/"+b.id+"/status"}).then(a.hitch(this,function(x){x=x||{status:"failed"};"completed"===x.status?p(b):(t=(t||500)+250,setTimeout(a.hitch(this,function(){this._checkStatus(b,t,p)}),t))}))},_disable:function(b){this._updateItemBtn.set("disabled",b);this._cancelBtn.set("disabled",b);this.domUtil.showHide(this._waitingSpan,b);a.style(this._waitingSpan,"display",b?"inline-block":"none")}})})},"arcgisonline/pages/dijit/UploadProgressBar":function(){define("require exports tslib dojo/topic dojo/text!./UploadProgressBar/UploadProgressBar.html dojo/i18n!../../nls/arcgisonline dijit/_TemplatedMixin dijit/_WidgetBase ../utils/dom ../utils/culture ../../tsutils/declareDecorator".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);D=e.__importDefault(D);return function(){function A(F,g){this.templateString=t["default"];this.i18n=p["default"]}A.prototype.startup=function(){this.inherited(arguments);this.own(b["default"].subscribe("item/upload-progress-update",this._onProgressUpdate.bind(this)))};A.prototype.hide=function(){J["default"].hideNode(this.domNode)};
A.prototype.show=function(){J["default"].showNode(this.domNode)};A.prototype.reset=function(){this._uploadPercentLabel.textContent=this._uploadProgressFill.style.width="0%";this._uploadPercentLabel.innerHTML=G["default"].getPercentString(0);this._uploadProgressFill.style.width="0%"};A.prototype._onProgressUpdate=function(F){this._uploadProgressFill.classList[100===F?"add":"remove"]("upload-progress-bar__fill--full");this._uploadPercentLabel.innerHTML=G["default"].getPercentString(F/100);this._uploadProgressFill.style.width=
F+"%"};return A=e.__decorate([D["default"](y["default"],x["default"])],A)}()})},"arcgisonline/sharing/geow/Item":function(){define("require exports tslib ../../esriGeowConfig ../util dojo/Deferred dojo/dom-form dojo/topic dojo/promise/all esri/request".split(" "),function(a,w,e,b,t,p,x,y,J,G){b=e.__importDefault(b);t=e.__importDefault(t);p=e.__importDefault(p);x=e.__importDefault(x);y=e.__importDefault(y);J=e.__importDefault(J);G=e.__importDefault(G);return function(){function D(){}D.addItem=function(A,
F,g){return D._action(A,F,g,"addItem")};D.update=function(A,F,g){return D._action(A,F,g,"update")};D._action=function(A,F,g,v){if(t["default"].getUser())return v=D._getActionItemUrl(A,v),A=5242880<g.size?D._multiPartAction(v,F,g,A):D._postForm(v,F)};D._multiPartAction=function(A,F,g,v){var m=new p["default"],h=function(k){m.reject(k)},f=function(k){k.isMultipart=!0;m.resolve(k)},c=function(k){D._commitItem(v,F).then(f,h)},l=function(k){D._cancelItem(v);"Request canceled"!==k.message&&h.call(D,k)};
D._startMultipartRequest(A,v.fileName?v.fileName:g.name).then(function(k){k.success?(v.id=k.id,D._addItemParts(v,g).then(c,l)):h.call(D,k.error)},h);return m};D._postForm=function(A,F){return t["default"].request({url:A,form:F,timeout:0},{usePost:!0})};D._startMultipartRequest=function(A,F){return t["default"].request({url:A,content:{multipart:!0,filename:F,async:!0}},{usePost:!0})};D.generatePart=function(A,F){var g,v,m,h,f,c,l,k,z;return e.__generator(this,function(u){switch(u.label){case 0:g=A.name,
v=A.size,m=5242880,h=Math.ceil(v/m),f=0,1E4<h&&(m=Math.ceil(v/1E4),h=Math.ceil(v/m)),u.label=1;case 1:if(!(f<h))return[3,3];c=new FormData;l=f*m;k=A.slice(l,l+m);f++;z={partNum:f,size:k.size};c.append("partNum",String(z.partNum));c.append("streamdata","true");c.append("f","json");c.append("token",F);c.append("file",k,g);return[4,{partData:z,formData:c}];case 2:return u.sent(),[3,1];case 3:return[2]}})};D._addItemParts=function(A,F){var g=this,v=F.size,m=new p["default"],h={};this.pendingRequests=
[];var f=3;y["default"].subscribe("cancel-item-upload",function(){g.pendingRequests.forEach(function(z){z&&!z.isFulfilled()&&z.cancel()})});var c=D.generatePart(F,t["default"].getToken()),l=!0,k=function(){if(l){var z=[];D.uploadError=!1;for(var u=0;u<f;u++){var n=c.next(),B=n.value;if(n.done){l=!1;break}z.push(B)}J["default"](z.map(function(H){var Q=new p["default"];return D._addPartWithRetries(A,H.partData,H.formData,1,v,h,Q)})).then(function(){l||m.resolve();f=D.uploadError?Math.ceil(f/2):Math.min(++f,
10);k()},function(H){l=!1;m.reject(H)})}};k();return m};D._addPartWithRetries=function(A,F,g,v,m,h,f){var c=D._getActionItemUrl(A,"addPart");c=G["default"]({url:c,form:g,timeout:0},{returnProgress:!0,disableIdentityLookup:!0}).then(function(l){l.success?f.resolve(l):f.reject(l.error)},function(l){v++;D.uploadError=!0;"Request canceled"!==l.message&&7>=v?D._addPartWithRetries(A,F,g,v,m,h,f):f.reject(l)},function(l){l.loaded&&"upload"===l.transferType&&(h[F.partNum.toString()]=l.loaded,l=Object.keys(h).reduce(function(k,
z){return k+h[z]},0),y["default"].publish("item/upload-progress-update",Math.floor(l/m*100)))});D.pendingRequests.push(c);return f};D._commitItem=function(A,F){var g=D._getActionItemUrl(A,"commit");var v=F instanceof FormData?{title:A.fileName,type:A.fileType}:e.__assign({},x["default"].toObject(F));return t["default"].request({url:g,content:v},{usePost:!0})};D._cancelItem=function(A){A=D._getActionItemUrl(A,"cancel");return t["default"].request({url:A},{usePost:!0})};D._getUserUrl=function(A){var F=
t["default"].getUser();F=F.username||F.email;return b["default"].restBaseUrl+"content/users/"+(A.owner||F)};D._getActionItemUrl=function(A,F){var g=this._getUserUrl(A);A.folderId&&(g=g+"/"+A.folderId);return g="addItem"===F?g+"/addItem":g+"/items/"+A.id+"/"+F};D.uploadError=!1;return D}()})},"arcgisonline/sharing/dijit/_GalleryFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{organization:{all:{},maps:{},layers:{},scenes:{},applications:{},tools:{},files:{}},maps:{all:{},
imagery:{tags:["imagery"]},basemaps:{tags:["basemap"]},historical:{tags:["historical"]},demographics:{tags:"demographics"},landscape:{tags:"landscape"},oceans:{tags:"oceans"},earth:{tags:["earth observations"]},urban:{tags:["urban"]},transportation:{tags:["transportation"]},boundariesplaces:{tags:["boundaries"]},storymaps:{tags:["story maps","story map"]}},apps:{configurable:{typekeywords:["Configurable"]},readytouse:{typekeywords:["Ready To Use"]},appbuilder:{typekeywords:["Web AppBuilder for ArcGIS"]}}},
imagery:{basemapimagery:{parent:"imagery"},multiimagery:{parent:"imagery"},temporalimagery:{parent:"imagery"},eventimagery:{parent:"imagery"}},basemaps:{esribasemaps:{parent:"basemaps"},partnerbasemaps:{parent:"basemaps"},userbasemaps:{parent:"basemaps"}},demographics:{income:{parent:"demographics"},spending:{parent:"demographics"},population:{parent:"demographics"},business:{parent:"demographics"},atrisk:{parent:"demographics"}},landscape:{agriculture:{parent:"landscape"},climate:{parent:"landscape"},
ecology:{parent:"landscape"},biology:{parent:"landscape"},disturbance:{parent:"landscape"},elevation:{parent:"landscape"},landcover:{parent:"landscape"},hazards:{parent:"landscape"},soils:{parent:"landscape"},subsurface:{parent:"landscape"},water:{parent:"landscape"}},urban:{threed:{parent:"urban"},movement:{parent:"urban"},parcels:{parent:"urban"},people:{parent:"urban"},planning:{parent:"urban"},publicFilter:{parent:"urban"},work:{parent:"urban"}},transportation:{accessibility:{parent:"transportation"},
infrastructure:{parent:"transportation"},logistics:{parent:"transportation"},traffic:{parent:"transportation"},transit:{parent:"transportation"}},boundariesplaces:{boundaries:{parent:"boundariesplaces"},places:{parent:"boundariesplaces"}},maps:{webmaps:{parent:"maps"},mapfiles:{parent:"maps"}},layers:{weblayers:{parent:"layers"},layerfiles:{parent:"layers"}},applications:{web:{parent:"applications"},mobile:{parent:"applications"},desktop:{parent:"applications"}},weblayers:{features:{parent:"weblayers"},
tiles:{parent:"weblayers"},mapimage:{parent:"weblayers"},imagery:{parent:"weblayers"},scenelayers:{parent:"weblayers"},tables:{parent:"weblayers"}},readytouse:{web:{parent:"readytouse"},ios:{parent:"readytouse"},android:{parent:"readytouse"},windows:{parent:"readytouse"},desktop:{parent:"readytouse"}},configurable:{narrate:{parent:"configurable"},collect:{parent:"configurable"},compare:{parent:"configurable"},"3dscene":{parent:"configurable"},analyze:{parent:"configurable"},present:{parent:"configurable"},
social:{parent:"configurable"},local:{parent:"configurable"},route:{parent:"configurable"},showcase:{parent:"configurable"}},files:{document:{parent:"files"},image:{parent:"files"},pdf:{parent:"files"}},tools:{locators:{parent:"tools"},geodatabase:{parent:"tools"},geometric:{parent:"tools"},geoprocessing:{parent:"tools"},network:{parent:"tools"}},"imagery-root":{tags:["imagery"]},"imagery-basemapimagery":{tags:["baseimagery"]},"imagery-multiimagery":{tags:["multispectral"]},"imagery-temporalimagery":{tags:["temporal"]},
"imagery-eventimagery":{tags:["event_imagery"]},"basemaps-root":{tags:["basemap"]},"basemaps-esribasemaps":{tags:["esri_basemap"]},"basemaps-partnerbasemaps":{tags:["partner_basemap"]},"basemaps-userbasemaps":{tags:["user_basemap"]},"historical-root":{tags:["historical"]},"demographics-root":{tags:["demographics"]},"demographics-income":{tags:["income"]},"demographics-spending":{tags:["spending","behaviors"]},"demographics-population":{tags:["population","housing"]},"demographics-segmentation":{tags:["segmentation"]},
"demographics-business":{tags:["business","jobs"]},"demographics-atrisk":{tags:["at risk","poverty"]},"landscape-root":{tags:["landscape"]},"landscape-agriculture":{tags:["agriculture"]},"landscape-climate":{tags:["climate","weather"]},"landscape-ecology":{tags:["ecology"]},"landscape-biology":{tags:["species"]},"landscape-disturbance":{tags:["disturbance"]},"landscape-elevation":{tags:["elevation"]},"landscape-landcover":{tags:["landcover"]},"landscape-hazards":{tags:["hazards"]},"landscape-soils":{tags:["soils",
"geology"]},"landscape-subsurface":{tags:["subsurface"]},"landscape-water":{tags:["water"]},"oceans-root":{tags:["oceans"]},"earth-root":{tags:["earth observations"]},"urban-root":{tags:["urban"]},"urban-threed":{tags:["3D"]},"urban-movement":{tags:["movement"]},"urban-parcels":{tags:["parcels"]},"urban-people":{tags:["people"]},"urban-planning":{tags:["planning"]},"urban-publicFilter":{tags:["public"]},"urban-work":{tags:["work"]},"transportation-root":{tags:["transportation"]},"transportation-accessibility":{tags:["accessibility"]},
"transportation-infrastructure":{tags:["infrastructure"]},"transportation-logistics":{tags:["logistics"]},"transportation-traffic":{tags:["traffic"]},"transportation-transit":{tags:["transit"]},"boundariesplaces-root":{tags:["boundaries"]},"boundariesplaces-boundaries":{tags:["boundaries"]},"boundariesplaces-places":{tags:["places"]},"storymaps-root":{tags:["story maps","story map"]},"scenes-root":{tags:["scenes"]},"readytouse-root":{typekeywords:["Ready To Use"]},"configurable-root":{typekeywords:["Configurable"]},
"appbuilder-root":{typekeywords:["Web AppBuilder for ArcGIS"]},"readytouse-web":{typekeywords:["Web Mapping Application"]},"readytouse-ios":{typekeywords:["ArcGIS for iPhone"]},"readytouse-android":{typekeywords:["ArcGIS for Android"]},"readytouse-windows":{typekeywords:["ArcGIS for Windows Phone"]},"readytouse-desktop":{typekeywords:["Application","Desktop Application"]},"configurable-narrate":{typekeywords:["story"]},"configurable-collect":{typekeywords:["collect"]},"configurable-compare":{typekeywords:["compare"]},
"configurable-3dscene":{typekeywords:["3Dscene"]},"configurable-analyze":{typekeywords:["summarize"]},"configurable-present":{typekeywords:["gallery"]},"configurable-social":{typekeywords:["social"]},"configurable-local":{typekeywords:["local"]},"configurable-route":{typekeywords:["route"]},"configurable-showcase":{typekeywords:["showcase"]},mappings:{"demographics-behaviors":{mappedCategory:"demographics-spending"},"demographics-segmentation":{mappedCategory:"demographics"},"landscape-oceans":{mappedCategory:"oceans"}}}})},
"arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg":function(){define("dojo/_base/declare dojo/on dojo/dom-attr dojo/query dojo/dom dojo/dom-style dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dom-construct dojo/string dojo/_base/window dojo/promise/all dojo/when dojo/Deferred dojo/_base/array dojo/cookie dojo/dom-class dojo/json dijit/registry dijit/form/Select dijit/form/CheckBox ./ConfirmDialog dijit/focus dojo/_base/event dojo/keys ./_CreateItemUtilMixin dojo/topic esri/Evented esri/arcgis/Portal ../../geow/Account ../../geow/Content ../../util dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(a,w,e,b,t,p,x,y,J,G,D,A,F,g,v,m,h,f,c,l,k,z,u,n,B,H,Q,O,P,T,V,X,I,U,E){return a("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg",[y,J,G,T],{baseClass:"esriAdvancedOfflineOptionsDlg",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"main"\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.editableLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_editMessage"\x3e${i18n.advancedOfflineOptionsDlg.editMessage}\x3c/p\x3e\x3cdiv class\x3d"edit"\x3e\x3clabel class\x3d"esriLeadingMargin1 trailer-0 editFeatures"\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"editFeatures" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editFeatures}\x26nbsp;\x3c/label\x3e\x3cbr /\x3e\x3clabel class\x3d"esriLeadingMargin26 editAttachments padding-left-2"\x3e\x3cinput class\x3d"editAttachments" data-dojo-attach-point\x3d"editAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true, disabled:false\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.readOnlyLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_readOnlyMessage"\x3e${i18n.advancedOfflineOptionsDlg.readOnlyMessage}\x3c/p\x3e\x3cdiv class\x3d"readonly"\x3e\x3clabel class\x3d"esriLeadingMargin1 "\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"downloadAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
onDone:function(){},postMixInProperties:function(){this.inherited(arguments);this.i18n=x.mixin({},E);this._portalUser=(this._portal=esriGeowConfig.portal||esriGeowConfig.self)&&(this._portal.user||this._portal.getPortalUser())},postCreate:function(){this.inherited(arguments);X.getSelf(x.hitch(this,function(L){this._loadConnections();this.set("item",this.data)}))},destroy:function(){this._errorDlg&&(this._errorDlg.destroyRecursive(),this._errorDlg=null);this.inherited(arguments);this._portalUser=this._portal=
null},showModal:function(){var L=new m,da=new n({title:E.advancedOfflineOptionsDlg.title,buttonOk:E.common.ok,buttonCancel:E.common.cancel,style:{width:"475px",height:"auto"},className:"esriAdvancedOptions"}),R=b(".dijitDialogTitle",da.domNode).shift(),M,r=this._portal.helpMap.m["120000899"];r=D.create("a",{className:"esriHelpIcon",title:E.common.help,href:this._portal.helpBase+(r?r:""),target:"_blank"});D.place(r,R,"last");da.setContent(this.domNode);da.show().then(x.hitch(this,function(N){"onOk"===
N&&this._supportsAdvancedSyncOptions&&(this.set("disabled",!0,E.advancedOfflineOptionsDlg.pleaseWait),M=this.get("offlineProperties"),this._webMap=x.mixin(this._webMap,{applicationProperties:x.mixin(this._webMap.applicationProperties||{},M)}));da.hide().then(x.hitch(this,function(){L.resolve(this._webMap)}))}));return L},_loadConnections:function(){this.own(w(this.editFeatures,"click",x.hitch(this,function(){this.editFeatures.get("checked")?(b(".editAttachments").removeClass("disabled"),this.editAttachments.set("disabled",
!1)):(b(".editAttachments").addClass("disabled"),this.editAttachments.set("checked",!1),this.editAttachments.set("disabled",!0))})))},_setItemAttr:function(L){this._item=L.portal?L:new V.PortalItem(x.mixin({},L,{portal:this._portal}));L=this._item.itemData?x.clone(this._item.itemData):{};this._item.updatedOffline&&(L.applicationProperties||(L.applicationProperties={}),L.applicationProperties.offline=x.clone(this._item.updatedOffline));this.set("webmap",L)},_setWebmapAttr:function(L){this._webMap=
L||{};this._mapSupportsAdvancedSyncOptions(L).then(x.hitch(this,function(da){(this._supportsAdvancedSyncOptions=da)?this.set("offlineProperties",this._webMap.applicationProperties&&this._webMap.applicationProperties.offline||{}):(b(".dijitCheckBox",this.domNode).map(k.byNode).forEach(function(R){R.set("disabled",!0)}),b("label").addClass("disabled"))}))},_setOfflinePropertiesAttr:function(L){var da=L||{},R=da.editableLayers,M=da.readonlyLayers;da=!R||R.download&&("featuresAndAttachments"===R.download||
"features"===R.download);R=!R||R.sync&&"syncFeaturesAndAttachments"===R.sync;M=!M||M.downloadAttachments;this._offlineProperties=L||{};this.editFeatures.set("checked",da);this.editAttachments.set("disabled",!da);b(".editAttachments")[da?"removeClass":"addClass"]("disabled");this.editAttachments.set("checked",R);this.downloadAttachments.set("checked",M)},_getOfflinePropertiesAttr:function(){var L=this._offlineProperties||{},da=this.editFeatures.get("checked"),R=this.editAttachments.get("checked"),
M=this.downloadAttachments.get("checked");da||R?da&&R?L=x.mixin(L,{editableLayers:{download:"featuresAndAttachments",sync:"syncFeaturesAndAttachments"}}):da&&!R&&(L=x.mixin(L,{editableLayers:{download:"features",sync:"syncFeaturesUploadAttachments"}})):L=x.mixin(L,{editableLayers:{download:"none",sync:"uploadFeaturesAndAttachments"}});L=x.mixin(L,{readonlyLayers:{downloadAttachments:M}});return x.mixin({},{offline:L})},_setDisabledAttr:function(L,da){this.set("readOnly",L,da)},_setReadOnlyAttr:function(L,
da,R){b(".dijit",this.domNode).map(k.byNode).forEach(function(M){M.set("disabled",L)});b("a",this.domNode)[L?"addClass":"removeClass"]("disabledLink");b("label, p, span, h2, .hint",this.domNode)[L?"addClass":"removeClass"]("disabled");L&&da&&P.publish("/dlg/busyMessage",da);P.publish("/esri/disable",L,da)},_mapSupportsAdvancedSyncOptions:function(L){var da=new m,R=L.operationalLayers||[],M={},r=[];if(L&&L.applicationProperties&&L.applicationProperties.offline)da.resolve(!0);else{h.forEach(R,function(W){N=
W.url&&W.url.replace(/(\/\d+)+$/g,"");M[N]=N});for(var N in M)M.hasOwnProperty(N)&&M[N]&&r.push(U.request({url:M[N]},{addToken:!1}).then(function(W){return W&&W.syncCapabilities&&W.syncCapabilities.supportsAttachmentsSyncDirection},function(W){return!1}));g(r).then(function(W){da.resolve(h.every(W,"return item;"))})}return da},_showError:function(L){L=x.mixin(x.mixin({},E.publishWizard.errors.error),L);this._errorDlg=this._errorDlg||new n({showCancel:!1,style:{width:"400px",height:"auto"}});this._errorDlg.show(L).then(x.hitch(this,
function(){this.set("disabled",!1);this._errorDlg.hide()}));return!1}})})},"arcgisonline/sharing/dijit/dialog/getWFSConfig":function(){define(["dojo/_base/array","esri/renderers/SimpleRenderer","esri/symbols/jsonUtils","arcgisonline/map/popup/getDefaultPopupInfo"],function(a,w,e,b){function t(J){var G,D=J.fields,A=J.selectedLayer||{},F;D&&D.length&&(F=a.filter(D,function(g){return"esriFieldTypeGeometry"!==g.type}))&&F.length&&(G=b({name:A.title,fields:D},!1,J));return G}var p={type:"esriSMS",style:"esriSMSCircle",
color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},x={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},y={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};return function(J){var G=J.geometryType,D=J.toJson(),A=D.url,F=D.mode;D={version:D.version,name:D.name,wfsNamespace:J.layerNamespace,featureUrl:J.getFeatureUrl,supportedSpatialReferences:J.spatialReferences};var g;"esriGeometryPoint"===
G?g=new w(e.fromJson(p)):"esriGeometryPolyline"===G?g=new w(e.fromJson(x)):"esriGeometryPolygon"===G&&(g=new w(e.fromJson(y)));g=g.toJson();return{url:A,mode:F,wfsInfo:D,layerDefinition:{geometryType:G,drawingInfo:{renderer:g},spatialReference:{wkid:4326},fields:J.fields},popupInfo:t(J)}}})},"arcgisonline/map/popup/getDefaultPopupInfo":function(){define(["./isImageServiceLayer","./isTiledImageServiceLayer","dojo/_base/array","dojo/_base/lang"],function(a,w,e,b){return function(t,p,x){p=t.displayField;
p=t.name+(p&&p.length?": {"+p+"}":"");var y=t.fields,J=!1,G=!1,D=!1;if(a(x)||w(x))y=x.getCustomRasterFields({rasterAttributeTableFieldPrefix:"Raster."}),D=0>e.indexOf(["F32","F64"],x.pixelType),x&&x.capabilities&&(G=(J=x.capabilities&&-1<x.capabilities.toLowerCase().indexOf("catalog")||x.fields&&0<x.fields.length)&&("esriImageServiceDataTypeVector-UV"===x.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===x.serviceDataType));var A={esriFieldTypeDouble:1,esriFieldTypeSingle:1},F={esriFieldTypeInteger:1,
esriFieldTypeSmallInteger:1},g={esriFieldTypeDate:1},v=",";t.editFieldsInfo&&(t.editFieldsInfo.creatorField&&(v+=t.editFieldsInfo.creatorField+","),t.editFieldsInfo.creationDateField&&(v+=t.editFieldsInfo.creationDateField+","),t.editFieldsInfo.editorField&&(v+=t.editFieldsInfo.editorField+","),t.editFieldsInfo.editDateField&&(v+=t.editFieldsInfo.editDateField+","),v=v.toLowerCase());y=e.map(y,b.hitch(this,function(m,h){var f="esriFieldTypeOID"!==m.type&&"esriFieldTypeGlobalID"!==m.type&&"esriFieldTypeGeometry"!==
m.type,c=null,l=m.editable&&"esriFieldTypeOID"!==m.type&&"esriFieldTypeGlobalID"!==m.type;if(f){var k=m.name.toLowerCase(),z=v+"stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";J&&(z+="raster.itempixelvalue,",G&&(z+="raster.magnitude,raster.direction,"));if(-1<z.indexOf(","+k+",")||-1<k.indexOf("shape")||-1<k.indexOf("perimeter")||-1<k.indexOf("objectid")||-1<k.indexOf("raster.servicepixelvalue.")||k.indexOf("_i")==k.length-2)f=!1;m.type in F?c={places:0,digitSeparator:!0}:
m.type in A?c={places:D&&(-1<k.indexOf("raster.servicepixelvalue")||-1<k.indexOf("raster.itempixelvalue"))?0:2,digitSeparator:!0}:m.type in g&&(10<=t.currentVersion||x&&10<=x.version)&&(c={dateFormat:"longMonthDayYear"})}l=l?-1===v.indexOf(","+m.name.toLowerCase()+","):l;return b.mixin({},{fieldName:m.name,label:m.alias,isEditable:l,tooltip:"",visible:f,format:c,stringFieldOption:"textbox"})}));p={title:p,fieldInfos:y,description:null,showAttachments:!0,mediaInfos:[]};a(x)?(p.layerOptions={},p.layerOptions.showNoDataRecords=
!0,p.layerOptions.returnTopmostRaster=!0):w(x)&&(p.layerOptions={},p.layerOptions.showNoDataRecords=!0);return p}})},"arcgisonline/map/popup/isImageServiceLayer":function(){define(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"],function(a,w){return function(e){return e instanceof esri.layers.ArcGISImageServiceLayer||e instanceof esri.layers.ArcGISImageServiceVectorLayer}})},"arcgisonline/map/popup/isTiledImageServiceLayer":function(){define(["esri/layers/RasterXLayer"],
function(a){return function(w){return w instanceof esri.layers.RasterXLayer}})},"arcgisonline/sharing/dijit/dialog/getWMTSConfig":function(){define("dojo/Deferred dojo/json dojo/_base/array dojo/_base/lang esri/renderers/SimpleRenderer esri/symbols/jsonUtils esri/SpatialReference esri/geometry/Extent arcgisonline/map/core/sameSpatialReference arcgisonline/map/core/projectExtent".split(" "),function(a,w,e,b,t,p,x,y,J,G){function D(F){var g=new a;A(F.selectedLayer.gcsExtent,F.selectedTileInfo.fullExtent).then(function(v){g.resolve(v&&
v.toJson())});return g}function A(F,g){var v=new a,m=g.spatialReference||new x({wkid:4326});handler=b.hitch(this,function(h){v.resolve(h&&h.length&&h[0]&&h[0].type&&"extent"===h[0].type?h[0]:null)});G(F,m,handler,handler);return v}return function(F){var g=new a,v=F.selectedLayer||{},m=F.selectedTileInfo||{},h;D(F).then(b.hitch(this,function(f){var c=F.selectedLayer;var l=F.selectedTileInfo,k=-1<dojo.indexOf(c.formats,"image/png")?"image/png":c.formats[0];F.resourceUrls=c.resourceUrls;c=F.getTileUrlTemplate({identifier:c.identifier,
tileMatrixSet:l.tileMatrixSet,format:k});(l=F.copyright)&&"none"!==l.toLowerCase()?180<l.length&&(l=l.substring(0,180)+".."):l="";k=f||F.selectedTileInfo.fullExtent;var z=F.selectedTileInfo.tileInfo||{};if(96!==z.dpi){for(var u=0;u<z.lods.length;u++){var n=z.lods[u];n.scale=96*n.scale/z.dpi}z.dpi=96}z=z.toJson();h={templateUrl:c,copyright:l,fullExtent:k,tileInfo:z,wmtsInfo:{url:F.wmtsUrl,layerIdentifier:v.identifier,tileMatrixSet:m.tileMatrixSet}};g.resolve({wmtsConfig:h,fullExtent:f})}));return g}})},
"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/templates/OrganizationSetup.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv  class\x3d"esriFloatLeading" style\x3d"width:780px; clear:both; padding-left:10px;"\x3e${i18n.thankYou}\x3c/div\x3e\r\n\r\n  \x3cdiv style\x3d"width:780px; clear:both; margin-top:2em; padding-left:10px;" class\x3d"esriFloatLeading"\x3e\r\n\r\n    \x3ctable\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgName}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgNameImg" src\x3d"" alt\x3d"${i18n.orgName}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.orgNameDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_nameTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgAbbr}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgAbbrImg" src\x3d"" alt\x3d"${i18n.orgAbbr}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.orgAbbrDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3cinput class\x3d"orgTextBox" id\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3clabel for\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyStatusLabel" style\x3d"vertical-align:middle; width:125px;"\x3e\x3c/label\x3e\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            ${i18n.sampleOrgUrl}\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_sampleUrlTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.languageSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_languageImg" src\x3d"" alt\x3d"${i18n.languageSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.languageDesc} ${i18n.browserDefaultAGOL}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e${i18n.languageLabel} \x3cselect class\x3d"orgComboBox" data-dojo-attach-point\x3d"_languageSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\x3c/label\x3e\r\n\r\n            \x3cdiv class\x3d"hide" data-dojo-attach-point\x3d"_languageFormatContainer"\x3e\r\n              \x3cbr\x3e\r\n              \x3clabel\x3e\r\n                \x3cstrong\x3e${i18n.numDateFormat}\x3c/strong\x3e \x3cspan id\x3d"languageFormatTooltip"\x3e\x3ca data-dojo-attach-point\x3d"_languageFormatHelpLink" href\x3d"" target\x3d"_blank"\x3e\x3cimg class\x3d"help-icon" data-dojo-attach-point\x3d"_languageFormatImg" src\x3d"" alt\x3d"${i18n.learnNumDateFormat}"\x3e\x3c/a\x3e\x3c/span\x3e\r\n                \x3cbr\x3e\r\n                \x3cselect class\x3d"orgComboBox leader-half" data-dojo-attach-point\x3d"_languageFormatSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\',required:false"\x3e\x3c/select\x3e\r\n              \x3c/label\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.regionSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_regionImg" src\x3d"" alt\x3d"${i18n.regionSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.regionDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel for\x3d"regionSelect"\x3e${i18n.regionLabel}\x3c/label\x3e \x3cselect id\x3d"regionSelect" name\x3d"regionSelect" class\x3d"orgComboBox" data-dojo-attach-point\x3d"_regionSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.security}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_securityImg" src\x3d"" alt\x3d"${i18n.security}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            \x3cinput id\x3d"sslCheckBox" name\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkBox"\x3e\r\n            \x3clabel for\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBoxLabel"\x3e\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.link}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_linkImg" src\x3d"" alt\x3d"${i18n.link}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.linkDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop" style\x3d"width:15em;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"_linkCheckBox" id\x3d"linkCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"_linkTooltip" id\x3d"linkTooltip" for\x3d"linkCheckBox"\x3e\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd class\x3d"valignTop"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_link" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" type\x3d"text" style\x3d"width:25em;"\x3e\x3c/div\x3e\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.usageTrackingSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_usageTrackingImg" src\x3d"" alt\x3d"${i18n.usageTrackingSetting}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.usageTrackingDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop white-space-no-wrap" style\x3d"width:15em;"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput data-dojo-attach-point\x3d"_usageTrackingCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                        ${i18n.allowArcgisOnlineToCollectInfo}\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_saveBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite blue" data-dojo-props\x3d"iconClass:\'esriSaveIcon\'"\x3e${i18n.saveContinue}\x3c/button\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_signOutBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriOpenIcon\'"\x3e${i18n.signOut}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/templates/SaveItem.html":'\x3cdiv class\x3d"${baseClass}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.titleLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTitle"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextTitle}" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half clearfix"\x3e\r\n    ${i18n.tagsLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTagsContainer"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n  \x3cdiv class\x3d"categories-container"\x3e\r\n    \x3clabel class\x3d"calcite-web-label trailer-0 clearfix categories-container"\r\n      data-dojo-attach-point\x3d"saveItemCategoriesContainer"\r\n      for\x3d"saveItemCategoryPicker"\x3e\r\n      ${i18n.categoriesLabel}\r\n    \x3c/label\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemCategories" id\x3d"saveItemCategoryPicker"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.summaryLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemSummary"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextSummary}" maxlength\x3d"250" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-select" for\x3d"itemFolderComboBox"\x3e\r\n    ${i18n.saveInFolderLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemFolder"\r\n         data-dojo-type\x3d"arcgisonline/sharing/dijit/ComboBox"\r\n         id\x3d"itemFolderComboBox"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ExportDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"exportDialog" id\x3d"export-dialog" title\x3d"${i18n.exportDialogTitle}" execute\x3d""\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemForm"\x3e\x3c/div\x3e\r\n    \x3cfieldset data-dojo-attach-point\x3d"featureCollectionDiv" class\x3d"featureCollectionOnly hide"\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"generalizeChk" name\x3d"generalize"\x3e${i18n.generalize}\x3c/label\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" name\x3d"generalize" checked\x3e${i18n.keepOrig}\x3c/label\x3e\r\n    \x3c/fieldset\x3e\r\n\r\n    \x3cp data-dojo-attach-point\x3d"_message" class\x3d"break_word"\x3e\x3c/p\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"exportingLabel" style\x3d"visibility:hidden;"\x3e${i18n.exportingLabel}\x3c/span\x3e\r\n      \x3cbutton class\x3d"btn btn-clear" type\x3d"button" data-dojo-attach-point\x3d"cancelBtn"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton class\x3d"btn" type\x3d"button" data-dojo-attach-point\x3d"exportBtn"\x3e${i18n.exportLabel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlg.html":'\x3cdiv\x3e\r\n  \t\x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} invitations-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.invitationsDlgTitle}"\x3e\r\n      \x3cdiv class\x3d"trailer-half"\x3e${i18n.invitationMsg}\x3c/div\x3e\r\n      \x3cdiv class\x3d"${baseClass} invitations-container padding-leader-quarter"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_invitationsGridContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"clearfix"\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem; padding-bottom:5px;"\x3e\r\n          \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button" tabIndex\x3d"1"\x3e${i18n.close}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlgGroup.html":'\x3cdiv class\x3d"avenir-regular"\x3e\r\n  \x3cdiv class\x3d"panel panel-white panel-no-padding padding-leader-half padding-trailer-quarter padding-left-1 padding-right-1 border-bottom-clear"\x3e\r\n    \x3cdiv class\x3d"left"\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:show}"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail" title\x3d"${i18n.GroupsWidget.viewGroupDetails}"\x3e\r\n          \x3cimg src\x3d"${thumbnailUrl}" alt\x3d"${title}" class\x3d"${thumbnail:hide}"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"${fillColor}" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath class\x3d"${useLetter:show}" fill\x3d"#FFF" d\x3d"M24.25 15.625a6.875 6.875 0 1 0-.008 13.75 6.875 6.875 0 0 0 .008-13.75zm0 11c-2.272 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125c2.279 0 4.125 1.846 4.125 4.125s-1.846 4.125-4.125 4.125zm3.118 16.5H14.774c.596-4.641 4.647-8.25 9.473-8.25 2.855 0 5.426 1.283 7.188 3.316a15.168 15.168 0 0 1 2.311-1.518 12.22 12.22 0 0 0-9.496-4.549c-6.369 0-11.551 4.82-12.238 11l-.137 2.75h14.424a15.49 15.49 0 0 1 1.066-2.75h.003zm25.62 5.5c-.693-6.18-5.873-11-12.238-11s-11.545 4.82-12.238 11l-.137 2.75h24.75l-.137-2.75zm-21.711 0c.596-4.641 4.647-8.25 9.473-8.25a9.578 9.578 0 0 1 9.464 8.25H31.277zm9.473-27.5a6.875 6.875 0 1 0-.008 13.75c3.797.003 6.877-3.072 6.88-6.87s-3.072-6.877-6.869-6.88h-.003zm0 11c-2.271 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125a4.125 4.125 0 0 1 0 8.25z"/\x3e\r\n            \x3ctext class\x3d"${useLetter:hide} font-size-4" x\x3d"50%" y\x3d"50%" fill\x3d"white" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-default-text" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-ie-text" y\x3d"70%" x\x3d"55%" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n            \x3c/text\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:hide}"\x3e\r\n        \x3cdiv class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"#AAA" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath fill\x3d"#FFF" d\x3d"M42.5 30.5h-20c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2zm0 16h-20v-14h20v14zm-14-20c0-2.205 1.794-4 4-4s4 1.795 4 4v4h2v-4c0-3.309-2.691-6-6-6s-6 2.691-6 6v4h2v-4zm-4 0c0-4.4 3.6-8 8-8s8 3.6 8 8v4h2v-4c0-5.514-4.486-10-10-10s-10 4.486-10 10v4h2v-4zm10 12v-2h-2v-2h-2v10h2v-2h2v-2h-2v-2h2z"/\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"group-card-content border-box right"\x3e\r\n      \x3ch4 class\x3d"trailer-0 leader-quarter font-size-1 full-width text-ellipsis margin-right-1 text-left"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" title\x3d"${title}" class\x3d"text-ellipsis ${isPrivate:show}"\x3e${title:stripHTML}\x3c/a\x3e\r\n        \x3cspan class\x3d"text-ellipsis ${isPrivate:hide}" title\x3d"${title}"\x3e${title:stripHTML}\x3c/span\x3e\r\n      \x3c/h4\x3e\r\n      \x3cp class\x3d"trailer-0 text-left"\x3e${notificationSummary}\x3c/p\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"panel panel-no-padding padding-leader-quarter padding-trailer-quarter padding-left-quarter padding-right-quarter clearfix"\x3e\r\n    \x3cdiv class\x3d"right"\x3e\r\n      \x3cbutton class\x3d"js-accept-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-green"\x3e${icons.inline.check.16}\x3c/span\x3e${i18n.invitationsGrid.joinThisGroup}\x3c/button\x3e\r\n      \x3cbutton class\x3d"js-decline-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-red"\x3e${icons.inline.minus-circle.16}\x3c/span\x3e${i18n.invitationsGrid.decline}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/JoinGroupDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"join_group-dialog" class\x3d"join-group-dialog" title\x3d"${i18n.joinGroupTitle}"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinGroupContent"\x3e\r\n      ${i18n.yourRequestForReview}\r\n      \x3cbr\x3e\r\n      ${i18n.youCanCheckStatus}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"hide leader-half" data-dojo-attach-point\x3d"_administrativeGroup"\x3e\r\n      ${i18n.leavingDisabled}\r\n    \x3c/div\x3e\r\n    \x3cbr\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing right leader-1"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-blue"\x3e${i18n.submitRequest}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageSubscriptionDlg.html":'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.Dialog" id\x3d"manage-subscription-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.manageSubscriptionTitle}" execute\x3d"" style\x3d"width:400px;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_upgradeSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outsideUSDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionContainer"\x3e\r\n        \x3cp\x3e${i18n.manageSubscriptionDesc}\x3c/p\x3e\r\n        \x3cinput type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_upgradeRadioBtn" id\x3d"upgrade-radio-button" value\x3d"upgrade" checked\x3d"true"\x3e\r\n        \x3cspan\x3e\x3clabel for\x3d"upgrade-radio-button"\x3e\x3cb\x3e${i18n.upgradeOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.upgradeDesc}\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_convertOptionDiv"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_convertRadioBtn" id\x3d"convert-radio-button" value\x3d"convert"\x3e\r\n          \x3cspan\x3e\x3clabel for\x3d"convert-radio-button"\x3e\x3cb\x3e${i18n.convertOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.convertDesc}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_evalSubscriptionContainer" class\x3d"hide"\x3e\r\n        \x3cp\x3e${i18n.upgradeOption} ${i18n.upgradeDesc}\x3c/p\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseInUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseOutsideUSDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_convertSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cp\x3e${i18n.convertSubscriptionDesc}\x3c/p\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.deleteHostedMsg}\x3c/b\x3e\x3cbr/\x3e${i18n.notAvailableMsg}\x3c/p\x3e\r\n      \x3cdiv\x3e\x3cb\x3e${i18n.importantMsg}\x3c/b\x3e\x3cdiv data-dojo-attach-point\x3d"_importantMsgDiv"\x3e\x3c/div\x3e\x3c/div\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.intendToUpgradeMsg}\x3c/b\x3e\x3c/p\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_buttonDiv" class\x3d"right esriFloatTrailing"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-clear" type\x3d"button"\x3e${i18n.ok}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_nextBtn" class\x3d"btn" type\x3d"button"\x3e${i18n.next}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_convertBtn" class\x3d"btn" type\x3d"button"\x3e${i18n.convertLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear" type\x3d"button"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageTilesDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} manage-tiles-dialog js-tab-group" data-dojo-type\x3d"dijit/Dialog"\r\n       data-dojo-attach-point\x3d"dialog" title\x3d"${i18n.dialogTitle}"\x3e\r\n    \x3cnav class\x3d"tab-nav" data-dojo-attach-point\x3d"_tabNav"\x3e\r\n      \x3ca class\x3d"tab-title js-tab is-active" data-dojo-attach-point\x3d"_levelsTab"\x3e${i18n.levelsTab}\x3c/a\x3e\r\n      \x3ca class\x3d"tab-title js-tab" data-dojo-attach-point\x3d"_extentTab"\x3e${i18n.extentTab}\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n\r\n    \x3csection class\x3d"tab-contents"\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section is-active" data-dojo-attach-point\x3d"_levelsSection"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_dialogDescription"\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"selected-scales-container"\x3e\x3cspan data-dojo-attach-point\x3d"_scalesSelectedSpan"\x3e\x3c/span\x3e\x3cbr\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"scaleContainer" data-dojo-attach-point\x3d"_gridContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section" data-dojo-attach-point\x3d"_extentSection"\x3e\r\n        \x3c!-- Add Extent UI here --\x3e\r\n        \x3cdiv class\x3d"extentContainer hide" data-dojo-attach-point\x3d"_extentContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n    \x3c/section\x3e\r\n\r\n    \x3cdiv class\x3d"controlDiv clearfix" data-dojo-attach-point\x3d"_controlDiv"\x3e\r\n      \x3cdiv class\x3d"left messageContainer"\x3e\r\n        \x3cdiv class\x3d"message" data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right buildContainer"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_buildButton" class\x3d"calcite secondary btn btn-blue"\x3e${i18n.buildButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelButton" class\x3d"calcite secondary btn btn-blue hide"\x3e${i18n.cancelButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_closeButton" class\x3d"calcite transparent btn btn-clear"\x3e${i18n.close}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} membership-requests-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.membershipRequests}"\x3e\r\n    \x3cdiv class\x3d"membership-requests-label"\x3e${i18n.requestedMemberShip}\x3c/div\x3e\r\n    \x3cdiv class\x3d"${baseClass} requests-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_requestsGridContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem;padding-bottom:5px;"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.close}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\x26nbsp;\x3cbr/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/pages/dijit/UploadProgressBar/UploadProgressBar.html":'\x3cdiv class\x3d"upload-progress-bar flex-1 flex-column-justify-center margin-right-1 margin-left-half position-relative"\x3e\r\n  \x3cdiv class\x3d"progress-bar"\x3e\r\n    \x3cdiv class\x3d"progress-bar-fill" data-dojo-attach-point\x3d"_uploadProgressFill"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"font-size--3 upload-percent-label" data-dojo-attach-point\x3d"_uploadPercentLabel"\x3e0%\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"*now":function(a){a(['dojo/i18n!*preload*arcgisonline/nls/arcgisonline*["ar","bg","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("arcgisonline/arcgisonline",["dojo","dijit","dojox","dojo/require!esri/main,dijit/_base,dijit/form/DropDownButton,dijit/form/ComboButton,dijit/form/ToggleButton,dijit/form/HorizontalSlider,dijit/form/VerticalSlider,dijit/form/HorizontalRule,dijit/form/VerticalRule,dijit/form/HorizontalRuleLabels,dijit/form/VerticalRuleLabels,esri/map,esri/dijit/editing/Editor,esri/dijit/editing/TemplatePicker,esri/dijit/InfoWindow,esri/dijit/OverviewMap,esri/dijit/Attribution,esri/dijit/Scalebar,esri/dijit/Legend,esri/dijit/TimeSlider,esri/dijit/MultidimensionalSlider,esri/dijit/BasemapGallery,esri/dijit/HomeButton,esri/dijit/LocateButton,esri/dijit/Popup,esri/layers/graphics,esri/layers/agstiled,esri/layers/agsdynamic,esri/layers/agsimageservice,esri/layers/CSVLayer,esri/layers/StreamLayer,esri/layers/KMLLayer,esri/layers/FeatureLayer,esri/layers/VectorTileLayer,esri/layers/osm,esri/SnappingManager,esri/tasks/geometry,esri/tasks/identify,esri/tasks/locator,esri/toolbars/draw,esri/virtualearth/VETiledLayer,esri/virtualearth/VEGeocoder,esri/dijit/Geocoder,dojo/dnd/Moveable,dojo/parser,arcgisonline/map/classBreaks,arcgisonline/map/dynLayer,arcgisonline/map/edit,arcgisonline/map/featColl,arcgisonline/map/fileImport,arcgisonline/map/geocode,arcgisonline/map/geocodeReview,arcgisonline/map/geoRSS,arcgisonline/map/itemData,arcgisonline/map/layer,arcgisonline/map/kml,arcgisonline/map/mapNotes,arcgisonline/map/mapUtil,arcgisonline/map/role,arcgisonline/map/print,arcgisonline/map/popup,arcgisonline/map/save_open,arcgisonline/map/symbol,arcgisonline/map/table,arcgisonline/map/thumbnail,arcgisonline/map/time,arcgisonline/map/multiDimensions,arcgisonline/map/vectorTile,arcgisonline/map/webTile,arcgisonline/map/wms,arcgisonline/map/dijit/About,arcgisonline/map/dijit/AddContent,arcgisonline/map/dijit/Directions,arcgisonline/map/dijit/Edit,arcgisonline/map/dijit/Geocode,arcgisonline/map/dijit/LeftPanel,arcgisonline/map/dijit/Legend,arcgisonline/map/dijit/ManageTemplates,arcgisonline/map/dijit/MosaicRule,arcgisonline/map/dijit/PopupBuilder,arcgisonline/map/dijit/RendererLabels,arcgisonline/map/dijit/DefineAOI,arcgisonline/map/dijit/RenderingRule,arcgisonline/map/dijit/StructuredPopupWidget,arcgisonline/map/dijit/TOC,arcgisonline/map/dijit/MultidimensionalFilter,arcgisonline/map/dijit/renderer/AttributeTransparency,arcgisonline/map/dijit/renderer/AttributeTransparencyDlg,arcgisonline/map/dijit/renderer/Color,arcgisonline/map/dijit/renderer/ColorGrid,arcgisonline/map/dijit/renderer/Gallery,arcgisonline/map/dijit/renderer/HeatMap,arcgisonline/map/dijit/renderer/MultiAttributes,arcgisonline/map/dijit/renderer/Simple,arcgisonline/map/dijit/renderer/Size,arcgisonline/map/dijit/renderer/SizeGrid,arcgisonline/map/dijit/renderer/SymbolStylerDlg,arcgisonline/map/dijit/renderer/UniqueValues,arcgisonline/map/dijit/renderer/UniqueValuesGrid,esri/tasks/RelationshipQuery,esri/tasks/StatisticDefinition,esri/tasks/PrintParameters,esri/tasks/LegendLayer,esri/tasks/GenerateRendererParameters,esri/tasks/ClassificationDefinition,esri/tasks/ClassBreaksDefinition,esri/tasks/UniqueValueDefinition,esri/tasks/ColorRamp,esri/tasks/AlgorithmicColorRamp,esri/tasks/MultipartColorRamp,esri/tasks/RouteTask,esri/tasks/RouteParameters,esri/tasks/RouteResult,esri/tasks/NAMessage,esri/tasks/NATypes,esri/tasks/DirectionsFeatureSet,esri/layers/wmts,esri/layers/WMTSLayer,esri/layers/WMTSLayerInfo,esri/dijit/Directions,dijit/layout/AccordionPane,dojox/data/QueryReadStore,arcgisonline/sharing/util,arcgisonline/sharing/utilShare,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/MemberReadStore,arcgisonline/sharing/geow/QueryReadStore,arcgisonline/sharing/geow/TooltipQueryReadStore,dijit/Dialog,dijit/form/ComboBox,dijit/layout/TabContainer,arcgisonline/sharing/dijit/ArcGISOnlineServicesGrid,arcgisonline/sharing/dijit/ArcGISServerServicesGrid,arcgisonline/sharing/dijit/BasemapGallery,arcgisonline/sharing/dijit/BasemapGalleryGrid,arcgisonline/sharing/dijit/Button,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/DropDownButton,arcgisonline/sharing/dijit/FeatureLayerQueryResult,arcgisonline/sharing/dijit/FeatureLayerQueryStore,arcgisonline/sharing/dijit/GoogleServicesGrid,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/OrganizationSetup,arcgisonline/sharing/dijit/SingleFilter,arcgisonline/sharing/dijit/SingleInteractiveFilter,arcgisonline/sharing/dijit/dialog/AddLayerFromFileDlg,arcgisonline/sharing/dijit/dialog/AddLayerFromUrlDlg,arcgisonline/sharing/dijit/dialog/BrowseLayersDlg,arcgisonline/sharing/dijit/dialog/CsvLocationDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ExportDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg,arcgisonline/sharing/dijit/dialog/FieldsDlg,arcgisonline/sharing/dijit/dialog/FilterDlg,arcgisonline/sharing/dijit/dialog/FeatureTypeDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/InvitationsDlg,arcgisonline/sharing/dijit/dialog/JoinGroupDlg,arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg,arcgisonline/sharing/dijit/dialog/ManageTilesDlg,arcgisonline/sharing/dijit/dialog/MapSettingsDlg,arcgisonline/sharing/dijit/dialog/MapNotesDlg,arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg,arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg,arcgisonline/sharing/dijit/dialog/OpenMapDlg,arcgisonline/sharing/dijit/dialog/OpenPresentationDlg,arcgisonline/sharing/dijit/dialog/QueryLayerDlg,arcgisonline/sharing/dijit/dialog/RenameDlg,arcgisonline/sharing/dijit/dialog/RendererDlg,arcgisonline/sharing/dijit/dialog/SaveWebMapDlg,arcgisonline/sharing/dijit/dialog/ShareCheckDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ShareMapDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,arcgisonline/sharing/dijit/dialog/SymbolDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/TermsOfUseDlg,arcgisonline/sharing/dijit/dialog/TimeSettingsDlg,arcgisonline/sharing/dijit/dialog/UpdateItemDlg,arcgisonline/sharing/dijit/dialog/WaitingDlg,arcgisonline/sharing/dijit/_GalleryFiltersMixin,arcgisonline/sharing/dijit/Grid,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/BrowseItemsDlg,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/ConfirmDialog,arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg,arcgisonline/sharing/dijit/dialog/getWFSConfig,arcgisonline/sharing/dijit/dialog/getWMTSConfig"],function(a,
w,e){a.provide("arcgisonline.arcgisonline");a.require("esri.main");a.require("dijit._base");a.require("dijit.form.DropDownButton");a.require("dijit.form.ComboButton");a.require("dijit.form.ToggleButton");a.require("dijit.form.HorizontalSlider");a.require("dijit.form.VerticalSlider");a.require("dijit.form.HorizontalRule");a.require("dijit.form.VerticalRule");a.require("dijit.form.HorizontalRuleLabels");a.require("dijit.form.VerticalRuleLabels");a.require("esri.map");a.require("esri.dijit.editing.Editor");
a.require("esri.dijit.editing.TemplatePicker");a.require("esri.dijit.InfoWindow");a.require("esri.dijit.OverviewMap");a.require("esri.dijit.Attribution");a.require("esri.dijit.Scalebar");a.require("esri.dijit.Legend");a.require("esri.dijit.TimeSlider");a.require("esri.dijit.MultidimensionalSlider");a.require("esri.dijit.BasemapGallery");a.require("esri.dijit.HomeButton");a.require("esri.dijit.LocateButton");a.require("esri.dijit.Popup");a.require("esri.layers.graphics");a.require("esri.layers.agstiled");
a.require("esri.layers.agsdynamic");a.require("esri.layers.agsimageservice");a.require("esri.layers.CSVLayer");a.require("esri.layers.StreamLayer");a.require("esri.layers.KMLLayer");a.require("esri.layers.FeatureLayer");a.require("esri.layers.VectorTileLayer");a.require("esri.layers.osm");a.require("esri.SnappingManager");a.require("esri.tasks.geometry");a.require("esri.tasks.identify");a.require("esri.tasks.locator");a.require("esri.toolbars.draw");a.require("esri.virtualearth.VETiledLayer");a.require("esri.virtualearth.VEGeocoder");
a.require("esri.dijit.Geocoder");a.require("dojo.dnd.Moveable");a.require("dojo.parser");a.require("arcgisonline.map.classBreaks");a.require("arcgisonline.map.dynLayer");a.require("arcgisonline.map.edit");a.require("arcgisonline.map.featColl");a.require("arcgisonline.map.fileImport");a.require("arcgisonline.map.geocode");a.require("arcgisonline.map.geocodeReview");a.require("arcgisonline.map.geoRSS");a.require("arcgisonline.map.itemData");a.require("arcgisonline.map.layer");a.require("arcgisonline.map.kml");
a.require("arcgisonline.map.mapNotes");a.require("arcgisonline.map.mapUtil");a.require("arcgisonline.map.role");a.require("arcgisonline.map.print");a.require("arcgisonline.map.popup");a.require("arcgisonline.map.save_open");a.require("arcgisonline.map.symbol");a.require("arcgisonline.map.table");a.require("arcgisonline.map.thumbnail");a.require("arcgisonline.map.time");a.require("arcgisonline.map.multiDimensions");a.require("arcgisonline.map.vectorTile");a.require("arcgisonline.map.webTile");a.require("arcgisonline.map.wms");
a.require("arcgisonline.map.dijit.About");a.require("arcgisonline.map.dijit.AddContent");a.require("arcgisonline.map.dijit.Directions");a.require("arcgisonline.map.dijit.Edit");a.require("arcgisonline.map.dijit.Geocode");a.require("arcgisonline.map.dijit.LeftPanel");a.require("arcgisonline.map.dijit.Legend");a.require("arcgisonline.map.dijit.ManageTemplates");a.require("arcgisonline.map.dijit.MosaicRule");a.require("arcgisonline.map.dijit.PopupBuilder");a.require("arcgisonline.map.dijit.RendererLabels");
a.require("arcgisonline.map.dijit.DefineAOI");a.require("arcgisonline.map.dijit.RenderingRule");a.require("arcgisonline.map.dijit.StructuredPopupWidget");a.require("arcgisonline.map.dijit.TOC");a.require("arcgisonline.map.dijit.MultidimensionalFilter");a.require("arcgisonline.map.dijit.renderer.AttributeTransparency");a.require("arcgisonline.map.dijit.renderer.AttributeTransparencyDlg");a.require("arcgisonline.map.dijit.renderer.Color");a.require("arcgisonline.map.dijit.renderer.ColorGrid");a.require("arcgisonline.map.dijit.renderer.Gallery");
a.require("arcgisonline.map.dijit.renderer.HeatMap");a.require("arcgisonline.map.dijit.renderer.MultiAttributes");a.require("arcgisonline.map.dijit.renderer.Simple");a.require("arcgisonline.map.dijit.renderer.Size");a.require("arcgisonline.map.dijit.renderer.SizeGrid");a.require("arcgisonline.map.dijit.renderer.SymbolStylerDlg");a.require("arcgisonline.map.dijit.renderer.UniqueValues");a.require("arcgisonline.map.dijit.renderer.UniqueValuesGrid");a.require("esri.tasks.RelationshipQuery");a.require("esri.tasks.StatisticDefinition");
a.require("esri.tasks.PrintParameters");a.require("esri.tasks.LegendLayer");a.require("esri.tasks.GenerateRendererParameters");a.require("esri.tasks.ClassificationDefinition");a.require("esri.tasks.ClassBreaksDefinition");a.require("esri.tasks.UniqueValueDefinition");a.require("esri.tasks.ColorRamp");a.require("esri.tasks.AlgorithmicColorRamp");a.require("esri.tasks.MultipartColorRamp");a.require("esri.tasks.RouteTask");a.require("esri.tasks.RouteParameters");a.require("esri.tasks.RouteResult");a.require("esri.tasks.NAMessage");
a.require("esri.tasks.NATypes");a.require("esri.tasks.DirectionsFeatureSet");a.require("esri.layers.wmts");a.require("esri.layers.WMTSLayer");a.require("esri.layers.WMTSLayerInfo");a.require("esri.dijit.Directions");a.require("dijit.layout.AccordionPane");a.require("dojox.data.QueryReadStore");a.require("arcgisonline.sharing.util");a.require("arcgisonline.sharing.utilShare");a.require("arcgisonline.sharing.geow.Account");a.require("arcgisonline.sharing.geow.Community");a.require("arcgisonline.sharing.geow.Geow");
a.require("arcgisonline.sharing.geow.MemberReadStore");a.require("arcgisonline.sharing.geow.QueryReadStore");a.require("arcgisonline.sharing.geow.TooltipQueryReadStore");a.require("dijit.Dialog");a.require("dijit.form.ComboBox");a.require("dijit.layout.TabContainer");a.require("arcgisonline.sharing.dijit.ArcGISOnlineServicesGrid");a.require("arcgisonline.sharing.dijit.ArcGISServerServicesGrid");a.require("arcgisonline.sharing.dijit.BasemapGallery");a.require("arcgisonline.sharing.dijit.BasemapGalleryGrid");
a.require("arcgisonline.sharing.dijit.Button");a.require("arcgisonline.sharing.dijit.ComboBox");a.require("arcgisonline.sharing.dijit.DataGrid");a.require("arcgisonline.sharing.dijit.DropDownButton");a.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");a.require("arcgisonline.sharing.dijit.FeatureLayerQueryStore");a.require("arcgisonline.sharing.dijit.GoogleServicesGrid");a.require("arcgisonline.sharing.dijit.HelpManager");a.require("arcgisonline.sharing.dijit.OrganizationSetup");a.require("arcgisonline.sharing.dijit.SingleFilter");
a.require("arcgisonline.sharing.dijit.SingleInteractiveFilter");a.require("arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg");a.require("arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg");a.require("arcgisonline.sharing.dijit.dialog.BrowseLayersDlg");a.require("arcgisonline.sharing.dijit.dialog.CsvLocationDlg");a.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");a.require("arcgisonline.sharing.dijit.dialog.ExportDlg");a.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");a.require("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");
a.require("arcgisonline.sharing.dijit.dialog.FieldsDlg");a.require("arcgisonline.sharing.dijit.dialog.FilterDlg");a.require("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");a.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");a.require("arcgisonline.sharing.dijit.dialog.InvitationsDlg");a.require("arcgisonline.sharing.dijit.dialog.JoinGroupDlg");a.require("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");a.require("arcgisonline.sharing.dijit.dialog.ManageTilesDlg");a.require("arcgisonline.sharing.dijit.dialog.MapSettingsDlg");
a.require("arcgisonline.sharing.dijit.dialog.MapNotesDlg");a.require("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg");a.require("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");a.require("arcgisonline.sharing.dijit.dialog.OpenMapDlg");a.require("arcgisonline.sharing.dijit.dialog.OpenPresentationDlg");a.require("arcgisonline.sharing.dijit.dialog.QueryLayerDlg");a.require("arcgisonline.sharing.dijit.dialog.RenameDlg");a.require("arcgisonline.sharing.dijit.dialog.RendererDlg");a.require("arcgisonline.sharing.dijit.dialog.SaveWebMapDlg");
a.require("arcgisonline.sharing.dijit.dialog.ShareCheckDlg");a.require("arcgisonline.sharing.dijit.dialog.SharingDlg");a.require("arcgisonline.sharing.dijit.dialog.ShareMapDlg");a.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");a.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");a.require("arcgisonline.sharing.dijit.dialog.TagsDlg");a.require("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");a.require("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");a.require("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");
a.require("arcgisonline.sharing.dijit.dialog.WaitingDlg");a.require("arcgisonline.sharing.dijit._GalleryFiltersMixin");a.require("arcgisonline.sharing.dijit.Grid");a.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");a.require("arcgisonline.sharing.dijit.dialog.BrowseItemsDlg");a.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");a.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");a.require("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg");a.require("arcgisonline.sharing.dijit.dialog.getWFSConfig");
a.require("arcgisonline.sharing.dijit.dialog.getWMTSConfig")});