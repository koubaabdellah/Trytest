//>>built
require({cache:{"esri/map":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/event dojo/on dojo/aspect dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/a11yclick dijit/registry ./kernel ./config ./sniff ./lang ./_coremap ./MapNavigationManager dojo/i18n!./nls/jsapi".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w){var c={up:"panUp",right:"panRight",down:"panDown",
left:"panLeft"},D={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"},E=R.connect,J=R.disconnect,A=x.create,S=q.set,H=X.hitch,ea=f.getMarginBox,L=F.deprecated,v=X.mixin,b=0;F=d(K,{declaredClass:"esri.Map",constructor:function(g,W){W=W||{};v(this,{_slider:null,_navDiv:null,_mapParams:v({attributionWidth:.45,slider:!0,nav:!1,logo:!0,sliderStyle:"small",sliderPosition:"top-left",sliderOrientation:"vertical",autoResize:!0},W)});v(this,{isMapNavigation:null!=
W.isMapNavigation?W.isMapNavigation:!0,isDoubleClickZoom:null!=W.isDoubleClickZoom?W.isDoubleClickZoom:!0,isClickRecenter:null!=W.isClickRecenter?W.isClickRecenter:!0,isPan:null!=W.isPan?W.isPan:!0,isRubberBandZoom:null!=W.isRubberBandZoom?W.isRubberBandZoom:!0,isPinchZoom:null!=W.isPinchZoom?W.isPinchZoom:!0,isKeyboardNavigation:null!=W.isKeyboardNavigation?W.isKeyboardNavigation:!0,isScrollWheel:null!=W.isScrollWheel?W.isScrollWheel:!0,isShiftDoubleClickZoom:!1,isScrollWheelZoom:!1,isPanArrows:!1,
isZoomSlider:!1});X.isFunction(t._css)&&(t._css=t._css(this._mapParams.force3DTransforms),this.force3DTransforms=this._mapParams.force3DTransforms);var N=m("esri-transforms")&&m("esri-transitions");this.navigationMode=this._mapParams.navigationMode||N&&"css-transforms"||"classic";"css-transforms"!==this.navigationMode||N||(this.navigationMode="classic");this.fadeOnZoom=y.isDefined(this._mapParams.fadeOnZoom)?this._mapParams.fadeOnZoom:"css-transforms"===this.navigationMode;"css-transforms"!==this.navigationMode&&
(this.fadeOnZoom=!1);this.setMapCursor("default");this.smartNavigation=W&&W.smartNavigation;if(!(y.isDefined(this.smartNavigation)||!m("mac")||m("esri-touch")||m("esri-pointer")||3.5>=m("ff"))){var U=navigator.userAgent.match(/Mac\s+OS\s+X\s+([\d]+)(\.|_)([\d]+)\D/i);U&&y.isDefined(U[1])&&y.isDefined(U[3])&&(N=parseInt(U[1],10),U=parseInt(U[3],10),this.smartNavigation=10<N||10===N&&6<=U)}this.showAttribution=y.isDefined(this._mapParams.showAttribution)?this._mapParams.showAttribution:!0;this._onLoadHandler_connect=
E(this,"onLoad",this,"_onLoadInitNavsHandler");var M=A("div",{"class":"esriControlsBR"+(this._mapParams.nav?" withPanArrows":"")},this.root);if(this.showAttribution)if(N=X.getObject("esri.dijit.Attribution",!1))this._initAttribution(N,M);else{var Z=b++,da=this;this._rids&&this._rids.push(Z);O(["./dijit/Attribution"],function(oa){var wa=da._rids?ba.indexOf(da._rids,Z):-1;-1!==wa&&(da._rids.splice(wa,1),da._initAttribution(oa,M))})}this._mapParams.logo&&(N={},6===m("ie")&&(N.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
O.toUrl("./images/map/logo-med.png")+"')"),this._ogol=A("div",{style:N,tabIndex:"0",title:"Esri"},M),this._setLogoSize(),this._onMapResizeLogo_connect=E(this,"onResize",this,"_setLogoSize"),this._ogol_connect=E(this._ogol,h,this,"_openLogoLink"));this.navigationManager=new n(this);W&&W.basemap&&(this._onLoadFix=!0,this.setBasemap(W.basemap),this._onLoadFix=!1);if(this.autoResize=this._mapParams.autoResize)N=this._getEnclosingResizableWidget(this.container)||window,U=this.resize,this._rszSignal=P.pausable(N,
"resize",U),this._oriSignal=P.pausable(window,"orientationchange",U),G.after(N,"resize",U,!0),this._startResizeTimer()},_startResizeTimer:function(){clearTimeout(this._persistentTimer);this._persistentTimer=setTimeout(this._timedResize,2*this.resizeDelay)},_getEnclosingResizableWidget:function(g){var W=e.getEnclosingWidget(g);return W?W.resize?W:this._getEnclosingResizableWidget(g.parentNode):W},_setLogoSize:function(){this._ogol&&(25E4>this.root.clientWidth*this.root.clientHeight?(z.remove(this._ogol,
"logo-med"),z.add(this._ogol,"logo-sm")):(z.remove(this._ogol,"logo-sm"),z.add(this._ogol,"logo-med")))},_initAttribution:function(g,W){var N=A("span",{"class":"esriAttribution"},W,"first");S(N,"maxWidth",Math.floor(this.width*this._mapParams.attributionWidth)+"px");this._connects.push(E(N,h,function(){z.contains(this,"esriAttributionOpen")?z.remove(this,"esriAttributionOpen"):this.scrollWidth>this.clientWidth&&z.add(this,"esriAttributionOpen")}));this.attribution=new g({map:this},N)},_cleanUp:function(){this.disableMapNavigation();
this.navigationManager.destroy();var g=this._slider;g&&g.destroy&&!g._destroyed&&g.destroy();g=this._navDiv;var W=this.attribution;g&&x.destroy(g);W&&W.destroy();this._connects.push(this._slider_connect,this._ogol_connect,this._rszSignal,this._oriSignal);ba.forEach(this._connects,J);clearInterval(this._persistentTimer);this.attribution=this.navigationManager=this._rids=this._connects=this._slider_connect=this._ogol_connect=this._rszSignal=this._oriSignal=this._persistentTimer=null;this.inherited("_cleanUp",
arguments)},_isPanningOrZooming:function(){return this.__panning||this.__zooming},_canZoom:function(g){var W=this.getLevel();return!this.__tileInfo||!(W===this.getMinZoom()&&0>g||W===this.getMaxZoom()&&0<g)},_onLoadInitNavsHandler:function(){this._evalMapNavigation();this._createNav();if("small"===this._mapParams.sliderStyle||!this._createSlider)this._createSimpleSlider();else if(this._mapParams.slider){var g=-1!==this._getSliderClass(!0).indexOf("Horizontal");g=[g?"dijit.form.HorizontalSlider":"dijit.form.VerticalSlider",
g?"dijit.form.HorizontalRule":"dijit.form.VerticalRule",g?"dijit.form.HorizontalRuleLabels":"dijit.form.VerticalRuleLabels"];if(ba.some(g,function(U){return!X.getObject(U,!1)})){g=ba.map(g,function(U){return U.replace(/\./g,"/")});var W=b++,N=this;this._rids&&this._rids.push(W);O(g,function(){var U=N._rids?ba.indexOf(N._rids,W):-1;-1!==U&&(N._rids.splice(U,1),N._createSlider.apply(N,arguments))})}else g=ba.map(g,function(U){return X.getObject(U,!1)}),this._createSlider.apply(this,g)}J(this._onLoadHandler_connect)},
_createNav:function(){if(this._mapParams.nav){var g,W=z.add,N=this.id;this._navDiv=A("div",{id:N+"_navdiv"},this.root);W(this._navDiv,"navDiv");var U=this.width/2,M=this.height/2;for(g in c){var Z=c[g];var da=A("div",{id:N+"_pan_"+g},this._navDiv);W(da,"fixedPan "+Z);if("up"===g||"down"===g){var oa=parseInt(ea(da).w,10)/2;S(da,{left:U-oa+"px",zIndex:30})}else oa=parseInt(ea(da).h,10)/2,S(da,{top:M-oa+"px",zIndex:30});this._connects.push(E(da,"onclick",H(this,this[Z])))}this._onMapResizeNavHandler_connect=
E(this,"onResize",this,"_onMapResizeNavHandler");for(g in D)Z=D[g],da=A("div",{id:N+"_pan_"+g,style:{zIndex:30}},this._navDiv),W(da,"fixedPan "+Z),this._connects.push(E(da,"onclick",H(this,this[Z])));this.isPanArrows=!0}},_onMapResizeNavHandler:function(g,W,N){g=this.id;W/=2;N/=2;var U=u.byId,M;for(M in c){var Z=U(g+"_pan_"+M);if("up"===M||"down"===M){var da=parseInt(ea(Z).w,10)/2;S(Z,"left",W-da+"px")}else da=parseInt(ea(Z).h,10)/2,S(Z,"top",N-da+"px")}},_createSimpleSlider:function(){if(this._mapParams.slider){var g=
this._slider=A("div",{id:this.id+"_zoom_slider","class":this._getSliderClass(),style:{zIndex:30}}),W=A("div",{"class":"esriSimpleSliderIncrementButton",tabIndex:"0",role:"button"},g),N=A("div",{"class":"esriSimpleSliderDecrementButton",tabIndex:"0",role:"button"},g);this._addZoomButtonTooltips(W,N);this._incButton=W;this._decButton=N;this._simpleSliderZoomHandler(null,null,null,this.getLevel());var U=w.widgets.zoomSlider;this._addZoomButtonIcon(W,"+",U.zoomIn);this._addZoomButtonIcon(N,"\x26minus;",
U.zoomOut);8>m("ie")&&z.add(N,"dj_ie67Fix");this._connects.push(E(W,h,this,this._simpleSliderChangeHandler));this._connects.push(E(N,h,this,this._simpleSliderChangeHandler));(-1<this.getMaxZoom()||-1<this.getMinZoom())&&this._connects.push(E(this,"onZoomEnd",this,this._simpleSliderZoomHandler));10>m("ie")&&u.setSelectable(g,!1);this.root.appendChild(g);this.isZoomSlider=!0}},_simpleSliderChangeHandler:function(g){V.stop(g);g=-1!==g.currentTarget.className.indexOf("IncrementButton")?!0:!1;this._extentUtil({numLevels:g?
1:-1})},_simpleSliderZoomHandler:function(g,W,N,U){var M;g=this._incButton;W=this._decButton;-1<U&&U===this.getMaxZoom()?M=g:-1<U&&U===this.getMinZoom()&&(M=W);M?(z.add(M,"esriSimpleSliderDisabledButton"),z.remove(M===g?W:g,"esriSimpleSliderDisabledButton")):(z.remove(g,"esriSimpleSliderDisabledButton"),z.remove(W,"esriSimpleSliderDisabledButton"))},_getSliderClass:function(g){g=g?"Large":"Simple";var W=this._mapParams.sliderOrientation,N=this._mapParams.sliderPosition||"";W=W&&"horizontal"===W.toLowerCase()?
"esri"+g+"SliderHorizontal":"esri"+g+"SliderVertical";if(N)switch(N.toLowerCase()){case "top-left":N="esri"+g+"SliderTL";break;case "top-right":N="esri"+g+"SliderTR";break;case "bottom-left":N="esri"+g+"SliderBL";break;case "bottom-right":N="esri"+g+"SliderBR"}return"esri"+g+"Slider "+W+" "+N},_addZoomButtonIcon:function(g,W,N){x.create("span",{"aria-hidden":"true",role:"presentation",innerHTML:W},g);x.create("span",{"class":"esriIconFallbackText",innerHTML:N},g)},_addZoomButtonTooltips:function(g,
W){var N=w.widgets.zoomSlider;C.set(g,"title",N.zoomIn);C.set(W,"title",N.zoomOut)},_createSlider:function(g,W,N){if(this._mapParams.slider){var U=A("div",{id:this.id+"_zoom_slider"},this.root),M=k.defaults.map,Z=this._getSliderClass(!0),da=-1!==Z.indexOf("Horizontal"),oa=this.getNumLevels();if(0<oa){var wa,ra,Ba=this._mapParams.sliderLabels,Ia=!!Ba,Ma=!1!==Ba;if(Ma){var Za=da?"bottomDecoration":"rightDecoration";if(!Ba)for(Ba=[],M=0;M<oa;M++)Ba[M]="";ba.forEach([{"class":"esriLargeSliderTicks",container:Za,
count:oa,dijitClass:W},{"class":Ia&&"esriLargeSliderLabels",container:Za,count:oa,labels:Ba,dijitClass:N}],function(Sa){var Na=A("div"),fb=Sa.dijitClass;delete Sa.dijitClass;U.appendChild(Na);fb===W?wa=new fb(Sa,Na):ra=new fb(Sa,Na)})}g=this._slider=new g({id:U.id,"class":Z,minimum:this.getMinZoom(),maximum:this.getMaxZoom(),discreteValues:oa,value:this.getLevel(),clickSelect:!0,intermediateChanges:!0,style:"z-index:30;"},U);g.startup();Ma&&(wa.startup(),ra.startup());this._slider_connect=E(g,"onChange",
this,"_onSliderChangeHandler");this._connects.push(E(this,"onExtentChange",this,"_onExtentChangeSliderHandler"));this._connects.push(E(g._movable,"onFirstMove",this,"_onSliderMoveStartHandler"))}else{g=this._slider=new g({id:U.id,"class":Z,minimum:0,maximum:2,discreteValues:3,value:1,clickSelect:!0,intermediateChanges:M.sliderChangeImmediate,style:"height:50px; z-index:30;"},U);N=g.domNode.firstChild.childNodes;for(M=1;3>=M;M++)S(N[M],"visibility","hidden");g.startup();this._slider_connect=E(g,"onChange",
this,"_onDynSliderChangeHandler");this._connects.push(E(this,"onExtentChange",this,"_onExtentChangeDynSliderHandler"))}M=g.incrementButton;N=g.decrementButton;da?this._addZoomButtonTooltips(M,N):this._addZoomButtonTooltips(N,M);M.style.outline="none";N.style.outline="none";g.sliderHandle.style.outline="none";g._onKeyPress=function(){};if(da=g._movable){var bb=da.onMouseDown;da.onMouseDown=function(Sa){9>m("ie")&&1!==Sa.button||bb.apply(this,arguments)}}this.isZoomSlider=!0}},_onSliderMoveStartHandler:function(){J(this._slider_connect);
J(this._slidermovestop_connect);this._slider_connect=E(this._slider,"onChange",this,"_onSliderChangeDragHandler");this._slidermovestop_connect=E(this._slider._movable,"onMoveStop",this,"_onSliderMoveEndHandler")},_onSliderChangeDragHandler:function(g){this._extentUtil({targetLevel:g})},_onSliderMoveEndHandler:function(){J(this._slider_connect);J(this._slidermovestop_connect)},_onSliderChangeHandler:function(g){this.setLevel(g)},_updateSliderValue:function(g,W){J(this._slider_connect);var N=this._slider,
U=N._onChangeActive;N._onChangeActive=!1;N.set("value",g);N._onChangeActive=U;this._slider_connect=E(N,"onChange",this,W)},_onExtentChangeSliderHandler:function(g,W,N,U){J(this._slidermovestop_connect);this._updateSliderValue(U.level,"_onSliderChangeHandler")},_onDynSliderChangeHandler:function(g){this._extentUtil({numLevels:0<g?1:-1})},_onExtentChangeDynSliderHandler:function(){this._updateSliderValue(1,"_onDynSliderChangeHandler")},_openLogoLink:function(g){window.open(k.defaults.map.logoLink,"_blank");
V.stop(g)},enableMapNavigation:function(){this.isMapNavigation||(this.isMapNavigation=!0,this._evalMapNavigation())},disableMapNavigation:function(){this.isMapNavigation&&(this.isMapNavigation=!1,this._evalMapNavigation())},_evalMapNavigation:function(){this.isMapNavigation?this.navigationManager.enableNavigation():this.navigationManager.disableNavigation()},_evalNavigationFeature:function(g){if(this.isMapNavigation&&this["is"+g])this.navigationManager["enable"+g]();else this.navigationManager["disable"+
g]()},enableDoubleClickZoom:function(){this.isDoubleClickZoom||(this.isDoubleClickZoom=!0,this._evalNavigationFeature("DoubleClickZoom"))},disableDoubleClickZoom:function(){this.isDoubleClickZoom&&(this.isDoubleClickZoom=!1,this._evalNavigationFeature("DoubleClickZoom"))},enableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom||(L(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.enableShiftDoubleClickZoom(),
this.isShiftDoubleClickZoom=!0)},disableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom&&(L(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.disableShiftDoubleClickZoom(),this.isShiftDoubleClickZoom=!1)},enableClickRecenter:function(){this.isClickRecenter||(this.isClickRecenter=!0,this._evalNavigationFeature("ClickRecenter"))},disableClickRecenter:function(){this.isClickRecenter&&
(this.isClickRecenter=!1,this._evalNavigationFeature("ClickRecenter"))},enablePan:function(){this.isPan||(this.isPan=!0,this._evalNavigationFeature("Pan"))},disablePan:function(){this.isPan&&(this.isPan=!1,this._evalNavigationFeature("Pan"))},enableRubberBandZoom:function(){this.isRubberBandZoom||(this.isRubberBandZoom=!0,this._evalNavigationFeature("RubberBandZoom"))},disableRubberBandZoom:function(){this.isRubberBandZoom&&(this.isRubberBandZoom=!1,this._evalNavigationFeature("RubberBandZoom"))},
enablePinchZoom:function(){this.isPinchZoom||(this.isPinchZoom=!0,this._evalNavigationFeature("PinchZoom"))},disablePinchZoom:function(){this.isPinchZoom&&(this.isPinchZoom=!1,this._evalNavigationFeature("PinchZoom"))},enableKeyboardNavigation:function(){this.isKeyboardNavigation||(this.isKeyboardNavigation=!0,this._evalNavigationFeature("KeyboardNavigation"))},disableKeyboardNavigation:function(){this.isKeyboardNavigation&&(this.isKeyboardNavigation=!1,this._evalNavigationFeature("KeyboardNavigation"))},
enableScrollWheel:function(){this.isScrollWheel||(this.isScrollWheel=!0,this._evalNavigationFeature("ScrollWheel"))},disableScrollWheel:function(){this.isScrollWheel&&(this.isScrollWheel=!1,this._evalNavigationFeature("ScrollWheel"))},enableScrollWheelZoom:function(){this.isScrollWheelZoom||(this.navigationManager.enableScrollWheelZoom(),this.isScrollWheelZoom=!0)},disableScrollWheelZoom:function(){this.isScrollWheelZoom&&(this.navigationManager.disableScrollWheelZoom(),this.isScrollWheelZoom=!1)},
enableScrollWheelPan:function(){this.isScrollWheelPan||this.navigationManager.enableScrollWheelPan()},disableScrollWheelPan:function(){this.isScrollWheelPan&&this.navigationManager.disableScrollWheelPan()},showPanArrows:function(){this._navDiv&&(this._navDiv.style.display="block",this.isPanArrows=!0)},hidePanArrows:function(){this._navDiv&&(this._navDiv.style.display="none",this.isPanArrows=!1)},showZoomSlider:function(){this._slider&&(S(this._slider.domNode||this._slider,"visibility","inherit"),
this.isZoomSlider=!0)},hideZoomSlider:function(){this._slider&&(S(this._slider.domNode||this._slider,"visibility","hidden"),this.isZoomSlider=!1)},onClick:function(g){g.graphic||(g.graphic=this.syncHitTestForWebGL(g))}});return t.Map=F})},"esri/_coremap":function(){define("require module dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/_base/event dojo/_base/unload dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/sniff dijit/registry dojox/gfx/matrix ./kernel ./config ./basemaps ./lang ./Evented ./fx ./deferredUtils ./tileUtils ./urlUtils ./PluginTarget ./Color ./promiseList ./arcade/Dictionary ./geometry/Point ./geometry/ScreenPoint ./geometry/Extent ./geometry/Rect ./geometry/mathUtils ./geometry/scaleUtils ./geometry/screenUtils ./geometry/webMercatorUtils ./layers/GraphicsLayer ./layers/TileInfo ./layers/LOD ./layers/ArcGISTiledMapServiceLayer ./layers/MapImageLayer ./layers/OpenStreetMapLayer ./layers/support/webglUtils ./dijit/Popup ./plugins/popupManager dojo/uacss".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L,v,b,g,W,N,U,M,Z,da,oa,wa,ra,Ba,Ia,Ma){function Za(I,Y){var ca=I.lods;ca.sort(function(T,Q){return T.scale>Q.scale?-1:T.scale<Q.scale?1:0});var a=[];ca=P.filter(ca,function(T){if(-1===gb(a,T.scale))return a.push(T.scale),!0});var l=Y.lods=[],B;P.forEach(ca,function(T,Q){B=l[Q]=new oa(T);B.level=Q});Y.tileInfo=new da(kb(I,{lods:l}))}var bb,Sa=U.toMapPoint,Na=U.toScreenPoint,fb=X.connect,hb=X.disconnect,$a=V.hitch,jb=h.set,
gb=P.indexOf,kb=V.mixin,mb=0,db=y.defaults.map,ob=db.layerNamePrefix,rb=db.graphicsLayerNamePrefix,wb=new RegExp("^"+ob+"(\\d+)$"),sb=new RegExp("^"+rb+"(\\d+)$"),tb=function(){},pb=0,xb=Ia.isWebGLEnabled();R=R([w,A],{declaredClass:"esri._CoreMap",tables:null,resizeDelay:300,invalidExtent:"Map does not have a valid extent.",invalidGeometry:"Geometry (wkid: ${geometry}) cannot be converted to spatial reference of the map (wkid: ${map})",unknownBasemap:'Unable to find basemap definition for: "${basemapName}". Try one of these: ${list}',
invalidBasemap:'Unable to add basemap: "${basemapName}".',unknownLayerType:'Unknown basemap layer type: "${type}" found in basemap definition for: "${basemapName}".',visible:!0,webglEnabled:xb,_eventMap:{"basemap-change":!0,"extent-change":["extent","delta","levelChange","lod"],"layer-add":["layer"],"layer-add-result":["layer","error"],"layer-remove":["layer"],"layer-reorder":["layer","index"],"layer-resume":["layer"],"layer-suspend":["layer"],"layers-add-result":["layers"],"layers-removed":!0,"layers-reordered":["layerIds"],
load:["map"],pan:["extent","delta"],"pan-end":["extent","delta"],"pan-start":["extent","screenPoint"],reposition:["x","y"],resize:["extent","width","height"],scale:["matrix","immediate"],"time-extent-change":["timeExtent"],"before-unload":["map"],unload:["map"],"update-end":["error"],"update-start":!0,zoom:["extent","zoomFactor","anchor"],"zoom-end":["extent","zoomFactor","anchor","level"],"zoom-start":["extent","zoomFactor","anchor","level"],click:!0,"dbl-click":!0,"key-down":!0,"key-up":!0,"mouse-down":!0,
"mouse-drag":!0,"mouse-drag-end":!0,"mouse-drag-start":!0,"mouse-move":!0,"mouse-out":!0,"mouse-over":!0,"mouse-up":!0,"mouse-wheel":!0,"basic-tap":!0,"double-tap":!0,"pinch-end":!0,"pinch-move":!0,"pinch-start":!0,"processed-double-tap":!0,"processed-tap":!0,"swipe-end":!0,"swipe-move":!0,"swipe-start":!0,tap:!0,"two-finger-tap":!0},constructor:function(I,Y){Y=Y||{};this.registerConnectEvents();kb(this,{_internalLayerIds:[],_layers:[],_layerDivs:[],_basemapPending:!1,_connects:[],_layerAddPromises:{},
_zoomAnimDiv:null,_zoomAnim:null,_layersDiv:null,_firstLayerId:null,_delta:null,_cursor:null,_ratioW:1,_ratioH:1,_params:null,_minResolution:0,_maxResolution:0,cursor:null,layerIds:[],graphicsLayerIds:[],graphics:null,_labels:null,loaded:!1,__panning:!1,__zooming:!1,__container:null,root:null,__LOD:null,__tileInfo:null,__visibleRect:null,__visibleDelta:null,_rids:[],_webglContextOwners:[]});var ca=this.container=C.byId(I),a=this.id=z.get(ca,"id")||t.getUniqueId(this.declaredClass);x.add(ca,"map");
var l=q.getContentBox(ca),B=x.add,T=f.create;this.position=new v(0,0);this._reposition();var Q=this.width=0<l.w?l.w:db.width,aa=this.height=0<l.h?l.h:db.height,ha=this.root=T("div",{id:a+"_root",style:{width:Q+"px",height:aa+"px",direction:"ltr"}});B(ha,"esriMapContainer");l=this.__container=T("div",{id:a+"_container"},ha);jb(l,"position","absolute");B(l,"esriMapContainer");ca.appendChild(ha);ca=this._params=kb({slider:!0,nav:!1,zoom:-1,minZoom:-1,maxZoom:-1,scale:-1,minScale:0,maxScale:0,showInfoWindowOnClick:!0,
displayGraphicsOnPan:!0,wrapAround180:!0,fitExtent:!1,optimizePanAnimation:!0},Y);this.setWebGLEnabled(null!=ca.webglEnabled?ca.webglEnabled:this.webglEnabled);this.maxWebGLContexts=null!=ca.maxWebGLContexts?ca.maxWebGLContexts:-1;this.wrapAround180=ca.wrapAround180;this.optimizePanAnimation=ca.optimizePanAnimation;this.setBackgroundColor(ca.backgroundColor);n.isDefined(ca.resizeDelay)&&(this.resizeDelay=ca.resizeDelay);ca.lods&&(Za({rows:512,cols:512,dpi:96,format:"JPEG",compressionQuality:75,origin:{x:-180,
y:90},spatialReference:{wkid:4326},lods:ca.lods},ca),this.__tileInfo=ca.tileInfo);this.extent=ca.extent;this._extentUtil({mapCenter:ca.center,targetLevel:ca.zoom,targetScale:ca.scale});this.__visibleRect=new g(0,0,Q,aa);this.__visibleDelta=new g(0,0,Q,aa);a=this._layersDiv=T("div",{id:a+"_layers"});B(a,"esriMapLayers");l.appendChild(a);this._zoomAnimDiv=T("div",{style:{position:"absolute"}});ca.infoWindow?this.infoWindow=ca.infoWindow:(B=this.infoWindow=new Ma(ca.popupOptions,T("div")),B.startup(),
B._ootb=!0,jb(B.domNode,"zIndex",40));if(ca.showLabels){var la=this;O(["./layers/LabelLayer"],function(ia){bb=ia;la._createLabelLayer()});this.on("load",function(){la._createLabelLayer()})}this.addPlugin(this._getAbsMid("./plugins/popupManager"),{enabled:ca.showInfoWindowOnClick});this._zoomStartHandler=$a(this,this._zoomStartHandler);this._zoomingHandler=$a(this,this._zoomingHandler);this._zoomEndHandler=$a(this,this._zoomEndHandler);this._panningHandler=$a(this,this._panningHandler);this._panEndHandler=
$a(this,this._panEndHandler);this._endTranslate=$a(this,this._endTranslate);this._timedResize=$a(this,this._timedResize);this._execResize=$a(this,this._execResize);this._processLabelLayers=$a(this,this._processLabelLayers);this._updateLabelLayers=$a(this,this._updateLabelLayers);this.resize=$a(this,this.resize);u.addOnWindowUnload(this,this.destroy)},_getAbsMid:function(I){return O.toAbsMid?O.toAbsMid(I):F.id.replace(/\/[^\/]*$/ig,"/")+I},_cleanUp:function(){var I=this.infoWindow;I&&(I._ootb&&I.destroy?
I.destroy():I.unsetMap(this),delete this.infoWindow);hb(this._tsTimeExtentChange_connect);this.removePlugin("./plugins/popupManager");f.destroy(this.root);this.root=null},_addLayer:function(I,Y,ca){if(I.id){var a=I.id.match(I instanceof Z?sb:wb);a&&a[1]&&(a=Number(a[1]),mb<=a&&(mb=a+1))}var l=I.id||(I instanceof Z?rb:ob)+mb++;I.id=l;this._layers[l]=I;I._isRefLayer="top"===ca;ca=!n.isDefined(ca)||0>ca||ca>Y.length||"top"===ca?Y.length:ca;var B;if(!I._isRefLayer)for(;(B=this.getLayer(Y[ca-1]))&&B._isRefLayer;)ca--;
if(a=!this._firstLayerId&&!this.loaded&&!this._basemapPending&&0===ca&&(Y===this.layerIds||Y===this.graphicsLayerIds))this._firstLayerId=l;Y.splice(ca,0,l);var T=$a(this,this._addLayerHandler),Q=this;ca=this._connects;B=function(){I.loaded?Q._onLoadFix?(Q._onLoadFix=!1,setTimeout(function(){T(I)},0)):T(I):(Q["_"+l+"_addtoken_load"]=fb(I,"onLoad",Q,"_addLayerHandler"),Q["_"+l+"_addtoken_err"]=fb(I,"onError",Q,function(aa){T(I,aa,Y)}))};this.loaded||a||I.loaded&&-1===gb(this.graphicsLayerIds,l)?B():
ca.push(fb(this,"onLoad",B));return I},_forgetLayer:function(I){I=I.id;hb(this["_"+I+"_addtoken_load"]);hb(this["_"+I+"_addtoken_err"]);var Y=this._layerAddPromises[I];Y&&(delete this._layerAddPromises[I],Y.cancel())},_addLayerHandler:function(I,Y,ca){Y?this._attachLayerToMap(I,Y,ca):I._prepareToAttach?(this._layerAddPromises[I.id]=I._prepareToAttach(this)).always(V.hitch(this,function(a){a&&"cancel"===a.dojoType||this._attachLayerToMap(I,null,ca)})):I.declaredClass&&(-1<I.declaredClass.toLowerCase().indexOf("vectortilelayer")||
-1<I.declaredClass.toLowerCase().indexOf("rasterxlayer")&&I.useWebGL)&&!this.isWebGLContextAvailable()?(Y=Error("Too many WebGL contexts. Unable to add the layer: ",I.url),this._attachLayerToMap(I,Y,this.layerIds)):this._attachLayerToMap(I,Y,ca)},_attachLayerToMap:function(I,Y,ca){var a=this.id,l=I.id,B=gb(I instanceof Z?this.graphicsLayerIds:this.layerIds,l),T=B,Q=!1,aa=this._params;this._forgetLayer(I);if(Y)delete this._layers[l],-1!==B&&(ca.splice(B,1),this.onLayerAddResult(I,Y));else{-1===B&&
(B=gb(this._internalLayerIds,l),T=20+B,Q=!0);if(l===this._firstLayerId){Y=I.spatialReference;ca=this.extent&&this.extent.spatialReference;!ca||ca.equals(Y)||!I.tileInfo&&I.url||(ca=null);ca=this.spatialReference=ca||Y;this.wrapAround180=this.wrapAround180&&ca&&ca._isWrappable()?!0:!1;I.tileInfo&&(this.__tileInfo?(Y=this.__tileInfo.lods,this.__tileInfo=kb({},I.tileInfo),this.__tileInfo.lods=Y):(Za(kb({},I.tileInfo),aa),this.__tileInfo=aa.tileInfo));if(this.wrapAround180){Y=this.__tileInfo;ca=ca._getInfo();
if(!Y||Math.abs(ca.origin[0]-Y.origin.x)>ca.dx)this.wrapAround180=!1;this.wrapAround180&&Y&&E._addFrameInfo(Y,ca)}aa.units=I.units;if((Y=this.__tileInfo&&this.__tileInfo.lods)&&Y.length){ca=aa.minScale;B=aa.maxScale;var ha=-1,la=-1,ia=!1,sa=!1,ta;for(ta=0;ta<Y.length;ta++)0<ca&&!ia&&ca>=Y[ta].scale&&(ha=Y[ta].level,ia=!0),0<B&&!sa&&B>=Y[ta].scale&&(la=0<ta?Y[ta-1].level:-1,sa=!0);-1===aa.minZoom&&(aa.minZoom=0===ca?Y[0].level:ha);-1===aa.maxZoom&&(aa.maxZoom=0===B?Y[Y.length-1].level:la);for(ta=0;ta<
Y.length;ta++)aa.minZoom===Y[ta].level&&(aa.minScale=Y[ta].scale,this._minResolution=Y[ta].resolution),aa.maxZoom===Y[ta].level&&(aa.maxScale=Y[ta].scale,this._maxResolution=Y[ta].resolution)}else aa.minZoom=aa.maxZoom=aa.zoom=-1}I instanceof Z?(this._gc||(this._gc=new Z._GraphicsContainer,this._gc._setMap(this,this._layersDiv).id=a+"_gc"),this._attachGraphicsLayer(I).id=a+"_"+l):(T=I._setMap(this,this._layersDiv,T,this.__LOD),T.id=a+"_"+l,this._layerDivs[l]=T,this._reorderLayers(this.layerIds),Q||
-1===I.declaredClass.indexOf("VETiledLayer")||this._onBingLayerAdd(I));l===this._firstLayerId&&(this.graphics=new Z({id:a+"_graphics",displayOnPan:aa.displayGraphicsOnPan}),this._addLayer(this.graphics,this._internalLayerIds,20));if(I===this.graphics){ca=this._layers[this._firstLayerId];a=aa.zoom;T=aa.scale;Y=aa.center;ca=ca.initialExtent||ca.fullExtent;this._firstLayerId=null;this.extent&&(this.extent=this._convertGeometry(this,this.extent));!this.extent&&ca&&(Y&&(Y=this._convertGeometry(ca,Y)),
Y&&(ca=ca.centerAt(Y),Y=null));if(Y=this.extent||ca&&new b(ca.toJson()))-1<a?Y=this.__getExtentForLevel(a,null,Y).extent:0<T&&(Y=N.getExtentForScale(this,T,Y));if(!Y)return;aa=this._fixExtent(Y,aa.fitExtent);this.extent=aa.extent;this.__LOD=aa.lod;this.__setExtent(this.extent);this.loaded=!0;this.attr("data-loaded","");this.infoWindow.setMap(this);this.onLoad(this)}Q||(this.onLayerAdd(I),this.onLayerAddResult(I));hb(this[l+"_addLayerHandler_connect"])}},_convertGeometry:function(I,Y){var ca=I&&I.spatialReference,
a=Y&&Y.spatialReference;ca&&a&&!ca.equals(a)&&(ca._canProject(a)?ca.isWebMercator()?Y=M.geographicToWebMercator(Y):4326===ca.wkid&&(Y=M.webMercatorToGeographic(Y,!0)):Y=null);return Y},_attachGraphicsLayer:function(I){var Y=I.id;I=I._setMap(this,this._gc._surface);this._layerDivs[Y]=I;this._reorderLayers(this.graphicsLayerIds);return I},_detachGraphicsLayer:function(I){I.loaded&&I.getMap()&&I._unsetMap(this,this._gc._surface)},_reorderLayers:function(I){var Y=this.onLayerReorder,ca=f.place,a=this._layerDivs,
l=this._layers,B=this._gc?this._gc._surface.getEventSource():null;if(I===this.graphicsLayerIds)P.forEach(I,function(la,ia){var sa=a[la],ta=l[la];sa&&(this._gc._reorderLayer(ta,sa,ia),Y(ta,ia))},this);else{var T=this.graphics,Q=T?T.id:null,aa=this._layersDiv,ha;P.forEach(I,function(la,ia){ha=a[la];la!==Q&&ha&&(ca(ha,aa,ia),Y(l[la],ia))});this._mapImageLyr&&this._placeMapImageLyr();B&&(B=9>e("ie")?B.parentNode:B,ca(B,B.parentNode,"last"))}this.onLayersReordered([].concat(I))},_zoomStartHandler:function(){this.__zoomStart(this._zoomAnimDiv.startingExtent,
this._zoomAnimDiv.anchor)},_zoomingHandler:function(I){var Y=parseFloat(I.left),ca=parseFloat(I.top);I=new b(Y,ca-parseFloat(I.height),Y+parseFloat(I.width),ca,this.spatialReference);Y=this.extent.getWidth()/I.getWidth();this.__zoom(I,Y,this._zoomAnimDiv.anchor)},_zoomEndHandler:function(){var I=this._zoomAnimDiv,Y=I.extent,ca=this.extent.getWidth()/Y.getWidth(),a=I.anchor,l=I.newLod,B=I.levelChange;I.extent=I.anchor=I.levelChange=I.startingExtent=I.newLod=this._delta=this._zoomAnim=null;this.__zoomEnd(Y,
ca,a,l,B)},_panningHandler:function(I){if(isNaN(parseFloat(I.left))||isNaN(parseFloat(I.top))){var Y=Math.round,ca=this._panAnim.node;I.left=-1*(this._delta.x-Y(this.width/2))+"px";I.top=-1*(this._delta.y-Y(this.height/2))+"px";h.set(ca,"left",I.left);h.set(ca,"top",I.top)}I=new v(parseFloat(I.left),parseFloat(I.top));Y=this.toMap(I);this.onPan(this.extent.offset(this.extent.xmin-Y.x,this.extent.ymax-Y.y),I)},_panEndHandler:function(I){this.__panning=!1;var Y=Math.round;I=new v(-Y(parseFloat(I.style.left)),
-Y(parseFloat(I.style.top)));Y=I.x;var ca=I.y,a=this.__visibleRect,l=this.__visibleDelta;a.x+=-Y;a.y+=-ca;l.x+=-Y;l.y+=-ca;jb(this._zoomAnimDiv,{left:"0px",top:"0px"});a=this.extent;l=this._ratioW;var B=this._ratioH;a=new b(a.xmin+Y/l,a.ymin-ca/B,a.xmax+Y/l,a.ymax-ca/B,this.spatialReference);I.setX(-I.x);I.setY(-I.y);this._delta=this._panAnim=null;this._updateExtent(a);this.onPanEnd(a,I);this._fireExtChg([a,I,!1,this.__LOD])},_fixExtent:function(I,Y){for(var ca=this._reshapeExtent(I),a=1.25;!0===
Y&&(ca.extent.getWidth()<I.getWidth()||ca.extent.getHeight()<I.getHeight())&&0<ca.lod.level&&3>=a;)ca=this._reshapeExtent(I.expand(a)),a+=.25;return ca},_getFrameWidth:function(){var I=-1,Y=this.spatialReference._getInfo();this.__LOD?(Y=this.__LOD._frameInfo)&&(I=Y[3]):Y&&(I=Math.round(2*Y.valid[1]/(this.extent.getWidth()/this.width)));return I},_fixAspectRatio:function(I){var Y=I.getWidth(),ca=I.getHeight(),a=Y/ca,l=this.width/this.height,B=0,T=0;this.width>this.height?Y>ca?l>a?B=ca*l-Y:T=Y/l-ca:
B=ca*l-Y:this.width<this.height?Y<ca?l>a?B=ca*l-Y:T=Y/l-ca:T=Y/l-ca:Y<ca?B=ca-Y:Y>ca&&(T=Y/l-ca);B&&(I.xmin-=B/2,I.xmax+=B/2);T&&(I.ymin-=T/2,I.ymax+=T/2);return I},_reshapeExtent:function(I){I=this._fixAspectRatio(I);return this._getAdjustedExtent(I)},_getAdjustedExtent:function(I){if(this.__tileInfo)return E.getCandidateTileInfo(this,this.__tileInfo,I);var Y=N.getScale(this,I),ca=this.getMinScale(),a=this.getMaxScale();!ca||Y<=ca?!a||Y>=a||(I=N.getExtentForScale(this,a,I)):I=N.getExtentForScale(this,
ca,I);return{extent:I}},_onBingLayerAdd:function(I){this["__"+I.id+"_vis_connect"]=X.connect(I,"onVisibilityChange",this,"_toggleBingLogo");this._toggleBingLogo(I.visible)},_onBingLayerRemove:function(I){X.disconnect(this["__"+I.id+"_vis_connect"]);delete this["__"+I.id+"_vis_connect"];var Y=P.some(this.layerIds,function(ca){return(I=this._layers[ca])&&I.visible&&-1!==I.declaredClass.indexOf("VETiledLayer")},this);this._toggleBingLogo(Y)},_toggleBingLogo:function(I){I&&!this._bingLogo?(I={left:this._mapParams&&
this._mapParams.nav?"25px":""},6===e("ie")&&(I.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+O.toUrl("./images/map/bing-logo-lg.png")+"')"),I=this._bingLogo=f.create("div",{style:I},this.root),x.add(I,"bingLogo-lg")):!I&&this._bingLogo&&(f.destroy(this._bingLogo),delete this._bingLogo)},__panStart:function(I,Y){var ca=this._zoomAnim,a=this._panAnim;if(ca&&ca._active)ca.stop(),ca._fire("onEnd",[ca.node]);else if(a&&a._active){a.stop();
this._panAnim=null;a=a.curve.getValue(a._getStep());ca=Math.round(parseFloat(a.left));a=Math.round(parseFloat(a.top));var l=this.navigationManager._dragOrigin;this.__pan(ca,a);l&&(l.x-=ca,l.y-=a);return}this.__panning=!0;this.onPanStart(this.extent,new v(I,Y))},__pan:function(I,Y){var ca=this.extent,a=this._ratioW,l=this._ratioH;this.onPan(new b(ca.xmin-I/a,ca.ymin+Y/l,ca.xmax-I/a,ca.ymax+Y/l,this.spatialReference),new v(I,Y))},__panEnd:function(I,Y){var ca=this.__visibleRect,a=this.__visibleDelta;
ca.x+=I;ca.y+=Y;a.x+=I;a.y+=Y;ca=new v(I,Y);a=this.extent;var l=this._ratioW,B=this._ratioH;a=new b(a.xmin-I/l,a.ymin+Y/B,a.xmax-I/l,a.ymax+Y/B,this.spatialReference);this.__panning=!1;this._updateExtent(a);this.onPanEnd(a,ca);this._fireExtChg([a,ca,!1,this.__LOD])},__zoomStart:function(I,Y){this.__zooming=!0;this.onZoomStart(I,1,Y,this.__LOD?this.__LOD.level:null)},__zoom:function(I,Y,ca){this.onZoom(I,Y,ca)},__zoomEnd:function(I,Y,ca,a,l){jb(this._layersDiv,{left:"0px",top:"0px"});this._delta=new v(0,
0);this.__visibleRect.x=this.__visibleRect.y=0;I=new b(I);this.__LOD=a;this._ratioW=this.width/I.getWidth();this._ratioH=this.height/I.getHeight();var B=this._delta;this._delta=null;this.__zooming=!1;this._updateExtent(I,l);this.onZoomEnd(I,Y,ca,a?a.level:null);this._fireExtChg([I,B,l,a])},_extentUtil:function(I,Y,ca,a,l){var B=new ba,T=this.width,Q=this.height;if(I){var aa=I.numLevels;var ha=I.targetLevel;var la=n.isDefined(ha);var ia=I.factor;var sa=I.mapAnchor;var ta=I.screenAnchor;var za=I.mapCenter;
var Fa=I.levelOrFactor;var Ja=I.targetScale;var Ga=n.isDefined(Ja)&&0<Ja}if(Y){var Aa=Y.dx;var Ka=Y.dy;za=Y.mapCenter}V.isArray(za)&&(za=new L(za));var Va=this._panAnim;Y=(I=this._stopAnim())?I.divExtent:this.extent;var Ua=this.__tileInfo,Ra=this._params;if(!this.loaded){if(ca)Y&&(ca=this._convertGeometry(Y,ca)),ca&&(this.extent=ca,Ra.zoom=Ra.scale=-1,Ra.center=null);else if(za||la||Ga){if(za)if(Y){if(za=this._convertGeometry(Y,za))this.extent=Y.centerAt(za),Ra.center=null}else Ra.center=za;la&&-1<
ha?(Ra.zoom=ha,Ra.scale=-1):Ga&&(Ra.scale=Ja,Ra.zoom=-1)}B.resolve();return B}if(za&&(za=this._convertGeometry(this,za),!za)||sa&&(sa=this._convertGeometry(this,sa),!sa)||ca&&(ca=this._convertGeometry(this,ca),!ca))return B.reject(),B;Va&&sa&&ta&&(sa=Sa(this.extent,T,Q,ta));I&&sa&&ta&&(sa=Sa(I.divExtent,T,Q,ta));if(la)if(Ua)aa=this.getMinZoom(),la=this.getMaxZoom(),ha<aa?ha=aa:ha>la&&(ha=la),aa=ha-(I?I.level:this.getLevel());else{aa=0<ha?-1:1;var Oa=Fa?ha:null}if(!ca)if(n.isDefined(aa))Ua?(T=I?I.level:
this.getLevel(),T=this.__getExtentForLevel(T+aa,za,Y).extent):(T=(I?I.end:this.extent).expand(Oa||(0<aa?.5*aa:2*-aa)),Oa&&za&&(T=T.centerAt(za))),T&&(za?ca=T:(Aa=sa||Y.getCenter(),Q=T.getWidth(),Ka=T.getHeight(),T=Aa.x>=Y.xmin&&Aa.x<=Y.xmax?(Aa.x-Y.xmin)/Y.getWidth():.5,ca=Aa.y>=Y.ymin&&Aa.y<=Y.ymax?(Aa.y-Y.ymin)/Y.getHeight():.5,T=Aa.x-T*Q,Aa=Aa.y-ca*Ka,ca=new b(T,Aa,T+Q,Aa+Ka,this.spatialReference)));else if(Ga)ca=N.getExtentForScale(this,Ja,Y);else if(n.isDefined(ia))ca=Y.expand(ia);else if(Aa||
Ka)I?(ca=I.end,sa=ca.getCenter(),Oa=Na(ca,T,Q,sa),Oa.x+=Aa,Oa.y+=Ka,Oa=Sa(ca,T,Q,Oa),ca=ca.offset(Oa.x-sa.x,Oa.y-sa.y)):(Aa=new v(T/2+Aa,Q/2+Ka),Aa=Sa(Y,T,Q,Aa),Q=Y.getWidth(),Ka=Y.getHeight(),T=Aa.x-Q/2,Aa=Aa.y-Ka/2,ca=new b(T,Aa,T+Q,Aa+Ka,this.spatialReference));ca||(za?(Y=I?I.end:Y,Q=Y.getWidth(),Ka=Y.getHeight(),T=za.x-Q/2,Aa=za.y-Ka/2,ca=new b(T,Aa,T+Q,Aa+Ka,this.spatialReference)):I&&(ca=I.end));ca?(this._extentDfd&&-1===this._extentDfd.fired&&(this._extentDfd.then(null,tb),this._extentDfd.reject()),
this._extentDfd=B,this.__setExtent(ca,null,ta,a,I,l)):B.reject();return B},__setExtent:function(I,Y,ca,a,l,B){try{if(this._firstLayerId)this.extent=I;else{var T=!0,Q=this.spatialReference,aa=l?l.divExtent:this.extent,ha=this._fixExtent(I,a||!1);I=ha.extent;var la=I.getWidth(),ia=I.getHeight(),sa=Math.round;if(aa){var ta=sa(1E6*aa.getWidth()),za=sa(1E6*la),Fa=sa(1E6*aa.getHeight()),Ja=sa(1E6*ia);T=ta!==za||Fa!==Ja}var Ga,Aa=l&&l.rect,Ka=l&&l.divExtent;if(db.zoomDuration&&T&&aa){Ka=Ka||new b(aa);Aa=
Aa||{left:aa.xmin,top:aa.ymax,width:aa.getWidth(),height:aa.getHeight()};var Va={left:I.xmin,top:I.ymax,width:la,height:ia};var Ua=new L(I.xmin,I.ymax,Q),Ra=new L(I.xmin,I.ymin,Q),Oa=new L(this.extent.xmin,this.extent.ymax,Q),La=new L(this.extent.xmin,this.extent.ymin,Q);(Ga=W.getLineIntersection(Oa,Ua,La,Ra,Q))||l||(T=!1)}this._ratioW=this.width/la;this._ratioH=this.height/ia;var Ha=this._zoomAnimDiv;if(T)if(jb(this._layersDiv,{left:"0px",top:"0px"}),Y=new v(0,0),this.__visibleRect.x=this.__visibleRect.y=
0,Aa&&Va){this._delta=Y;Ha.id="_zAD";Ha.startingExtent=Ka;Ha.extent=I;Ha.levelChange=T;Ha.newLod=ha.lod;Ha.anchor=ca?ca:!Ga&&l?l.anchor:Na(this.extent,this.width,this.height,Ga);var Wa=this.extent.getWidth()/I.getWidth();db.zoomAnimationThrottled&&1024<(1>Wa?1/Wa:Wa)?(this.__zoomStart(Ka,Ha.anchor),this.__zoom(Ka,1,Ha.anchor),this._fireOnScale(1,Ha.anchor,!0),this.__zoomEnd(I,Wa,Ha.anchor,ha.lod,T)):(this._zoomAnim=c.resize({node:Ha,start:Aa,end:Va,duration:db.zoomDuration,rate:db.zoomRate,beforeBegin:l?
null:this._zoomStartHandler,onAnimate:this._zoomingHandler,onEnd:this._zoomEndHandler}).play(),this._fireOnScale(Wa,Ha.anchor,B))}else this._updateExtent(I,T,B),this._fireExtChg([this.extent,Y,T,this.__LOD=ha.lod]);else if(!this.__panning)if(!1===this.loaded||B)this._updateExtent(I,T,B),this._fireExtChg([this.extent,Y,T,this.__LOD=ha.lod]);else{this.__panning=!0;Aa=(new g(0,0,this.width,this.height,this.spatialReference)).getCenter();Aa.x=sa(Aa.x);Aa.y=sa(Aa.y);var ab=this._delta=this.toScreen(I.getCenter()),
lb=Math.abs(Aa.x-ab.x),ub=Math.abs(Aa.y-ab.y);this.optimizePanAnimation&&(lb>2*this.width||ub>2*this.height)?(this.__panStart(0,0),this.__pan(0,0),this.__visibleRect.x=this.__visibleRect.y=this.__visibleDelta.x=this.__visibleDelta.y=0,this.__panning=!1,this._delta=null,this._updateExtent(I,!1,B),this.onPanEnd(this.extent,new v(0,0)),this._fireExtChg([this.extent,new v(0,0),!0,this.__LOD])):(this.onPanStart(this.extent,new v(0,0)),this._panAnim=c.slideTo({node:Ha,left:Aa.x-ab.x,top:Aa.y-ab.y,duration:db.panDuration,
rate:db.panRate,onAnimate:this._panningHandler,onEnd:this._panEndHandler}),this._panAnim.play())}}}catch(qb){}},_fireOnScale:function(I,Y,ca){if("css-transforms"===this.navigationMode){var a=this.__visibleDelta;this.onScale(k.scaleAt(I,{x:-1*(this.width/2-(Y.x-a.x)),y:-1*(this.height/2-(Y.y-a.y))}),ca)}},_stopAnim:function(){var I=this._zoomAnim,Y=this._panAnim;if(I&&I._active){I.stop();Y=I.curve.getValue(I._getStep());var ca=parseFloat(Y.left),a=parseFloat(Y.top);I=I.node;return{anchor:I.anchor,
start:I.startingExtent,end:I.extent,level:I.newLod&&I.newLod.level,rect:Y,divExtent:new b(ca,a-parseFloat(Y.height),ca+parseFloat(Y.width),a,this.spatialReference)}}Y&&Y._active&&(Y.stop(),Y._fire("onEnd",[Y.node]))},__getExtentForLevel:function(I,Y,ca){var a=this.__tileInfo;a=a&&a.lods;I=n.isDefined(I)?I:0;ca=ca||this.extent;Y=Y||ca&&ca.getCenter();if(a){if(Y){ca=this.getMinZoom();var l=this.getMaxZoom();I>l&&(I=l);I<ca&&(I=ca);I=a[I];a=this.width*I.resolution/2;ca=this.height*I.resolution/2;return{extent:new b(Y.x-
a,Y.y-ca,Y.x+a,Y.y+ca,Y.spatialReference),lod:I}}}else return ca?{extent:ca.expand(!I||1>I?1:I).centerAt(Y)}:void 0},_jobs:0,_incr:function(){1===++this._jobs&&(this.updating=!0,this.attr("data-updating",""),this.onUpdateStart())},_decr:function(){var I=--this._jobs;I?0>I&&(this._jobs=0):(this.updating=!1,this.attr("data-updating"),this.onUpdateEnd())},_fireEvent:function(I,Y){this[I]&&this[I].apply(this,Y)},_updateExtent:function(I,Y,ca){this.extent=I;I=this.spatialReference;this._viewInfo={view:new ea({viewingMode:"map",
scale:this.getScale()}),sr:I,version:Y?++pb:pb};(Y||ca)&&this._setClipRect();this._calcGeographicExtent()},_calcGeographicExtent:function(){var I=this.spatialReference;I&&(I.isWebMercator()?this.geographicExtent=M.webMercatorToGeographic(this._getAvailExtent(),!0):4326===I.wkid&&(this.geographicExtent=new b(this._getAvailExtent().toJson())))},_fireExtChg:function(I){this.attr("data-zoom",this.getZoom());this.attr("data-scale",this.getScale());this._fireEvent("onExtentChange",I);if(I=this._extentDfd)delete this._extentDfd,
I.resolve()},attr:function(I,Y){var ca=this.container;ca&&(null==Y?ca.removeAttribute(I):ca.setAttribute(I,Y));return this},onUpdateStart:function(){},onUpdateEnd:function(){},onLoad:function(){this._setClipRect();this._calcGeographicExtent()},onBeforeUnload:function(){},onUnload:function(){},onExtentChange:function(I,Y,ca){},onTimeExtentChange:function(){},onWebGLEnabledChange:function(){},onLayerAdd:function(){},onLayerAddResult:function(){},onLayersAddResult:function(){},onLayerRemove:function(){},
onLayersRemoved:function(){},onLayerReorder:function(){},onLayersReordered:function(){},onLayerSuspend:function(){},onLayerResume:function(){},onPanStart:function(){},onPan:function(){},onPanEnd:function(){},onScale:function(){},onZoomStart:function(){},onZoom:function(){},onZoomEnd:function(){},onResize:function(){this._setClipRect()},onReposition:function(){},destroy:function(){this._destroyed||(this.onBeforeUnload(this),this.removeAllLayers(),this.releaseAllWebGLContexts(),this._cleanUp(),clearTimeout(this._resizeTimerHandle),
this._gc&&this._gc._cleanUp(),this._destroyed=!0,this.onUnload(this))},setCursor:function(I){jb(this.__container,"cursor",this.cursor=I)},setMapCursor:function(I){this.setCursor(this._cursor=I)},resetMapCursor:function(){this.setCursor(this._cursor)},setBackgroundColor:function(I){I&&!I.declaredClass&&(I=new S(I));this.backgroundColor=I||null;var Y="";I&&(Y=9>e("ie")?I.toHex():"rgba("+I.toRgba().join(",")+")");h.set(this.root,{backgroundColor:Y})},setInfoWindow:function(I){var Y=this.infoWindow;Y&&
Y.unsetMap(this);this.infoWindow=I;this.loaded&&I&&I.setMap(this)},setInfoWindowOnClick:function(I){this._params.showInfoWindowOnClick=I;this.popupManager&&this.popupManager.set("enabled",I)},getInfoWindowAnchor:function(I){return this.infoWindow&&this.infoWindow._getAnchor&&this.infoWindow._getAnchor(I)||"upperright"},toScreen:function(I,Y){return Na(this.extent,this.width,this.height,I,Y)},toMap:function(I){return Sa(this.extent,this.width,this.height,I)},addLayer:function(I,Y){I&&!this.getLayer(I.id)&&
this._addLayer(I,I instanceof Z?this.graphicsLayerIds:this.layerIds,Y);return I},addLayers:function(I){var Y=[],ca=I.length,a,l=I.length;var B=X.connect(this,"onLayerAddResult",function(T,Q){-1!==P.indexOf(I,T)&&(ca--,Y.push({layer:T,success:!Q,error:Q}),ca||(X.disconnect(B),this.onLayersAddResult(Y)))});for(a=0;a<l;a++)this.addLayer(I[a]);return this},removeLayer:function(I,Y){var ca=I.id,a=I instanceof Z?this.graphicsLayerIds:this.layerIds,l=gb(a,ca);0<=l&&(this._forgetLayer(I),a.splice(l,1),this.loaded||
this._firstLayerId!==ca||(this._firstLayerId=null),I instanceof Z?this._detachGraphicsLayer(I):I.loaded&&(I.getMap()&&I._unsetMap(this,this._layersDiv),-1!==I.declaredClass.indexOf("VETiledLayer")&&this._onBingLayerRemove(I)),delete this._layers[ca],delete this._layerDivs[ca],Y||this._reorderLayers(a),this.onLayerRemove(I))},removeAllLayers:function(){var I=this.layerIds,Y;for(Y=I.length-1;0<=Y;Y--)this.removeLayer(this._layers[I[Y]],1);I=this.graphicsLayerIds;for(Y=I.length-1;0<=Y;Y--)this.removeLayer(this._layers[I[Y]],
1);this.onLayersRemoved()},reorderLayer:function(I,Y){V.isString(I)&&(d.deprecated(this.declaredClass+": Map.reorderLayer(/*String*/ id, /*Number*/ index) deprecated. Use Map.reorderLayer(/*Layer*/ layer, /*Number*/ index).",null,"v2.0"),I=this.getLayer(I));var ca=I.id,a=I instanceof Z?this.graphicsLayerIds:this.layerIds;0>Y?Y=0:Y>=a.length&&(Y=a.length-1);var l=gb(a,ca);-1!==l&&l!==Y&&(a.splice(l,1),a.splice(Y,0,ca),this._reorderLayers(a))},getLayer:function(I){return this._layers[I]},setWebGLEnabled:function(I){var Y=
this.webglEnabled;this.webglEnabled=(I||!1)&&xb;if(Y!==this.webglEnabled)this.onWebGLEnabledChange()},isWebGLContextAvailable:function(){return Ia.isContextAvailable()&&(-1===this.maxWebGLContexts||0<this.maxWebGLContexts&&this._webglContextOwners.length<this.maxWebGLContexts)},ownsWebGLContext:function(I){return-1!==P.indexOf(this._webglContextOwners,I)},acquireWebGLContext:function(I){return-1!==P.indexOf(this._webglContextOwners,I)?!0:this.isWebGLContextAvailable()?(Ia.acquireContext(I),this._webglContextOwners.push(I),
!0):!1},releaseWebGLContext:function(I){var Y=P.indexOf(this._webglContextOwners,I);-1!==Y&&this._webglContextOwners.splice(Y,1);Ia.releaseContext(I)},releaseAllWebGLContexts:function(){var I=this._webglContextOwners.slice(0);P.forEach(I,function(Y){this.releaseWebGLContext(Y)},this)},syncHitTestForWebGL:function(I){var Y,ca=I.screenPoint;I=this.graphicsLayerIds.slice(0).reverse();P.some(I,function(a){a=this.getLayer(a);a.loaded&&!a.suspended&&a.hasWebGLSurface()&&(Y=a._div.syncHitTest(ca.x,ca.y));
return!!Y},this);return Y},setExtent:function(I,Y){I=new b(I.toJson());var ca=I.getWidth(),a=I.getHeight();return 0===ca&&0===a?this.centerAt(new L({x:I.xmin,y:I.ymin,spatialReference:I.spatialReference&&I.spatialReference.toJson()})):this._extentUtil(null,null,I,Y)},getTargetExtent:function(I){if(I)return I=new b(I.toJson()),0!==I.getWidth()&&0!==I.getHeight()&&(I=(I=this._convertGeometry(this,I))&&this._fixExtent(I).extent),I},centerAt:function(I){return this._extentUtil(null,{mapCenter:I})},centerAndZoom:function(I,
Y){return this._extentUtil({targetLevel:Y,mapCenter:I,levelOrFactor:!0})},getScale:function(){return this.__LOD?this.__LOD.scale:N.getScale(this)},getResolution:function(){return this.__LOD?this.__LOD.resolution:this.extent?this.extent.getWidth()/this.width:0},getResolutionInMeters:function(){return this.getResolution()*N.getUnitValueForSR(this.spatialReference)},getResolutionForPopup:function(){var I=this.getResolution(),Y=this.getResolutionInMeters(),ca=Y/16;return 10>=ca?0:I/Y*ca},getMinResolution:function(){return this._minResolution},
getMaxResolution:function(){return this._maxResolution},getMinScale:function(){return this._params.minScale},getMaxScale:function(){return this._params.maxScale},getViewInfo:function(){return this._viewInfo},setScale:function(I){return this._extentUtil({targetScale:I})},getLayersVisibleAtScale:function(I){var Y=[];(I=I||this.getScale())&&P.forEach(this.layerIds.concat(this.graphicsLayerIds),function(ca){ca=this.getLayer(ca);ca.isVisibleAtScale(I)&&Y.push(ca)},this);return Y},getNumLevels:function(){var I=
this.getMinZoom(),Y=this.getMaxZoom();return I===Y&&0>I?0:Y-I+1},getLevel:function(){return this.__LOD?this.__LOD.level:-1},setLevel:function(I){if(-1<I)return this._extentUtil({targetLevel:I})},getZoom:function(){return this.getLevel()},setZoom:function(I){return this.setLevel(I)},getMinZoom:function(){return this._params.minZoom},getMaxZoom:function(){return this._params.maxZoom},setBasemap:function(I){if(V.isObject(I)){var Y=I;I=Y.title}else Y=K&&K[I];if(Y){this._basemapDfd&&!this._basemapDfd.isFulfilled()&&
this._basemapDfd.cancel();var ca=[],a=0;P.forEach(Y.baseMapLayers||Y.layers,function(B){var T={id:B.id,displayLevels:B.displayLevels,opacity:n.isDefined(B.opacity)?B.opacity:null,visible:n.isDefined(B.visibility)?B.visibility:null};if(T=this._createBaseLayerInstance(B,T,I))ca.push(T),B.isReference||a++},this);ca.length&&a&&(this._basemapDfd=H(ca).otherwise($a(this,function(B){this._basemapPending=!1;B&&"cancel"===B.dojoType&&P.forEach(ca,function(T){T.cancel()});throw B;})).then(function(B){var T=
[],Q=[];P.forEach(B,function(aa){aa&&(aa.layerInfo&&T.push(aa.layerInfo),aa.layer&&Q.push(aa.layer))});return{basemapName:I,infos:T,layers:Q}}).then($a(this,this._waitForBaseLayers)).then($a(this,this._setBasemap)),this._basemapPending=!this.loaded&&!this._basemapDfd.isFulfilled())}else{Y=[];for(var l in K)Y.push(l)}},_createBaseLayerInstance:function(I,Y,ca){var a=new ba;if(I.type)switch(I.type){case "OpenStreetMap":a.resolve({layerInfo:I,layer:new Ba(Y)});break;case "VectorTile":O(["./layers/VectorTileLayer"],
function(B){l=J.normalize(I.url);a.promise.isFulfilled()||a.resolve({layerInfo:I,layer:new B(l,Y)})});break;default:return null}else{var l=J.normalize(I.url);a.resolve({layerInfo:I,layer:new wa(l,Y)})}return a.promise},_waitForBaseLayers:function(I){var Y=new ba(D._dfdCanceller);Y.promise.otherwise(function(a){if(a&&"cancel"===a.dojoType){for(var l in Y._layerEvents)a=Y._layerEvents[l],X.disconnect(a[0]),X.disconnect(a[1]);delete Y._layerEvents}});if(!this.loaded)return Y.resolve(I),Y.promise;var ca=
function(a){Y._pendingLayers--;a=P.indexOf(I.layers,this);-1<a&&(a=Y._layerEvents[a])&&(X.disconnect(a[0]),X.disconnect(a[1]));0>=Y._pendingLayers&&(delete Y._layerEvents,Y.isFulfilled()||Y.resolve(I))};Y._pendingLayers=0;Y._layerEvents={};P.forEach(I.layers,function(a,l){a&&Y._pendingLayers++});P.forEach(I.layers,function(a,l){a&&(a.loaded?ca(a):Y._layerEvents[l]=[X.connect(a,"onLoad",a,ca),X.connect(a,"onError",a,ca)])});return Y.promise},_setBasemap:function(I){var Y=I.layers,ca=I.infos,a=0,l=
!0;this._basemapPending=!1;this.loaded&&(P.forEach(Y,function(T,Q){T.loaded&&(ca[Q].isReference||a++)}),l=a);if(l){if(l=this._getBasemapLayerIds()){var B={basemapName:this._basemap,infos:K&&K[this._basemap]&&K[this._basemap].baseMapLayers};B.basemapName||(P.forEach(l,function(T){if(this.getLayer(T)instanceof Ba)return B.basemapName="osm",B.infos=K&&K.osm&&K.osm.baseMapLayers,!1},this),B.basemapName||(B=null))}this._removeBasemap(l);this._basemap=I.basemapName;this.basemapLayerIds=this._addBasemapLayers(Y,
ca);this.attr("data-basemap",this.getBasemap());this.emit("basemap-change",{current:I,previous:B})}},_getBasemapLayerIds:function(){var I=[];P.forEach(this.layerIds,function(Y){Y=this.getLayer(Y);Y._basemapGalleryLayerType&&I.push(Y.id)},this);return I},_addBasemapLayers:function(I,Y){var ca=[],a=[],l=0;P.forEach(I,function(B,T){Y[T].isReference?ca.push(B):(B._basemapGalleryLayerType="basemap",this.addLayer(B,l++),a.push(B.id))},this);ca.length&&P.forEach(ca,function(B){B.attr("data-reference",!0);
B._basemapGalleryLayerType="reference";this.addLayer(B,"top");a.push(B.id)},this);return a},_removeBasemap:function(I){P.forEach(I,function(Y){(Y=this.getLayer(Y))&&this.removeLayer(Y)},this)},getBasemap:function(){return this._basemap||""},translate:function(I,Y){I=I||0;Y=Y||0;if(!this._txTimer){this._tx=this._ty=0;var ca=this.toScreen(this.extent.getCenter());this.__panStart(ca.x,ca.y)}this._tx+=I;this._ty+=Y;this.__pan(this._tx,this._ty);clearTimeout(this._txTimer);this._txTimer=setTimeout(this._endTranslate,
150)},_endTranslate:function(){clearTimeout(this._txTimer);this._txTimer=null;var I=this._tx,Y=this._ty;this._tx=this._ty=0;this.__panEnd(I,Y)},setTimeExtent:function(I){I=(this.timeExtent=I)?new I.constructor(I.toJson()):null;this.onTimeExtentChange(I)},setTimeSlider:function(I){this.timeSlider&&(hb(this._tsTimeExtentChange_connect),this.timeSlider=this._tsTimeExtentChange_connect=null);I&&(this.timeSlider=I,this.setTimeExtent(I.getCurrentTimeExtent()),this._tsTimeExtentChange_connect=fb(I,"onTimeExtentChange",
this,"setTimeExtent"))},setVisibility:function(I){if(this.visible!==I){this.visible=I;I||(this._display=this.container.style.display);this.container.style.display=I?this._display:"none";if(this.autoResize){var Y=I?"resume":"pause";this._rszSignal[Y]();this._oriSignal[Y]()}I&&this.resize()}return this},resize:function(I){clearTimeout(this._resizeTimerHandle);this._destroyed||(!0===I?this._execResize():this._resizeTimerHandle=setTimeout(this._execResize,this.resizeDelay))},_timedResize:function(){this._resizeTimerHandle||
this._execResize()},_execResize:function(){clearTimeout(this._resizeTimerHandle);this._resizeTimerHandle=null;this.reposition();this._resize();this.autoResize&&this._startResizeTimer()},_resize:function(){var I=this.width,Y=this.height,ca=h.get(this.container,"display"),a=q.getContentBox(this.container);if(!("none"===ca||0>=a.w||0>=a.h||I===a.w&&Y===a.h)){if(ca=this._zoomAnim||this._panAnim)ca.stop(),ca._fire("onEnd",[ca.node]);jb(this.root,{width:(this.width=a.w)+"px",height:(this.height=a.h)+"px"});
a=this.width;ca=this.height;this.attribution&&this.attribution.domNode&&h.set(this.attribution.domNode,"maxWidth",Math.floor(a*this._mapParams.attributionWidth)+"px");this.__visibleRect.update(this.__visibleRect.x,this.__visibleRect.y,a,ca);this.__visibleDelta.update(this.__visibleDelta.x,this.__visibleDelta.y,a,ca);var l=new g(this.extent);I=(new g(l.x,l.y,a/I*l.width,ca/Y*l.height,this.spatialReference)).getExtent();this.onResize(I,a,ca);this._extentUtil(null,null,I,null,!0)}},reposition:function(){var I=
this.position,Y=I.x,ca=I.y;this._reposition();I=this.position;if(Y!==I.x||ca!==I.y)this.onReposition(I.x,I.y)},_reposition:function(){var I=q.position(this.container,!0),Y=q.getPadBorderExtents(this.container);this.position.update(I.x+Y.l,I.y+Y.t)},_setClipRect:function(){delete this._clip;var I=7>=e("ie")||void 0===e("ie")&&7<=e("trident")?"rect(auto,auto,auto,auto)":"auto";if(this.wrapAround180){var Y=this.width,ca=this.height,a=this._getFrameWidth(),l=Y-a;0<l&&(I=l/2,I="rect(0px,"+(I+a)+"px,"+
ca+"px,"+I+"px)",ca=this.extent.getWidth(),Y=a/Y*ca,this._clip=[(ca-Y)/2,Y])}jb(this.__container,"clip",I)},_getAvailExtent:function(){var I=this.extent,Y=this._clip;if(Y){if(!I._clip){var ca=new g(I);ca.width=Y[1];ca.x+=Y[0];I._clip=ca.getExtent()}return I._clip}return I},_fixedPan:function(I,Y){return this._extentUtil(null,{dx:I,dy:Y})},panUp:function(){return this._fixedPan(0,-.75*this.height)},panUpperRight:function(){return this._fixedPan(.75*this.width,-.75*this.height)},panRight:function(){return this._fixedPan(.75*
this.width,0)},panLowerRight:function(){return this._fixedPan(.75*this.width,.75*this.height)},panDown:function(){return this._fixedPan(0,.75*this.height)},panLowerLeft:function(){return this._fixedPan(-.75*this.width,.75*this.height)},panLeft:function(){return this._fixedPan(-.75*this.width,0)},panUpperLeft:function(){return this._fixedPan(-.75*this.width,-.75*this.height)},enableSnapping:function(I){I=I||{};if("esri.SnappingManager"===I.declaredClass)this.snappingManager=I;else{var Y=mb++,ca=this;
this._rids&&this._rids.push(Y);O(["./SnappingManager"],function(a){var l=ca._rids?P.indexOf(ca._rids,Y):-1;-1!==l&&(ca._rids.splice(l,1),ca.snappingManager=new a(V.mixin({map:ca},I)))})}return this.snappingManager},disableSnapping:function(){this.snappingManager&&this.snappingManager.destroy();this.snappingManager=null},_createLabelLayer:function(){!this._labels&&bb&&this.loaded&&(this._labels=new bb({id:"_internal_LabelLayer"}),this._labels._setMap(this,this._gc._surface),this._processLabelLayers(),
this.on("layers-reordered",this._processLabelLayers))},_processLabelLayers:function(){null==this._labelProcessor&&(this._labelProcessor=setTimeout(this._updateLabelLayers,0))},_updateLabelLayers:function(){this._labelProcessor=null;this._labels&&(this._labels.removeAllFeatureLayers(),P.forEach(this.graphicsLayerIds,function(I){I=this.getLayer(I);"function"===typeof I.applyEdits?this._labels.addFeatureLayer(I):"esri.layers.WFSLayer"===I.declaredClass&&this._labels.addFeatureLayer(I)},this))},_getMapImageLyr:function(){this.loaded&&
!this._mapImageLyr&&(this._mapImageLyr=new ra,this._mapImageLyr._setMap(this,this._layersDiv),this._placeMapImageLyr());return this._mapImageLyr},_placeMapImageLyr:function(){for(var I=this.layerIds,Y=this._layerDivs,ca=!1,a,l,B=I.length-1;0<=B;B--)if(a=I[B],l=this.getLayer(a),a=Y[a],l&&a&&!l._isReference){f.place(this._mapImageLyr._div,a,"after");ca=!0;break}ca||f.place(this._mapImageLyr._div,this._layersDiv,"first")}});return m._CoreMap=R})},"esri/basemaps":function(){define(["require","dojo/has",
"./kernel","dojo/i18n!./nls/jsapi"],function(O,F,d,R){O={streets:{title:R.basemaps.streets,thumbnailUrl:O.toUrl("./images/basemap/streets.jpg"),itemId:"d8855ee4d3d74413babfb0f41203b168",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]},satellite:{title:R.basemaps.satellite,thumbnailUrl:O.toUrl("./images/basemap/satellite.jpg"),itemId:"86de95d4e0244cba80f0fa2c9403a7b2",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]},
hybrid:{title:R.basemaps.hybrid,thumbnailUrl:O.toUrl("./images/basemap/hybrid.jpg"),itemId:"413fd05bbd7342f5991d5ec96f4f8b18",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",isReference:!0}]},terrain:{title:R.basemaps.terrain,thumbnailUrl:O.toUrl("./images/basemap/terrain.jpg"),itemId:"aab054ab883c4a4094c72e949566ad40",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer"},
{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",isReference:!0}]},topo:{title:R.basemaps.topo,thumbnailUrl:O.toUrl("./images/basemap/topo.jpg"),itemId:"6e03e8c26aad4b9c92a87c1063ddb0e3",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}]},gray:{title:R.basemaps.gray,thumbnailUrl:O.toUrl("./images/basemap/gray.jpg"),itemId:"8b3b470883a744aeb60e5fff0a319ce7",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"},
{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",isReference:!0}]},"dark-gray":{title:R.basemaps["dark-gray"],thumbnailUrl:O.toUrl("./images/basemap/dark-gray.jpg"),itemId:"da65bacab5bd4defb576f839b6b28098",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",isReference:!0}]},
oceans:{title:R.basemaps.oceans,thumbnailUrl:O.toUrl("./images/basemap/oceans.jpg"),itemId:"48b8cec7ebf04b5fbdcaf70d09daff21",baseMapLayers:[{url:"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{url:"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",isReference:!0}]},"national-geographic":{title:R.basemaps["national-geographic"],thumbnailUrl:O.toUrl("./images/basemap/national-geographic.jpg"),itemId:"509e2d6b034246d692a461724ae2d62c",
baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer"}]},osm:{title:R.basemaps.osm,thumbnailUrl:O.toUrl("./images/basemap/osm.jpg"),itemId:"5d2bfa736f8448b3a1708e1f6be23eed",baseMapLayers:[{type:"OpenStreetMap"}]},"dark-gray-vector":{title:R.basemaps["dark-gray"],thumbnailUrl:O.toUrl("./images/basemap/dark-gray.jpg"),itemId:"c11ce4f7801740b2905eb03ddc963ac8",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/c11ce4f7801740b2905eb03ddc963ac8/resources/styles/root.json",
type:"VectorTile"}]},"gray-vector":{title:R.basemaps.gray,thumbnailUrl:O.toUrl("./images/basemap/gray.jpg"),itemId:"8a2cba3b0ebf4140b7c0dc5ee149549a",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/8a2cba3b0ebf4140b7c0dc5ee149549a/resources/styles/root.json",type:"VectorTile"}]},"streets-vector":{title:R.basemaps.streets,thumbnailUrl:O.toUrl("./images/basemap/streets.jpg"),itemId:"de26a3cf4cc9451298ea173c4b324736",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",
type:"VectorTile"}]},"topo-vector":{title:R.basemaps.topo,thumbnailUrl:O.toUrl("./images/basemap/topo.jpg"),itemId:"7dc6cea0b1764a1f9af2e679f642f0f5",baseMapLayers:[{url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{url:"https://www.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",type:"VectorTile"}]},"streets-night-vector":{title:R.basemaps["streets-night-vector"],thumbnailUrl:O.toUrl("./images/basemap/streets-night.jpg"),
itemId:"86f556a2d1fd468181855a35e344567f",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",type:"VectorTile"}]},"streets-relief-vector":{title:R.basemaps["streets-relief-vector"],thumbnailUrl:O.toUrl("./images/basemap/streets-relief.jpg"),itemId:"b266e6d17fc345b498345613930fbd76",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",type:"VectorTile"}]},
"streets-navigation-vector":{title:R.basemaps["streets-navigation-vector"],thumbnailUrl:O.toUrl("./images/basemap/streets-navigation.jpg"),itemId:"63c47b7177f946b49902c24129b87252",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",type:"VectorTile"}]}};return d.basemaps=O})},"esri/fx":function(){define("dojo/_base/connect dojo/_base/fx dojo/_base/lang dojo/dom dojo/dom-geometry dojo/dom-style dojo/fx dojo/has ./kernel".split(" "),
function(O,F,d,R,X,ba,V,P,G){P={animateRange:function(u){var C=u.range;return new F.Animation(d.mixin({curve:new F._Line(C.start,C.end)},u))},resize:function(u){var C=u.node=R.byId(u.node),z=u.start,x=u.end;z||(z=X.getMarginBox(C),C=X.getPadBorderExtents(C),z=u.start={left:z.l+C.l,top:z.t+C.t,width:z.w-C.w,height:z.h-C.h});x||(x=u.anchor?u.anchor:{x:z.left,y:z.top},C=u.size,x=u.end={left:z.left-(C.width-z.width)*(x.x-z.left)/z.width,top:z.top-(C.height-z.height)*(x.y-z.top)/z.height,width:C.width,
height:C.height});return F.animateProperty(d.mixin({properties:{left:{start:z.left,end:x.left},top:{start:z.top,end:x.top},width:{start:z.width,end:x.width},height:{start:z.height,end:x.height}}},u))},slideTo:function(u){var C=u.node=R.byId(u.node),z=ba.getComputedStyle,x=null,f=null,q=function(){return function(){var h="absolute"==C.style.position?"absolute":"relative";x="absolute"==h?C.offsetTop:parseInt(z(C).top)||0;f="absolute"==h?C.offsetLeft:parseInt(z(C).left)||0;"absolute"!=h&&"relative"!=
h&&(h=X.position(C,!0),x=h.y,f=h.x,C.style.position="absolute",C.style.top=x+"px",C.style.left=f+"px")}}();q();u=F.animateProperty(d.mixin({properties:{top:{start:x,end:u.top||0},left:{start:f,end:u.left||0}}},u));O.connect(u,"beforeBegin",u,q);return u},flash:function(u){u=d.mixin({end:"#f00",duration:500,count:1},u);u.duration/=2*u.count;var C=R.byId(u.node),z=u.start;z||(z=ba.getComputedStyle(C).backgroundColor);var x=u.end,f=[],q=u.count;C={node:C,duration:u.duration};for(u=0;u<q;u++)f.push(F.animateProperty(d.mixin({properties:{backgroundColor:{start:z,
end:x}}},C))),f.push(F.animateProperty(d.mixin({properties:{backgroundColor:{start:x,end:z}}},C)));return V.chain(f)}};d.mixin(d.getObject("fx",!0,G),P);return P})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style ../kernel ../config ../sniff ../domUtils ../geometry/Point ../geometry/webMercatorUtils ./layer".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x){var f=O([x],{declaredClass:"esri.layers.MapImageLayer",
"-chains-":{constructor:"manual"},constructor:function(q){this.inherited(arguments,[null,q]);this._mapImages=[];var h=d.hitch;this._panStart=h(this,this._panStart);this._pan=h(this,this._pan);this._extentChange=h(this,this._extentChange);this._zoom=h(this,this._zoom);this._zoomStart=h(this,this._zoomStart);this._scale=h(this,this._scale);this._resize=h(this,this._resize);F.connect(this,"onSuspend",this,this._onSuspend);F.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},
opacity:1,addImage:function(q){var h=this._mapImages.push(q);--h;q._idx=h;q._layer=this;this._div&&this._createImage(q,h)},removeImage:function(q){if(q){var h=q._idx,e=this._mapImages;if(e[h]===q){delete e[h];if(h=q._node)this._clearEvents(h),h.e_idx=h.e_bl=h.e_tr=h.e_l=h.e_t=h.e_w=h.e_h=null,h.parentNode&&(h.parentNode.removeChild(h),X.destroy(h));q._node=q._idx=q._layer=null}}},removeAllImages:function(){var q=this._mapImages,h,e=q.length;for(h=0;h<e;h++){var t=q[h];t&&this.removeImage(t)}this._mapImages=
[]},getImages:function(){var q=this._mapImages,h=[],e,t=q.length;for(e=0;e<t;e++)q[e]&&h.push(q[e]);return h},setOpacity:function(q){this.opacity!=q&&(this._opacityChanged(this.opacity=q),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(q){var h=this._div;if(h)if(!G("ie")||8<G("ie"))ba.set(h,"opacity",q);else{var e=h.childNodes;var t=e.length;for(h=0;h<t;h++)ba.set(e[h],"opacity",q)}},_createImage:function(q,h){var e=X.create("img");ba.set(e,{position:"absolute"});1>
q.opacity?ba.set(e,"opacity",q.opacity):8>=G("ie")&&ba.set(e,"opacity",this.opacity);!q.rotation||9>G("ie")||ba.set(e,V._css.names.transform,V._css.rotate(360-q.rotation));q._node=e;e.e_idx=h;e.e_layer=this;e.e_load=F.connect(e,"onload",f.prototype._imageLoaded);e.e_error=F.connect(e,"onerror",f.prototype._imageError);e.e_abort=F.connect(e,"onabort",f.prototype._imageError);e.src=q.href},_imageLoaded:function(q,h){var e=h||q.target||q.currentTarget,t=e.e_layer,k=t._mapImages[e.e_idx],m=t._map;m&&
(m.__zooming||m.__panning||!t._sr)?t._standby.push(e):(t._clearEvents(e),k&&k._node===e&&m&&t._attach(k))},_imageError:function(q){q=q.target||q.currentTarget;var h=q.e_layer,e=h._mapImages[q.e_idx];h._clearEvents(q);e&&(e._node=null)},_clearEvents:function(q){var h=F.disconnect;h(q.e_load);h(q.e_error);h(q.e_abort);q.e_load=q.e_error=q.e_abort=q.e_layer=null},_attach:function(q){var h=q.extent,e=h.spatialReference,t=this._sr,k=this._div,m=q._node,y=new C({x:h.xmin,y:h.ymin,spatialReference:e});h=
new C({x:h.xmax,y:h.ymax,spatialReference:e});t.equals(e)||(t.isWebMercator()&&4326===e.wkid?(y=z.geographicToWebMercator(y),h=z.geographicToWebMercator(h)):e.isWebMercator()&&4326===t.wkid&&(y=z.webMercatorToGeographic(y),h=z.webMercatorToGeographic(h)));m.e_bl=y;m.e_tr=h;q.visible&&(this._setPos(m,k._left,k._top),(this._active||k).appendChild(m))},_setPos:function(q,h,e){var t=q.e_bl,k=q.e_tr,m=this._map;t=m.toScreen(t);k=m.toScreen(k);h=t.x-h;e=k.y-e;var y=Math.abs(k.x-t.x);t=Math.abs(t.y-k.y);
k={width:y+"px",height:t+"px"};var K=this._mapImages[q.e_idx];"css-transforms"===m.navigationMode?k[V._css.names.transform]=V._css.translate(h,e)+(K.rotation?" "+V._css.rotate(360-K.rotation):""):(k.left=h+"px",k.top=e+"px");ba.set(q,k);q.e_l=h;q.e_t=e;q.e_w=y;q.e_h=t},managedSuspension:!0,_setMap:function(q,h){this.inherited(arguments);var e=this._div=X.create("div",null,h),t=V._css.names,k={position:"absolute"},m=q.__visibleDelta;if(!G("ie")||8<G("ie"))k.opacity=this.opacity;"css-transforms"===
q.navigationMode?(k[t.transform]=V._css.translate(m.x,m.y),ba.set(e,k),e._left=m.x,e._top=m.y,k={position:"absolute",width:q.width+"px",height:q.height+"px",overflow:"visible"},this._active=X.create("div",null,e),ba.set(this._active,k),this._passive=X.create("div",null,e),ba.set(this._passive,k)):(e._left=0,e._top=0,ba.set(e,k));this._standby=[];t=this._mapImages;m=t.length;for(k=0;k<m;k++){var y=t[k];y._node||this._createImage(y,y._idx)}u.hide(e);return e},_unsetMap:function(q,h){this._disconnect();
var e=this._div;if(e){var t=this._mapImages,k,m=t.length;for(k=0;k<m;k++){var y=t[k];if(y){var K=y._node;K&&(this._clearEvents(K),K.e_idx=K.e_bl=K.e_tr=K.e_l=K.e_t=K.e_w=K.e_h=null);y._node=null}}h.removeChild(e);X.destroy(e)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();u.hide(this._div)},_onResume:function(q){q.firstOccurrence&&(this._sr=this._map.spatialReference,this._processStandbyList());q=this._map;
var h=this._div,e=q.__visibleDelta;"css-transforms"===q.navigationMode&&(h._left=e.x,h._top=e.y,ba.set(h,V._css.names.transform,V._css.translate(h._left,h._top)));this._redraw("css-transforms"===q.navigationMode);this._connect(q);u.show(h)},_connect:function(q){if(!this._connections){var h=F.connect,e="css-transforms"===q.navigationMode;this._connections=[h(q,"onPanStart",this._panStart),h(q,"onPan",this._pan),h(q,"onExtentChange",this._extentChange),e&&h(q,"onZoomStart",this._zoomStart),e?h(q,"onScale",
this._scale):h(q,"onZoom",this._zoom),e&&h(q,"onResize",this._resize)];e&&this._resize(q.extent,q.width,q.height)}},_disconnect:function(){this._connections&&(R.forEach(this._connections,F.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(q,h){var e=this._div;e._left=this._panL+h.x;e._top=this._panT+h.y;"css-transforms"===this._map.navigationMode?ba.set(e,V._css.names.transform,V._css.translate(e._left,e._top)):ba.set(e,{left:e._left+
"px",top:e._top+"px"})},_extentChange:function(q,h,e){e?this._redraw("css-transforms"===this._map.navigationMode):h&&this._pan(q,h);this._processStandbyList()},_processStandbyList:function(){var q,h=this._standby;if(h&&h.length)for(q=h.length-1;0<=q;q--)this._imageLoaded(null,h[q]),h.splice(q,1)},_redraw:function(q){if(q){q=this._passive;var h=V._css.names;ba.set(q,h.transition,"none");this._moveImages(q,this._active);ba.set(q,h.transform,"none")}q=this._active||this._div;h=this._div._left;var e=
this._div._top,t,k=q.childNodes.length;for(t=0;t<k;t++){var m=q.childNodes[t];this._setPos(m,h,e)}},_zoom:function(q,h,e){q=this._div;var t=q._left,k=q._top,m,y=q.childNodes.length;for(m=0;m<y;m++){var K=q.childNodes[m];var n=K.e_w*h,w=K.e_h*h,c=(e.x-t-K.e_l)*(n-K.e_w)/K.e_w,D=(e.y-k-K.e_t)*(w-K.e_h)/K.e_h;c=isNaN(c)?0:c;D=isNaN(D)?0:D;ba.set(K,{left:K.e_l-c+"px",top:K.e_t-D+"px",width:n+"px",height:w+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(q,
h){var e=q.childNodes;var t=e.length;if(0<t)for(--t;0<=t;t--)h.appendChild(e[t])},_scale:function(q,h){var e=V._css.names,t=this._passive;ba.set(t,e.transition,h?"none":e.transformName+" "+P.defaults.map.zoomDuration+"ms ease");({})[e.transform]=V._css.matrix(q);ba.set(t,e.transform,V._css.matrix(q))},_resize:function(q,h,e){ba.set(this._active,{width:h+"px",height:e+"px"});ba.set(this._passive,{width:h+"px",height:e+"px"})}});d.setObject("layers.MapImageLayer",f,V);return f})},"esri/layers/OpenStreetMapLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(O,F,d,R,X,ba,V,P,G){O=O(P,{declaredClass:"esri.layers.OpenStreetMapLayer",constructor:function(u){this.spatialReference=new ba({wkid:102100});this.tileInfo=new G({rows:256,cols:256,dpi:96,format:"PNG8",compressionQuality:0,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,scale:5.91657527591555E8,resolution:156543.033928},{level:1,scale:2.95828763795777E8,resolution:78271.5169639999},{level:2,scale:1.47914381897889E8,resolution:39135.7584820001},
{level:3,scale:7.3957190948944E7,resolution:19567.8792409999},{level:4,scale:3.6978595474472E7,resolution:9783.93962049996},{level:5,scale:1.8489297737236E7,resolution:4891.96981024998},{level:6,scale:9244648.868618,resolution:2445.98490512499},{level:7,scale:4622324.434309,resolution:1222.99245256249},{level:8,scale:2311162.217155,resolution:611.49622628138},{level:9,scale:1155581.108577,resolution:305.748113140558},{level:10,scale:577790.554289,resolution:152.874056570411},{level:11,scale:288895.277144,
resolution:76.4370282850732},{level:12,scale:144447.638572,resolution:38.2185141425366},{level:13,scale:72223.819286,resolution:19.1092570712683},{level:14,scale:36111.909643,resolution:9.55462853563415},{level:15,scale:18055.954822,resolution:4.77731426794937},{level:16,scale:9027.977411,resolution:2.38865713397468},{level:17,scale:4513.988705,resolution:1.19432856685505},{level:18,scale:2256.994353,resolution:.597164283559817},{level:19,scale:1128.497176,resolution:.298582141647617}]});this.fullExtent=
new V({xmin:-2.003750834E7,ymin:-2.003750834E7,xmax:2.003750834E7,ymax:2.003750834E7,spatialReference:{wkid:102100}});this.initialExtent=new V({xmin:-2.003750834E7,ymin:-2.003750834E7,xmax:2.003750834E7,ymax:2.003750834E7,spatialReference:{wkid:102100}});this.tileServers=u&&u.tileServers||["//a.tile.openstreetmap.org","//b.tile.openstreetmap.org","//c.tile.openstreetmap.org"];this.serversLength=this.tileServers.length;this._displayLevels=u?u.displayLevels:null;this.copyright=u&&u.copyright||"Map data \u00a9 OpenStreetMap contributors, CC-BY-SA";
this.loaded=!0;this.onLoad(this);(u=u&&u.loadCallback)&&u(this)},getTileUrl:function(u,C,z){u=this.tileServers[C%this.serversLength]+"/"+u+"/"+z+"/"+C+".png";u=X.normalize(u);u=this.addTimestampToURL(u);return X.addProxy(u)}});F.setObject("layers.OpenStreetMapLayer",O,R);return O})},"esri/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/window dojo/Stateful dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/registry ../kernel ../lang ../domUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/normalizeUtils ../InfoWindowBase ../PopupBase dojo/i18n!../nls/jsapi dojo/NodeList-dom ./PopupTemplate ./PopupRenderer".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D){O=O([w,c,P],{declaredClass:"esri.dijit.Popup",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:25,marginTop:25,highlight:!0,pagingControls:!0,pagingInfo:!0,keepHighlightOnHide:!1,popupWindow:!0,titleInBody:!0,anchor:"auto",visibleWhenEmpty:!0,hideDelay:1E3,location:null,constructor:function(E,J){this.initialize();F.mixin(this,E);this.domNode=u.byId(J);var A=this._nls=F.mixin({},D.widgets.popup),S=this.domNode;z.add(S,"esriPopup");(this._isRTL=
!f.isBodyLtr())&&q.set(S,"direction","rtl");C.set(S,"innerHTML","\x3cdiv class\x3d'esriPopupWrapper' style\x3d'position: absolute;'\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden' title\x3d'"+A.NLS_searching+"...'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton prev hidden' title\x3d'"+A.NLS_prevFeature+"'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden' title\x3d'"+A.NLS_nextFeature+"'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton maximize' title\x3d'"+
A.NLS_maximize+"'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close' title\x3d'"+A.NLS_close+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList hidden'\x3e\x3ca title\x3d'"+A.NLS_zoomTo+"' class\x3d'action zoomTo' href\x3d'javascript:void(0);'\x3e\x3cspan\x3e"+A.NLS_zoomTo+"\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'outerPointer hidden'\x3e\x3c/div\x3e");
this._sizers=X.query(".sizer",S);A=X.query(".titlePane",S)[0];this._title=X.query(".title",A)[0];this._prevFeatureButton=X.query(".prev",A)[0];this._nextFeatureButton=X.query(".next",A)[0];this._maxButton=X.query(".maximize",A)[0];this._spinner=X.query(".spinner",A)[0];this._contentPane=X.query(".contentPane",S)[0];this._positioner=X.query(".esriPopupWrapper",S)[0];this._pointer=X.query(".pointer",S)[0];this._outerPointer=X.query(".outerPointer",S)[0];this._actionList=X.query(".actionsPane .actionList",
S)[0];this._contentUpdateHandles={};this._eventConnections=[R.connect(X.query(".close",A)[0],"onclick",this,this.hide),R.connect(this._prevFeatureButton,"onclick",this,this.selectPrevious),R.connect(this._nextFeatureButton,"onclick",this,this.selectNext),R.connect(this._maxButton,"onclick",this,this._toggleSize),R.connect(X.query(".zoomTo",this._actionList)[0],"onclick",this,this._zoomToFeature),R.connect(this,"onClearFeatures",this,this._featuresCleared),R.connect(this,"onSelectionChange",this,this._featureSelected),
R.connect(this,"onDfdComplete",this,this._updateUI)];ba("esri-touch")&&(S=k.setScrollable(this._contentPane),this._eventConnections.push(S[0],S[1]));this._toggleVisibility(!1)},onMaximize:function(){},onRestore:function(){},setMap:function(E){this.inherited(arguments);x.place(this.domNode,E.root);this.highlight&&this.enableHighlight(E);this._maxHeight=q.get(this._contentPane,"maxHeight")},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(E){this.popupWindow&&
(t.isDefined(E)&&""!==E||(E="\x26nbsp;"),this.destroyDijits(this._title),this.place(E,this._title),this.isShowing&&(this.startupDijits(this._title),this.reposition()))},setContent:function(E){this.popupWindow&&(t.isDefined(E)&&""!==E||(E="\x26nbsp;"),this._destroyContent(),this.place(E,this._contentPane),this.isShowing&&(this._startupContent(),this.reposition()))},show:function(E,J){if(this.popupWindow)if(this._delayHide=!1,E){var A=this.map;if(E.spatialReference){this.location=E;var S=A.toScreen(E)}else this.location=
A.toMap(E),S=E;var H=A._getFrameWidth();if(-1!==H&&(S.x%=H,0>S.x&&(S.x+=H),A.width>H))for(A=(A.width-H)/2;S.x<A;)S.x+=H;this._maximized?this.restore():this._setPosition(S);J&&J.closestFirst&&this.showClosestFirst(this.location);this.isShowing||(this._toggleVisibility(!0),this._followMap(),this.startupDijits(this._title),this._startupContent(),this.reposition(),this.showHighlight(),this.onShow())}else this._toggleVisibility(!0)},hide:function(){this.isShowing&&(this._toggleVisibility(!1),this._unfollowMap(),
this.keepHighlightOnHide||this.hideHighlight(),this.onHide())},resize:function(E,J){this.popupWindow&&(this._sizers.style({width:E+"px"}),q.set(this._contentPane,"maxHeight",J+"px"),this._maxHeight=J,this.isShowing&&this.reposition())},reposition:function(){this.popupWindow&&this.map&&this.location&&!this._maximized&&this.isShowing&&this._setPosition(this.map.toScreen(this.location))},addActions:function(E){return d.map(E,function(J){var A=x.create("a",{href:"javascript:void(0);",className:"action "+
J.className,title:J.title,innerHTML:J.title},this._actionList);R.connect(A,"onclick",J.callback);return{action:J,node:A}},this)},removeActions:function(E){d.forEach(E,function(J){x.destroy(J.node)})},getCurrentAnchor:function(){return this._anchor},maximize:function(){var E=this.map;if(E&&!this._maximized&&this.popupWindow){this._maximized=!0;var J=this._maxButton;z.remove(J,"maximize");z.add(J,"restore");C.set(J,"title",this._nls.NLS_restore);J=this.marginLeft;var A=this.marginTop,S=E.width-2*J;
E=E.height-2*A;q.set(this.domNode,{left:this._isRTL?null:J+"px",right:this._isRTL?J+"px":null,top:A+"px",bottom:null});q.set(this._positioner,{left:null,right:null,top:null,bottom:null});this._savedWidth=q.get(this._sizers[0],"width");this._savedHeight=q.get(this._contentPane,"maxHeight");this._sizers.style({width:S+"px"});q.set(this._contentPane,{maxHeight:E-65+"px",height:E-65+"px"});this._showPointer("");this._unfollowMap();z.add(this.domNode,"esriPopupMaximized");this.onMaximize()}},restore:function(){if(this.map&&
this._maximized&&this.popupWindow){this._maximized=!1;var E=this._maxButton;z.remove(E,"restore");z.add(E,"maximize");C.set(E,"title",this._nls.NLS_maximize);q.set(this._contentPane,"height",null);this.resize(this._savedWidth,this._savedHeight);this._savedWidth=this._savedHeight=null;this.show(this.location);this._followMap();z.remove(this.domNode,"esriPopupMaximized");this.onRestore()}},startup:function(){},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);
this._destroyContent();d.forEach(this._eventConnections,R.disconnect);x.destroy(this.domNode);this._sizers=this._contentPane=this._actionList=this._positioner=this._pointer=this._outerPointer=this._title=this._prevFeatureButton=this._nextFeatureButton=this._spinner=this._eventConnections=this._pagerScope=this._targetLocation=this._nls=this._maxButton=null},selectNext:function(){this.select(this.selectedIndex+1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(E,J){this._transientAnchor=
J&&J.anchor;this.inherited(arguments);this._updateUI()},clearFeatures:function(E){E||(this._transientAnchor=null);this.inherited(arguments)},postscript:null,_highlightSetter:function(E){var J=this.highlight,A=this.map;this.highlight=E;if(A&&E!==J)if(E){if(this.enableHighlight(A),E=this.features&&this.features[this.selectedIndex])this.updateHighlight(A,E),this.showHighlight()}else this.disableHighlight(A)},_pagingControlsSetter:function(E){var J=this.pagingControls,A=this.map;this.pagingControls=E;
A&&E!==J&&this._updatePagingControls()},_pagingInfoSetter:function(E){var J=this.pagingInfo,A=this.map;this.pagingInfo=E;A&&E!==J&&this.features&&this.features.length&&this._updatePagingInfo()},_popupWindowSetter:function(E){var J=this.popupWindow,A=this.map;this.popupWindow=E;A&&E!==J&&(E?(this._updateUI(),this._updateWindow()):(this.hide(),this.showHighlight()))},_anchorSetter:function(E){var J=this.anchor;this.anchor=E;this.map&&E!==J&&this.reposition()},_startupContent:function(){var E=this._contentPane;
this.startupDijits(E);d.forEach(this._getPopupRendererDijits(E),function(J){if(!this._contentUpdateHandles[J.id]){var A=J.on("content-update",F.hitch(this,function(){this.reposition()}));this._contentUpdateHandles[J.id]=A}},this)},_destroyContent:function(){var E=this._contentPane;d.forEach(this._getPopupRendererDijits(E),function(J){var A=this._contentUpdateHandles[J.id];A&&(A.remove(),delete this._contentUpdateHandles[J.id])},this);this.destroyDijits(E)},_getPopupRendererDijits:function(E){E=this.getDijits(E);
return E=d.filter(E,function(J){return J&&J.set&&/_PopupRenderer/.test(J.declaredClass)})},_featuresCleared:function(){this.setTitle("\x26nbsp;");this.setContent("\x26nbsp;");this._setPagerCallbacks(this);this._updateUI();this.hideHighlight()},_featureSelected:function(){this._updateUI();this._updateWindow()},_updateWindow:function(){var E=this.selectedIndex;if(0<=E){var J=this.features[E].getContent();if(!this.titleInBody&&J&&F.isString(J.id)){var A=h.byId(J.id);A&&A.set&&/_PopupRenderer/.test(A.declaredClass)&&
A.set("showTitle",!1)}this.setContent(J);this.updateHighlight(this.map,this.features[E]);this.showHighlight()}},_toggleVisibility:function(E){this._setVisibility(E);this.isShowing=E},_setVisibility:function(E){z.toggle(this.domNode,"esriPopupVisible",E);z.toggle(this.domNode,"esriPopupHidden",!E)},_waitAndHide:function(E){var J=this;this._delayHide=!0;setTimeout(function(){J._delayHide&&(J._delayHide=!1,J.hide())},E)},_followMap:function(){this._unfollowMap();var E=this.map;this._handles=[R.connect(E,
"onPanStart",this,this._onPanStart),R.connect(E,"onPan",this,this._onPan),R.connect(E,"onZoomStart",this,this._onZoomStart),R.connect(E,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var E=this._handles;E&&(d.forEach(E,R.disconnect),this._handles=null)},_onPanStart:function(){var E=this.domNode.style;this._panOrigin={left:E.left,top:E.top,right:E.right,bottom:E.bottom}},_onPan:function(E,J){var A=this._panOrigin,S=J.x,H=J.y,ea=A.left,L=A.top,v=A.right;A=A.bottom;ea&&(ea=parseFloat(ea)+
S+"px");L&&(L=parseFloat(L)+H+"px");v&&(v=parseFloat(v)-S+"px");A&&(A=parseFloat(A)-H+"px");q.set(this.domNode,{left:ea,top:L,right:v,bottom:A})},_onZoomStart:function(){this._setVisibility(!1)},_onExtentChange:function(E,J,A){A&&(this._setVisibility(!0),this.show(this._targetLocation||this.location));this._targetLocation=null},_toggleSize:function(){this._maximized?this.restore():this.maximize()},_getTargetAnchor:function(){return this._transientAnchor||this.anchor},_setPosition:function(E){var J=
E.x,A=E.y;E=this.offsetX||0;var S=this.offsetY||0,H=0,ea=0,L=this.map,v=L.position.x,b=L.position.y,g=L.width,W=L.height;L="Left";var N="bottom",U="right",M="top",Z=f.getContentBox(this._positioner),da=Z.w/2,oa=Z.h/2,wa=q.get(this._sizers[0],"height")+this._maxHeight+q.get(this._sizers[2],"height"),ra=wa/2,Ba=0,Ia=0,Ma=g,Za=W,bb=J,Sa=A,Na=this._getTargetAnchor().toLowerCase();if("auto"===Na){if(Na=V.getBox)Na=Na(),Ba=Math.max(Na.l,v),Ma=Math.min(Na.l+Na.w,v+g),Ia=Math.max(Na.t,b),Za=Math.min(Na.t+
Na.h,b+W),bb+=v,Sa+=b;v=Sa-Ia>=wa;b=Za-Sa>=wa;g=Ma-bb>=Z.w;Z=bb-Ba>=Z.w;Sa-Ia>ra&&Za-Sa>=ra&&(g?(N="",L="Left",M="",U="right"):Z&&(N="",L="Right",M="",U="left"));L&&N&&bb-Ba>da&&Ma-bb>=da&&(v?(L="",N="bottom",U="",M="top"):b&&(L="",N="top",U="",M="bottom"));L&&N&&(g&&v?(L="Left",N="bottom",U="right",M="top"):g&&b?(L="Left",N="top",U="right",M="bottom"):Z&&b?(L="Right",N="top",U="left",M="bottom"):Z&&v&&(L="Right",N="bottom",U="left",M="top"));this._anchor=M&&U?M+"-"+U:M||U}else N=L="",-1!==Na.indexOf("top")?
N="bottom":-1!==Na.indexOf("bottom")&&(N="top"),-1!==Na.indexOf("left")?L="Right":-1!==Na.indexOf("right")&&(L="Left"),this._anchor=this._getTargetAnchor();U=N+L;switch(U){case "top":case "bottom":ea=14;break;case "Left":case "Right":H=13;break;case "topLeft":case "topRight":case "bottomLeft":case "bottomRight":ea=14,H=-16}q.set(this.domNode,{left:J+"px",top:A+"px",right:null,bottom:null});J={left:null,right:null,top:null,bottom:null};L?J[L.toLowerCase()]=H+E+"px":J.left=-da+"px";N?J[N]=ea+S+"px":
J.top=-oa+"px";q.set(this._positioner,J);this._showPointer(U)},_showPointer:function(E){z.remove(this._pointer,"top bottom right left topLeft topRight bottomRight bottomLeft hidden".split(" "));z.remove(this._outerPointer,["right","left","hidden"]);"Right"===E||"Left"===E?(E=E.toLowerCase(),z.add(this._outerPointer,E)):z.add(this._pointer,E)},_setPagerCallbacks:function(E,J,A){if(this.pagingControls&&(E!==this||this._pagerScope&&this._pagerScope!==this)&&E!==this._pagerScope){this._pagerScope=E;E===
this&&(J=this.selectPrevious,A=this.selectNext);var S=this._eventConnections;R.disconnect(S[1]);R.disconnect(S[2]);J&&(S[1]=R.connect(this._prevFeatureButton,"onclick",E,J));A&&(S[2]=R.connect(this._nextFeatureButton,"onclick",E,A))}},_getLocation:function(E){var J=E&&E.geometry;if(J)switch(J.type){case "point":var A=J;if(E.isAggregate()){E=E.getChildGraphics();var S=E[0];E=(S=S.geometry&&S.geometry.spatialReference)&&new K({points:d.map(E,function(H){H=H.geometry;return[H.x,H.y]}),spatialReference:S.toJson()});
S=n.getDenormalizedExtent(E)}break;case "multipoint":A=J.getPoint(0);S=n.getDenormalizedExtent(J);break;case "polyline":case "polygon":A=J.getPoint(0,0),S=n.getDenormalizedExtent(J)}return[A,S]},_zoomToFeature:function(E){E.preventDefault();var J=this.features,A=this.selectedIndex;E=this.map;if(J)if(A=this._getLocation(J[A]),J=A[0],A=A[1],J||(J=this.location),A&&A.intersects(this.location)||(this.location=J),A&&A.getWidth()&&A.getHeight())E.setExtent(A,!0);else{var S=E.getNumLevels();A=E.getLevel();
var H=E.getMaxZoom(),ea=this.zoomFactor||1;0<S?A!==H&&(S=A+ea,S>H&&(S=H),E.navigationManager._wheelZoom({value:S-A,mapPoint:J},!0)):E.navigationManager._wheelZoom({value:1/Math.pow(2,ea)*2,mapPoint:J},!0)}},_updatePagingControls:function(){var E=this._prevFeatureButton,J=this._nextFeatureButton,A=this.selectedIndex,S=this.features?this.features.length:0;this.pagingControls&&1<S?(0===A?z.add(E,"hidden"):z.remove(E,"hidden"),A===S-1?z.add(J,"hidden"):z.remove(J,"hidden")):(z.add(E,"hidden"),z.add(J,
"hidden"))},_updatePagingInfo:function(){var E=this.features?this.features.length:0,J=this._nls,A="\x26nbsp;";this.pagingInfo&&1<E&&J.NLS_pagingInfo&&(A=t.substitute({index:this.selectedIndex+1,total:E},J.NLS_pagingInfo));E&&(J=this.getSelectedFeature(),E=J.getInfoTemplate(),J=J.getTitle(),E&&!/esri\.InfoTemplate/.test(E.declaredClass)&&this.titleInBody||!J||(A=J+("\x26nbsp;"===A?"":" "+A)));this.setTitle(A)},_updateUI:function(){if(this.popupWindow){var E=this.features,J=this.deferreds,A=E?E.length:
0,S=this._spinner,H=this._actionList,ea=this._nls;this._updatePagingControls();this._updatePagingInfo();A?z.remove(H,"hidden"):z.add(H,"hidden");J&&J.length?E?z.remove(S,"hidden"):this.setContent("\x3cdiv style\x3d'text-align: center;'\x3e"+ea.NLS_searching+"...\x3c/div\x3e"):z.add(S,"hidden");A||J&&J.length?this._delayHide=!1:(this.setContent("\x3cdiv style\x3d'text-align: center;'\x3e"+ea.NLS_noInfo+".\x3c/div\x3e"),this.visibleWhenEmpty||this._waitAndHide(this.hideDelay))}}});F.setObject("dijit.Popup",
O,e);return O})},"esri/InfoWindowBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/dom-construct dojo/has dijit/registry ./kernel ./lang ./geometry/ScreenPoint".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C){O=O(null,{declaredClass:"esri.InfoWindowBase",constructor:function(){var z=F.hitch;this.__set_title=z(this,this.__set_title);this.__err_title=z(this,this.__err_title);this.__set_content=z(this,this.__set_content);this.__err_content=
z(this,this.__err_content)},setMap:function(z){this.map=z},unsetMap:function(z){delete this.map},setTitle:function(){},setContent:function(){},show:function(){},hide:function(){},resize:function(){},onShow:function(){},onHide:function(){},place:function(z,x){u.isDefined(z)?F.isObject(z)?ba.place(z,x,"only"):x.innerHTML=z:x.innerHTML=""},startupDijits:function(z){this._processDijits(z)},destroyDijits:function(z){this._processDijits(z,!0)},getDijits:function(z){var x=[];z&&1===z.children.length&&(z=
z.children[0])&&(x=(x=P.byNode(z))?[x]:P.findWidgets(z));return x},_processDijits:function(z,x){var f=this.getDijits(z);d.forEach(f,function(q){if(x){if(q._started&&!q._destroyed)try{q.destroyRecursive?q.destroyRecursive():q.destroy&&q.destroy()}catch(h){}}else if(!q._started)try{q.startup()}catch(h){}})},__registerMapListeners:function(){this.__unregisterMapListeners();var z=this.map;this.__handles=[R.connect(z,"onPan",this,this.__onMapPan),R.connect(z,"onZoomStart",this,this.__onMapZmStart),R.connect(z,
"onExtentChange",this,this.__onMapExtChg)]},__unregisterMapListeners:function(){var z=this.__handles;z&&(d.forEach(z,R.disconnect,R),this.__handles=null)},__onMapPan:function(z,x){this.move(x,!0)},__onMapZmStart:function(){this.__mcoords=this.mapCoords||this.map.toMap(new C(this.coords));this.hide(null,!0)},__onMapExtChg:function(z,x,f){z=this.map;var q=this.mapCoords;q?this.show(q,null,!0):(x=f?z.toScreen(this.__mcoords):this.coords.offset(x&&x.x||0,x&&x.y||0),this.show(x,null,!0))},__setValue:function(z,
x){this[z].innerHTML="";var f="_dfd"+z,q=this[f];q&&-1===q.fired&&(q.cancel(),this[f]=null);u.isDefined(x)&&(x instanceof X?(this[f]=x,x.addCallbacks(this["__set"+z],this["__err"+z])):this.__render(z,x))},__set_title:function(z){this._dfd_title=null;this.__render("_title",z)},__err_title:function(z){this._dfd_title=null},__set_content:function(z){this._dfd_content=null;this.__render("_content",z)},__err_content:function(z){this._dfd_content=null},__render:function(z,x){var f=this[z];this.place(x,
f);this.isShowing&&(this.startupDijits(f),"_title"===z&&this._adjustContentArea&&this._adjustContentArea())}});return G.InfoWindowBase=O})},"esri/PopupBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has ./kernel ./graphic ./geometry/Point ./geometry/jsonUtils ./geometry/mathUtils ./geometry/webMercatorUtils ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./symbols/CartographicLineSymbol ./symbols/SimpleFillSymbol ./tasks/query ./Evented ./PopupInfo".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t){function k(m){return"sizeInfo"===m.type}O=O(t,{declaredClass:"esri.PopupBase",_featureLayers:{},_updateEndHandles:[],_mapLevelChangeHandle:null,_evtMap:{"set-features":!0,"clear-features":!0,"selection-change":!0,"dfd-complete":!0},onSetFeatures:function(){},onClearFeatures:function(){},onSelectionChange:function(){},onDfdComplete:function(){},initialize:function(){this.count=0;this.selectedIndex=-1;this.on("clear-features",F.hitch(this,this._resetUpdateEndListeners));
this.on("dfd-complete",F.hitch(this,this._processFeatures));this.on("set-features",F.hitch(this,this._processFeatures));this.on("selection-change",F.hitch(this,this._checkFeatureResolution))},cleanup:function(){this.features=this.deferreds=null;this._resetUpdateEndListeners();this._untrackMapLevelChange()},setFeatures:function(m){if(m&&m.length){this.clearFeatures(!0);var y,K;m[0]instanceof X?K=m:y=m;y?this._updateFeatures(null,y):(this.deferreds=K,K=K.slice(0),d.forEach(K,function(n){n.addBoth(F.hitch(this,
this._updateFeatures,n))},this))}},clearFeatures:function(m){this.features=this.deferreds=this._marked=null;this.count=0;var y=this.selectedIndex;this.selectedIndex=-1;if(-1<y)this.onSelectionChange();this.onClearFeatures({isIntermediate:!!m})},getSelectedFeature:function(){var m=this.features;if(m)return m[this.selectedIndex]},select:function(m){0>m||m>=this.count||(this.selectedIndex=m,this.onSelectionChange())},enableHighlight:function(m){this._highlighted=m.graphics.add(new P(new G(0,0,m.spatialReference)));
this._highlighted.attr("data-popup-highlight","");this._highlighted.hide();this._trackMapLevelChange(m);this.markerSymbol||(m=this.markerSymbol=new x,m.setStyle(x.STYLE_TARGET),m._setDim(16,16,0),m.setOutline(new q(f.STYLE_SOLID,new R([0,255,255]),2,q.CAP_ROUND,q.JOIN_ROUND)),m.setColor(new R([0,0,0,0])));this.lineSymbol||(this.lineSymbol=new f(f.STYLE_SOLID,new R([0,255,255]),2));this.fillSymbol||(this.fillSymbol=new h(h.STYLE_NULL,new f(f.STYLE_SOLID,new R([0,255,255]),2),new R([0,0,0,0])));this.clusterFillSymbol||
(this.clusterFillSymbol=new h(h.STYLE_SOLID,new f(f.STYLE_SOLID,new R([0,255,255]),1.33),null))},disableHighlight:function(m){var y=this._highlighted;y&&(y.hide(),m.graphics.remove(y),delete this._highlighted);this._untrackMapLevelChange();this.markerSymbol=this.lineSymbol=this.fillSymbol=null},showHighlight:function(){var m=this.features&&this.features[this.selectedIndex];this._highlighted&&m&&m.geometry&&this._highlighted.show()},hideHighlight:function(){this._highlighted&&this._highlighted.hide()},
updateHighlight:function(m,y){var K=y.geometry,n=this._highlighted;if(K&&n){n.hide();!n._graphicsLayer&&m&&m.graphics.add(n);n.setGeometry(u.fromJson(K.toJson()));switch(K.type){case "point":case "multipoint":var w=y.getLayer(),c=y.symbol||w&&w._getSymbol(y);if(w&&c){var D;K=c.xoffset||0;var E=c.yoffset||0,J=c.angle||0;switch(c.type){case "simplemarkersymbol":var A=D=c.size||0;break;case "picturemarkersymbol":A=c.width||0;D=c.height||0;break;case "textsymbol":A=D=c.font&&c.font.size||0}var S=y.symbol?
null:w._getRenderer(y);(w=this._getSizeInfo(S))?c=w=S.getSize(y,{sizeInfo:w,shape:c.style,resolution:m&&m.getResolutionInMeters&&m.getResolutionInMeters()}):null!=y.size?c=w=y.size:(c=A,w=D);S=this.markerSymbol;c&&w&&(K&&(K=K/A*c),E&&(E=E/D*w),S._setDim(c+4,w+4,0));S.setOffset(K,E);S.setAngle(J)}break;case "polyline":S=this.lineSymbol;break;case "polygon":S=this.fillSymbol}n.setSymbol(S)}else n&&n.hide()},showClosestFirst:function(m){var y=this.features;if(y&&y.length){if(1<y.length){var K,n=Infinity,
w=-1,c,D=C.getLength,E=m.spatialReference;m=m.normalize();for(K=y.length-1;0<=K;K--)if(c=y[K].geometry){var J=c.spatialReference;var A=0;try{var S="point"===c.type?c:c.getExtent().getCenter();S=S.normalize();E&&J&&!E.equals(J)&&E._canProject(J)&&(S=E.isWebMercator()?z.geographicToWebMercator(S):z.webMercatorToGeographic(S));A=D(m,S)}catch(H){}0<A&&A<n&&(n=A,w=K)}0<w&&(y.splice(0,0,y.splice(w,1)[0]),this.select(0))}}else this.deferreds&&(this._marked=m)},_trackMapLevelChange:function(m){this._untrackMapLevelChange();
this._mapLevelChangeHandle=m.on("extent-change",F.hitch(this,function(y){y.levelChange&&this._checkFeatureResolution()}))},_untrackMapLevelChange:function(){this._mapLevelChangeHandle&&(this._mapLevelChangeHandle.remove(),this._mapLevelChangeHandle=null)},_unbind:function(m){m=d.indexOf(this.deferreds,m);if(-1!==m)return this.deferreds.splice(m,1),this.deferreds.length?1:(this.deferreds=null,2)},_fireComplete:function(m){var y=this._marked;y&&(this._marked=null,this.showClosestFirst(y));this.onDfdComplete(m)},
_updateFeatures:function(m,y){if(m){if(this.deferreds){var K=this._unbind(m);if(K)if(y&&y instanceof Error){if(this._fireComplete(y),2===K)this.onSetFeatures()}else if(y&&y.length)if(this.features){var n=d.filter(y,function(w){return-1===d.indexOf(this.features,w)},this);this.features=this.features.concat(n);this.count=this.features.length;this._fireComplete();if(2===K)this.onSetFeatures()}else{this.features=y;this.count=y.length;this.selectedIndex=0;this._fireComplete();if(2===K)this.onSetFeatures();
this.select(0)}else if(this._fireComplete(),2===K)this.onSetFeatures()}}else this.features=y,this.count=y.length,this.selectedIndex=0,this.onSetFeatures(),this.select(0)},_getSizeInfo:function(m){return m?m.sizeInfo||d.filter(m.visualVariables,k)[0]:null},_resetUpdateEndListeners:function(){this._featureLayers={};d.forEach(this._updateEndHandles,function(m){m.remove()});this._updateEndHandles=[]},_processFeatures:function(){d.forEach(this.features,function(m){(m=m.getLayer())&&!this._featureLayers[m.id]&&
(1===m.currentMode||0===m.currentMode&&6===m.mode)&&m.objectIdField&&m.hasXYFootprint&&m.queryFeatures&&(this._featureLayers[m.id]=m,m=m.on("update-end",F.hitch(this,this._fLyrUpdateEndHandler)),this._updateEndHandles.push(m))},this)},_fLyrUpdateEndHandler:function(m){if(!m.error){var y=this,K=m.target,n=K.getSelectedFeatures(),w=0===K.currentMode&&6===K.mode,c={},D=[];d.forEach(this.features,function(E){if(E.getLayer()===K){var J=E.attributes[K.objectIdField];c[J]=E;D.push(J)}});D.length&&(m=new e,
m.objectIds=D,K.queryFeatures(m,function(E){d.forEach(E.features,function(J){var A=c[J.attributes[K.objectIdField]],S=!1;A.geometry!==J.geometry||K.hasWebGLSurface()?(A.setGeometry(J.geometry),S=!0):w&&n&&-1!==d.indexOf(n,J)&&(S=!0);S&&this._highlighted&&A===this.getSelectedFeature()&&this._highlighted.setGeometry(J.geometry)},y)}))}},_checkFeatureResolution:function(){var m=this.getSelectedFeature(),y=this.map;if(m&&y){var K=m.getLayer();if(K){var n=m.getResolution();2===K.currentMode&&m.geometry&&
n&&n>y.getResolution()&&(y=y.getResolutionForPopup(),(K=this._refetchFeature(m,y,K))&&K.then(F.hitch(this,this._updateFeatureResolution,m,y)))}}},_refetchFeature:function(m,y,K){if(m=this._createQueryForCustomResolution(m,y,K))return K.queryFeatures(m).then(function(n){return n&&n.features[0]})},_createQueryForCustomResolution:function(m,y,K){K=K.objectIdField;var n=m.attributes;n=n&&K&&n[K];if(null==n)return null;var w=new e;w.objectIds=[n];w.maxAllowableOffset=y;w.outFields=[K];w.outSpatialReference=
m.geometry.spatialReference;return w},_updateFeatureResolution:function(m,y,K){m.getResolution()!==y&&(m.setResolution(y),m.setGeometry(K.geometry),this._highlighted&&m===this.getSelectedFeature()&&this._highlighted.setGeometry(m.geometry))}});return V.PopupBase=O})},"esri/plugins/popupManager":function(){define(["../PopupManager"],function(O){return{add:function(F,d){F.popupManager||(F.popupManager=new O(d),F.popupManager.setMap(F))},remove:function(F){var d=F.popupManager;d&&(d.unsetMap(),F.popupManager=
void 0)}}})},"esri/PopupManager":function(){define("./geometry/Extent ./geometry/ScreenPoint ./kernel ./layerUtils ./tasks/query dijit/registry dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/_base/lang esri/sniff dojo/on dojo/promise/all dojo/Stateful require".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q){var h;P=P(f,{declaredClass:"esri.PopupManager",enabled:!1,map:null,_mapClickHandle:null,_featureLayersCache:{},constructor:function(e){this._mapClickHandler=u.hitch(this,this._mapClickHandler)},
setMap:function(e){if(this.map)if(e!==this.map)this.unsetMap();else return;this.map=e;this._setupClickHandler()},unsetMap:function(){this.map&&(this.map=null);this._mapClickHandle&&(this._mapClickHandle.remove(),this._mapClickHandle=null)},getMapLayer:function(e){var t;if(e&&(t=e.getLayer())&&(e=t.id,this._featureLayersCache[e])){var k=e.lastIndexOf("_");-1<k&&(e=e.substring(0,k),t=this.map.getLayer(e))}return t},_enabledSetter:function(e){this.enabled=e;this._setupClickHandler()},_setupClickHandler:function(){this._mapClickHandle&&
(this._mapClickHandle.remove(),this._mapClickHandle=null);this.enabled&&this.map&&(this._mapClickHandle=this.map.on("click",this._mapClickHandler))},_mapClickHandler:function(e){var t=this.map.infoWindow,k=e.graphic;t&&this.map.loaded&&(t.clearFeatures&&t.setFeatures?this._showPopup(e):k&&k.getInfoTemplate()&&this._showInfoWindow(k,e.mapPoint))},_showPopup:function(e){var t=this.map,k=t.infoWindow,m=this,y=[],K=[t.graphics].concat(V.map(t.graphicsLayerIds,t.getLayer,t));V.forEach(K,function(c){var D=
c.getFeatureReduction&&c.getFeatureReduction();c&&c.loaded&&c.infoTemplate&&!c.suspended&&(!D||!m._isReductionEnabled(c)||D.infoTemplate&&!D.disablePopup)&&y.push(c)});var n=[];V.forEach(t.layerIds,function(c){(c=t.getLayer(c))&&c.loaded&&!c.suspended&&(m._isImageServiceLayer(c)&&c.infoTemplate?y.push(c):"esri.layers.WMSLayer"===c.declaredClass&&c.getFeatureInfoURL?y.push(c):"esri.layers.ArcGISDynamicMapServiceLayer"!==c.declaredClass&&"esri.layers.ArcGISTiledMapServiceLayer"!==c.declaredClass||!c.infoTemplates||
n.push(c))});var w=t.getResolutionForPopup();this._getSubLayerFeatureLayers(n,w).then(function(c){y=y.concat(c);c=e.graphic&&e.graphic.getParentGraphic()||e.graphic;var D=null;c&&c.getInfoTemplate()&&!m._isImageServiceLayer(c.getLayer())&&(D=c);if(y.length||D){var E=m._calculateClickTolerance(y),J=e.screenPoint;c=t.toMap(new F(J.x-E,J.y+E));E=t.toMap(new F(J.x+E,J.y-E));var A=new O(c.x,c.y,E.x,E.y,t.spatialReference);if(A=A.intersects(t.extent)){var S=new X,H=!!D,ea=!0;c=V.map(y,function(L){S.timeExtent=
L.useMapTime?t.timeExtent:null;var v=m._isReductionEnabled(L);L=v?L.getFeatureReductionLayer():L;var b=m._featureLayersCache[L.id];if(m._isImageServiceLayer(L)){S.geometry=e.mapPoint;ea=!1;var g={rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0};m._isTiledImageServiceLayer(L)?g=L.fetchPopupFromTiles(S):(g=L.queryVisibleRasters(S,g),g.addCallback(function(){var N=L.getVisibleRasters();H=H||0<N.length;return N}))}else if("esri.layers.WMSLayer"===L.declaredClass){g=new G;var W=L._getPopupGraphic(t,
e.screenPoint);W?(g.resolve([W]),H=!0):g.resolve([])}else b||"function"===typeof L.queryFeatures&&(0===L.currentMode||1===L.currentMode)?(S.geometry=A,g=L.queryFeatures(S),g.addCallback(function(N){var U=[];V.forEach(N.features,function(M){M.visible&&(U.push(M),b&&M.setResolution(w))});H=H||0<U.length;return U})):(g=new G,W=V.filter(L.graphics,function(N){return N&&N.visible&&A.intersects(N.geometry)}),v&&m._isParentLayer(L,D)&&(v=m._findGraphicById(W,D,"cluster_id"))&&(D=v),H=H||0<W.length,g.resolve(W));
return g});D&&(E=new G,E.resolve([D]),c.unshift(E));V.some(c,function(L){return!L.isFulfilled()})||H?(k.setFeatures(c),k.show(e.mapPoint,{closestFirst:ea})):(k.hide(),k.clearFeatures())}}})},_getSubLayerFeatureLayers:function(e,t,k){t=t||null;var m=k||new G,y=[];k=e.length;var K=this.map.getScale(),n=!1,w=this,c=0;a:for(;c<k;c++){var D=e[c],E=D.dynamicLayerInfos||D.layerInfos;if(E){var J=null;D._params&&(D._params.layers||D._params.dynamicLayers)&&(J=D.visibleLayers);J=R._getVisibleLayers(E,J);for(var A=
R._getLayersForScale(K,E),S=E.length,H=0;H<S;H++){var ea=E[H],L=ea.id,v=D.infoTemplates[L];if(!ea.subLayerIds&&v&&v.infoTemplate&&-1<V.indexOf(J,L)&&-1<V.indexOf(A,L)){if(!h){n=!0;break a}var b=D.id+"_"+L,g=this._featureLayersCache[b];g&&g.loadError||(g||((g=v.layerUrl)||(g=ea.source?this._getLayerUrl(D.url,"/dynamicLayer"):this._getLayerUrl(D.url,L)),g=new h(g,{parentLayer:D,id:b,drawMode:!1,mode:h.MODE_SELECTION,outFields:this._getOutFields(v.infoTemplate),resourceInfo:v.resourceInfo,source:ea.source}),
this._featureLayersCache[b]=g),g.setDefinitionExpression(D.layerDefinitions&&D.layerDefinitions[L]),g.setGDBVersion(D.gdbVersion),g.setInfoTemplate(v.infoTemplate),g.setMaxAllowableOffset(t),g.setUseMapTime(!!D.useMapTime),D.layerDrawingOptions&&D.layerDrawingOptions[L]&&D.layerDrawingOptions[L].renderer&&g.setRenderer(D.layerDrawingOptions[L].renderer),y.push(g))}}}}if(n){var W=new G;q(["./layers/FeatureLayer"],function(U){h=U;W.resolve()});W.then(function(){w._getSubLayerFeatureLayers(e,t,m)})}else{var N=
[];V.forEach(y,function(U){if(!U.loaded){var M=new G;z.once(U,"load, error",function(){M.resolve()});N.push(M.promise)}});N.length?x(N).then(function(){y=V.filter(y,function(U){return!U.loadError&&U.isVisibleAtScale(K)});m.resolve(y)}):(y=V.filter(y,function(U){return U.isVisibleAtScale(K)}),m.resolve(y))}return m.promise},_getLayerUrl:function(e,t){var k=e.indexOf("?");return-1===k?e+"/"+t:e.substring(0,k)+"/"+t+e.substring(k)},_getOutFields:function(e){var t=e.info&&e.info.fieldInfos;if(t&&t.length&&
"esri.dijit.PopupTemplate"===e.declaredClass){var k=[];V.forEach(t,function(m){var y=m.fieldName&&m.fieldName.toLowerCase();y&&"shape"!==y&&0!==y.indexOf("relationships/")&&k.push(m.fieldName)})}else k=["*"];return k},_calculateClickTolerance:function(e){var t=C("esri-touch")?9:6,k,m;V.forEach(e,function(y){if(k=y.renderer)"esri.renderer.SimpleRenderer"===k.declaredClass?((m=k.symbol)&&m.xoffset&&(t=Math.max(t,Math.abs(m.xoffset))),m&&m.yoffset&&(t=Math.max(t,Math.abs(m.yoffset)))):"esri.renderer.UniqueValueRenderer"!==
k.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==k.declaredClass||V.forEach(k.infos,function(K){(m=K.symbol)&&m.xoffset&&(t=Math.max(t,Math.abs(m.xoffset)));m&&m.yoffset&&(t=Math.max(t,Math.abs(m.yoffset)))})});return t},_showInfoWindow:function(e,t){var k=this.map.infoWindow,m=e.geometry;m=m&&"point"===m.type?m:t;var y=e.getContent();k.setTitle(e.getTitle());if(y&&u.isString(y.id)){var K=ba.byId(y.id);K&&K.set&&/_PopupRenderer/.test(K.declaredClass)&&K.set("showTitle",!1)}k.setContent(y);k.show(m)},
_findGraphicById:function(e,t,k){var m,y=(t=t.attributes)&&t[k];V.some(e,function(K){var n=K.attributes;n&&n[k]===y&&(m=K);return!!m});return m},_isParentLayer:function(e,t){var k=t&&t.getLayer();return e&&k===e},_isReductionEnabled:function(e){return e&&e.isFeatureReductionActive&&e.isFeatureReductionActive()},_isImageServiceLayer:function(e){return"esri.layers.ArcGISImageServiceLayer"===e.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===e.declaredClass||"esri.layers.RasterXLayer"===
e.declaredClass},_isTiledImageServiceLayer:function(e){return"esri.layers.RasterXLayer"===e.declaredClass}});return d.PopupManager=P})},"esri/MapNavigationManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/mouse dojo/keys dijit/focus ./kernel ./MouseEvents ./TouchEvents ./PointerEvents ./config ./sniff ./lang ./fx ./graphic ./tileUtils ./geometry/ScreenPoint ./geometry/Extent ./geometry/Rect ./geometry/mathUtils ./symbols/SimpleFillSymbol".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n){var w=R.connect,c=R.disconnect,D=f("chrome"),E=f("safari"),J=[V.NUMPAD_PLUS,61,187,V.NUMPAD_MINUS,173,189,V.UP_ARROW,V.NUMPAD_8,V.RIGHT_ARROW,V.NUMPAD_6,V.DOWN_ARROW,V.NUMPAD_2,V.LEFT_ARROW,V.NUMPAD_4,V.PAGE_UP,V.NUMPAD_9,V.PAGE_DOWN,V.NUMPAD_3,V.END,V.NUMPAD_1,V.HOME,V.NUMPAD_7];O=O(null,{declaredClass:"esri.MapNavigationManager",eventModel:"",constructor:function(A,S){this.map=A;F.mixin(this,S);var H=A.__container;f("esri-pointer")?(this.pointerEvents=
new z(H,{map:A}),this.eventModel="pointer"):f("esri-touch")?(f("ios")||(this.mouseEvents=new u(H,{map:A})),this.touchEvents=new C(H,{map:A,mouseEvents:this.mouseEvents}),this.eventModel="touch"):(this.mouseEvents=new u(H,{map:A}),this.eventModel="mouse");this._zoomRect=new e(null,new n(x.defaults.map.zoomSymbol));this._keyDx=this._keyDy=0;this._adjustPinch=F.hitch(this,this._adjustPinch);this._adjustPinchEnd=F.hitch(this,this._adjustPinchEnd)},_panInit:function(A){var S=this.mouseEvents;ba.isLeft(A)&&
this.map.isPan&&!A.shiftKey&&(this._dragOrigin=new k(0,0),F.mixin(this._dragOrigin,A.screenPoint),c(this._panStartHandle),c(this._panHandle),c(this._panEndHandle),this._panStartHandle=w(S,"onMouseDragStart",this,this._panStart),this._panHandle=w(S,"onMouseDrag",this,this._pan),this._panEndHandle=w(S,"onMouseUp",this,this._panEnd),D||E)&&(A.preventDefault(),P.curNode&&P.curNode.blur())},_panStart:function(A){this.map.setCursor("move");this.map.__panStart(A.screenPoint.x,A.screenPoint.y)},_pan:function(A){this.map.__pan(A.screenPoint.x-
this._dragOrigin.x,A.screenPoint.y-this._dragOrigin.y)},_panEnd:function(A){c(this._panStartHandle);c(this._panHandle);c(this._panEndHandle);this._panStartHandle=this._panHandle=this._panEndHandle=null;var S=this.map;S.__panning&&(S.__panEnd(A.screenPoint.x-this._dragOrigin.x,A.screenPoint.y-this._dragOrigin.y),S.resetMapCursor())},_zoomInit:function(A){var S=this.map,H=this.pointerEvents||this.mouseEvents;(ba.isLeft(A)||A.pointerType)&&S.isRubberBandZoom&&A.shiftKey&&(S.setCursor("crosshair"),this._dragOrigin=
F.mixin({},A.screenPoint),this._zoomDir=A.ctrlKey||A.metaKey?-1:1,this.pointerEvents?(this._zoomHandle=w(H,"onSwipeMove",this,this._zoom),this._zoomEndHandle=w(H,"onSwipeEnd",this,this._zoomEnd)):(this._zoomHandle=w(H,"onMouseDrag",this,this._zoom),this._zoomEndHandle=w(H,"onMouseUp",this,this._zoomEnd)),D&&A.preventDefault())},_zoom:function(A){var S=this.map,H=this._normalizeRect(A).offset(S.__visibleRect.x,S.__visibleRect.y);A=S.graphics;var ea=this._zoomRect;ea.geometry||S.setCursor("crosshair");
ea.geometry&&A.remove(ea,!0);var L=S.toMap(new k(H.x,H.y));H=S.toMap(new k(H.x+H.width,H.y+H.height));H=new y(L.x,L.y,H.x-L.x,L.y-H.y,S.spatialReference);H._originOnly=!0;ea.setGeometry(H);A.add(ea,!0)},_zoomEnd:function(A){var S=this._zoomRect,H=this.map,ea=H.extent,L=H.spatialReference;c(this._zoomHandle);c(this._zoomEndHandle);this._zoomHandle=this._zoomEndHandle=null;if(H._canZoom(this._zoomDir)&&S.getDojoShape()){H.graphics.remove(S);S.geometry=null;A=this._normalizeRect(A);A.x+=H.__visibleRect.x;
A.y+=H.__visibleRect.y;if(-1===this._zoomDir){var v=ea.getWidth();A=(v*H.width/A.width-v)/2;L=new m(ea.xmin-A,ea.ymin-A,ea.xmax+A,ea.ymax+A,L)}else ea=H.toMap({x:A.x,y:A.y+A.height}),A=H.toMap({x:A.x+A.width,y:A.y}),L=new m(ea.x,ea.y,A.x,A.y,L);H._extentUtil(null,null,L)}S.getDojoShape()&&H.graphics.remove(S,!0);this._zoomDir=0;H.resetMapCursor()},_wheelZoom:function(A,S){var H=this.map;if(!S){if(H.smartNavigation&&!A.shiftKey&&!H._isPanningOrZooming()){H.disableScrollWheelZoom();this._setScrollWheelPan(!0);
this._wheelPan(A);return}var ea=A.timeStamp;if(!q.isDefined(ea)||0>=ea)ea=(new Date).getTime();if(100>(this._mwts?ea-this._mwts:ea))return;this._mwts=ea}H._canZoom(A.value)&&H._extentUtil({numLevels:A.value,mapAnchor:A.mapPoint,screenAnchor:A.screenPoint})},_wheelPan:function(A){var S=this.map;if(A.shiftKey&&!S._isPanningOrZooming())this._setScrollWheelPan(!1),S.enableScrollWheelZoom(),this._wheelZoom(A);else{var H=0,ea=0;f("ff")?A.axis===A.HORIZONTAL_AXIS?H=-A.detail:ea=-A.detail:(H=A.wheelDeltaX,
ea=A.wheelDeltaY);S.translate(H,ea)}},_setScrollWheelPan:function(A){this.map.isScrollWheelPan=A;this.mouseEvents&&this.mouseEvents.enableMouseWheel(A);c(this._mwMacHandle);this._mwMacHandle=null;A&&(this._mwMacHandle=w(this.mouseEvents||this.pointerEvents,"onMouseWheel",this,this._wheelPan))},_recenter:function(A){A.shiftKey&&!this.map._isPanningOrZooming()&&this.map.centerAt(A.mapPoint)},_recenterZoom:function(A){A.shiftKey&&!this.map._isPanningOrZooming()&&(A.value=A.ctrlKey||A.metaKey?-1:1,this._wheelZoom(A,
!0))},_dblClickZoom:function(A){this.map._isPanningOrZooming()||(A.value=1,this._wheelZoom(A,!0))},_twoFingerTap:function(A){this.map._isPanningOrZooming()||(A.value=-1,this._wheelZoom(A,!0))},_keyDown:function(A){var S=A.keyCode,H=this.map;if(-1!==d.indexOf(J,S)){if(S===V.NUMPAD_PLUS||61===S||187===S)H._extentUtil({numLevels:1});else if(S===V.NUMPAD_MINUS||173===S||189===S)H._extentUtil({numLevels:-1});else{H.__panning||H.__panStart(0,0);switch(S){case V.UP_ARROW:case V.NUMPAD_8:this._keyDy+=10;
break;case V.RIGHT_ARROW:case V.NUMPAD_6:this._keyDx-=10;break;case V.DOWN_ARROW:case V.NUMPAD_2:this._keyDy-=10;break;case V.LEFT_ARROW:case V.NUMPAD_4:this._keyDx+=10;break;case V.PAGE_UP:case V.NUMPAD_9:this._keyDx-=10;this._keyDy+=10;break;case V.PAGE_DOWN:case V.NUMPAD_3:this._keyDx-=10;this._keyDy-=10;break;case V.END:case V.NUMPAD_1:this._keyDx+=10;this._keyDy-=10;break;case V.HOME:case V.NUMPAD_7:this._keyDx+=10;this._keyDy+=10;break;default:return}H.__pan(this._keyDx,this._keyDy)}X.stop(A)}},
_keyEnd:function(A){var S=this.map;S.__panning&&A.keyCode!==V.SHIFT&&(S.__panEnd(this._keyDx,this._keyDy),this._keyDx=this._keyDy=0)},_swipeInit:function(A){var S=this.map;S=S._zoomAnim||S._panAnim;if(A.shiftKey)return!1;S&&S._active&&(S.stop(),S._fire("onEnd",[S.node]));this._dragOrigin=new k(0,0);F.mixin(this._dragOrigin,A.screenPoint);c(this._swipeHandle);c(this._swipeEndHandle);this._swipeHandle=w(this.touchEvents||this.pointerEvents,"onSwipeMove",this,this._swipe);this._swipeEndHandle=w(this.touchEvents||
this.pointerEvents,"onSwipeEnd",this,this._swipeEnd)},_swipe:function(A){var S=this.map;S.__panning?(this._panX=A.screenPoint.x,this._panY=A.screenPoint.y,S.__pan(A.screenPoint.x-this._dragOrigin.x,A.screenPoint.y-this._dragOrigin.y)):(S.setCursor("move"),S.__panStart(A.screenPoint.x,A.screenPoint.y))},_swipeEnd:function(A){c(this._swipeHandle);c(this._swipeEndHandle);this._swipeHandle=this._swipeEndHandle=null;var S=this.map;S.__panning&&(S.resetMapCursor(),S.__panEnd(A.screenPoint.x-this._dragOrigin.x,
A.screenPoint.y-this._dragOrigin.y))},_pinchInit:function(A){var S=this.map,H=S._zoomAnim||S._panAnim;H&&H._active?(H.stop(),H._fire("onEnd",[H.node])):S.__panning&&(A.screenPoint=new k(this._panX,this._panY),A.mapPoint=S.toMap(A.screenPoint),this._swipeEnd(A));c(this._pinchHandle);c(this._pinchEndHandle);this._pinchHandle=w(this.touchEvents||this.pointerEvents,"onPinchMove",this,this._pinch);this._pinchEndHandle=w(this.touchEvents||this.pointerEvents,"onPinchEnd",this,this._pinchEnd)},_pinch:function(A){var S=
this.map;if(A.screenPoints){this.currLength=K.getLength(A.screenPoints[0],A.screenPoints[1]);if(S.__zooming){var H=this.currLength/this._length;this._zoomStartExtent=this.__scaleExtent(S.extent,H,this._dragOrigin);S.__zoom(this._zoomStartExtent,H,this._dragOrigin)}else this._dragOrigin=new k((A.screenPoints[0].x+A.screenPoints[1].x)/2,(A.screenPoints[0].y+A.screenPoints[1].y)/2),this._length=this.currLength,S.__zoomStart(S.extent,this._dragOrigin);this._pinchScale=H;S._fireOnScale(this.currLength/
this._length,this._dragOrigin,!0)}},_pinchEnd:function(A){A=this.map;c(this._pinchHandle);c(this._pinchEndHandle);this._pinchHandle=this._pinchEndHandle=null;this._pinchScale=0;if(A.__zooming&&null===A._zoomAnim){var S=this.currLength/this._length,H=A.extent.getWidth();this._zoomAnimAnchor=A.toMap(this._dragOrigin);this._zoomStartExtent=this.__scaleExtent(A.extent,1/S,this._zoomAnimAnchor);if(A.__tileInfo){var ea=t.getCandidateTileInfo(A,A.__tileInfo,this._zoomStartExtent),L=A.__getExtentForLevel(ea.lod.level,
this._zoomAnimAnchor),v=A.getMinZoom(),b=A.getMaxZoom(),g=L.extent;L=L.lod;var W=H/g.getWidth(),N=ea.lod.level;1>S?W>S&&N--:W<S&&N++;N<v?N=v:N>b&&(N=b);N!==ea.lod.level&&(L=A.__getExtentForLevel(N,this._zoomAnimAnchor),g=L.extent,L=L.lod);this._zoomEndExtent=g;this._zoomEndLod=L;A._zoomAnim=h.animateRange({range:{start:H/this._zoomStartExtent.getWidth(),end:W},duration:x.defaults.map.zoomDuration,rate:x.defaults.map.zoomRate,onAnimate:this._adjustPinch,onEnd:this._adjustPinchEnd});A._zoomAnim.play();
A._fireOnScale(A.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin)}else this._zoomEndExtent=this._zoomStartExtent,A._fireOnScale(A.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin),this._adjustPinchEnd()}},_adjustPinch:function(A){var S=this.__scaleExtent(this.map.extent,A,this._zoomAnimAnchor);this.map.__zoom(S,A,this._dragOrigin)},_adjustPinchEnd:function(){var A=this.map,S=A.extent.getWidth()/this._zoomEndExtent.getWidth(),H=this.__scaleExtent(A.extent,1/S,this._zoomAnimAnchor),
ea=this._dragOrigin,L=this._zoomEndLod;this._zoomStartExtent=this._zoomEndExtent=this._zoomEndLod=this._dragOrigin=A._zoomAnim=this._zoomAnimAnchor=null;A.__zoomEnd(H,S,ea,L,!0)},__scaleExtent:function(A,S,H){H=H||A.getCenter();S=A.expand(S);var ea=A.xmin-(S.getWidth()-A.getWidth())*(H.x-A.xmin)/A.getWidth();H=A.ymax-(S.getHeight()-A.getHeight())*(H.y-A.ymax)/A.getHeight();return new m(ea,H-S.getHeight(),ea+S.getWidth(),H,A.spatialReference)},_normalizeRect:function(A){A=A.screenPoint;var S=this._dragOrigin.x,
H=this._dragOrigin.y;A=new y((A.x<S?A.x:S)-this.map.__visibleRect.x,(A.y<H?A.y:H)-this.map.__visibleRect.y,Math.abs(A.x-S),Math.abs(A.y-H));delete A.spatialReference;0===A.width&&(A.width=1);0===A.height&&(A.height=1);return A},setImmediateClick:function(A){switch(this.eventModel){case "mouse":this.mouseEvents.setImmediateClick(A);break;case "touch":this.touchEvents.setImmediateTap(A);this.mouseEvents&&this.mouseEvents.setImmediateClick(A);break;case "pointer":this.pointerEvents.setImmediateTap(A)}},
enablePan:function(){this.disablePan();switch(this.eventModel){case "mouse":this._panInitHandle=w(this.mouseEvents,"onMouseDown",this,this._panInit);break;case "touch":this._panInitHandle=w(this.mouseEvents,"onMouseDown",this,this._panInit);this._swipeInitHandle=w(this.touchEvents,"onSwipeStart",this,this._swipeInit);break;case "pointer":this._swipeInitHandle=w(this.pointerEvents,"onSwipeStart",this,this._swipeInit)}},disablePan:function(){c(this._panInitHandle);this._panInitHandle=null;c(this._swipeInitHandle);
this._swipeInitHandle=null},enableRubberBandZoom:function(){this.disableRubberBandZoom();this._zoomInitHandle=this.pointerEvents?w(this.pointerEvents,"onSwipeStart",this,this._zoomInit):w(this.mouseEvents,"onMouseDown",this,this._zoomInit)},disableRubberBandZoom:function(){c(this._zoomInitHandle);this._zoomInitHandle=null},enablePinchZoom:function(){this.disablePinchZoom();if("touch"===this.eventModel||"pointer"===this.eventModel)this._pinchInitHandle=w(this.touchEvents||this.pointerEvents,"onPinchStart",
this,this._pinchInit)},disablePinchZoom:function(){c(this._pinchInitHandle);this._pinchInitHandle=null},enableScrollWheelZoom:function(){this.disableScrollWheelZoom();this._wheelHandle=w(this.mouseEvents||this.pointerEvents,"onMouseWheel",this,this._wheelZoom)},disableScrollWheelZoom:function(){c(this._wheelHandle);this._wheelHandle=null},enableScrollWheelPan:function(){var A=this.map;A&&A.loaded&&A.smartNavigation&&(this.disableScrollWheelPan(),this._setScrollWheelPan(!0))},disableScrollWheelPan:function(){var A=
this.map;A&&A.loaded&&A.smartNavigation&&this._setScrollWheelPan(!1)},enableDoubleClickZoom:function(){this.disableDoubleClickZoom();switch(this.eventModel){case "mouse":this._dblClickHandle=w(this.mouseEvents,"onDblClick",this,this._dblClickZoom);break;case "touch":this._dblClickHandle=w(this.mouseEvents,"onDblClick",this,this._dblClickZoom);this._dblTapHandle=w(this.touchEvents,"onDoubleTap",this,this._dblClickZoom);this._zoomOutHandle=w(this.touchEvents,"onTwoFingerTap",this,this._twoFingerTap);
break;case "pointer":this._dblTapHandle=w(this.pointerEvents,"onDoubleTap",this,this._dblClickZoom),this._zoomOutHandle=w(this.pointerEvents,"onTwoFingerTap",this,this._twoFingerTap)}},disableDoubleClickZoom:function(){c(this._dblClickHandle);c(this._zoomOutHandle);this._dblTapHandle&&c(this._dblTapHandle);this._dblClickHandle=this._zoomOutHandle=this._dblTapHandle=null},enableShiftDoubleClickZoom:function(){this.disableShiftDoubleClickZoom();this._sDblClickHandle=w(this.pointerEvents||this.mouseEvents,
"onDblClick",this,this._recenterZoom)},disableShiftDoubleClickZoom:function(){c(this._sDblClickHandle);this._sDblClickHandle=null},enableClickRecenter:function(){this.disableClickRecenter();this._recenterHandle=w(this.pointerEvents||this.mouseEvents,"onClick",this,this._recenter)},disableClickRecenter:function(){c(this._recenterHandle);this._recenterHandle=null},enableKeyboardNavigation:function(){this.disableKeyboardNavigation();this._keyHandle=w(this.pointerEvents||this.mouseEvents,"onKeyDown",
this,this._keyDown);this._keyEndHandle=w(this.pointerEvents||this.mouseEvents,"onKeyUp",this,this._keyEnd)},disableKeyboardNavigation:function(){c(this._keyHandle);c(this._keyEndHandle);this._keyHandle=this._keyEndHandle=null},enableScrollWheel:function(){var A=this.map;A&&(A.smartNavigation?this.enableScrollWheelPan():A.enableScrollWheelZoom())},disableScrollWheel:function(){var A=this.map;A&&(A.disableScrollWheelZoom(),A.smartNavigation&&this.disableScrollWheelPan())},enableNavigation:function(){var A=
this.map;A&&A.loaded&&(A._evalNavigationFeature("DoubleClickZoom"),A._evalNavigationFeature("ClickRecenter"),A._evalNavigationFeature("Pan"),A._evalNavigationFeature("RubberBandZoom"),A._evalNavigationFeature("PinchZoom"),A._evalNavigationFeature("KeyboardNavigation"),A._evalNavigationFeature("ScrollWheel"))},disableNavigation:function(){var A=this.map;A&&A.loaded&&(A._evalNavigationFeature("DoubleClickZoom"),A._evalNavigationFeature("ClickRecenter"),A._evalNavigationFeature("Pan"),A._evalNavigationFeature("RubberBandZoom"),
A._evalNavigationFeature("PinchZoom"),A._evalNavigationFeature("KeyboardNavigation"),A._evalNavigationFeature("ScrollWheel"))},destroy:function(){this.touchEvents&&this.touchEvents.destroy();this.mouseEvents&&this.mouseEvents.destroy();this.pointerEvents&&this.pointerEvents.destroy();var A,S=[this._panInitHandle,this._panStartHandle,this._panHandle,this._panEndHandle,this._zoomInitHandle,this._zoomHandle,this._zoomEndHandle,this._wheelHandle,this._mwMacHandle,this._dblClickHandle,this._zoomOutHandle,
this._recenterHandle,this._sDblClickHandle,this._dblTapHandle,this._keyHandle,this._keyEndHandle,this._swipeInitHandle,this._swipeHandle,this._swipeEndHandle,this._pinchInitHandle,this._pinchHandle,this._pinchEndHandle];for(A=0;A<S.length;A++)c(S[A]);this.map=this.touchEvents=this.mouseEvents=this.eventModel=this.pointerEvents=this._zoomRect=this._dragOrigin=this._panInitHandle=this._panStartHandle=this._panHandle=this._panEndHandle=this._zoomInitHandle=this._zoomHandle=this._zoomEndHandle=this._wheelHandle=
this._mwMacHandle=this._dblClickHandle=this._zoomOutHandle=this._recenterHandle=this._sDblClickHandle=this._dblTapHandle=this._keyHandle=this._keyEndHandle=this._swipeInitHandle=this._swipeHandle=this._swipeEndHandle=this._pinchInitHandle=this._pinchHandle=this._pinchEndHandle=null}});return G.MapNavigationManager=O})},"esri/MouseEvents":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/sniff dojo/_base/connect dojo/_base/event ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),
function(O,F,d,R,X,ba,V,P,G,u){var C=X.connect,z=X.disconnect;O=O([P],{declaredClass:"esri.MouseEvents",doubleClickDuration:300,minWheelValue:1,maxWheelValue:1,mozWheelDivisor:-1!==R("mac")?1:3,wheelDivisor:2>R("chrome")?360:120,preventPageScroll:!0,map:null,constructor:function(x,f){this.node=x;d.mixin(this,f);var q=function(h){ba.stop(h);return!1};R("mozilla")&&F.style(x,"MozUserSelect","none");this._handles=[C(x,"onselectstart",q),C(x,"ondragstart",q),C(x,"onmouseenter",this,this._onMouseEnterHandler),
C(x,"onmouseleave",this,this._onMouseLeaveHandler),C(x,"onmousedown",this,this._onMouseDownHandler),C(x,"onclick",this,this._onClickHandler),C(x,"ondblclick",this,this._onDblClickHandler)];this._onMouseMoveHandler_connect=C(x,"onmousemove",this,this._onMouseMoveHandler);this._onMouseUpHandler_connect=C(x,"onmouseup",this,this._onMouseUpHandler);this._fireClickEvent=d.hitch(this,this._fireClickEvent);this._initialDuration=this.doubleClickDuration;this.preventPageScroll=(q=this.map)?q.isScrollWheelZoom||
q.isScrollWheelPan:this.preventPageScroll;this.enableMouseWheel(!1)},_fire:function(x,f){if(!this._preventClick||"onClick"!==x&&"onDblClick"!==x){if(this[x])this[x](f);if(this.map&&this.map[x])this.map[x](f)}},_processEvent:function(x){x=ba.fix(x,x.target);var f=this.map,q=f&&f.position;q&&("DOMMouseScroll"===x.type&&3>R("ff")?x.screenPoint=new u(window.scrollX+x.screenX-q.x,window.scrollY+x.screenY-q.y):x.screenPoint=new u(x.pageX-q.x,x.pageY-q.y),x.mapPoint=f.extent?f.toMap(x.screenPoint):new G);
x.numPoints=0;return x},_onMouseEnterHandler:function(x){z(this._onKeyDown_connect);z(this._onKeyUp_connect);this._onKeyDown_connect=C(document,"onkeydown",this,this._onKeyDownHandler);this._onKeyUp_connect=C(document,"onkeyup",this,this._onKeyUpHandler);this._fire("onMouseOver",this._processEvent(x))},_onMouseLeaveHandler:function(x){z(this._onKeyDown_connect);z(this._onKeyUp_connect);this._onKeyDown_connect=this._onKeyUp_connect=null;this._fire("onMouseOut",this._processEvent(x))},_onMouseMoveHandler:function(x){this._dragEnd?
this._dragEnd=!1:this._fire("onMouseMove",this._processEvent(x))},_onMouseDownHandler:function(x){z(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=null;this.node.setCapture&&this.node.setCapture(!1);z(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=C(document,"onmousemove",this,this._onMouseDragHandler);this._startX=x.pageX;this._startY=x.pageY;this._fire("onMouseDown",this._processEvent(x))},_onMouseUpHandler:function(x){var f=this.node;f.releaseCapture&&f.releaseCapture();
z(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=null;z(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=C(f,"onmousemove",this,this._onMouseMoveHandler);this._fire("onMouseUp",this._processEvent(x))},_onMouseDragHandler:function(x){z(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=C(document,"onmousemove",this,this._onMouseDraggingHandler);z(this._onMouseUpHandler_connect);this._onMouseUpHandler_connect=C(document,"onmouseup",this,this._onDragMouseUpHandler);
this._docLeaveConnect=C(document,"onmouseout",this,this._onDocMouseOut);this._fire("onMouseDragStart",this._processEvent(x))},_onMouseDraggingHandler:function(x){ba.stop(x);this._fire("onMouseDrag",this._processEvent(x))},_onDragMouseUpHandler:function(x){var f=this.node;f.releaseCapture&&f.releaseCapture();this._dragEnd=!0;z(this._docLeaveConnect);z(this._onMouseDragHandler_connect);z(this._onMouseUpHandler_connect);this._docLeaveConnect=this._onMouseDragHandler_connect=null;this._onMouseMoveHandler_connect=
C(f,"onmousemove",this,this._onMouseMoveHandler);this._onMouseUpHandler_connect=C(f,"onmouseup",this,this._onMouseUpHandler);x=this._processEvent(x);this._fire("onMouseDragEnd",x);this._fire("onMouseUp",x)},_onDocMouseOut:function(x){var f=9>R("ie")?x.toElement:x.relatedTarget,q=f&&f.nodeName.toLowerCase();(!f||(R("chrome")||R("safari"))&&"html"===q)&&this._onDragMouseUpHandler(x)},_onClickHandler:function(x){x=this._processEvent(x);if(x.pageX===this._startX&&x.pageY===this._startY){clearTimeout(this._clickTimer);
var f={},q="movementX"in x,h;for(h in x)"mozInputSource"===h||"mozPressure"===h||q&&("webkitMovementX"===h||"webkitMovementY"===h)||(f[h]=x[h]);this._clickEvent=f;this._clickTimer=setTimeout(this._fireClickEvent,this.doubleClickDuration)}},_fireClickEvent:function(){clearTimeout(this._clickTimer);9>R("ie")&&(this._clickEvent.graphic=V._ieGraphic,delete V._ieGraphic);this._fire("onClick",this._clickEvent)},_onDblClickHandler:function(x){clearTimeout(this._clickTimer);this._fire("onDblClick",this._processEvent(x))},
_onMouseWheelHandler:function(x){var f=this.map;(f?f.isScrollWheelZoom||f.isScrollWheelPan:this.preventPageScroll)&&ba.stop(x);f=R("ff")||R("mozilla")?-x.detail/this.mozWheelDivisor:x.wheelDelta/this.wheelDivisor;var q=Math.abs(f);q=q<=this.minWheelValue?this.minWheelValue:this.maxWheelValue;x.value=0>f?-q:q;this._fire("onMouseWheel",this._processEvent(x))},_onKeyDownHandler:function(x){this._fire("onKeyDown",x)},_onKeyUpHandler:function(x){this._fire("onKeyUp",x)},enableMouseWheel:function(x){z(this._scrollHandle);
this._scrollHandle=C(this.node,R("ff")||R("mozilla")?x?"MozMousePixelScroll":"DOMMouseScroll":"onmousewheel",this,this._onMouseWheelHandler)},setImmediateClick:function(x){this.doubleClickDuration=x?0:this._initialDuration},preventClickEvents:function(x){this._preventClick=x},destroy:function(){var x=this._handles.concat([this._onMouseMoveHandler_connect,this._onMouseUpHandler_connect,this._onMouseDragHandler_connect,this._scrollHandle,this._onKeyDown_connect,this._onKeyUp_connect,this._docLeaveConnect]),
f;for(f=0;f<x.length;f++)z(x[f]);clearTimeout(this._clickTimer);this.node=this.map=this._handles=this._clickEvent=this._onMouseMoveHandler_connect=this._onMouseUpHandler_connect=this._onMouseDragHandler_connect=this._scrollHandle=this._onKeyDown_connect=this._onKeyUp_connect=this._docLeaveConnect=null}});return V.MouseEvents=O})},"esri/TouchEvents":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/sniff dojo/dom ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),
function(O,F,d,R,X,ba,V,P,G){O=O([V],{declaredClass:"esri.TouchEvents",tapRadius:8,doubleTapRadius:10,tapStartTolerance:50,doubleTapDuration:300,map:null,constructor:function(u,C){this.node=u;d.mixin(this,C);F.setSelectable(u,!1);this._touchStart=d.hitch(this,this._touchStart);this._touchMove=d.hitch(this,this._touchMove);this._touchEnd=d.hitch(this,this._touchEnd);this._touchCancel=d.hitch(this,this._touchCancel);this._fireClickEvent=d.hitch(this,this._fireClickEvent);u.addEventListener("touchstart",
this._touchStart,!1);u.addEventListener("touchmove",this._touchMove,!1);u.addEventListener("touchend",this._touchEnd,!1);u.addEventListener("touchcancel",this._touchCancel,!1);this.map&&R("ios")&&(this._mouseOver=d.hitch(this,this._mouseOver),this._mouseOut=d.hitch(this,this._mouseOut),this._mouseDown=d.hitch(this,this._mouseDown),this._mouseUp=d.hitch(this,this._mouseUp),this._mouseClick=d.hitch(this,this._mouseClick),u.addEventListener("mouseover",this._mouseOver,!1),u.addEventListener("mouseout",
this._mouseOut,!1),u.addEventListener("mousedown",this._mouseDown,!1),u.addEventListener("mouseup",this._mouseUp,!1),u.addEventListener("click",this._mouseClick,!1));this._numTouches=0;this._nodeTouches=[];this._touches={};this._touchIds=[];this._taps=[];this._immediate=!1},_touchStart:function(u){var C=this._touches,z,x=u.changedTouches.length,f,q,h=(new Date).getTime();this._touchStartTS=h;if(!(R("android")&&R("safari")&&1===u.targetTouches.length&&u.touches.length===u.targetTouches.length&&u.targetTouches.length===
u.changedTouches.length&&0===u.changedTouches[0].identifier&&C[u.changedTouches[0].identifier])){this._addTouch(u);for(z=0;z<x;z++){var e=u.changedTouches[z];var t=C[e.identifier]={};t.startX=e.pageX;t.startY=e.pageY;t.startTS=h;-1===this._touchIds.indexOf(e.identifier)&&this._touchIds.push(e.identifier)}this._swipeActive&&(f=this._nodeTouches[0]);this._pinchActive&&(q=this._nodeTouches[1]);1===this._numTouches?this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(u,
f))):this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(u,[f,q]))):2===this._numTouches?this._swipeActive&&(f&&(t=C[this._touchIds[0]],t.startX=f.pageX,t.startY=f.pageY,t.moved=!1),this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(u,f))):this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(u,f))):this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(u,[f,q])))}},_touchMove:function(u){u.preventDefault();
this._updateTouch(u);var C=this._touches,z,x=u.changedTouches.length,f;if(!(R("android")&&R("safari")&&1===u.targetTouches.length&&u.touches.length===u.targetTouches.length&&u.targetTouches.length===u.changedTouches.length&&0===u.changedTouches[0].identifier&&C[u.changedTouches[0].identifier]&&1<this._touchIds.length)){for(z=0;z<x;z++){var q=u.changedTouches[z];if(f=C[q.identifier]){var h=Math.abs(q.pageX-f.startX);q=Math.abs(q.pageY-f.startY);!f.moved&&(h>=this.tapRadius||q>=this.tapRadius)&&(f.moved=
f.absMoved=!0);var e=e?e:f.moved}}1===this._numTouches?(C=u.changedTouches[0],this._swipeActive?this._fire("onSwipeMove",this._processTouchEvent(u,C)):e&&(this._swipeActive=!0,this._fire("onSwipeStart",this._processTouchEvent(u,C)))):2===this._numTouches&&(z=this._nodeTouches[0],x=this._nodeTouches[1],this._pinchActive?this._fire("onPinchMove",this._processTouchEvent(u,[z,x])):e&&(e=C[z.identifier],f=C[x.identifier],C=Math.abs(e.startX-f.startX),e=Math.abs(e.startY-f.startY),f=Math.abs(z.pageX-x.pageX),
h=Math.abs(z.pageY-x.pageY),Math.abs(Math.sqrt(f*f+h*h)-Math.sqrt(C*C+e*e))>=2*this.tapRadius&&(this._pinchActive=!0,this._fire("onPinchStart",this._processTouchEvent(u,[z,x])))))}},_touchEnd:function(u){this._removeTouch(u);var C=this._touches,z=u.changedTouches,x,f=z.length,q,h,e=(new Date).getTime(),t=this._touchIds;for(x=0;x<f;x++)if(h=C[z[x].identifier])h.absMoved&&(q=!0),h.pageX=z[x].pageX,h.pageY=z[x].pageY,h.endTS=e;if(0===this._numTouches)if(this._touches={},this._touchIds=[],this._swipeActive)this._swipeActive=
!1,this._fire("onSwipeEnd",this._processTouchEvent(u,z[0]));else if(this._pinchActive)this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(u,z));else{if(!q){f=Infinity;q=-Infinity;e=Infinity;var k=-Infinity,m=this.tapStartTolerance,y=[],K=!0;for(x=0;x<t.length;x++)h=C[t[x]],y.push(h),h.startTS<f&&(f=h.startTS),h.startTS>q&&(q=h.startTS),h.endTS<e&&(e=h.endTS),h.endTS>k&&(k=h.endTS),delete C[t[x]];1===y.length&&z[0]&&(C=Math.abs(z[0].pageY-y[0].startY),Math.abs(z[0].pageX-y[0].startX)>=
this.tapRadius||C>=this.tapRadius)&&(K=!1);K&&Math.abs(q-f)<=m&&Math.abs(k-e)<=m&&this._basicTap(u,y)}}else 1===this._numTouches&&this._pinchActive&&(x=this._nodeTouches[0],h=C[x.identifier],h.startX=x.pageX,h.startY=x.pageY,this._pinchActive=h.moved=!1,this._fire("onPinchEnd",this._processTouchEvent(u,[z[0],x])))},_touchCancel:function(u){this._numTouches&&this._touchEnd(u)},_basicTap:function(u,C){var z=(new Date).getTime(),x=this;u=this._processTouchEvent(u,C);this._taps.push({touchInfos:C,ts:z,
event:u});2<this._taps.length&&this._taps.shift();this._fire("onBasicTap",u);clearTimeout(this._tapTimer);this._immediate?this._analyzeTap(!0):this._tapTimer=setTimeout(function(){var f=x;x=null;clearTimeout(f._tapTimer);f._analyzeTap()},2===this._taps.length?this.doubleTapDuration/2:this.doubleTapDuration)},_analyzeTap:function(u){var C=this._taps,z=C[0],x=C[1],f=z.touchInfos,q=x&&x.touchInfos;C.length&&(u||(this._taps=[]),z&&x?f.length===q.length?x.ts-z.ts<=this.doubleTapDuration?(1===f.length?
(u=Math.abs(f[0].startX-q[0].startX),f=Math.abs(f[0].startY-q[0].startY),f=u<=this.doubleTapRadius&&f<=this.doubleTapRadius):f=!0,f?this._processedDoubleTap(C):this._processedTap(x)):this._processedTap(x):this._processedTap(x):this._processedTap(z||x))},_processedTap:function(u){var C=u.event;this._fire("onProcessedTap",C);1===u.touchInfos.length?this._fire("onTap",this._fixEvent(C)):2===u.touchInfos.length&&this._fire("onTwoFingerTap",C)},_processedDoubleTap:function(u){var C=1===u[1].touchInfos.length;
if(C){var z=[this._fixEvent(u[0].event),this._fixEvent(u[1].event)];z[1].relatedEvents=z}u=[u[0].event,u[1].event];u[1].relatedEvents=u;this._fire("onProcessedDoubleTap",u[1]);C&&(this._fire("onDoubleTap",z[1]),this._fire("onDblClick",z[1]))},_addTouch:function(u){var C=u.changedTouches,z=this._nodeTouches,x;this._numTouches+=C.length;for(u=0;u<C.length;u++){var f=z.length;var q=!1;for(x=0;x<f&&!(q=z[x].identifier===C[u].identifier);x++);q?this._numTouches--:z.push(C[u])}for(u=z.length-1;0<=u;u--)X.isDescendant(z[u].target,
document.body)||(z.splice(u,1),this._numTouches--);0>this._numTouches&&(this._numTouches=0)},_removeTouch:function(u){var C=[],z=[],x=u.changedTouches,f=this._nodeTouches;this._numTouches-=x.length;0>this._numTouches&&(this._numTouches=0);for(u=0;u<x.length;u++)C.push(x[u].identifier);for(u=f.length-1;0<=u;u--)-1!==C.indexOf(f[u].identifier)&&z.push(f.splice(u,1)[0]);return z},_updateTouch:function(u){var C=[],z=u.changedTouches,x=this._nodeTouches;for(u=0;u<z.length;u++)C.push(z[u].identifier);for(u=
0;u<x.length;u++){var f=C.indexOf(x[u].identifier);-1!==f&&x.splice(u,1,z[f])}},_mouseOver:function(u){this._fire("onMouseOver",this._processMouseEvent(u))},_mouseOut:function(u){this._fire("onMouseOut",this._processMouseEvent(u))},_mouseDown:function(u){this._fire("onMouseDown",this._processMouseEvent(u))},_mouseUp:function(u){this._fire("onMouseUp",this._processMouseEvent(u))},_mouseClick:function(u){clearTimeout(this._clickTimer);300<(new Date).getTime()-this._touchStartTS?this._fire("onClick",
this._processMouseEvent(u)):(this._clickEvent=u,this._clickTimer=setTimeout(this._fireClickEvent,this.doubleTapDuration))},_fireClickEvent:function(){clearTimeout(this._clickTimer);this._fire("onClick",this._processMouseEvent(this._clickEvent))},_fire:function(u,C){"onDblClick"===u&&clearTimeout(this._clickTimer);if("onDblClick"===u&&this.mouseEvents){this.mouseEvents.preventClickEvents(!0);var z=this;setTimeout(function(){z.mouseEvents.preventClickEvents(!1)},350)}if(this[u])this[u](C);if(this.map&&
this.map[u])this.map[u](C)},_fixEvent:function(u){var C={},z;for(z in u)C[z]=u[z];this.map&&(C.screenPoint=C.screenPoints[0],C.mapPoint=C.mapPoints[0]);return C},_processTouchEvent:function(u,C){var z=this.map,x=z&&z.position,f=0;if(x&&C)if(d.isArray(C)){var q;u.screenPoints=[];u.mapPoints=[];for(q=0;q<C.length;q++)if(C[q]){var h=new G(C[q].pageX-x.x,C[q].pageY-x.y);u.screenPoints.push(h);u.mapPoints.push(z.extent?z.toMap(h):new P)}else f++}else u.screenPoint=new G(C.pageX-x.x,C.pageY-x.y),u.mapPoint=
z.extent?z.toMap(u.screenPoint):new P;u.numPoints=C?d.isArray(C)?C.length-f:1:0;return u},_processMouseEvent:function(u){var C=this.map,z=C&&C.position;z&&(u.screenPoint=new G(u.pageX-z.x,u.pageY-z.y),u.mapPoint=C.extent?C.toMap(u.screenPoint):new P);return u},setImmediateTap:function(u){this._immediate=u},destroy:function(){var u=this.node;u.removeEventListener("touchstart",this._touchStart,!1);u.removeEventListener("touchmove",this._touchMove,!1);u.removeEventListener("touchend",this._touchEnd,
!1);u.removeEventListener("touchcancel",this._touchCancel,!1);this.map&&(u.removeEventListener("mouseover",this._mouseOver,!1),u.removeEventListener("mouseout",this._mouseOut,!1),u.removeEventListener("mousedown",this._mouseDown,!1),u.removeEventListener("mouseup",this._mouseUp,!1),u.removeEventListener("click",this._mouseClick,!1));F.setSelectable(u,!0);clearTimeout(this._tapTimer);clearTimeout(this._clickTimer);this.node=this.map=this._numTouches=this._nodeTouches=this._touches=this._touchIds=this._taps=
null}});return ba.TouchEvents=O})},"esri/PointerEvents":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),function(O,F,d,R,X,ba,V,P){O=O([ba],{declaredClass:"esri.PointerEvents",tapRadius:8,clickRadius:2,doubleTapRadius:10,tapStartTolerance:50,doubleTapDuration:300,minWheelValue:1,maxWheelValue:1,mozWheelDivisor:-1!==R("mac")?1:3,wheelDivisor:120,preventPageScroll:!0,_dragging:!1,constructor:function(G,
u){this.node=G;F.mixin(this,u);void 0!==G.style.msTouchAction?G.style.msTouchAction="none":void 0!==G.style.touchAction&&(G.style.touchAction="none");var C=navigator.msPointerEnabled,z=function(x){x.preventDefault()};G.addEventListener("selectstart",z,!1);G.addEventListener("dragstart",z,!1);this._pointerDown=F.hitch(this,this._pointerDown);this._pointerMove=F.hitch(this,this._pointerMove);this._pointerUp=F.hitch(this,this._pointerUp);this._pointerCancel=F.hitch(this,this._pointerCancel);G.addEventListener(C?
"MSPointerDown":"pointerdown",this._pointerDown,!1);G.addEventListener(C?"MSPointerMove":"pointermove",this._pointerMove,!1);G.addEventListener(C?"MSPointerUp":"pointerup",this._pointerUp,!1);G.addEventListener(C?"MSPointerCancel":"pointercancel",this._pointerCancel,!1);this.map&&(this._mouseOver=F.hitch(this,this._mouseOver),this._mouseOut=F.hitch(this,this._mouseOut),this._mouseLeave=F.hitch(this,this._mouseLeave),this._mouseDown=F.hitch(this,this._mouseDown),this._mouseUp=F.hitch(this,this._mouseUp),
this._mouseClick=F.hitch(this,this._mouseClick),this._mouseWheel=F.hitch(this,this._mouseWheel),this._mouseMove=F.hitch(this,this._mouseMove),this._mouseEnter=F.hitch(this,this._mouseEnter),this._onKeyDown=F.hitch(this,this._onKeyDown),this._onKeyUp=F.hitch(this,this._onKeyUp),G.addEventListener("mouseover",this._mouseOver,!1),G.addEventListener("mouseout",this._mouseOut,!1),G.addEventListener("mouseleave",this._mouseLeave,!1),G.addEventListener("mousedown",this._mouseDown,!1),G.addEventListener("mouseup",
this._mouseUp,!1),G.addEventListener("click",this._mouseClick,!1),G.addEventListener("mousewheel",this._mouseWheel,!1),G.addEventListener("mousemove",this._mouseMove,!1),G.addEventListener("mouseenter",this._mouseEnter,!1));this._numTouches=0;this._touches={};this._touchIds=[];this._taps=[];this._immediate=!1},_pointerDown:function(G){if(-1<d.indexOf(this._touchIds,G.pointerId))this._pointerUp(G);else{var u=this._touches,C=G.target,z=G.pointerId,x=this._touchIds,f=(new Date).getTime();var q=u[z]=
{};q.pointerId=z;q.startX=q.pageX=G.pageX;q.startY=q.pageY=G.pageY;q.startTS=f;x.push(z);this._numTouches++;C.setPointerCapture?C.setPointerCapture(z):C.msSetPointerCapture&&C.msSetPointerCapture(z);C=u[x[0]];u=u[x[1]];1!==this._numTouches&&(2===this._numTouches?this._swipeActive&&(C&&(C.startX=C.pageX,C.startY=C.pageY,C.moved=!1),this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(G,C))):this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(G,C))):
this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(G,[C,u]))))}},_pointerMove:function(G){var u=this._touches,C=this._touchIds,z;if((z=u[G.pointerId])&&(z.pageX!==G.pageX||z.pageY!==G.pageY)){z.pageX=G.pageX;z.pageY=G.pageY;var x=Math.abs(z.pageX-z.startX);var f=Math.abs(z.pageY-z.startY);!z.moved&&(x>=this.tapRadius||f>=this.tapRadius)&&(z.moved=z.absMoved=!0);if(1===this._numTouches)this._swipeActive?this._fire("onSwipeMove",this._processTouchEvent(G,G)):z.moved&&
(this._swipeActive=!0,this._fire("onSwipeStart",this._processTouchEvent(G,G)));else if(2===this._numTouches)if(z=u[C[0]],u=u[C[1]],this._pinchActive)this._fire("onPinchMove",this._processTouchEvent(G,[z,u]));else if(z.moved||u.moved){C=Math.abs(z.startX-u.startX);x=Math.abs(z.startY-u.startY);f=Math.abs(z.pageX-u.pageX);var q=Math.abs(z.pageY-u.pageY);Math.abs(Math.sqrt(f*f+q*q)-Math.sqrt(C*C+x*x))>=2*this.tapRadius&&(this._pinchActive=!0,this._fire("onPinchStart",this._processTouchEvent(G,[z,u])))}}},
_pointerUp:function(G){var u=this._touches,C,z=this.node,x=G.target,f=G.pointerId,q=this._touchIds,h=q.slice(0),e=d.map(h,function(y){return u[y]}),t=(new Date).getTime();if(C=u[f])if(C.pageX=G.pageX,C.pageY=G.pageY,C.endTS=t,this._numTouches--,x.releasePointerCapture?x.releasePointerCapture(f):x.msReleasePointerCapture&&x.msReleasePointerCapture(f),0===this._numTouches)if(this._touches={},this._touchIds=[],this._swipeActive)this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(G,G));
else if(this._pinchActive)this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(G,G));else{if(!C.absMoved){x=Infinity;f=-Infinity;q=Infinity;t=-Infinity;var k=this.tapStartTolerance,m;for(m=0;m<h.length;m++)C=e[m],C.startTS<x&&(x=C.startTS),C.startTS>f&&(f=C.startTS),C.endTS<q&&(q=C.endTS),C.endTS>t&&(t=C.endTS);Math.abs(f-x)<=k&&Math.abs(t-q)<=k&&this._basicTap(G,e)}}else 1===this._numTouches&&this._pinchActive&&(q.splice(d.indexOf(q,G.pointerId),1),delete u[G.pointerId],C=u[q[0]],
C.startX=C.pageX,C.startY=C.pageY,C.moved=!1,document.msElementsFromPoint&&(h=document.msElementsFromPoint(C.pageX,C.pageY),d.some(h,function(y){return y===z})||(this._touches={},this._touchIds=[],this._numTouches=0)),this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(G,[G,C])))},_pointerCancel:function(G){this._numTouches&&this._pointerUp(G)},_basicTap:function(G,u){var C=(new Date).getTime(),z=this,x=this._immediate;G=this._processTouchEvent(G,u);this._taps.push({touchInfos:u,
ts:C,event:G});2<this._taps.length&&this._taps.shift();this._fire("onBasicTap",G);clearTimeout(this._tapTimer);C=2===this._taps.length?this.doubleTapDuration/2:this.doubleTapDuration;this._tapTimer=setTimeout(function(){var f=z;z=null;clearTimeout(f._tapTimer);f._analyzeTap(x)},x?0:C)},_analyzeTap:function(G){var u=this._taps,C=u[0],z=u[1],x=C.touchInfos,f=z&&z.touchInfos;u.length&&(G||(this._taps=[]),C&&z?x.length===f.length?z.ts-C.ts<=this.doubleTapDuration?(1===x.length?(G=Math.abs(x[0].startX-
f[0].startX),x=Math.abs(x[0].startY-f[0].startY),x=G<=this.doubleTapRadius&&x<=this.doubleTapRadius):x=!0,x?this._processedDoubleTap(u):this._processedTap(z)):this._processedTap(z):this._processedTap(z):this._processedTap(C||z))},_processedTap:function(G){var u=G.event;this._fire("onProcessedTap",u);1===G.touchInfos.length?this._fire("onTap",this._fixEvent(u)):2===G.touchInfos.length&&this._fire("onTwoFingerTap",u)},_processedDoubleTap:function(G){var u=1===G[1].touchInfos.length;if(u){var C=[this._fixEvent(G[0].event),
this._fixEvent(G[1].event)];C[1].relatedEvents=C}G=[G[0].event,G[1].event];G[1].relatedEvents=G;this._fire("onProcessedDoubleTap",G[1]);u&&(this._fire("onDoubleTap",C[1]),this._fire("onDblClick",C[1]))},_mouseOver:function(G){this._fire("onMouseOver",this._processMouseEvent(G))},_mouseMove:function(G){this._dragging?this._fire("onMouseDrag",this._processMouseEvent(G)):this._fire("onMouseMove",this._processMouseEvent(G))},_mouseOut:function(G){this._fire("onMouseOut",this._processMouseEvent(G))},_mouseLeave:function(G){document.removeEventListener("keydown",
this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseOut",this._processMouseEvent(G))},_mouseDown:function(G){this._downX=G.pageX;this._downY=G.pageY;this._fire("onMouseDown",this._processMouseEvent(G));0===G.button&&(this._dragging=!0,this._fire("onMouseDragStart",this._processMouseEvent(G)))},_mouseUp:function(G){this._dragging&&(this._dragging=!1,this._fire("onMouseDragEnd",this._processMouseEvent(G)));this._fire("onMouseUp",this._processMouseEvent(G))},
_mouseClick:function(G){Math.abs(G.pageX-this._downX)<=this.clickRadius&&Math.abs(G.pageY-this._downY)<=this.clickRadius&&this._fire("onClick",this._processMouseEvent(G))},_mouseWheel:function(G){var u=this.map;(u?u.isScrollWheelZoom||u.isScrollWheelPan:this.preventPageScroll)&&G.preventDefault();u=G.wheelDelta?G.wheelDelta/this.wheelDivisor:-G.detail/this.mozWheelDivisor;var C=Math.abs(u);C=C<=this.minWheelValue?this.minWheelValue:this.maxWheelValue;G.value=0>u?-C:C;this._fire("onMouseWheel",this._processMouseEvent(G))},
_mouseEnter:function(G){document.removeEventListener("keydown",this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);document.addEventListener("keydown",this._onKeyDown,!1);document.addEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseEnter",this._processMouseEvent(G))},_onKeyDown:function(G){this._fire("onKeyDown",G)},_onKeyUp:function(G){this._fire("onKeyUp",G)},_fire:function(G,u){if(this[G])this[G](u);if(this.map&&this.map[G])this.map[G](u)},_fixEvent:function(G){var u=
{},C;for(C in G)u[C]=G[C];u.preventDefault=function(){G.preventDefault()};u.stopPropagation=function(){G.stopPropagation()};this.map&&(u.screenPoint=u.screenPoints[0],u.mapPoint=u.mapPoints[0]);return u},_processTouchEvent:function(G,u){var C=this.map,z=C&&C.position,x=0;if(z&&u)if(F.isArray(u)){var f;G.screenPoints=[];G.mapPoints=[];for(f=0;f<u.length;f++)if(u[f]){var q=new P(u[f].pageX-z.x,u[f].pageY-z.y);G.screenPoints.push(q);G.mapPoints.push(C.extent?C.toMap(q):new V)}else x++}else G.screenPoint=
new P(u.pageX-z.x,u.pageY-z.y),G.mapPoint=C.extent?C.toMap(G.screenPoint):new V;G.numPoints=u?F.isArray(u)?u.length-x:1:0;return G},_processMouseEvent:function(G){var u=this.map,C=u&&u.position;C&&(G.screenPoint=new P(G.pageX-C.x,G.pageY-C.y),G.mapPoint=u.extent?u.toMap(G.screenPoint):new V);return G},setImmediateTap:function(G){this._immediate=G},destroy:function(){var G=this.node;G.removeEventListener("MSPointerDown",this._pointerDown,!1);G.removeEventListener("MSPointerMove",this._pointerMove,
!1);G.removeEventListener("MSPointerUp",this._pointerUp,!1);G.removeEventListener("MSPointerCancel",this._pointerCancel,!1);this.map&&(G.removeEventListener("mouseover",this._mouseOver,!1),G.removeEventListener("mousemove",this._mouseMove,!1),G.removeEventListener("mouseout",this._mouseOut,!1),G.removeEventListener("mouseleave",this._mouseLeave,!1),G.removeEventListener("mousedown",this._mouseDown,!1),G.removeEventListener("mouseup",this._mouseUp,!1),G.removeEventListener("click",this._mouseClick,
!1),G.removeEventListener("mouseenter",this._mouseEnter,!1));clearTimeout(this._tapTimer);this.node=this.map=this._numTouches=this._touches=this._touchIds=this._taps=null}});return X.PointerEvents=O})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t){O=O(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(k,m){try{F.mixin(this,k);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var y=this.domNode=P.byId(m),K=this.map,n="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";
y&&(G.set(y,"innerHTML",n),this.listNode=X.query(".esriAttributionList",y)[0],this.itemNodes={});this._eventConnections=[R.connect(K,"onLayerAdd",this,this._onLayerAdd),R.connect(K,"onLayerRemove",this,this._onLayerRemove),R.connect(K,"onLayerSuspend",this,this._onLayerSuspend),R.connect(K,"onLayerResume",this,this._onLayerResume),R.connect(K,"onResize",this,this._adjustFocus),R.connect(K,"onExtentChange",this,this._onExtentChange)];if(K.loaded){var w=K.layerIds.concat(K.graphicsLayerIds),c,D=w.length;
for(c=0;c<D;c++){var E=K.getLayer(w[c]);E.loaded&&this._onLayerAdd(E)}}}catch(J){}},startup:function(){},destroy:function(){d.forEach(this._eventConnections,R.disconnect);u.destroy(this.listNode);var k=this._layerHandles,m;for(m in k)k[m]&&k[m].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(k){try{var m=this._attributions,y=k.id;
if(!q.isDefined(m[y])&&k.showAttribution){if(k.hasAttributionData){var K=k.getAttributionData();this._pendingDfds[y]=1;m[y]=K;K.addBoth(F.partial(this._onAttributionLoad,this,k))}else m[y]=k.copyright||k.copyrightText||"",m[y]?(k.suspended||this._activeLayers.push(y),this._createNode(y)):this._onLayerRemove(k);-1<k.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[y]=k.on("map-style-change",F.hitch(this,function(){this._onLayerRemove(k);this._onLayerAdd(k)})))}}catch(n){}},
_onAttributionLoad:function(k,m,y){var K=k._attributions,n=k._pendingDfds,w=m.id;if(n&&n[w]){delete n[w];if(!y||y instanceof Error)y="";K[w]=y?k._createIndexByLevel(y,-1!==m.declaredClass.toLowerCase().indexOf("vetiledlayer")):m.copyright||m.copyrightText||"";K[w]?(m.suspended||k._activeLayers.push(w),k._createNode(w)):k._onLayerRemove(m)}},_onLayerRemove:function(k){try{var m=k.id,y=this.itemNodes,K=-1;this._onLayerSuspend(k);this._layerHandles[m]&&this._layerHandles[m].remove();delete this._attributions[m];
delete this._pendingDfds[m];delete this._layerHandles[m];var n=this._getGroupIndex(m);-1!==n&&(K=d.indexOf(this._sharedLayers[n],m),-1!==K&&(this._sharedLayers[n].splice(K,1),1>=this._sharedLayers[n].length&&this._sharedLayers.splice(n,1)));y[m]&&-1===K&&u.destroy(y[m]);delete y[m];this._updateLastItem()}catch(w){}},_onLayerSuspend:function(k){try{var m=k.id;if(this._attributions[m]){var y=d.indexOf(this._activeLayers,m),K=this.itemNodes[m];-1!==y&&this._activeLayers.splice(y,1);K&&this._toggleItem(K,
!1,this._getGroupIndex(m))}}catch(n){}},_adjustFocus:function(){var k=this.domNode.scrollWidth>this.domNode.clientWidth,m=z.contains(this.domNode,"esriAttributionOpen");G.set(this.domNode,"tabIndex",k||m?"0":"")},_onLayerResume:function(k){try{var m=k.id,y=this._attributions[m],K=this.itemNodes[m];if(y&&(-1===d.indexOf(this._activeLayers,m)&&this._activeLayers.push(m),K)){var n=F.isString(y)?y:this._getContributorsList(y,this.map.extent,this.map.getLevel());F.isString(y)||G.set(K,"innerHTML",n?n+
this._getDelimiter():"");n&&this._toggleItem(K,!0,this._getGroupIndex(m))}}catch(w){}},_onExtentChange:function(k,m,y,K){try{var n=this._activeLayers,w=this._attributions,c=this.itemNodes,D,E,J=n.length||0;for(E=0;E<J;E++){var A=n[E];var S=w[A];if((D=c[A])&&!F.isString(S)){var H=this._getContributorsList(S,k,K?K.level:-1);G.set(D,"innerHTML",H?H+this._getDelimiter():"");this._toggleItem(D,!!H,-1)}}}catch(ea){}this._adjustCursorStyle()},_createNode:function(k){if(this.domNode){var m=this._checkShareInfo(k),
y=m&&m.sharedWith;y=y&&this.itemNodes[y];var K=this.map,n=this._attributions[k];n=F.isString(n)?n:this._getContributorsList(n,K.extent,K.getLevel());K=!!n&&!K.getLayer(k).suspended;y?(this.itemNodes[k]=y,this._toggleItem(y,K,m.index)):(k=this.itemNodes[k]=u.create("span",{"class":this.itemClass,innerHTML:n?n+this._getDelimiter():"",style:{display:K?"inline":"none"}},this.listNode),K&&this._setLastItem(k));this._adjustCursorStyle()}},_checkShareInfo:function(k){var m=this._attributions,y,K=-1,n=m[k];
if(n&&F.isString(n)){for(y in m){var w=m[y];if(y!==k&&w&&F.isString(w)&&w.length===n.length&&w.toLowerCase()===n.toLowerCase()){var c=y;break}}m=this._sharedLayers;w=m.length;if(c){for(y=0;y<w;y++)if(n=m[y],-1!==d.indexOf(n,c)){K=y;n.push(k);break}-1===K&&(K=m.push([c,k])-1)}}return-1<K?{index:K,sharedWith:c}:null},_getGroupIndex:function(k){var m=this._sharedLayers,y,K=m.length,n=-1;for(y=0;y<K;y++)if(-1!==d.indexOf(m[y],k)){n=y;break}return n},_getDelimiter:function(){var k=this.itemDelimiter;return k?
"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+k+"\x3c/span\x3e":""},_toggleItem:function(k,m,y){if(-1<y&&!m){y=this._sharedLayers[y];var K,n=y.length,w=this._activeLayers;for(K=0;K<n;K++)if(-1!==d.indexOf(w,y[K]))return}C.set(k,"display",m?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var k=this.listNode.childNodes;var m=k.length;if(m)for(--m;0<=m;m--){var y=k[m];if("none"!==C.get(y,"display")){this._setLastItem(y);break}}this._adjustCursorStyle()},_setLastItem:function(k){var m=
this.itemClass,y=this.lastItemClass;this._lastItem&&z.replace(this._lastItem,m,y);k&&(z.replace(k,y,m),this._lastItem=k)},_createIndexByLevel:function(k,m){var y=k.contributors,K,n,w=y?y.length:0,c,D=new h(4326),E={};for(n=0;n<w;n++){var J=y[n];var A=(K=J.coverageAreas)?K.length:0;for(c=0;c<A;c++){var S=K[c];var H=S.bbox;H={extent:e.geographicToWebMercator(new t(H[1],H[0],H[3],H[2],D)),attribution:J.attribution||"",zoomMin:S.zoomMin-(m&&S.zoomMin?1:0),zoomMax:S.zoomMax-(m&&S.zoomMax?1:0),score:q.isDefined(S.score)?
S.score:100,objectId:n};for(S=H.zoomMin;S<=H.zoomMax;S++)E[S]=E[S]||[],E[S].push(H)}}return E},_getContributorsList:function(k,m,y){var K="";if(m&&q.isDefined(y)&&-1<y){k=k[y];y=m.getCenter().normalize();var n=k?k.length:0,w=[],c={};for(K=0;K<n;K++)m=k[K],!c[m.objectId]&&m.extent.contains(y)&&(c[m.objectId]=1,w.push(m));w.sort(function(D,E){return E.score-D.score||D.objectId-E.objectId});n=w.length;for(K=0;K<n;K++)w[K]=w[K].attribution;K=w.join(", ")}return K},_adjustCursorStyle:function(){var k=
x.position(this.listNode.parentNode,!0).h;z.contains(this.listNode.parentNode,"esriAttributionOpen")?(z.remove(this.listNode.parentNode,"esriAttributionOpen"),k>x.position(this.listNode.parentNode,!0).h?(C.set(this.listNode.parentNode,"cursor","pointer"),z.add(this.listNode.parentNode,"esriAttributionOpen")):C.set(this.listNode.parentNode,"cursor","default")):(z.add(this.listNode.parentNode,"esriAttributionOpen"),k<x.position(this.listNode.parentNode,!0).h?C.set(this.listNode.parentNode,"cursor",
"pointer"):C.set(this.listNode.parentNode,"cursor","default"),z.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});F.setObject("dijit.Attribution",O,f);return O})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q){O=O(null,{declaredClass:"esri.SnappingManager",constructor:function(h){h=h||{};this.map=h.map;this.tolerance=h.tolerance||15;this.layerInfos=[];if(h.layerInfos)this.layerInfos=h.layerInfos;else{var e;for(e=0;e<this.map.graphicsLayerIds.length;e++){var t=this.map.getLayer(this.map.graphicsLayerIds[e]);this.layerInfos.push({layer:t})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var k=F.connect(this.map,"onLoad",this,function(m){F.disconnect(k);
k=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=h.snapPointSymbol?h.snapPointSymbol:new x(x.STYLE_CROSS,15,new f(f.STYLE_SOLID,new X([0,255,255]),1),new X([0,255,0,0]));this.alwaysSnap=h.alwaysSnap?h.alwaysSnap:!1;this.snapKey=h.snapKey?h.snapKey:V("mac")?P.META:P.CTRL;this._SelectionLyrQuery=new q;this._SelectionLyrQuery.spatialRelationship=q.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new u;this.setLayerInfos(this.layerInfos);this._currentGraphicOption=
{snapToPoint:!0,snapToVertex:!0,snapToLastVertex:!0,snapToEdge:!0};this._snappingCallback=d.hitch(this,this._snappingCallback)},getSnappingPoint:function(h){var e=this.layers,t=this.tolerance,k=this.map,m=this.layerOptions,y=k.toMap(h.offset(-t,t));t=k.toMap(h.offset(t,-t));y=new z(y.x,y.y,t.x,t.y,k.spatialReference);var K=new q;K.geometry=y;K.spatialRelationship=q.SPATIAL_REL_INTERSECTS;var n=[],w=[],c=this._extractPointsAndLines,D=new ba,E=0,J;t=y.xmin;var A=y.xmax;R.forEach(e,function(v,b){v.visible&&
v.loaded&&"esri.layers.FeatureLayer"===v.declaredClass&&v.mode!==v.constructor.MODE_SELECTION&&E++});k.spatialReference._isWrappable()&&(t=z.prototype._normalizeX(y.xmin,k.spatialReference._getInfo()).x,A=z.prototype._normalizeX(y.xmax,k.spatialReference._getInfo()).x);var S=new z(t,y.ymin,A,y.ymax,k.spatialReference);R.forEach(e,function(v,b){if("esri.layers.GraphicsLayer"===v.declaredClass&&v.visible){var g=[];R.forEach(v.graphics,function(N){N&&N.visible&&S.intersects(N.geometry)&&g.push(N)});
var W=c(g,m[b]);n=n.concat(W[0]);w=w.concat(W[1])}});var H=d.hitch(this,function(v){E--;v instanceof Error||(v=c(v.features,m[J]),n=n.concat(v[0]),w=w.concat(v[1]));E||(L=this._getSnappingPoint(n,w,h),D.callback(L))}),ea=!1;R.forEach(e,function(v,b){v.visible&&v.loaded&&(J=b,"esri.layers.FeatureLayer"===v.declaredClass&&v.mode!==v.constructor.MODE_SELECTION&&(ea=!0,v.queryFeatures(K,H,H)))});if(!ea){var L=this._getSnappingPoint(n,w,h);D.callback(L)}return D},setLayerInfos:function(h){this.layers=
[];this.layerOptions=[];var e;for(e=0;e<h.length;e++)this.layers.push(h[e].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===h[e].snapToPoint&&(this.layerOptions[e].snapToPoint=h[e].snapToPoint),!1===h[e].snapToVertex&&(this.layerOptions[e].snapToVertex=h[e].snapToVertex),!1===h[e].snapToEdge&&(this.layerOptions[e].snapToEdge=h[e].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=
[];R.forEach(this.layers,function(t,k){"esri.layers.FeatureLayer"===t.declaredClass&&t.mode===t.constructor.MODE_SELECTION&&(this._selectionLayers.push(t),this._selectionLayerOptions.push(this.layerOptions[k]))},this);this.layerInfos=h},destroy:function(){F.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){F.disconnect(this._onExtentChangeConnect);
this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=F.connect(this.map,"onExtentChange",d.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){F.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(h,e,t){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var k;this._SelectionLyrQuery.geometry=t;var m=d.hitch(this,
function(y){y instanceof Error||(y=this._extractPointsAndLines(y.features,e[k]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(y[0]),this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(y[1]))});R.forEach(h,function(y,K){y.visible&&y.loaded&&(k=K,y.queryFeatures(this._SelectionLyrQuery,m,m))},this)},_extractPointsAndLines:function(h,e){var t=e&&!1===e.snapToLastVertex?!1:!0,k=[],m=[],y,K;R.forEach(h,function(n,w){if((!n._graphicsLayer||n.visible)&&
n.geometry&&n._isSnapTarget)if("point"===n.geometry.type&&e.snapToPoint)k.push(n.geometry);else if("polyline"===n.geometry.type)for(y=0;y<n.geometry.paths.length;y++){m.push("lineStart");var c=n.geometry.paths[y].length;for(K=0;K<c;K++)if(t||K!==c-1){var D=n.geometry.getPoint(y,K);e.snapToVertex&&k.push(D);e.snapToEdge&&m.push(D)}m.push("lineEnd")}else if("polygon"===n.geometry.type)for(y=0;y<n.geometry.rings.length;y++){m.push("lineStart");c=n.geometry.rings[y].length;for(K=0;K<c;K++)if(t||K!==c-
1)D=n.geometry.getPoint(y,K),e.snapToVertex&&k.push(D),e.snapToEdge&&m.push(D);m.push("lineEnd")}});return[k,m]},_getSnappingPoint:function(h,e,t){var k,m=this.tolerance,y=this.map,K=this.map._getFrameWidth();h=h.concat(this._featurePtsFromSelectionLayer);e=e.concat(this._featureLinesFromSelectionLayer);if(this._currentGraphic){var n=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);h=h.concat(n[0]);e=e.concat(n[1])}var w,c;R.forEach(h,function(U,M){var Z=y.toScreen(U,
!0);if(-1!==K&&(Z.x%=K,0>Z.x&&(Z.x+=K),y.width>K))for(var da=(y.width-K)/2;Z.x<da;)Z.x+=K;k=Math.sqrt((Z.x-t.x)*(Z.x-t.x)+(Z.y-t.y)*(Z.y-t.y));k<=m&&(m=k,w=Z.x,c=Z.y)});if(w){e=new C(w,c);var D=e=y.toMap(e)}else{m=this.tolerance;for(h=0;h<e.length;h++)if("lineStart"===e[h])for(n=h+1;n<e.length;n++){if("lineEnd"!==e[n+1]&&"lineStart"!==e[n+1]&&"lineEnd"!==e[n]&&"lineStart"!==e[n]){var E=y.toScreen(e[n],!0),J=y.toScreen(e[n+1],!0),A=E.x>=J.x?E:J,S=E.x>=J.x?J:E;-1!==K&&(A.x%=K,0>A.x&&(A.x+=K),S.x%=K,
0>S.x&&(S.x+=K),S.x>A.x&&(S.x-=K));E=A.x;A=A.y;J=S.x;S=S.y;var H;if(E===J){var ea=E;var L=t.y;var v=H=E;var b=A<=S?A:S;var g=A<=S?S:A}else A===S?(ea=t.x,L=A,v=E<=J?E:J,H=E<=J?J:E,b=g=A):(L=(S-A)/(J-E),v=(A*J-E*S)/(J-E),ea=(v-(t.y*S-t.y*A-t.x*E+t.x*J)/(S-A))/((E-J)/(S-A)-L),L=L*ea+v,v=E<=J?E:J,H=E<=J?J:E,b=A<=S?A:S,g=A<=S?S:A);if(ea>=v&&ea<=H&&L>=b&&L<=g){if(E=Math.sqrt((t.x-ea)*(t.x-ea)+(t.y-L)*(t.y-L)),E<=m){m=E;var W=ea;var N=L}}else ea=Math.sqrt((E-t.x)*(E-t.x)+(A-t.y)*(A-t.y)),L=Math.sqrt((J-
t.x)*(J-t.x)+(S-t.y)*(S-t.y)),ea<=L?(v=ea,ea=E,L=A):(v=L,ea=J,L=S),v<=m&&(m=v,W=ea,N=L)}if("lineEnd"===e[n]){h=n;break}}W&&(e=new C(W,N),D=e=y.toMap(e))}return D},_setGraphic:function(h,e){this._currentGraphic=h;this._currentGraphicOption.snapToLastVertex=e&&!1===e.snapToLastVertex?!1:!0},_addSnappingPointGraphic:function(){var h=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);h.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var h=this.map;this._onSnapKeyDown_connect=
F.connect(h,"onKeyDown",this,"_onSnapKeyDownHandler");this._onSnapKeyUp_connect=F.connect(h,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=F.connect(h,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=F.connect(h,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){F.disconnect(this._onSnapKeyDown_connect);F.disconnect(this._onSnapKeyUp_connect);F.disconnect(this._onSnappingMouseMove_connect);
F.disconnect(this._onSnappingMouseDrag_connect);this._deactivateSnapping()},_onSnapKeyDownHandler:function(h){h.keyCode===this.snapKey&&(F.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(h){h.keyCode===this.snapKey&&(this._onSnapKeyDown_connect=
F.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(h){this._currentLocation=h;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(h.screenPoint).addCallback(this._snappingCallback))},
_snappingCallback:function(h){if(this._snappingPoint=h)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(h)}});return G.SnappingManager=O})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),function(O,F,d,R,X,ba,V,P,G){O=O(P,
{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(u,C){this._url.path+="/identify";this._handler=F.hitch(this,this._handler);this.gdbVersion=C&&C.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(u,C,z,x,f){try{var q=[];d.forEach(u.results,function(h,e){q[e]=new G(h)});this._successHandler([q],"onComplete",z,f)}catch(h){this._errorHandler(h,x,f)}},execute:function(u,C,z,x){var f=x.assembly;
u=this._encode(F.mixin({},this._url.query,{f:"json"},u.toJson(f&&f[0])));var q=this._handler,h=this._errorHandler;this.gdbVersion&&(u.gdbVersion=this.gdbVersion);return ba({url:this._url.path,content:u,callbackParamName:"callback",load:function(e,t){q(e,t,C,z,x.dfd)},error:function(e){h(e,z,x.dfd)}})},onComplete:function(){}});V._createWrappers(O);F.setObject("tasks.IdentifyTask",O,X);return O})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(O,F,d,R,X,ba){O=O(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(V){F.mixin(this,V);this.feature=new X(V.geometry?ba.fromJson(V.geometry):null,null,V.attributes);delete this.geometry;delete this.attributes}});F.setObject("tasks.IdentifyResult",O,R);return O})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),
function(O,F,d,R,X,ba,V,P,G){var u=O(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=u.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(C){var z=C&&C.geometry||this.geometry,x=this.mapExtent,f=this.spatialReference,q=
this.layerIds;C={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(z){var h=z.toJson();delete h.spatialReference;C.geometry=R.toJson(h);C.geometryType=P.getJsonType(z)}f?C.sr=f.wkid||R.toJson(f.toJson()):z&&z.spatialReference?C.sr=z.spatialReference.wkid||R.toJson(z.spatialReference.toJson()):
x&&x.spatialReference&&(C.sr=x.spatialReference.wkid||R.toJson(x.spatialReference.toJson()));x&&(C.mapExtent=x.xmin+","+x.ymin+","+x.xmax+","+x.ymax);C.layers=this.layerOption;q&&(C.layers+=":"+q.join(","));C.layerDefs=V._serializeLayerDefinitions(this.layerDefinitions,!0);z=this.timeExtent;C.time=z?z.toJson().join(","):null;C.layerTimeOptions=V._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){x=G.getScale({extent:x,width:this.width,spatialReference:x.spatialReference});
var e=V._getLayersForScale(x,this.dynamicLayerInfos),t=[];d.forEach(this.dynamicLayerInfos,function(k){if(!k.subLayerIds){var m=k.id;if((!this.layerIds||this.layerIds&&-1!==d.indexOf(this.layerIds,m))&&-1!==d.indexOf(e,m)){var y={id:m};y.source=k.source&&k.source.toJson();var K;this.layerDefinitions&&this.layerDefinitions[m]&&(K=this.layerDefinitions[m]);K&&(y.definitionExpression=K);var n;this.layerTimeOptions&&this.layerTimeOptions[m]&&(n=this.layerTimeOptions[m]);n&&(y.layerTimeOptions=n.toJson());
t.push(y)}}},this);x=R.toJson(t);"[]"===x&&(x="[{}]");C.dynamicLayers=x}return C}});F.mixin(u,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});F.setObject("tasks.IdentifyParameters",u,ba);return u})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),
function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(O,F,d,R,X,ba){O=O(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var V=d.map(this.polylines,function(G){return G.toJson()}),P={};P.polylines=R.toJson(V);P.trimExtendTo=R.toJson(this.trimExtendTo.toJson());P.sr=R.toJson(this.polylines[0].spatialReference.toJson());
P.extendHow=this.extendHow||0;return P}});F.mixin(O,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,NO_EXTEND_AT_TO:16});F.setObject("tasks.TrimExtendParameters",O,ba);return O})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(O,F,d,R,X,ba,V,P){O=O(null,{declaredClass:"esri.tasks.BufferParameters",
geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var G={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},u=this.distances,C=this.outSpatialReference,z=this.bufferSpatialReference,x=d.map(this.geometries,function(h){h="extent"===h.type?V.fromExtent(h):h;return h.toJson()},this),f=this.geometries;if(f&&0<f.length){var q="extent"===f[0].type?"esriGeometryPolygon":P.getJsonType(f[0]);G.geometries=
R.toJson({geometryType:q,geometries:x});G.inSR=f[0].spatialReference.wkid?f[0].spatialReference.wkid:R.toJson(f[0].spatialReference.toJson())}u&&(G.distances=u.join(","));C&&(G.outSR=C.wkid?C.wkid:R.toJson(C.toJson()));z&&(G.bufferSR=z.wkid?z.wkid:R.toJson(z.toJson()));return G}});F.setObject("tasks.BufferParameters",O,ba);return O})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var P=d.map(this.geometries1,function(z){return z.toJson()}),G=d.map(this.geometries2,function(z){return z.toJson()}),u={},C=this.geometries1;C&&0<C.length&&(u.geometries1=R.toJson({geometryType:V.getJsonType(C[0]),geometries:P}),P=this.geometries1[0].spatialReference,u.sr=P.wkid?P.wkid:R.toJson(P.toJson()));(P=this.geometries2)&&0<P.length&&
(u.geometries2=R.toJson({geometryType:V.getJsonType(P[0]),geometries:G}));this.relation&&(u.relation=this.relation);this.relationParam&&(u.relationParam=this.relationParam);return u}});F.mixin(O,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});F.setObject("tasks.RelationParameters",O,ba);return O})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,toJson:function(){var P=d.map(this.geometries,function(u){return u.toJson()}),G={};this.geometries&&0<this.geometries.length&&(G.geometries=R.toJson({geometryType:V.getJsonType(this.geometries[0]),geometries:P}),G.sr=R.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(G.geodesic=this.geodesic);this.lengthUnit&&(G.lengthUnit=this.lengthUnit);
this.maxSegmentLength&&(G.maxSegmentLength=this.maxSegmentLength);return G}});F.setObject("tasks.DensifyParameters",O,ba);return O})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var P=d.map(this.geometries,function(u){return u.toJson()}),
G={};this.geometries&&0<this.geometries.length&&(G.geometries=R.toJson({geometryType:V.getJsonType(this.geometries[0]),geometries:P}),G.sr=R.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(G.deviationUnit=this.deviationUnit);this.maxDeviation&&(G.maxDeviation=this.maxDeviation);return G}});F.setObject("tasks.GeneralizeParameters",O,ba);return O})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var P=d.map(this.geometries,function(u){return u.toJson()}),G={};this.geometries&&0<this.geometries.length&&(G.geometries=R.toJson({geometryType:V.getJsonType(this.geometries[0]),geometries:P}),G.sr=R.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(G.bevelRatio=this.bevelRatio);this.offsetDistance&&
(G.offsetDistance=this.offsetDistance);this.offsetHow&&(G.offsetHow=this.offsetHow);this.offsetUnit&&(G.offsetUnit=this.offsetUnit);return G}});F.mixin(O,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});F.setObject("tasks.OffsetParameters",O,ba);return O})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(O,
F,d,R,X,ba){O=O(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var V={},P=this.geometry1;P&&(V.geometry1=d.toJson({geometryType:ba.getJsonType(P),geometry:P}));if(P=this.geometry2)V.geometry2=d.toJson({geometryType:ba.getJsonType(P),geometry:P});V.sr=d.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(V.distanceUnit=this.distanceUnit);this.geodesic&&(V.geodesic=this.geodesic);return V}});F.setObject("tasks.DistanceParameters",
O,X);return O})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n){var w=F([k],
{declaredClass:"esri.layers.KMLLayer",serviceUrl:q.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(c,D){this._url=q.urlToObject(this.url=c);this._outSR=D&&D.outSR||new h({wkid:4326});this._options=R.mixin({},D);z.defaults.kmlService&&(this.serviceUrl=z.defaults.kmlService);var E=this.linkInfo=D&&D.linkInfo;E&&(this.visible=!!E.visibility,this._waitingForMap=!!E.viewFormat);(!E||E&&E.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=R.hitch(this,this.refresh);
this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(c){if(c){var D=c.type,E=c.id,J;switch(D){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(c=this["_"+D])&&(J=R.getObject("_mode._featureMap."+E,!1,c));break;case "GroundOverlay":if(c=this._groundLyr){var A=c.getImages();D=A.length;for(c=0;c<D;c++)if(A[c].id===E){J=A[c];break}}break;case "NetworkLink":X.some(this._links,function(S){return S.linkInfo&&S.linkInfo.id===E?(J=S,!0):!1});break;case "Folder":for(D=
(A=this.folders)?A.length:0,c=0;c<D;c++)if(A[c].id===E){J=A[c];break}}return J}},getLayers:function(){var c=[];this._groundLyr&&c.push(this._groundLyr);this._fLayers&&(c=c.concat(this._fLayers));this._links&&X.forEach(this._links,function(D){D.declaredClass&&c.push(D)});return c},setFolderVisibility:function(c,D){c&&(this._fireUpdateStart(),(c.visible=D)&&(D=this._areLocalAncestorsVisible(c)),this._setState(c,D),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},onRefresh:function(){},
onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(c){var D=this;this._fireUpdateStart();this._io=f({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(c),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:ba.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(E){D._io=null;D._initLayer(E)},error:function(E){D._io=null;E=R.mixin(Error(),E);E.message="Unable to load KML: "+(E.message||"");D._fireUpdateEnd(E);D._errorHandler(E)}})},
_initLayer:function(c){if(this.loaded){var D=[];X.forEach(this.folders,function(L){L.visible&&D.push(L.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=c.name;this.description=c.description;this.snippet=c.snippet;this.visibility=c.visibility;this.featureInfos=c.featureInfos;var E,J=this.folders=c.folders,A=[];if(J){var S=J.length;for(E=0;E<S;E++){var H=J[E]=new m(J[E]);-1===H.parentFolderId&&A.push(H)}}J=
this._links=c.networkLinks;S=J?J.length:0;for(E=0;E<S;E++)if(!J[E].viewRefreshMode||-1===J[E].viewRefreshMode.toLowerCase().indexOf("onregion")){var ea=R.mixin({},this._options);ea.linkInfo=J[E];ea.id&&(ea.id=ea.id+"_"+E);H=J[E]=new w(J[E].href,ea);H._parentLayer=this;H._parentFolderId=this._getLinkParentId(H.linkInfo.id);H._linkErrorHandle=H.on("error,network-link-error",R.hitch(H,function(L){this._parentLayer.onNetworkLinkError(L.error)}))}if((J=c.groundOverlays)&&0<J.length)for(ea=R.mixin({},this._options),
ea.id&&(ea.id+="_mapImage"),H=this._groundLyr=new K(ea),S=J.length,E=0;E<S;E++)H.addImage(new y(J[E]));(c=R.getObject("featureCollection.layers",!1,c))&&0<c.length&&(this._fLayers=[],X.forEach(c,function(L,v){var b=R.getObject("featureSet.features",!1,L);b&&0<b.length&&(ea=R.mixin({outFields:["*"],infoTemplate:L.popupInfo?new t(L.popupInfo):null,editable:!1},this._options),ea.id&&(ea.id=ea.id+"_"+v),ea.webgl=!1,L.layerDefinition.capabilities="Query,Data",b=new n(L,ea),b.geometryType&&(this["_"+b.geometryType]=
b),this._fLayers.push(b))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(S=A.length,E=0;E<S;E++)H=A[E],this._setState(H,H.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),X.forEach(this.folders,function(L){-1<X.indexOf(D,L.id)?this.setFolderVisibility(L,!0):this.setFolderVisibility(L,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var c=this._map;this._fireUpdateStart();this._links&&X.forEach(this._links,
function(A){A.declaredClass&&(c.addLayer(A),A._waitingForMap&&(A._waitingForMap=null,A.visible?A._parseKml(c):A._wMap=c))});var D=c.spatialReference,E=this._outSR;if(!D.equals(E))if(D.isWebMercator()&&4326===E.wkid)var J=e.geographicToWebMercator;else if(E.isWebMercator()&&4326===D.wkid)J=e.webMercatorToGeographic;else return;this._groundLyr&&(J&&X.forEach(this._groundLyr.getImages(),function(A){A.extent=J(A.extent)}),c.addLayer(this._groundLyr));(D=this._fLayers)&&0<D.length&&X.forEach(D,function(A){if(J){var S=
A.graphics,H,ea,L=S?S.length:0;for(H=0;H<L;H++)(ea=S[H].geometry)&&S[H].setGeometry(J(ea))}c.addLayer(A)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var c=this._map;this._links&&X.forEach(this._links,function(D){D.declaredClass&&D._io&&D._io.cancel();D._linkErrorHandle&&(D._linkErrorHandle.remove(),D._linkErrorHandle=null)});c&&X.forEach(this.getLayers(),c.removeLayer,c)},_setState:function(c,D){var E=c.featureInfos,J,A,S=E?E.length:0,H=D?"show":"hide",ea=D?"_resume":
"_suspend";for(A=0;A<S;A++){var L=E[A];if(J=this.getFeature(L))if("Folder"===L.type)this._setState(J,D&&J.visible);else if("NetworkLink"===L.type)this._setInternalVisibility(J,D);else if(J[ea])J[ea]();else J[H]()}},_areLocalAncestorsVisible:function(c){var D=c.parentFolderId;for(c=c.visible;c&&-1!==D;)D=this.getFeature({type:"Folder",id:D}),c=c&&D.visible,D=D.parentFolderId;return c},_setInternalVisibility:function(c,D){var E=c._parentLayer,J=c._parentFolderId;for(D=D&&c.visible;D&&E;)D=D&&E.visible,
-1<J&&(D=D&&E._areLocalAncestorsVisible(E.getFeature({type:"Folder",id:J}))),J=E._parentFolderId,E=E._parentLayer;this._setIntState(c,D)},_setIntState:function(c,D){c&&X.forEach(c.getLayers(),function(E){E.linkInfo?c._setIntState(E,D&&E.visible&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:E._parentFolderId}))):E.setVisibility(D)})},_getLinkParentId:function(c){var D=-1;this.folders&&X.some(this.folders,function(E){return E.networkLinkIds&&-1!==X.indexOf(E.networkLinkIds,c)?(D=E.id,
!0):!1});return D},_checkAutoRefresh:function(){var c=this.linkInfo;if(c)if(this.visible){if(this.loaded&&this._map){var D=c.refreshMode,E=c.refreshInterval,J=c.viewRefreshMode;c=c.viewRefreshTime;D&&-1!==D.toLowerCase().indexOf("oninterval")&&0<E&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*E));J&&-1!==J.toLowerCase().indexOf("onstop")&&0<c&&!this._extChgHandle&&(this._extChgHandle=d.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),
d.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(c){c=c||this._map;var D={},E=this.linkInfo,J=c&&c.extent;if(this._url.query){R.mixin(D,this._url.query);var A=!!this._url.query.token}C.id&&!A&&(A=C.id.findCredential(this._url.path))&&(D.token=A.token);if(E){A=E.viewFormat;var S=E.httpQuery;E=E.viewBoundScale;if(J&&A){var H=J,ea=J,L=J.spatialReference;L&&(L.isWebMercator()?
H=e.webMercatorToGeographic(J):4326===L.wkid&&(ea=e.geographicToWebMercator(J)));J=H.getCenter();ea=Math.max(ea.getWidth(),ea.getHeight());E&&(H=H.expand(E));A=A.replace(/\[bboxWest\]/ig,H.xmin).replace(/\[bboxEast\]/ig,H.xmax).replace(/\[bboxSouth\]/ig,H.ymin).replace(/\[bboxNorth\]/ig,H.ymax).replace(/\[lookatLon\]/ig,J.x).replace(/\[lookatLat\]/ig,J.y).replace(/\[lookatRange\]/ig,ea).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,J.x).replace(/\[lookatTerrainLat\]/ig,
J.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,J.x).replace(/\[cameraLat\]/ig,J.y).replace(/\[cameraAlt\]/ig,ea).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,c.width).replace(/\[vertPixels\]/ig,c.height).replace(/\[terrainEnabled\]/ig,0);R.mixin(D,P.queryToObject(A))}S&&(S=S.replace(/\[clientVersion\]/ig,C.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,O.locale),R.mixin(D,
P.queryToObject(S)))}c=[];for(var v in D)x.isDefined(D[v])&&c.push(v+"\x3d"+D[v]);return(c=c.join("\x26"))?"?"+c:""},setScaleRange:function(c,D){this.inherited(arguments);X.forEach(this.getLayers(),function(E){E.setScaleRange(c,D)})},setOpacity:function(c){this.opacity!=c&&(X.forEach(this.getLayers(),function(D){D.setOpacity(c)}),this.opacity=c,this.onOpacityChange(c))},_setMap:function(c,D){this.inherited(arguments);this._map=c;var E=this._div=G.create("div",null,D);u.set(E,"position","absolute");
this._addInternalLayers();this.evaluateSuspension();return E},_unsetMap:function(c,D){this._io&&this._io.cancel();this._stopAutoRefresh();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var E=this._div;E&&(D.removeChild(E),G.destroy(E));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(c){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,c),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&c&&(this._waitingForMap||
this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(c){var D,E=[];(c=this.getFeature({type:"Folder",id:c}))&&(D=X.map(c.featureInfos,function(J){if("esriGeometryPoint"===J.type||"esriGeometryPolyline"===J.type||"esriGeometryPolygon"===J.type)return J.id},this))&&0<D.length&&X.forEach(this._fLayers,function(J){var A;var S=J.toJson();S.featureSet.features&&0<S.featureSet.features.length&&(A=X.filter(S.featureSet.features,
function(H){if(-1!==X.indexOf(D,H.attributes[J.objectIdField]))return H},this));A&&0<A.length&&(S.featureSet.features=A,E.push(S))},this);return E},getFeatureCount:function(c){c=this.getFeature({type:"Folder",id:c});var D={points:0,polylines:0,polygons:0};c&&X.forEach(c.featureInfos,function(E){"esriGeometryPoint"===E.type&&(D.points+=1);"esriGeometryPolyline"===E.type&&(D.polylines+=1);"esriGeometryPolygon"===E.type&&(D.polygons+=1)});return D},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=
setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});R.setObject("layers.KMLLayer",w,C);return w})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(O,F,d,R,X){O=O(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(ba){F.mixin(this,ba);X.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});F.setObject("layers.KMLFolder",O,R);return O})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(O,F,d,R,X,ba){O=O([ba],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(V){X.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});F.setObject("layers.KMLGroundOverlay",O,R);return O})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(O,F,
d,R,X,ba,V,P,G,u,C,z,x,f){function q(h,e){var t=[];if(h&&e&&(e.customLayerParameters||e.customParameters)){var k=F.clone(e.customParameters||{});F.mixin(k,e.customLayerParameters||{});var m=u.urlToObject(h);for(var y in m.query)k.hasOwnProperty(y)||t.push(y+"\x3d"+m.query[y]);h=m.path+(t.length?"?"+t.join("\x26"):"")}return h}O=O(x,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(h,e){e||(e={});this.urlTemplate=h=q(h,e.wmtsInfo);var t=new z(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,
2.0037508342787E7,new C({wkid:102100})),k=new z(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new C({wkid:102100}));this.initialExtent=e.initialExtent||t;this.fullExtent=e.fullExtent||k;this.tileInfo=e.tileInfo?e.tileInfo:new f({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,
scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},
{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new C(this.tileInfo.spatialReference.toJson());this.copyright=e.copyright||"";var m=new R(h);t=m.scheme+"://"+m.authority+"/";this.urlPath=h.substring(t.length);this.tileServers=e.tileServers||[];-1===m.authority.indexOf("{subDomain}")&&
this.tileServers.push(t);if(e.subDomains&&0<e.subDomains.length&&1<m.authority.split(".").length){this.subDomains=e.subDomains;var y;d.forEach(e.subDomains,function(c){-1<m.authority.indexOf("${subDomain}")?y=m.scheme+"://"+ba.substitute(m.authority,{subDomain:c})+"/":-1<m.authority.indexOf("{subDomain}")&&(y=m.scheme+"://"+m.authority.replace(/\{subDomain\}/gi,c)+"/");this.tileServers.push(y)},this)}this.tileServers=d.map(this.tileServers,function(c){"/"!==c.charAt(c.length-1)&&(c+="/");return c});
this._levelToLevelValue=[];var K=0;d.forEach(this.tileInfo.lods,function(c,D){this._levelToLevelValue[c.level]=c.levelValue||c.level;0===D&&(K=this._levelToLevelValue[c.level])},this);this._wmtsInfo=e.wmtsInfo;var n=F.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(X("chrome")){t=this.getTileUrl(K,0,0);k=V.defaults.io;var w="with-credentials"===k.useCors?u.canUseXhr(t,!0):-1;(k=-1<w?k.corsEnabledServers[w]:null)&&k.withCredentials?G({url:t,handleAs:"arraybuffer"}).addBoth(function(){n()}):
n()}else n()},getTileUrl:function(h,e,t){h=this._levelToLevelValue[h];var k=this.tileServers[e%this.tileServers.length]+ba.substitute(this.urlPath,{level:h,z:h,col:t,x:t,row:e,y:e});k=k.replace(/\{level\}/gi,h).replace(/\{row\}/gi,e).replace(/\{col\}/gi,t).replace(/\{z\}/gi,h).replace(/\{x\}/gi,t).replace(/\{y\}/gi,e);k=this._appendCustomLayerParameters(k);k=this.addTimestampToURL(k);return u.addProxy(k)},_appendCustomLayerParameters:function(h){var e;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var t=F.clone(this._wmtsInfo.customParameters||{});F.mixin(t,this._wmtsInfo.customLayerParameters||{});for(e in t)h+=(-1===h.indexOf("?")?"?":"\x26")+e+"\x3d"+encodeURIComponent(t[e])}return h}});F.setObject("layers.WebTiledLayer",O,P);return O})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K){O=O([f],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(n,w){w=w||{};w.mode&&w.mode!==f.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=f.MODE_STREAM,this._mode=new q(this));this.purgeOptions=new K(this,w.purgeOptions||{});this.purgeInterval=w.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=
null;this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=X.hitch(this,this._attemptReconnect);this._purge=X.hitch(this,this._purge);this._processServiceJson=X.hitch(this,this._processServiceJson);if(X.isObject(n)&&n.layerDefinition)this._initFeatureLayer(n,w);else{var c=this;z({url:n,content:X.mixin({f:"json"}),callbackParamName:"callback"}).then(function(D){c._processServiceJson(D,w)},function(D){c._errorHandler(D)})}},_processServiceJson:function(n,
w){var c=this;n.relatedFeatures&&n.relatedFeatures.featuresUrl&&n.relatedFeatures.joinField?(this._relatedUrl=n.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=n.relatedFeatures.joinField,z({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(D){D=D.fields||[];var E=d.map(n.fields,function(J){return J.name.toLowerCase()});d.forEach(D,function(J){-1===d.indexOf(E,J.name.toLowerCase())&&n.fields.push(J)});w.resourceInfo=n;c._initFeatureLayer(c._url,w)},
function(D){c.onError({error:D})})):(w.resourceInfo=n,this._initFeatureLayer(this._url,w))},_initLayer:function(n,w){this.inherited(arguments);if(n){var c;if(n.layerDefinition)this.purgeOptions=new K(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||n.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var D=this._getWebsocketConnectionInfo(n),E=D.urls;E&&E.length?(this._socketUrls=E,this.socketUrl=E[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=D.token,E.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=E.length)):(this.socketUrl=void 0,D="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(D+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(D)))}if(this._params.filter)try{this._filter=
c=this._makeFilter(this._params.filter)}catch(J){this.onError(Error("Error trying to create filter object: "+J+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(J){this.onError(Error("Error trying to create filter object: "+J+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=n.keepLatestArchive?n.keepLatestArchive.featuresUrl:null;n.relatedFeatures&&n.relatedFeatures.featuresUrl&&n.relatedFeatures.joinField&&(this._relatedUrl=n.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=n.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(n){var w=this.inherited(arguments),c=this._getRenderer();this.timeInfo&&(this._trackIdField||c&&(c.latestObservationRenderer||c.trackRenderer))&&(this._trackManager=new h(this),this._trackManager.initialize(n));this.socketUrl&&!this._connected&&this._map&&this.connect();return w},_unsetMap:function(n,
w){d.forEach(this._connects,F.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(n){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(n){this.setFilter({where:n})},getDefinitionExpression:function(){if(this._filter)var n=this._filter.where;return n},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(n){this.inherited(arguments)},setGeometryDefinition:function(n){this.setFilter({geometry:n})},getGeometryDefinition:function(){if(this._filter)var n=this._filter.geometry;return n},connect:function(n){var w=new ba,c={},D=this._filter,E,J,A=this.socketUrl,S;try{this._connected||this._connecting?w.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(c.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(D)for(J in D)null!==D[J]&&(E="geometry"===J?JSON.stringify(D[J]):D[J],c[J]=E);A+="?"+P.objectToQuery(c);S=this._createConnection(A,n);w.resolve(S)}.bind(this)).otherwise(function(H){w.reject(H)}))}catch(H){n&&(n(H,!1),w.reject(H)),this.onConnectionError({error:H})}return w.promise},disconnect:function(n){var w=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:c,message:w});n&&n(null,!0)},setFilter:function(n){if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==
n.outFields){var w=Error("Outfields property cannot be changed after layer is created");this.onFilterChange({filter:this.getFilter(),error:w});return!1}var c=this._makeFilter(n)}catch(D){return w=Error(D),this.onFilterChange({filter:this.getFilter(),error:w}),!1}if(this.socket)n={filter:c},this.socket.send(JSON.stringify(n));else G.once(this,"connect",function(D){this.setFilter(c)});return!0},getFilter:function(){var n=this._filter,w={},c=["geometry","outFields","where"];n&&d.forEach(c,function(D){var E=
n[D];E&&("geometry"===D?E=e.fromJson(E):"outFields"===D&&(E=E.split(",")),w[D]=E)});return w},setMaximumTrackPoints:function(n){if(!n&&0!==n)return!1;this.maximumTrackPoints=n;this._mode.propertyChangeHandler(3)},getUniqueValues:function(n){var w={},c=[];var D=this._getField(n,!0);if(!D)return c;n=D.name;d.forEach(this.graphics||[],function(E){E=(E.attributes||{})[n];void 0===E||w[E]||(w[E]=1,c.push(E))});c.sort(function(E,J){return E<J?-1:E>J?1:0});return c},getLatestObservations:function(){var n=
[];return n=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(n){var w=this.purgeInterval;this.purgeInterval=n;this._togglePurgeT();n&&this._togglePurgeT(!0);if(w!==n)this.onPurgeIntervalChange();return this},_togglePurgeT:function(n){if(n&&this.purgeInterval){var w=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){w.updating||w.suspended||(w._mode._flushDrawBuffer(),w._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._purgeT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(n,w){var c=this,D=new WebSocket(n);D.onopen=function(){c.socket=D;c._connected=!0;c._connecting=!1;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();w&&w(null,!0)};D.onclose=
function(E){var J=!0,A=c._connected,S=null;if(c._connected||c._reconnecting){if(E.code){var H="Connection failed: ";if(1001===E.code)H+=E.reason||"Service is going away.",J=!1;else if(4400===E.code)H+=E.reason||"Invalid url parameters. Check filter properties.",J=!1;else if(4404===E.code)H+="Service not found",J=!1;else if(4401===E.code||4403===E.code)H+="Not authorized",J=!1}J&&(c._reconnectAttempts+=1,c._reconnectAttempts>c.maxReconnectAttempts&&(H="Maximum reconnect attempts exceeded",J=!1,A=!0));
c._connected=!1;A&&(H&&(S=Error(H)),c.onDisconnect({error:S,willReconnect:J}));J?c._attemptReconnect():c.socket=null}else c.socket||(S=Error("Could not make connection to service"),c.onConnectionError({error:S})),c.socket=null,c._connected=!1};D.onerror=function(E){};return D},_getKeepLatestFeatures:function(){var n=new ba;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){n.resolve()}.bind(this)).otherwise(function(w){n.reject(w)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):n.resolve();return n.promise},_getRelatedFeatures:function(){var n=new ba;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){n.resolve()}.bind(this)).otherwise(function(w){n.reject(w)}).always(function(){this._relatedQueried=!0}.bind(this)):n.resolve();return n.promise},_purge:function(){var n,w=[];if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(n=0;n<this.graphics.length-
this.purgeOptions.displayCount;n++){var c=this.graphics[n];w.push(c)}0<w.length&&(this._mode._removeFeatures(w),this._trackManager&&this._trackManager.removeFeatures(w))},_bind:function(){var n=this;this.socket.onmessage=function(w){n._onMessage(JSON.parse(w.data))}},_onMessage:function(n){var w=this;this.onMessage(n);var c={create:function(D){w._create(D)},update:function(D){w._update(D)},"delete":function(D){w._delete(D)}};if(n.type)c[n.type](n.feature);else n.hasOwnProperty("filter")?w._handleFilterMessage(n):
this._create(n)},_create:function(n){function w(E){if(!c._featureHasOID(E,D)){if(!E.geometry)return!1;E.attributes=E.attributes||{};E.attributes[D]=c._nextId++}E=E.declaredClass?E:new x(E);c._mode.drawFeature(E)}var c=this,D=c.objectIdField;n.length?n.forEach(function(E){E&&w(E)}):n&&w(n)},_delete:function(n){var w=this,c=n[w.objectIdField]||n.attributes[w.objectIdField],D=!1;this.graphics.forEach(function(E){E.attributes[w.objectIdField]==c&&(D=E)});D&&this.remove(D)},_update:function(n){var w=this,
c=!1;this.graphics.forEach(function(D){D.attributes[w.objectIdField]==n.attributes[w.objectIdField]&&(c=D)});c&&(n.attributes&&c.setAttributes(n.attributes),n.geometry&&c.setGeometry(e.fromJson(n.geometry)))},_makeFilter:function(n){var w=null;n=n||{};if(void 0!==n.geometry)if(w=w||{},null===n.geometry)w.geometry=null;else{var c="string"===typeof n.geometry?e.fromJson(JSON.parse(n.geometry)):n.geometry.declaredClass?n.geometry:e.fromJson(n.geometry);if(!c||"point"===c.type)throw"Query object contains invalid geometry";
"extent"!==c.type&&(c=c.getExtent());if(!c||0===c.getHeight()&&0===c.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";w.spatialRel="esriSpatialRelIntersects";w.geometryType="esriGeometryEnvelope";w.geometry=c.toJson()}void 0!==n.where&&(w=w||{},w.where=n.where);if(void 0!==n.outFields&&(w=w||{},n="string"===typeof n.outFields?"*"===n.outFields?null:n.outFields.replace(/,\s+/g,",").split(","):null===n.outFields?null:n.outFields,n=this._makeOutFields(n))){if(n.errors&&
0<n.errors.length)throw"Invalid filter outFields. "+n.errors.join(",");w.outFields=n.fields?n.fields.join(","):null}return w},_makeOutFields:function(n){var w=this,c=[],D=[],E={fields:null};if(!n||0===n.length)return E;d.forEach(n,function(J){if("*"===J)return E;var A=w._getField(J,!0);A?c.push(A.name):D.push("Field named "+J+" not found in schema.")});n=w._getOutFields();d.forEach(n,function(J){w._getField(J)&&-1===d.indexOf(c,J)&&c.push(J)});E.fields=c;E.errors=D;return E},_handleFilterMessage:function(n){n.error?
(n=Error(n.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:n})):(n=n.filter,n.geometry&&"string"===typeof n.geometry&&(n.geometry=JSON.parse(n.geometry)),this._filter=n,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(n){var w={urls:[]},c,D=[],E=[],J;n.streamUrls&&d.forEach(n.streamUrls,function(H){"ws"===H.transport&&(c=H.urls,w.token=H.token)});if(!c)return w;d.forEach(c,function(H){0===H.lastIndexOf("wss",0)?E.push(H):D.push(H)});n="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?E:0===D.length?E:D;if(1<n.length)for(J=0;J<n.length-1;J++){var A=J+Math.floor(Math.random()*(n.length-J));var S=n[A];n[A]=n[J];n[J]=S}w.urls=n;return w},_attemptReconnect:function(){var n=this;this._reconnectTimeoutId=null;n._connected=!1;if(!n._socketUrls)return!1;if(!n._collection&&!n._reconnecting&&n.socket&&n.credential)return n._reconnecting=!0,n._getServiceConnectionMetadata(n._attemptReconnect),!1;n._reconnecting=!0;n.socket=null;if(n._reconnectAttempts>
n.maxReconnectAttempts)return n._reconnecting=!1;n.socketUrl=n._socketUrls[n._reconnectAttempts>n._socketUrls.length-1?n._reconnectAttempts%n._socketUrls.length:n._reconnectAttempts];n.socketUrl+="/"+n.socketDirection;var w=n._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){n.onAttemptReconnect({count:n._reconnectAttempts,url:n.socketUrl});n.connect()},1E3*n._reconnectAttempts+w)},_getServiceConnectionMetadata:function(n){var w=this,c=w._url.path;n="function"===typeof n?
n:null;z({url:c,content:X.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(D){D=w._getWebsocketConnectionInfo(D);w._websocketToken=D.token;n&&n()},function(D){w.onError(Error(D))})},_setDefaultRenderer:function(){var n=this.geometryType,w=new R([5,112,176,.8]),c=new R([255,255,255]);c=new k(k.STYLE_SOLID,c,1);if("esriGeometryPoint"===n||"esriGeometryMultipoint"===n)var D=new m(m.STYLE_CIRCLE,10,c,w);else if("esriGeometryPolyline"===n)D=new k(k.STYLE_SOLID,w,2);else if("esriGeometryPolygon"===
n||"esriGeometryEnvelope"===n)w=new R([5,112,176,.2]),c=new R([5,112,176,.8]),c=new k(k.STYLE_SOLID,c,1),D=new t(t.STYLE_SOLID,c,w);D&&this.setRenderer(new y(D))},_makeObjectIdField:function(){var n=1,w,c=[];if(!this.objectIdField){var D=this.fields.length;for(w=0;w<D;w++)c.push(this.fields[w].name.toLowerCase());for(;-1!==d.indexOf(c,"objectid_"+n);)n+=1;this.objectIdField="objectid_"+n;this.fields.push({name:"objectid_"+n,type:"esriFieldTypeOID",alias:"objectid_"+n,nullable:!1})}},_featureHasOID:function(n,
w){return n.attributes&&(n.attributes[w]||0===n.attributes[w])},_randomIntFromInterval:function(n,w){return Math.floor(Math.random()*(w-n+1)+n)}});X.setObject("layers.StreamLayer",O,C);return O})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(O,F,d,R,X,ba,V,P,G){O=O([G],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(u){this.inherited(arguments);
var C=u.getMap().spatialReference;this.isWebMercator=C.isWebMercator();this.canWrap=C._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(u){this.inherited(arguments)},addFeatures:function(u,C){function z(m,y){var K,n;h[m]||(h[m]=[]);var w=h[m];if(0<k){y.length>k&&y.splice(0,y.length-k);var c=y.length+w.length;c>k&&(K=w.splice(0,c-k))}c=y.length;for(n=0;n<c;n+=1)w.push(y[n]);return{deletes:K,adds:y}}var x={},f={},q;if(C)return this.inherited(arguments),
x;var h=this.trackMap;var e=this.layer;var t=e._trackIdField;var k=e.maximumTrackPoints||0;d.forEach(u,function(m){var y=m.attributes[t];m.visible&&(f[y]||(f[y]=[]),f[y].push(m))});for(q in f)f.hasOwnProperty(q)&&(e=z(q,f[q]),x[q]=e);return x},removeFeatures:function(u){var C=[],z=this.layer.objectIdField,x=this.layer._trackIdField;u&&(d.forEach(u,function(f){var q;var h=f.attributes[x];var e=f.attributes[z];if(q=this.trackMap[h])for(f=0;f<q.length;f+=1){var t=q[f];if(t.attributes[z]===e){this.trackMap[h].splice(f,
1);-1===d.indexOf(h)&&C.push(h);break}}},this),0<u.length&&this.refreshTracks(C))},drawTracks:function(u){function C(t){var k=q[t],m=k&&1<k.length,y=z.trackLineMap[t];y&&!m&&(x.remove(y),delete z.trackLineMap[t],y=null);if(!m)return!1;m=[];for(var K=[],n,w=k.length,c=0;c<w;c++)if(n=k[c].geometry){n=n.normalize();var D=n.x,E=0,J=!1;A&&z.canWrap&&(E=D-A.x,Math.abs(E)>z.wrapThreshold&&(J=!0));J?(K.push([z.getWrappedX(D),n.y]),m.push(K.slice(0)),K=[[D,n.y]]):K.push([D,n.y]);var A=new V(D,n.y,h)}1<K.length&&
m.push(K);k={};k[e]=t;if(m.length)if(y){for(var S=y.geometry;S.paths.length;)S.removePath(S.paths.length-1);m.forEach(function(H){S.addPath(H)});y.setGeometry(S)}else y=new ba(new P({paths:m,spatialReference:h}),null,k),x.add(y),z.trackLineMap[t]=y}var z=this,x=this.container,f;if(x){var q=this.trackMap;var h=this.map.spatialReference;var e=this.layer._trackIdField;if(u)d.forEach(u,function(t){C(t)});else for(f in q)q.hasOwnProperty(f)&&C(f)}},refreshTracks:function(u){function C(q){var h;q=z[q]||
[];var e=q.length;for(h=0;h<e;h++)x._repaint(q[h],null,!0)}var z=this.trackMap,x=this.layer,f;this.drawTracks(u);if(u)d.forEach(u,function(q){C(q)});else for(f in z)z.hasOwnProperty(f)&&C(f)},getLatestObservations:function(){var u,C=this.trackMap,z=[];for(u in C)if(C.hasOwnProperty(u)){var x=C[u];z.push(x[x.length-1])}return z},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(u){var C=this.isWebMercator,z=C?2.0037508342788905E7:180;C=C?-2.0037508342788905E7:
-180;return(0<u?C:z)-((0<u?z:C)-u)}});F.setObject("layers._StreamTrackManager",O,X);return O})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(O,F,d,R,X){O=O([d],{declaredClass:"esri.layers.PurgeOptions",constructor:function(ba,V){this.parent=ba;for(var P in V)this[P]=V[P]},_displayCountSetter:function(ba){this.displayCount=ba;this.parent.refresh()}});F.setObject("layers.PurgeOptions",O,X);return O})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],
function(){return{}})},"esri/layers/wms":function(){define(["./agscommon","./dynamic","./WMSLayer"],function(){return{}})},"esri/layers/dynamic":function(){define(["../geometry","./DynamicMapServiceLayer"],function(){return{}})},"esri/layers/wmts":function(){define(["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t){F=F([h],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(k,m){this.version="1.0.0";this.tileUrl=this._url=k;this.serviceMode="RESTful";this._parseCapabilities=d.hitch(this,this._parseCapabilities);this._getCapabilitiesError=d.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};m||(m={});if(m.serviceMode)if("KVP"===m.serviceMode||"RESTful"===m.serviceMode)this.serviceMode=m.serviceMode;else return;this.customParameters=m.customParameters;this.customLayerParameters=m.customLayerParameters;this.layerInfo=new t;m.layerInfo&&(this.layerInfo=m.layerInfo,this._identifier=m.layerInfo.identifier,this._tileMatrixSetId=m.layerInfo.tileMatrixSet,
m.layerInfo.format&&(this.format="image/"+m.layerInfo.format),this._style=m.layerInfo.style,this.title=m.layerInfo.title,this._dimension=m.layerInfo.dimension,this._dimension2=m.layerInfo.dimension2);m.resourceInfo?(this.version=m.resourceInfo.version,m.resourceInfo.getTileUrl&&(this._url=this.tileUrl=m.resourceInfo.getTileUrl),this.copyright=m.resourceInfo.copyright,this.layerInfos=m.resourceInfo.layerInfos,this.customParameters=m.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=
m.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(k){this.setVisibleLayer(k)},setVisibleLayer:function(k){this._setActiveLayer(k);this.refresh(!0)},setCustomParameters:function(k,m){this.customParameters=k;this.customLayerParameters=m;this.refresh(!0)},getTileUrl:function(k,m,y){k=this._levelToLevelValue[k];k=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[m%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,k).replace(/\{TileRow\}/gi,m).replace(/\{TileCol\}/gi,y).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,k).replace(/\{row\}/gi,m).replace(/\{col\}/gi,y);k=this._appendCustomLayerParameters(k);k=this.addTimestampToURL(k);return u.addProxy(k)},getTileUrlTemplate:function(k){var m=
k.identifier,y=k.tileMatrixSet,K=k.format,n=k.style,w=k.dimension,c=k.dimension2;m?k=R.filter(this.layers,function(E){return E.identifier===m})[0]:(k=this.layers[0],m=this.layers[0].identifier);if(k){if(!K)K=k.formats[0];else if(!(-1===K.indexOf("image/")&&-1<R.indexOf(k.formats,K))&&(-1===K.indexOf("image/")&&(K="image/"+K),-1===R.indexOf(k.formats,K))){this.onError(Error("The layer doesn't support the format of "+K));return}if(!n)n=k.styles[0];else if(-1===R.indexOf(k.styles,n)){this.onError(Error("The layer doesn't support the style of "+
n));return}if(!w&&k.dimensions)w=k.dimensions[0];else if(-1===R.indexOf(k.dimensions,w)){this.onError(Error("The layer doesn't support the dimension of "+w));return}if(!c&&k.dimensions2)c=k.dimensions2[0];else if(-1===R.indexOf(k.dimensions2,c)){this.onError(Error("The layer doesn't support the dimension of "+c));return}if(y){var D=R.filter(k.tileMatrixSetInfos,function(E){return E.tileMatrixSet===y})[0];if(!D){this.onError(Error("The tileMatrixSetId "+y+" is not supported by the layer of "+m));return}}else(D=
R.filter(k.tileMatrixSetInfos,function(E){return"GoogleMapsCompatible"===E.tileMatrixSet})[0])||(D=k.tileMatrixSetInfos[0]),y=D.tileMatrixSet;return this._getTileUrlTemplate(m,y,K,n,w,c)}this.onError(Error("couldn't find the layer "+m))},_getTileUrlTemplate:function(k,m,y,K,n,w){k||(k=this._identifier);m||(m=this._tileMatrixSetId);y||(y=this.format);K||""===K||(K=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var c=this.resourceUrls[0].template;c.indexOf(".xxx")===c.length-4&&(c=c.slice(0,
c.length-4));c=c.replace(/\{Style\}/gi,K);c=c.replace(/\{TileMatrixSet\}/gi,m);c=c.replace(/\{TileMatrix\}/gi,"{level}");c=c.replace(/\{TileRow\}/gi,"{row}");c=c.replace(/\{TileCol\}/gi,"{col}");c=c.replace(/\{dimensionValue\}/gi,n);return c=c.replace(/\{dimensionValue2\}/gi,w)}"KVP"===this.serviceMode?c=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+k+"\x26STYLE\x3d"+K+"\x26FORMAT\x3d"+y+"\x26TILEMATRIXSET\x3d"+m+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(n="",this._formatDictionary[y.toLowerCase()]&&(n=this._formatDictionary[y.toLowerCase()]),c=this._url+k+"/"+K+"/"+m+"/{level}/{row}/{col}"+n);return c},_parseResourceInfo:function(){var k=this.layerInfos,m;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(m=0;m<k.length;m++)if(!(this._identifier&&k[m].identifier!==this._identifier||this.title&&k[m].title!==this.title||this._tileMatrixSetId&&k[m].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+k[m].format!==this.format||this._style&&k[m].style!==this._style)){d.mixin(this,{description:k[m].description,tileInfo:k[m].tileInfo,spatialReference:k[m].tileInfo.spatialReference,fullExtent:k[m].fullExtent,initialExtent:k[m].initialExtent,_identifier:k[m].identifier,_tileMatrixSetId:k[m].tileMatrixSet,format:"image/"+k[m].format,_style:k[m].style});break}for(m=0;m<k.length;m++){var y=k[m].tileInfo;96!==y.dpi&&(R.forEach(y.lods,function(K){K.scale=96*K.scale/y.dpi}),y.dpi=96);R.forEach(y.lods,
function(K){K.resolution=this._getResolution(y.spatialReference.wkid,90.71428571428571*K.scale/96,k[m].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];R.forEach(this.tileInfo.lods,function(K){this._levelToLevelValue[K.level]=K.levelValue?K.levelValue:K.level},this)},_getCapabilities:function(){var k;"KVP"===this.serviceMode?k=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(k=this._url+"/"+this.version+"/WMTSCapabilities.xml");k=this._appendCustomParameters(k);G({url:k,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(k){k=k.replace(/ows:/gi,"");k=ba.parse(k);var m=O.query("Contents",k)[0];if(m){var y=O.query("OperationsMetadata",k)[0],K=O.query("[name\x3d'GetTile']",y)[0];y=this._url;K=O.query("Get",
K);var n,w=!1;for(n=0;n<K.length;n++){var c=O.query("Constraint",K[n])[0];if(!c||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,c)){y=K[n].attributes[0].nodeValue;w=!0;break}else if(!c||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",c))var D=K[n].attributes[0].nodeValue;else if(!c||this._getTagWithChildTagValue("AllowedValues","Value","KVP",c))var E=K[n].attributes[0].nodeValue}w||("KVP"===this.serviceMode&&D?(y=D,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
E&&(y=E,this.serviceMode="KVP"));-1===y.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(y+="/");"KVP"===this.serviceMode&&(y+=-1<y.indexOf("?")?"":"?");this._url=y;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",k)[0];D=O.query("Layer",m);var J,A=[];this.layers=[];R.forEach(D,function(S){J=this._getTagValues("Identifier",S)[0];A.push(J);this.layers.push(this._getWMTSLayerInfo(J,S,m))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(k){k||(k={});k.identifier&&(this._identifier=k.identifier);k.tileMatrixSet&&(this._tileMatrixSetId=k.tileMatrixSet);k.format&&(this.format=k.format);k.style&&(this._style=k.style);k.dimension&&(this._dimension=k.dimension);k.dimension2&&(this._dimension2=k.dimension2);if(this.layers)if(this._identifier?k=R.filter(this.layers,function(y){return y.identifier===this._identifier},this)[0]:(k=this.layers[0],this._identifier=this.layers[0].identifier),k){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===R.indexOf(k.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=k.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=k.styles[0];else if(-1===R.indexOf(k.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&k.dimensions)this._dimension=
k.dimensions[0];else if(-1===R.indexOf(k.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&k.dimensions2)this._dimension2=k.dimensions2[0];else if(-1===R.indexOf(k.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var m=R.filter(k.tileMatrixSetInfos,function(y){return y.tileMatrixSet===this._tileMatrixSetId},this)[0];
if(!m){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(m=R.filter(k.tileMatrixSetInfos,function(y){return"GoogleMapsCompatible"===y.tileMatrixSet})[0])||(m=k.tileMatrixSetInfos[0]),this._tileMatrixSetId=m.tileMatrixSet;this.description=k.description;this.title=k.title;this.spatialReference=m.tileInfo.spatialReference;this.tileInfo=m.tileInfo;this._levelToLevelValue=[];R.forEach(this.tileInfo.lods,function(y){this._levelToLevelValue[y.level]=
y.levelValue?y.levelValue:y.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=q.geographicToWebMercator(k.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=k.gcsExtent:(this.fullExtent=m.fullExtent,this.initialExtent=m.initialExtent);this.resourceUrls=k.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(k,m,y){var K=this._getTagValues("Abstract",m)[0],n=this._getTagValues("Title",m)[0],w=O.query("WGS84BoundingBox",m)[0],c=w?this._getTagValues("LowerCorner",w)[0].split(" "):["-180","-90"],D=w?this._getTagValues("UpperCorner",w)[0].split(" "):["180","90"];
w=parseFloat(c[0]);c=parseFloat(c[1]);var E=parseFloat(D[0]);D=parseFloat(D[1]);w=new f(w,c,E,D,new z({wkid:4326}));D=this._getTagValues("Identifier",O.query("Style",m)[0]);var J=this._getTagValues("Identifier",O.query("Dimension",m)[0]),A=this._getTagValues("Default",O.query("Dimension",m)[0])||this._getTagValues("Value",O.query("Dimension",m)[0]),S=1<O.query("Dimension",m).length?this._getTagValues("Identifier",O.query("Dimension",m)[1]):[],H=1<O.query("Dimension",m).length?this._getTagValues("Default",
O.query("Dimension",m)[1])||this._getTagValues("Value",O.query("Dimension",m)[1]):[];c=this._getTagValues("Format",m);y=this._getLayerMatrixInfos(m,y);k={identifier:k,tileMatrixSetInfos:y,formats:c,styles:D,title:n,description:K,gcsExtent:w,dimensions:A,dimensions2:H};m=O.query("ResourceURL",m);var ea=[],L;R.forEach(m,function(v){L=v.getAttribute("template");if(J&&A&&J[0]&&A[0])if(-1<L.indexOf("{"+J+"}"))L=L.replace("{"+J+"}","{dimensionValue}");else{var b=L.toLowerCase().indexOf("{"+J[0].toLowerCase()+
"}");-1<b&&(L=L.substring(0,b)+"{dimensionValue}"+L.substring(b+J[0].length+2))}S&&H&&S[0]&&H[0]&&(-1<L.indexOf("{"+S+"}")?L=L.replace("{"+S+"}","{dimensionValue2}"):(b=L.toLowerCase().indexOf("{"+S[0].toLowerCase()+"}"),-1<b&&(L=L.substring(0,b)+"{dimensionValue2}"+L.substring(b+S[0].length+2))));ea.push({template:L,format:v.getAttribute("format"),resourceType:v.getAttribute("resourceType")})});ea&&0<ea.length&&(k.resourceUrls=ea);return k},_getLayerMatrixInfos:function(k,m){var y=[],K=this._getTagValues("TileMatrixSet",
k);if(K&&0!==K.length)return R.forEach(K,function(n){n=this._getLayerMatrixInfo(n,k,m);y.push(n)},this),y},_getLayerMatrixInfo:function(k,m,y){var K=[];m=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",k,m);var n=this._getTagValues("TileMatrix",m),w=this._getTagWithChildTagValue("TileMatrixSet","Identifier",k,y),c=this._getTagValues("SupportedCRS",w)[0];var D=parseInt(c.split(":").pop(),10);if(900913==D||3857==D)D=102100;if(-1<c.toLowerCase().indexOf("crs84")||-1<c.toLowerCase().indexOf("crs:84")){D=
4326;var E=!0}else if(-1<c.toLowerCase().indexOf("crs83")||-1<c.toLowerCase().indexOf("crs:83"))D=4269,E=!0;else if(-1<c.toLowerCase().indexOf("crs27")||-1<c.toLowerCase().indexOf("crs:27"))D=4267,E=!0;var J=new z({wkid:D}),A=O.query("TileMatrix",w)[0];y=parseInt(this._getTagValues("TileWidth",A)[0],10);m=parseInt(this._getTagValues("TileHeight",A)[0],10);var S=this._getTagValues("TopLeftCorner",A)[0].split(" ");var H=S[0],ea=S[1];1<H.split("E").length&&(S=H.split("E"),H=S[0]*Math.pow(10,S[1]));1<
ea.split("E").length&&(S=ea.split("E"),ea=S[0]*Math.pow(10,S[1]));H=parseFloat(H);ea=parseFloat(ea);var L=E&&4326===D&&90===H&&-180===ea;for(S=0;S<this._flippingAxisForWkids.length;S++)if(c.split(":").pop()>=this._flippingAxisForWkids[S][0]&&c.split(":").pop()<=this._flippingAxisForWkids[S][1]||4326===D&&(!E||L)){4326===D&&90<H&&(H="90");var v=new x(ea,H,J);break}S===this._flippingAxisForWkids.length&&(v=new x(H,ea,J));if(0===n.length)for(n=O.query("TileMatrix",w),S=0;S<n.length;S++)E=this._getLodFromTileMatrix(n[S],
D,S,k),K.push(E);else for(S=0;S<n.length;S++)E=this._getTagWithChildTagValue("TileMatrix","Identifier",n[S],w),E=this._getLodFromTileMatrix(E,D,S,k),K.push(E);D=O.query("BoundingBox",w)[0];if(D){var b=this._getTagValues("LowerCorner",D)[0].split(" ");var g=this._getTagValues("UpperCorner",D)[0].split(" ")}b&&1<b.length&&g&&1<g.length?(A=parseFloat(b[0]),D=parseFloat(b[1]),b=parseFloat(g[0]),g=parseFloat(g[1])):(b=this._getTagValues("MatrixWidth",A)[0],D=this._getTagValues("MatrixHeight",A)[0],A=v.x,
g=v.y,b=A+b*m*K[0].resolution,D=g-D*y*K[0].resolution);g=b=new f(A,D,b,g,J);v=new e({dpi:96,spatialReference:J,format:this.format,rows:y,cols:m,origin:v,lods:K});return{tileMatrixSet:k,fullExtent:g,initialExtent:b,tileInfo:v}},_getCapabilitiesError:function(k){this.onError(k)},_getLodFromTileMatrix:function(k,m,y,K){var n=this._getTagValues("Identifier",k)[0];k=this._getTagValues("ScaleDenominator",k)[0];1<k.split("E").length?(k=k.split("E"),k=k[0]*Math.pow(10,k[1])):k=parseFloat(k);m=this._getResolution(m,
k,K);return{level:y,levelValue:n,scale:1.058267716535433*k,resolution:m}},_getResolution:function(k,m,y){k=P.isDefined(C[k])?C.values[C[k]]:"default028mm"===y?6370997*Math.PI/180:6378137*Math.PI/180;return 7*m/25E3/k},_getTag:function(k,m){var y=O.query(k,m);return y&&0<y.length?y[0]:null},_getTagValues:function(k,m){var y=[],K=k.split("\x3e"),n;var w=O.query(K[0],m)[0];if(1<K.length){for(n=1;n<K.length-1;n++)w=O.query(K[n],w)[0];K=O.query(K[K.length-1],w)}else K=O.query(K[0],m);K&&0<K.length&&R.forEach(K,
function(c){9>X("ie")?y.push(c.childNodes.length?c.childNodes[0].nodeValue:""):y.push(c.textContent)});return y},_getAttributeValues:function(k,m,y){k=O.query(k,y);var K=[];k&&0<k.length&&R.forEach(k,function(n){K.push(n.getAttribute(m))});return K},_getTagWithChildTagValue:function(k,m,y,K){K=K.childNodes;var n;for(n=0;n<K.length;n++)if(-1<K[n].nodeName.indexOf(k)){if(9>X("ie")){if(P.isDefined(O.query(m,K[n])[0]))var w=O.query(m,K[n])[0].childNodes[0].nodeValue}else P.isDefined(O.query(m,K[n])[0])&&
(w=O.query(m,K[n])[0].textContent);if(w===y||y.split(":")&&w===y.split(":")[1])return K[n]}},_appendCustomParameters:function(k){var m;if(this.customParameters)for(m in this.customParameters)k+=(-1===k.indexOf("?")?"?":"\x26")+m+"\x3d"+encodeURIComponent(this.customParameters[m]);return k},_appendCustomLayerParameters:function(k){var m;if(this.customLayerParameters||this.customParameters){var y=d.clone(this.customParameters||{});d.mixin(y,this.customLayerParameters||{});for(m in y)k+=(-1===k.indexOf("?")?
"?":"\x26")+m+"\x3d"+encodeURIComponent(y[m])}return k},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,
5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,
3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],
[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});d.setObject("layers.WMTSLayer",F,V);return F})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(X){X&&(this.title=X.title,this.tileMatrixSet=
X.tileMatrixSet,this.format=X.format,this.style=X.style,this.tileInfo=X.tileInfo,this.fullExtent=X.fullExtent,this.initialExtent=X.initialExtent,this.identifier=X.identifier,this.description=X.description,this.dimension=X.dimension)}});F.setObject("layers.WMTSLayerInfo",O,R);return O})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C){O=O(P,{declaredClass:"esri.virtualearth.VEGeocoder",constructor:function(z){try{if(z=F.mixin({bingMapsKey:null},z||{}),this.url=V.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=V.urlToObject(this.url),this._queue=[],this.bingMapsKey=z.bingMapsKey,this.culture=z.culture||"en-US",this._errorHandler=F.hitch(this,this._errorHandler),this._addressToLocationsHandler=F.hitch(this,this._addressToLocationsHandler),
!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(x){throw this.onError(x),x;}},addressToLocations:function(z,x,f){if(this.bingMapsKey){var q=F.mixin({},this._url.query,{query:z,token:this.bingMapsKey,culture:this.culture}),h=this._addressToLocationsHandler,e=this._errorHandler,t=new R(u._dfdCanceller);t._pendingDfd=C({url:this._url.path,content:q,callbackParamName:"callback",load:function(k,m){h(k,m,x,f,t)},error:function(k){e(k,f,t)}});return t}this._queue.push(arguments)},_addressToLocationsHandler:function(z,
x,f,q,h){try{d.forEach(z,function(e,t){z[t]=new G(e)}),this._successHandler([z],"onAddressToLocationsComplete",f,h)}catch(e){this._errorHandler(e,q,h)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(z){this.bingMapsKey=z},setCulture:function(z){this.culture=z}});F.setObject("virtualearth.VEGeocoder",O,ba);return O})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),
function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",constructor:function(P){F.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},P);this.address&&(this.address=new V(this.address));this.bestView&&(this.bestView=new ba(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new X(this.locationArray[0]))}});F.setObject("virtualearth.VEGeocodeResult",
O,R);return O})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(X){F.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},X)}});F.setObject("virtualearth.VEAddress",O,R);return O})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q){O=O(x,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(h){try{if(h=F.mixin({bingMapsKey:null,culture:"en-US"},h||{}),this.url=u.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=u.urlToObject(this.url),this.spatialReference=new C({wkid:102100}),this.tileInfo=new z({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new f(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new C({wkid:102100})),F.mixin(this,h),this.hasAttributionData=this.showAttribution,this._initLayer=F.hitch(this,this._initLayer),this._errorHandler=F.hitch(this,this._errorHandler),this._getTileInfo=F.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(e){throw this.onError(e),e;}},_unsetMap:function(h,e){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var h=this._url.path+"/Imagery/Metadata/"+this.mapStyle,e=window.location.protocol;if(this.bingMapsKey){var t=this.resourceInfo;!this.loaded&&t?this._initLayer(t):q({url:h,content:F.mixin({},{uriScheme:"https:"===e?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(h,e){if(200!==h.statusCode){var t=Error();t.code=h.statusCode;t.message=h.statusDescription;t.details=h.errorDetails;t.authenticationResultCode=h.authenticationResultCode;this.onError(t)}else try{this.resourceInfo=d.toJson(h);t=h.resourceSets[0].resources[0];var k=t.imageUrl.replace("{","${");this.tileServers=R.map(t.imageUrlSubdomains,function(y){var K=u.getProtocolForWebResource();return V.substitute(k,{subdomain:y}).replace("http:",K)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var m=this.loadCallback;m&&(delete this.loadCallback,m(this))}}catch(y){this.onError(y)}},getAttributionData:function(){var h=new P,e=d.fromJson(this.resourceInfo),t;this.hasAttributionData&&e&&(t=F.getObject("resourceSets.0.resources.0.imageryProviders",!1,e));t?h.callback({contributors:t}):
(e=Error("Layer does not have attribution data"),e.log=X.isDebug,h.errback(e));return h},getTileUrl:function(h,e,t){return V.substitute(this.tileServers[e%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(h,e,t),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(h,e,t){var k="",m;for(m=h;0<m;m--){h="0";var y=1<<m-1;0!=(t&y)&&h++;0!=(e&y)&&(h++,h++);k+=h}return k},setMapStyle:function(h){this.mapStyle=h;this._getTileInfo()},setCulture:function(h){this.culture=h;this._getTileInfo()},
setBingMapsKey:function(h){this.bingMapsKey=h},onMapStyleChange:function(){}});F.mixin(O,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});F.setObject("virtualearth.VETiledLayer",O,G);return O})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L,v,b,g,W,N){var U=O([z,x],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:N,onLoad:function(){},constructor:function(M,Z){M=M||{};this._settings=M.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var M=this._settings.layerInfos;this.featureReductionEnabledLayers=[];d.forEach(M,function(da){da=da.featureLayer;
da.isFeatureReductionEnabled()&&(da.disableFeatureReduction(),this.featureReductionEnabledLayers.push(da))},this);if(d.every(M,function(da){return da.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var Z=M.length;d.forEach(M,function(da){da=da.featureLayer;if(da.loaded)Z--;else var oa=R.connect(da,"onLoad",this,function(wa){R.disconnect(oa);oa=null;Z--;Z||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),
this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(M){this._updateCurrentFeature(F.hitch(this,function(){this._clearSelection(!1);M&&M()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();
this._reset();this._disableMapClickHandler();d.forEach(this._eConnects,R.disconnect);R.disconnect(this._dtConnect);R.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();
d.forEach(this.featureReductionEnabledLayers,function(M){M.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new n(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new w(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=
F.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=F.mixin({polylineDrawTools:[U.CREATE_TOOL_POLYLINE],polygonDrawTools:[U.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var M=g.defaults;this._settings.geometryService=this._settings.geometryService||M.geometryService;M.geometryService=M.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};d.forEach(this._settings.layerInfos,function(M){if(M.featureLayer&&M.featureLayer.loaded){this._settings.layers.push(M.featureLayer);var Z=M.featureLayer.id;M.featureLayer.credential&&
(this._settings.userIds[Z]=M.featureLayer.credential.userId);M.userId&&(this._settings.userIds[Z]=M.userId);var da=M.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[Z]=da.canCreate&&!da.canUpdate?!0:!1;this._isTextSymbolPointLayer(M.featureLayer)&&(M.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(M){var Z=this.templatePicker.getSelected();var da=Z.template?Z.featureLayer.renderer.getSymbol(Z.template.prototype):Z.symbolInfo.symbol;this._tempGraphic=new t(M,da,null,null);this._tempGraphic.setAttributes(F.mixin({},Z.template.prototype.attributes));da=this._settings.map;da.graphics.add(this._tempGraphic);M=this._findCenterPoint(M);this._createAttributeInspector();da.infoWindow.setTitle(Z.featureLayer?Z.featureLayer.name:W.widgets.attributeInspector.NLS_title);
this.attributeInspector.showFeature(this._tempGraphic,Z.featureLayer);this._showInfoWindow(M,da.getInfoWindowAnchor(M));if(this._settings.createOnlyLayer[Z.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=R.connect(da.infoWindow,"onHide",this,"_infoWindowHide");R.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=
R.connect(this.templatePicker,"onSelectionChange",F.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(M,Z,da){this._tempGraphic.attributes[Z]="number"===typeof da&&isNaN(da)?null:da},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);R.disconnect(this._infoWindowHideEvent)},_createFeature:function(M,Z){this._editClickPoint=this._findCenterPoint(M);M.rings?this._simplify(M,F.hitch(this,function(da){this._drawingTool!==K.TOOL_AUTO_COMPLETE_POLYGON?
this._applyEdits([{layer:this._layer,adds:[this._createGraphic(da,Z)]}],F.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(da,F.hitch(this,function(oa){oa&&oa.length&&this._applyEdits([{layer:this._layer,adds:d.map(oa,F.hitch(this,function(wa){return this._createGraphic(wa,Z)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):
this._applyEdits([{layer:this._layer,adds:[this._createGraphic(M,Z)]}],F.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(M,Z){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(M,
Z)},_updateCurrentFeature:function(M){var Z=this._isModified();Z?this._updateFeature(Z,M):M&&M(!1)},_updateFeature:function(M,Z,da){var oa=M.geometry,wa=M.getLayer();wa.hasZ&&!wa.enableZDefaults||wa.hasM&&!wa.allowUpdateWithoutMValues||da&&!this._isModified()?(da=new t,da.setAttributes(M.attributes),this._applyEdits([{layer:M.getLayer(),updates:[da]}],Z)):oa.rings?this._simplify(oa,F.hitch(this,function(ra){this._applyEdits([{layer:M.getLayer(),updates:[F.mixin(M,{geometry:ra})]}],Z)})):this._applyEdits([{layer:M.getLayer(),
updates:[M]}],Z)},_deleteFeature:function(M,Z){if(this._settings.invalidTemplate&&M===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var da=[];M?da.push({layer:M.getLayer(),deletes:[M]}):(da=d.map(d.filter(this._settings.layers,function(oa){return 0<oa.getSelectedFeatures().length}),function(oa){return{layer:oa,deletes:oa.getSelectedFeatures()}}))&&da.length||!this._currentGraphic||da.push({layer:this._layer,deletes:[this._currentGraphic]});
this._applyEdits(da,Z)}},_stopEditing:function(M,Z,da,oa){f.hide(this.progressBar.domNode);this._settings.createOnlyLayer[M.id]||this._undoRedoAdd();if(!0===M._isSelOnly||1===M.mode||6===M.mode){if(Z&&Z.length){this.templatePicker.clearSelection();var wa=new m;wa.objectIds=[Z[0].objectId];this._settings.createOnlyLayer[M.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([M],wa,F.hitch(this,"_onEditFeature"))}}else(wa=this._selectionHelper.findMapService(this._settings.map,
M))&&wa.refresh(),Z&&Z.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[M.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):D.findFeatures(Z,M,F.hitch(this,"_onEditFeature")));oa&&oa.length&&(this._clearSelection(!0),this._undoRedo&&(wa=this._selectionHelper.findMapService(M,this._settings.map))&&wa.refresh());this._undoRedo&&da&&da.length&&((wa=this._selectionHelper.findMapService(M,this._settings.map))&&wa.refresh(),this.attributeInspector.refresh(),
this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var M=this._edits&&this._edits.length?this._edits[0]:null;if(M){var Z=M.adds||[],da=M.updates||[],oa=M.deletes||[],wa=M.preUpdates||[];M={featureLayer:M.layer};"CUT"===this._activeTool?Z.length&&da.length&&wa.length&&this.undoManager.add(new S(F.mixin(M,{preUpdatedGraphics:wa,addedGraphics:Z,
postUpdatedGraphics:da}))):"UNION"===this._activeTool?oa.length&&da.length&&wa.length&&this.undoManager.add(new H(F.mixin(M,{preUpdatedGraphics:wa,deletedGraphics:oa,postUpdatedGraphics:da}))):Z.length?this.undoManager.add(new E(F.mixin(M,{addedGraphics:Z}))):oa.length?this.undoManager.add(new A(F.mixin(M,{deletedGraphics:oa}))):da.length&&(this._rollbackGraphic||wa.length)&&this.undoManager.add(new J(F.mixin(M,{preUpdatedGraphics:wa.length?wa:[this._rollbackGraphic],postUpdatedGraphics:da})));this._rollbackGraphic=
this._edits=null}}},_activateDrawToolbar:function(M){this._layer=M.featureLayer;this._activeType=M.type;this._drawingTool=(this._activeTemplate=M.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,M.featureLayer);R.disconnect(this._dtConnect);var Z=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var da=F.mixin({},this._activeTemplate.prototype.attributes);Z=Z.filter(function(oa){return!1===
oa.nullable&&!0===oa.editable});this._settings.invalidTemplate=Z.some(function(oa){oa=da[oa.name];return null===oa||void 0===oa})}this._dtConnect=this._settings.createOnlyLayer[M.featureLayer.id]||this._settings.invalidTemplate?R.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):R.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):
this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(M,Z){var da=M.getLayer(),oa=da?da.geometryType:null,wa=this._isTextSymbolPoint(M),ra=w.MOVE;"esriGeometryPoint"!==oa&&!0===this._isNotesFeature(M)?(ra=ra|w.ROTATE|w.SCALE,this._editVertices=!1):"esriGeometryPoint"!==oa&&!0===this._editVertices?(ra=ra|w.ROTATE|w.SCALE,this._editVertices=!1):wa?(ra=ra|w.ROTATE|w.SCALE|w.EDIT_TEXT,this._editVertices=!1):(ra|=w.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();
this._rollbackGraphic=new t(M.toJson());oa=da.getEditCapabilities({feature:M,userId:this._settings.userIds[da.id]});var Ba=d.filter(this._settings.layerInfos,function(Ia){return Ia.featureLayer.layerId===da.layerId})[0];oa.canUpdate&&!Ba.disableGeometryUpdate&&oa.canUpdateGeometry&&(this.editToolbar.activate(ra,M),wa&&(this.editToolbar._textEditor._addTextBox(M),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(M)||
(wa=Z&&Z.screenPoint||this._findCenterPoint(M),this._showInfoWindow(wa,this._settings.map.getInfoWindowAnchor(wa)))},_createGraphic:function(M,Z){var da=new t(M,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,Z);this._activeTemplate||Z?da.attributes=Z||F.mixin({},this._activeTemplate.prototype.attributes):(da.attributes=da.attributes||[],d.forEach(this._layer.fields,function(oa){da.attributes[oa.name]=null},this));return da},_connectEvents:function(){var M=this._settings.layers;
d.forEach(M,function(Z){this._connect(Z,"onEditsComplete",F.hitch(this,"_stopEditing",Z))},this);d.forEach(M,function(Z){this._connect(Z,"onBeforeApplyEdits",F.hitch(this,function(){f.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",F.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",F.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",F.hitch(this,
"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",F.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",F.hitch(this,"_hideAttributeInspector"))},_connect:function(M,Z,da){this._eConnects.push(R.connect(M,Z,da))},_createWidgets:function(){this._selectionHelper=new L(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=
this._settings.templatePicker,f.hide(this.templatePickerDiv);else{var M=d.filter(this._settings.layers,function(Z){return Z.getEditCapabilities().canCreate});this.templatePicker=new v({"class":"esriTemplatePicker",featureLayers:M,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=R.connect(this.templatePicker,"onSelectionChange",
F.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var M=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new c({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},u.create("div")),this.attributeInspector.startup(),M.infoWindow.setContent(this.attributeInspector.domNode),M.infoWindow.setTitle(W.widgets.attributeInspector.NLS_title),
M.infoWindow.resize(350,375),X.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",F.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",F.hitch(this,function(Z){this._updateCurrentFeature(F.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(Z)}))}));this._usePopup&&M.infoWindow._setPagerCallbacks(this.attributeInspector,F.hitch(this.attributeInspector,"previous"),F.hitch(this.attributeInspector,
"next"));this._connect(this.attributeInspector,"onAttributeChange",F.hitch(this,function(Z,da,oa){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(Z,da,oa);else{var wa=Z.getLayer();(wa=d.filter(wa.fields,function(ra){return ra.name===da})[0])&&""===oa&&(oa=null);this._rollbackGraphic=new t(F.clone(Z.toJson()));this.attributeInspector._rollbackInfo={field:wa,graphic:this._rollbackGraphic};this._currentGraphic.attributes[da]="number"===typeof oa&&
isNaN(oa)?null:oa;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new ea({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:F.hitch(this,"_deleteFeature"),onApplyEdits:F.hitch(this,"_applyEdits"),onShowAttributeInspector:F.hitch(this,"_onEditFeature")},
this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new k({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",F.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",F.hitch(this,this._updateUndoRedoOperations)),
this._connect(document,"onkeypress",F.hitch(this,function(M){if(M.metaKey||M.ctrlKey)"z"===M.charOrCode&&this._undo(),"y"===M.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(M){if(M&&M.addedIds){var Z;for(Z=0;Z<this.undoManager.length;Z++){var da=this.undoManager.get(Z);da&&M.layer===da._featureLayer&&da.updateObjectIds(M.oldIds,M.addedIds)}}M&&"Update Features"===M.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=R.connect(this._settings.map,
"onClick",F.hitch(this,function(M){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(F.hitch(this,function(){this._reset();this._updateSelection(M)})))}))},_disableMapClickHandler:function(){R.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var M=this.templatePicker.getSelected();M?this._updateCurrentFeature(F.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(M)})):
(this._reset(),R.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(M){if("point"===M.geometry.type||"multipoint"===M.geometry.type){var Z=M.getLayer(),da=Z.renderer;M=M.symbol||Z._getSymbol(M);!M&&(da.hasVisualVariables("sizeInfo",!1)||da.hasVisualVariables("colorInfo",!1)||da.hasVisualVariables("opacityInfo",!1))&&da.addBreak&&da.infos&&1===da.infos.length&&(M=da.infos[0].symbol||
da.defaultSymbol);if(M&&"textsymbol"===M.type)return!0}return!1},_isTextSymbolPointLayer:function(M){return"esriGeometryPoint"===M.geometryType&&M.renderer&&M.renderer._symbols&&M.renderer._symbols[0]&&M.renderer._symbols[0].symbol&&"textsymbol"===M.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(M){M=M.getLayer();if(!M)return!1;var Z,da=!1;for(Z=0;Z<this._settings.layerInfos.length;Z++){var oa=this._settings.layerInfos[Z];if(oa.featureLayer==M){da=oa.disableAttributeUpdate;
break}}return da},_onEditFeature:function(M,Z){if(M=(F.isArray(M)?M[0]:M)||null){this._layer=M.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(M)){Z=Z||this._editClickPoint||this._findCenterPoint(M);if(1<this._currentFeatureCount){var da=this._popupFeatures.indexOf(M);da=C.substitute(W.widgets.popup.NLS_pagingInfo,{index:da+1,total:this._currentFeatureCount})}else da=this._layer?this._layer.name:W.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(da);
if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(Z,this._settings.map.getInfoWindowAnchor(Z));this._editClickPoint=null}M!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=M,M.getDojoShape()&&M.getDojoShape().moveToFront(),da=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||da&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(M))}},_applyEdits:function(M,Z){M=M||[];if(!(0>=M.length)){this._edits=
this._oEdits=M;var da=[];d.forEach(M,function(oa){oa.layer&&da.push(oa.layer.applyEdits(oa.adds,oa.updates,oa.deletes))});0<da.length&&(this._deferredsList=(new P(da)).addCallback(F.hitch(this,function(){f.hide(this.progressBar.domNode);Z&&Z();var oa=this._settings.map;oa&&oa.infoWindow.reposition&&oa.infoWindow.isShowing&&oa.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},
_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(M,Z){e.prototype.isSelfIntersecting(M)?this._settings.geometryService.simplify([M],function(da){var oa=da&&da.length?da[0]:oa;Z&&Z(oa)}):Z&&Z(M)},_autoComplete:function(M,Z){var da=this._getLayers("esriGeometryPolygon"),oa=new m;oa.geometry=M;oa.returnGeometry=!0;this._selectFeatures(da,oa,F.hitch(this,function(wa){!wa||
0>=wa.length?Z&&Z([M]):this._settings.geometryService.autoComplete(q.getGeometries(wa),this._toPolylines([oa.geometry]),function(ra){Z&&Z(ra)})}))},_getLayers:function(M){return d.filter(this._settings.layers,function(Z){return Z.geometryType===M})},_selectFeatures:function(M,Z,da,oa){this._selectionHelper.selectFeatures(M,Z,oa||y.SELECTION_NEW,da)},_updateSelection:function(M){var Z=M.mapPoint,da=M.graphic,oa=this._settings.layerInfos,wa;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,
Z,y.SELECTION_NEW,F.hitch(this,function(ra){var Ba=d.some(ra,F.hitch(this,function(Ma){return Ma==da}));if(da&&!Ba)if(Ba=da.getLayer(),this._isValidLayer(Ba)){var Ia=new m;Ia.objectIds=[da.attributes[Ba.objectIdField]];this._selectionHelper.selectFeatures([Ba],Ia,y.SELECTION_ADD,F.hitch(this,function(Ma){Ma&&Ma.length&&(Ma=Ma.concat(ra),wa=D.sortFeaturesById(oa,Ma),this._updatePopupButtons(wa),this._onEditFeature(wa,Z))}))}else ra&&ra.length?(wa=D.sortFeaturesById(oa,ra),this._updatePopupButtons(wa),
this._onEditFeature(wa,Z)):this._clearSelection();else ra&&ra.length?(wa=D.sortFeaturesById(oa,ra),this._updatePopupButtons(wa),this._onEditFeature(wa,Z)):this._clearSelection()}));da&&this._isTextSymbolPoint(da)&&this._isValidLayer(da.getLayer())&&this.editToolbar.activate(0|w.MOVE|w.ROTATE|w.SCALE|w.EDIT_TEXT,da)},_updatePopupButtons:function(M){if(this._usePopup&&M){var Z=M.length;d.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],F.hitch(this,
function(oa){1<Z?G.remove(oa,"hidden"):G.add(oa,"hidden")}));var da=1<Z?"block":"none";X.query(".esriAttributeInspector .atiLayerName").style({display:da});this._currentFeatureCount=Z;this._popupFeatures=M}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(M){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(M||!1);this._reset()},_findCenterPoint:function(M){M=M.geometry||M;switch(M.type){case "point":var Z=M;break;case "polyline":Z=
M.getPoint(0,Math.ceil(M.paths[0].length/2));break;case "polygon":Z=M.rings.length-1,Z=M.getPoint(Z,M.rings[Z].length-1)}return this._settings.map.toScreen(Z)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(M){return d.map(M,function(Z){var da=new h(Z.spatialReference);d.forEach(Z.rings,function(oa){da.addPath(oa)});return da})},_isNotesFeature:function(M){var Z=M.getLayer(),da=Z?Z.types||
null:null;if(!da)return!1;var oa=M.attributes[Z.typeIdField],wa;d.some(da,function(ra){return ra.id===oa?(wa=ra.templates,!0):!1});return wa?(M=wa[0]||null)?this._isShapeTool(M.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(M){var Z,da=this._settings.layerInfos;for(Z=0;Z<da.length;Z++){var oa=da[Z];if(M.id==(oa.featureLayer?oa.featureLayer.id:oa.layerId))return!0}return!1},_isShapeTool:function(M){switch(M){case K.TOOL_ARROW:return n.ARROW;case K.TOOL_LEFT_ARROW:return n.LEFT_ARROW;case K.TOOL_RIGHT_ARROW:return n.RIGHT_ARROW;
case K.TOOL_UP_ARROW:return n.UP_ARROW;case K.TOOL_DOWN_ARROW:return n.DOWN_ARROW;case K.TOOL_CIRCLE:return n.CIRCLE;case K.TOOL_ELLIPSE:return n.ELLIPSE;case K.TOOL_TRIANGLE:return n.TRIANGLE;case K.TOOL_RECTANGLE:return n.RECTANGLE;default:return null}},_toDrawTool:function(M,Z){var da=Z.geometryType;switch(M){case K.TOOL_POINT:return n.POINT;case K.TOOL_ARROW:return n.ARROW;case K.TOOL_LEFT_ARROW:return n.LEFT_ARROW;case K.TOOL_RIGHT_ARROW:return n.RIGHT_ARROW;case K.TOOL_UP_ARROW:return n.UP_ARROW;
case K.TOOL_DOWN_ARROW:return n.DOWN_ARROW;case K.TOOL_CIRCLE:return n.CIRCLE;case K.TOOL_ELLIPSE:return n.ELLIPSE;case K.TOOL_TRIANGLE:return n.TRIANGLE;case K.TOOL_RECTANGLE:return n.RECTANGLE;case K.TOOL_LINE:return n.POLYLINE;case K.TOOL_POLYGON:return n.POLYGON;case K.TOOL_FREEHAND:return"esriGeometryPolyline"===da?n.FREEHAND_POLYLINE:n.FREEHAND_POLYGON;default:var oa=n.POINT;"esriGeometryPolyline"===da?(oa=n.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===U.CREATE_TOOL_FREEHAND_POLYLINE&&
(oa=n.FREEHAND_POLYLINE)):"esriGeometryPolygon"===da&&(oa=n.POLYGON,this._settings.createOptions.polygonDrawTools[0]===U.CREATE_TOOL_FREEHAND_POLYGON&&(oa=n.FREEHAND_POLYGON));return oa}},_isModified:function(){var M=this.editToolbar.getCurrentState();return(M.isModified||this._attributeChanged)&&M.graphic?M.graphic:null},_showInfoWindow:function(M,Z){this._customAttributeInspector||this._settings.map.infoWindow.show(M,Z)}});F.mixin(U,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});F.setObject("dijit.editing.Editor",U,b);return U})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),
function(O,F,d,R,X,ba){O=O([ba],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(V){V=V||{};V.maxOperations&&(this.maxOperations=V.maxOperations);this._historyStack=[]},add:function(V){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,V);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var V=this.peekUndo();this.position--;V?(V=V.performUndo(),this.onUndo(),this._checkAvailability(),R(V).then(F.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var V=this.peekRedo();this.position++;V?(V=V.performRedo(),this.onRedo(),this._checkAvailability(),R(V).then(F.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(V){return this._historyStack[V]},remove:function(V){0<this._historyStack.length&&(this._historyStack.splice(V,1),0<this.position&&V<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});return X.UndoManager=O})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(O,F,d){O=O(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(R){R=R||{};R.label&&(this.label=R.label)},performUndo:function(){},performRedo:function(){}});return d.OperationBase=O})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y){var K=F(x,{declaredClass:"esri.toolbars.Edit",constructor:function(n,w){this._map=n;this._tool=0;if(this._map.loaded)this._scratchGL=n.graphics;else var c=R.connect(this._map,"onLoad",this,function(){R.disconnect(c);c=null;this._scratchGL=this._map.graphics});var D=V("esri-mobile");this._defaultOptions=d.mixin({vertexSymbol:new t(t.STYLE_CIRCLE,D?20:12,new k(k.STYLE_SOLID,new ba([0,0,0,.5]),1),new ba([128,128,128])),ghostVertexSymbol:new t(t.STYLE_CIRCLE,
D?18:10,new k(k.STYLE_SOLID,new ba([0,0,0,.5]),1),new ba([255,255,255,.75])),ghostLineSymbol:new k(k.STYLE_DOT,new ba([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:D?24:16,boxLineSymbol:new k(k.STYLE_DASH,new ba([64,64,64]),1),boxHandleSymbol:new t(t.STYLE_SQUARE,D?16:9,new k(k.STYLE_SOLID,new ba([0,0,0,.5]),1),new ba([255,255,255,.75])),textAnchorSymbol:new t(t.STYLE_CIRCLE,10,null,new ba([255,0,0]))},w||{})},activate:function(n,w,c){this.deactivate();this._graphic=
w;this._options=d.mixin(d.mixin({},this._defaultOptions),c||{});var D=K.MOVE;c=K.EDIT_VERTICES;var E=K.SCALE,J=K.ROTATE,A=K.EDIT_TEXT,S=!1,H=!1,ea=!1,L=this._map,v=L.spatialReference,b=w.geometry.spatialReference;this._geo=!(!v||!b||v.equals(b)||!v.isWebMercator()||4326!==b.wkid);this._isTextPoint=this._prepareTextSymbolEditing(w,n);(n&D)===D&&(S=this._enableMove(w));D=(n&E)===E;J=(n&J)===J;if(D||J)ea=this._enableBoxEditing(w,D,J);(n&c)===c&&(H=this._enableVertexEditing(w));(n&A)===A&&this._enableTextEditing(w);
if(!(S||H||ea))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=n)this._mapPanEndHandle=R.connect(L,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=R.connect(L,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,w);L.snappingManager&&(S||H)&&L.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var n=this._tool,w=this._graphic;
if(n){var c=!!this._modified;this._clear();R.disconnect(this._mapPanEndHandle);R.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(n,w,{isModified:c});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(n,w){},onDeactivate:function(n,
w,c){},onGraphicMoveStart:function(n){},onGraphicFirstMove:function(n){this._modified=!0},onGraphicMove:function(n,w){},onGraphicMoveStop:function(n,w){},onGraphicClick:function(n,w){},onVertexMoveStart:function(n,w){},onVertexFirstMove:function(n,w){this._modified=!0},onVertexMove:function(n,w,c){},onVertexMoveStop:function(n,w,c){},onVertexAdd:function(n,w){this._modified=!0},onVertexClick:function(n,w){},onVertexMouseOver:function(n,w){},onVertexMouseOut:function(n,w){},onVertexDelete:function(n,
w){this._modified=!0},onTextEditStart:function(n,w){},onTextEditEnd:function(n){},onScaleStart:function(n){},onScaleFirstMove:function(n){this._modified=!0},onScale:function(n,w){},onScaleStop:function(n,w){},onRotateStart:function(n){},onRotateFirstMove:function(n){this._modified=!0},onRotate:function(n,w){},onRotateStop:function(n,w){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(n,w){if("point"===n.geometry.type||"multipoint"===n.geometry.type){var c=n.getLayer(),D=c.renderer;c=n.symbol||c._getSymbol(n);!c&&(D.hasVisualVariables("sizeInfo",!1)||D.hasVisualVariables("colorInfo",!1)||D.hasVisualVariables("opacityInfo",!1))&&D.addBreak&&
D.infos&&1===D.infos.length&&(c=D.infos[0].symbol||D.defaultSymbol);if(c&&"textsymbol"===c.type){if((w&K.SCALE)===K.SCALE||(w&K.ROTATE)===K.ROTATE||(w&K.EDIT_TEXT)===K.EDIT_TEXT){n.setSymbol(new m(c.toJson()));var E=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(n),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})):
O(["../dijit/SymbolEditor"],function(J){if(!E._textSymbolEditor){var A=E._options.textSymbolEditorHolder?P.create("div",null,E._options.textSymbolEditorHolder):P.create("div",null,E._map.root);E._textSymbolEditor=new J({graphic:n},A);J=E._textSymbolEditor.domNode.parentNode.id;G.set(E._textSymbolEditor.domNode,{position:"map_root"===J?"absolute":"relative",left:"map_root"===J?E._map.width/2-100+"px":"5px",top:"20px","z-index":50});E._textSymbolEditor.startup();E._textSymbolEditor.createForm(n);E._textSymbolEditor.show();
E._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})}})}if((w&K.MOVE)===K.MOVE||(w&K.ROTATE)===K.ROTATE||(w&K.SCALE)===K.SCALE)this._textAnchor=new y(n.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(n){var w=this._map;switch(n.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new q(n,w,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(n){var w=
this._map;switch(n.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=h.create(n,w,this),!0}return!1},_enableBoxEditing:function(n,w,c){var D=this._map,E=n.geometry.type;return"polyline"===E||"polygon"===E||this._isTextPoint?(this._boxEditor=new f(n,D,this,w,c,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(n){return this._isTextPoint?(this._textEditor=new e(n,this._map,this),R.connect(this._textEditor,"onEditStart",d.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var n=this._graphicMover;n&&(n.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var n=this._vertexEditor;n&&(n.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var n=this._boxEditor;n&&(n.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(n,w,c){c&&this._refreshMoveables()},_refreshMoveables:function(n){var w=X.filter([this._graphicMover,this._vertexEditor,this._boxEditor],C.isDefined);X.forEach(w,function(c){c.refresh(n)})},_beginOperation:function(n){X.forEach(this._getAffectedTools(n),function(w){w.suspend()})},_endOperation:function(n){X.forEach(this._getAffectedTools(n),function(w){w.resume()})},_getAffectedTools:function(n){var w=[];switch(n){case "MOVE":w=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":w=[this._boxEditor];break;case "BOX":w=[this._vertexEditor]}return w=X.filter(w,C.isDefined)}});d.mixin(K,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});d.setObject("toolbars.Edit",K,u);return K})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e){O=O(null,{declaredClass:"esri.toolbars._Box",constructor:function(t,k,m,y,K,n,w){this._graphic=t;this._map=k;this._toolbar=m;this._scale=y;this._rotate=K;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=n;t=m._options;this._markerSymbol=t.boxHandleSymbol;this._lineSymbol=t.boxLineSymbol;this._moveStartHandler=F.hitch(this,this._moveStartHandler);this._firstMoveHandler=F.hitch(this,this._firstMoveHandler);
this._moveStopHandler=F.hitch(this,this._moveStopHandler);this._moveHandler=F.hitch(this,this._moveHandler);this._isTextPoint=w;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){d.forEach(this._getAllGraphics(),function(t){t.hide()})},resume:function(){d.forEach(this._getAllGraphics(),function(t){t.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
d.forEach(this._connects,R.disconnect);var t=this._toolbar._scratchGL;this._anchors&&d.forEach(this._anchors,function(k){t.remove(k.graphic);(k=k.moveable)&&k.destroy()});this._box&&t.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var t=this._map,k=this._toolbar._scratchGL,m=this._getBoxCoords(),y=new x(t.spatialReference),K=F.clone(d.filter(m,function(n,w){return 8!==w&&0===w%2}));K[0]&&K.push([K[0][0],K[0][1]]);y.addPath(K);this._rotate&&
y.addPath([m[1],m[8]]);this._box?this._box.setGeometry(y):(this._box=new e(y,this._lineSymbol),k.add(this._box));this._anchors?d.forEach(this._anchors,function(n,w){this._scale||(w=8);var c=new z(m[w],t.spatialReference);n.graphic.setGeometry(c);c=n.moveable;var D=n.graphic.getDojoShape();D&&(c?D!==c.shape&&(c.destroy(),n.moveable=this._getMoveable(n.graphic,w)):n.moveable=this._getMoveable(n.graphic,w))},this):(this._anchors=[],this._connects=[],d.forEach(m,function(n,w){if(this._scale||!(8>w)){n=
new z(n,t.spatialReference);var c=new e(n,this._markerSymbol);this._isTextPoint&&1===w%2&&c.hide();k.add(c);this._anchors.push({graphic:c,moveable:this._getMoveable(c,w)})}},this))}else this._cleanUp()},_getBoxCoords:function(t){var k=this._map,m=[],y,K,n;if(this._isTextPoint){var w=this._graphic.getNode().getBoundingClientRect();var c=k.__container.getBoundingClientRect();w=[{x:w.left-c.left,y:w.top-c.top},{x:w.right-c.left,y:w.top-c.top},{x:w.right-c.left,y:w.bottom-c.top},{x:w.left-c.left,y:w.bottom-
c.top}]}else w=this._getTransformedBoundingBox(this._graphic);d.forEach(w,function(D,E,J){y=D;(K=J[E+1])||(K=J[0]);n={x:(y.x+K.x)/2,y:(y.y+K.y)/2};t||(y=k.toMap(y),n=k.toMap(n));m.push([y.x,y.y]);m.push([n.x,n.y])});this._rotate&&(w=F.clone(m[1]),w=t?{x:w[0],y:w[1]}:k.toScreen({x:w[0],y:w[1],spatialReference:k.spatialReference}),w.y-=this._toolbar._options.rotateHandleOffset,t||(w=k.toMap(w)),m.push([w.x,w.y]));return m},_getTransformedBoundingBox:function(t){var k=this._map,m=t.geometry.getExtent(),
y=t.geometry.spatialReference;t=new z(m.xmin,m.ymax,y);m=new z(m.xmax,m.ymin,y);t=k.toScreen(t);m=k.toScreen(m);return[{x:t.x,y:t.y},{x:m.x,y:t.y},{x:m.x,y:m.y},{x:t.x,y:m.y}]},_getAllGraphics:function(){var t=[this._box];this._anchors&&d.forEach(this._anchors,function(k){t.push(k.graphic)});return t=d.filter(t,C.isDefined)},_getMoveable:function(t,k){var m=t.getDojoShape();if(m){var y=new P(m);y._index=k;this._connects.push(R.connect(y,"onMoveStart",this._moveStartHandler));this._connects.push(R.connect(y,
"onFirstMove",this._firstMoveHandler));this._connects.push(R.connect(y,"onMoveStop",this._moveStopHandler));y.onMove=this._moveHandler;(m=m.getEventSource())&&V.set(m,"cursor",this._toolbar._cursors["box"+k]);return y}},_moveStartHandler:function(t){this._toolbar["on"+(8===t.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(t){this._toolbar._deactivateScrollWheel();var k=t.host._index,m=this._wrapOffset=t.host.shape._wrapOffsets[0]||0,y=this._graphic.getLayer().getNavigationTransform();
t=d.map(this._getBoxCoords(!0),function(n){return{x:n[0]+m,y:n[1]}});var K=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:t[1].x,y:t[3].y};this._centerCoord=G.multiplyPoint(G.invert(y),K);if(8===k)K=G.multiplyPoint(G.invert(y),t[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,K)),this._startLine=[this._centerCoord,K],this._moveLine=F.clone(this._startLine);else if(K=G.multiplyPoint(G.invert(y),t[k]),y=G.multiplyPoint(G.invert(y),t[(k+4)%8]),this._isTextPoint&&
(this._centerCoord=this._deNormalizePoint(this._centerCoord,K)),this._firstMoverToAnchor=Math.sqrt((K.x-this._centerCoord.x)*(K.x-this._centerCoord.x)+(K.y-this._centerCoord.y)*(K.y-this._centerCoord.y)),this._startBox=y,this._startBox.width=t[4].x-t[0].x,this._startBox.height=t[4].y-t[0].y,this._moveBox=F.clone(this._startBox),this._xfactor=K.x>y.x?1:-1,this._yfactor=K.y>y.y?1:-1,1===k||5===k)this._xfactor=0;else if(3===k||7===k)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+
(8===k?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(t,k){var m=t.host._index,y=this._defaultEventArgs,K;y.angle=0;y.scaleX=1;y.scaleY=1;if(8===m){var n=this._startLine;var w=this._moveLine;var c=w[1];c.x+=k.dx;c.y+=k.dy;c=this._getAngle(n,w);this._isTextPoint&&(c+=this._graphic.symbol.angle);w=G.rotategAt(c,n[0]);this._graphic.getDojoShape().setTransform(w);y.transform=w;y.angle=c;y.around=n[0]}else{n=this._startBox;w=this._moveBox;w.width+=k.dx*this._xfactor;
w.height+=k.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(n=w.x+this._xfactor*w.width,w=w.y+this._yfactor*w.height,n=Math.sqrt((n-this._centerCoord.x)*(n-this._centerCoord.x)+(w-this._centerCoord.y)*(w-this._centerCoord.y)),this._scaleRatio=c=K=n/this._firstMoverToAnchor,n=this._centerCoord):(c=w.width/n.width,K=w.height/n.height,n={x:n.x,y:n.y});if(isNaN(c)||Infinity===c||-Infinity===c)c=1;if(isNaN(K)||Infinity===K||-Infinity===K)K=1;w=G.scaleAt(c,K,n);if(this._isTextPoint){var D=G.rotategAt(this._graphic.symbol.angle,
n);this._graphic.getDojoShape().setTransform([D,w])}else this._graphic.getDojoShape().setTransform(w);y.transform=w;y.scaleX=c;y.scaleY=K;y.around=n}this._toolbar["on"+(8===m?this._rotateEvent:this._scaleEvent)](this._graphic,y)},_moveStopHandler:function(t){this._toolbar._activateScrollWheel();var k=this._graphic,m=this._toolbar,y=m._geo?q.geographicToWebMercator(k.geometry):k.geometry,K=y.spatialReference,n=k.getDojoShape(),w=n.getTransform(),c=k.getLayer().getNavigationTransform();this._isTextPoint?
(k=this._graphic.symbol,8===t.host._index?k.angle+=this._getAngle(this._startLine,this._moveLine):k.font.setSize(Math.round(k.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(k)):(y=y.toJson(),this._updateSegments(y.paths||y.rings,w,c,K),n.setTransform(null),y=h.fromJson(y),k.setGeometry(m._geo?q.webMercatorToGeographic(y,!0):y));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;m._endOperation("BOX");this._defaultEventArgs.transform=
w;m["on"+(8===t.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(t,k,m,y){var K=this._map,n=this._wrapOffset||0;d.forEach(t,function(w){d.forEach(w,function(c){this._updatePoint(c,y,n,G,K,m,k)},this)},this)},_updatePoint:function(t,k,m,y,K,n,w){k=K.toScreen({x:t[0],y:t[1],spatialReference:k},!0);k.x+=m;k=y.multiplyPoint([n,w,y.invert(n)],k);k.x-=m;m=K.toMap(k);t[0]=m.x;t[1]=m.y},_getAngle:function(t,k){return 180*Math.atan2(k[0].y-
k[1].y,k[0].x-k[1].x)/Math.PI-180*Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x)/Math.PI},_deNormalizePoint:function(t,k){var m=this._map._getFrameWidth();if(-1===m)return t;for(var y={x:t.x,y:t.y};Math.abs(y.x-k.x)>=m;)y.x=y.x<k.x?y.x+m:y.x-m;var K=Math.abs(y.x-k.x);Math.abs(y.x-k.x+m)<K?y.x+=m:Math.abs(y.x-k.x-m)<K&&(y.x-=m);return y}});F.setObject("toolbars._Box",O,u);return O})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(O,F,d,R,X,ba,V,P,G,u){return F("dojox.gfx.Moveable",null,{constructor:function(C,z){this.shape=C;this.delay=z&&0<z.delay?z.delay:0;this.mover=z&&z.mover?z.mover:G;this.leftButtonOnly=z&&z.leftButtonOnly;this.events=[this.shape.on(ba.press,O.hitch(this,"onMouseDown"))]},destroy:function(){d.forEach(this.events,function(C){C.remove()});this.events=this.shape=null},onMouseDown:function(C){this.delay?(this.events.push(this.shape.on(ba.move,O.hitch(this,"onMouseMove")),this.shape.on(ba.release,
O.hitch(this,"onMouseUp"))),this._lastX=C.clientX,this._lastY=C.clientY):this.leftButtonOnly&&!u.isLeft(C)||new this.mover(this.shape,C,this);R.stop(C)},onMouseMove:function(C){var z=C.clientY;if(Math.abs(C.clientX-this._lastX)>this.delay||Math.abs(z-this._lastY)>this.delay)this.onMouseUp(C),new this.mover(this.shape,C,this);R.stop(C)},onMouseUp:function(C){this.events.pop().remove()},onMoveStart:function(C){X.publish("/gfx/move/start",C);V.add(P.body(),"dojoMove")},onMoveStop:function(C){X.publish("/gfx/move/stop",
C);V.remove(P.body(),"dojoMove")},onFirstMove:function(C){},onMove:function(C,z,x){this.onMoving(C,z,x);this.shape.applyLeftTransform(z);this.onMoved(C,z)},onMoving:function(C,z){},onMoved:function(C,z){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(O,F,d,R,X,ba){return d("dojox.gfx.Mover",null,{constructor:function(V,P,G){this.shape=V;this.lastX=P.clientX;this.lastY=P.clientY;V=this.host=G;P=
document;G=R(P,X.move,O.hitch(this,"onFirstMove"));this.events=[R(P,X.move,O.hitch(this,"onMouseMove")),R(P,X.release,O.hitch(this,"destroy")),R(P,"dragstart",O.hitch(ba,"stop")),R(P,"selectstart",O.hitch(ba,"stop")),G];if(V&&V.onMoveStart)V.onMoveStart(this)},onMouseMove:function(V){var P=V.clientX,G=V.clientY;this.host.onMove(this,{dx:P-this.lastX,dy:G-this.lastY},V);this.lastX=P;this.lastY=G;ba.stop(V)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){F.forEach(this.events,
function(P){P.remove()});var V=this.host;if(V&&V.onMoveStop)V.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f){var q=O(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(h,e,t,k){this.graphic=h;this.map=e;this.toolbar=t;this.tempPt=k;this._enableGraphicMover();this._moved=!1},refresh:function(h){var e=this.graphic.getDojoShape();!e||!h&&e._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var h=this.graphic,e=h.getDojoShape();e&&(e._hostGraphic=h,this._moveable=new ba(e,{mover:q.Mover}),this._moveStartHandle=
d.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=d.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=d.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=d.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(h=e.getEventSource())&&X.set(h,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var h=this._moveable;if(h){d.disconnect(this._moveStartHandle);d.disconnect(this._firstMoveHandle);
d.disconnect(this._movingHandle);d.disconnect(this._moveStopHandle);var e=h.shape;e&&(e._hostGraphic=null,(e=e.getEventSource())&&X.set(e,"cursor","inherit"));h.destroy()}this._moveable=null},_moveStartHandler:function(){var h=this.graphic,e=this.map;this._startTx=h.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&e.snappingManager&&e.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(h)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(h,e,t){h=h.shape.getTransform();e=this.map;var k;C("esri-pointer")?k=e.navigationManager.pointerEvents._processTouchEvent(t,t):t&&"pointermove"===t.type&&(k=u.prototype._processTouchEvent.call({map:e},t,t));k&&e.snappingManager&&e.snappingManager._onSnappingMouseMoveHandler(k);this.tempPt&&this.tempPt.getDojoShape().setTransform(h);this.toolbar.onGraphicMove(this.graphic,h)},_moveStopHandler:function(h){var e=this.graphic,t=this.toolbar,k=this.map,m=t._geo?z.geographicToWebMercator(e.geometry):
e.geometry,y=m.type,K=e.getDojoShape(),n=K.getTransform();if(R.toJson(n)!==R.toJson(this._startTx)){this._moved=!0;switch(y){case "point":y=[n,P.invert(this._startTx)];if(k.snappingManager)var w=k.snappingManager._snappingPoint;m=w||k.toMap(P.multiplyPoint(y,k.toScreen(m,!0)));k.snappingManager&&k.snappingManager._killOffSnapping();break;case "polyline":m=this._updatePolyGeometry(m,m.paths,n);break;case "polygon":m=this._updatePolyGeometry(m,m.rings,n)}K.setTransform(null);e.setGeometry(t._geo?z.webMercatorToGeographic(m,
!0):m);this.tempPt&&this.tempPt.setGeometry(new f(e.geometry.toJson()))}else this._moved=!1;t._endOperation("MOVE");t.onGraphicMoveStop(e,n);this._moved||(h=h.__e,k=this.map.position,h=new x(h.pageX-k.x,h.pageY-k.y),t.onGraphicClick(e,{screenPoint:h,mapPoint:this.map.toMap(h)}))},_updatePolyGeometry:function(h,e,t){var k=this.map,m=h.getPoint(0,0);k=k.toMap(k.toScreen(m).offset(t.dx,t.dy));t=k.x-m.x;m=k.y-m.y;var y;for(k=0;k<e.length;k++){var K=e[k];for(y=0;y<K.length;y++){var n=h.getPoint(k,y);h.setPoint(k,
y,n.offset(t,m))}}return h}});q.Mover=O(V,{declaredClass:"esri.toolbars._Mover",constructor:function(h,e,t){this.__e=e}});F.setObject("toolbars._GraphicMover",q,G);F.setObject("toolbars._Mover",q.Mover,G);return q})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(O,F,d,R,X,ba,V,P,G,u,
C,z){var x=O(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(f,q,h){this.graphic=f;this.map=q;this.toolbar=h;f=h._options;this._symbol1=f.vertexSymbol;this._symbol2=f.ghostVertexSymbol;q=f.ghostLineSymbol;this._lineStroke={style:q.style,width:q.width,color:q.color};this._canDel=f.allowDeleteVertices;this._canAdd=f.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(f){f?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=d.connect(G,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=d.connect(G,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var f=this._getGraphicsLayer();this._mouseOverHandle=d.connect(f,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=d.connect(f,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new ba({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),f=this._ctxDelete=new V({label:z.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
d.connect(f,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(f),this._ctxMenu.startup())},_removeControllers:function(){d.disconnect(this._firstMoveHandle);d.disconnect(this._moveStopHandle);d.disconnect(this._mouseOverHandle);d.disconnect(this._mouseOutHandle);d.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(f,q,h){var e,t,k=this.graphic,m=[];for(e=0;e<f.length;e++){var y=f[e],K=[];for(t=0;t<y.length;t++)K.push(new G(y[t],q,k,e,t,y.length,this,h));m.push(K)}return m},_remove:function(f){f&&R.forEach(f,function(q){R.forEach(q,function(h){h.destroy()})})},_refresh:function(f){f&&R.forEach(f,function(q){R.forEach(q,function(h){h.refresh()})})},_isNew:function(f){return-1===R.indexOf(this._vertexMovers[f.segIndex],f)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(f){f=this._selectedMover;this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(f);this._deleteVertex(f);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(f){f=f.graphic;var q=this._findMover(f);q&&(this.toolbar.onVertexMouseOver(this.graphic,q._getInfo()),q._placeholder||(this._selectedMover=q,this._canDel&&this._bindCtxNode(f.getDojoShape().getNode())))},_mouseOutHandler:function(f){if(f=
this._findMover(f.graphic))this.toolbar.onVertexMouseOut(this.graphic,f._getInfo())},_bindCtxNode:function(f){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(f);this._bindNode=f},_unbindCtxNode:function(){var f=this._bindNode;f&&this._ctxMenu.unBindDomNode(f)},_findMover:function(f){var q=[];var h=this._mpVertexMovers;R.forEach(this._vertexMovers,function(t){q=q.concat(t)});h&&R.forEach(h,function(t){q=q.concat(t)});
for(h=0;h<q.length;h++){var e=q[h];if(e.graphic===f)return e}},_firstMoveHandler:function(f){!this._isNew(f)&&this._canAdd&&this._hideRelatedMidpoints(f);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(f,q){var h=this._isNew(f);q&&(q.dx||q.dy)?(this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength,h),this._canAdd&&(h?this._addMidpoints(f):(this._repositionRelatedMidpoints(f),this._showRelatedMidpoints(f))),this.toolbar._endOperation("VERTICES")):
!h&&this._canAdd&&this._showRelatedMidpoints(f)},_showRelatedMidpoints:function(f){var q=this._getAdjacentMidpoints(f.ptIndex,f.segLength),h=this._mpVertexMovers[f.segIndex];for(f=0;f<q.length;f++){var e=h[q[f]];e.graphic.show();e.refresh()}},_hideRelatedMidpoints:function(f){var q=this._getAdjacentMidpoints(f.ptIndex,f.segLength),h=this._mpVertexMovers[f.segIndex];for(f=0;f<q.length;f++)h[q[f]].graphic.hide()},_repositionRelatedMidpoints:function(f){var q,h=this._getAdjacentMidpoints(f.ptIndex,f.segLength),
e=this._mpVertexMovers[f.segIndex];for(q=0;q<h.length;q++){var t=this._getAdjacentVertices(h[q],f.segLength),k=f.relatedGraphic.geometry.getPoint(f.segIndex,t[0]);t=f.relatedGraphic.geometry.getPoint(f.segIndex,t[1]);k=new u({x:(k.x+t.x)/2,y:(k.y+t.y)/2,spatialReference:k.spatialReference.toJson()});e[h[q]].graphic.setGeometry(k)}},_addMidpoints:function(f){var q=f.segIndex,h=f.ptIndex,e=f.segLength,t=h+1,k,m=e+1;this._mpVertexMovers[q].splice(h,1);var y=this._vertexMovers[q];for(k=0;k<t;k++)y[k].segLength+=
1;for(k=t;k<y.length;k++)y[k].ptIndex+=1,y[k].segLength+=1;f.ptIndex=t;f.segLength=y.length+1;y.splice(t,0,f);f.graphic.setSymbol(this._symbol1);y=this._mpVertexMovers[q];for(k=0;k<h;k++)y[k].segLength+=1;for(k=h;k<e-1;k++)y[k].ptIndex+=1,y[k].segLength+=1;t=this._getAdjacentVertices(h,m);q=this._getAdjacentVertices(h+1,m);e=f.relatedGraphic.geometry.getPoint(f.segIndex,t[0]);k=f.relatedGraphic.geometry.getPoint(f.segIndex,t[1]);t=new u({x:(e.x+k.x)/2,y:(e.y+k.y)/2,spatialReference:e.spatialReference.toJson()});
e=f.relatedGraphic.geometry.getPoint(f.segIndex,q[0]);k=f.relatedGraphic.geometry.getPoint(f.segIndex,q[1]);q=new u({x:(e.x+k.x)/2,y:(e.y+k.y)/2,spatialReference:e.spatialReference.toJson()});e=new G(t,this._symbol2,this.graphic,f.segIndex,h,m,this,!0);f=new G(q,this._symbol2,this.graphic,f.segIndex,h+1,m,this,!0);y.splice(h,0,e,f)},_deleteVertex:function(f){var q,h=f.ptIndex,e=this._vertexMovers[f.segIndex];for(q=0;q<h;q++)--e[q].segLength;for(q=h+1;q<e.length;q++){var t=e[q];--t.ptIndex;--t.segLength}e.splice(h,
1);q=f._getInfo();f.destroy();this.toolbar.onVertexDelete(this.graphic,q)}});F.mixin(x,{create:function(f,q,h){switch(f.geometry.type){case "multipoint":return new x.MultipointVertexEditor(f,q,h);case "polyline":return new x.PolylineVertexEditor(f,q,h);case "polygon":return new x.PolygonVertexEditor(f,q,h)}}});x.MultipointVertexEditor=O(x,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=d.connect(G,"onMoveStart",this,this._moveStartHandler);
d.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);d.disconnect(this._moveStartHandle)},_getSegments:function(f){var q=f.points,h=[],e=f.spatialReference;for(f=0;f<q.length;f++){var t=q[f];h.push(new u({x:t[0],y:t[1],spatialReference:e.toJson()}))}return[h]},_getMidpointSegments:function(f){return[]},_getControlPoints:function(f,q,h,e,t){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(f){var q=f.graphic;if(f=this._findMover(f))this.toolbar.onVertexMouseOver(q,
f._getInfo()),this._selectedMover=f,this._canDel&&this._bindCtxNode(f.graphic.getDojoShape().getNode())},_mouseOutHandler:function(f){var q=f.graphic;if(f=this._findMover(f))this.toolbar.onVertexMouseOut(q,f._getInfo())},_findMover:function(f){var q=[].concat(this._vertexMovers[0]),h=f.target;for(f=0;f<q.length;f++){var e=q[f];if(e.graphic.getDojoShape().getNode()===h)return e}},_moveStartHandler:function(f){var q=f.ptIndex,h=f.segLength-1,e=f.relatedGraphic.geometry.points;f=e.splice(q,1);e.push(f[0]);
e=this._vertexMovers[0];for(f=h;f>q;f--)--e[f].ptIndex;f=e.splice(q,1);e.push(f[0]);f[0].ptIndex=h},_moveStopHandler:function(f){this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(f,q,h,e,t,k,m,y){f=q.geometry;y?f.removePoint(t):f.setPoint(t,h);q.setGeometry(f)},_deleteMidpoints:function(f){}});x.PolylineVertexEditor=O(x,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(f){var q,h,e=f.paths,t=[];for(q=0;q<e.length;q++){var k=e[q],m=[];for(h=0;h<k.length;h++)m.push(f.getPoint(q,h));t.push(m)}return t},_getMidpointSegments:function(f){var q,h,e=f.paths,t=[],k=f.spatialReference;for(q=0;q<e.length;q++){var m=e[q],y=[];for(h=0;h<m.length-1;h++){var K=f.getPoint(q,h),n=f.getPoint(q,h+1);K=new u({x:(K.x+n.x)/2,y:(K.y+n.y)/2,spatialReference:k.toJson()});y.push(K)}t.push(y)}return t},_getControlPoints:function(f,q,h,e,t){var k=this.map,m,y;this._isNew(f)?
(f=e,e+=1,0<=f&&(m=k.toScreen(q.getPoint(h,f))),e<=t&&(y=k.toScreen(q.getPoint(h,e)))):(f=e-1,e+=1,0<=f&&(m=k.toScreen(q.getPoint(h,f))),e<t&&(y=k.toScreen(q.getPoint(h,e))));return[m,y]},_getAdjacentMidpoints:function(f,q){var h=[],e=f-1;0<=e&&h.push(e);f<q-1&&h.push(f);return h},_getAdjacentVertices:function(f,q){return[f,f+1]},_deleteMidpoints:function(f){var q=this._mpVertexMovers[f.segIndex],h=q.length-1,e=this._getAdjacentMidpoints(f.ptIndex,f.segLength).sort(),t,k=e[0];for(t=0;t<k;t++)--q[t].segLength;
for(t=k+1;t<q.length;t++){var m=q[t];--m.ptIndex;--m.segLength}if(1===e.length)q.splice(k,1)[0].destroy();else for(m=this._getAdjacentVertices(k,h),t=f.relatedGraphic.geometry.getPoint(f.segIndex,m[0]),m=f.relatedGraphic.geometry.getPoint(f.segIndex,m[1]),t=new u({x:(t.x+m.x)/2,y:(t.y+m.y)/2,spatialReference:t.spatialReference.toJson()}),f=new G(t,this._symbol2,this.graphic,f.segIndex,k,h,this,!0),q=q.splice(k,e.length,f),t=0;t<q.length;t++)q[t].destroy()},_updateRelatedGraphic:function(f,q,h,e,t,
k,m,y){f=q.geometry;m?f.insertPoint(e,t+1,C.fromJson(h.toJson())):y?f.removePoint(e,t):f.setPoint(e,t,C.fromJson(h.toJson()));q.setGeometry(f)}});x.PolygonVertexEditor=O(x,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(f){var q,h,e=f.rings,t=[];for(q=0;q<e.length;q++){var k=e[q],m=[];for(h=0;h<k.length-1;h++)m.push(f.getPoint(q,h));t.push(m)}return t},_getMidpointSegments:function(f){var q,h,e=f.rings,t=[],k=f.spatialReference;for(q=0;q<e.length;q++){var m=e[q],
y=[];for(h=0;h<m.length-1;h++){var K=f.getPoint(q,h),n=f.getPoint(q,h+1);K=new u({x:(K.x+n.x)/2,y:(K.y+n.y)/2,spatialReference:k.toJson()});y.push(K)}t.push(y)}return t},_getControlPoints:function(f,q,h,e,t){var k=this.map;this._isNew(f)?f=e:(f=e-1,f=0>f?(t+f)%t:f);e=(e+1)%t;t=k.toScreen(q.getPoint(h,f));q=k.toScreen(q.getPoint(h,e));return[t,q]},_getAdjacentMidpoints:function(f,q){var h=f-1;return[0>h?(q+h)%q:h,f]},_getAdjacentVertices:function(f,q){return[f,(f+1)%q]},_deleteMidpoints:function(f){var q=
f.ptIndex,h=this._mpVertexMovers[f.segIndex],e=h.length-1,t=this._getAdjacentMidpoints(q,f.segLength).sort();var k=t[0];var m=t[t.length-1];if(0===q){var y=this._getAdjacentVertices(e-1,e);q=f.relatedGraphic.geometry.getPoint(f.segIndex,y[0]);y=f.relatedGraphic.geometry.getPoint(f.segIndex,y[1]);q=new u({x:(q.x+y.x)/2,y:(q.y+y.y)/2,spatialReference:q.spatialReference.toJson()});f=new G(q,this._symbol2,this.graphic,f.segIndex,e-1,e,this,!0);h.splice(m,1,f)[0].destroy();h.splice(k,1)[0].destroy();for(t=
0;t<h.length-1;t++)k=h[t],--k.ptIndex,--k.segLength}else{y=this._getAdjacentVertices(k,e);q=f.relatedGraphic.geometry.getPoint(f.segIndex,y[0]);y=f.relatedGraphic.geometry.getPoint(f.segIndex,y[1]);q=new u({x:(q.x+y.x)/2,y:(q.y+y.y)/2,spatialReference:q.spatialReference.toJson()});f=new G(q,this._symbol2,this.graphic,f.segIndex,k,e,this,!0);m=h.splice(k,t.length,f);for(t=0;t<m.length;t++)m[t].destroy();for(t=0;t<k;t++)--h[t].segLength;for(t=k+1;t<h.length;t++)k=h[t],--k.ptIndex,--k.segLength}},_updateRelatedGraphic:function(f,
q,h,e,t,k,m,y){f=q.geometry;m?f.insertPoint(e,t+1,C.fromJson(h.toJson())):y?(f.removePoint(e,t),0===t&&f.setPoint(e,k-1,C.fromJson(f.getPoint(e,0).toJson()))):(f.setPoint(e,t,C.fromJson(h.toJson())),0===t&&f.setPoint(e,k,C.fromJson(h.toJson())));q.setGeometry(f)}});F.setObject("toolbars._GraphicVertexEditor",x,P);F.setObject("toolbars._MultipointVertexEditor",x.MultipointVertexEditor,P);F.setObject("toolbars._PolylineVertexEditor",x.PolylineVertexEditor,P);F.setObject("toolbars._PolygonVertexEditor",
x.PolygonVertexEditor,P);return x})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x){O=O(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(f,q,h,e,t,k,m,y){this.point=f;this.symbol=q;this.relatedGraphic=h;this.segIndex=e;this.ptIndex=
t;this.segLength=k;this.editor=m;this.map=m.map;this._scratchGL=m.toolbar._scratchGL;this._placeholder=y||!1;this._type=h.geometry.type;this._init();this._enable()},refresh:function(f){if(f||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var f=new C(this.point.toJson());
f=new z(f,this.symbol);switch(this._type){case "multipoint":f._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(f)}this.graphic=f},_enable:function(){var f=this.graphic.getDojoShape();f&&(f._hasMover=!0,this._moveable=this._getMoveable(f),(f=f.getEventSource())&&X.set(f,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var f=this._moveable;if(f){d.disconnect(this._startHandle);
d.disconnect(this._firstHandle);d.disconnect(this._movingHandle);d.disconnect(this._stopHandle);var q=f.shape;q&&(q=q.getEventSource())&&X.set(q,"cursor","inherit");f.destroy();this._moveable=null}},_needRefresh:function(){var f=this.graphic.getDojoShape(),q=!1;if(f)switch(this._type){case "multipoint":var h=this.relatedGraphic.getDojoShape();h&&(h=h.children[this.ptIndex],f!==h&&(this.graphic._shape=h,q=!0));break;case "polyline":case "polygon":q=!f._hasMover}return q},_getMoveable:function(f){f=
new ba(f,R("mac")&&R("ff")&&!u("esri-touch")&&{leftButtonOnly:!0});this._startHandle=d.connect(f,"onMoveStart",this,this._moveStartHandler);this._firstHandle=d.connect(f,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=d.connect(f,"onMoving",this,this._movingHandler);this._stopHandle=d.connect(f,"onMoveStop",this,this._moveStopHandler);return f},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(f){var q=this.map;q.snappingManager&&q.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();f.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(f){var q=f.shape,h=this._getControlEdges(),e=this._scratchGL._div,t,k=[],m=f.host.shape._wrapOffsets[0]||
0;for(t=0;t<h.length;t++){var y=h[t];y.x1+=m;y.x2+=m;k.push([e.createLine({x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2}).setStroke(this.editor._lineStroke),y.x1,y.y1,y.x2,y.y2])}q._lines=k;f.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(f,q,h){q=this.map;var e;u("esri-pointer")?e=q.navigationManager.pointerEvents._processTouchEvent(h,h):h&&"pointermove"===h.type&&(e=G.prototype._processTouchEvent.call({map:q},
h,h));e&&q.snappingManager&&q.snappingManager._onSnappingMouseMoveHandler(e);h=f.shape;f=h.getTransform();h=h._lines;for(e=0;e<h.length;e++)q=h[e],q[0].setShape({x1:q[1]+f.dx,y1:q[2]+f.dy,x2:q[3],y2:q[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),f)},_moveStopHandler:function(f){f=f.shape;var q=this.editor.toolbar,h=f.getTransform(),e=this.map,t=this.graphic,k=q._geo?x.geographicToWebMercator(t.geometry):t.geometry;q._activateScrollWheel();var m,y=f._lines;if(y){for(m=
0;m<y.length;m++)y[m][0].removeShape();f._lines=null}m=!1;y=!0;var K=this._getInfo();h&&(h.dx||h.dy)?this._placeholder&&(this._placeholder=!1,m=!0):y=!1;if(e.snappingManager)var n=e.snappingManager._snappingPoint;var w=[h,V.invert(this._startTx)];n=n||e.toMap(V.multiplyPoint(w,e.toScreen(k,!0)));e.snappingManager&&e.snappingManager._killOffSnapping();f.setTransform(null);t.setGeometry(q._geo?x.webMercatorToGeographic(n,!0):n);this.constructor.onMoveStop(this,h);q.onVertexMoveStop(this.relatedGraphic,
K,h);if(!y)q.onVertexClick(this.relatedGraphic,K);if(m)q.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var f=this.map,q=this.relatedGraphic.geometry,h=this.segIndex,e=this.ptIndex,t=this.segLength,k=this._scratchGL.getNavigationTransform(),m=k.dx;k=k.dy;var y=f.toScreen(this.graphic.geometry);f=y.x-m;y=y.y-k;var K=[];q=this.editor._getControlPoints(this,q,h,e,t);q[0]&&K.push({x1:f,y1:y,x2:q[0].x-m,y2:q[0].y-k});q[1]&&K.push({x1:f,y1:y,x2:q[1].x-m,y2:q[1].y-k});return K}});
F.setObject("toolbars.VertexMover",O,P);F.mixin(O,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return O})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(O,F,d,R,X,ba,V,P,G,u){O=O(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(C,z,x){this._graphic=C;this._map=z;this._toolbar=x;this._enable(this._graphic)},
destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(C){this._editBox?(d.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=d.connect(C.getLayer(),"onDblClick",this,function(z){this._map.navigationManager.setImmediateClick(!1);z.graphic==C&&(R.stop(z),d.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(C))}))},_disable:function(){this._applyEdit();
this._addEditBoxHandler&&(d.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(C,z){if(!this._editBox){if(!C.symbol.text){C.symbol.text="Tempt text";C.setSymbol(C.symbol);var x=""}var f=this._createInputTextStyle(C,this._map);""!==x&&(x=z||C.symbol.text);this._editBox=ba.create("input",{type:"text",value:x});P.set(this._editBox,f);V.add(this._editBox,"esriTextEditorInput");
this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=d.connect(this._editBox,"onkeyup",F.hitch(this,function(h){h.keyCode!=G.ENTER&&h.keyCode!==G.TAB||this._disable()}));this._editBoxBlurHandler=d.connect(this._editBox,"onblur",F.hitch(this,function(h){this._disable()}));C.symbol.text="";C.setSymbol(C.symbol);C.hide();var q=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",F.hitch(this,function(){this._disable()})));this._moveBoxHandler=
this._map.on("pan",function(h){P.set(q,{left:this._editBoxLeft+h.delta.x+"px",top:this._editBoxTop+h.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(P.get(q,"left"));this._editBoxTop=parseFloat(P.get(q,"top"))});this.onEditStart(C,this._editBox);this._toolbar.onTextEditStart(C,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(d.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(d.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(C,z){var x=C.getDojoShape().getTransformedBoundingBox(),f=C.getLayer();f=f.hasLocalNavigationTransform()?
{dx:0,dy:0}:f.getNavigationTransform();var q=C.symbol.font;return{"font-family":q.family,"font-size":q.size+"px","font-style":q.style,"font-variant":q.variant,"font-weight":q.weight,left:x[0].x+f.dx+"px",top:x[0].y+f.dy+"px",width:Math.abs(x[0].x-x[1].x)/Math.cos(C.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var C=this._graphic.symbol;C.text=this._editBox.value;this._graphic.setSymbol(C)}else this._graphic.getLayer().remove(this._graphic)}});
F.setObject("toolbars.TextEditor",O,u);return O})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(O,F,d,R,X,ba){F=F(ba,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(V){V=V||{};V.featureLayer&&(this._featureLayer=V.featureLayer,V.addedGraphics&&(this._addedGraphics=V.addedGraphics))},updateObjectIds:function(V,P){this.updateIds(this._featureLayer,
this._addedGraphics,V,P)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(d.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var V=O.map(this._addedGraphics,function(P){return P.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(d.hitch(this,function(P,G,u){P=O.map(P,function(C){return C.objectId});return{oldIds:V,addedIds:P,layer:this._featureLayer,
operation:this}}))}});d.setObject("dijit.editing.Add",F,X);return F})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(O,F,d,R,X){F=F(X,{declaredClass:"esri.EditOperationBase",updateIds:function(ba,V,P,G){O.forEach(V,function(u,C){var z=u[ba.objectIdField];O.forEach(P,function(x,f){z===x&&(u[ba.objectIdField]=G[f])})})}});return R.EditOperationBase=F})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(O,F,d,R,X,ba,V){O=F(V,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(P){var G;P=P||{};if(P.featureLayer&&(this._featureLayer=P.featureLayer,P.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(G=0;G<P.preUpdatedGraphics.length;G++)this._preUpdatedGraphicsGeometries.push(P.preUpdatedGraphics[G].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(P.preUpdatedGraphics[G].attributes);
if(P.postUpdatedGraphics)for(this._postUpdatedGraphics=P.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],G=0;G<P.postUpdatedGraphics.length;G++)P.postUpdatedGraphics[G].geometry?this._postUpdatedGraphicsGeometries.push(P.postUpdatedGraphics[G].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(P.postUpdatedGraphics[G].geometry),this._postUpdatedGraphicsAttributes.push(d.clone(P.postUpdatedGraphics[G].attributes))}},updateObjectIds:function(P,
G){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,P,G);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,P,G)},performUndo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._preUpdatedGraphicsGeometries[P]?this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._preUpdatedGraphicsGeometries[P])):this._postUpdatedGraphics[P].setGeometry(this._preUpdatedGraphicsGeometries[P]),this._postUpdatedGraphics[P].setAttributes(this._preUpdatedGraphicsAttributes[P]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(d.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._postUpdatedGraphicsGeometries[P]?this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._postUpdatedGraphicsGeometries[P])):this._postUpdatedGraphics[P].setGeometry(this._postUpdatedGraphicsGeometries[P]),this._postUpdatedGraphics[P].setAttributes(this._postUpdatedGraphicsAttributes[P]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(d.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});d.setObject("dijit.editing.Update",O,X);return O})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(O,F,d,R,X,ba){F=F(ba,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(V){V=V||{};
V.featureLayer&&(this._featureLayer=V.featureLayer,V.deletedGraphics&&(this._deletedGraphics=V.deletedGraphics))},updateObjectIds:function(V,P){this.updateIds(this._featureLayer,this._deletedGraphics,V,P)},performUndo:function(){var V=O.map(this._deletedGraphics,function(P){return P.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(d.hitch(this,function(P,G,u){P=O.map(P,function(C){return C.objectId});return{oldIds:V,addedIds:P,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(d.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});d.setObject("dijit.editing.Delete",F,X);return F})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(O,F,d,R,X,ba,V){F=F(V,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(P){var G;P=P||{};if(P.featureLayer&&(this._featureLayer=P.featureLayer,P.addedGraphics&&(this._addedGraphics=P.addedGraphics,P.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(G=0;G<P.preUpdatedGraphics.length;G++)this._preUpdatedGraphicsGeometries.push(P.preUpdatedGraphics[G].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(P.preUpdatedGraphics[G].attributes);if(P.postUpdatedGraphics)for(this._postUpdatedGraphics=
P.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],G=0;G<P.postUpdatedGraphics.length;G++)this._postUpdatedGraphicsGeometries.push(P.postUpdatedGraphics[G].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(d.clone(P.postUpdatedGraphics[G].attributes))}},updateObjectIds:function(P,G){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,P,G);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,P,G);this.updateIds(this._featureLayer,
this._addedGraphics,P,G)},performUndo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._preUpdatedGraphicsGeometries[P])),this._postUpdatedGraphics[P].setAttributes(this._preUpdatedGraphicsAttributes[P]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(d.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._postUpdatedGraphicsGeometries[P])),
this._postUpdatedGraphics[P].setAttributes(this._postUpdatedGraphicsAttributes[P]);var G=O.map(this._addedGraphics,function(u){return u.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(d.hitch(this,function(u,C,z){u=O.map(u,function(x){return x.objectId});return{oldIds:G,addedIds:u,layer:this._featureLayer,operation:this}}))}});d.setObject("dijit.editing.Cut",F,X);return F})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(O,F,d,R,X,ba,V){F=F(V,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(P){P=P||{};this._featureLayer=P.featureLayer;this._deletedGraphics=P.deletedGraphics;this._preUpdatedGraphics=P.preUpdatedGraphics;this._postUpdatedGraphics=P.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var G;for(G=0;G<P.preUpdatedGraphics.length;G++)this._preUpdatedGraphicsGeometries.push(P.preUpdatedGraphics[G].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(P.preUpdatedGraphics[G].attributes);for(G=0;G<P.postUpdatedGraphics.length;G++)this._postUpdatedGraphicsGeometries.push(P.postUpdatedGraphics[G].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(d.clone(P.postUpdatedGraphics[G].attributes))},updateObjectIds:function(P,G){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,P,G);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,P,G);this.updateIds(this._featureLayer,
this._deletedGraphics,P,G)},performUndo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._preUpdatedGraphicsGeometries[P])),this._postUpdatedGraphics[P].setAttributes(this._preUpdatedGraphicsAttributes[P]);var G=O.map(this._deletedGraphics,function(u){return u.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(d.hitch(this,function(u,
C,z){u=O.map(u,function(x){return x.objectId});return{oldIds:G,addedIds:u,layer:this._featureLayer,operation:this}}))},performRedo:function(){var P;for(P=0;P<this._postUpdatedGraphics.length;P++)this._postUpdatedGraphics[P].setGeometry(ba.fromJson(this._postUpdatedGraphicsGeometries[P])),this._postUpdatedGraphics[P].setAttributes(this._postUpdatedGraphicsAttributes[P]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(d.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});d.setObject("dijit.editing.Union",F,X);return F})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e){O=O([P,ba],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(t,k){this._settings.editor._activeTool=t;"EDITING"!==t&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==t&&this._settings.editor._hideAttributeInspector();"CLEAR"!==t&&this.inherited(arguments)},_initializeToolbar:function(){d.forEach(this._settings.layers,function(t){this._tbConnects.push(R.connect(t,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(t,k){this._tools.EDITING._activateTool(t,k.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=V.getSelection(this._settings.layers);var t=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=t);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=t);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=t);this._tools.UNION&&this._tools.UNION.set("disabled",2>t)},_toolFinished:function(t){if("ATTRIBUTES"===t&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===t||"CUT"===t||"RESHAPING"===t||"EDITING"===t)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===t)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new q({settings:this._settings,onClick:F.hitch(this,"_activateTool","SELECT",!0),onFinished:F.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new G(F.mixin(h.selectClear,{settings:this._settings,onClick:F.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new G(F.mixin(f.attributes,{settings:this._settings,onClick:F.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new x({settings:this._settings,onClick:F.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:F.hitch(this,"onApplyEdits"),onFinished:F.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new G(F.mixin(f.del,{settings:this._settings,onClick:F.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new u({settings:this._settings,onFinished:F.hitch(this,"_toolFinished","CUT"),onClick:F.hitch(this,"_activateTool","CUT",!0),onApplyEdits:F.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new C({settings:this._settings,onFinished:F.hitch(this,"_toolFinished","UNION"),onApplyEdits:F.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new z({settings:this._settings,onClick:F.hitch(this,"_activateTool","RESHAPING",!0),onFinished:F.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:F.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new G(F.mixin(f.undo,{settings:this._settings,disabled:!0,onClick:F.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new G(F.mixin(f.redo,{settings:this._settings,disabled:!0,onClick:F.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});F.setObject("dijit.editing.toolbars.Drawing",O,e);return O})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(O,F,d,R,X,ba,V,P,G){O=O([ba],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(u,C){u&&u.settings&&(this._tools=[],this._tbConnects=[],this._initialize(u.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var u,C=this._tools;for(u in C)C.hasOwnProperty(u)&&G.isDefined(this._tools[u])&&this._tools[u].destroy();d.forEach(this._tbConnects,
R.disconnect);this.inherited(arguments)},activate:function(u){this._enabled=!0},deactivate:function(){var u;this._enabled=!1;this._geometryType=this._layer=null;var C=this._tools;for(u in C)C.hasOwnProperty(u)&&(this._tools[u].deactivate(),this._tools[u].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(u){this._activeSymbol=u},_getSymbol:function(){},_createTools:function(){},_initialize:function(u){this._settings=u;this._toolbar=u.drawToolbar;this._editToolbar=
u.editToolbar;this._initializeToolbar()},_activateTool:function(u,C){this._activeTool&&this._activeTool.deactivate();!0===C&&this._activeTool==this._tools[u]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[u],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new V)}});F.setObject("dijit.editing.toolbars.ToolbarBase",O,P);return O})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(O,F,d,R,X,ba){O=O([R,X],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){R.prototype.destroy.apply(this,arguments);X.prototype.destroy.apply(this,arguments)}});F.setObject("dijit.editing.tools.ButtonToolBase",O,ba);return O})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(O,F,d,R,X){O=O(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(ba,V){ba=ba||{};F.mixin(this,ba);this.label=this._label?X.widgets.editor.tools[this._label]:"";this._settings=ba.settings;this._toolbar=ba.settings.drawToolbar;this._editToolbar=ba.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(ba){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=ba,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(ba){this._enabled=ba;this._updateUI()},setChecked:function(ba){this._checked=ba},enable:function(ba){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});F.setObject("dijit.editing.tools.ToolBase",O,R);return O})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f){O=O([x],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:C.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(R.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);d.forEach(this._cutConnects,R.disconnect);this._cutConnects=[];this._edits=
[]},_onDrawEnd:function(q){var h=this._cutLayers=d.filter(this._settings.layers,function(t){return"esriGeometryPolygon"===t.geometryType||"esriGeometryPolyline"===t.geometryType&&t.visible&&t._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(d.map(h,F.hitch(this,function(t){return R.connect(t,"onEditsComplete",F.hitch(this,function(k,m,y){if(this._settings.undoRedoManager){var K=this._settings.undoRedoManager;d.forEach(this._edits,F.hitch(this,function(n){K.add(new z({featureLayer:n.layer,
addedGraphics:n.adds,preUpdatedGraphics:n.preUpdates,postUpdatedGraphics:n.updates}))}),this)}this.onFinished()}))})));var e=new G;e.geometry=q;d.forEach(h,function(t,k){this._settings.editor._selectionHelper.selectFeatures([t],e,u.SELECTION_NEW,F.hitch(this,"_cutFeatures",t,e))},this)},_cutFeatures:function(q,h,e){if(e&&e.length){this._edits=[];var t=[];t.push(this._settings.geometryService.cut(V.getGeometries(e),h.geometry,F.hitch(this,"_cutHandler",q,e)));(new ba(t)).addCallback(F.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(q,h,e){var t=[],k=[],m=d.map(h,function(n){return new P(F.clone(n.toJson()))}),y,K;d.forEach(e.cutIndexes,function(n,w){y!=n?(y=n,1<d.filter(e.cutIndexes,function(c){return c===n}).length&&k.push(h[n].setGeometry(e.geometries[w]))):(K=new P(e.geometries[w],null,F.mixin({},h[n].attributes),null),K.attributes[h[0].getLayer().objectIdField]=null,t.push(K))},this);this._edits.push({layer:q,adds:t,updates:k,preUpdates:m})}});F.setObject("dijit.editing.tools.Cut",O,f);return O})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(O,F,d,R,X,ba){O=O([R,X],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){R.prototype.destroy.apply(this,arguments);X.prototype.destroy.apply(this,arguments)},setChecked:function(V){R.prototype.setChecked.apply(this,arguments)}});F.setObject("dijit.editing.tools.ToggleToolBase",O,ba);return O})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(O,F,d,R,X,ba,V,P,G,u){O=O([G],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:V.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(C){this._settings.editor._activeTool="UNION";C=d.filter(this._settings.layers,function(f){return"esriGeometryPolygon"===f.geometryType&&f.visible&&f._isMapAtVisibleScale()});var z=[],x=0;d.forEach(C,function(f,q){var h=f.getSelectedFeatures();2<=
h.length&&(x++,this._settings.geometryService.union(X.getGeometries(h),F.hitch(this,function(e){var t=h.shift(),k=[],m=[];k.push(new ba(t.toJson()));m.push(t.setGeometry(e));z.push({layer:f,updates:m,deletes:h,preUpdates:k});x--;if(0>=x)this.onApplyEdits(z,F.hitch(this,function(){if(this._settings.undoRedoManager){var y=this._settings.undoRedoManager;d.forEach(this._edits,F.hitch(this,function(K){y.add(new P({featureLayer:K.layer,deletedGraphics:K.deletes,preUpdatedGraphics:K.preUpdates,postUpdatedGraphics:K.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});F.setObject("dijit.editing.tools.Union",O,u);return O})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C){O=O([u],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:G.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){R.disconnect(this._rConnect);this._rConnect=R.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);R.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(z){var x=this._settings.layers,f=new P;f.geometry=z;z=this._reshapeLayers=d.filter(x,
function(q){return"esriGeometryPolygon"===q.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(z,f,V.SELECTION_NEW,F.hitch(this,"_reshape",f))},_reshape:function(z,x){if(1===x.length){var f=[],q=[],h=[],e=x[0],t=e.getLayer();this._settings.geometryService.reshape(e.geometry,z.geometry,F.hitch(this,function(k){"polyline"===k.type&&k.paths&&0===k.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===k.type&&k.rings&&
0===k.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(h.push(new ba(e.toJson())),q.push(e.setGeometry(k)),f.push({layer:t,updates:q,preUpdates:h}),this.onApplyEdits(f,F.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});F.setObject("dijit.editing.tools.Reshape",O,C);return O})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(O,F,d,R,X,ba,V,P,G,u){O=O([P],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(C,z){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=X.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(C,z){var x;this.enable(z);for(x in this._tools)this._tools.hasOwnProperty(x)&&(this.dropDown.removeChild(this._tools[x]),
!0===this._tools[x]._enabled&&this.dropDown.addChild(this._tools[x]));if(this._geometryType!==z||!1===this._activeTool._enabled)this._activeTool=this._tools[C.toUpperCase()];this._geometryType=z;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(C){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var C=this._settings.layers,z=this._settings.editor,x=!1,f=!1,q=!1,h=this._toolTypes=[],e;d.forEach(C,function(t){e=t.geometryType;
x=x||"esriGeometryPoint"===e;f=f||"esriGeometryPolyline"===e;q=q||"esriGeometryPolygon"===e;h=h.concat(d.map(this._getTemplatesFromLayer(t),F.hitch(this,function(k){return z._toDrawTool(k.drawingTool,t)})))},this);C=this._settings.createOptions;x&&this._toolTypes.push("point");f&&(this._toolTypes=this._toolTypes.concat(C.polylineDrawTools));q&&(this._toolTypes=this._toolTypes.concat(C.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(h))},_toUnique:function(C){var z={};return d.filter(C,
function(x){return z[x]?!1:z[x]=!0})},_getTemplatesFromLayer:function(C){var z=C.templates||[];d.forEach(C.types,function(x){z=z.concat(x.templates)});return d.filter(z,u.isDefined)},_createTools:function(){d.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(C){var z=F.mixin(V[C],{settings:this._settings,onClick:F.hitch(this,"onItemClicked",V[C].id)});this._tools[C.toUpperCase()]=new ba(z)}});F.setObject("dijit.editing.tools.Editing",O,G);return O})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(O,F,d,R,X){O=O([R],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(ba){this._enabled=ba===this._geomType;this.inherited(arguments)}});F.setObject("dijit.editing.tools.Edit",O,X);return O})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(O,F,d,R,X,ba){O=O([R,X],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){R.prototype.destroy.apply(this,arguments);X.prototype.destroy.apply(this,arguments)}});F.setObject("dijit.editing.tools.MenuItemBase",O,ba);return O})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(O,F,d,R){F={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:d.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:d.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:d.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:d.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:d.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:d.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:d.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:d.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:d.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:d.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:d.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:d.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:d.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:d.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:d.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};O.setObject("dijit.editing.tools.EditingTools",F,R);return F})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(O,F,d,R,X,ba,V,P,G,u){O=O([V,P],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var C,z=this._tools;for(C in z)z.hasOwnProperty(C)&&u.isDefined(z[C])&&z[C].destroy();this.inherited(arguments)},_createTools:function(){var C,z=new ba;this.dropDown=z;for(C in this._tools)this._tools.hasOwnProperty(C)&&z.addChild(this._tools[C]);
this._activeTool=z.getChildren()[0];this._updateUI()},activate:function(C){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(C){for(var z in this._tools)this._tools.hasOwnProperty(z)&&this._tools[z].enable(C);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(C){this._checked=C;this._updateUI()},_onDrawEnd:function(C){},
onLayerChange:function(C,z,x){this._activeTool=null;this._activeType=z;this._activeTemplate=x;this._activeLayer=C},onItemClicked:function(C,z){this._activeTool&&this._activeTool.deactivate();this._activeTool=X.byId(C);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(C){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
R.set(this.focusNode,{outline:"none"});R.set(this.titleNode,{padding:"0px",border:"none"});this._checked?R.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):R.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});F.setObject("dijit.editing.tools.DropDownToolBase",O,G);return O})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x){O=O([z],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=R.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);R.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(f){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var q=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(q,f,this._selectMethod,F.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new V(V.STYLE_CIRCLE,10,new P(P.STYLE_SOLID,new X([0,0,0]),1),new X([255,0,0,.5]));this._polylineSelectionSymbol=new P(P.STYLE_SOLID,new X([0,200,255]),2);this._polygonSelectionSymbol=new G(G.STYLE_SOLID,new P(P.STYLE_SOLID,
new X([0,0,0]),1),new X([0,200,255,.5]))},_initializeLayers:function(){d.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(f){var q=null;switch(f.geometryType){case "esriGeometryPoint":q=this._pointSelectionSymbol;break;case "esriGeometryPolyline":q=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":q=this._polygonSelectionSymbol}f.setSelectionSymbol(f._selectionSymbol||q)},_createTools:function(){d.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(f){var q=F.mixin(C[f],{settings:this._settings,onClick:F.hitch(this,"onItemClicked",C[f].id)});this._tools[f.toUpperCase()]=new u(q)}});F.setObject("dijit.editing.tools.Selection",O,x);return O})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(O,F,d,R,X){F={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:R.EXTENT,_selectMethod:d.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:R.EXTENT,_selectMethod:d.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:R.EXTENT,_selectMethod:d.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};O.setObject("dijit.editing.tools.SelectionTools",F,X);return F})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z){O=O(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(x){this._settings=x||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var x in this._sConnects)this._sConnects.hasOwnProperty(x)&&d.disconnect(this._sConnects[x])},selectFeatures:function(x,f,q,h){q===u.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(x));var e=[];R.forEach(x,function(t){if(!0===t.visible&&!0===t._isMapAtVisibleScale()){var k=q;t._isSelOnly&&k===u.SELECTION_NEW&&(k=u.SELECTION_ADD);e.push(t.selectFeatures(f,k))}});(new ba(e)).addCallback(F.hitch(this,function(t){var k=[];R.forEach(t,function(m,y){R.forEach(m[1],function(K){(K=x[y]._mode._getFeature(K.attributes[x[y].objectIdField])||null)&&k.push(K)},this)},this);this._mapServiceCount?((t=q===u.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(x))):
this._createLayerDefs(this._getLayerInfosFromFeatures(k)),this._updateLayerDefs(this._mapServiceInfos,!1,!(k&&k.length||t),F.hitch(this,h,k))):h(k)}))},selectFeaturesByGeometry:function(x,f,q,h){var e=f;-1!==f.declaredClass.indexOf("Extent")&&f.xmax===f.xmin&&f.ymax===f.ymin&&(e=new P(f.xmax,f.ymax,f.spatialReference));e=-1!==e.declaredClass.indexOf("Point")?this._extentFromPoint(e):e;f=new C;f.geometry=e;this.selectFeatures(x,f,q,h)},clearSelection:function(x){R.forEach(this._nonSelOnlyLayers,function(q){q.clearSelection&&
q.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var f=this._getLayerInfosFromSelection(this._settings.layers);R.some(f,function(q){return q.oids&&q.oids.length})&&(this._createLayerDefs(f),this._updateLayerDefs(this._mapServiceInfos,!0,x||!1))}},findMapService:function(x){var f=this._map,q=f.layerIds;x=x&&x._url&&x._url.path?x._url.path.toLowerCase():"";var h;for(h in q)if(q.hasOwnProperty(h)){var e=f.getLayer(q[h]);var t=e._url?e._url.path?e._url.path.toLowerCase().replace("mapserver",
"featureserver"):e._url.toLowerCase().replace("mapserver","featureserver"):"";if(x.substr(0,t.length)===t&&"esri.layers.ArcGISDynamicMapServiceLayer"===e.declaredClass)return e}},getSelection:function(x){var f=[];R.forEach(x,function(q){q._isSelOnly&&f.push(this._createLayerInfo(q))},this);R.forEach(f,function(q){var h=this._createMapServiceInfo(this.findMapService(q.layer));h&&(h.layerInfos[q.layer.layerId]=q)},this)},_initMapServiceInfos:function(x){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];R.forEach(x,function(f){var q=this.findMapService(f);q?(this._mapServiceCount++,this._createMapServiceInfo(q),q&&q.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(f)},this)},_createMapServiceInfo:function(x){if(!x)return null;var f=this._mapServiceInfos,q=f[x.id];q||(q=f[x.id]={mapService:x,layerInfos:[],layerDefs:F.mixin([],x.layerDefinitions||[]),origLayerDefs:F.mixin([],x.layerDefinitions||[])});return q},_resetMapServiceInfo:function(x){R.forEach(x.layerInfos,this._resetLayerInfo);
x.layerDefs=F.mixin([],x.origLayerDefs||[])},_resetMapServiceInfos:function(){var x=this._mapServiceInfos,f;for(f in x)x.hasOwnProperty(f)&&this._resetMapServiceInfo(x[f])},_createLayerInfo:function(x,f){var q=x.objectIdField,h=f?[]:x.getSelectedFeatures();return{layer:x,selectedFeatures:h||[],oids:R.map(h,function(e){return e.attributes[q]})}},_resetLayerInfo:function(x){x&&(x.selectedFeatures=[],x.oids=[])},_updateLayerDefs:function(x,f,q,h){for(var e in x)if(x.hasOwnProperty(e)){var t=x[e],k=t.mapService,
m=t.layerDefs=f?F.mixin([],t.origLayerDefs||[]):t.layerDefs;m?(q?h&&h():this._sConnects[k.id]=d.connect(k,"onUpdateEnd",F.hitch(this,"_onMapServiceUpdate",t,f,h)),k.setLayerDefinitions(m,q||!1)):h&&h()}},_onMapServiceUpdate:function(x,f,q){d.disconnect(this._sConnects[x.mapService.id]);R.forEach(x.layerInfos,function(h){if(f)h&&h.layer.clearSelection();else{var e=new C;e.objectIds=h?h.oids:[];e.objectIds.length&&h.layer.selectFeatures(e,u.SELECTION_SUBTRACT)}},this);f&&this._resetMapServiceInfo(x);
q&&q()},_createLayerDefs:function(x){R.forEach(x,function(f){var q=f.layer,h=this._createMapServiceInfo(this.findMapService(f.layer));if(h){h=h.layerDefs;var e=q.layerId,t='("'+q.objectIdField+'" NOT IN (',k=f.oids;k&&k.length&&(R.forEach(f.oids,function(m,y){k=!0;y&&(t+=",");t+="'"+m+"'"}),t+="))",h[e]=h.length&&h[e]&&h[e].length?h[e]+(" AND"+t):t)}},this)},_getLayerInfosFromFeatures:function(x){var f=[];R.forEach(x,function(h){var e=h.getLayer();e&&e._isSelOnly&&(f[e.id]||(f[e.id]=this._createLayerInfo(e,
!0)),f[e.id].selectedFeatures.push(h),f[e.id].oids.push(h.attributes[e.objectIdField]))},this);x=[];for(var q in f)f.hasOwnProperty(q)&&x.push(f[q]);return x},_getLayerInfosFromSelection:function(x){var f=[];R.forEach(x,function(q){q._isSelOnly&&f.push(this._createLayerInfo(q,!1))},this);return f},_extentFromPoint:function(x){var f=this._tolerance,q=this._map,h=q.toScreen(x);x=new G(h.x-f,h.y+f);f=new G(h.x+f,h.y-f);x=q.toMap(x);f=q.toMap(f);return new V(x.x,x.y,f.x,f.y,q.spatialReference)}});F.setObject("dijit.editing.SelectionHelper",
O,z);return O})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L,v,b,g,W,N,U,M,Z,da,oa,wa,ra,Ba,Ia,Ma,Za,bb,Sa,Na,fb,hb,$a,jb,gb,kb,mb,db,ob,rb,wb,sb,tb,pb,xb,I){var Y=b.getProtocolForWebResource(),ca=J.createSubclass({_setSourcesAttr:function(a){a&&(a=a.map(function(l){l.locator&&null==l.locationType&&(l=d.mixin({locationType:"street"},l));return l}));this.inherited(arguments,[a])}});F=F("esri.dijit.Directions",[jb,P],{templateString:E,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(a,l){if(!a.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!l)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=D;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",
activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Y+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Y+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Y+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new U(D.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new U(D.widgets.directions.maneuver,D.widgets.directions.waypoint),segmentInfoTemplate:new U(D.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new $a("11px",$a.STYLE_NORMAL,$a.VARIANT_NORMAL,$a.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new ba([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new Sa({url:O.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new Sa({url:O.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new Sa({url:O.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new Sa({url:O.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new Sa({url:O.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new Sa({url:O.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new Sa({url:O.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new Sa({url:O.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new bb({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new bb({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new Na).setColor(new ba([20,89,127,.75])).setWidth(10).setCap(Na.CAP_ROUND).setJoin(Na.JOIN_ROUND),segmentSymbol:(new Na).setColor(new ba([255,255,255,1])).setWidth(6).setCap(Na.CAP_ROUND).setJoin(Na.JOIN_ROUND),barrierRenderer:new hb({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new hb({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new hb({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=a;this.defaults=d.mixin({},this.options,a,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(var B=2;B<this.defaults.minStops;B++)this.defaults.stops.splice(0,0,"");this.domNode=l},postCreate:function(){this.inherited(arguments);this.own(e(this._activateButtonNode,V,d.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(e(this._lineBarrierButtonNode,V,d.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(e(this._addDestinationNode,
V,d.hitch(this,this._addStopButton)));this.own(e(this._optionsButtonNode,V,d.hitch(this,this._toggleOptionsMenu)));this.own(e(this._saveMenuButton,V,d.hitch(this,this._toggleSaveMenu)));this.own(e(this._saveButton,V,d.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(e(this._saveAsButton,V,d.hitch(this,function(){d.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(e(this._findOptimalOrderNode,V,d.hitch(this,this._toggleCheckbox)));
this.own(e(this._returnToStartNode,V,d.hitch(this,this._toggleCheckbox)));this.own(e(this._useTrafficNode,V,d.hitch(this,this._toggleCheckbox)));this.own(e(this._useMilesNode,V,d.hitch(this,this._toggleUnits)));this.own(e(this._useKilometersNode,V,d.hitch(this,this._toggleUnits)));this.own(e(this._getDirectionsButtonNode,V,d.hitch(this,this.getDirections)));this.own(e(this._clearDirectionsButtonNode,V,d.hitch(this,function(){this.clearDirections()})));var a=d.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(d.hitch(this,function(){y.set(this._startTimeMenu,"display","none")}),100)});this.own(e(this._startTimeButtonNode,V,d.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===y.get(this._startTimeMenu,"display")?y.set(this._startTimeMenu,"display","none"):(y.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(e(this._startTimeMenuLeaveNow,
"blur",a));this.own(e(this._startTimeMenuDepartAt,"blur",a));this.own(e(this._startTimeMenuNone,"blur",a));this.own(e(this._startTimeMenuLeaveNow,"mousedown",d.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(e(this._startTimeMenuDepartAt,"mousedown",d.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(e(this._startTimeMenuNone,"mousedown",d.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new Na).setColor(new ba([0,255,0,0])).setWidth(20).setCap(Na.CAP_ROUND);this._stopLayer=new da({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new da({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new da({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new da({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new da({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new da({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var l=new g(null,this.waypointSymbol,{});a=d.hitch(this,function(){this._moveInProgress||this._solveInProgress||!l._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(l),clearTimeout(l._solveTimeout),l._solveTimeout=null,l.attributes.isWaypoint=!0,l._isStopIcon&&this.stopGraphics[l._index]&&(this._stopLayer.add(this.stopGraphics[l._index]),this._stopLayer.add(this.textGraphics[l._index])));l._showTooltip()});this._handle=d.mixin(l,{_isHandle:!0,_tooltip:A.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:a},this.map.container),_showTooltip:d.hitch(this,function(B){l._tooltip.style.display=!B||B instanceof MouseEvent?
"none":"inline";B&&(B="string"===typeof B?B:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(B)+"\x3c/table\x3e",l._tooltip.innerHTML!==B&&(l._tooltip.innerHTML=B))}),_isShown:d.hitch(this,function(){return-1<X.indexOf(this._stopLayer.graphics,l)}),_remove:a});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();A.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(d.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(d.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(a,l){return this._enqueue(function(){return this._modifyStopSequence(a,
l)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(a,l,B){return this._enqueue(function(){this.clearMessages();return this._removeStop(a,l,B)})},updateStops:function(a){return this._enqueue(function(){return this._updateStops(a)})},addStops:function(a,l){return this._enqueue(function(){return this._addStops(a,l)}).then(d.hitch(this,this.zoomToFullRoute))},addStop:function(a,
l){return this._enqueue(function(){return this._addStop(a,l)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(a,l,B){return this._enqueue(function(){return this._updateStop(a,l,B)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(a){this.routeParams.barriers=a;return this._getDirections().then(d.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(a){this.routeParams.polylineBarriers=a;return this._getDirections().then(d.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(a){this.routeParams.polygonBarriers=a;return this._getDirections().then(d.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(a){return this._enqueue(function(){return this._getDirections().then(d.hitch(this,function(){!0!==a&&this.zoomToFullRoute()}))})},selectSegment:function(a){if(!(!this.directions||!this.directions.features||
0>a||a>=this.directions.features.length))for(var l=w("[data-segment]",this._resultsNode),B=0;B<l.length;B++){var T=parseInt(n.get(l[B],"data-segment"),10);if(a===T&&l[B]!==this._focusedDirectionsItem){this._focusedDirectionsItem=l[B];this.centerAtSegmentStart(a);this.onSegmentSelect(this.directions.features[a]);l[B].focus();break}}},unhighlightSegment:function(a){var l=this._segmentGraphics;if(l&&(!this._focusedDirectionsItem||a)){for(a=0;a<l.length;a++)this._routeLayer.remove(l[a]);this._segmentGraphics=
[]}},highlightSegment:function(a,l){if(!(this._focusedDirectionsItem&&!l||a>=this.directions.features.length)){a=a||0;var B=d.hitch(this,function(Ga){var Aa=this.map.toMap({x:0,y:0});return this.map.toScreen(Aa.offset(Ga,0)).x}),T=d.hitch(this,function(Ga){for(var Aa=0,Ka=0;Ka<Ga.length;Ka++)for(var Va=1;Va<Ga[Ka].length;Va++){var Ua=Ga[Ka][Va-1],Ra=Ga[Ka][Va];Aa+=B(Math.sqrt((Ua[0]-Ra[0])*(Ua[0]-Ra[0])+(Ua[1]-Ra[1])*(Ua[1]-Ra[1])))}return Aa}),Q=d.hitch(this,function(Ga){var Aa=this.map.toMap({x:0,
y:0});return this.map.toMap({x:Ga,y:0}).x-Aa.x}),aa=function(Ga,Aa,Ka){Aa=Math.max(1,Aa);for(var Va=Ka?Ga[0].length-1:0,Ua=0,Ra,Oa,La,Ha=[[Ga[0][Ka?Va:0]]];Ka&&0<Va||!Ka&&Va<Ga[0].length-1;){Oa=Ga[0][Ka?Va-1:Va];La=Ga[0][Ka?Va:Va+1];if(Ra=B(Math.sqrt((Oa[0]-La[0])*(Oa[0]-La[0])+(Oa[1]-La[1])*(Oa[1]-La[1]))))if(Ua+Ra<Aa)Ka?Ha[0].splice(0,0,Oa):Ha[0].push(La),Ua+=Ra;else{Aa=(Aa-Ua)/Ra;Ka?Ha[0].splice(0,0,[La[0]-(La[0]-Oa[0])*Aa,La[1]-(La[1]-Oa[1])*Aa]):Ha[0].push([Oa[0]+(La[0]-Oa[0])*Aa,Oa[1]+(La[1]-
Oa[1])*Aa]);break}Va+=Ka?-1:1}return 0<Ua+Ra?Ha:Ga},ha=this.get("directions").features[a],la=new Ma(ha.geometry),ia=40*Math.PI/180;d.mixin(ha.attributes,{_index:a});if(a){var sa=aa(this.get("directions").features[a-1].geometry.paths,25,!0),ta="esriDMTStop"!==ha.attributes.maneuverType?aa(la.paths,25,!1):sa;sa=ta!==sa?[sa[0].concat(ta[0])]:ta;var za=(new Ma(ta)).getExtent();if(1<ta[0].length&&15<=B(Math.max(za.getWidth(),za.getHeight()))){aa=15*Math.cos(ia/2);T=15*Math.sin(ia/2);var Fa=ta[0].length-
2;ia=ta[0][Fa+1];for(za=0;0<=Fa&&!za;){var Ja=ta[0][Fa];za=B(Math.sqrt((Ja[0]-ia[0])*(Ja[0]-ia[0])+(Ja[1]-ia[1])*(Ja[1]-ia[1])));Fa--}22>za&&(ta=za+(22-za)/3,Fa=za+2*(22-za)/3,Fa=[Ja[0]+Fa/za*(ia[0]-Ja[0]),Ja[1]+Fa/za*(ia[1]-Ja[1])],Ja=[ia[0]-ta/za*(ia[0]-Ja[0]),ia[1]-ta/za*(ia[1]-Ja[1])],ia=Fa,za=22);aa/=za;ta=[ia[0]-(ia[0]-Ja[0])*aa,ia[1]-(ia[1]-Ja[1])*aa];Ja[1]!==ia[1]?(aa=(ia[0]-Ja[0])/(ia[1]-Ja[1]),Ja=Q(T/Math.sqrt(1+aa*aa)),Q=aa*Ja):(Ja=0,Q=Q(T));Infinity===Math.abs(Ja)||Infinity===Math.abs(Q)||
isNaN(Ja)||isNaN(Q)||(sa[0].push(ia),sa[0].push([ta[0]-Ja,ta[1]+Q]),sa[0].push([ta[0]+Ja,ta[1]-Q]),sa[0].push(ia))}else sa=aa(sa,2*T(ta),!0);la.paths=sa}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);Q=d.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new ba([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new g(ha.geometry,Q,ha.attributes,this.get("segmentInfoTemplate")),
new g(la,this.routeSymbol,ha.attributes,this.get("segmentInfoTemplate")),new g(la,this.segmentSymbol,ha.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));ha=d.hitch(this,function(Ga){if(0<Ga&&Ga<this.directions.features.length){Ga=this.directions.features[Ga]._associatedFeaturesWithWaypoints;for(var Aa=0;Aa<Ga.length;Aa++)Ga[Aa]._associatedSnapFeature&&
Ga[Aa]._associatedSnapFeature.getDojoShape()&&Ga[Aa]._associatedSnapFeature.getDojoShape().moveToFront()}});ha(a-1);ha(a);this.onSegmentHighlight(this.directions.features[a])}},zoomToSegment:function(a){var l=new H;if(this.directions&&this.directions.features){var B=Math.max(0,Math.min(this.directions.features.length-1,a||0));this.map.setExtent(this.get("directions").features[B].geometry.getExtent(),!0).promise.always(d.hitch(this,function(){this.highlightSegment(B);l.resolve()}))}else l.reject(Error("No directions."));
return l.promise},centerAtSegmentStart:function(a){var l=new H;if(this.directions&&this.directions.features){var B=Math.max(0,Math.min(this.directions.features.length-1,a||0));var T=this.directions.features[B];this.map.centerAt(T.geometry.getPoint(0,0)).promise.always(d.hitch(this,function(){this.highlightSegment(B,!0);this._showSegmentPopup(T,B);l.resolve()}))}else l.reject(Error("No directions."));return l.promise},zoomToFullRoute:function(){var a=new H;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(a.resolve)):a.resolve();return a.promise},setListIcons:function(){var a,l=this._dnd.getAllNodes();for(a=0;a<l.length;a++){var B=w("."+this._css.stopIconClass,l[a])[0];B&&(B.innerHTML=this._getLetter(a));K.remove(l[a],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);B=this._getStopSymbol(this.stops[a]);
B===this.fromSymbol?K.add(l[a],this._css.stopOriginClass):B===this.toSymbol?K.add(l[a],this._css.stopDestinationClass):B===this.unreachedSymbol&&K.add(l[a],this._css.stopUnreachedClass)}a=w("[data-reverse-td]",this._dndNode)[0];A.destroy(a);this.get("showReverseStopsButton")&&A.create("td",{"data-reverse-td":"true",rowspan:l.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
D.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(T){T.stopPropagation()},onmouseout:function(T){T.stopPropagation()}},l[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var a=0;a<this.stopGraphics.length;a++)if(this.stopGraphics[a]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==a)){this._stopLayer.add(this.stopGraphics[a]);var l=this.stopGraphics[a].getDojoShape();l&&l.moveToFront();this._stopLayer.add(this.textGraphics[a]);
(l=this.textGraphics[a].getDojoShape())&&l.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var a=this.stops,l=function(la){var ia={},sa;for(sa in la)la.hasOwnProperty(sa)&&0===sa.indexOf("Attr_")&&(ia[sa]=la[sa]);return ia},B=0;B<a.length;B++){var T=a[B];if(T&&T.feature){var Q=T.feature.attributes,aa=Q?Q.Status:void 0,ha=null;this._isStopAWaypoint(T)||
(ha=new fb(this._getLetter(B),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&ha.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));ha=new g(T.feature.geometry,ha,{address:T.name},this.get("stopsInfoTemplate"));ha._isStopLabel=!0;ha._index=B;T=new g(T.feature.geometry,this._getStopSymbol(T),d.mixin({address:T.name,Status:void 0===aa?0:aa,CurbApproach:Q&&Q.CurbApproach?Q.CurbApproach:null,TimeWindowStart:Q&&Q.TimeWindowStart?Q.TimeWindowStart:
null,TimeWindowEnd:Q&&Q.TimeWindowEnd?Q.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(T)},l(Q)),this.get(this._isStopAWaypoint(T)?"waypointInfoTemplate":"stopsInfoTemplate"));T._isStopIcon=!0;T._index=B;this.stopGraphics[B]=T;this.textGraphics[B]=ha}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(a){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(a);
return this._setTravelMode(a)})},getSupportedTravelModeNames:function(){var a=[],l=this.serviceDescription;if(l&&l.supportedTravelModes&&l.supportedTravelModes.length){l=l.supportedTravelModes;for(var B=0;B<l.length;B++)a.push(l[B].name)}return a},setDirectionsLengthUnits:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(a)})},setDirectionsLanguage:function(){var a=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(a)})},useMyCurrentLocation:function(a){this.clearMessages();return this._createLocateButton(this.geocoders[a],!0,!0)},loadRoute:function(a){return this._enqueue(d.hitch(this,function(){return this._loadRoute(a)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var a=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(d.hitch(this,function(){this.mapClickActive=!a;this.set("mapClickActive",a);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var a=this.get("mapClickActive"),l=d.hitch(this,function(B){for(var T=B?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],Q=0;Q<T.length;Q++)for(var aa=T[Q],ha=0;ha<aa.length;ha++){var la=aa[ha].getDojoShape();la&&la[B?"moveToBack":"moveToFront"].call(la)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),K.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();a?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=e(this.map,"click",d.hitch(this,function(B){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new g(B.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),K.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
K.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());l(!a);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(pb.FREEHAND_POLYLINE),K.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),K.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var a=this.get("map"),l=a.graphicsLayerIds.length-1;a.reorderLayer(this._routeLayer,l);a.reorderLayer(this._polygonBarriersLayer,l);a.reorderLayer(this._polylineBarriersLayer,l);a.reorderLayer(this._barriersLayer,l);a.reorderLayer(this._waypointsEventLayer,l);
a.reorderLayer(this._stopLayer,l)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(a){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var a=this._clearDirections(!0),l;if(this._watchEvents&&this._watchEvents.length)for(l=0;l<this._watchEvents.length;l++)this._watchEvents[l].unwatch();if(this._onEvents&&this._onEvents.length)for(l=0;l<this._onEvents.length;l++)this._onEvents[l].remove();
if(this._geocoderEvents)for(l=0;l<this._geocoderEvents.length;l++)this._geocoderEvents[l].value.unwatch(),this._geocoderEvents[l].blur.remove(),this._geocoderEvents[l].select.remove(),this._geocoderEvents[l].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return a},_getDirections:function(){var a=new H;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(d.hitch(this,function(l){this.stops=l;this._setStops();this._configureRoute().always(d.hitch(this,function(B){a.resolve(B)}))}),d.hitch(this,function(l){this.set("directions",null);this._clearRouteGraphics();a.reject(l);this.onDirectionsFinish(l)}))):this._clearDirections(!0).always(d.hitch(this,function(){this.createRouteSymbols();a.resolve()}));return a.promise},
_clearDirections:function(){var a=new H;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),a.resolve()):arguments.length?a.resolve():this._reset().then(a.resolve,a.reject):a.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return a.promise},_setTravelMode:function(a){var l=new H,B=this.serviceDescription,T=function(){l.resolve(a)};if(B&&B.supportedTravelModes&&B.supportedTravelModes.length){var Q=B.supportedTravelModes,aa=!1;for(B=0;B<Q.length;B++)if(Q[B].name===a){aa=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==a?(this.routeParams.travelMode=Q[B].impedanceAttributeName?Q[B]:Q[B].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(T)):T();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=Q[B].description);break}aa||l.reject(a)}else l.reject(a);return l.promise},_setDirectionsLengthUnits:function(a){this._clearDisplayBeforeSolve();var l=new H;K.remove(this._useMilesNode,this._css.stopsPressedButtonClass);K.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);a===W.KILOMETERS?K.add(this._useKilometersNode,this._css.stopsPressedButtonClass):a===W.MILES&&K.add(this._useMilesNode,this._css.stopsPressedButtonClass);
a===W.KILOMETERS||a===W.METERS||a===W.MILES||a===W.FEET||a===W.YARDS||a===W.NAUTICAL_MILES?(this.directionsLengthUnits=a,l.resolve(a)):l.reject(a);return l.promise},_setDirectionsLanguage:function(a){this._clearDisplayBeforeSolve();var l=new H;a=this._setDirectionsLanguageByLocale(a);this._solveAndZoom().always(function(){l.resolve(a)},l.reject);return l.promise},_showLoadingSpinner:function(a){void 0===a&&(a=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);a?(K.add(this._widgetContainer,
this._css.resultsLoadingClass),K.add(this._resultsNode,"esriRoutesContainerBusy")):(K.remove(this._widgetContainer,this._css.resultsLoadingClass),K.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(a,l){var B=new H;this._requestQueueTail||(this._requestQueueTail=new H,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(d.hitch(this,function(){try{d.mixin(this,{_incrementalSolveStopRange:null},l);var T=a.call(this);T&&"object"===typeof T&&T.hasOwnProperty("isFulfilled")?
T.then(d.hitch(this,function(Q){B.resolve(Q);this._showLoadingSpinner()}),d.hitch(this,function(Q){B.reject(Q);this._showLoadingSpinner()})):(B.resolve(T),this._showLoadingSpinner())}catch(Q){B.reject(Q),this._showLoadingSpinner()}}));this._requestQueueTail=B;this._showLoadingSpinner();return B.promise},_createDnD:function(){this._dnd=new ea(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){A.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&
this._restoreMapTimeExtent(),this._useTrafficItemNode.title=D.widgets.directions.trafficLabelLive,K.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var a=this,l=function(){this._keepDirections||a._clearDisplayBeforeSolve();this._keepDirections=!1},B=d.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),T=d.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new z({required:!0,value:new Date,
onChange:l,onFocus:B,onBlur:T},this._departAtTimeContainer);this._departAtDate=new C({required:!0,value:new Date,onChange:l,onFocus:B,onBlur:T,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(a,l,B){if(isNaN(B))this.startTime="now"===B?B:"none";else{l=B instanceof Date?B:new Date(B);B=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;var T=6E4*-l.getTimezoneOffset();l=new Date(l-T+(B&&B.arriveTimeUTC?
B.ETA-B.arriveTimeUTC:T));this._departAtTime._keepDirections=!a;this._departAtDate._keepDirections=!a;this._departAtTime.setValue(l);this._departAtDate.setValue(l)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var a=this._getImpedanceAttribute();a=this._isTimeUnits(a?a.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!a;K[a?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);
K[a?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);a||this.set("startTime","now")},_usingAGOL:function(a){a||(a=this.routeTaskUrl);return-1<a.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var a={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=d.mixin({maxResults:1,
locationToAddressDistance:100},this.defaults.searchOptions,a)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var a="EN-US"===R.locale.toUpperCase()?W.MILES:W.KILOMETERS;this.defaults.directionsLengthUnits?a=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(a=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",a)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&
!this.trafficLayer&&(this.trafficLayer=new Z(Y+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(a,l){this.canModifyStops||this.canModifyWaypoints||
this.set("mapClickActive",!1);l||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(a,l){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);l||this.canModifyStops||!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?
(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,K.remove(this._startTimeButtonNodeContainer,"departAtButton"),K.remove(this._departAtContainer,"departAtContainerVisible")):(K.add(this._startTimeButtonNodeContainer,"departAtButton"),K.add(this._departAtContainer,"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();
this.set(this.defaults);this.routeLayer=d.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(a){var l=new H;a?this.get("loaded")?this._reset().then(d.hitch(this,function(){this._addStops(a).then(l.resolve,l.reject)}),l.reject):this._addStops(a).then(l.resolve,l.reject):l.reject();return l.promise},_removeStop:function(a,
l,B,T){var Q=new H,aa=d.hitch(this,function(la){this.stops.splice(la,1);var ia=this._dnd.getAllNodes()[la],sa=this.get("geocoders");this._geocoderEvents[ia.id]&&(this._geocoderEvents[ia.id].blur.remove(),this._geocoderEvents[ia.id].select.remove(),this._geocoderEvents[ia.id].suggest.remove(),this._geocoderEvents[ia.id].value.unwatch());sa[la].destroy();sa.splice(la,1);this.set("geocoders",sa);A.destroy(ia);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();
this._sortGeocoders()});if(0>a||a>=this.stops.length||void 0===a)a=this.stops.length-1;var ha=!1;for(T=this.stopGraphics[a]&&this._isStopAWaypoint(this.stops[a])||T;!ha;)aa(a),T?ha=!0:(a-=0>=a||a<this.stops.length&&this._isStopAWaypoint(this.stops[a])?0:1,ha=!this._isStopAWaypoint(this.stops[a]));for(;this.stops.length-this._getWaypointCount()<this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();B?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),
this.createRouteSymbols(),Q.resolve()):this._solveAndZoom(l).then(Q.resolve,Q.reject);return Q.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(a,l){var B=new H,T=[],Q=this.autoSolve;this.autoSolve=!1;void 0===l&&(l=this._getStopCount());for(var aa=0;aa<Math.min(a.length,this.maxStops-this._getStopCount());aa++){var ha=new H;this._addStop(a[aa],l+aa,!0).always(ha.resolve);T.push(ha)}S(T).always(d.hitch(this,
function(){this.autoSolve=Q;this._getDirections().always(function(){B.resolve(a)})}));return B.promise},_addStop:function(a,l,B){var T=new H;this._checkMaxStops();this.maxStopsReached?(this._showMessage(D.widgets.directions.error.maximumStops),T.reject(Error(D.widgets.directions.error.maximumStops))):(void 0===a&&void 0===l&&(l=this.stops.length),a instanceof g&&a.attributes&&a.attributes.isWaypoint&&(!l||l===this.stops.length||2>this._getStopCount())&&!B?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),
T.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(a).then(d.hitch(this,function(Q){this._isStopAWaypoint(Q)&&Q&&Q.feature&&(Q.feature.attributes=d.mixin({},Q.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(Q,l);this.autoSolve&&""!==Q.name?this._getDirections().always(function(){T.resolve(Q,l)}):T.resolve(Q,l)}),d.hitch(this,function(Q){T.reject(Q)})));return T.promise},_removeEmptyStops:function(){for(var a=0,l=this.stops.length-this._getWaypointCount()-
this.minStops;a<this.stops.length&&0<l;)this.stops[a]&&this.stops[a].name?a++:(this._removeStop(a,!0,!0,!0),l--,this._moveInProgress&&this._handle._index>=a&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(a,l,B){if(a.feature.geometry&&-1<B){var T={address:a.name};this.stopGraphics[B]&&(d.mixin(this.stopGraphics[B].attributes,T),this.stopGraphics[B].setGeometry(l));this.textGraphics[B]&&(d.mixin(this.textGraphics[B].attributes,T),this.textGraphics[B].setGeometry(l));
this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(T=this.geocoders[B])&&T.inputNode&&(T.value=a.name,T.inputNode.value=a.name);d.mixin(a.feature.attributes,this.stops[B].feature.attributes);this.stops[B]=a;this.stops[B].feature.setGeometry(l);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(a,l){var B;if(void 0===l)for(B=0;B<this.geocoders.length;B++){if(!this.geocoders[B].get("value")){var T=this.geocoders[B];
break}}else B=l,this.geocoders[B]&&!this.geocoders[B].get("value")&&(T=this.geocoders[B]);!T||void 0!==l&&l!==B||this._isStopAWaypoint(a)?(void 0===l&&(l=this.geocoders.length),this.stops.splice(l,0,a),this._createGeocoder(a,l)):(this.stops[B]=a,T.set("value",a.name),T._stopReference=a);this._optionsMenu()},_createGeocoder:function(a,l){var B=this._dnd.getAllNodes(),T=!1,Q=!1,aa=B.length;B[l]?(Q=B[l],T=!0):T=Q=!1;var ha=d.hitch(this,function(ta,za){var Fa=za?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,
Ja=za?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;K.replace(ta.children[0],Fa,Ja);2<this.geocoders.length&&(Fa=za?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,Ja=za?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,K.replace(ta.children[3].children[0],Fa,Ja))}),la=A.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(a)?"display:none;":"",onmouseover:function(){ha(this,!0)},onmouseout:function(){ha(this,!1)}});A.create("td",
{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},la);B=A.create("td",{className:this._css.stopIconColumnClass},la);A.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(aa),"data-center-at":"true"},B);aa=A.create("td",{className:this._css.esriStopGeocoderColumnClass},la);aa=A.create("div",{},aa);B=A.create("td",{className:this._css.stopIconRemoveColumnClass},la);A.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},
B);this._dnd.insertNodes(!1,[la],T,Q);T=d.mixin({},this.get("searchOptions"),{value:a.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ia=new ca(T,aa),sa=d.hitch(this,function(ta,za){this._enqueue(function(){if(za!==ta&&ia._stopReference&&ia._stopReference.name!==za){var Fa=X.indexOf(this.stops,ia._stopReference);this.stops[Fa]={name:za};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(Fa));this._setStops();this._clearDisplayBeforeSolve();
this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ia._tr=la;ia._stopReference=a;ia.startup();this.geocoders.splice(l,0,ia);this._geocoderEvents[la.id]={blur:ia.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&this.search()}),select:ia.on("select-result",d.hitch(this,function(ta){var za=!0;if(ta&&(ta.results||ta.result)){var Fa=this._dnd.getAllNodes();Fa=X.indexOf(Fa,la);var Ja=ia.value,Ga=ta.results&&ta.results.results&&ta.results.results.length?
ta.results.results[0]:ta.result;Ga?(Ga.name=Ja,this.stops[Fa]=this._toPointGeometry(Ga),this.geocoders[Fa]._stopReference=this.stops[Fa],sa("",Ja)):(this.removeStop(Fa),this.set("directions",null),this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",ta.target.get("value"))),this._clearRouteGraphics(),za=!1);za&&this.getDirections()}})),suggest:ia.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var ta=w("LI[role\x3d'menuitem']",this.suggestionsNode),
za=0;za<ta.length;za++)n.set(ta[za],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ia.watch("value",function(ta,za,Fa){sa(za,Fa)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var a=0;a<this.geocoders.length;a++)if(this.geocoders[a].inputNode===document.activeElement){this.geocoders[a]._hideSuggestionsMenu();this.geocoders[a].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&
this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(a){a&&", , "===a.name&&(a.name=a.feature&&a.feature.attributes&&a.feature.attributes.Match_addr?a.feature.attributes.Match_addr+("POI"===a.feature.attributes.Addr_type&&a.feature.attributes.City&&-1===a.feature.attributes.Match_addr.indexOf(a.feature.attributes.City)?", "+a.feature.attributes.City:""):"");return a},_toPointGeometry:function(a){var l=a.feature.geometry;l&&(l.getCentroid?a.feature.geometry=l.getCentroid():l.getExtent&&
(l=l.getExtent())&&(a.feature.geometry=l.getCenter()));return a},_removeLocateButtonVisibilityEvents:function(){for(var a=0;a<this.geocoders.length;a++){var l=this.geocoders[a];l._onMouseEnter&&l._onMouseEnter.remove();l._onMouseOut&&l._onMouseOut.remove();l._onKeyPress&&l._onKeyPress.remove();l._locateButton&&(l._locateButton._onMouseEnter&&l._locateButton._onMouseEnter.remove(),l._locateButton._onMouseOut&&l._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();
for(var a=this,l=function(ia){ia instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;a._createLocateButton(this._geocoder,!0)},B=function(ia){ia instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(d.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||a._destroyLocateButton(this._locateButton)}),400)},T=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);
this._destroyTimeout=setTimeout(d.hitch(this,function(){""===this.value?a._createLocateButton(this._geocoder,!0):a._destroyLocateButton(this._locateButton)}),400)},Q=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},aa=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(d.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||a._destroyLocateButton(this._geocoder.inputNode._locateButton)}),
400)},ha=0;ha<this.geocoders.length;ha++){var la=this.geocoders[ha];la&&la.inputNode&&(la.inputNode._geocoder=la,la._onMouseEnter=e(la.inputNode,t.enter,l),la._onMouseOut=e(la.inputNode,[t.leave,"blur"],B),la._onKeyPress=e(la.inputNode,"keydown",T),la.inputNode._locateButton&&(la=la.inputNode._locateButton,la._onMouseEnter=e(la.domNode,t.enter,Q),la._onMouseOut=e(la.domNode,t.leave,aa)))}},_createLocateButton:function(a,l,B){var T=new H;a.inputNode._locateButton&&a.inputNode._locateButton._locating?
T.resolve():O(["./LocateButton"],d.hitch(this,function(Q){this._destroyLocateButton(a.inputNode._locateButton);if(a&&!this._solveInProgress){var aa=A.create("div",{},a.domNode);K.add(a.domNode,this._css.stopsInnerGeocoderClass);var ha=new Q({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},aa);ha.startup();a.inputNode._locateButton=ha;ha.domNode._geocoder=a;this._setLocateButtonVisibilityEvents();Q=d.hitch(this,function(){ha._locating=!0;a.set("value","");a.inputNode.placeholder=
D.widgets.directions.retrievingMyLocation.toUpperCase()});ha._onBeforeLocate=e(ha._locateNode,V,Q);ha._onLocate=e(ha,"locate",d.hitch(this,function(la){ha._locating=!1;la.graphic?(l&&this._destroyLocateButton(a.inputNode._locateButton),this.updateStop(new g(la.graphic.geometry),X.indexOf(this.geocoders,a)).then(d.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){T.resolve(la)}):T.resolve(la)}))):(a.set("value",""),a.inputNode.placeholder=D.widgets.directions.myLocationError.toUpperCase(),
T.reject(la.error))}));B?(Q(),ha.locate().then(null,T.reject)):T.resolve()}else T.resolve()}));return T.promise},_destroyLocateButton:function(a){if(a){var l=a.domNode._geocoder;clearTimeout(l._destroyTimeout);a._locating?l._destroyTimeout=setTimeout(d.hitch(this,function(){l._lbShown_lb||l._lbShown_f||this._destroyLocateButton(a)}),100):(a.clear(),a._onBeforeLocate.remove(),a._onLocate.remove(),a._onMouseEnter&&a._onMouseEnter.remove(),a._onMouseOut&&a._onMouseOut.remove(),a.destroy(),l.inputNode&&
(l.inputNode._locateButton=null,l._setPlaceholder(l.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(d.hitch(this,function(a,l){for(var B,T,Q=0;Q<this.get("geocoders").length;Q++)this.geocoders[Q]._stopReference===a?B=Q:this.geocoders[Q]._stopReference===l&&(T=Q);return B>T?1:T>B?-1:0})),this._setStops())},_getCandidate:function(a){var l=new H,B=typeof a;a?"object"===B&&a.hasOwnProperty("feature")&&a.hasOwnProperty("name")?(a.feature.attributes&&void 0!==a.feature.attributes.displayName&&
!this._isStopAWaypoint(a)&&(a.name=a.feature.attributes.displayName,a.feature.attributes.Name=this._userDefinedStopName),a.name=this._isStopAWaypoint(a)?this._waypointName:String(a.name),"point"!==a.feature.geometry.type&&(a.feature.geometry=new Ba([a.feature.geometry.x,a.feature.geometry.y],this.map.spatialReference)),l.resolve(a)):"object"===B&&a.hasOwnProperty("address")&&a.hasOwnProperty("location")?(a=this._globalGeocoder._hydrateResult(a),l.resolve(a)):"object"!==B||!a.hasOwnProperty("name")||
null!==a.name&&""!==a.name?a instanceof g&&a.attributes&&(void 0!==a.attributes.Name||a.attributes.isWaypoint)?(B=this._addStopWrapperToGraphic(a,a.attributes.isWaypoint?this._waypointName:String(a.attributes.Name)),String(a.attributes.Name)&&(B.feature.attributes.Name=this._userDefinedStopName),l.resolve(B)):("object"===B&&a.hasOwnProperty("name")&&(a=String(a.name)),this._reverseGeocode(a).then(l.resolve,l.reject)):l.resolve(d.clone(this._emptyStop)):l.resolve(d.clone(this._emptyStop));return l.promise},
_reverseGeocode:function(a){var l=new H,B,T=a.geometry?a.geometry:a;if(this._globalGeocoder){var Q=d.hitch(this,function(ia){var sa=new H,ta=500;if(this.map){var za=this.map.toScreen(T);za.x+=ra._calculateClickTolerance([ia]);this.map.spatialReference.isWebMercator()?(ta=Math.abs(this.map.toMap(za).x-T.x),sa.resolve(ta)):4326===this.map.spatialReference.wkid?(ta=Math.abs(oa.geographicToWebMercator(this.map.toMap(za)).x-oa.geographicToWebMercator(T).x),sa.resolve(ta)):this._geometryService&&(ia=new ob,
ia.distanceUnit=db.UNIT_METER,ia.geometry1=T,ia.geometry2=this.map.toMap(za),this._geometryService.distance(ia,function(Fa){ta=Fa;sa.resolve(ta)},function(){sa.resolve(ta)}))}return sa.promise}),aa=[],ha=this._globalGeocoder.sources,la=function(){ha[B].featureLayer&&aa.push(Q(ha[B].featureLayer).then(d.hitch(ha[B],function(ia){this.searchQueryParams=d.mixin(this.searchQueryParams,{distance:ia})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(B=0;B<ha.length;B++)la();else B=this._globalGeocoder.activeSourceIndex,
la();S(aa).always(d.hitch(this,function(){this._globalGeocoder.search(T).then(d.hitch(this,function(ia){var sa=!1;if(ia){var ta=null;for(B=0;B<this._globalGeocoder.sources.length;B++)if(ia[B]&&ia[B].length){var za=ia[B];break}if(za.length&&(sa=!0,ta=za[0],this._globalGeocoder.sources[B].featureLayer))for(ia=Number.POSITIVE_INFINITY,B=0;B<za.length;B++){za[B]=this._toPointGeometry(za[B]);var Fa=wa.geodesicLengths([new Ma({paths:[[oa.xyToLngLat(T.x,T.y),oa.xyToLngLat(za[B].feature.geometry.x,za[B].feature.geometry.y)]],
spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ia>Fa&&(ia=Fa,ta=za[B])}(ta=this._decorateEmptyAGOLGeocoderResponse(ta))&&""!==ta.name&&null!==ta.name&&void 0!==ta.name?(ta.name=String(ta.name),isNaN(T.x)||isNaN(T.y)||this.map.spatialReference.wkid!==T.spatialReference.wkid?!ta.feature.geometry||isNaN(ta.feature.geometry.x)||isNaN(ta.feature.geometry.y)?(this._showMessage(D.widgets.directions.error.locator),l.reject(Error(D.widgets.directions.error.locator))):l.resolve(ta):
(ta.feature.geometry=T,l.resolve(ta))):sa=!1}sa||(a instanceof Ba?a=new g(a):a instanceof Array&&(a=new g(new Ba(a[0],a[1]))),a instanceof g?this._decorateUngeocodedStop(a).then(l.resolve,l.reject):(this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.toString())),l.reject(Error(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.toString())))))}))}))}else this._showMessage(D.widgets.directions.error.locatorUndefined),l.reject(Error(D.widgets.directions.error.locatorUndefined));
return l.promise},_updateStop:function(a,l,B){var T=new H;this.stops&&this.stops[l]?a instanceof g&&a.attributes&&a.attributes.isWaypoint&&(!l||l===this.stops.length-1||2>this._getStopCount())?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),T.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(a).then(d.hitch(this,function(Q){var aa=Q.feature;aa=aa?aa.geometry:null;var ha=this.stops[l].feature;ha=ha?ha.geometry:null;aa=aa&&ha&&
(aa.x!==ha.x||aa.y!==ha.y)||!aa&&ha;this.stops[l]=Q;this.geocoders[l]||this._createGeocoder(Q,l);ha=this.geocoders[l];ha._stopReference=Q;ha._tr.style.display=this._isStopAWaypoint(Q)?"none":"";ha.value=Q.name;ha.inputNode&&(ha.inputNode.value=Q.name);aa&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||B?this._getDirections().then(T.resolve,T.reject):(this._setStops(),T.resolve(Q))}),d.hitch(this,function(Q){T.reject(Q)})):(this._showMessage(D.widgets.directions.error.couldNotUpdateStop),
T.reject(Error(D.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return T.promise},_renderDirections:function(){var a=this.get("directions");if(this._resultsNode){var l='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';l+=this._renderDirectionsSummary(a);l+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';l+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';l+=this._renderDirectionsTable(a);l+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=
l);this._disconnectResults();(a=w("[data-segment]",this._resultsNode))&&a.length&&X.forEach(a,d.hitch(this,function(B){this._resultEvents.push(e(B,t.enter,d.hitch(this,function(){if(!this._focusedDirectionsItem){var T=parseInt(n.get(B,"data-segment"),10);this.highlightSegment(T)}})));this._resultEvents.push(e(B,"focusout",d.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(e(B,t.leave,this.unhighlightSegment));this._resultEvents.push(e(B,
"click, keydown",d.hitch(this,function(T){T&&("click"===T.type||"keydown"===T.type&&T.keyCode===q.ENTER)&&(this._focusedDirectionsItem!==B?this.selectSegment(parseInt(n.get(B,"data-segment"),10)):(B.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(a){var l="",B=d.hitch(this,function(){for(var ha={},la=this._getDirectionsTimeAttribute()||{},ia=this._getTimeNeutralAttribute()||{},sa=0,ta=0,za=this.get("stops"),
Fa=za.length-1;0<=Fa;Fa--)if(null!==za[Fa].feature.attributes.ArriveCurbApproach){ha=za[Fa].feature.attributes;break}for(var Ja in ha)ha.hasOwnProperty(Ja)&&(Ja==="Cumul_"+la.name&&(sa=ha[Ja]),Ja==="Cumul_"+ia.name&&(ta=ha[Ja]));ha="esriTrafficLabelHidden";za=D.widgets.directions.noTraffic;Fa=a.totalTime-a.totalDriveTime;Fa=(ta-this._convertCostValue(Fa,la.units,ia.units))/(sa-Fa||1);0<Fa&&.8>Fa?(ha="esriTrafficLabelHeavy",za=D.widgets.directions.heavyTraffic):1===Fa?(ha="esriTrafficLabelNone",za=
D.widgets.directions.noTraffic):1.25<Fa&&(ha="esriTrafficLabelLight",za=D.widgets.directions.ligthTraffic);ia=this._formatTime(ta,!1,ia.units);return{label:za,labelClass:ha,ratio:Fa,noTrafficCostStr:1!==Fa&&ia?ia+" "+D.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:sa,noTrafficCost:ta,timeAtt:la}});if(a.totalLength||a.totalTime){B=B();var T=this._getImpedanceAttribute();l+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";
if(this._isTimeUnits(T.units))l+=this._formatTime(B.trafficCost,!0,B.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+D.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+D.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(B.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+B.labelClass+"'\x3e"+B.label+"\x3c/div\x3e"+B.noTrafficCostStr:"")+this._formatDistance(a.totalLength);
else{T=(T=D.widgets.directions.units[this.directionsLengthUnits])?T.name:"";var Q=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,aa=this.directions.features[0].attributes;l+=c.format(a.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+T+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(B.noTrafficCost&&Q?"\x3cdiv class\x3d'esriTrafficLabel "+B.labelClass+"'\x3e"+B.label+"\x3c/div\x3e"+B.noTrafficCostStr:"")+this._formatTime(a.totalTime)+" "+
("none"!==this.startTime&&B.noTrafficCost&&Q?D.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(aa.arriveTimeUTC,aa.ETA):"")}l+="\x3c/div\x3e\x3c/div\x3e"}return l},_renderDirectionsTable:function(a){for(var l=0,B=0,T=0,Q='\x3ctable summary\x3d"'+a.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',aa=0;aa<a.features.length;aa++){var ha=a.features[aa].attributes;"esriDMTDepart"===ha.maneuverType&&(B=T=0);T+=ha.length;B+=ha.time;l+=ha.time;Q+=this._renderDirectionsItemTR(a.features[aa],
T,B,l)}return Q+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(a,l,B,T){var Q=this.directions,aa=Q?X.indexOf(Q.features,a):-1;T="";var ha=this._css.routeClass,la=a._associatedStopWithReturnToStart&&a._associatedStopWithReturnToStart.attributes,ia=a.attributes;if(-1<aa){ia&&(ia.step=aa+1);ia.maneuverType&&(ha+=" "+ia.maneuverType);la&&null===la.ArriveCurbApproach&&null!==la.DepartCurbApproach?ha+=" "+this._css.routeOriginClass:la&&null!==la.ArriveCurbApproach&&null===la.DepartCurbApproach&&
(ha+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);T+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ha+" "+this._css.routeZoomClass+'" data-segment\x3d"'+aa+'"\x3e';T+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';T+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';T+=this._getLetter(a._associatedStop);T=T+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');T+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';T+='\x3cdiv class\x3d"'+
this._css.routeTextClass+'"\x3e';a=(Q.strings[aa]||[]).slice();if("esriDMTDepart"===ia.maneuverType||"esriDMTStop"===ia.maneuverType)for(Q=0;Q<this.stops.length;Q++)this.stops[Q]&&this.stops[Q].name&&a.push({string:this.stops[Q].name});if(a){ha=ia.text;for(Q=0;Q<a.length;Q++)ha=this._boldText(ha,a[Q].string);ia.formattedText=ha}else ia.formattedText=ia.text;if("esriDMTStop"===ia.maneuverType&&(l||B)||"esriDMTDepart"===ia.maneuverType&&0===aa)l=this._formatDistance(l-ia.length,!0),B=this._formatTime(B-
ia.time),aa=this._formatTime(ia.time),a=this._formatDistance(ia.length,!0),ia.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+l+(l&&B?" \x26middot; ":"")+B+(l||B?"\x3cbr\x3e":"")+(aa?D.widgets.directions.serviceTime+":\x26nbsp;"+aa:"")+(aa&&a?"\x3cbr\x3e":"")+(a?D.widgets.directions.serviceDistance+":\x26nbsp;"+a:"")+"\x3c/div\x3e";T+="\x3cstrong\x3e"+c.format(ia.step)+".\x3c/strong\x3e "+ia.formattedText;T+="\x3c/div\x3e";l=this._formatDistance(ia.length,!0);B=this._formatTime(ia.time);
"esriDMTStop"!==ia.maneuverType&&"esriDMTDepart"!==ia.maneuverType||!this.routeParams.startTime||-22091616E5===ia.ETA?l&&(T+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',T+=l,B&&(T+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+B),T+="\x3c/div\x3e"):T+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ia.arriveTimeUTC,ia.ETA)+"\x3c/div\x3e";T+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return T},_toSpatiallyLocalTimeString:function(a,l){var B=new Date(l),T=
new Date(B.getTime()+6E4*B.getTimezoneOffset());T=R.date.locale.format(T,{selector:"time"});var Q="";a?(Q=(l-a)/1E3/60/60,B=Math.floor(Q),Q=60*(Q-B),B=D.widgets.directions.GMT+(0>B?"":"+")+c.format(B,{pattern:"00"})+c.format(Q,{pattern:"00"}),Q=T+" "+B):Q="now"===this.startTime?R.date.locale.format(B,{selector:"time"}):T;return Q},_addStopWrapperToGraphic:function(a,l){return{extent:new Ia({xmin:a.geometry.x-.25,ymin:a.geometry.y-.25,xmax:a.geometry.x+.25,ymax:a.geometry.y+.25,spatialReference:a.geometry.spatialReference}),
feature:a,name:l}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var a=this.routeParams,l=a.polylineBarriers&&a.polylineBarriers.features||[],B=a.polygonBarriers&&a.polygonBarriers.features||[];X.forEach(a.barriers&&a.barriers.features||[],d.hitch(this,function(T){this._barriersLayer.add(T)}));X.forEach(l,d.hitch(this,function(T){this._polylineBarriersLayer.add(T)}));
X.forEach(B,d.hitch(this,function(T){this._polygonBarriersLayer.add(T)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(a){this._clearDisplayAfterSolve();var l=a.routeResults[0].directions,B=new H;if(l){this.set("solveResult",a);this.set("directions",l);var T=a.routeResults[0].stops,Q,aa;if(T&&T.length){var ha=[];for(Q=0;Q<T.length;Q++){var la=T[Q];la.attributes.isWaypoint=la.attributes.Name===this._waypointName||la.attributes.isWaypoint;
la=this._addStopWrapperToGraphic(la,la.attributes.Name);this.stops[Q]&&this.stops[Q].feature&&this.stops[Q].feature.attributes&&this.stops[Q].feature.attributes.Name===this._userDefinedStopName&&(la.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===Q?this._returnToStartStop=la:ha.push(la)}if(this.stops.length>ha.length)for(Q=0;Q<this.stops.length;Q++)this.stops[Q].feature||""!==this.stops[Q].name||ha.splice(Q,0,this._emptyStop);
this.stops=ha;for(Q=0;Q<this.stops.length;Q++)this._updateStop(this.stops[Q],Q);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new g(l.mergedGeometry,this.get("routeSymbol")));T=[];ha=[];for(Q=la=0;Q<l.featuresWithWaypoints.length;Q++){var ia=l.featuresWithWaypoints[Q];if("esriDMTDepart"===ia.attributes.maneuverType)for(aa=0;aa<this.stops.length;aa++)if(this.stops[aa].feature===ia._associatedStop){la=aa+1;break}ia.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ia);
T.push(ia);(aa=ia.getDojoShape())&&aa.moveToBack();aa=new g(ia.geometry,this._symbolEventPaddingDirections,ia.attributes);aa._nextStopIndex=la-.5;aa._isSnapFeature=!0;ia._associatedSnapFeature=aa;this._waypointsEventLayer.add(aa);"esriDMTDepart"!==ia.attributes.maneuverType&&(aa=ia.geometry.getPoint(0,0))&&(aa=new g(aa,this.maneuverSymbol),aa._directionsFeature=ia._associatedFeatureNoWaypoints,ha.push(aa),this._waypointsEventLayer.add(ha[ha.length-1]))}this.set("displayedRouteGraphics",T);this.set("displayedManeuverPointGraphics",
ha);this._renderDirections();for(Q=0;Q<this.stops.length;Q++)if(this._isStopAWaypoint(this.stops[Q])&&this._modifiedWaypointIndex===Q){for(aa=0;aa<l.featuresWithWaypoints.length;aa++)if(T=l.featuresWithWaypoints[aa],T._associatedStop===this.stops[Q].feature){if("esriDMTStop"===T.attributes.maneuverType||"esriDMTDepart"===T.attributes.maneuverType)this.stops[Q].feature.geometry.x=T.geometry.paths[0][0][0],this.stops[Q].feature.geometry.y=T.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=
null;break}y.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(a)}else a=a.routeResults[0].route,a.setSymbol(this.routeSymbol),this._routeLayer.add(a),this._incrementalRouteSegment=a;B.resolve();this._moveLayersToFront();this.createRouteSymbols();return B.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var a=0;a<this.geocoders.length;a++)this.geocoders[a]&&this.stops[a]&&(this.geocoders[a]._stopReference=this.stops[a])},_setStops:function(){this._setGeocodersStopReference();
this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(a){var l=[];if(a&&a.length){for(var B=0;B<a.length;B++)l.push(this._getCandidate(a[B]));return S(l)}a=new H;a.resolve([]);return a.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";y.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(a){if(a&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var l=a.geometry.getPoint(0,0);a=new g(l,null,
a.attributes,this.get("segmentInfoTemplate"));var B=this.get("map").infoWindow;B.setFeatures([a]);B.show(l)}},_addStopButton:function(){this.addStop().then(d.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var a=this._dnd.getAllNodes();this.geocoders.sort(d.hitch(this,function(B,T){return B.domNode&&B.domNode.parentNode&&B.domNode.parentNode.parentNode&&T.domNode&&T.domNode.parentNode&&T.domNode.parentNode.parentNode?X.indexOf(a,
B.domNode.parentNode.parentNode)>X.indexOf(a,T.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var l=0;l<this.geocoders.length;l++)this.geocoders[l]&&this.geocoders[l].inputNode&&(this.geocoders[l].inputNode.title=D.widgets.directions.stopNoTitle+(l+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var a=0;a<this._resultEvents.length;a++)this._resultEvents[a]&&this._resultEvents[a].remove();
this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(a){var l="",B;for(B in a)if(0===B.indexOf("Total_")&&a.hasOwnProperty(B)){var T=this._getCostAttribute(B.substr(6));T&&(l+=this._isTimeUnits(T.units)?this._formatTime(a[B],!1,T.units):this._formatDistance(a[B],!0,T.units),l+=l?" \x26middot; ":"")}l&&(l=D.widgets.directions.toNearbyStops+": \x3cb\x3e"+l.substr(0,l.length-10)+"\x3c/b\x3e");return l},_formatTime:function(a,l,B){B||(B=(this._getDirectionsTimeAttribute()||{}).units);
var T="";B=Math.round(this._convertCostValue(a,B,"esriNAUMinutes"));a=Math.floor(B/60);B=Math.floor(B%60);l?T=c.format(a,{pattern:100>a?"00":"000"})+":"+c.format(B,{pattern:"00"}):(a&&(T+=a+" "+D.widgets.directions.time.hr+" "),T+=a||B?B+" "+D.widgets.directions.time.min:"");return T},_formatDistance:function(a,l,B){B||(B=this.directionsLengthUnits);var T=this.directionsLengthUnits,Q=D.widgets.directions.units[T],aa=T.replace("esri","").toLowerCase();a=this._convertCostValue(a,B,T);Q&&(aa=l?Q.abbr:
Q.name);return a?c.format(a,{locale:"root",places:2})+" "+aa:""},_projectToGeographic:function(a){var l=new H;if(!a)return l.reject("Directions:: 'geometry' is not defined.",{geometry:a}),l.promise;if(4326==a.spatialReference.wkid)return l.resolve(a),l.promise;if(!this._geometryService)return l.reject("Directions:: Geometry service is not defined."),l.promise;var B=new I;B.outSR=new M(4326);B.geometries=[a];this._geometryService.project(B).then(function(T){l.resolve(T&&T[0])},l.reject);return l.promise},
_createToolbars:function(){this.editToolbar||(this.editToolbar=new tb(this.map));this.drawToolbar||(this.drawToolbar=new pb(this.map),D.toolbars.draw.freehand=D.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=d.hitch(this,function(a){var l=new g(a.geometry,null,{BarrierType:0});this._projectToGeographic(a.geographicGeometry||a.geometry).then(d.hitch(this,function(B){1<wa.geodesicLengths([B],W.METERS)[0]&&(this._polylineBarriersLayer.add(l),this.routeParams.polylineBarriers||
(this.routeParams.polylineBarriers=new gb),this.routeParams.polylineBarriers.features.push(l),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var a=new H;this._globalGeocoder=new ca(this.get("searchOptions"));e.once(this._globalGeocoder,"load",a.resolve,a.reject);this._globalGeocoder.startup();return a.promise},_init:function(){var a=new H;
this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);y.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(a.resolve);else e.once(this.get("map"),"load",d.hitch(this,function(){this._configure().always(a.resolve)}));return a.promise},_setDefaultStops:function(){var a=new H;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(d.hitch(this,function(){this._removeEmptyStops();a.resolve()}),
a.reject):a.resolve();return a.promise},_configure:function(){var a=new H;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(d.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var l=
[this._createRouteTask(),this._setDefaultStops()];S(l).then(d.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var B=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||R.locale.toLowerCase();this._setDirectionsLanguageByLocale(B);this._setupTravelModes().then(d.hitch(this,function(){this.set("loaded",!0);this.onLoad();a.resolve(!0)}),function(T){a.reject(T)})}),function(B){a.reject(B)})}),
function(l){a.reject(l)});this._naRouteSharing=null;return a.promise},_setDirectionsLanguageByLocale:function(a){var l=this.serviceDescription.directionsSupportedLanguages,B=function(Q){if(l)for(var aa=0;aa<l.length;aa++)if(l[aa].toLowerCase().substr(0,2)===Q)return l[aa];return null},T=B(a);T||(a=a.substr(0,2),T=B(a));this.directionsLanguage=T;return this.routeParams.directionsLanguage=T},_getStopSymbol:function(a,l){var B=a&&(a.feature&&a.feature.attributes||a.attributes),T=this.stopSymbol;B&&(T=
this._isStopAWaypoint(a)?this.waypointSymbol:void 0===B.Status||0===B.Status||6===B.Status?null===B.ArriveCurbApproach&&null!==B.DepartCurbApproach?this.get(l?"fromSymbolDrag":"fromSymbol"):null!==B.ArriveCurbApproach&&null===B.DepartCurbApproach?this.get(l?"toSymbolDrag":"toSymbol"):this.get(l?"stopSymbolDrag":"stopSymbol"):this.get(l?"unreachedSymbolDrag":"unreachedSymbol"));return T},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),
this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(a){a.target===this._useMilesNode?this.setDirectionsLengthUnits(W.MILES):a.target===this._useKilometersNode&&this.setDirectionsLengthUnits(W.KILOMETERS)},_toggleCheckbox:function(a){var l=n.get(a.target,"checked");a.target===this._findOptimalOrderNode?this.set("optimalRoute",l):a.target===this._useTrafficNode?this.set("traffic",l):a.target===this._returnToStartNode&&this.set("returnToStart",l)},_isStopLocated:function(a){return a&&
a.feature&&a.feature.attributes&&(!a.feature.attributes.Status||6===a.feature.attributes.Status)},_configureRouteOptions:function(){var a=this.get("routeParams"),l;this.get("directionsLengthUnits")?a.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",a.directionsLengthUnits);a.findBestSequence=this.get("optimalRoute");if(a.findBestSequence)for(a.preserveFirstStop=this._isStopLocated(this.stops[0]),a.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-
1])||this.returnToStart&&this._isStopLocated(this.stops[0]),l=0;l<this.stops.length;)this._isStopAWaypoint(this.stops[l])?this._removeStop(l,!0,!0):l++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(l=this.stops.length-1;0<l;)this._isStopAWaypoint(this.stops[l])&&this._removeStop(l,!0,!0),l--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(a.useTimeWindows=!0,
"now"===this.startTime)a.timeWindowsAreUTC=!0,a.startTimeIsUTC=!0,a.startTime=new Date;else if("none"===this.startTime)a.startTime=null;else{a.timeWindowsAreUTC=!1;a.startTimeIsUTC=!1;var B=this._departAtTime,T=6E4*B.getValue().getTimezoneOffset();B=new Date(B.getValue().getTime()+this._departAtDate.getValue().getTime()-T);B=new Date(B.getTime()-6E4*B.getTimezoneOffset());a.startTime=B}else a.startTime=null,a.useTimeWindows=!1;B=this._getImpedanceAttribute();T=this._getTimeNeutralAttribute();var Q=
this._getDirectionsTimeAttribute();l=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;T&&-1===X.indexOf(l,T.name)&&l.push(T.name);!this._isTimeUnits(B.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&Q&&-1===X.indexOf(l,Q.name)&&l.push(Q.name);this.routeParams.accumulateAttributes=l;a.returnStops=!0;Q=[];for(l=0;l<this.stopGraphics.length;l++)if(this.stopGraphics[l]&&(Q.push(new g(this.stopGraphics[l].toJson())),l)){var aa=Q[0].attributes,
ha=Q[l].attributes;for(la in ha)ha.hasOwnProperty(la)&&!aa.hasOwnProperty(la)&&(aa[la]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var la=new g(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(la,la.attributes.Name);Q.push(la)}else this._returnToStartStop=null;a.stops.features=Q;if(T)for(l=0;l<Q.length;l++)Q[l].attributes["Attr_"+T.name]=this._convertCostValue(Q[l].attributes["Attr_"+B.name],B.units,T.units);
this.set("routeParams",a)},_configureRoute:function(){var a=new H;a.promise.always(d.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var l=this._incrementalSolveStopRange;l.start<l.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(l.start,l.end+1):l.start>l.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(l.start,this.routeParams.stops.features.length-
1).concat(this.routeParams.stops.features.slice(0,l.end+1)))}else this._incrementalSolveStopRange=null;var B={},T=this.routeParams.stops.features;for(l=0;l<T.length;l++){var Q=T[l].attributes.address;var aa=(l===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:Q)+"_"+this._stopSequence++;T[l].attributes.Name=aa;B[aa]=Q;delete T[l].attributes.address;delete T[l].attributes.isWaypoint;delete T[l].attributes.Status}this._solveInProgress=!0;
var ha={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,d.hitch(this,function(la){this._solveResultProcessing(la,B,ha).then(a.resolve,a.reject)}),d.hitch(this,function(la){d.mixin(this,ha);this._solveInProgress=!1;for(var ia=0;ia<this.stops.length;ia++)this.stops[ia].feature&&(this.stops[ia].feature.attributes=d.mixin(this.stops[ia].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();
this._routeTaskError(la);a.reject(la)}));return a.promise},_solveResultProcessing:function(a,l,B){var T=new H;d.mixin(this,B);this._solveInProgress=!1;B=a.routeResults[0];var Q=B.directions;B=B.stops;if(Q){this._solverMessages=a.messages;var aa=function(ta){for(var za in l)if(ta&&0===Q.routeName.indexOf(za)||!ta&&0<Q.routeName.indexOf(za))return l[za];return""};var ha=aa(!0);aa=aa(!1);Q.routeName=(ha!==this._waypointName?ha:D.widgets.directions.waypoint)+" \u2014 "+(aa!==this._waypointName?aa:D.widgets.directions.waypoint);
for(ha=0;ha<Q.features.length;ha++)if(aa=Q.features[ha].attributes,"esriDMTDepart"===aa.maneuverType||"esriDMTStop"===aa.maneuverType)for(var la in l)if(l.hasOwnProperty(la)&&-1<aa.text.indexOf(la)){aa.text=aa.text.replace(la,l[la]);for(var ia=0;ia<B.length;ia++){var sa=B[ia].attributes;if(sa.Name===la){d.mixin(Q.features[ha],{_associatedStop:B[this.returnToStart&&ia===B.length-1?0:ia],_associatedStopWithReturnToStart:B[ia]});if(!sa.ArriveTime&&!sa.ArriveTimeUTC&&aa.ETA&&aa.arriveTimeUTC){sa.ArriveTime=
aa.ETA;sa.ArriveTimeUTC=aa.arriveTimeUTC;ia=0;if(0==ha&&"esriDMTDepart"===aa.maneuverType||0<ha&&"esriDMTStop"===aa.maneuverType)ia=this._convertCostValue(aa.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");sa.DepartTime=sa.ArriveTime+ia;sa.DepartTimeUTC=sa.ArriveTimeUTC+ia}break}}}for(ha=0;ha<B.length;ha++)this._returnToStartStop&&B[ha].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=ha),B[ha].attributes.Name=l[B[ha].attributes.Name];
this._directionsPostprocessing(Q);this.traffic&&this._updateMapTimeExtent()}this._showRoute(a).always(d.hitch(this,function(){this._incrementalSolveStopRange=null;T.resolve(a)}));return T.promise},_directionsPostprocessing:function(a){var l,B=function(aa,ha){var la=a.features[aa]._associatedFeaturesWithWaypoints||[];la.push(a.featuresWithWaypoints[ha]);a.features[aa]._associatedFeaturesWithWaypoints=la;a.featuresWithWaypoints[ha]._associatedFeatureNoWaypoints=a.features[aa]};var T=d.hitch(this,function(aa){return"\x3cdiv class\x3d'"+
this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(aa._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});a.featuresWithWaypoints=[];for(l=0;l<a.features.length;l++){var Q=new g(a.features[l].toJson());Q.setInfoTemplate(new U({title:this._i18n.widgets.directions.maneuver,content:T}));a.featuresWithWaypoints.push(Q);a.featuresWithWaypoints[l]._associatedStop=a.features[l]._associatedStop;a.featuresWithWaypoints[l]._associatedStopWithReturnToStart=a.features[l]._associatedStopWithReturnToStart}a.stringsWithWaypoints=
d.mixin([],a.strings);a.eventsWithWaypoints=d.mixin([],a.events);for(T=l=0;l<a.features.length;)a.features[l]._associatedStop&&a.features[l]._associatedStop.attributes.Name===this._waypointName?(a.features.splice(l,l?2:1),a.strings.splice(l,l?2:1),a.events.splice(l,l?2:1),l&&a.features[l]&&"esriDMTStraight"===a.features[l].attributes.maneuverType?(Q=a.features.splice(l,1)[0],a.strings[l-1]=(a.strings[l-1]||[]).concat(a.strings.splice(l,1)[0]||[]),a.strings[l-1].length||(a.strings[l-1]=void 0),a.events[l-
1]=(a.events[l-1]||[]).concat(a.events.splice(l,1)[0]||[]),a.events[l-1].length||(a.events[l-1]=void 0),a.features[l-1].attributes.length+=Q.attributes.length,a.features[l-1].attributes.time+=Q.attributes.time,a.features[l-1].geometry.paths[0]=a.features[l-1].geometry.paths[0].concat(Q.geometry.paths[0]),B(l-1,T++),B(l-1,T++),B(l-1,T++)):(l&&B(l-1,T++),l<a.features.length&&B(l,T++))):(B(l,T++),l++)},_boldText:function(a,l){var B=a;try{var T=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+l.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,
"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");B=(" "+B+" ").replace(T,"\x3cstrong\x3e\x26nbsp;"+l+"\x26nbsp;\x3c/strong\x3e");B=B.trim()}catch(Q){}return B},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var a=0;a<this.stopGraphics.length;a++)this._stopLayer.remove(this.stopGraphics[a]),this._stopLayer.remove(this.textGraphics[a]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var a=this.directions&&this.directions.features[0]&&
this.directions.features[0].attributes||{},l=(new Date).getTime();l="none"==this.startTime?l:a.arriveTimeUTC||l;this._useTrafficItemNode.title="none"!==this.startTime&&a.arriveTimeUTC?D.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(a.arriveTimeUTC,a.ETA):"";this._myTimeExtentUpdate=!0;a=new Date(l);this.map.setTimeExtent(new N(a,a))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var a=
this.displayedRouteGraphics,l=this.displayedManeuverPointGraphics,B=this._routeLayer,T=this._waypointsEventLayer,Q=0,aa=0,ha=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};a&&aa<a.length;){if(a[aa]._associatedStop)for(var la=0;la<this.stops.length;la++)if(this.stops[la].feature===a[aa]._associatedStop){Q=la;break}Q>=ha.start&&Q<ha.end||ha.start>=ha.end&&(Q>=ha.start||Q<ha.end)?(B.remove(a[aa]),a.splice(aa,1)):aa++}B.remove(this._incrementalRouteSegment);
this.set("displayedRouteGraphics",a?a:[]);l&&l.length&&X.forEach(l,function(ia){T.remove(ia)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var a=this.get("map").infoWindow;a&&(a.hide(),a.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();
this.clearMessages()},_getLetter:function(a){var l=this.alphabet,B="",T=function(ha){var la="";"0123456789"===l||"1234567890"===l?la=String(ha+1):(ha=ha||0,ha>=l.length&&(la=T(Math.floor(ha/l.length)-1),ha%=l.length),la+=l[ha]);return la},Q=a instanceof g?d.hitch(this,function(){for(var ha=this.get("returnToStart")?0:-1,la=0;la<this.stops.length;la++)if(this.stops[la].feature===a){ha=la;break}return ha})():a;if(-1<Q&&l&&l.length){l instanceof Array&&(l=l.toString().replace(/,/g,""));B=-1;for(var aa=
0;aa<=Q;aa++)B+=this._isStopAWaypoint(this.stops[aa])?0:1;B=T(B)}return B},_solveAndZoom:function(a){if(this.autoSolve)return this._getDirections().then(d.hitch(this,function(){a||this.zoomToFullRoute()}));var l=new H;l.resolve();return l.promise},_setupEvents:function(){this._onEvents.push(e(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(e(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",d.hitch(this,function(Q){Q&&("click"===Q.type||
"keydown"===Q.type&&Q.keyCode===q.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(e(this._printButton,"click, keydown",d.hitch(this,function(Q){Q&&("click"===Q.type||"keydown"===Q.type&&Q.keyCode===q.ENTER)&&this._printDirections()})));this._onEvents.push(e(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",d.hitch(this,function(Q){Q&&("click"===Q.type||"keydown"===Q.type&&Q.keyCode===q.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(e(this._dndNode,"[data-remove]:click, [data-remove]:keydown",
d.hitch(this,function(Q){if(Q&&("click"===Q.type||"keydown"===Q.type&&Q.keyCode===q.ENTER)){var aa=w("[data-remove]",this._dndNode);Q=X.indexOf(aa,Q.target);this.removeStop(Q)}})));this._onEvents.push(e(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",d.hitch(this,function(Q){if(Q&&("click"===Q.type||"keydown"===Q.type&&Q.keyCode===q.ENTER)){var aa=w("[data-center-at]",this._dndNode);Q=X.indexOf(aa,Q.target);this.stops[Q]&&this.stops[Q].feature&&this.stops[Q].feature.geometry&&this.map.centerAndZoom(this.stops[Q].feature.geometry)}})));
this._onEvents.push(e(this.map,"zoom-end",d.hitch(this,function(){var Q=this._segmentGraphics;Q&&Q[0]&&void 0!==Q[0].attributes._index&&this.highlightSegment(Q[0].attributes._index,!0)})));this._onEvents.push(e(this._dnd,"Drop",d.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var Q,aa=!1,ha=[],la=this._dnd.getAllNodes();for(Q=0;Q<this.geocoders.length;Q++){var ia=X.indexOf(la,this.geocoders[Q]._tr);if(-1<ia&&Q!==ia&&Q!==ia-1){for(;0<ia&&this._isStopAWaypoint(this.stops[ia]);)ia--;
aa=!0;break}}aa&&(ha=this._markWPsForRemovalAfterUserChangedStopSequence(Q,ia));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ha);this.stops[ia].name&&this.getDirections()})));this._onEvents.push(e(this._dnd,"DndStart",d.hitch(this,function(){var Q=w("body")[0];K.add(Q,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(e(this._dnd,"DndDrop, DndCancel",d.hitch(this,function(){var Q=w("body")[0];K.remove(Q,this._css.dndDragBodyClass);
this._setLocateButtonVisibilityEvents()})));var a=this._handle,l=d.hitch(this,function(Q){var aa=d.hitch(this,function(la,ia,sa,ta,za){var Fa=a._isShown();a.setGeometry(la);a._tooltip.style.left=Q.screenPoint.x+"px";a._tooltip.style.top=Q.screenPoint.y+"px";!Fa||a._index===sa&&a.attributes.isWaypoint===ta||(a._remove(),Fa=!1);a.setSymbol(ia);a._index=sa;a._isStopIcon=a._index===Math.floor(a._index);a.attributes.isWaypoint=ta;a._isStopIcon&&(a.attributes.address=this.stopGraphics[sa].attributes.address,
a.setInfoTemplate(this.stopGraphics[sa].infoTemplate));if(this.canModifyWaypoints||a._isStopIcon)Fa||(this._stopLayer.add(a),(la=a.getDojoShape())&&la[ta?"moveToBack":"moveToFront"].call(la)),this.editToolbar.activate(tb.MOVE,a);ta=ta?a._isStopIcon?D.widgets.directions.dragWaypoint:this.canModifyWaypoints?D.widgets.directions.dragRoute:"":D.widgets.directions.dragStop;a._showTooltip(za||ta)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&
!a._solveTimeout)if(clearTimeout(a._removeTimeout),(Q.graphic._isStopIcon||Q.graphic._isStopLabel)&&!Q.graphic.attributes.isWaypoint&&this.canModifyStops||Q.graphic._isStopIcon&&Q.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ha=Q.graphic._isStopLabel?this.stopGraphics[Q.graphic._index]:Q.graphic;aa(ha.geometry,this._getStopSymbol(this.stops[ha._index],!0),ha._index,!0===ha.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ha._index]);this._stopLayer.remove(this.textGraphics[ha._index])}else if(Q.graphic._isSnapFeature||
Q.graphic._isHandle&&!Q.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(Q.screenPoint).then(d.hitch(this,function(la){if(!this.maxStopsReached&&!this._moveInProgress&&la){for(var ia=this.displayedManeuverPointGraphics,sa=null,ta=0;ta<ia.length;ta++)if(ia[ta].geometry.x===la.x&&ia[ta].geometry.y===la.y){sa=ia[ta]._directionsFeature;ia=X.indexOf(this.directions.features,sa);-1<ia&&this.highlightSegment(ia);break}aa(la,
Q.graphic._isHandle?a.symbol:this.waypointSymbol,Q.graphic._isHandle?a._index:Q.graphic._nextStopIndex,Q.graphic._isHandle?a.attributes.isWaypoint:!0,sa)}}))}),B=d.hitch(this,function(){clearTimeout(a._removeTimeout);a._removeTimeout=setTimeout(a._remove,100);this.unhighlightSegment()}),T=d.hitch(this,function(Q){if(this.barrierToolActive){Q=Q.graphic;var aa=this.routeParams,ha=aa.barriers?X.indexOf(aa.barriers.features,Q):-1,la=aa.polygonBarriers?X.indexOf(aa.polygonBarriers.features,Q):-1,ia=aa.polylineBarriers?
X.indexOf(aa.polylineBarriers.features,Q):-1;-1<ha&&aa.barriers.features.splice(ha,1);-1<la&&aa.polygonBarriers.features.splice(la,1);-1<ia&&aa.polylineBarriers.features.splice(ia,1);this._barriersLayer.remove(Q);this._polygonBarriersLayer.remove(Q);this._polylineBarriersLayer.remove(Q);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",l));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",B));this._onEvents.push(this._stopLayer.on("mouse-move",
l));this._onEvents.push(this._stopLayer.on("mouse-out",B));this._onEvents.push(this._barriersLayer.on("click",T));this._onEvents.push(this._polylineBarriersLayer.on("click",T));this._onEvents.push(this._polygonBarriersLayer.on("click",T));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",
this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",
d.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",d.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",d.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",d.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",d.hitch(this,function(){this._setSearchOptions();
this._createGlobalGeocoder();var Q=this.get("searchOptions").sources;if(Q)for(var aa=0;aa<this.geocoders.length;aa++)this.geocoders[aa].set("sources",Q)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",
this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));
this._watchEvents.push(this.watch("showPrintPage",function(){y.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){y.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var a=d.hitch(this,function(B){var T="";if((B=B.routeResults?B.routeResults[0]:null)&&B.route){B=B.route.attributes;var Q=this.routeParams.travelMode;if(Q){T+="\x3cb\x3e"+
Q.name+"\x3c/b\x3e "+D.widgets.directions.toNearbyStops+": ";var aa=void 0!==B["Total_"+Q.timeAttributeName]?this._formatTime(B["Total_"+Q.timeAttributeName],!1,(this._getCostAttribute(Q.timeAttributeName)||{}).units):"";T+=(void 0!==B["Total_"+Q.distanceAttributeName]?this._formatDistance(B["Total_"+Q.distanceAttributeName],!0,(this._getCostAttribute(Q.distanceAttributeName)||{}).units):"")+(aa?" \x26middot; "+aa:"")}else T=this._formatArbitraryCostsForRouteTooltip(B)}this._handle._showTooltip(T)}),
l=d.hitch(this,function(B,T){var Q=new H,aa=this._handle,ha=this.map.toScreen(aa._origPoint).offset(B.transform.dx+aa.symbol.xoffset,B.transform.dy+aa.symbol.yoffset);B.origMapPoint||(B.origMapPoint=this.map.toMap(ha));y.set(aa._tooltip,"left",ha.x+"px");y.set(aa._tooltip,"top",ha.y+"px");clearTimeout(aa._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())aa._solveTimeout=setTimeout(function(){l(B,T).always(Q.resolve)},100);else if(aa._isStopIcon){ha=B.graphic._index;var la=
this.stops[ha];(la=la?{name:la.name,extent:la.extent,feature:new g(la.feature.toJson())}:null)?(la.feature.setGeometry(B.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ha])?ha:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+ha-1)%this.stops.length:Math.max(0,ha-1),end:this.returnToStart?(ha+1)%this.stops.length:Math.min(this.stops.length-1,ha+1)},this.updateStop(la,ha,T).always(d.hitch(this,function(ia){aa._solveTimeout=null;ia.routeResults&&
a(ia);Q.resolve()}))):Q.resolve()}else Q.resolve();return Q.promise});this._onEvents.push(e(this.editToolbar,"graphic-click",d.hitch(this,function(B){if(B.graphic.attributes.isWaypoint)!B.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(B.graphic._index,!0).always(d.hitch(this,function(){this._moveInProgress=!1})));else{var T=this.get("map").infoWindow;T&&(T.setFeatures([B.graphic]),T.show(B.graphic.geometry))}})));this._onEvents.push(e(this.editToolbar,
"graphic-move-start",d.hitch(this,function(B){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;B=B.graphic;B._origPoint=new Ba(B.geometry.toJson());B._maxDeviation=0;B._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(e(this.editToolbar,"graphic-move-stop",d.hitch(this,function(B){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;
if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)l(B,!0).always(d.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var T=this.stops[B.graphic._index],Q=(T&&T.feature&&T.feature.attributes&&T.feature.attributes.Name)===this._userDefinedStopName,aa=T&&T.name;this._reverseGeocode(new g(B.graphic.toJson())).then(d.hitch(this,
function(ha){Q&&(ha.name=aa,ha.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ha,ha.feature.geometry,B.graphic._index).always(d.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(e(this.editToolbar,"graphic-move",d.hitch(this,function(B){var T=this._handle,Q=B.transform;Q.dx&&Q.dy&&(B.graphic._maxDeviation=Math.max(T._maxDeviation,Math.sqrt(Q.dx*
Q.dx+Q.dy*Q.dy)));10<T._maxDeviation&&(T._solveHasHappened=!0,B.graphic===T&&T.attributes.isWaypoint&&!T._isStopIcon?(this.set("optimalRoute",!1),T._index+=.5,T._isStopIcon=!0,B.graphic._stopIndex=T._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+T._index-1)%this.stops.length:Math.max(0,T._index-1),end:this.returnToStart?(T._index+1)%(this.stops.length+1):Math.min(this.stops.length,T._index+1)},this.addStop({name:this._waypointName,feature:new g(T.geometry,T.symbol,
{isWaypoint:!0,CurbApproach:3})},B.graphic._stopIndex)):((T=B.graphic.getDojoShape())&&T.moveToFront(),l(B)))})))},_isStopAWaypoint:function(a){return a&&a.feature&&a.feature.attributes&&a.feature.attributes.isWaypoint},_getStopCount:function(){var a=0,l;for(l=0;l<this.stops.length;l++)a+=!this._isStopAWaypoint(this.stops[l])&&this.stops[l].name?1:0;return a},_getWaypointCount:function(){var a=0,l;for(l=0;l<this.stops.length;l++)a+=this._isStopAWaypoint(this.stops[l])?1:0;return a},_decorateUngeocodedStop:function(a){var l=
new H,B=function(Q,aa){l.resolve({name:void 0===Q?D.widgets.directions.unlocatedStop:Q.toFixed(6)+" "+aa.toFixed(6),feature:a})};if(a.geometry)if(a.geometry.spatialReference&&4326!==a.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var T=oa.xyToLngLat(a.geometry.x,a.geometry.y);B(T[0],T[1])}else this._geometryService?(T=new I,T.outSR=new M(4326),T.geometries=[a.geometry],this._geometryService.project(T).then(d.hitch(this,function(Q){Q&&
Q.length?B(Q[0].x,Q[0].y):B(a.geometry.x,a.geometry.y)}),d.hitch(this,function(){B()}))):B(a.geometry.x,a.geometry.y);else B(a.geometry.x,a.geometry.y);else B();return l.promise},_trafficLayerUpdate:function(a,l,B){a=this.get("map");l&&this._trafficLayerAdded&&(a.removeLayer(l),this._trafficLayerAdded=!1);B&&this.get("traffic")&&!this._trafficLayerAdded&&(a.addLayer(B),B.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(a){var l=D.widgets.directions.error.routeTask,B=a.details,T=function(Q){return(res=
Q.match(/(\d+)/))?": "+res[0]:"."};B&&1===B.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===B[0]?l=D.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===B[0]?l=D.widgets.directions.error.nonNAmTruckingMode:0===B[0].indexOf("The number of input locations loaded into Barriers")?l=D.widgets.directions.error.tooManyBarriers+T(B[0]):0===B[0].indexOf("The number of input locations loaded into PolygonBarriers")?
l=D.widgets.directions.error.tooManyPolygonBarriers+T(B[0]):0===B[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(l=D.widgets.directions.error.tooManyPolylineBarriers+T(B[0])));this._showMessage(l);this.onDirectionsFinish(a)},_showMessage:function(a,l){var B="";this.messages.push({msg:a,error:!l});if(this.messages.length){B+="\x3cul\x3e";for(var T=0;T<this.messages.length;T++)B+='\x3cli class\x3d"'+(this.messages[T].error?this._css.routesErrorClass:this._css.routesInfoClass)+
'"\x3e'+this.messages[T].msg+"\x3c/li\x3e";B+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=B);if(!l)this.onError(a)},_isTimeUnits:function(a){return"milliseconds"===a||"esriNAUSeconds"===a||"esriNAUMinutes"===a||"esriNAUHours"===a||"esriNAUDays"===a},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var a=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(a)},_getCostAttribute:function(a){for(var l=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],B,T=0;T<l.length;T++)if(l[T].name===a&&"esriNAUTCost"===l[T].usageType){B=
l[T];break}return B},_convertCostValue:function(a,l,B){var T=this._isTimeUnits(l),Q=this._isTimeUnits(B);l=T?this._toMinutes(a,l):this._toMeters(a,l);return T===Q?Q?this._fromMinutes(l,B):this._fromMeters(l,B):a},_toMinutes:function(a,l,B){a=a||0;switch(l){case "milliseconds":a/=Math.pow(6E4,B?-1:1);break;case "esriNAUSeconds":a/=Math.pow(60,B?-1:1);break;case "esriNAUHours":a*=Math.pow(60,B?-1:1);break;case "esriNAUDays":a*=Math.pow(1440,B?-1:1)}return a},_fromMinutes:function(a,l){return this._toMinutes(a,
l,!0)},_toMeters:function(a,l,B){a=a||0;switch((l||"").replace("esriNAU","esri")){case "esriInches":a*=Math.pow(.0254,B?-1:1);break;case "esriFeet":a*=Math.pow(.3048,B?-1:1);break;case "esriYards":a*=Math.pow(.9144,B?-1:1);break;case "esriMiles":a*=Math.pow(1609.344,B?-1:1);break;case "esriNauticalMiles":a*=Math.pow(1851.995396854,B?-1:1);break;case "esriMillimeters":a/=Math.pow(1E3,B?-1:1);break;case "esriCentimeters":a/=Math.pow(100,B?-1:1);break;case "esriKilometers":a*=Math.pow(1E3,B?-1:1);break;
case "esriDecimeters":a/=Math.pow(10,B?-1:1)}return a},_fromMeters:function(a,l){return this._toMeters(a,l,!0)},_createRouteTask:function(){var a=new H;this.set("routeTask",new kb(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(d.hitch(this,function(l){l.networkDataset?(this.set("serviceDescription",l),this.set("maxStops",parseInt(this.userOptions.maxStops||l.serviceLimits&&l.serviceLimits.Route_MaxStops||
this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,a.resolve()):this.routeTask.getOwningSystemUrl().then(d.hitch(this,function(B){this.owningSystemUrl=B;a.resolve()}),a.reject)):(this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription),a.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription)))}),d.hitch(this,function(){this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription);a.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription));
this.mapClickActive=!1;this._activate()}));return a.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var a=d.hitch(this,function(T){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",T);for(var Q=0;Q<this.geocoders.length;Q++)this.geocoders[Q].set("activeSourceIndex",T);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var l=[{value:"all",label:D.widgets.Search.main.all,
selected:!0}],B=0;B<this._globalGeocoder.sources.length;B++)l.push({value:String(B),label:this._globalGeocoder.sources[B].name});this._searchSourceSelector=new G({className:"esriSearchSourcesDDL",style:"width:100%;",options:l},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",a);this._searchSourceSelector.domNode.style.width=""}a("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},
_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new G({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",d.hitch(this,function(a){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(a).always(d.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=
!0})))},_setupTravelModes:function(){var a=this.get("serviceDescription"),l=a.supportedTravelModes,B=new H;if(l&&l.length&&this._travelModeSelector){for(var T=l[0].name,Q=[],aa=0;aa<l.length;aa++){for(var ha="AUTOMOBILE"===l[aa].type?"Driving":"TRUCK"===l[aa].type?"Trucking":"WALK"===l[aa].type?"Walking":"Other",la="",ia=a.networkDataset.networkAttributes,sa=0;sa<ia.length;sa++){var ta=ia[sa];if(ta.name===l[aa].impedanceAttributeName){if("esriNAUCentimeters"===ta.units||"esriNAUDecimalDegrees"===
ta.units||"esriNAUDecimeters"===ta.units||"esriNAUFeet"===ta.units||"esriNAUInches"===ta.units||"esriNAUKilometers"===ta.units||"esriNAUMeters"===ta.units||"esriNAUMiles"===ta.units||"esriNAUMillimeters"===ta.units||"esriNAUNauticalMiles"===ta.units||"esriNAUYards"===ta.units)la="Distance";else if("esriNAUDays"===ta.units||"esriNAUHours"===ta.units||"esriNAUMinutes"===ta.units||"esriNAUSeconds"===ta.units)la="Time";break}}Q.push({id:l[aa].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+
ha+la+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+l[aa].description+'"\x3e'+l[aa].name+"\x3c/div\x3e"});!a.defaultTravelMode||l[aa].id!==a.defaultTravelMode&&l[aa].itemId!==a.defaultTravelMode||(T=l[aa].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new f({objectStore:new x({data:Q})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(T);this._setTravelMode(T).always(B.resolve)}else this._checkStartTimeUIAvailability(),
this.set("showTravelModesOption",!1),B.resolve();return B.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new rb(this.printTaskUrl,{async:!1}):null;var a=new sb;a.exportOptions={width:670,height:750,dpi:96};a.format="PNG32";a.layout="MAP_ONLY";a.preserveScale=!1;a.showAttribution=!1;var l=new wb;l.map=this.map;l.outSpatialReference=this.map.spatialReference;l.template=a;this._printParams=l},_createGeometryTask:function(){this._geometryService=
null;this._usingAGOL()?this._geometryService=new db(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new db(this.defaults.geometryTaskUrl):xb.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var a=this.get("serviceDescription");y.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&a&&a.supportedTravelModes&&a.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":
"none")},_showMilesKilometersOption:function(){y.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){y.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){y.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){y.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?
"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var a={returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new gb,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var l=new mb;this.routeParams=d.mixin(l,{outputGeometryPrecision:0,
outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),a)},_markWPsForRemovalAfterUserChangedStopSequence:function(a,l){for(var B=a-1,T=[];0<=B&&this._isStopAWaypoint(this.stops[B]);)T.push(this.stops[B]),B--;for(B=a+1;B<this.stops.length&&this._isStopAWaypoint(this.stops[B]);)T.push(this.stops[B]),B++;if(l>a)for(B=l+1;B<this.stops.length&&this._isStopAWaypoint(this.stops[B]);)T.push(this.stops[B]),B++;else if(void 0!==l)for(B=l-1;0<=B&&this._isStopAWaypoint(this.stops[B]);)T.push(this.stops[B]),
B--;else if(this.returnToStart&&0===a)for(B=this.stops.length-1;0<=B&&this._isStopAWaypoint(this.stops[B]);)T.push(this.stops[B]),B--;return T},_removeSomeWaypoints:function(a){for(var l=new H,B=[],T=0;T<a.length;T++){var Q=X.indexOf(this.stops,a[T]);-1<Q&&B.push(this._removeStop(Q,!0,!0))}S(B).always(l.resolve);return l.promise},_modifyStopSequence:function(a,l){var B=this._dnd.getAllNodes(),T=new H,Q,aa=[];if(B.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==a)if(0<=
a&&0<=l&&a<this.stops.length&&l<this.stops.length&&a!==l){B=this._markWPsForRemovalAfterUserChangedStopSequence(a,l);var ha=this.stops.splice(a,1);this.stops.splice(l,0,ha[0]);for(Q=0;Q<this.stops.length;Q++)aa.push(this._updateStop(this.stops[Q],Q));aa.push(this._removeSomeWaypoints(B));S(aa).always(d.hitch(this,function(){this._solveAndZoom().always(T.resolve)}))}else T.reject("Invalid From and To values.");else{for(Q=0;Q<this.stops.length;)this._isStopAWaypoint(this.stops[Q])?aa.push(this._removeStop(Q,
!0,!0)):Q++;S(aa).always(d.hitch(this,function(){aa=[];this.stops.reverse();for(Q=0;Q<this.stops.length;Q++)aa.push(this._updateStop(this.stops[Q],Q));S(aa).always(d.hitch(this,function(){this._solveAndZoom().always(T.resolve)}))}))}else T.resolve();return T.promise},_setMenuNodeValues:function(a){"traffic"!==a&&this._clearDisplayBeforeSolve();a=this.get("optimalRoute");this._findOptimalOrderNode&&n.set(this._findOptimalOrderNode,"checked",a);this._returnToStartNode&&(a=this.returnToStart&&!this.maxStopsReached&&
this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),n.set(this._returnToStartNode,"checked",a),this.set("returnToStart",a),this.maxStopsReached&&this.returnToStart&&this._showMessage(D.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,a=this.stops.length;0<a--&&this._isStopAWaypoint(this.stops[a]);)this._removeSomeWaypoints([this.stops[a]]);
this._useTrafficNode&&(n.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case W.KILOMETERS:n.set(this._useKilometersNode,"checked",!0);n.set(this._useMilesNode,"checked",!1);break;case W.MILES:n.set(this._useKilometersNode,"checked",!1),n.set(this._useMilesNode,"checked",!0)}y.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");y.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&y.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&y.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&y.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?K.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(K.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===y.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?K.add(this._widgetContainer,this._css.stopsRemovableClass):
K.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(a,l,B){K.remove(this.domNode,l);K.add(this.domNode,B)},_toggleOptionsMenu:function(){"block"===y.get(this._optionsMenuNode,"display")?(y.set(this._optionsMenuNode,"display","none"),K.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
D.widgets.directions.showOptions):(y.set(this._optionsMenuNode,"display","block"),K.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=D.widgets.directions.hideOptions)},_toggleSaveMenu:function(a){"block"===y.get(this._saveMenuNode,"display")||!1===a?(y.set(this._saveMenuNode,"display","none"),K.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),y.set(this._saveMenuNode,"display","block"),K.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(d.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var l=this._folderSelector.store.objectStore.data,B=0;B<l.length;B++)if(l[B].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==l[B].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(l[B].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){K[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(A,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(a){a=O.toUrl(a);return/^https?:/i.test(a)?a:/^\/\//i.test(a)?Y+a:/^\//i.test(a)?Y+"//"+window.location.host+a:a},_getManeuverImage:function(a){return a?"esriDMTStop"===a||"esriDMTDepart"===a?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+a+".png"):""},_loadPrintDirections:function(a){var l=this.get("printTemplate"),B=new H;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(B.resolve,
B.reject):B.resolve();B.then(d.hitch(this,function(){if(!l&&this.directions){var T=this._getAbsoluteUrl("./css/Directions.css"),Q=this._getAbsoluteUrl("./css/DirectionsPrint.css"),aa=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ha=m.isBodyLtr()?"ltr":"rtl";l="";l+="\x3c!DOCTYPE HTML\x3e";l+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ha+'"\x3e';l+="\x3chead\x3e";l+='\x3cmeta charset\x3d"utf-8"\x3e';l+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
l+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";l+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+T+'" /\x3e';l+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+Q+'" /\x3e';l+="\x3c/head\x3e";l+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';l+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';l+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+D.common.close+'" onclick\x3d"window.close();"\x3e'+
D.common.close+"\x3c/div\x3e";l+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+D.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+D.widgets.directions.print+"\x3c/div\x3e";l+="\x3c/div\x3e";l+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';l+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';l+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+aa+'" /\x3e';l+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";l+=this._renderDirectionsSummary(this.directions);a&&(l+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',l+='\x3chr class\x3d"esriNoPrint"/\x3e');l+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';l+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+D.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
l+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';l+="\x3c/div\x3e";l+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';l+=this._renderDirectionsTable(this.directions);l+="\x3c/div\x3e";l+="\x3c/div\x3e";l+="\x3c/div\x3e";l+="\x3c/body\x3e";l+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(l);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var a=
this._searchSourceSelector;if(this._searchSourceSelector){var l=a.containerNode.firstChild;y.set(l,"width","");a.domNode.clientWidth>this.domNode.clientWidth&&y.set(l,"width",this._searchSourceContainerNode.clientWidth-20+"px")}},_printDirections:function(){if(this.directions){var a=screen.width/2,l=screen.height/1.5;a="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+a+", height\x3d"+l+", top\x3d"+(screen.height/2-l/2)+
", left\x3d"+(screen.width/2-a/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",a,!0)):(this._printWindow=window.open("","directions_widget_print",a,!0),this._loadPrintDirections(!!this._printService),this._printService&&O(["dojo/_base/window"],d.hitch(this,function(B){this.zoomToFullRoute().then(d.hitch(this,function(){this._printService.execute(this._printParams,d.hitch(this,function(T){B.withDoc(this._printWindow.document,
function(){var Q=k.byId("divMap");Q&&(K.remove(Q,"esriPrintWait"),K.add(Q,"esriPageBreak"),A.create("img",{src:T.url,"class":"esriPrintMapImg"},Q))})}),d.hitch(this,function(T){B.withDoc(this._printWindow.document,function(){var Q=k.byId("divMap");Q&&K.remove(Q,"esriPrintWait")})}))}))})))}},_enableButton:function(a,l){var B=l||void 0===l;K[B?"remove":"add"].apply(this,[a,"esriDisabledDirectionsButton"]);a._enabled=B},_clearStopsStatusAttr:function(){for(var a=0;a<this.stops.length;a++)this.stops[a].feature&&
this.stops[a].feature.attributes&&(this.stops[a].feature.attributes.Status=void 0)},_enableSharing:function(){var a=new H;!this._naRouteSharing&&this.owningSystemUrl?O(["../tasks/NARouteSharing"],d.hitch(this,function(l){this._naRouteSharing=new l(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new G({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:d.hitch(this,function(){this._folderSelector._interractive?
this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new u({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:d.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:d.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),
onBlur:d.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(d.hitch(this,function(B){for(var T=[],Q=0;Q<B.length;Q++)T.push({id:B[Q].url,folderId:B[Q].id,label:B[Q].title});this._folderSelector.setStore(new f({objectStore:new x({data:T})}));this._naRouteSharing.canCreateItem().then(d.hitch(this,function(aa){this._folderSelector.set("disabled",!aa);this._userCanCreatePortalItem=aa}));
this._enableButton(this._saveButton);a.resolve()}),d.hitch(this,function(B){this._naRouteSharing=null;this._toggleSaveMenu(!1);a.reject(B)}))})):this.owningSystemUrl?a.resolve():(a.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return a.promise},_storeRouteUI:function(){var a=new H;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(a.resolve,
a.reject):(this._outputLayer&&this._outputLayer.focus(),a.reject(Error("Need result layer name specified.")));return a.promise},_storeRoute:function(a,l,B){var T=new H,Q=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),T.reject(Error("Not ready to store route.")),T.promise;this.clearMessages();T.then(null,d.hitch(this,function(Pa){this._showMessage(D.widgets.directions.error.cantSaveRoute)}));T.promise.always(d.hitch(this,function(){this._enableButton(this._saveButton);
y.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(Q&&Q.features&&Q.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(a&&l){var aa=d.hitch(this,function(Pa){return this._naRouteSharing.getAttributeUnits(Pa,this.serviceDescription)});var ha=this.routeParams.travelMode.timeAttributeName;var la=this.routeParams.travelMode.distanceAttributeName,
ia=aa(ha),sa=aa(la),ta=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,za=this._naRouteSharing.toMeters,Fa=this._naRouteSharing.toMinutes,Ja=function(Pa,Ta,Xa){var Ya;for(Ya in Pa)if(Pa.hasOwnProperty(Ya)&&0===Ya.indexOf(Ta)&&-1===X.indexOf(Xa,Ya.substr(Ta.length))){var yb=yb||{};yb[Ya.substr(Ta.length)]=Pa[Ya]}return yb},Ga=[],Aa=[],Ka=[];if(ha&&ia&&la&&sa){var Va=[],Ua=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||
[],Ra=this.serviceDescription.networkDataset.networkAttributes;for(aa=0;aa<Ra.length;aa++)"esriNAUTCost"===Ra[aa].usageType&&-1===X.indexOf(Ua,Ra[aa].name)&&Ra[aa].name!==ha&&Ra[aa].name!==la&&Va.push(Ra[aa].name);Ua=this.get("stops");var Oa={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(aa=0;aa<Ua.length;aa++)if(Ua[aa].feature&&Ua[aa].feature.toJson){Ra=Ua[aa].feature.toJson();var La=Ra.attributes;var Ha=Ra.geometry,Wa=this._naRouteSharing.getUTCOffset(La.ArriveTime,La.ArriveTimeUTC),
ab=this._naRouteSharing.getUTCOffset(La.DepartTime,La.DepartTimeUTC);d.mixin(Oa,{xmin:Oa.xmin>Ha.x?Ha.x:Oa.xmin,ymin:Oa.ymin>Ha.y?Ha.y:Oa.ymin,xmax:Oa.xmax<Ha.x?Ha.x:Oa.xmax,ymax:Oa.ymax<Ha.y?Ha.y:Oa.ymax});Ra.attributes={__OBJECTID:aa+1,CurbApproach:La.CurbApproach,ArrivalCurbApproach:La.ArriveCurbApproach,DepartureCurbApproach:La.DepartCurbApproach,Name:La.Name===this._waypointName?D.widgets.directions.waypoint:La.Name===this._userDefinedStopName?Ua[aa].name:La.Name,RouteName:Q.routeName,Sequence:La.Sequence,
Status:La.Status,LocationType:La.isWaypoint?1:0,TimeWindowStart:La.TimeWindowStart,TimeWindowEnd:La.TimeWindowEnd,TimeWindowStartUTCOffset:Wa,TimeWindowEndUTCOffset:Wa,ServiceMinutes:Fa(La["Attr_"+ha],ia),ServiceMeters:za(La["Attr_"+la],sa),ServiceCosts:L.stringify(Ja(La,"Attr_",Va)),CumulativeMinutes:Fa(La["Cumul_"+ha],ia),CumulativeMeters:za(La["Cumul_"+la],sa),CumulativeCosts:L.stringify(Ja(La,"Cumul_",Va)),LateMinutes:Fa(La["Violation_"+ha],ia),WaitMinutes:Fa(La["Wait_"+ha],ia),ArrivalTime:this._naRouteSharing.toUTCTime(La.ArriveTime,
Wa),DepartureTime:this._naRouteSharing.toUTCTime(La.DepartTime,ab),ArrivalUTCOffset:Wa,DepartureUTCOffset:ab};Ga.push(Ra)}la=0;sa=function(Pa){try{Pa.strings=L.parse(Pa.strings)}catch(Xa){qb.strings=void 0}if(Pa.strings&&Pa.strings.length)for(var Ta=0;Ta<Pa.strings.length;Ta++)if("esriDSTGeneral"===Pa.strings[Ta].stringType)return Pa.strings[Ta].string};Ua=function(Pa,Ta){for(var Xa=[],Ya=0;Ya<(Pa||[]).length;Ya++)Pa[Ya].stringType!==Ta&&Ta||Xa.push(Pa[Ya].string);return Xa.length?Xa.toString():void 0};
Ra=function(Pa){switch(Pa){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";
case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";
case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};
for(aa=0;aa<Q.featuresWithWaypoints.length;aa++){var lb=Q.featuresWithWaypoints[aa];Ha=lb.toJson();Wa=Ha.attributes;ab=Ha.geometry&&Ha.geometry.paths&&Ha.geometry.paths[0]||[];var ub=Ha.geometry.hasM||ab[0]&&3===ab[0].length;La=this._naRouteSharing.getUTCOffset(Wa.ETA,Wa.arriveTimeUTC);Ha.attributes={__OBJECTID:aa+1,Sequence:++la,StopID:function(){var Pa=void 0,Ta=lb._associatedStopWithReturnToStart&&lb._associatedStopWithReturnToStart.attributes.Sequence;if(Ta)for(var Xa=0;Xa<Ga.length;Xa++)if(Ga[Xa].attributes.Sequence===
Ta){Pa=Ga[Xa].attributes.__OBJECTID;break}return Pa}(),DirectionPointType:Ra(Wa.maneuverType),DisplayText:lb._associatedStopWithReturnToStart&&lb._associatedStopWithReturnToStart.attributes.isWaypoint?Wa.text.replace(this._waypointName,D.widgets.directions.waypoint):Wa.text,ArrivalTime:this._naRouteSharing.toUTCTime(Wa.ETA,La),ArrivalUTCOffset:La,Azimuth:void 0,Name:Ua(Q.stringsWithWaypoints[aa],"esriDSTStreetName"),AlternateName:Ua(Q.stringsWithWaypoints[aa],"esriDSTAltName"),ExitName:Ua(Q.stringsWithWaypoints[aa],
"esriDSTExit"),IntersectingName:Ua(Q.stringsWithWaypoints[aa],"esriDSTCrossStreet"),BranchName:Ua(Q.stringsWithWaypoints[aa],"esriDSTBranch"),TowardName:Ua(Q.stringsWithWaypoints[aa],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete Ha.symbol;delete Ha.infoTemplate;ab.length?(Ha.geometry={x:ab[0][0],y:ab[0][1],spatialReference:Ha.geometry.spatialReference},ub&&d.mixin(Ha.geometry,{m:ab[0][2]})):delete Ha.geometry;Aa.push(Ha);Ha=lb.toJson();Wa=Ha.attributes;
ab=Ha.geometry&&Ha.geometry.paths&&Ha.geometry.paths[0]||[];La=!0;for(ha=0;ha<ab.length-1;ha++)if(ab[ha][0]!==ab[ha+1][0]||ab[ha][1]!==ab[ha+1][1]){La=!1;break}La||(Ha.attributes={DirectionPointID:aa+1,DirectionLineType:"esriDLTSegment",Meters:za(Wa.length,ta),Minutes:Fa(Wa.time,ia),FromLevel:void 0,ToLevel:void 0},Ha.geometry.hasM=ub,delete Ha.symbol,delete Ha.infoTemplate,Ka.push(Ha));var qb=Q.eventsWithWaypoints[Ha.attributes.Sequence]||[];for(ha=0;ha<qb.length;ha++)Ha=qb[ha].toJson(),Wa=Ha.attributes,
La=this._naRouteSharing.getUTCOffset(Wa.ETA,Wa.arriveTimeUTC),Ha.attributes={Sequence:++la,DirectionPointType:"esriDPTEvent",DisplayText:sa(Wa),ArrivalTime:this._naRouteSharing.toUTCTime(Wa.ETA,La),ArrivalUTCOffset:La,Name:Wa.strings},Aa.push(Ha)}ha=this.routeParams.barriers&&this.routeParams.barriers.features||[];var zb=[];for(aa=0;aa<ha.length;aa++)la=ha[aa].toJson(),sa=la.attributes,la.attributes={BarrierType:sa.BarrierType||0,FullEdge:sa.FullEdge||!1,AddedCost:sa["Attr_"+this._getImpedanceAttribute().name]||
0,Costs:L.stringify(Ja(sa,"Attr_",Va)),CurbApproach:sa.CurbApproach||0,Name:sa.Name},zb.push(la);ha=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var Ab=[];for(aa=0;aa<ha.length;aa++)la=ha[aa].toJson(),sa=la.attributes,la.attributes={BarrierType:sa.BarrierType||0,ScaleFactor:sa["Attr_"+this._getImpedanceAttribute().name]||1,Costs:L.stringify(Ja(sa,"Attr_",Va)),Name:sa.Name},Ab.push(la);ha=this.routeParams.polygonBarriers&&this.routeParams.polygonBarriers.features||
[];var Bb=[];for(aa=0;aa<ha.length;aa++)la=ha[aa].toJson(),sa=la.attributes,la.attributes={BarrierType:sa.BarrierType||0,ScaleFactor:sa["Attr_"+this._getImpedanceAttribute().name]||1,Costs:L.stringify(Ja(sa,"Attr_",Va)),Name:sa.Name},Bb.push(la);var Cb={geometry:Q.mergedGeometry,attributes:{RouteName:Q.routeName,TotalMinutes:Fa(Q.totalTime,ia),TotalMeters:za(Q.totalLength,ta),TotalLateMinutes:function(){for(var Pa=0,Ta=0;Ta<Ga.length;Ta++)Pa+=Ga[Ta].attributes.LateMinutes||0;return Pa}(),TotalWaitMinutes:function(){for(var Pa=
0,Ta=0;Ta<Ga.length;Ta++)Pa+=Ga[Ta].attributes.WaitMinutes||0;return Pa}(),TotalCosts:Ga[Ga.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?Ga[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?Ga[Ga.length-1].attributes.DepartureTime:null,StartUTCOffset:Ga[0].attributes.ArrivalUTCOffset,EndUTCOffset:Ga[Ga.length-1].attributes.DepartureUTCOffset,Messages:L.stringify(this._solverMessages),AnalysisSettings:L.stringify({travelMode:d.hitch(this,function(){var Pa=d.clone(this.routeParams.travelMode);
"\x26lt;"===Pa.name.substr(0,4)&&"\x26gt;"===Pa.name.substr(Pa.name.length-4,4)&&(Pa.name=Pa.name.substr(4,Pa.name.length-8));return Pa})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,accumulateAttributeNames:this.routeParams.accumulateAttributes||
this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);d.hitch(this,function(){var Pa=new H;this._printService?this.zoomToFullRoute().then(d.hitch(this,function(){var Ta=this._printParams.template,Xa=Ta.exportOptions;Ta.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Ya){Ta.exportOptions=Xa;Pa.resolve(Ya.url)},function(Ya){Ta.exportOptions=Xa;Pa.resolve()})})):
Pa.resolve();return Pa.promise})().then(d.hitch(this,function(Pa){var Ta={folder:l,name:a,stops:Ga,directionPoints:Aa,directionLines:Ka,barriers:zb,polylineBarriers:Ab,polygonBarriers:Bb,extent:d.mixin(d.clone(Q.extent),{xmin:Oa.xmin>Q.extent.xmin?Q.extent.xmin:Oa.xmin,ymin:Oa.ymin>Q.extent.ymin?Q.extent.ymin:Oa.ymin,xmax:Oa.xmax<Q.extent.xmax?Q.extent.xmax:Oa.xmax,ymax:Oa.ymax<Q.extent.ymax?Q.extent.ymax:Oa.ymax}),routeInfo:Cb,thumbnail:Pa};this._userCanCreatePortalItem?this._naRouteSharing.store(Ta,
this.routeLayer.itemId,"1.0.0").then(d.hitch(this,function(Xa){if(Xa.success){var Ya=this._naRouteSharing.portal;Ya="//"+(Ya.isPortal?Ya.portalHostname:Ya.urlKey+"."+Ya.customBaseUrl);this._toggleSaveMenu();this._showMessage(D.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Ya+"/home/item.html?id\x3d"+Xa.id+"'\x3e"+D.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Xa.id);else this.onRouteItemCreated(Xa.id);
d.mixin(this.routeLayer,{itemId:Xa.id,title:Ta.name,isItemOwner:!0,ownerFolder:B});T.resolve(Xa)}else T.reject(Xa)}),T.reject):this._naRouteSharing.createFeatureCollection(Ta,"1.0.0").then(d.hitch(this,function(Xa){T.resolve(Xa);this._toggleSaveMenu();this.onFeatureCollectionCreated(Xa)}),T.reject)}))}else T.reject(Error("Cannot deduce the impedance used."))}else T.reject(Error("Missing required parameter: layerName, folder must be specified."));else T.reject(Error("Shared route must be built using a Travel Mode."));
else T.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else T.reject(Error("No route to share. Build a route first."));return T.promise},_loadRoute:function(a){var l=new H;l.promise.always(d.hitch(this,function(){this._showLoadingSpinner(!1);y.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(d.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(d.hitch(this,function(){var B=d.clone(this.serviceDescription),T=d.hitch(this,function(ia){d.mixin(this.routeLayer,{itemId:a,title:ia.title,isItemOwner:ia.isItemOwner,ownerFolder:ia.ownerFolder})}),Q,aa,ha,la;B.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(a,B).then(d.hitch(this,function(ia){if(ia.routeParameters){d.mixin(this.routeParams,ia.routeParameters);this.routeParams.accumulateAttributes=
ia.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var sa=ia.routeParameters.travelMode,ta=sa?this._getCostAttribute(sa.impedanceAttributeName):void 0;ta=ta?this._isTimeUnits(ta.units)?"Time":"Distance":"";la=B.supportedTravelModes&&B.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==ia.successCode&&ta){var za="AUTOMOBILE"===sa.type?"Driving":"TRUCK"===sa.type?"Trucking":"WALK"===sa.type?"Walking":"Other";sa.name="\x26lt;"+sa.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(B.supportedTravelModes||[]).concat(sa);la.push({id:sa.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+za+ta+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+sa.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new f({objectStore:new x({data:la})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(sa.name)}else{ta=!1;if(sa&&sa.name)for(la=B.supportedTravelModes||[],Q=0;Q<la.length;Q++)if(la[Q].name===sa.name){ta=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(sa.name);this.routeParams.travelMode=la[Q].impedanceAttributeName?la[Q]:la[Q].itemId;ia.loadMessages.push({message:D.widgets.directions.error.tmFromPortalSameName+" "+sa.name,messageType:"Warning"});break}if(!ta)if((sa=B.defaultTravelMode)&&
la)for(Q=0;Q<la.length;Q++){if(la[Q].id===sa){this.routeParams.travelMode=la[Q].impedanceAttributeName?la[Q]:la[Q].itemId;ia.loadMessages.push({message:D.widgets.directions.error.tmFromPortalDefault+" "+(la[Q].name?la[Q].name:la[Q].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ia.solveResult&&ia.solveResult.routeResults){var Fa=Infinity,Ja=-Infinity;sa=ia.solveResult.routeResults[0].stops;var Ga=ia.solveResult.routeResults[0].directions.features;
ta={};for(Q=0;Q<sa.length;Q++){var Aa=sa[Q].attributes;if(Aa.isWaypoint)for(aa=0;aa<Ga.length;aa++)za=Ga[aa].attributes,za._stopSequence===Aa.Sequence&&(za.text=za.text.replace(Aa.Name,this._waypointName));ha=Aa.Name+"_"+this._stopSequence++;ta[ha]=Aa.isWaypoint?this._waypointName:Aa.Name;Aa.Name=ha;if(Aa.Sequence<Fa&&(null!==Aa.ArriveCurbApproach||null!==Aa.DepartCurbApproach)){var Ka=Aa.Name;Fa=Aa.Sequence}if(Aa.Sequence>Ja&&(null!==Aa.ArriveCurbApproach||null!==Aa.DepartCurbApproach)){var Va=Aa.Name;
Ja=Aa.Sequence}}ha=Ka+" - "+Va;ia.solveResult.routeResults[0].routeName=ha;ia.solveResult.routeResults[0].directions.routeName=ha;for(Q=0;Q<Ga.length;Q++)if(za=Ga[Q].attributes,void 0!==za._stopSequence)for(aa=0;aa<sa.length;aa++)if(za._stopSequence===sa[aa].attributes.Sequence){ha=sa[aa].attributes.Name;za.text=(za.text||"").replace(ta[ha],ha);delete za._stopSequence;break}Ka=sa[sa.length-1];sa[0].geometry.x===Ka.geometry.x&&sa[0].geometry.y===Ka.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new g(Ka.geometry,
null,Ka.attributes),ta[Ka.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ia.solveResult,ta).then(d.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);T(ia);this.zoomToFullRoute();l.resolve(ia)}),l.reject)}else{if(ia.routeParameters){Ka=ia.routeParameters.stops.features;this.stops=[];for(Q=0;Q<Ka.length;Q++)this.stops.push(this._addStopWrapperToGraphic(Ka[Q],Ka[Q].attributes.Name)),this._updateStop(this.stops[Q],Q);this._setStops();ia.loadMessages.push({message:D.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ia.loadMessages.push({message:D.widgets.directions.routeLayerEmpty,messageType:"Warning"});T(ia);l.resolve(ia)}for(Q=0;Q<ia.loadMessages.length;Q++)this._showMessage(ia.loadMessages[Q].message)}),d.hitch(this,function(ia){l.reject(ia);this._showMessage("GWM_0003"===ia.messageCode?D.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:D.widgets.directions.error.loadError)}))}),l.reject)}),l.reject);return l.promise}});d.setObject("dijit.Directions",
F,v);return F})},"esri/arcgis/utils":function(){define("require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff dojox/gfx/_base ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L){function v(r){return!(!r||"BingMapsAerial"!==r.layerType&&"BingMapsAerial"!==r.type)}function b(r){return!(!r||"BingMapsRoad"!==r.layerType&&"BingMapsRoad"!==r.type)}function g(r){return v(r)||b(r)||!(!r||"BingMapsHybrid"!==r.layerType&&"BingMapsHybrid"!==r.type)}function W(r){return!(!r||"OpenStreetMap"!==r.layerType&&"OpenStreetMap"!==r.type)}function N(r){return!!(r&&r.url&&(-1<"ArcGISFeatureLayer ArcGISImageServiceLayer ArcGISImageServiceVectorLayer ArcGISMapServiceLayer ArcGISStreamLayer ArcGISTiledImageServiceLayer ArcGISTiledMapServiceLayer".split(" ").indexOf(r.layerType)||
!r.layerType&&!r.type))}function U(r){return e({url:eb.arcgisUrl+"/"+r.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function M(r,na){var ka={f:"json"};na&&(ka.token=na);return e({url:r,content:ka,callbackParamName:"callback"},{disableIdentityLookup:!0})}function Z(r){!r.layerDefinition||r.layerDefinition.drawingInfo&&r.layerDefinition.drawingInfo.labelingInfo||(r.showLabels=!1);r.itemProperties.layerDefinition&&(r.layerDefinition?(r.layerDefinition.drawingInfo||
(r.layerDefinition.drawingInfo=r.itemProperties.layerDefinition.drawingInfo),h.isDefined(r.layerDefinition.definitionExpression)||(r.layerDefinition.definitionExpression=r.itemProperties.layerDefinition.definitionExpression),h.isDefined(r.layerDefinition.minScale)||(r.layerDefinition.minScale=r.itemProperties.layerDefinition.minScale),h.isDefined(r.layerDefinition.maxScale)||(r.layerDefinition.maxScale=r.itemProperties.layerDefinition.maxScale)):r.layerDefinition=r.itemProperties.layerDefinition);
!r.itemProperties.popupInfo||r.popupInfo||r.disablePopup||(r.popupInfo=r.itemProperties.popupInfo);h.isDefined(r.itemProperties.showLabels)&&!h.isDefined(r.showLabels)&&(r.showLabels=r.itemProperties.showLabels);h.isDefined(r.itemProperties.showLegend)&&!h.isDefined(r.showLegend)&&(r.showLegend=r.itemProperties.showLegend);h.isDefined(r.itemProperties.refreshInterval)&&!h.isDefined(r.refreshInterval)&&(r.refreshInterval=r.itemProperties.refreshInterval)}function da(r){Z(r);r.itemProperties.layerDefinition&&
r.layerDefinition&&(!h.isDefined(r.layerDefinition.maximumTrackPoints)&&h.isDefined(r.itemProperties.layerDefinition.maximumTrackPoints)&&(r.layerDefinition.maximumTrackPoints=r.itemProperties.layerDefinition.maximumTrackPoints),!r.layerDefinition.definitionGeometry&&r.itemProperties.layerDefinition.definitionGeometry&&(r.layerDefinition.definitionGeometry=r.itemProperties.layerDefinition.definitionGeometry));r.itemProperties.purgeOptions&&!r.purgeOptions&&(r.purgeOptions=r.itemProperties.purgeOptions)}
function oa(r,na){var ka=new X,fa=r.itemData,ja=[],qa=[];d.forEach(fa.operationalLayers,function(ma){if(ma.itemId&&N(ma)){var va=ma.url.toLowerCase();-1<va.indexOf("/featureserver")||-1<va.indexOf("/mapserver/")?(qa.push(ma),ja.push(U(ma))):-1<va.indexOf("/mapserver")&&-1===va.indexOf("/mapserver/")&&(!ma.layers||!h.isDefined(ma.minScale)&&!h.isDefined(ma.maxScale))?(qa.push(ma),ja.push(U(ma))):-1<va.indexOf("/imageserver")?(qa.push(ma),ja.push(U(ma))):-1<va.indexOf("/streamserver")&&(qa.push(ma),
ja.push(U(ma)))}});fa.baseMap&&fa.baseMap.baseMapLayers&&d.forEach(fa.baseMap.baseMapLayers,function(ma){ma.itemId&&"VectorTileLayer"!==ma.layerType&&(qa.push(ma),ja.push(U(ma)))});if(0<ja.length){var pa={};(new G(ja)).addCallback(function(ma){d.forEach(qa,function(va,ya){var xa=ma[ya][1];if(xa&&!(xa instanceof Error)&&(pa[va.itemId]=xa,N(va))){var Ea=va.url.toLowerCase();(-1<Ea.indexOf("/featureserver")||-1<Ea.indexOf("/mapserver/"))&&xa.layers?d.forEach(xa.layers,function(ua){var Ca="/featureserver/"+
ua.id;(Ca=Ea.match(Ca+"$")==Ca)||(Ca="/mapserver/"+ua.id,Ca=Ea.match(Ca+"$")==Ca);Ca&&(va.itemProperties=ua,Z(va))}):-1<Ea.indexOf("/streamserver")?(va.itemProperties=xa,da(va)):-1<Ea.indexOf("/mapserver")?(xa.layers&&!va.layers&&(va.layers=xa.layers),h.isDefined(xa.minScale)&&!h.isDefined(va.minScale)&&(va.minScale=xa.minScale),h.isDefined(xa.maxScale)&&!h.isDefined(va.maxScale)&&(va.maxScale=xa.maxScale),h.isDefined(xa.refreshInterval)&&!h.isDefined(va.refreshInterval)&&(va.refreshInterval=xa.refreshInterval),
xa.visibleLayers&&!va.visibleLayers&&(va.visibleLayers=xa.visibleLayers)):-1<Ea.indexOf("/imageserver")&&(h.isDefined(xa.minScale)&&!h.isDefined(va.minScale)&&(va.minScale=xa.minScale),h.isDefined(xa.maxScale)&&!h.isDefined(va.maxScale)&&(va.maxScale=xa.maxScale),h.isDefined(xa.refreshInterval)&&!h.isDefined(va.refreshInterval)&&(va.refreshInterval=xa.refreshInterval),!xa.popupInfo||va.popupInfo||va.disablePopup||(va.popupInfo=xa.popupInfo),xa.renderingRule&&!va.renderingRule&&(va.renderingRule=xa.renderingRule,
xa.renderingRule.functionName&&(va.renderingRule.rasterFunction=xa.renderingRule.functionName)),xa.bandIds&&!va.bandIds&&(va.bandIds=xa.bandIds),xa.mosaicRule&&!va.mosaicRule&&(va.mosaicRule=xa.mosaicRule),xa.format&&!va.format&&(va.format=xa.format),h.isDefined(xa.compressionQuality)&&!h.isDefined(va.compressionQuality)&&(va.compressionQuality=xa.compressionQuality),!xa.layerDefinition||!xa.layerDefinition.definitionExpression||h.isDefined(va.layerDefinition)&&h.isDefined(va.layerDefinition.definitionExpression)||
(va.layerDefinition=va.layerDefinition||{},va.layerDefinition.definitionExpression=xa.layerDefinition.definitionExpression),xa=F.getObject("layerDefinition.drawingInfo.renderer",!1,xa),null==F.getObject("layerDefinition.drawingInfo.renderer",!1,va)&&null!=xa&&(va.layerDefinition=va.layerDefinition||{},va.layerDefinition.drawingInfo=va.layerDefinition.drawingInfo||{},va.layerDefinition.drawingInfo.renderer=xa))}});r.relatedItemsData=pa;ka.callback(r)})}else ka.callback(r);return ka}function wa(r,na){var ka=
new X,fa=r.itemData,ja=fa.baseMap.baseMapLayers[0];if(g(ja))if(ja.portalUrl&&x.id)delete na.bingMapsKey,x.id.checkSignInStatus(m.urlToObject(eb.arcgisUrl).path).then(F.hitch(null,function(pa,ma,va,ya,xa){M(ja.portalUrl,xa.token).then(F.hitch(null,Ba,pa,ma,va,ya),F.hitch(null,Ia,pa,ma,va,ya))},r,na,fa,ka),F.hitch(null,function(pa,ma,va,ya,xa){M(ja.portalUrl).then(F.hitch(null,Ba,pa,ma,va,ya),F.hitch(null,Ia,pa,ma,va,ya))},r,na,fa,ka));else if(na.bingMapsKey){var qa=new nb({bingMapsKey:na.bingMapsKey,
mapStyle:nb.MAP_STYLE_AERIAL});R.connect(qa,"onLoad",F.hitch(this,function(){ka.callback([r,na])}));R.connect(qa,"onError",function(pa){delete na.bingMapsKey;r.itemData=Ma(fa);ja=r.itemData.baseMap.baseMapLayers[0];ja.errors=[];ja.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});ka.callback([r,na])})}else r.itemData=Ma(fa),ja=r.itemData.baseMap.baseMapLayers[0],ja.errors=[],ja.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),
ka.callback([r,na]);else ka.callback([r,na]);return ka}function ra(r){var na=new X;r=r.itemData;var ka=r.baseMap&&r.baseMap.baseMapLayers;if(Ya&&!Ya.supported())for(r=0;r<ka.length;r++){var fa=ka[r];if(!fa.isReference){if("VectorTileLayer"===fa.layerType){var ja=fa.itemId;var qa=r}break}}ja?Va(ja,!1).addBoth(function(pa){var ma=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;pa&&pa.item&&ma.test(pa.item.url)&&(ka[qa]={id:"FB_"+fa.id,layerType:"ArcGISTiledMapServiceLayer",
opacity:"opacity"in fa?fa.opacity:1,visibility:"visibility"in fa?fa.visibility:!0,url:"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});na.resolve()}):na.resolve();return na}function Ba(r,na,ka,fa,ja){ja.bingKey?(na.bingMapsKey=ja.bingKey,ja=new nb({bingMapsKey:na.bingMapsKey,mapStyle:nb.MAP_STYLE_AERIAL}),R.connect(ja,"onLoad",F.hitch(this,function(){fa.callback([r,na])})),R.connect(ja,"onError",function(qa){delete na.bingMapsKey;r.itemData=Ma(ka);qa=r.itemData.baseMap.baseMapLayers[0];
qa.errors=[];qa.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});fa.callback([r,na])})):Ia(r,na,ka,fa)}function Ia(r,na,ka,fa){delete na.bingMapsKey;r.itemData=Ma(ka);ka=r.itemData.baseMap.baseMapLayers[0];ka.errors=[];ka.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});fa.callback([r,na])}function Ma(r){v(r.baseMap.baseMapLayers[0])?
r.baseMap={title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:b(r.baseMap.baseMapLayers[0])?r.baseMap={title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:r.baseMap={title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},
{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return r}function Za(r,na,ka,fa){var ja=r.dynamicLayerInfos||r.layerInfos,qa=na.layers;if(qa&&ja)if(fa.usePopupManager){var pa;d.forEach(ja,function(Ca){var Da=Ca.id;if(!Ca.subLayerIds)for(Ca=0;Ca<qa.length;Ca++){var Qa=qa[Ca];if(Qa.id===Da&&Qa.popupInfo&&!Qa.disablePopup){pa||(pa={});pa[Da]={infoTemplate:new ka(Qa.popupInfo),
layerUrl:Qa.layerUrl};break}}});pa&&r.setInfoTemplates(pa)}else{var ma=[],va=[],ya=[],xa=[],Ea=[],ua=[];d.forEach(ja,function(Ca){var Da=Ca.id;if(!Ca.subLayerIds&&-1!==d.indexOf(r.visibleLayers,Da))for(Ca=0;Ca<qa.length;Ca++){var Qa=qa[Ca];if(Qa.id===Da){va.push(Da);ma.push(Qa.popupInfo);ya.push(Qa.layerUrl||"");Qa.layerDefinition&&Qa.layerDefinition.definitionExpression?xa.push(Qa.layerDefinition.definitionExpression):xa.push("");Ea.push(h.isDefined(Qa.minScale)?Qa.minScale:null);ua.push(h.isDefined(Qa.maxScale)?
Qa.maxScale:null);break}}});ma.length&&(r.__popups=ma,r.__popupIds=va,r.__popupUrls=ya,r.__popupWhereClauses=xa,r.__popupMinScales=Ea,r.__popupMaxScales=ua,r.__resourceInfo=na.resourceInfo)}}function bb(r){if(!r)return!1;var na=(new V(eb.arcgisUrl)).authority;return-1!==r.indexOf(".arcgis.com/")||-1!==r.indexOf(na)}function Sa(r){return r?-1!==r.indexOf("/services.arcgisonline.com/")||-1!==r.indexOf("/server.arcgisonline.com/"):!1}function Na(r){"https:"===location.protocol&&(bb(r)||Sa(r))&&(r=r.replace("http:",
"https:"));return r}function fb(r,na,ka){var fa=[];r.displayLevels||(fa=d.map(r.resourceInfo.tileInfo.lods,function(pa){return pa.level}));if(r.exclusionAreas){var ja=F.clone(r.exclusionAreas);ja=d.map(ja,function(pa){pa.geometry=new n(pa.geometry);return pa})}var qa=r.resourceInfo&&"Raster"===r.resourceInfo.cacheType;qa?(fa=r.layerDefinition&&r.layerDefinition.drawingInfo&&r.layerDefinition.drawingInfo.renderer,fa=new Pa(Na(r.url),{resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,
id:r.id,minScale:r.minScale,maxScale:r.maxScale,refreshInterval:r.refreshInterval,multidimensionalDefinition:r.multidimensionalDefinition,bandIds:r.bandIds,renderer:fa||null})):fa=new H(Na(r.url),{resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,displayLevels:r.displayLevels||fa,id:r.id,minScale:r.minScale,maxScale:r.maxScale,refreshInterval:r.refreshInterval,exclusionAreas:ja});ka.ignorePopups||(qa&&r.popupInfo&&!r.disablePopup?fa.setInfoTemplate(new na(r.popupInfo)):Za(fa,r,na,
ka));return fa}function hb(r,na){if(!r||!na||0===na.length)return[];var ka=","+na+",",fa=[],ja,qa=",";for(ja=0;ja<r.length;ja++)if(null!==r[ja].subLayerIds){if(-1===ka.indexOf(","+r[ja].id+",")||-1<qa.indexOf(","+r[ja].id+","))qa+=r[ja].subLayerIds.toString()+","}else-1<ka.indexOf(","+r[ja].id+",")&&-1===qa.indexOf(","+r[ja].id+",")&&fa.push(r[ja].id);return fa}function $a(r,na,ka){var fa=new ab;fa.format="png24";r.resourceInfo&&r.resourceInfo.supportedImageFormatTypes&&-1<r.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&
(fa.format="png32");fa=new Ua(Na(r.url),{resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,id:r.id,imageParameters:fa,minScale:r.minScale,maxScale:r.maxScale,refreshInterval:r.refreshInterval});var ja=r.visibleLayers;if(!r.visibleLayers){var qa="";d.forEach(fa.layerInfos,function(ua){ua.defaultVisibility&&(qa+=(0<qa.length?",":"")+ua.id)});ja=qa}if(r.layers&&0<r.layers.length){var pa=[],ma=[],va,ya=[],xa,Ea;d.forEach(r.layers,function(ua){var Ca=ua.layerDefinition;Ca&&Ca.definitionExpression&&
(pa[ua.id]=Ca.definitionExpression);if(Ca&&Ca.source){va=null;Ea=Ca.source;if("mapLayer"===Ea.type){var Da=d.filter(r.resourceInfo.layers,function(Qa){return Qa.id===Ea.mapLayerId});Da.length&&(va=F.mixin(Da[0],ua))}else va=F.mixin({},ua);va&&(va.source=Ea,delete va.popupInfo,va=new Ha(va),r.visibleLayers&&(Da="string"==typeof r.visibleLayers?r.visibleLayers.split(","):r.visibleLayers,-1<d.indexOf(Da,ua.id)?va.defaultVisibility=!0:va.defaultVisibility=!1),ma.push(va))}Ca&&null!=Ca.transparency&&(Da=
Ca.drawingInfo||{},null==Da.transparency&&(Da.transparency=Ca.transparency,Ca.drawingInfo=Da));Ca&&Ca.source&&Ca.drawingInfo&&(xa=new zb(Ca.drawingInfo),ya[ua.id]=xa)},this);0<pa.length&&fa.setLayerDefinitions(pa);0<ma.length?(fa.setDynamicLayerInfos(ma,!0),0<ya.length&&fa.setLayerDrawingOptions(ya,!0)):(ja=hb(fa.layerInfos,ja),fa.setVisibleLayers(ja))}else ja=hb(fa.layerInfos,ja),fa.setVisibleLayers(ja);ka.ignorePopups||Za(fa,r,na,ka);return fa}function jb(r,na,ka){var fa=new lb;fa.bandIds=r.bandIds;
null!=r.format&&(fa.format=r.format,null!=r.compressionQuality&&(fa.compressionQuality=r.compressionQuality));if(r.renderingRule&&r.renderingRule.rasterFunction){var ja=new Cb(r.renderingRule);fa.renderingRule=ja}r.mosaicRule&&(ja=new Ab(r.mosaicRule),fa.mosaicRule=ja);h.isDefined(r.noData)&&(fa.noData=r.noData);h.isDefined(r.noDataInterpretation)&&(fa.noDataInterpretation=r.noDataInterpretation);h.isDefined(r.interpolation)&&(fa.interpolation=r.interpolation);ja=r.layerType?"ArcGISImageServiceVectorLayer"===
r.layerType:!1;h.isDefined(r.layerType)||(ja=r.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===r.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===r.resourceInfo.serviceDataType));fa={resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,id:r.id,imageServiceParameters:fa,minScale:r.minScale,maxScale:r.maxScale,refreshInterval:r.refreshInterval};fa=ja?new Oa(Na(r.url),fa):new Ra(Na(r.url),fa);r.layerDefinition&&(r.layerDefinition.drawingInfo&&
r.layerDefinition.drawingInfo.renderer&&(ja=D.fromJson(r.layerDefinition.drawingInfo.renderer),fa.setRenderer(ja)),r.layerDefinition.definitionExpression&&fa.setDefinitionExpression(r.layerDefinition.definitionExpression,!0));ka.ignorePopups||!r.popupInfo||r.disablePopup||fa.setInfoTemplate(new na(r.popupInfo));return fa}function gb(r,na,ka){var fa=[102113,102100,3857],ja=ka||new t(na[0].layerObject.fullExtent.spatialReference),qa=new t(r.resourceInfo.fullExtent.spatialReference);return ja.wkt==qa.wkt&&
(ja.wkid==qa.wkid||h.isDefined(ja.latestWkid)&&ja.latestWkid==qa.wkid||h.isDefined(qa.latestWkid)&&ja.wkid==qa.latestWkid||h.isDefined(ja.latestWkid)&&ja.latestWkid==qa.latestWkid)||ja.wkid&&qa.wkid&&d.some(fa,function(pa){return pa===qa.wkid})&&d.some(fa,function(pa){return pa===ja.wkid})?!0:!1}function kb(r,na,ka){if(!na[0].layerObject.tileInfo)return!1;r=r.resourceInfo.tileInfo;na=na[0].layerObject.tileInfo;ka=ka.width>ka.height?ka.width:ka.height;for(var fa=!1,ja=!1,qa=0;qa<r.lods.length;qa++){for(var pa=
r.lods[qa].scale/r.dpi,ma=0;ma<na.lods.length;ma++){var va=na.lods[ma].scale/na.dpi;if(Math.abs(va-pa)/va<1/ka)if(fa){ja=!0;break}else fa=!0}if(ja)break}return ja||fa&&(1===r.lods.length||1===na.lods.length)?!0:!1}function mb(r,na,ka,fa,ja,qa){var pa=ka._clazz;if(W(r))var ma=new Bb({id:r.id,opacity:r.opacity,visible:null!==r.visibility&&void 0!==r.visibility?r.visibility:!0});else if(r&&("WFS"===r.layerType||"WFS"===r.type)){var va={customParameters:r.wfsInfo.customParameters,geometryType:r.layerDefinition.geometryType,
id:r.id,labelingInfo:r.layerDefinition.drawingInfo.labelingInfo,maxFeatures:r.wfsInfo.maxFeatures,mode:r.mode,name:r.wfsInfo.name,showLabels:!0,swapXY:r.wfsInfo.swapXY,title:r.title,url:r.url,version:r.wfsInfo.version,visible:r.visibility,wkid:r.layerDefinition.spatialReference.wkid};ma=new Fb;ma.fromJson(va,function(){h.isDefined(r.opacity)&&ma.setOpacity(r.opacity);h.isDefined(r.visibility)&&ma.setVisibility(r.visibility);(r.minScale||r.maxScale)&&ma.setScaleRange(r.minScale,r.maxScale);ma.renderer=
D.fromJson(r.layerDefinition.drawingInfo.renderer,{geometryType:va.geometryType});!ka.ignorePopups&&r.popupInfo&&ma.setInfoTemplate(new pa(r.popupInfo));ma.emit("fromJsonComplete")})}else if(r&&("WMS"===r.layerType||"WMS"===r.type)){var ya=[],xa=[];d.forEach(r.layers,function(Da){xa.push(new Gb({name:Da.name,title:Da.title,legendURL:Da.legendURL||Da.legendUrl,queryable:Da.queryable,showPopup:Da.showPopup}));ya.push(Da.name)},this);r.visibleLayers&&(ya=r.visibleLayers);fa=new n(r.extent[0][0],r.extent[0][1],
r.extent[1][0],r.extent[1][1],new t({wkid:4326}));fa={customLayerParameters:r.customLayerParameters,customParameters:r.customParameters,extent:fa,layerInfos:xa,version:r.version,maxWidth:r.maxWidth,maxHeight:r.maxHeight,featureInfoFormat:r.featureInfoFormat,getFeatureInfoURL:r.featureInfoUrl,getMapURL:r.mapUrl,spatialReferences:r.spatialReferences,title:r.title,copyright:r.copyright,minScale:r.minScale||0,maxScale:r.maxScale||0,format:r.format};ma=new Hb(r.url,{id:r.id,visibleLayers:ya,format:"png",
transparent:r.firstLayer?!1:!0,opacity:r.opacity,visible:null!==r.visibility?r.visibility:!0,resourceInfo:fa,refreshInterval:r.refreshInterval});ma.spatialReference.wkid=fa.spatialReferences[0]}else if(r&&("KML"===r.layerType||"KML"===r.type)){var Ea=r.url;if(x.id){var ua=x.id.findCredential(m.urlToObject(eb.arcgisUrl).path);ua&&(na=eb.arcgisUrl.substring(eb.arcgisUrl.indexOf("//")+2,eb.arcgisUrl.indexOf("/",eb.arcgisUrl.indexOf("//")+3)),ja=na.split("."),ja=ja[ja.length-2]+"."+ja[ja.length-1],qa=
Ea.indexOf(ja),-1<qa&&(Ea="https://"+na+Ea.substring(qa+ja.length),Ea+="?token\x3d"+ua.token))}ma=new ub(Ea,{id:r.id,visible:null!==r.visibility?r.visibility:!0,outSR:fa,refreshInterval:r.refreshInterval});R.connect(ma,"onLoad",function(){(r.opacity||0===r.opacity)&&ma.setOpacity(r.opacity);h.isDefined(r.minScale)&&h.isDefined(r.maxScale)&&ma.setScaleRange(r.minScale,r.maxScale);r.visibleFolders&&d.forEach(ma.folders,function(Da){-1<d.indexOf(r.visibleFolders,Da.id)?ma.setFolderVisibility(Da,!0):
ma.setFolderVisibility(Da,!1)},this)})}else if(!r||"WebTiledLayer"!==r.layerType&&"WebTiledLayer"!==r.type)if(!r||"GeoRSS"!==r.layerType&&"GeoRSS"!==r.type)if(r&&("CSV"===r.layerType||"CSV"===r.type)&&r.url)fa={layerDefinition:r.layerDefinition,columnDelimiter:r.columnDelimiter,id:r.id?r.id:null,visible:null!==r.visibility?r.visibility:!0,opacity:r.opacity,refreshInterval:r.refreshInterval},r.locationInfo&&(fa.latitudeFieldName=r.locationInfo.latitudeFieldName,fa.longitudeFieldName=r.locationInfo.longitudeFieldName),
!ka.ignorePopups&&r.popupInfo&&(fa.infoTemplate=new pa(r.popupInfo)),ma=new La(r.url,fa);else if("VectorTileLayer"!==r.layerType||!r.styleUrl||r.resourceInfo&&r.resourceInfo instanceof Error)if(r.layerDefinition&&!r.url)fa=ba.fromJson(ba.toJson(r)),delete fa.id,delete fa.opacity,delete fa.visibility,ma=new ea(fa,{id:r.id,opacity:r.opacity,visible:r.visibility,outFields:["*"],autoGeneralize:!0}),ka.ignorePopups||!fa.popupInfo||fa.disablePopup||ma.setInfoTemplate(new pa(fa.popupInfo)),wb(ma);else if(g(r))ka.bingMapsKey?
(fa=nb.MAP_STYLE_AERIAL_WITH_LABELS,v(r)?fa=nb.MAP_STYLE_AERIAL:b(r)&&(fa=nb.MAP_STYLE_ROAD),ma=new nb({bingMapsKey:ka.bingMapsKey,mapStyle:fa,opacity:r.opacity,id:r.id}),R.connect(ma,"onError",F.hitch(this,function(Da){Da.errors=Da.errors||[];Da.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+(Da?Da.layerType||Da.type:"")+"]"})},r))):(r.errors=r.errors||[],r.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+
(r?r.layerType||r.type:"")+"]"}));else if(r.resourceInfo&&(r.resourceInfo.mapName||""===r.resourceInfo.mapName))ma=!0===r.resourceInfo.singleFusedMapCache&&(r.baseMapLayer||gb(r,na,fa)&&kb(r,ja,qa))?fb(r,pa,ka):$a(r,pa,ka);else if(r.resourceInfo&&r.resourceInfo.pixelSizeX)ma=!0===r.resourceInfo.singleFusedMapCache&&"ArcGISImageServiceLayer"!==r.layerType&&(r.baseMapLayer||"Raster"===r.resourceInfo.cacheType||gb(r,na,fa)&&kb(r,ja,qa))?fb(r,pa,ka):jb(r,pa,ka);else if(r.resourceInfo&&"Feature Layer"===
r.resourceInfo.type){r.capabilities&&(r.resourceInfo.capabilities=r.capabilities);var Ca;!1===ka.editable?Ca=!1:ka.privileges&&-1===d.indexOf(ka.privileges,"features:user:edit")&&x.id&&x.id.findCredential(r.url)&&(Ca=!1);ma=new ea(Na(r.url),{resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,id:r.id,mode:r.mode===ea.MODE_SELECTION?ea.MODE_SELECTION:ea.MODE_AUTO,editable:Ca,outFields:["*"],autoGeneralize:!0,refreshInterval:r.refreshInterval});ka.ignorePopups||!r.popupInfo||r.disablePopup||
ma.setInfoTemplate(new pa(r.popupInfo));r.layerDefinition&&(r.layerDefinition.drawingInfo&&r.layerDefinition.drawingInfo.renderer&&(fa=D.fromJson(r.layerDefinition.drawingInfo.renderer,{geometryType:ma.geometryType}),fa.isMaxInclusive=!0,ma.setRenderer(fa)),r.layerDefinition.drawingInfo&&r.layerDefinition.drawingInfo.labelingInfo&&(fa=d.map(r.layerDefinition.drawingInfo.labelingInfo,function(Da){return new qb(Da)}),ma.setLabelingInfo(fa)),r.layerDefinition.definitionExpression&&ma.setDefinitionExpression(r.layerDefinition.definitionExpression),
h.isDefined(r.layerDefinition.minScale)&&ma.setMinScale(r.layerDefinition.minScale),h.isDefined(r.layerDefinition.maxScale)&&ma.setMaxScale(r.layerDefinition.maxScale));wb(ma)}else r.resourceInfo&&r.resourceInfo.streamUrls&&(fa={resourceInfo:r.resourceInfo,opacity:r.opacity,visible:r.visibility,id:r.id},r.layerDefinition&&(Ea=r.layerDefinition.drawingInfo,r.layerDefinition.definitionGeometry&&(ua=ua||{},ua.geometry=r.layerDefinition.definitionGeometry),h.isDefined(r.layerDefinition.definitionExpression)&&
(ua=ua||{},ua.where=r.layerDefinition.definitionExpression),h.isDefined(r.layerDefinition.maximumTrackPoints)&&(fa.maximumTrackPoints=r.layerDefinition.maximumTrackPoints)),ua&&(fa.filter=ua),r.purgeOptions&&(fa.purgeOptions=r.purgeOptions),ma=new Ta(Na(r.url),fa),Ea&&Ea.renderer&&(fa=Ea.renderer,ma.setRenderer(D.fromJson(fa,{geometryType:r.resourceInfo.geometryType}))),Ea&&Ea.labelingInfo&&(fa=d.map(Ea.labelingInfo,function(Da){return new qb(Da)}),ma.setLabelingInfo(fa)),ka.ignorePopups||!r.popupInfo||
r.disablePopup||ma.setInfoTemplate(new pa(r.popupInfo)),r.layerDefinition&&(h.isDefined(r.layerDefinition.minScale)&&ma.setMinScale(r.layerDefinition.minScale),h.isDefined(r.layerDefinition.maxScale)&&ma.setMaxScale(r.layerDefinition.maxScale)),P.once(ma,"error",function(Da){r.errors.push({message:"Error loading stream layer. Check websocket url"})}));else ma=new Ya(r.styleUrl,{id:r.id,minScale:r.minScale,maxScale:r.maxScale,opacity:r.opacity,visible:r.visibility,resourceInfo:r.resourceInfo});else ma=
new Wa(r.url,{id:r.id,opacity:r.opacity,outSpatialReference:fa,refreshInterval:r.refreshInterval}),R.connect(ma,"onLoad",function(){!1===r.visibility&&ma.hide();h.isDefined(r.minScale)&&h.isDefined(r.maxScale)&&ma.setScaleRange(r.minScale,r.maxScale);var Da=ma.getFeatureLayers();d.forEach(Da,function(Qa){r.pointSymbol&&"esriGeometryPoint"===Qa.geometryType?(Qa.renderer.symbol=c.fromJson(r.pointSymbol),1===Da.length&&(ma.pointSymbol=c.fromJson(r.pointSymbol))):r.lineSymbol&&"esriGeometryPolyline"===
Qa.geometryType?(Qa.renderer.symbol=c.fromJson(r.lineSymbol),1===Da.length&&(ma.polylineSymbol=c.fromJson(r.lineSymbol))):r.polygonSymbol&&"esriGeometryPolygon"===Qa.geometryType&&(Qa.renderer.symbol=c.fromJson(r.polygonSymbol),1===Da.length&&(ma.polygonSymbol=c.fromJson(r.polygonSymbol)))})});else if(ma=new Ib(r.templateUrl,{id:r.id,visible:null!==r.visibility?r.visibility:!0,opacity:r.opacity,copyright:r.copyright,fullExtent:r.fullExtent&&new n(r.fullExtent),initialExtent:r.fullExtent&&new n(r.fullExtent),
subDomains:r.subDomains,tileInfo:r.tileInfo?new Xa(r.tileInfo):null,refreshInterval:r.refreshInterval,wmtsInfo:r.wmtsInfo}),h.isDefined(r.minScale)||h.isDefined(r.maxScale))ma.loaded?ma.setScaleRange(r.minScale,r.maxScale):R.connect(ma,"onLoad",function(){ma.setScaleRange(r.minScale,r.maxScale)});ma&&(ma.arcgisProps={title:r.title},r.baseMapLayer&&(r.isReference?(ma.attr("data-reference",!0),ma._basemapGalleryLayerType="reference"):ma._basemapGalleryLayerType="basemap"),ma instanceof ea&&r.layerDefinition&&
r.layerDefinition.featureReduction&&"cluster"===r.layerDefinition.featureReduction.type&&(fa=r.layerDefinition.featureReduction,fa.clusterSize&&(fa.clusterSize=z.pt2px(fa.clusterSize)),fa.clusterRadius&&(fa.clusterRadius=z.pt2px(fa.clusterRadius)),fa.popupInfo&&(fa.infoTemplate=new E(fa.popupInfo),delete fa.popupInfo),ma.setFeatureReduction(fa)));return ma}function db(r,na,ka,fa,ja){d.forEach(r,function(ma){ma.layerObject=mb(ma,r,na,ka,fa,ja)});var qa=d.filter(r,function(ma){return!ma.isReference}),
pa=d.filter(r,function(ma){return!!ma.isReference});return r=qa.concat(pa)}function ob(r){var na=null;r=r[0];r.url&&N(r)&&r.resourceInfo.spatialReference&&(na=new t,r.resourceInfo.spatialReference.wkid&&(na.wkid=r.resourceInfo.spatialReference.wkid),r.resourceInfo.spatialReference.wkt&&(na.wkt=r.resourceInfo.spatialReference.wkt));g(r)||W(r)?na=new t({wkid:102100}):r&&("WMS"===r.layerType||"WMS"===r.type)&&(na=new t({wkid:r.spatialReferences[0]}));return na}function rb(r,na,ka,fa,ja,qa,pa,ma){d.forEach(na,
function(va){if(N(va)||va&&"VectorTileLayer"===va.layerType)va.resourceInfo=r[va.deferredsPos][1],delete va.deferredsPos});qa=qa||ob(na);na=db(na,ka,qa,pa,ma);ja.callback(na);return ja}function wb(r){!window.CanvasRenderingContext2D&&r.renderer&&"esri.renderer.HeatmapRenderer"===r.renderer.declaredClass&&r.setRenderer(D.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",
style:"esriSLSSolid"}}}))}function sb(r,na,ka){r.message=r.message?r.message+(" [url:"+na+"]"):"[url:"+na+"]";ka.push(r);f.defaults.io.errorHandler(r)}function tb(r,na){var ka=Na(r);return e({url:ka,content:{f:"json"},callbackParamName:"callback",error:function(fa,ja){sb(fa,ka,na)}})}function pb(r){var na=eb.arcgisUrl+"/"+r.itemId+"/data";return e({url:na,content:{f:"json"},callbackParamName:"callback",error:function(ka,fa){r.errors=r.errors||[];sb(ka,na,r.errors)}})}function xb(r,na){return yb.loadMetadata(r).otherwise(function(ka){sb(ka,
r,na);return ka})}function I(r,na,ka){var fa=new X;if(!(ka.featureCollection&&ka.featureCollection.layers||ka.layers))return r.errors=r.errors||[],r.errors.push({message:"Invalid Feature Collection item data. [item id: "+r.itemId+"]"}),fa.errback(),fa;ka.layers&&(ka.featureCollection={layers:ka.layers},delete ka.layers,h.isDefined(ka.showLegend)&&(ka.featureCollection.showLegend=ka.showLegend,delete ka.showLegend));Y(r,ka.featureCollection,na).then(function(ja){ka.featureCollection=ja;r.featureCollection&&
r.featureCollection.layers?d.forEach(ka.featureCollection.layers,function(qa,pa){var ma=r.featureCollection.layers[pa];ma.popupInfo||ma.layerDefinition?ma.layerDefinition?(h.isDefined(ma.layerDefinition.minScale)&&h.isDefined(ma.layerDefinition.maxScale)&&(ma.layerDefinition.minScale!==qa.layerDefinition.minScale||ma.layerDefinition.maxScale!==qa.layerDefinition.maxScale)&&(delete qa.layerDefinition.minScale,delete qa.layerDefinition.maxScale),ma.layerDefinition.drawingInfo&&ba.toJson(ma.layerDefinition.drawingInfo)!==
ba.toJson(qa.layerDefinition.drawingInfo)&&delete qa.layerDefinition.drawingInfo,ma.layerDefinition.showLegend!==qa.layerDefinition.showLegend&&delete qa.layerDefinition.showLegend,ma.layerDefinition=F.mixin(ma.layerDefinition,qa.layerDefinition)):ma.layerDefinition=qa.layerDefinition:(ma.popupInfo=qa.popupInfo,ma.layerDefinition=qa.layerDefinition);ma.featureSet=qa.featureSet;ma.nextObjectId=qa.nextObjectId}):(r.featureCollection=r.featureCollection||{},r.featureCollection=F.mixin(r.featureCollection,
ka.featureCollection));fa.callback(r)});return fa}function Y(r,na,ka){var fa=new X;O(["./csv"],function(ja){var qa=[];d.forEach(na.layers,function(pa){pa.featureSet&&pa.featureSet.features&&pa.featureSet.features.length&&pa.featureSet.features[0].geometry&&pa.featureSet.features[0].geometry.spatialReference&&(pa.deferredsPos=qa.length,qa.push(ja.projectFeatureCollection(pa,ka,pa.featureSet.features[0].geometry.spatialReference)))});(new G(qa)).addCallback(function(){d.forEach(na.layers,function(pa){h.isDefined(pa.deferredsPos)&&
(qa[pa.deferredsPos].results&&qa[pa.deferredsPos].results.length?pa=qa[pa.deferredsPos].results[0]:(pa.errors=pa.errors||[],pa.errors.push({message:"Errors projecting feature collection. ["+r.title+" - "+pa.layerDefinition.name+"]"})),delete pa.deferredsPos)});fa.callback(na)})});return fa}function ca(r,na,ka,fa,ja){var qa=new X,pa=new X,ma=[];d.forEach(r.operationalLayers,function(ya){ya.itemId&&"Feature Collection"==ya.type&&ma.push(pb(ya).then(F.hitch(null,I,ya,ka)))});if(0===ma.length)a(r,na,
ka,fa,pa,ja);else{var va=new G(ma);va.addCallback(function(ya){a(r,na,ka,fa,pa,ja)})}pa.then(function(ya){ma=[];d.forEach(ya,function(Ea){Ea=Ea.layerObject;if(Ea instanceof ea&&!Ea.loaded&&!Ea.loadError){var ua=new X;P.once(Ea,"load, error",function(){ua.callback(Ea)});ma.push(ua)}else Ea&&"esri.layers.WFSLayer"===Ea.declaredClass&&!Ea.loadError&&(ua=new X,P.once(Ea,"fromJsonComplete, error",function(Ca){ua.callback(Ea)}),ma.push(ua))});if(ma.length){var xa=new X;va=new G(ma);va.addCallback(function(){xa.callback(ya)});
return xa.promise}return ya}).then(function(ya){var xa=[];d.forEach(ya,function(Ea){var ua=Ea.layerObject;ua&&(ua instanceof ea||"esri.layers.StreamLayer"===ua.declaredClass)?ua.loaded&&ua.labelingInfo&&(Ea.showLabels||ua._collection?xa.push(ua):ua.setShowLabels&&ua.setShowLabels(!1)):ua&&"esri.layers.WFSLayer"===ua.declaredClass&&ua.loaded&&ua.labelingInfo&&xa.push(ua)});xa.length?O(["../layers/LabelLayer"],function(Ea){var ua=new Ea;d.forEach(xa,function(Ca){ua.addFeatureLayer(Ca)});ya.push({layerObject:ua});
qa.callback(ya)}):qa.callback(ya)});return qa}function a(r,na,ka,fa,ja,qa){var pa=[],ma=[],va=[];d.forEach(r.operationalLayers,function(ya,xa){if(ya.featureCollection&&ya.featureCollection.layers){var Ea=ya.featureCollection.layers.length;d.forEach(ya.featureCollection.layers,function(ua,Ca){var Da=!0;ya.visibleLayers&&-1==d.indexOf(ya.visibleLayers,Ca)&&(Da=!1);ua.visibility=(null!=ya.visibility?!!ya.visibility:!0)&&Da;ua.opacity=ya.opacity;ua.id=(ya.id||"operational"+xa)+"_"+Ca;ya.title&&(ua.title=
1!==Ea&&ua.layerDefinition.name&&ya.title!==ua.layerDefinition.name?ya.title+" - "+ua.layerDefinition.name:ya.title);null==ua.disablePopup&&(ua.disablePopup=ya.disablePopup);va.push(ua)},this)}else va.push(ya)});d.forEach(r.baseMap.baseMapLayers,function(ya,xa){ya.baseMapLayer=!0;ya.id=ya.id||"base"+xa;pa.push(ya)});d.forEach(va,function(ya,xa){ya.id=ya.id||"operational"+xa;pa.push(ya)});d.forEach(pa,function(ya){var xa=!(!ya||"VectorTileLayer"!==ya.layerType);if(N(ya)||xa)ya.deferredsPos=ma.length,
ya.errors=ya.errors||[],xa?ma.push(xb(ya.styleUrl,ya.errors)):ma.push(tb(ya.url,ya.errors))});0===ma.length?(ka=ka||ob(pa),pa=db(pa,na,ka,fa,qa),ja.callback(pa)):(new G(ma)).addCallback(function(ya){rb(ya,pa,na,ma,ja,ka,fa,qa)});return ja}function l(r,na,ka,fa){var ja=r.minScale,qa=r.maxScale;if(10.1>=ka.version&&na)for(r=na.length-1;0<=r;r--){if(na[r].id==fa)if(0==ja&&0<na[r].minScale?ja=na[r].minScale:0<ja&&0==na[r].minScale?ja=ka.minScale:0<ja&&0<na[r].minScale&&(ja=Math.min(ja,na[r].minScale)),
qa=Math.max(ka.maxScale||0,na[r].maxScale||0),ka.setScaleRange(ja,qa),-1<na[r].parentLayerId)fa=na[r].parentLayerId;else break}else 10.1<ka.version&&(d.forEach(r.layerInfos,function(pa){pa.id==fa&&(0==ja&&0<pa.minScale?ja=pa.minScale:0<ja&&0==pa.minScale||0<ja&&0<pa.minScale&&(ja=Math.min(ja,pa.minScale)),qa=Math.max(qa||0,pa.maxScale||0))}),ka.setScaleRange(ja,qa))}function B(r,na,ka,fa){var ja=r.url,qa=r.__popupIds,pa=r.__popupUrls,ma=r.__popupWhereClauses,va=r.__popupMinScales,ya=r.__popupMaxScales,
xa=r.__resourceInfo,Ea=[];d.forEach(r.__popups,function(ua,Ca){if(ua){var Da=[];d.forEach(ua.fieldInfos,function(cb){"shape"!==cb.fieldName.toLowerCase()&&Da.push(cb.fieldName)});if(r.dynamicLayerInfos&&0<r.dynamicLayerInfos.length){var Qa=d.filter(r.dynamicLayerInfos,function(cb){return qa[Ca]==cb.id})[0].source;var ib=new ea(ja+"/dynamicLayer",{parentLayer:r,id:r.id+"_"+qa[Ca],source:Qa,outFields:Da,mode:ea.MODE_SELECTION,infoTemplate:ua&&new ka(ua),drawMode:!1,visible:r.visible,autoGeneralize:!0});
var Jb=function(cb,Db){0<ma[cb].length&&Db.setDefinitionExpression(ma[cb]);if(h.isDefined(va[cb])||h.isDefined(ya[cb]))if(h.isDefined(r.minScale)||h.isDefined(r.maxScale)){var vb=r.minScale,Eb=r.maxScale;0==vb&&0<va[cb]?vb=va[cb]:0<vb&&0==va[cb]||0<vb&&0<va[cb]&&(vb=Math.min(vb,va[cb]));Eb=Math.max(Eb||0,ya[cb]||0);Db.setScaleRange(vb,Eb)}else Db.setScaleRange(va[cb],ya[cb]);else l(r,na||xa.layers,Db,qa[cb])};ib.loaded?Jb(Ca,ib):R.connect(ib,"onLoad",function(cb){Jb(Ca,ib)})}else{var Kb=null,Lb=ja+
"/"+qa[Ca];if(pa[Ca].length)Lb=pa[Ca];else if(na)for(Qa=0;Qa<na.length;Qa++)if(na[Qa].id===qa[Ca]){Kb=na[Qa];break}ib=new ea(Na(Lb),{parentLayer:r,id:r.id+"_"+qa[Ca],outFields:Da,mode:ea.MODE_SELECTION,infoTemplate:ua&&new ka(ua),drawMode:!1,visible:r.visible,resourceInfo:Kb,autoGeneralize:!0});ib.loaded?(0<ma[Ca].length&&ib.setDefinitionExpression(ma[Ca]),l(r,na||xa.layers,ib,qa[Ca])):R.connect(ib,"onLoad",function(cb){0<ma[Ca].length&&ib.setDefinitionExpression(ma[Ca]);l(r,na||xa.layers,cb,qa[Ca])})}Ea.push(ib)}});
0<Ea.length&&(R.connect(r,"onVisibilityChange",F.hitch(this,function(ua,Ca){d.forEach(ua,function(Da){Ca?Da.show():Da.hide()})},Ea)),R.connect(fa,"onLayerRemove",F.hitch(this,function(ua,Ca,Da){ua.id===Da.id&&d.forEach(Ca,function(Qa){fa.removeLayer(Qa)})},r,Ea)));delete r.__popups;delete r.__popupIds;delete r.__popupUrls;delete r.__popupWhereClauses;delete r.__popupMinScales;delete r.__popupMaxScales;delete r.__resourceInfo;return Ea}function T(r){return e({url:Na(r.url+"/layers"),content:{f:"json"},
callbackParamName:"callback",error:function(){}})}function Q(r,na,ka){var fa=[];d.forEach(r,function(qa){var pa=qa.__popups;pa&&1<pa.length&&10<=qa.version&&(qa.__deferredsPos=fa.length,fa.push(T(qa)))});var ja=[];0<fa.length?(new G(fa)).addCallback(function(qa){d.forEach(r,function(pa){pa.__popups&&0<pa.__popups.length&&(pa.__deferredsPos||0===pa.__deferredsPos?(ja=ja.concat(B(pa,qa[pa.__deferredsPos][1].layers,ka,na)),delete pa.__deferredsPos):ja=ja.concat(B(pa,null,ka,na)))});na.addLayers(ja)}):
(d.forEach(r,function(qa){qa.__popups&&0<qa.__popups.length&&(ja=ja.concat(B(qa,null,ka,na)))}),na.addLayers(ja))}function aa(r){d.forEach(r,function(na){var ka=na.layer;ka.toJson&&(na=ka.toJson(),na.featureSet&&ka.name&&-1<ka.name.indexOf("Text")&&d.forEach(na.featureSet.features,function(fa,ja){if(fa.attributes.TEXT){var qa=ka.graphics[ja];qa.symbol.setText(fa.attributes.TEXT);fa.symbol.horizontalAlignment&&(qa.symbol.align=fa.symbol.horizontalAlignment);qa.setSymbol(qa.symbol);qa.setAttributes(fa.attributes)}},
this))})}function ha(r){var na=6;d.forEach(r,function(ka){if(ka=ka.renderer)"esri.renderer.SimpleRenderer"===ka.declaredClass?((ka=ka.symbol)&&ka.xoffset&&(na=Math.max(na,Math.abs(ka.xoffset))),ka&&ka.yoffset&&(na=Math.max(na,Math.abs(ka.yoffset)))):"esri.renderer.UniqueValueRenderer"!==ka.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==ka.declaredClass||d.forEach(ka.infos,function(fa){(fa=fa.symbol)&&fa.xoffset&&(na=Math.max(na,Math.abs(fa.xoffset)));fa&&fa.yoffset&&(na=Math.max(na,Math.abs(fa.yoffset)))})});
return na}function la(r){var na=this,ka=na.infoWindow,fa=r.graphic;if(na.loaded){ka.hide();ka.clearFeatures();var ja=[];d.forEach(na.graphicsLayerIds,function(ua){(ua=na.getLayer(ua))&&ua instanceof ea&&ua.loaded&&ua.visible&&(ua.clearSelection(),ua.infoTemplate&&!ua.suspended&&ja.push(ua))});d.forEach(na.layerIds,function(ua){(ua=na.getLayer(ua))&&(-1!==ua.declaredClass.indexOf("ArcGISImageServiceLayer")||-1!==ua.declaredClass.indexOf("RasterXLayer"))&&ua.loaded&&ua.visible&&ua.infoTemplate&&ja.push(ua)});
fa=fa&&fa.getInfoTemplate()?fa:null;if(ja.length||fa){var qa=ha(ja),pa=r.screenPoint,ma=na.toMap(new K(pa.x-qa,pa.y+qa));qa=na.toMap(new K(pa.x+qa,pa.y-qa));var va=new n(ma.x,ma.y,qa.x,qa.y,na.spatialReference),ya=new A;ya.geometry=va;ya.timeExtent=na.timeExtent;var xa=!0;ma=d.map(ja,function(ua){ua=ua&&ua.isFeatureReductionActive&&ua.isFeatureReductionActive()?ua.getFeatureReductionLayer():ua;if(-1!==ua.declaredClass.indexOf("ArcGISImageServiceLayer")){ya.geometry=r.mapPoint;xa=!1;var Ca=ua.queryVisibleRasters(ya,
{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0});Ca.addCallback(function(){return ua.getVisibleRasters()})}else if(-1!==ua.declaredClass.indexOf("RasterXLayer"))Ca=ua.fetchPopupFromTiles({geometry:r.mapPoint});else if("function"===typeof ua.selectFeatures)Ca=ua.selectFeatures(ya),Ca.addCallback(function(){return ua.getSelectedFeatures()});else{Ca=new X;var Da=d.filter(ua.graphics,function(Qa){return Qa&&Qa.visible&&va.intersects(Qa.geometry)});Ca.resolve(Da)}return Ca});fa&&(qa=
new X,qa.callback([fa]),ma.splice(0,0,qa));if(!d.some(ma,function(ua){return-1===ua.fired})){var Ea=fa?1:0;d.forEach(ja,function(ua){Ea=-1!==ua.declaredClass.indexOf("ArcGISImageServiceLayer")?Ea+ua.getVisibleRasters().length:-1!==ua.declaredClass.indexOf("RasterXLayer")?Ea+ua.getPopupFromTiles().length:Ea+ua.getSelectedFeatures().length});if(!Ea)return}ka.setFeatures(ma);ka.show(r.mapPoint,{closestFirst:xa})}}}function ia(r,na){var ka=na.mapOptions||{};if(!ka.infoWindow){var fa=new J({visibleWhenEmpty:!1},
u.create("div"));ka.infoWindow=fa}h.isDefined(ka.showInfoWindowOnClick)||na.usePopupManager||(ka.showInfoWindowOnClick=!1);ka=new k(r,ka);R.connect(ka,"onLayersAddResult",aa);return ka}function sa(r,na,ka,fa,ja,qa){if(fa.map){var pa=fa.map;var ma=fa.clickEventHandle;var va=fa.clickEventListener;var ya=fa.errors}else{var xa=ka.itemData;!ja.mapOptions.backgroundColor&&xa.background&&xa.background.color&&null!=xa.background.color[0]&&(ja.mapOptions.backgroundColor=q.toDojoColor(xa.background.color));
pa=ia(fa,ja);ja.ignorePopups||ja.disableClickBehavior||ja.usePopupManager||(ma=R.connect(pa,"onClick",la),va=la)}pa.addLayers(r);ja.ignorePopups||ja.usePopupManager||Q(r,pa,ja._clazz);var Ea=ya||[];d.forEach(na,function(ua){ua.errors&&(Ea=Ea.concat(ua.errors))},this);pa.loaded?qa.callback({map:pa,itemInfo:ka,errors:Ea,clickEventHandle:ma,clickEventListener:va}):R.connect(pa,"onLoad",function(){qa.callback({map:pa,itemInfo:ka,errors:Ea,clickEventHandle:ma,clickEventListener:va})})}function ta(r,na,
ka,fa,ja){var qa=[];d.forEach(ja,function(va){F.isArray(va.layerObject)?d.forEach(va.layerObject,function(ya){qa.push(ya)}):qa.push(va.layerObject)});if(g(ja[0]))var pa=setInterval(function(){if(ja[0].layerObject&&ja[0].layerObject.loaded)clearInterval(pa),za(r,na,ka,fa,ja,qa);else if(ja[0].errors){clearInterval(pa);var va="";ja[0].errors&&ja[0].errors.length&&(va=" ("+ja[0].errors[0].message+")");fa.errback(Error(L.arcgis.utils.baseLayerError+va))}},10);else if(!qa[0]&&ja[0].baseMapLayer){var ma=
"";ja[0].errors&&ja[0].errors.length&&(ma=" ("+ja[0].errors[0].message+")");fa.errback(Error(L.arcgis.utils.baseLayerError+ma))}else za(r,na,ka,fa,ja,qa)}function za(r,na,ka,fa,ja,qa){try{var pa=ka.mapOptions||{};ka.mapOptions=pa;qa=d.filter(qa,h.isDefined);if(na.map||pa.extent)sa(qa,ja,r,na,ka,fa);else{var ma=qa[0].spatialReference;if(pa.center&&(null!=pa.zoom||pa.scale)&&(F.isArray(pa.center)&&(pa.center=new y(pa.center)),w.canProject(pa.center,ma))){sa(qa,ja,r,na,ka,fa);return}var va=r.item;if(va&&
va.extent&&va.extent.length){var ya=new n(va.extent[0][0],va.extent[0][1],va.extent[1][0],va.extent[1][1],new t({wkid:4326}));4326===ma.wkid?(pa.extent=ya,sa(qa,ja,r,na,ka,fa)):900913===ma.wkid||102100===ma.wkid||102113===ma.wkid||3857===ma.wkid?(ya.xmin=Math.max(ya.xmin,-180),ya.xmax=Math.min(ya.xmax,180),ya.ymin=Math.max(ya.ymin,-89.99),ya.ymax=Math.min(ya.ymax,89.99),pa.extent=w.geographicToWebMercator(ya),sa(qa,ja,r,na,ka,fa)):ka.geometryServiceURL||f.defaults.geometryService?(ka.geometryServiceURL?
new S(ka.geometryServiceURL):f.defaults.geometryService).project([ya],ma,function(xa){xa=xa[0];pa.extent=pa.extent||xa;sa(qa,ja,r,na,ka,fa)},function(){sa(qa,ja,r,na,ka,fa)}):fa.errback(Error(L.arcgis.utils.geometryServiceError))}else sa(qa,ja,r,na,ka,fa)}}catch(xa){fa.errback(xa)}}function Fa(r){var na=[];d.forEach(r.operationalLayers,function(ka){ka.featureCollection?na.push({featureCollection:ka.featureCollection,visibility:null!=ka.visibility?!!ka.visibility:!0,title:ka.title}):ka.layerObject&&
na.push({layer:ka.layerObject,visibility:null!=ka.visibility?!!ka.visibility:!0,title:ka.title})});return na}function Ja(r){var na=[],ka=r.baseMap.baseMapLayers;r.operationalLayers&&(ka=ka.concat(r.operationalLayers));d.forEach(ka,function(fa){var ja={};if(fa.featureCollection&&(!fa||"CSV"!==fa.layerType&&"CSV"!==fa.type))!0===fa.featureCollection.showLegend&&d.forEach(fa.featureCollection.layers,function(ma){if(!1!==ma.showLegend){var va=ma.layerObject.renderer;ja={layer:ma.layerObject,title:fa.title,
defaultSymbol:va&&va.defaultSymbol&&va.defaultLabel?!0:!1};1<fa.featureCollection.layers.length&&(ja.title+=" - "+ma.layerDefinition.name);na.push(ja)}});else if(fa.baseMapLayer&&!0===fa.showLegend&&fa.layerObject||!fa.baseMapLayer&&!1!==fa.showLegend&&fa.layerObject&&!(fa.layerObject instanceof ea&&fa.layerObject.mode===ea.MODE_SELECTION)){var qa=fa.layerObject.renderer,pa=fa.layerObject.declaredClass;qa=!qa||qa&&qa.defaultSymbol&&qa.defaultLabel?!0:!1;if(10.1>fa.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===
pa||"esri.layers.ArcGISTiledMapServiceLayer"===pa)||"esri.layers.ArcGISImageServiceLayer"===pa)qa=!0;ja={layer:fa.layerObject,title:fa.title,defaultSymbol:qa};fa.layers&&(pa=d.map(d.filter(fa.layers,function(ma){return!1===ma.showLegend}),function(ma){return ma.id}),pa.length&&(ja.hideLayers=pa));na.push(ja)}});return na}function Ga(r,na){function ka(ya,xa){d.forEach(ya,function(Ea,ua){switch(Ea){case "../layers/ArcGISDynamicMapServiceLayer":Ua=xa[ua];break;case "../layers/ArcGISImageServiceLayer":Ra=
xa[ua];break;case "../layers/ArcGISImageServiceVectorLayer":Oa=xa[ua];break;case "../layers/CSVLayer":La=xa[ua];break;case "../layers/DynamicLayerInfo":Ha=xa[ua];break;case "../layers/GeoRSSLayer":Wa=xa[ua];break;case "../layers/ImageParameters":ab=xa[ua];break;case "../layers/ImageServiceParameters":lb=xa[ua];break;case "../layers/KMLLayer":ub=xa[ua];break;case "../layers/LabelClass":qb=xa[ua];break;case "../layers/LayerDrawingOptions":zb=xa[ua];break;case "../layers/MosaicRule":Ab=xa[ua];break;
case "../layers/OpenStreetMapLayer":Bb=xa[ua];break;case "../layers/RasterFunction":Cb=xa[ua];break;case "../layers/RasterXLayer":Pa=xa[ua];break;case "../layers/StreamLayer":Ta=xa[ua];break;case "../layers/TileInfo":Xa=xa[ua];break;case "../layers/VectorTileLayer":Ya=xa[ua];break;case "../layers/vectorTiles/layers/support/vectorTileLayerLoader":yb=xa[ua];break;case "../virtualearth/VETiledLayer":nb=xa[ua];break;case "../layers/WebTiledLayer":Ib=xa[ua];break;case "../layers/WFSLayer":Fb=xa[ua];break;
case "../layers/WMSLayer":Hb=xa[ua];break;case "../layers/WMSLayerInfo":Gb=xa[ua]}})}var fa=new X,ja=r.itemData,qa=[];ja.baseMap&&ja.baseMap.baseMapLayers&&(qa=qa.concat(ja.baseMap.baseMapLayers));ja.operationalLayers&&(qa=qa.concat(ja.operationalLayers));ja=d.map(qa,function(ya){return ya&&ya.layerType});var pa=[],ma=[];qa=!1;for(var va=0;va<ja.length;va++){switch(ja[va]){case "ArcGISFeatureLayer":-1===d.indexOf(pa,"../layers/LabelClass")&&pa.push("../layers/LabelClass");break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===
d.indexOf(pa,"../layers/ArcGISImageServiceLayer")&&(pa.push("../layers/ArcGISImageServiceLayer"),ma.push("../layers/ImageServiceParameters"),ma.push("../layers/MosaicRule"),ma.push("../layers/RasterFunction"),pa.push("../layers/RasterXLayer"));break;case "ArcGISImageServiceVectorLayer":-1===d.indexOf(pa,"../layers/ArcGISImageServiceVectorLayer")&&(pa.push("../layers/ArcGISImageServiceVectorLayer"),ma.push("../layers/ImageServiceParameters"),ma.push("../layers/MosaicRule"),ma.push("../layers/RasterFunction"));
break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===d.indexOf(pa,"../layers/ArcGISDynamicMapServiceLayer")&&(pa.push("../layers/ArcGISDynamicMapServiceLayer"),ma.push("../layers/DynamicLayerInfo"),ma.push("../layers/ImageParameters"),ma.push("../layers/LayerDrawingOptions"));break;case "ArcGISStreamLayer":-1===d.indexOf(pa,"../layers/StreamLayer")&&pa.push("../layers/StreamLayer");-1===d.indexOf(pa,"../layers/LabelClass")&&pa.push("../layers/LabelClass");break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===
d.indexOf(pa,"../virtualearth/VETiledLayer")&&pa.push("../virtualearth/VETiledLayer");break;case "CSV":-1===d.indexOf(pa,"../layers/CSVLayer")&&(pa.push("../layers/CSVLayer"),ma.push("./csv"));break;case "GeoRSS":-1===d.indexOf(pa,"../layers/GeoRSSLayer")&&pa.push("../layers/GeoRSSLayer");break;case "KML":-1===d.indexOf(pa,"../layers/KMLLayer")&&pa.push("../layers/KMLLayer");break;case "OpenStreetMap":-1===d.indexOf(pa,"../layers/OpenStreetMapLayer")&&pa.push("../layers/OpenStreetMapLayer");break;
case "VectorTileLayer":-1===d.indexOf(pa,"../layers/VectorTileLayer")&&pa.push("../layers/VectorTileLayer");-1===d.indexOf(ma,"../layers/vectorTiles/layers/support/vectorTileLayerLoader")&&ma.push("../layers/vectorTiles/layers/support/vectorTileLayerLoader");break;case "WebTiledLayer":-1===d.indexOf(pa,"../layers/WebTiledLayer")&&(pa.push("../layers/WebTiledLayer"),ma.push("../layers/TileInfo"));break;case "WFS":-1===d.indexOf(pa,"../layers/WFSLayer")&&pa.push("../layers/WFSLayer");break;case "WMS":-1===
d.indexOf(pa,"../layers/WMSLayer")&&(pa.push("../layers/WMSLayer"),ma.push("../layers/WMSLayerInfo"));break;default:qa=!0}if(qa)break}qa&&(pa=Mb,ma=Nb);pa.length?O(pa,function(){ka(pa,arguments);ma.length?O(ma,function(){ka(ma,arguments);fa.resolve()}):fa.resolve()}):fa.resolve();return fa}function Aa(r){r=r.itemData;var na=function(fa,ja){"GroupLayer"===fa.layerType?d.forEach(fa.layers,function(qa){qa.visibility=!1===fa.visibility?!1:qa.visibility;qa.opacity=h.isDefined(fa.opacity)?h.isDefined(qa.opacity)?
qa.opacity*fa.opacity:fa.opacity:qa.opacity;na(qa,ja)}):ja.push(fa)},ka=[];d.forEach(r.operationalLayers,function(fa){na(fa,ka)});r.operationalLayers=ka}function Ka(r,na,ka,fa){Aa(fa);var ja=fa.itemData;ja.baseMap&&ja.baseMap.baseMapLayers&&ja.baseMap.baseMapLayers.length&&(ja.baseMap.baseMapLayers[0].firstLayer=!0);var qa=na.layerMixins,pa=qa&&qa.length;if(pa){var ma=function(va){for(var ya=0;ya<pa;ya++){var xa=qa[ya];if(xa.mixin)if(xa.hasOwnProperty("id")){if(va.id===xa.id){F.mixin(va,xa.mixin);
break}}else if(va.url===xa.url){F.mixin(va,xa.mixin);break}}};d.forEach(ja.baseMap&&ja.baseMap.baseMapLayers,ma);d.forEach(ja.operationalLayers,ma)}Ga(fa,na).then(function(){return ra(fa,na)}).then(function(){return wa(fa,na)}).then(function(va){var ya=va[0],xa=va[1];if(ya.itemData.operationalLayers&&0!==ya.itemData.operationalLayers.length){var Ea=new X,ua=ya.itemData.baseMap.baseMapLayers.slice(),Ca=d.filter(ya.itemData.baseMap.baseMapLayers,function(Da){return!Da.isReference});va={item:ya.item,
itemData:{baseMap:{baseMapLayers:Ca},background:F.clone(ya.itemData.background)}};ya.itemData.baseMap.baseMapLayers=d.filter(ya.itemData.baseMap.baseMapLayers,function(Da){return Da.isReference});oa(va,xa).addCallback(function(Da){ca(Da.itemData,xa).addCallback(F.hitch(null,ta,Da,r,xa,Ea))});Ea.then(function(Da){oa(ya,xa).addCallback(function(Qa){ca(Qa.itemData,xa,Da.map.spatialReference,Ca,Da.map).addCallback(function(ib){Qa.itemData.baseMap.baseMapLayers=ua;ta(Qa,Da,xa,ka,ib)})})},F.hitch(ka,ka.errback))}else oa(ya,
xa).addCallback(function(Da){ca(Da.itemData,xa).addCallback(F.hitch(null,ta,Da,r,xa,ka))})})}function Va(r,na){"undefined"===typeof na&&(na=!0);eb._arcgisUrl&&0<eb._arcgisUrl.length&&(eb.arcgisUrl=eb._arcgisUrl);var ka={},fa=new X;e({url:eb.arcgisUrl+"/"+r,content:{f:"json"},callbackParamName:"callback",load:function(ja){ka.item=ja;na?e({url:eb.arcgisUrl+"/"+r+"/data",content:{f:"json"},callbackParamName:"callback",load:function(qa){ka.itemData=qa;fa.callback(ka)},error:function(qa){fa.errback(qa)}}):
fa.callback(ka)},error:function(ja){fa.errback(ja)}});return fa}var Ua,Ra,Oa,La,Ha,Wa,ab,lb,ub,qb,zb,Ab,Bb,Cb,Pa,Ta,Xa,Ya,yb,nb,Ib,Fb,Hb,Gb,Mb="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/RasterXLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),
Nb="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/vectorTiles/layers/support/vectorTileLayerLoader ../layers/WMSLayerInfo".split(" ");var eb={arcgisUrl:m.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:Va,createMap:function(r,na,ka){var fa=new X;ka=ka||{};var ja=ka.infoTemplateClass;ka._clazz=ja&&(F.isObject(ja)?ja:
F.getObject(ja))||E;F.isString(r)?Va(r).addCallback(F.hitch(null,Ka,na,ka,fa)).addErrback(F.hitch(fa,fa.errback)):Ka(na,ka,fa,r);fa.addCallback(function(qa){var pa=qa.map;pa&&(pa.tables=F.getObject("itemInfo.itemData.tables",!1,qa)||[])});return fa},getLayerList:function(r){return r&&r.itemInfo&&r.itemInfo.itemData?Fa(r.itemInfo.itemData):[]},getLegendLayers:function(r){return r&&r.itemInfo&&r.itemInfo.itemData?Ja(r.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:oa,_getItemData:U,_getBingKey:M,
_portalUrlResponse:Ba,_portalUrlFailure:Ia,_processFSItemProperties:Z,_processSSItemProperties:da,_getLayers:ca,_preBuildLayerObjects:rb,_buildLayerObjects:db,_preCreateMap:ta,_getMapSR:ob,_createMap:sa,_addSelectionLayers:Q,_createSelectionFeatureLayers:B,_getServiceInfo:tb,_getFeatureCollectionItem:pb,_mergeFeatureCollectionItem:I,_projectFeatureCollection:Y,_getLayersInfo:T,_initLayer:mb,_loadAsCached:fb,_loadAsDynamic:$a,_processPopups:Za,_onLayersAddResult:aa,_sameSpatialReferenceAsBasemap:gb,
_sameTilingSchemeAsBasemap:kb,_showPopup:la,_calculateClickTolerance:ha,_getVisibleFeatureLayers:hb,_updateLayerScaleInfo:l,_checkUrl:Na,_isHostedService:bb,_isAgolService:Sa,_getLegendLayers:Ja};F.setObject("arcgis.utils",eb,x);return eb})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(O,F,d,R,X,ba,V,P,G,u,
C,z){O=O([G,z],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(x){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=F.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(x,f,q,h,e){try{var t=[],k=[],m=x.directions||[],y=x.routes?x.routes.features:[],K=x.stops?x.stops.features:
[],n=x.barriers?x.barriers.features:[],w=x.polygonBarriers?x.polygonBarriers.features:[],c=x.polylineBarriers?x.polylineBarriers.features:[],D=x.messages,E=d.forEach,J=d.indexOf,A=!0,S,H,ea=x.routes&&x.routes.spatialReference||x.stops&&x.stops.spatialReference||x.barriers&&x.barriers.spatialReference||x.polygonBarriers&&x.polygonBarriers.spatialReference||x.polylineBarriers&&x.polylineBarriers.spatialReference;this._chk=x.checksum;E(m,function(b){t.push(S=b.routeName);k[S]={directions:b}});E(y,function(b){-1===
J(t,S=b.attributes.Name)&&(t.push(S),k[S]={});k[S].route=b});E(K,function(b){H=b.attributes;-1===J(t,S=H.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(t.push(S),k[S]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==S&&(A=!1);void 0===k[S].stops&&(k[S].stops=[]);k[S].stops.push(b)});0<K.length&&!0===A&&(k[t[0]].stops=k["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete k["esri.tasks.RouteTask.NULL_ROUTE_NAME"],t.splice(d.indexOf(t,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var L=[];E(t,function(b,
g){k[b].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===b?null:b;k[b].spatialReference=ea;L.push(new u(k[b]))});x=function(b){E(b,function(g,W){g.geometry&&(g.geometry.spatialReference=ea);b[W]=new ba(g)});return b};E(D,function(b,g){D[g]=new C(b)});var v={routeResults:L,barriers:x(n),polygonBarriers:x(w),polylineBarriers:x(c),messages:D};this._successHandler([v],"onSolveComplete",q,e)}catch(b){this._errorHandler(b,h,e)}},solve:function(x,f,q,h){var e=h.assembly;x=this._encode(F.mixin({},this._url.query,
{f:"json"},x.toJson(e&&e[0]),this._chk?{checksum:this._chk}:{}));var t=this._handler,k=this._errorHandler;return V({url:this._url.path,timeout:25E4,content:x,callbackParamName:"callback",load:function(m,y){t(m,y,f,q,h.dfd)},error:function(m){k(m,q,h.dfd)}})},onSolveComplete:function(){}});P._createWrappers(O);F.setObject("tasks.RouteTask",O,X);return O})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(P){var G=P.spatialReference,u=P.route;if(P.directions){var C=[],z=[],x=[];d.forEach(P.directions.features,function(q,h){z[h]=q.compressedGeometry;C[h]=q.strings;x[h]=q.events});P.directions.strings=C;P.directions.events=x;this.directions=new V(P.directions,z)}this.routeName=P.routeName;u&&(u.geometry&&(u.geometry.spatialReference=G),this.route=new ba(u));if(P.stops){var f=this.stops=[];d.forEach(P.stops,
function(q,h){q.geometry&&(q.geometry.spatialReference=G);f[q.attributes.Sequence-1]=new ba(q)})}},routeName:null,directions:null,route:null,stops:null});F.setObject("tasks.RouteResult",O,X);return O})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C){O=O(C,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(z,x){this.routeId=z.routeId;this.routeName=z.routeName;F.mixin(this,z.summary);this.extent=new V(this.envelope);var f=this._fromCompressedGeometry,q=this.features,h=this.extent.spatialReference,e=[];d.forEach(x,function(t,k){q[k].setGeometry(e[k]=t?f(t,h):q[k].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(e,h);this.geometryType="esriGeometryPolyline";d.forEach(z.events,function(t,k){d.forEach(t,function(m,y){t[y]=new u(new G(m.point.x,m.point.y,h),null,{ETA:m.ETA,
strings:X.stringify(m.strings),arriveTimeUTC:m.arriveTimeUTC})});z.events[k]=t});delete this.envelope},_fromCompressedGeometry:function(z,x){var f=0,q=0,h=0,e=0,t=[],k,m=0,y=0,K=0;(k=z.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(k=[]);if(0===parseInt(k[m],32)){m=2;var n=parseInt(k[m],32);m++;var w=parseInt(k[m],32);m++;if(n&1){y=d.indexOf(k,"|")+1;var c=parseInt(k[y],32);y++}if(n&2){K=d.indexOf(k,"|",y)+1;var D=parseInt(k[K],32);K++}}else w=parseInt(k[m],32),m++;for(;m<k.length&&"|"!==k[m];){n=parseInt(k[m],
32)+f;m++;f=n;var E=parseInt(k[m],32)+q;m++;q=E;n=[n/w,E/w];y&&(E=parseInt(k[y],32)+h,y++,h=E,n.push(E/c));K&&(E=parseInt(k[K],32)+e,K++,e=E,n.push(E/D));t.push(n)}f=new P({paths:[t],hasZ:0<y,hasM:0<K});f.setSpatialReference(x);return f},_mergePolylinesToSinglePath:function(z,x){var f=[],q=!1;d.forEach(z,function(t){d.forEach(t.paths,function(k){q=q||t.hasM;f=f.concat(k)})});var h=[],e=[0,0];d.forEach(f,function(t){if(t[0]!==e[0]||t[1]!==e[1])h.push(t),e=t});return new P({paths:[h],spatialReference:x,
hasM:q})}});F.setObject("tasks.DirectionsFeatureSet",O,ba);return O})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(X){F.mixin(this,X)}});F.mixin(O,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});F.setObject("tasks.NAMessage",O,R);return O})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare",
"dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(O,F,d,R,X){return O(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(ba,V){var P=new d;if(this._sd)P.resolve(this._sd);else if(this._url&&this._url.orig){var G=this._url.orig,u=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",C,z=function(x){X({url:x+("/"===x[x.length-1]?"":"/")+"GetTravelModes/execute",
content:{f:"json",serviceName:u},callbackParamName:"callback"}).then(function(f){var q=[],h=null;if(f&&f.results&&f.results.length)for(var e=0;e<f.results.length;e++)if("supportedTravelModes"===f.results[e].paramName){if(f.results[e].value&&f.results[e].value.features)for(var t=0;t<f.results[e].value.features.length;t++)if(f.results[e].value.features[t].attributes){var k=F.parse(f.results[e].value.features[t].attributes.TravelMode);q.push(k)}}else"defaultTravelMode"===f.results[e].paramName&&(h=f.results[e].value);
C.supportedTravelModes=q;C.defaultTravelMode=h;P.resolve(C)},function(f){P.reject(f)})};X({url:G,content:{f:"json"},callbackParamName:"callback"}).then(function(x){C=x;C.supportedTravelModes||(C.supportedTravelModes=[]);for(x=0;x<C.supportedTravelModes.length;x++)C.supportedTravelModes[x].id||(C.supportedTravelModes[x].id=C.supportedTravelModes[x].itemId);V?P.resolve(C):ba?z(ba):10.4<=C.currentVersion?X({url:G+("/"===G[G.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(f){C.supportedTravelModes=
f.supportedTravelModes;C.defaultTravelMode=f.defaultTravelMode;P.resolve(C)},function(f){P.reject(f)}):X({url:G.substring(0,G.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(f){f.owningSystemUrl?(G=f.owningSystemUrl,X({url:G+("/"===G[G.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(q){q&&q.helperServices&&q.helperServices.routingUtilities&&q.helperServices.routingUtilities.url?z(q.helperServices.routingUtilities.url):
P.resolve(C)},function(q){P.reject(q)})):P.resolve(C)},function(f){P.reject(f)})},function(x){P.reject(x)})}else P.reject("NA Task has no URL specified.");P.then(R.hitch(this,function(x){this._sd=x}),R.hitch(this,function(){this._sd=null}));return P.promise},getOwningSystemUrl:function(){var ba=new d;if(this._url&&this._url.orig){var V=this._url.orig;X({url:V.substring(0,V.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(P){ba.resolve(P.owningSystemUrl)})}else ba.resolve(void 0);
return ba.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(O,F,d,R,X,ba,V,P){O=O(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,
findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,
timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(G){var u={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&d.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
d.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:P.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?d.toJson(this.travelMode):this.travelMode},C=this.stops;"esri.tasks.FeatureSet"===C.declaredClass&&0<C.features.length?u.stops=d.toJson({type:"features",features:V._encodeGraphics(C.features,G&&G["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===C.declaredClass?u.stops=C:"esri.tasks.DataFile"===C.declaredClass&&(u.stops=d.toJson({type:"features",url:C.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":u.directionsOutputType="esriDOTComplete";break;case "complete-no-events":u.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":u.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":u.directionsOutputType="esriDOTStandard";break;case "summary-only":u.directionsOutputType="esriDOTSummaryOnly";break;default:u.directionsOutputType=this.directionsOutputType}C=function(z,
x){return z?"esri.tasks.FeatureSet"===z.declaredClass?0<z.features.length?d.toJson({type:"features",features:V._encodeGraphics(z.features,G&&G[x])}):null:"esri.tasks.DataLayer"===z.declaredClass?z:"esri.tasks.DataFile"===z.declaredClass?d.toJson({type:"features",url:z.url}):d.toJson(z):null};this.barriers&&(u.barriers=C(this.barriers,"barriers.features"));this.polygonBarriers&&(u.polygonBarriers=C(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(u.polylineBarriers=C(this.polylineBarriers,
"polylineBarriers.features"));return ba.filter(u,function(z){if(null!==z)return!0})}});F.setObject("tasks.RouteParameters",O,X);return O})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(O,F,d){F={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var R={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},X={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},ba={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},V={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},P={LengthUnit:F,OutputLine:R,
UTurn:X,OutputPolygon:ba,TravelDirection:V};O.setObject("tasks._NALengthUnit",F,d);O.setObject("tasks.NAOutputLine",R,d);O.setObject("tasks.NAUTurn",X,d);O.setObject("tasks.NAOutputPolygon",ba,d);O.setObject("tasks.NATravelDirection",V,d);return P})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query ./PrintParameters ./LegendLayer".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w){O=O(k,{declaredClass:"esri.tasks.PrintTask",constructor:function(c,D){this.url=c;this.printGp=new e(this.url);this._handler=F.hitch(this,this._handler);D&&D.async&&(this.async=!0);this._colorEvaluator=w("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(c,D,E){if(!this._loadGpServerMetadata)return this._execute(c,D,E);var J=new X(u._dfdCanceller),A=this._url.path,S=A.lastIndexOf("/GPServer/");
0<S&&(A=A.slice(0,S+9));J._pendingDfd=z({url:A,callbackParamName:"callback",content:F.mixin({},this._url.query,{f:"json"})}).then(F.hitch(this,function(H){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===H.executionType;this._cimVersion=H.cimVersion;this._is11xService=!!this._cimVersion;J._pendingDfd=this._execute(c);return J._pendingDfd})).then(F.hitch(this,function(H){this._successHandler([H],null,D,J)})).otherwise(function(H){E&&E(H);J.errback(H)});return J},_handler:function(c,
D,E,J,A){try{if(this.async)"esriJobSucceeded"===c.jobStatus?this.printGp.getResultData(c.jobId,"Output_File",F.hitch(this,function(H){S=H.value;this._successHandler([S],"onComplete",E,A)})):this._errorHandler(Error(c.jobStatus),J,A);else{var S=c[0].value;this._successHandler([S],"onComplete",E,A)}}catch(H){this._errorHandler(H,J,A)}},_execute:function(c,D,E){var J=this._handler,A=this._errorHandler,S=c.template||new t;S.hasOwnProperty("showLabels")||(S.showLabels=!0);var H=S.exportOptions,ea;H&&(ea=
{outputSize:[H.width,H.height],dpi:H.dpi});H=S.layoutOptions;var L=[];if(H){this.legendAll=!1;H.legendLayers?d.forEach(H.legendLayers,function(wa){var ra={};ra.id=wa.layerId;wa.subLayerIds&&(ra.subLayerIds=wa.subLayerIds);L.push(ra)}):this.legendAll=!0;if("Miles"===H.scalebarUnit||"Kilometers"===H.scalebarUnit){var v="esriKilometers";var b="esriMiles"}else if("Meters"===H.scalebarUnit||"Feet"===H.scalebarUnit)v="esriMeters",b="esriFeet";var g={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
g={titleText:H.titleText,authorText:H.authorText,copyrightText:H.copyrightText,customTextElements:H.customTextElements,scaleBarOptions:{metricUnit:v,metricLabel:g[v],nonMetricUnit:b,nonMetricLabel:g[b]},legendOptions:{operationalLayers:L}}}v=this._getPrintDefinition(c.map,S);c.outSpatialReference&&(v.mapOptions.spatialReference=c.outSpatialReference.toJson());c.template&&P.isDefined(c.template.showAttribution)&&(v.mapOptions.showAttribution=c.template.showAttribution);F.mixin(v,{exportOptions:ea,
layoutOptions:g});this.allLayerslegend&&F.mixin(v.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(v.operationalLayers){ea=v.operationalLayers;var W=function(wa){return P.fixJson(F.mixin(wa,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},N=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),U=/[\u0600-\u06FF]/,M=function(wa){var ra=wa.text,Ba=(wa=wa.font)&&wa.family&&wa.family.toLowerCase();ra&&wa&&("arial"===
Ba||"arial unicode ms"===Ba)&&(wa.family=N.test(ra)?"Arial Unicode MS":"Arial","normal"!==wa.style&&U.test(ra)&&(wa.family="Arial Unicode MS"))};for(g=0;g<ea.length;g++)if(ea[g].featureCollection&&ea[g].featureCollection.layers)for(b=0;b<ea[g].featureCollection.layers.length;b++){var Z=ea[g].featureCollection.layers[b];if(Z.layerDefinition&&Z.layerDefinition.drawingInfo&&Z.layerDefinition.drawingInfo.renderer&&Z.layerDefinition.drawingInfo.renderer.symbol){var da=Z.layerDefinition.drawingInfo.renderer;
"esriCLS"===da.symbol.type?da.symbol=W(da.symbol):"esriTS"===da.symbol.type?M(da.symbol):da.symbol.outline&&"esriCLS"===da.symbol.outline.type&&(da.symbol.outline=W(da.symbol.outline))}if(Z.featureSet&&Z.featureSet.features)for(H=0;H<Z.featureSet.features.length;H++)da=Z.featureSet.features[H],da.symbol&&("esriCLS"===da.symbol.type?da.symbol=W(da.symbol):"esriTS"===da.symbol.type?M(da.symbol):da.symbol.outline&&"esriCLS"===da.symbol.outline.type&&(da.symbol.outline=W(da.symbol.outline)))}}S={Web_Map_as_JSON:R.toJson(P.fixJson(v)),
Format:S.format,Layout_Template:S.layout};c.extraParameters&&(S=F.mixin(S,c.extraParameters));var oa=new X(u._dfdCanceller);c=function(wa,ra){J(wa,ra,D,E,oa)};v=function(wa){A(wa,E,oa)};oa._pendingDfd=this.async?this.printGp.submitJob(S,c,null,v):this.printGp.execute(S,c,v);return oa},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(c){if(!(8>=ba("ie")||!c.path&&"image/svg+xml"!==c.contentType)){var D=n.createSurface(y.create("div"),1024,1024);var E="image/svg+xml"===c.contentType?D.createObject(n.Image,{src:"data:image/svg+xml;base64,"+c.imageData,width:K.pt2px(c.width),height:K.pt2px(c.height),x:0,y:0}):D.createObject(n.Path,c.path).setFill(c.color).setStroke(c.outline);"pendingRender"in D&&D._render(!0);var J=
D.rawNode.getContext("2d"),A=Math.ceil(E.getBoundingBox().width),S=Math.ceil(E.getBoundingBox().height);E=J.getImageData(E.getBoundingBox().x,E.getBoundingBox().y,A,S);J.canvas.width=A;J.canvas.height=S;J.putImageData(E,0,0);J=J.canvas.toDataURL("image/png");c={type:"esriPMS",imageData:J.substr(22,J.length),angle:c.angle,contentType:"image/png",height:c.size?c.size:K.px2pt(S),width:c.size?A/S*c.size:K.px2pt(A),xoffset:c.xoffset,yoffset:c.yoffset};D.destroy();return c}},_convertSvgRenderer:function(c){"simple"===
c.type&&c.symbol&&(c.symbol.path||"image/svg+xml"===c.symbol.contentType)?c.symbol=this._convertSvgSymbol(c.symbol):"uniqueValue"===c.type?(c.defaultSymbol&&(c.defaultSymbol.path||"image/svg+xml"===c.defaultSymbol.contentType)&&(c.defaultSymbol=this._convertSvgSymbol(c.defaultSymbol)),c.uniqueValueInfos&&d.forEach(c.uniqueValueInfos,function(D){if(D.symbol.path||"image/svg+xml"===D.symbol.contentType)D.symbol=this._convertSvgSymbol(D.symbol)},this)):"classBreaks"===c.type&&(c.defaultSymbol&&(c.defaultSymbol.path||
"image/svg+xml"===c.defaultSymbol.contentType)&&(c.defaultSymbol=this._convertSvgSymbol(c.defaultSymbol)),c.classBreakInfos&&d.forEach(c.classBreakInfos,function(D){if(D.symbol.path||"image/svg+xml"===D.symbol.contentType)D.symbol=this._convertSvgSymbol(D.symbol)},this))},_createFeatureCollection:function(c,D,E,J){var A=this._createPolygonLayer(),S=this._createPolylineLayer(),H=this._createPointLayer(),ea=this._createMultipointLayer(),L=this._createPointLayer();L.layerDefinition.name="textLayer";
delete L.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===c.declaredClass||"esri.layers.StreamLayer"===c.declaredClass)A.layerDefinition.name=S.layerDefinition.name=H.layerDefinition.name=ea.layerDefinition.name=F.getObject("arcgisProps.title",!1,c)||c.name||c.id;var v=c.renderer&&"esri.renderer.SimpleRenderer"===c.renderer.declaredClass;if(!c.renderer||c.renderer.valueExpression||F.isFunction(c.renderer.attributeField))delete A.layerDefinition.drawingInfo,delete S.layerDefinition.drawingInfo,
delete H.layerDefinition.drawingInfo,delete ea.layerDefinition.drawingInfo;else{var b=c.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===b.type){b={latestObservationRenderer:b.latestObservationRenderer,trackLinesRenderer:b.trackRenderer,observationAger:b.observationAger,renderer:b.observationRenderer};var g={};c._trackIdField&&(g.trackIdField=c._trackIdField);c._startTimeField&&(g.startTimeField=c._startTimeField);c._endTimeField&&(g.endTimeField=c._endTimeField);A.layerDefinition.drawingInfo=
b;A.layerDefinition.timeInfo=g;S.layerDefinition.drawingInfo=b;S.layerDefinition.timeInfo=g;H.layerDefinition.drawingInfo=b;H.layerDefinition.timeInfo=g;ea.layerDefinition.drawingInfo=b;ea.layerDefinition.timeInfo=g}else A.layerDefinition.drawingInfo.renderer=b,S.layerDefinition.drawingInfo.renderer=b,H.layerDefinition.drawingInfo.renderer=b,ea.layerDefinition.drawingInfo.renderer=b}b=c.fields;b||!c.renderer||c.renderer.valueExpression||F.isFunction(c.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===
c.renderer.declaredClass?(b=[{name:c.renderer.attributeField,type:"esriFieldTypeDouble"}],c.renderer.normalizationField&&b.push({name:c.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===c.renderer.declaredClass&&(b=[{name:c.renderer.attributeField,type:"esriFieldTypeString"}],c.renderer.attributeField2&&b.push({name:c.renderer.attributeField2,type:"esriFieldTypeString"}),c.renderer.attributeField3&&b.push({name:c.renderer.attributeField3,type:"esriFieldTypeString"})));
b&&(A.layerDefinition.fields=b,S.layerDefinition.fields=b,H.layerDefinition.fields=b,ea.layerDefinition.fields=b);b=c.graphics;c.isFeatureReductionActive&&c.isFeatureReductionActive()&&(b=c.getSingleGraphics());g=b.length;var W;for(W=0;W<g;W++){var N=b[W];if(!1!==N.visible&&N.geometry){var U=N.toJson();U.symbol&&U.symbol.outline&&U.symbol.outline.color&&U.symbol.outline.color[3]&&!this._is11xService&&(U.symbol.outline.color[3]=255);if(c.renderer&&!U.symbol&&(F.isFunction(c.renderer.attributeField)||
c.renderer.valueExpression||this._isFeatureCollectionRequired(c.renderer,c)||"esri.renderer.DotDensityRenderer"===c.renderer.declaredClass||E)){E=E||c.renderer;var M=null;try{M=E.getSymbol(N)}catch(Z){}if(!M)continue;U.symbol=M.toJson();this._isFeatureCollectionRequired(E,c)&&this._applyVisualVariables(U.symbol,{renderer:E,graphic:N,symbol:M,mapResolution:D&&D.getResolutionInMeters(),mapScale:D&&D.getScale()})}U.symbol&&(U.symbol.path||"image/svg+xml"===U.symbol.contentType?U.symbol=this._convertSvgSymbol(U.symbol):
U.symbol.text&&delete U.attributes);switch(N.geometry.type){case "polygon":A.featureSet.features.push(U);break;case "polyline":S.featureSet.features.push(U);break;case "point":U.symbol&&U.symbol.text?L.featureSet.features.push(U):H.featureSet.features.push(U);break;case "multipoint":ea.featureSet.features.push(U);break;case "extent":U.geometry=f.fromExtent(N.geometry).toJson(),A.featureSet.features.push(U)}}}D=[];0<A.featureSet.features.length&&D.push(A);0<S.featureSet.features.length&&D.push(S);
0<ea.featureSet.features.length&&D.push(ea);0<H.featureSet.features.length&&D.push(H);0<L.featureSet.features.length&&D.push(L);if(!D.length)return null;d.forEach(D,function(Z){var da=d.every(Z.featureSet.features,function(oa){return oa.symbol});if(v||da)J&&J.forceFeatureAttributes||d.forEach(Z.featureSet.features,function(oa){delete oa.attributes}),J.forceFeatureAttributes||delete Z.layerDefinition.fields;da&&delete Z.layerDefinition.drawingInfo});d.forEach(D,function(Z){Z.layerDefinition.drawingInfo&&
Z.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(Z.layerDefinition.drawingInfo.renderer)},this);return{id:c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0,featureCollection:{layers:D}}},_getPrintDefinition:function(c,D){var E={operationalLayers:this._createOperationalLayers(c,D)},J=this._vtlExtent||c.extent,A=c.spatialReference;this._vtlExtent=null;c.spatialReference._isWrappable()&&(J=J._normalize(!0),A=J.spatialReference);J={mapOptions:{showAttribution:c.showAttribution,
extent:J.toJson(),spatialReference:A.toJson()}};D.preserveScale&&F.mixin(J.mapOptions,{scale:D.outScale||c.getScale()});c.timeExtent&&F.mixin(J.mapOptions,{time:[c.timeExtent.startTime.getTime(),c.timeExtent.endTime.getTime()]});A={};F.mixin(A,J,E);return A},_createOperationalLayers:function(c,D){var E,J=[],A=0;D.preserveScale&&(A=D.outScale||c.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var S=d.map(c.layerIds,c.getLayer,c);c._mapImageLyr&&S.push(c._mapImageLyr);for(E=
0;E<S.length;E++){var H=S[E];if(H.loaded&&H.visible&&(!A||H.isVisibleAtScale(A))){var ea=H.declaredClass;var L={id:H.id,title:F.getObject("arcgisProps.title",!1,H)||H.id,opacity:H.opacity,minScale:H.minScale||0,maxScale:H.maxScale||0};L=F.mixin(L,this._getUrlAndToken(H));H.getNode()&&m.get(H.getNode(),"data-reference")&&(L._isRefLayer=!0);switch(ea){case "esri.layers.ArcGISDynamicMapServiceLayer":var v=[];ea=!!H._params.layers;if(H._params.dynamicLayers)ea=D.outScale?H._getDynLayerObjs(D.outScale):
R.fromJson(H._params.dynamicLayers),d.forEach(ea,function(U){v.push({id:U.id,name:U.name,layerDefinition:U});delete U.id;delete U.name;delete U.maxScale;delete U.minScale}),0===v.length&&(L.visibleLayers=[-1]);else if(H.supportsDynamicLayers){if(ea||H.layerDefinitions||H.layerTimeOptions){var b=H.createDynamicLayerInfosFromLayerInfos(),g=null;ea&&(g=H.visibleLayers);g=G._getVisibleLayers(b,g);var W=G._getLayersForScale(D.outScale||c.getScale(),b);d.forEach(b,function(U){if(!U.subLayerIds){var M=U.id;
-1<d.indexOf(g,M)&&-1<d.indexOf(W,M)&&(U={source:U.source.toJson()},H.layerDefinitions&&H.layerDefinitions[M]&&(U.definitionExpression=H.layerDefinitions[M]),H.layerTimeOptions&&H.layerTimeOptions[M]&&(U.layerTimeOptions=H.layerTimeOptions[M].toJson()),v.push({id:M,layerDefinition:U}))}});0===v.length&&(L.visibleLayers=[-1])}}else d.forEach(H.layerInfos,function(U){var M={id:U.id,layerDefinition:{}};H.layerDefinitions&&H.layerDefinitions[U.id]&&(M.layerDefinition.definitionExpression=H.layerDefinitions[U.id]);
H.layerTimeOptions&&H.layerTimeOptions[U.id]&&(M.layerDefinition.layerTimeOptions=H.layerTimeOptions[U.id].toJson());(M.layerDefinition.definitionExpression||M.layerDefinition.layerTimeOptions)&&v.push(M)}),ea&&(L.visibleLayers=H.visibleLayers.length?H.visibleLayers:[-1]);v.length&&(L.layers=v);J.push(L);this.allLayerslegend&&this.allLayerslegend.push({id:H.id,subLayerIds:H.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":L=F.mixin(L,{url:H.url,bandIds:H.bandIds,compressionQuality:H.compressionQuality,
format:H.format,interpolation:H.interpolation});H.mosaicRule&&F.mixin(L,{mosaicRule:H.mosaicRule.toJson()});if(H.renderingRule||H.renderer)this._is11xService?(H.renderingRule&&(L.renderingRule=H.renderingRule.toJson()),H.renderer&&(L.layerDefinition=L.layerDefinition||{},L.layerDefinition.drawingInfo=L.layerDefinition.drawingInfo||{},L.layerDefinition.drawingInfo.renderer=H.renderer.toJson())):(ea=H.getExportImageRenderingRule())&&F.mixin(L,{renderingRule:ea.toJson()});J.push(L);this.allLayerslegend&&
this.allLayerslegend.push({id:H.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(L=F.mixin(L,{url:H.url,bandIds:H.bandIds,interpolation:H.interpolation}),H.renderer&&(L.layerDefinition=L.layerDefinition||{},L.layerDefinition.drawingInfo=L.layerDefinition.drawingInfo||{},L.layerDefinition.drawingInfo.renderer=H.renderer.toJson()),J.push(L),this.allLayerslegend&&this.allLayerslegend.push({id:H.id}));break;case "esri.layers.WMSLayer":L=F.mixin(L,{url:H.url,title:H.title,type:"wms",version:H.version,
transparentBackground:H.imageTransparency,visibleLayers:H.visibleLayers});J.push(L);this.allLayerslegend&&this.allLayerslegend.push({id:H.id,subLayerIds:H.visibleLayers});break;case "esri.virtualearth.VETiledLayer":ea=H.mapStyle;"roadOnDemand"===ea?ea="Road":"aerialWithLabelsOnDemand"===ea&&(ea="Hybrid");L=F.mixin(L,{visibility:H.visible,type:"BingMaps"+ea,culture:H.culture,key:H.bingMapsKey});J.push(L);break;case "esri.layers.OpenStreetMapLayer":L=F.mixin(L,{credits:H.copyright,type:"OpenStreetMap",
url:x.getAbsoluteUrl(H.tileServers[0])});J.push(L);break;case "esri.layers.WMTSLayer":L=F.mixin(L,{url:H.url,type:"wmts",layer:H._identifier,style:H._style,format:H.format,tileMatrixSet:H._tileMatrixSetId});J.push(L);break;case "esri.layers.MapImageLayer":ea=H.getImages();d.forEach(ea,function(U,M){U.visible&&U.href&&(L={id:H.id+"_image"+M,type:"image",title:H.id,minScale:H.minScale||0,maxScale:H.maxScale||0,opacity:H.opacity*U.opacity,extent:U.extent.toJson()},"data:image/png;base64,"===U.href.substr(0,
22)?L.imageData=U.href.substr(22):L.url=U.href,J.push(L))});break;case "esri.layers.VectorTileLayer":delete L.url;delete L.token;if(this._is11xService&&H.currentStyleInfo.serviceUrl&&H.currentStyleInfo.styleUrl&&(ea=V.id&&V.id.findCredential(H.currentStyleInfo.styleUrl),b=V.id&&V.id.findCredential(H.currentStyleInfo.serviceUrl),!ea&&!b||"2.1.0"!==this._cimVersion)){L.type="VectorTileLayer";L.styleUrl=H.currentStyleInfo.styleUrl;ea&&(L.token=ea.token);b&&b.token!==L.token&&(L.additionalTokens=[{url:H.currentStyleInfo.serviceUrl,
token:b.token}]);J.push(L);break}L.type="image";ea=this._vtlExtent||c.extent.offset(0,0);var N=D.exportOptions&&D.exportOptions.dpi||96;b={format:"png",pixelRatio:N/96};"MAP_ONLY"!==D.layout||!D.preserveScale||D.outScale&&D.outScale!==c.getScale()||96!==N||!D.exportOptions||D.exportOptions.width%2===c.width%2&&D.exportOptions.height%2===c.height%2||(b.area={x:0,y:0,width:c.width,height:c.height},D.exportOptions.width%2!==c.width%2&&--b.area.width,D.exportOptions.height%2!==c.height%2&&--b.area.height,
this._vtlExtent||(N=c.toMap({x:b.area.width,y:b.area.height}),ea.update(ea.xmin,N.y,N.x,ea.ymax,ea.spatialReference),this._vtlExtent=ea));L.extent=ea._normalize(!0).toJson();ea=H.takeScreenshot(b);ea.isResolved()&&ea.then(function(U){"data:image/png;base64,"===U.dataURL.substr(0,22)&&(L.imageData=U.dataURL.substr(22))});L.imageData&&J.push(L);break;case "esri.layers.WebTiledLayer":ea=H.url.replace(/\$\{/g,"{");L=F.mixin(L,{type:"WebTiledLayer",urlTemplate:ea,credits:H.copyright});H.subDomains&&0<
H.subDomains.length&&(L.subDomains=H.subDomains);H._wmtsInfo&&(L.wmtsInfo=H._wmtsInfo);delete L.url;J.push(L);break;default:if(H.getTileUrl||H.getImageUrl)L=F.mixin(L,{url:H.url}),J.push(L)}}}S=d.map(c.graphicsLayerIds,c.getLayer,c);for(E=0;E<S.length;E++)H=S[E],H.isFeatureReductionActive&&H.isFeatureReductionActive()&&(H.getSingleGraphics().length?S.splice(++E,0,H.getFeatureReductionLayer()):S[E]=H.getFeatureReductionLayer());for(E=0;E<S.length;E++)if(H=S[E],H.loaded&&H.visible&&(!A||H.isVisibleAtScale(A)))switch(ea=
H.declaredClass,ea){case "esri.layers.CSVLayer":if(this._is11xService){L={id:H.id,url:H.url,title:H.title,opacity:H.opacity,minScale:H.minScale||0,maxScale:H.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:H.latitudeFieldName,longitudeFieldName:H.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:H.renderer&&H.renderer.toJson()}}};J.push(L);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===ea&&!D.showLabels||
H.renderer&&"esri.renderer.HeatmapRenderer"===H.renderer.declaredClass)continue;ea=null;H.url&&H.renderer&&("esri.renderer.ScaleDependentRenderer"===H.renderer.declaredClass?"scale"===H.renderer.rangeType?ea=H.renderer.getRendererInfoByScale(c.getScale())&&H.renderer.getRendererInfoByScale(c.getScale()).renderer:"zoom"===H.renderer.rangeType&&(ea=H.renderer.getRendererInfoByZoom(c.getZoom())&&H.renderer.getRendererInfoByZoom(c.getZoom()).renderer):ea=H.renderer);b=ea&&"esri.layers.CSVLayer"!==H.declaredClass&&
!this._isFeatureCollectionRequired(ea,H)&&!ea.valueExpression;N=H.isFeatureReductionActive&&H.isFeatureReductionActive();if(ea&&!N&&"esri.renderer.DotDensityRenderer"!==ea.declaredClass&&"esri.layers.StreamLayer"!==H.declaredClass&&(this._is11xService||b)&&("esri.renderer.SimpleRenderer"===ea.declaredClass||"esri.renderer.TemporalRenderer"===ea.declaredClass||null==ea.attributeField||F.isString(ea.attributeField)&&H._getField(ea.attributeField,!0)))if(L={id:H.id,title:F.getObject("arcgisProps.title",
!1,H)||H.id,opacity:H.opacity,minScale:H.minScale||0,maxScale:H.maxScale||0,layerDefinition:{drawingInfo:{renderer:ea.toJson({useLegacyRotationProperties:!this._is11xService})}}},L=F.mixin(L,this._getUrlAndToken(H)),"esri.renderer.TemporalRenderer"===ea.declaredClass&&(b=L.layerDefinition.drawingInfo,b.latestObservationRenderer=b.renderer.latestObservationRenderer,b.trackLinesRenderer=b.renderer.trackRenderer,b.observationAger=b.renderer.observationAger,b.renderer=b.renderer.observationRenderer,H._trackIdField&&
(L.layerDefinition.timeInfo={trackIdField:H._trackIdField})),this._convertSvgRenderer(L.layerDefinition.drawingInfo.renderer),this._is11xService||1>H.opacity||"esri.renderer.TemporalRenderer"===ea.declaredClass||this._updateLayerOpacity(L))if(H._params.source&&(ea=H._params.source.toJson(),F.mixin(L.layerDefinition,{source:ea})),H.getDefinitionExpression()&&F.mixin(L.layerDefinition,{definitionExpression:H.getDefinitionExpression()}),2!==H.mode)0<H.getSelectedFeatures().length&&(ea=d.map(H.getSelectedFeatures(),
function(U){return U.attributes[H.objectIdField]}),0<ea.length&&H.getSelectionSymbol()&&F.mixin(L,{selectionObjectIds:ea,selectionSymbol:H.getSelectionSymbol().toJson()}));else{ea=d.map(H.getSelectedFeatures(),function(U){return U.attributes[H.objectIdField]});if(0===ea.length||!H._params.drawMode)break;F.mixin(L.layerDefinition,{objectIds:ea});ea=null;H.getSelectionSymbol()&&(ea=new q(H.getSelectionSymbol()));F.mixin(L.layerDefinition.drawingInfo,{renderer:ea&&ea.toJson()})}else L=this._createFeatureCollection(H,
c,null,D);else L=ea&&(ea.valueExpression||this._isFeatureCollectionRequired(ea,H)||"esri.renderer.DotDensityRenderer"===ea.declaredClass)?this._createFeatureCollection(H,c,ea,D):this._createFeatureCollection(H,c,null,D);if(!L)continue;J.push(L);this.allLayerslegend&&this.allLayerslegend.push({id:H.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":L=this._createFeatureCollection(H,c,null,D);if(!L)continue;J.push(L);this.allLayerslegend&&this.allLayerslegend.push({id:H.id});
break;case "esri.layers.ArcGISImageServiceVectorLayer":L={id:H.id,title:F.getObject("arcgisProps.title",!1,H)||H.id,opacity:H.opacity,minScale:H.minScale||0,maxScale:H.maxScale||0,visibility:H.visible,symbolTileSize:H.symbolTileSize,layerDefinition:{drawingInfo:{renderer:H.renderer.toJson({useLegacyRotationProperties:!this._is11xService})}}},L=F.mixin(L,this._getUrlAndToken(H)),H.mosaicRule&&F.mixin(L,{mosaicRule:H.mosaicRule.toJson()}),J.push(L),this.allLayerslegend&&this.allLayerslegend.push({id:H.id})}A&&
d.forEach(J,function(U){U.minScale=0;U.maxScale=0});c.graphics&&0<c.graphics.graphics.length&&(L=this._createFeatureCollection(c.graphics,c,null,D))&&J.push(L);c._labels&&D.showLabels&&(L=this._createFeatureCollection(c._labels,c,null,D))&&J.push(L);d.forEach(J,function(U,M,Z){U._isRefLayer&&(delete U._isRefLayer,Z.splice(M,1),Z.push(U))});return J},_getUrlAndToken:function(c){return{token:c._getToken(),url:c._url?c._url.path:null}},_updateLayerOpacity:function(c){var D=this._colorEvaluator(c);D=
d.filter(D,function(S){return F.isArray(S)&&4===S.length});var E=!0;if(D.length){var J=D[0][3],A;for(A=1;A<D.length;A++)if(J!==D[A][3]){E=!1;break}if(E)for(c.opacity=J/255,A=0;A<D.length;A++)D[A][3]=255}return E},_isFeatureCollectionRequired:function(c,D){if(D&&D.isFeatureReductionActive&&D.isFeatureReductionActive())return!0;var E=!1,J=this._getVariable(c,"rotationInfo",!1);J&&(E=(E=J.field)&&F.isFunction(E)||J.valueExpression);return c.hasVisualVariables("sizeInfo")||c.hasVisualVariables("colorInfo")||
c.hasVisualVariables("opacityInfo")||E},_getVariable:function(c,D,E){if(c)var J=(c=c.getVisualVariablesForType(D,E))&&c[0];return J},_applyVisualVariables:function(c,D){var E=D.renderer,J=D.graphic,A=D.symbol,S=D.mapResolution,H=D.mapScale,ea=A.type;if("textsymbol"!==ea&&"shieldlabelsymbol"!==ea){var L=this._getVariable(E,"sizeInfo",!1),v=this._getVariable(E,"colorInfo",!1),b=this._getVariable(E,"opacityInfo",!1),g=this._getVariable(E,"rotationInfo",!1);A instanceof h&&(L=this._getVariable(E,"sizeInfo",
"outline")||L);S=L?E.getSize(J,{sizeInfo:L,shape:"simplemarkersymbol"===ea?A.style:null,resolution:S,scale:H}):J.size;null!=S&&("simplemarkersymbol"===ea?c.size=K.px2pt(S):"picturemarkersymbol"===ea?(H=A.width/A.height*S,c.width=K.px2pt(H),c.height=K.px2pt(S),0!==A.xoffset&&(c.xoffset=K.px2pt(A.xoffset/A.width*H)),0!==A.yoffset&&(c.yoffset=K.px2pt(A.yoffset/A.height*S))):"simplelinesymbol"===ea?c.width=K.px2pt(S):c.outline&&(c.outline.width=K.px2pt(S)));v&&(!(A=E.getColor(J,{colorInfo:v}))||"simplemarkersymbol"!==
ea&&"simplelinesymbol"!==ea&&"simplefillsymbol"!==ea||(c.color=C.toJsonColor(A)));b&&(ea=E.getOpacity(J,{opacityInfo:b}),null!=ea&&c.color&&(c.color[3]=Math.round(255*ea)));g&&(E=E.getRotationAngle(J,{rotationInfo:g}))&&(c.angle=-E)}}});F.setObject("tasks.PrintTask",O,V);return O})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,
dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});F.setObject("tasks.PrintTemplate",O,R);return O})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(O,F,d,R,X,ba,V,P,G,u,C,z,x){function f(v,b,g,W,N,U,M,Z,da,oa){var wa=b.length,ra=
0;if(oa){var Ba=oa.l/N;ra=oa.i}else Ba=b[0]/N;for(;U<M;){if(U+Ba>M){var Ia={l:(U+Ba-M)*N,i:ra};Ba=M-U}ra%2||(v.beginPath(),v.arc(g,W,N,U,U+Ba,Z),da&&v.stroke());U+=Ba;++ra;Ba=b[ra%wa]/N}return Ia}function q(v,b,g,W){var N=0,U=0,M=0;if(W){var Z=W.l;M=W.i}else Z=b[0];for(;1>U;)U=x.tAtLength(v,Z),1==U&&(N=x.computeLength(v),N={l:Z-N,i:M}),v=x.splitBezierAtT(v,U),M%2||g.push(v[0]),v=v[1],++M,Z=b[M%b.length];return N}function h(v,b,g,W){var N=[b.last.x,b.last.y].concat(g),U=!(v instanceof Array);g=4===
g.length?"quadraticCurveTo":"bezierCurveTo";var M=[];b=q(N,b.canvasDash,M,W);for(W=0;W<M.length;++W)N=M[W],U?(v.moveTo(N[0],N[1]),v[g].apply(v,N.slice(2))):(v.push("moveTo",[N[0],N[1]]),v.push(g,N.slice(2)));return b}function e(v,b,g,W,N,U,M){var Z=0,da=0,oa=0,wa=x.distance(g,W,N,U),ra=0;b=b.canvasDash;var Ba=g,Ia=W,Ma=!(v instanceof Array);M?(oa=M.l,ra=M.i):oa+=b[0];for(;.01<Math.abs(1-da);){oa>wa&&(Z={l:oa-wa,i:ra},oa=wa);da=oa/wa;M=g+(N-g)*da;var Za=W+(U-W)*da;ra++%2||(Ma?(v.moveTo(Ba,Ia),v.lineTo(M,
Za)):(v.push("moveTo",[Ba,Ia]),v.push("lineTo",[M,Za])));Ba=M;Ia=Za;oa+=b[ra%b.length]}return Z}var t=O.canvas={},k=null,m=C.multiplyPoint,y=Math.PI,K=2*y,n=y/2;z=F.extend;if(X.global.CanvasRenderingContext2D){X=X.doc.createElement("canvas").getContext("2d");var w="function"==typeof X.setLineDash,c="function"==typeof X.fillText}var D={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,
3,1,3],longdashdotdot:[8,3,1,3,1,3]};t.Shape=R("dojox.gfx.canvas.Shape",P.Shape,{_render:function(v){v.save();this._renderTransform(v);this._renderClip(v);this._renderShape(v);this._renderFill(v,!0);this._renderStroke(v,!0);v.restore()},_renderClip:function(v){this.canvasClip&&(this.canvasClip.render(v),v.clip())},_renderTransform:function(v){if("canvasTransform"in this){var b=this.canvasTransform;v.translate(b.dx,b.dy);v.rotate(b.angle2);v.scale(b.sx,b.sy);v.rotate(b.angle1)}},_renderShape:function(v){},
_renderFill:function(v,b){if("canvasFill"in this){var g=this.fillStyle;if("canvasFillImage"in this){var W=g.width,N=g.height,U=this.canvasFillImage.width,M=this.canvasFillImage.height,Z=Math.min(W==U?1:W/U,N==M?1:N/M),da=(W-Z*U)/2,oa=(N-Z*M)/2;k.width=W;k.height=N;var wa=k.getContext("2d");wa.clearRect(0,0,W,N);wa.drawImage(this.canvasFillImage,0,0,U,M,da,oa,Z*U,Z*M);this.canvasFill=v.createPattern(k,"repeat");delete this.canvasFillImage}v.fillStyle=this.canvasFill;b&&("pattern"!==g.type||0===g.x&&
0===g.y||v.translate(g.x,g.y),v.fill())}else v.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(v,b){var g=this.strokeStyle;g?(v.strokeStyle=g.color.toString(),v.lineWidth=g.width,v.lineCap=g.cap,"number"==typeof g.join?(v.lineJoin="miter",v.miterLimit=g.join):v.lineJoin=g.join,this.canvasDash?w?(v.setLineDash(this.canvasDash),b&&v.stroke()):this._renderDashedStroke(v,b):b&&v.stroke()):b||(v.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(v,b){},getEventSource:function(){return null},
on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(v){this.inherited(arguments);var b=v?"width"in v?"rect":"cx"in v?"ellipse":"points"in v?"polyline":"d"in v?"path":null:null;if(v&&!b)return this;this.canvasClip=v?E(b,v):null;this.parent&&this.parent._makeDirty();return this}});var E=function(v,b){switch(v){case "ellipse":return{canvasEllipse:H({shape:b}),render:function(g){return t.Ellipse.prototype._renderShape.call(this,g)}};case "rect":return{shape:F.delegate(b,
{r:0}),render:function(g){return t.Rect.prototype._renderShape.call(this,g)}};case "path":return{canvasPath:J(b),render:function(g){this.canvasPath._renderShape(g)}};case "polyline":return{canvasPolyline:b.points,render:function(g){return t.Polyline.prototype._renderShape.call(this,g)}}}return null},J=function(v){var b=new dojox.gfx.canvas.Path;b.canvasPath=[];b._setPath(v.d);return b},A=function(v,b,g){var W=v.prototype[b];v.prototype[b]=g?function(){this.parent&&this.parent._makeDirty();W.apply(this,
arguments);g.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return W.apply(this,arguments)}};A(t.Shape,"setTransform",function(){this.matrix?this.canvasTransform=O.decompose(this.matrix):delete this.canvasTransform});A(t.Shape,"setFill",function(){var v=this.fillStyle;if(v){if("object"==typeof v&&"type"in v){var b=this.surface.rawNode.getContext("2d");switch(v.type){case "linear":case "radial":var g="linear"==v.type?b.createLinearGradient(v.x1,v.y1,v.x2,v.y2):b.createRadialGradient(v.cx,
v.cy,0,v.cx,v.cy,v.r);d.forEach(v.colors,function(W){g.addColorStop(W.offset,O.normalizeColor(W.color).toString())});break;case "pattern":k||(k=document.createElement("canvas")),b=new Image,this.surface.downloadImage(b,v.src),this.canvasFillImage=b}}else g=v.toString();this.canvasFill=g}else delete this.canvasFill});A(t.Shape,"setStroke",function(){var v=this.strokeStyle;if(v){var b=this.strokeStyle.style.toLowerCase();b in D&&(b=D[b]);if(b instanceof Array){this.canvasDash=b=b.slice();var g;for(g=
0;g<b.length;++g)b[g]*=v.width;if("butt"!=v.cap){for(g=0;g<b.length;g+=2)b[g]-=v.width,1>b[g]&&(b[g]=1);for(g=1;g<b.length;g+=2)b[g]+=v.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!w&&!!this.canvasDash});A(t.Shape,"setShape");t.Group=R("dojox.gfx.canvas.Group",t.Shape,{constructor:function(){P.Container._init.call(this)},_render:function(v){v.save();this._renderTransform(v);this._renderClip(v);for(var b=0;b<this.children.length;++b)this.children[b]._render(v);v.restore()},
destroy:function(){P.Container.clear.call(this,!0);t.Shape.prototype.destroy.apply(this,arguments)}});t.Rect=R("dojox.gfx.canvas.Rect",[t.Shape,P.Rect],{_renderShape:function(v){var b=this.shape,g=Math.min(b.r,b.height/2,b.width/2),W=b.x,N=W+b.width,U=b.y;b=U+b.height;var M=W+g,Z=N-g,da=U+g,oa=b-g;v.beginPath();v.moveTo(M,U);g?(v.arc(Z,da,g,-n,0,!1),v.arc(Z,oa,g,0,n,!1),v.arc(M,oa,g,n,y,!1),v.arc(M,da,g,y,y+n,!1)):(v.lineTo(Z,U),v.lineTo(N,oa),v.lineTo(M,b),v.lineTo(W,da));v.closePath()},_renderDashedStroke:function(v,
b){var g=this.shape,W=Math.min(g.r,g.height/2,g.width/2),N=g.x,U=N+g.width,M=g.y,Z=M+g.height,da=N+W,oa=U-W,wa=M+W,ra=Z-W;W?(v.beginPath(),g=e(v,this,da,M,oa,M),b&&v.stroke(),g=f(v,this.canvasDash,oa,wa,W,-n,0,!1,b,g),v.beginPath(),g=e(v,this,U,wa,U,ra,g),b&&v.stroke(),g=f(v,this.canvasDash,oa,ra,W,0,n,!1,b,g),v.beginPath(),g=e(v,this,oa,Z,da,Z,g),b&&v.stroke(),g=f(v,this.canvasDash,da,ra,W,n,y,!1,b,g),v.beginPath(),g=e(v,this,N,ra,N,wa,g),b&&v.stroke(),f(v,this.canvasDash,da,wa,W,y,y+n,!1,b,g)):
(v.beginPath(),g=e(v,this,da,M,oa,M),g=e(v,this,oa,M,U,ra,g),g=e(v,this,U,ra,da,Z,g),e(v,this,da,Z,N,wa,g),b&&v.stroke())}});var S=[];(function(){var v=u.curvePI4;S.push(v.s,v.c1,v.c2,v.e);for(var b=45;360>b;b+=45){var g=C.rotateg(b);S.push(m(g,v.c1),m(g,v.c2),m(g,v.e))}})();var H=function(v){var b=[],g=v.shape,W=C.normalize([C.translate(g.cx,g.cy),C.scale(g.rx,g.ry)]);var N=m(W,S[0]);b.push([N.x,N.y]);for(g=1;g<S.length;g+=3){var U=m(W,S[g]);var M=m(W,S[g+1]);N=m(W,S[g+2]);b.push([U.x,U.y,M.x,M.y,
N.x,N.y])}if(v._needsDash){N=[];U=b[0];for(g=1;g<b.length;++g)M=[],q(U.concat(b[g]),v.canvasDash,M),U=[b[g][4],b[g][5]],N.push(M);v._dashedPoints=N}return b};t.Ellipse=R("dojox.gfx.canvas.Ellipse",[t.Shape,P.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=H(this);return this},setStroke:function(){this.inherited(arguments);w||(this.canvasEllipse=H(this));return this},_renderShape:function(v){var b=this.canvasEllipse,g;v.beginPath();v.moveTo.apply(v,b[0]);for(g=1;g<b.length;++g)v.bezierCurveTo.apply(v,
b[g]);v.closePath()},_renderDashedStroke:function(v,b){var g=this._dashedPoints;v.beginPath();for(var W=0;W<g.length;++W)for(var N=g[W],U=0;U<N.length;++U){var M=N[U];v.moveTo(M[0],M[1]);v.bezierCurveTo(M[2],M[3],M[4],M[5],M[6],M[7])}b&&v.stroke()}});t.Circle=R("dojox.gfx.canvas.Circle",[t.Shape,P.Circle],{_renderShape:function(v){var b=this.shape;v.beginPath();v.arc(b.cx,b.cy,b.r,0,K,1)},_renderDashedStroke:function(v,b){var g=this.shape,W=0,N=this.canvasDash.length;for(i=0;W<K;){var U=this.canvasDash[i%
N]/g.r;i%2||(v.beginPath(),v.arc(g.cx,g.cy,g.r,W,W+U,0),b&&v.stroke());W+=U;++i}}});t.Line=R("dojox.gfx.canvas.Line",[t.Shape,P.Line],{_renderShape:function(v){var b=this.shape;v.beginPath();v.moveTo(b.x1,b.y1);v.lineTo(b.x2,b.y2)},_renderDashedStroke:function(v,b){var g=this.shape;v.beginPath();e(v,this,g.x1,g.y1,g.x2,g.y2);b&&v.stroke()}});t.Polyline=R("dojox.gfx.canvas.Polyline",[t.Shape,P.Polyline],{setShape:function(){this.inherited(arguments);var v=this.shape.points,b=v[0],g;this.bbox=null;
this._normalizePoints();if(v.length)if("number"==typeof b)b=v;else for(b=[],g=0;g<v.length;++g){var W=v[g];b.push(W.x,W.y)}else b=[];this.canvasPolyline=b;return this},_renderShape:function(v){var b=this.canvasPolyline;if(b.length){v.beginPath();v.moveTo(b[0],b[1]);for(var g=2;g<b.length;g+=2)v.lineTo(b[g],b[g+1])}},_renderDashedStroke:function(v,b){var g=this.canvasPolyline,W=0;v.beginPath();for(var N=0;N<g.length;N+=2)W=e(v,this,g[N],g[N+1],g[N+2],g[N+3],W);b&&v.stroke()}});t.Image=R("dojox.gfx.canvas.Image",
[t.Shape,P.Image],{setShape:function(){this.inherited(arguments);var v=new Image;this.surface.downloadImage(v,this.shape.src);this.canvasImage=v;return this},_renderShape:function(v){var b=this.shape;v.drawImage(this.canvasImage,b.x,b.y,b.width,b.height)}});t.Text=R("dojox.gfx.canvas.Text",[t.Shape,P.Text],{_setFont:function(){this.fontStyle?this.canvasFont=O.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var v=this.shape,b=0;if(v.text){var g=this.surface.rawNode.getContext("2d");
g.save();this._renderTransform(g);this._renderFill(g,!1);this._renderStroke(g,!1);this.canvasFont&&(g.font=this.canvasFont);b=g.measureText(v.text).width;g.restore()}return b},_render:function(v){v.save();this._renderTransform(v);this._renderFill(v,!1);this._renderStroke(v,!1);this._renderShape(v);v.restore()},_renderShape:function(v){var b=this.shape;b.text&&(v.textAlign="middle"===b.align?"center":b.align,this.canvasFont&&(v.font=this.canvasFont),this.canvasFill&&v.fillText(b.text,b.x,b.y),this.strokeStyle&&
(v.beginPath(),v.strokeText(b.text,b.x,b.y),v.closePath()))}});A(t.Text,"setFont");c||t.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var ea={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};
t.Path=R("dojox.gfx.canvas.Path",[t.Shape,G.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);w||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(v){var b=F.clone(this.last);this[ea[v.action]](this.canvasPath,v.action,v.args,this._needsDash?this._dashedPath:
null);this.last=b;this.inherited(arguments)},_renderShape:function(v){var b=this.canvasPath;v.beginPath();for(var g=0;g<b.length;g+=2)v[b[g]].apply(v,b[g+1])},_renderDashedStroke:w?function(){}:function(v,b){var g=this._dashedPath;v.beginPath();for(var W=0;W<g.length;W+=2)v[g[W]].apply(v,g[W+1]);b&&v.stroke()},_moveToA:function(v,b,g,W){v.push("moveTo",[g[0],g[1]]);W&&W.push("moveTo",[g[0],g[1]]);for(b=2;b<g.length;b+=2)v.push("lineTo",[g[b],g[b+1]]),W&&(this._dashResidue=e(W,this,g[b-2],g[b-1],g[b],
g[b+1],this._dashResidue));this.last.x=g[g.length-2];this.last.y=g[g.length-1];this.lastControl={}},_moveToR:function(v,b,g,W){b="x"in this.last?[this.last.x+=g[0],this.last.y+=g[1]]:[this.last.x=g[0],this.last.y=g[1]];v.push("moveTo",b);W&&W.push("moveTo",b);for(b=2;b<g.length;b+=2)v.push("lineTo",[this.last.x+=g[b],this.last.y+=g[b+1]]),W&&(this._dashResidue=e(W,this,W[W.length-1][0],W[W.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(v,b,g,W){for(b=
0;b<g.length;b+=2)W&&(this._dashResidue=e(W,this,this.last.x,this.last.y,g[b],g[b+1],this._dashResidue)),v.push("lineTo",[g[b],g[b+1]]);this.last.x=g[g.length-2];this.last.y=g[g.length-1];this.lastControl={}},_lineToR:function(v,b,g,W){for(b=0;b<g.length;b+=2)v.push("lineTo",[this.last.x+=g[b],this.last.y+=g[b+1]]),W&&(this._dashResidue=e(W,this,W[W.length-1][0],W[W.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(v,b,g,W){for(b=0;b<g.length;++b)v.push("lineTo",
[g[b],this.last.y]),W&&(this._dashResidue=e(W,this,W[W.length-1][0],W[W.length-1][1],g[b],this.last.y,this._dashResidue));this.last.x=g[g.length-1];this.lastControl={}},_hLineToR:function(v,b,g,W){for(b=0;b<g.length;++b)v.push("lineTo",[this.last.x+=g[b],this.last.y]),W&&(this._dashResidue=e(W,this,W[W.length-1][0],W[W.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(v,b,g,W){for(b=0;b<g.length;++b)v.push("lineTo",[this.last.x,g[b]]),W&&(this._dashResidue=
e(W,this,W[W.length-1][0],W[W.length-1][1],this.last.x,g[b],this._dashResidue));this.last.y=g[g.length-1];this.lastControl={}},_vLineToR:function(v,b,g,W){for(b=0;b<g.length;++b)v.push("lineTo",[this.last.x,this.last.y+=g[b]]),W&&(this._dashResidue=e(W,this,W[W.length-1][0],W[W.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(v,b,g,W){for(b=0;b<g.length;b+=6)v.push("bezierCurveTo",g.slice(b,b+6)),W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));
this.last.x=g[g.length-2];this.last.y=g[g.length-1];this.lastControl.x=g[g.length-4];this.lastControl.y=g[g.length-3];this.lastControl.type="C"},_curveToR:function(v,b,g,W){for(b=0;b<g.length;b+=6)v.push("bezierCurveTo",[this.last.x+g[b],this.last.y+g[b+1],this.lastControl.x=this.last.x+g[b+2],this.lastControl.y=this.last.y+g[b+3],this.last.x+g[b+4],this.last.y+g[b+5]]),W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue)),this.last.x+=g[b+4],this.last.y+=g[b+5];this.lastControl.type="C"},
_smoothCurveToA:function(v,b,g,W){for(b=0;b<g.length;b+=4){var N="C"==this.lastControl.type;v.push("bezierCurveTo",[N?2*this.last.x-this.lastControl.x:this.last.x,N?2*this.last.y-this.lastControl.y:this.last.y,g[b],g[b+1],g[b+2],g[b+3]]);W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));this.lastControl.x=g[b];this.lastControl.y=g[b+1];this.lastControl.type="C"}this.last.x=g[g.length-2];this.last.y=g[g.length-1]},_smoothCurveToR:function(v,b,g,W){for(b=0;b<g.length;b+=4){var N="C"==
this.lastControl.type;v.push("bezierCurveTo",[N?2*this.last.x-this.lastControl.x:this.last.x,N?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+g[b],this.last.y+g[b+1],this.last.x+g[b+2],this.last.y+g[b+3]]);W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));this.lastControl.x=this.last.x+g[b];this.lastControl.y=this.last.y+g[b+1];this.lastControl.type="C";this.last.x+=g[b+2];this.last.y+=g[b+3]}},_qCurveToA:function(v,b,g,W){for(b=0;b<g.length;b+=4)v.push("quadraticCurveTo",
g.slice(b,b+4));W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));this.last.x=g[g.length-2];this.last.y=g[g.length-1];this.lastControl.x=g[g.length-4];this.lastControl.y=g[g.length-3];this.lastControl.type="Q"},_qCurveToR:function(v,b,g,W){for(b=0;b<g.length;b+=4)v.push("quadraticCurveTo",[this.lastControl.x=this.last.x+g[b],this.lastControl.y=this.last.y+g[b+1],this.last.x+g[b+2],this.last.y+g[b+3]]),W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue)),this.last.x+=g[b+
2],this.last.y+=g[b+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(v,b,g,W){for(b=0;b<g.length;b+=2){var N="Q"==this.lastControl.type;v.push("quadraticCurveTo",[this.lastControl.x=N?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=N?2*this.last.y-this.lastControl.y:this.last.y,g[b],g[b+1]]);W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=g[g.length-2];this.last.y=g[g.length-1]},_qSmoothCurveToR:function(v,b,g,W){for(b=
0;b<g.length;b+=2){var N="Q"==this.lastControl.type;v.push("quadraticCurveTo",[this.lastControl.x=N?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=N?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+g[b],this.last.y+g[b+1]]);W&&(this._dashResidue=h(W,this,v[v.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=g[b];this.last.y+=g[b+1]}},_arcTo:function(v,b,g,W){b="a"==b;for(var N=0;N<g.length;N+=7){var U=g[N+5],M=g[N+6];b&&(U+=this.last.x,M+=this.last.y);var Z=
u.arcAsBezier(this.last,g[N],g[N+1],g[N+2],g[N+3]?1:0,g[N+4]?1:0,U,M);d.forEach(Z,function(da){v.push("bezierCurveTo",da)});W&&(this._dashResidue=h(W,this,p,this._dashResidue));this.last.x=U;this.last.y=M}this.lastControl={}},_closePath:function(v,b,g,W){v.push("closePath",[]);W&&(this._dashResidue=e(W,this,this.last.x,this.last.y,W[1][0],W[1][1],this._dashResidue));this.lastControl={}}});d.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(v){A(t.Path,v)});t.TextPath=R("dojox.gfx.canvas.TextPath",[t.Shape,G.TextPath],{_renderShape:function(v){},_setText:function(){},_setFont:function(){}});t.Surface=R("dojox.gfx.canvas.Surface",P.Surface,{constructor:function(){P.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){P.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(v,b){this.width=O.normalizedLength(v);this.height=O.normalizedLength(b);if(!this.rawNode)return this;
var g=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,g=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,g=!0);g&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(v){!this.rawNode||!v&&this.pendingImageCount||(v=this.rawNode.getContext("2d"),v.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(v),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(v){v.save();for(var b=0;b<this.children.length;++b)this.children[b]._render(v);v.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(F.hitch(this,this._render),0))},downloadImage:function(v,b){var g=F.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);v.onload=g;v.onerror=g;v.onabort=g;v.src=
b},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});t.createSurface=function(v,b,g){if(!b&&!g){var W=ba.position(v);b=b||W.w;g=g||W.h}"number"==typeof b&&(b+="px");"number"==typeof g&&(g+="px");W=new t.Surface;v=V.byId(v);var N=v.ownerDocument.createElement("canvas");N.width=O.normalizedLength(b);N.height=O.normalizedLength(g);v.appendChild(N);
W.rawNode=N;W._parent=v;return W.surface=W};var L=P.Container;R={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(v){this._makeDirty();return L.add.apply(this,arguments)},remove:function(v,b){this._makeDirty();return L.remove.apply(this,arguments)},clear:function(){this._makeDirty();return L.clear.apply(this,arguments)},getBoundingBox:L.getBoundingBox,
_moveChildToFront:function(v){this._makeDirty();return L._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(v){this._makeDirty();return L._moveChildToBack.apply(this,arguments)}};G={createObject:function(v,b){var g=new v;g.surface=this.surface;g.setShape(b);this.add(g);return g}};z(t.Group,R);z(t.Group,P.Creator);z(t.Group,G);z(t.Surface,R);z(t.Surface,P.Creator);z(t.Surface,G);t.fixTarget=function(v,b){return!0};return t})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang",
"./matrix"],function(O,F,d){function R(u){var C=Math.cos(u);u=Math.sin(u);var z={x:C+4/3*(1-C),y:u-4/3*C*(1-C)/u};return{s:{x:C,y:-u},c1:{x:z.x,y:-z.y},c2:z,e:{x:C,y:u}}}var X=2*Math.PI,ba=Math.PI/4,V=Math.PI/8,P=ba+V,G=R(V);return O.arc={unitArcAsBezier:R,curvePI4:G,arcAsBezier:function(u,C,z,x,f,q,h,e){f=!!f;q=!!q;var t=d._degToRad(x);x=C*C;var k=z*z,m=d.multiplyPoint(d.rotate(-t),{x:(u.x-h)/2,y:(u.y-e)/2}),y=m.x*m.x,K=m.y*m.y;x=Math.sqrt((x*k-x*K-k*y)/(x*K+k*y));isNaN(x)&&(x=0);x={x:x*C*m.y/z,
y:-x*z*m.x/C};f==q&&(x={x:-x.x,y:-x.y});x=d.multiplyPoint([d.translate((u.x+h)/2,(u.y+e)/2),d.rotate(t)],x);C=d.normalize([d.translate(x.x,x.y),d.rotate(t),d.scale(C,z)]);x=d.invert(C);u=d.multiplyPoint(x,u);e=d.multiplyPoint(x,h,e);h=Math.atan2(u.y,u.x);x=h-Math.atan2(e.y,e.x);q&&(x=-x);0>x?x+=X:x>X&&(x-=X);z=V;e=G;z=q?z:-z;u=[];for(f=x;0<f;f-=ba)f<P&&(z=f/2,e=R(z),z=q?z:-z,f=0),m=d.normalize([C,d.rotate(h+z)]),q?(x=d.multiplyPoint(m,e.c1),t=d.multiplyPoint(m,e.c2),m=d.multiplyPoint(m,e.e)):(x=d.multiplyPoint(m,
e.c2),t=d.multiplyPoint(m,e.c1),m=d.multiplyPoint(m,e.s)),u.push([x.x,x.y,t.x,t.y,m.x,m.y]),h+=2*z;return u}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(O,F,d){function R(G,u){return Math.abs(G-u)<=1E-6*(Math.abs(G)+Math.abs(u))}function X(G,u,C,z){if(!isFinite(G))return C;if(!isFinite(C))return G;u=Math.abs(u);z=Math.abs(z);return(u*G+z*C)/(u+z)}function ba(G){G=d.normalize(G);var u=-G.xx-G.yy,C=G.xx*G.yy-G.xy*G.yx,z=Math.sqrt(u*u-4*C);u=-(u+(0>u?
-z:z))/2;C/=u;z=G.xy/(u-G.xx);var x=1,f=G.xy/(C-G.xx),q=1;R(u,C)&&(z=1,f=x=0,q=1);isFinite(z)||(z=1,x=(u-G.xx)/G.xy,isFinite(x)||(z=(u-G.yy)/G.yx,x=1,isFinite(z)||(z=1,x=G.yx/(u-G.yy))));isFinite(f)||(f=1,q=(C-G.xx)/G.xy,isFinite(q)||(f=(C-G.yy)/G.yx,q=1,isFinite(f)||(f=1,q=G.yx/(C-G.yy))));G=Math.sqrt(z*z+x*x);var h=Math.sqrt(f*f+q*q);isFinite(z/=G)||(z=0);isFinite(x/=G)||(x=0);isFinite(f/=h)||(f=0);isFinite(q/=h)||(q=0);return{value1:u,value2:C,vector1:{x:z,y:x},vector2:{x:f,y:q}}}function V(G,
u){var C=0>G.xx*G.yy||0<G.xy*G.yx?-1:1,z=u.angle1=(Math.atan2(G.yx,G.yy)+Math.atan2(-C*G.xy,C*G.xx))/2;C=Math.cos(z);z=Math.sin(z);u.sx=X(G.xx/C,C,-G.xy/z,z);u.sy=X(G.yy/C,C,G.yx/z,z);return u}function P(G,u){var C=0>G.xx*G.yy||0<G.xy*G.yx?-1:1,z=u.angle2=(Math.atan2(C*G.yx,C*G.xx)+Math.atan2(-G.xy,G.yy))/2;C=Math.cos(z);z=Math.sin(z);u.sx=X(G.xx/C,C,G.yx/z,z);u.sy=X(G.yy/C,C,-G.xy/z,z);return u}return O.decompose=function(G){var u=d.normalize(G);G={dx:u.dx,dy:u.dy,sx:1,sy:1,angle1:0,angle2:0};if(R(u.xy,
0)&&R(u.yx,0))return F.mixin(G,{sx:u.xx,sy:u.yy});if(R(u.xx*u.yx,-u.xy*u.yy))return V(u,G);if(R(u.xx*u.xy,-u.yx*u.yy))return P(u,G);var C=new d.Matrix2D(u);var z=F.mixin(C,{dx:0,dy:0,xy:C.yx,yx:C.xy});C=ba([u,z]);z=ba([z,u]);C=new d.Matrix2D({xx:C.vector1.x,xy:C.vector2.x,yx:C.vector1.y,yy:C.vector2.y});z=new d.Matrix2D({xx:z.vector1.x,xy:z.vector1.y,yx:z.vector2.x,yy:z.vector2.y});u=new d.Matrix2D([d.invert(C),u,d.invert(z)]);V(z,G);u.xx*=G.sx;u.yy*=G.sy;P(C,G);u.xx*=G.sx;u.yy*=G.sy;return F.mixin(G,
{sx:u.xx,sy:u.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(O){O=O.bezierutils={};O.tAtLength=function(V,P){var G=0,u=6==V.length,C=0,z=0,x=u?R:ba,f=function(q,h){for(var e=0,t=0;t<q.length-2;t+=2)e+=d(q[t],q[t+1],q[t+2],q[t+3]);t=u?d(V[0],V[1],V[4],V[5]):d(V[0],V[1],V[6],V[7]);e-t>h||C+e>P+h?(++z,e=x(q,.5),f(e[0],h),Math.abs(C-P)<=h||f(e[1],h)):(C+=e,G+=1/(1<<z))};P&&f(V,.5);return G};var F=O.computeLength=function(V){for(var P=6==V.length,G=0,u=0;u<V.length-2;u+=2)G+=d(V[u],
V[u+1],V[u+2],V[u+3]);u=P?d(V[0],V[1],V[4],V[5]):d(V[0],V[1],V[6],V[7]);return.1<G-u?(V=P?R(V,.5):X(V,.5),G=F(V[0],P),G+=F(V[1],P)):G},d=O.distance=function(V,P,G,u){return Math.sqrt((G-V)*(G-V)+(u-P)*(u-P))},R=function(V,P){var G=1-P,u=G*G,C=P*P,z=V[0],x=V[1],f=V[2],q=V[3],h=V[4],e=V[5],t=u*z+2*G*P*f+C*h;u=u*x+2*G*P*q+C*e;return[[z,x,G*z+P*f,G*x+P*q,t,u],[t,u,G*f+P*h,G*q+P*e,h,e]]},X=function(V,P){var G=1-P,u=G*G,C=u*G,z=P*P,x=z*P,f=V[0],q=V[1],h=V[2],e=V[3],t=V[4],k=V[5],m=V[6],y=V[7],K=C*f+3*u*
P*h+3*G*z*t+x*m;C=C*q+3*u*P*e+3*G*z*k+x*y;return[[f,q,G*f+P*h,G*q+P*e,u*f+2*G*P*h+z*t,u*q+2*G*P*e+z*k,K,C],[K,C,u*h+2*G*P*t+z*m,u*e+2*G*P*k+z*y,G*t+P*m,G*k+P*y,m,y]]},ba=O.splitBezierAtT=function(V,P){return 6==V.length?R(V,P):X(V,P)};return O})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(O,F,d){F.getObject("json",!0,d);d.json._slice=function(R,X,ba,V){var P=R.length,G=[];ba=ba||P;X=0>X?Math.max(0,X+P):Math.min(P,X);for(ba=0>ba?
Math.max(0,ba+P):Math.min(P,ba);X<ba;X+=V)G.push(R[X]);return G};d.json._find=function(R,X){function ba(G){X&&(!0!==X||G instanceof Array?G[X]&&V.push(G[X]):V.push(G));for(var u in G){var C=G[u];X?C&&"object"==typeof C&&ba(C):V.push(C)}}var V=[];if(X instanceof Array){if(1==X.length)return R[X[0]];for(var P=0;P<X.length;P++)V.push(R[X[P]])}else ba(R);return V};d.json._distinctFilter=function(R,X){for(var ba=[],V={},P=0,G=R.length;P<G;++P){var u=R[P];X(u,P,R)&&("object"==typeof u&&u?u.__included||
(u.__included=!0,ba.push(u)):V[u+typeof u]||(V[u+typeof u]=!0,ba.push(u)))}P=0;for(G=ba.length;P<G;++P)ba[P]&&delete ba[P].__included;return ba};return d.json.query=function(R,X){function ba(z,x,f,q,h,e,t,k){return P[k].match(/[\*\?]/)||"~"==t?"/^"+P[k].substring(1,P[k].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==t?"$/i":"$/")+".test("+x+")":z}var V=0,P=[];R=R.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(z){V+="["==z?1:"]"==z?-1:
0;return"]"==z&&0<V?"`]":'"'==z.charAt(0)||"'"==z.charAt(0)?"`"+(P.push(z)-1):z});var G="";R.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});R=R.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(z){return"."==z.charAt(0)?z:"@"==z?"$obj":(z.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+z}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(z,x,f){return(x=z.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?
(f="",z.match(/^\./)&&(G="dojox.json._find("+G,f=",true)"),G=(x[1].match(/=/)?"dojo.map":x[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+G,f+",function($obj){return "+x[2]+"})"):(x=z.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+x[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(q,h,e){return"var av\x3d "+e.replace(/\$obj/,"a")+",bv\x3d "+e.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==h?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==
h?-1:1)+";}\n"})+"return 0;})":(x=z.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(G="dojox.json._slice("+G,","+(x[1]||0)+","+(x[2]||0)+","+(x[3]||1)+")"):z.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(G="dojox.json._find("+G,("."==z.charAt(1)?",'"+f+"'":z.match(/,/)?","+z:"")+")"):z}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,ba).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(z,x,f,q,h,e,t,k){return ba(z,q,h,e,t,k,f,
x)});R=G+("$"==R.charAt(0)?"":"$")+R.replace(/`([0-9]+|\])/g,function(z,x){return"]"==x?"]":P[x]});for(var u=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+R+"}"),C=0;C<arguments.length-1;C++)arguments[C]=arguments[C+1];return X?u.apply(this,arguments):u}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,
extraParameters:null});F.setObject("tasks.PrintParameters",O,R);return O})},"esri/tasks/LegendLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null});F.setObject("tasks.LegendLayer",O,R);return O})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea){F=F("esri.dijit.Geocoder",[D,t,m],{templateString:f,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(L,v){h.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new c(O.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};var b=d.mixin({},this.options,L);this.set("autoComplete",b.autoComplete);this.set("arcgisGeocoder",b.arcgisGeocoder);this.set("value",b.value);this.set("theme",
b.theme);this.set("activeGeocoderIndex",b.activeGeocoderIndex);this.set("maxLocations",b.maxLocations);this.set("minCharacters",b.minCharacters);this.set("searchDelay",b.searchDelay);this.set("geocoderMenu",b.geocoderMenu);this.set("autoNavigate",b.autoNavigate);this.set("showResults",b.showResults);this.set("map",b.map);this.set("activeGeocoder",b.activeGeocoder);this.set("geocoders",b.geocoders);this.set("zoomScale",b.zoomScale);this.set("highlightLocation",b.highlightLocation);this.set("symbol",
b.symbol);this.set("graphicsLayer",b.graphicsLayer);this.set("results",[]);this._i18n=x;this._deferreds=[];this._defaultSR=new n(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=v},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else C.once(this.get("map"),"load",d.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(C(this.submitNode,e,d.hitch(this,this._findThenSelect)));this.own(C(this.geocoderMenuArrowNode,e,d.hitch(this,this._toggleGeolocatorMenu)));this.own(C(this.inputNode,
e,d.hitch(this,this._inputClick)));this.own(C(this.clearNode,e,d.hitch(this,this.clear)));this.own(C(this.geocoderMenuCloseNode,e,d.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();G.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var L=this.get("highlightGraphic"),v=this.get("graphicsLayer");L&&(v?v.remove(L):this.get("map").graphics.remove(L),
this.set("highlightGraphic",null));ba.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);V.remove(this.containerNode,this._css.hasValueClass);ba.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){P.set(this.domNode,"display","block")},hide:function(){P.set(this.domNode,"display","none")},find:function(L){var v=new R;if(L)if("string"===typeof L)this._findQuery(L).then(function(g){v.resolve(g)});else if("object"===typeof L&&L.hasOwnProperty("geometry")){switch(L.geometry.type){case "extent":var b=
L.geometry.getCenter();break;case "multipoint":b=L.geometry.getExtent().getCenter();break;case "point":b=L.geometry;break;case "polygon":b=L.geometry.getExtent().getCenter();break;case "polyline":b=L.geometry.getExtent().getCenter()}b&&this._reverseGeocodePoint(b,L.geometry).then(function(g){g.results[0]&&(L.hasOwnProperty("attributes")&&g.results[0].feature.setAttributes(d.mixin(g.results[0].feature.attributes,L.attributes)),L.hasOwnProperty("infoTemplate")&&g.results[0].feature.setInfoTemplate(L.infoTemplate),
L.hasOwnProperty("symbol")&&g.results[0].feature.setSymbol(L.symbol));v.resolve(g)},function(g){v.reject(g)})}else"object"===typeof L&&"point"===L.type?this._reverseGeocodePoint(L).then(function(g){v.resolve(g)},function(g){v.reject(g)}):L instanceof Array&&2===L.length?(b=new E(L,new n({wkid:4326})),this._reverseGeocodePoint(b).then(function(g){v.resolve(g)},function(g){v.reject(g)})):v.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(g){v.resolve(g)});
return v.promise},focus:function(){k.focus(this.inputNode);var L=this.get("map");L&&L.disableKeyboardNavigation()},blur:function(){k.curNode&&k.curNode.blur();this.inputNode.blur();this._hideMenus();var L=this.get("map");L&&L.enableKeyboardNavigation()},select:function(L){this.onSelect(L);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&L&&L.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(L.extent);if(L.feature){var v=this.get("highlightGraphic"),b=this.get("graphicsLayer"),
g=this.get("symbol")||L.feature.symbol;v?(v.setGeometry(L.feature.geometry),v.setAttributes(L.feature.attributes),v.setInfoTemplate(L.feature.infoTemplate),v.setSymbol(g)):(v=L.feature,this.get("highlightLocation")&&(v.setSymbol(g),b?b.add(v):this.get("map").graphics.add(v)));this.set("highlightGraphic",v)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var L=this.get("activeGeocoder"),v=this.reHostedFS.test(L.url);("query"!==L.type||v)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(d.hitch(this,function(b){this.onAutoComplete(b);this.get("showResults")&&this._showResults(b)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(L){for(var v=0;v<L.length;v++)if(255<
L.charCodeAt(v))return!0;return!1},_findQuery:function(L){var v=new R;this._query({delay:0,search:L}).then(d.hitch(this,function(b){this.onFindResults(b);v.resolve(b)}),d.hitch(this,function(b){this.onFindResults(b);v.reject(b)}));return v.promise},_reverseGeocodePoint:function(L,v){var b=new R;if(L&&this.get("activeGeocoder")){var g=v||L,W=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(L,W,d.hitch(this,function(N){N={results:[this._hydrateResult(N)],geometry:g};this.onFindResults(N);b.resolve(N)}),d.hitch(this,function(N){b.reject(N)}))}else b.reject("Geocoder:: no point or active geocoder defined");return b.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=K.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=x.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new H(this.get("activeGeocoder").url):new A(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var L=[];this.get("arcgisGeocoder")&&(L=L.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(L=L.concat(this.get("geocoders")));this._geocoders=
L},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);ba.set(this.inputNode,"placeholder",this._placeholder);ba.set(this.submitNode,"title",this._placeholder)},_updateValue:function(L,v,b){this._ignoreUpdateValue||
(ba.set(this.inputNode,"value",b),this._checkStatus())},_updateTheme:function(L,v,b){V.remove(this.domNode,v);V.add(this.domNode,b)},_setActiveGeocoderIndex:function(L,v,b){this.set("activeGeocoderIndex",b);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();L={attr:this.get("activeGeocoder"),oldVal:v,newVal:b};this.onGeocoderSelect(L)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(L){L||(L={delay:0});L.search||(L.search=this.get("value"));
var v=new R;this._deferreds.push(v);L.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(d.hitch(this,function(){this._performTask(v,L)}),L.delay)):this._performTask(v,L);return v.promise},_performTask:function(L,v){if(v.search){this._hideGeolocatorMenu();this._showLoading();var b="";this.get("activeGeocoder").prefix&&(b+=this.get("activeGeocoder").prefix);b+=v.search;this.get("activeGeocoder").suffix&&(b+=this.get("activeGeocoder").suffix);var g=this.get("activeGeocoder").outFields;g&&
(g instanceof Array||(g=[g]));var W=this.get("maxLocations")||6,N=this.get("activeGeocoder").searchExtent,U=this._defaultSR;this.get("map")&&(U=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var M=new S;M.outSpatialReference=U;M.returnGeometry=!0;M.num=W;N&&(M.geometry=N);W=this.get("activeGeocoder").exactMatch;N=this.get("activeGeocoder").field;U="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(b)&&(U="N");M.where=W?N+" \x3d "+
U+"'"+b+"'":"UPPER("+N+") LIKE "+U+"'%"+b.toUpperCase()+"%'";g&&(M.outFields=g);this._task.execute(M,d.hitch(this,function(Z){this._receivedResults(Z.features,L,v)}),d.hitch(this,function(Z){this._receivedResults([],L,v)}))}else M={},this.get("activeGeocoder").categories&&(M.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=U,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&
(U=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||U&&U<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(M.location=this.get("map").extent.getCenter(),M.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&v.autoComplete?(M.text=b,N&&(M.searchExtent=N),this._task.suggestLocations(M).then(d.hitch(this,function(Z){this._receivedResults(Z,L,v)}),d.hitch(this,function(Z){this._receivedResults(Z,L,
v)}))):(M.address={},M.maxLocations=W,N&&(M.searchExtent=N),this.get("activeGeocoder").sourceCountry&&(M.countryCode=this.get("activeGeocoder").sourceCountry),v.magicKey&&(M.magicKey=v.magicKey),this.get("activeGeocoder").singleLineFieldName?M.address[this.get("activeGeocoder").singleLineFieldName]=b:M.address["Single Line Input"]=b,g&&(M.outFields=g),this._task.addressToLocations(M,d.hitch(this,function(Z){this._receivedResults(Z,L,v)}),d.hitch(this,function(Z){this._receivedResults(Z,L,v)})))}else this._hideLoading(),
L.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var L="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var v=this.get("value"),b=new RegExp("("+v+")","gi");L+='\x3cul role\x3d"presentation"\x3e';for(v=0;v<this.get("results").length&&5>v;++v){var g=this.get("results")[v].text||this.get("results")[v].name,W=this._css.resultsItemClass+" ";W=0===v%2?W+this._css.resultsItemOddClass:W+this._css.resultsItemEvenClass;0===v?W+=" "+this._css.resultsItemFirstClass:
v===this.get("results").length-1&&(W+=" "+this._css.resultsItemLastClass);L+='\x3cli title\x3d"'+g+'" data-text\x3d"'+g+'" data-item\x3d"true" data-index\x3d"'+v+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+W+'"\x3e'+g.replace(b,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}L+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=L);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=L),
this._hideResultsMenu()},_receivedResults:function(L,v){this._hideLoading();var b=this._hydrateResults(L);this.set("results",b);b={results:b,value:this.get("value")};v.resolve(b)},_showLoading:function(){V.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){V.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){V.add(this.containerNode,this._css.activeMenuClass);V.add(this.domNode,this._css.GeocoderMenuOpenClass);P.set(this.geocoderMenuNode,"display",
"block");ba.set(this.geocoderMenuInsertNode,"aria-hidden","false");ba.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){V.remove(this.containerNode,this._css.activeMenuClass);V.remove(this.domNode,this._css.GeocoderMenuOpenClass);P.set(this.geocoderMenuNode,"display","none");ba.set(this.geocoderMenuInsertNode,"aria-hidden","true");ba.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===P.get(this.geocoderMenuNode,
"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){V.add(this.containerNode,this._css.GeocoderActiveClass);V.add(this.domNode,this._css.GeocoderResultsOpenClass);P.set(this.resultsNode,"display","block");ba.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){P.set(this.resultsNode,"display","none");V.remove(this.containerNode,this._css.GeocoderActiveClass);V.remove(this.domNode,this._css.GeocoderResultsOpenClass);ba.set(this.resultsNode,
"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var L="",v;var b='\x3cul role\x3d"presentation"\x3e';for(v=0;v<this._geocoders.length;v++){L=this._css.resultsItemClass+" ";L=0===v%2?L+this._css.resultsItemOddClass:L+this._css.resultsItemEvenClass;v===this.get("activeGeocoderIndex")&&(L+=" "+this._css.geocoderSelectedClass);0===v?L+=" "+this._css.resultsItemFirstClass:
v===this._geocoders.length-1&&(L+=" "+this._css.resultsItemLastClass);var g=this._geocoders[v].name||x.widgets.Geocoder.main.untitledGeocoder;b+='\x3cli data-index\x3d"'+v+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+L+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';b+=g;b+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';b+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=b+"\x3c/ul\x3e";this._geocoderMenuEvent();
P.set(this.geocoderMenuNode,"display","none");P.set(this.geocoderMenuArrowNode,"display","block");V.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",P.set(this.geocoderMenuNode,"display","none"),P.set(this.geocoderMenuArrowNode,"display","none"),V.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(V.add(this.containerNode,this._css.hasValueClass),ba.set(this.clearNode,"title",x.widgets.Geocoder.main.clearButtonTitle)):
this.clear()},_autoCompleteEvent:function(){var L=z('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=C(L,"click, keydown",d.hitch(this,function(v){this._clearQueryTimeout();var b=parseInt(ba.get(v.currentTarget,"data-index"),10),g=ba.get(v.currentTarget,"data-text");"click"===v.type||"keydown"===v.type&&v.keyCode===u.ENTER?(ba.set(this.inputNode,"value",g),this.set("value",g),this.get("results")&&this.get("results")[b]&&(v=this.get("results")[b],v.name?
this.select(v):this._query({delay:0,search:v.text,magicKey:v.magicKey||null}).then(d.hitch(this,function(W){this.select(W.results[0])})))):"keydown"!==v.type||v.keyCode!==u.BACKSPACE&&v.keyCode!==u.DELETE?"keydown"===v.type&&v.keyCode===u.UP_ARROW?(X.stop(v),v=b-1,0>v?this.inputNode.focus():L[v].focus()):"keydown"===v.type&&v.keyCode===u.DOWN_ARROW?(X.stop(v),v=b+1,v>=L.length?this.inputNode.focus():L[v].focus()):v.keyCode===u.ESCAPE&&this._hideMenus():(X.stop(v),this.inputNode.focus(),v=this.inputNode.value.slice(0,
-1),ba.set(this.inputNode,"value",v),this.set("value",v))}))},_geocoderMenuEvent:function(){var L=z('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=C(L,"click, keydown",d.hitch(this,function(v){var b=parseInt(ba.get(v.currentTarget,"data-index"),10);"click"===v.type||"keydown"===v.type&&v.keyCode===u.ENTER?(this._setActiveGeocoderIndex(null,null,b),this._hideGeolocatorMenu()):"keydown"===v.type&&v.keyCode===u.UP_ARROW?(X.stop(v),v=b-1,0>v?this.geocoderMenuArrowNode.focus():
L[v].focus()):"keydown"===v.type&&v.keyCode===u.DOWN_ARROW?(X.stop(v),v=b+1,v>=L.length?this.geocoderMenuArrowNode.focus():L[v].focus()):v.keyCode===u.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var L;if(this._events&&this._events.length)for(L=0;L<this._events.length;L++)this._events[L].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var L=C(document,"click",d.hitch(this,function(v){this._hideResultsMenu(v)}));
this._events.push(L);L=C(this.inputNode,"keyup",d.hitch(this,function(v){this._inputKeyUp(v)}));this._events.push(L);L=C(this.inputNode,"keydown",d.hitch(this,function(v){this._inputKeyDown(v)}));this._events.push(L);L=C(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(L);this.get("map")&&(L=C(this.get("map"),"mouse-down",d.hitch(this,function(){this.blur()})),this._events.push(L));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(d.hitch(this,
function(L){L.results&&L.results.length&&(this.select(L.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(L){if(L){this._clearQueryTimeout();var v=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",v);this._ignoreUpdateValue=!1;var b=0;v&&(b=v.length);if(L.ctrlKey||L.metaKey||L.altKey||L.keyCode===u.copyKey||L.keyCode===u.ALT||L.keyCode===u.CTRL||L.keyCode===u.META||L.keyCode===u.SHIFT||L.keyCode===u.UP_ARROW||L.keyCode===u.DOWN_ARROW||L.keyCode===u.LEFT_ARROW||L.keyCode===
u.RIGHT_ARROW)return L;L&&L.keyCode===u.ENTER?(this._cancelDeferreds(),this._findThenSelect()):L&&L.keyCode===u.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):L&&L.keyCode===u.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&b>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var L=0;L<this._deferreds.length;L++)this._deferreds[L].cancel("Geocoder:: stop query");this._deferreds=
[]}},_inputKeyDown:function(L){var v=z('[data-item\x3d"true"]',this.resultsNode);L&&L.keyCode===u.TAB?(this._cancelDeferreds(),this._hideMenus()):L&&L.keyCode===u.UP_ARROW?(X.stop(L),(L=v.length)&&v[L-1].focus()):L&&L.keyCode===u.DOWN_ARROW&&(X.stop(L),v[0]&&v[0].focus())},_geocoderMenuButtonKeyDown:function(L){var v=z('[data-item\x3d"true"]',this.geocoderMenuInsertNode);L&&L.keyCode===u.UP_ARROW?(X.stop(L),this._showGeolocatorMenu(),(L=v.length)&&v[L-1].focus()):L&&L.keyCode===u.DOWN_ARROW&&(X.stop(L),
this._showGeolocatorMenu(),v[0]&&v[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(L){var v={},b=this._defaultSR,g;this.get("map")&&(b=this.get("map").spatialReference);if(L.hasOwnProperty("text")&&L.hasOwnProperty("magicKey"))return L;if(L.hasOwnProperty("feature"))v.feature=new w(L.feature),(g=v.feature.geometry)&&g.setSpatialReference(b);else if(L.hasOwnProperty("geometry")){var W=L.symbol||null;g=L.attributes||{};v.feature=new w(L.geometry,W,g,L.infoTemplate||
null);(g=v.feature.geometry)&&g.setSpatialReference(b)}else L.hasOwnProperty("location")?(W=new E(L.location.x,L.location.y,b),g={},L.hasOwnProperty("attributes")&&(g=L.attributes),L.hasOwnProperty("score")&&(g.score=L.score),v.feature=new w(W,null,g,null)):v.feature=null;if(L.hasOwnProperty("extent"))v.extent=new J(L.extent),v.extent.setSpatialReference(new n(b));else if(v.feature&&v.feature.geometry)switch(v.feature.geometry.type){case "extent":v.extent=v.feature.geometry;break;case "multipoint":v.extent=
v.feature.geometry.getExtent();break;case "polygon":v.extent=v.feature.geometry.getExtent();break;case "polyline":v.extent=v.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?v.extent=ea.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(v.feature.geometry):v.extent=this.get("map").extent.centerAt(v.feature.geometry):v.extent=new J({xmin:v.feature.geometry.x-.25,ymin:v.feature.geometry.y-.25,xmax:v.feature.geometry.x+.25,
ymax:v.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else v.extent=null;L.hasOwnProperty("name")?v.name=L.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&L.hasOwnProperty("attributes")&&L.attributes.hasOwnProperty(this.activeGeocoder.field)?v.name=L.attributes[this.activeGeocoder.field]:L.hasOwnProperty("Match_addr")&&"string"===typeof L.Match_addr?v.name=L.Match_addr:L.hasOwnProperty("address")&&"object"===typeof L.address&&L.address.hasOwnProperty("Match_addr")?v.name=
L.address.Match_addr:L.hasOwnProperty("address")&&"string"===typeof L.address?v.name=L.address:L.hasOwnProperty("address")&&"object"===typeof L.address&&L.address.hasOwnProperty("Address")?v.name=L.address.Address:v.name=v.feature&&v.feature.geometry?v.feature.geometry.x+","+v.feature.geometry.y:"";return v},_hydrateResults:function(L){var v=[],b=0;if(L&&L.length)for(b;b<L.length;b++){var g=this._hydrateResult(L[b]);v.push(g)}return v}});d.setObject("dijit.Geocoder",F,y);return F})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E){O=O([G,u],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:D,constructor:function(J,A){F.mixin(this,E.widgets.overviewMap);J=J||{};if(J.map){var S={};A&&(this._detached=!0,S=R.coords(A,!0));this.map=J.map;this.baseLayer=J.baseLayer;this.width=J.width||S.w||this.map.width/4;this.height=J.height||S.h||this.map.height/4;this.attachTo=J.attachTo||"top-right";this.expandFactor=J.expandFactor||2;this.color=J.color||
"#000000";this.opacity=J.opacity||.5;this.maximizeButton=!!J.maximizeButton;this.visible=!!J.visible;if(this.map.loaded)this._initialSetup();else var H=d.connect(this.map,"onLoad",this,function(){d.disconnect(H);H=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>X("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(V.set(this._body,
"display","block"),V.set(this._controllerDiv,"display","none"),V.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():d.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||ba.add(this._maximizerDiv,"ovwDisabledButton"),ba.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),ba.add(this._controllerDiv,
"ovwShow"),ba.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));V.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(J){!J||0>=J.w||0>=J.h||this._resize(J.w,J.h)},show:function(){if(!this.visible){var J=this._controllerDiv;J.title=this.NLS_hide;ba.remove(J,"ovwShow");ba.add(J,"ovwHide");c.show(this._body);
c.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var J=this._controllerDiv;J.title=this.NLS_show;ba.remove(J,"ovwHide");ba.add(J,"ovwShow");this._maximized&&this._maximizeHandler();c.hide(this._body);c.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var J=this.baseLayer||this._mainMapLayer,A=this.map.spatialReference,S=J.spatialReference;if(S.wkid===
A.wkid||S.wkt===A.wkt){A=J.declaredClass;if(J instanceof f)if(-1!==A.indexOf("VETiledLayer"))this.baseLayer=new K({resourceInfo:J.getResourceInfo(),culture:J.culture,mapStyle:J.mapStyle,bingMapsKey:J.bingMapsKey});else if(-1!==A.indexOf("OpenStreetMapLayer"))this.baseLayer=new y({tileServers:J.tileServers});else if(-1!==A.indexOf("WebTiledLayer")){A=J.initialExtent;S=J.fullExtent;var H=J.tileInfo;this.baseLayer=new J.constructor(J.urlTemplate,{initialExtent:A&&new A.constructor(A.toJson()),fullExtent:S&&
new S.constructor(S.toJson()),tileInfo:H&&new H.constructor(H.toJson()),tileServers:J.tileServers&&J.tileServers.slice(0)})}else this.baseLayer=new e(J.url,{resourceInfo:J.getResourceInfo()});else if(J instanceof q)-1!==A.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new k(J.url):(this.baseLayer=new t(J.url),this.baseLayer.setImageFormat("png24"));else if(J instanceof m)this.baseLayer=new m(J.url);else if(J instanceof h)this.baseLayer=new e("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",
{});else return;!this._detached&&this.visible&&this._controllerDiv&&(J=function(){this.visible=!1;this.show()},this.baseLayer.loaded?J.call(this):d.connect(this.baseLayer,"onLoad",this,J))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var J=this._maximizerDiv;this._maximized?(J.title=this.NLS_maximize,ba.remove(J,"ovwRestore"),ba.add(J,"ovwMaximize"),this._resize(this.width,this.height)):(J.title=this.NLS_restore,ba.remove(J,"ovwMaximize"),ba.add(J,
"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(J,A){V.set(this._body,{width:J+"px",height:A+"px"});var S=w.defaults.map.panDuration,H=this.overviewMap;w.defaults.map.panDuration=0;H&&(H.resize(!0),H.centerAt(this._focusExtent.getCenter()));w.defaults.map.panDuration=S},_initialize:function(){if(this.overviewMap)this._activate();else{var J;var A=9>X("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=J=new C(A,{slider:!1,
showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});d.connect(J,"onLoad",this,function(){this._map_resize_override=F.hitch(J,this._map_resize_override);J.disableMapNavigation();this._activate()});J.addLayer(this.baseLayer)}},_activate:function(){var J=this.map,A=this.overviewMap;this._moveableHandle=new P(this._focusDiv);this._soeConnect=d.connect(J,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=d.connect(J,"onPan",this,this._updateFocus);this._oecConnect=
d.connect(A,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=d.connect(A,"onPan",this,this._ovwPanHandler);this._ozsConnect=d.connect(A,"onZoomStart",this,function(){c.hide(this._focusDiv)});this._ozeConnect=d.connect(A,"onZoomEnd",this,function(){c.show(this._focusDiv)});this._omsConnect=d.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(J.extent,null,null,null)},_deactivate:function(){d.disconnect(this._soeConnect);d.disconnect(this._ufoConnect);
d.disconnect(this._oecConnect);d.disconnect(this._opaConnect);d.disconnect(this._ozsConnect);d.disconnect(this._ozeConnect);d.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(J,A,S,H){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=J,this.overviewMap.setExtent(J.expand(this.expandFactor),!0))},_updateFocus:function(J){this._suspendPanHandling||(this._focusExtent=J,this._drawFocusDiv(J))},
_drawFocusDiv:function(J,A){var S=this.overviewMap,H=S.toScreen(new z(J.xmin,J.ymax,S.spatialReference)),ea=S.toScreen(new z(J.xmax,J.ymin,S.spatialReference));S=ea.x-H.x;ea=ea.y-H.y;var L=!0;S>this.overviewMap.width&&ea>this.overviewMap.height&&(L=!1);V.set(this._focusDiv,{left:H.x+(A?A.x:0)+"px",top:H.y+(A?A.y:0)+"px",width:S+"px",height:ea+"px",display:L?"block":"none"})},_moveStopHandler:function(J){var A=this._moveableHandle.node.style;J=this._focusExtent;var S=this.overviewMap;A=S.toMap(new x(parseInt(A.left,
10),parseInt(A.top,10)));var H=new z(J.xmin,J.ymax,S.spatialReference);this._focusExtent=J.offset(A.x-H.x,A.y-H.y);this._maximized?this._maximizeHandler():S.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(J,A){this._drawFocusDiv(this._focusExtent,A)}});F.setObject("dijit.OverviewMap",O,n);return O})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n){X=O([y,u,C],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:K,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(w,c){F.mixin(this,n.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=F.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},w.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new q.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=F.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var w=this._sliderToTimeExtent();this.onTimeExtentChange(w)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var w=this._getSliderValue();this._offset=F.isArray(w)?
w[1]-w[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(w,c){w&&w.startTime&&w.endTime&&(c=c||this._defaultCount,this.createTimeStopsByTimeInterval(w,Math.ceil((w.endTime-w.startTime)/(c-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(w,c,D,E){if(w&&w.startTime&&w.endTime){this.fullTimeExtent=
new m(w.startTime,w.endTime);E&&!0===E.resetStartTime&&this._resetStartTime(this.fullTimeExtent,D);this._timeIntervalUnits=D;E=this.fullTimeExtent.startTime;for(var J=[];E<=w.endTime;)J.push(E),E=w._getOffsettedDate(E,c,D);0<J.length&&J[J.length-1]<w.endTime&&J.push(E);this.setTimeStops(J)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(w){this.timeStops=w||[];this._numTicks=this._numStops=this.timeStops.length;!1===k.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new m(w[0],w[w.length-1]))},setLoop:function(w){this.loop=w},setThumbCount:function(w){this.thumbCount=w;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(w){this.thumbIndexes=F.clone(w)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(w){this.thumbMovingRate=w;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(w){this.labels=w;this._slider&&this._createSlider()},setTickCount:function(w){this._numTicks=
w;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(w){this._createTimeInstants=w&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(w){this.intermediateChanges=!!w;this._slider&&this._slider.set("intermediateChanges",!!w)},_updateUI:function(){ba.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";ba.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var w=this.domNode;w.parentNode&&!w.dir;)w=w.parentNode;w={onChange:F.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=V.create("div",{},R.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=V.create("div",{},this._ts,"first");this._timeSliderLabels=V.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(w):this._createSingleSlider(w);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&R.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(c){P.set(c,{background:"none"})});this._initializeThumbs();d.disconnect(this._onChangeConnect);this._onChangeConnect=d.connect(this._slider,"onChange",F.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(w){this._isRangeSlider=!0;this._slider=new (O([z,h],{templateString:e}))(w,this._ts)},_createSingleSlider:function(w){this._isRangeSlider=!1;this._slider=new z(w,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new x({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new f({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var w=this._toSliderValue(this.thumbIndexes[0]);
w=w>this._slider.maximum||w<this._slider.minimum?this._slider.minimum:w;if(!0===this._isRangeSlider){var c=this._toSliderValue(this.thumbIndexes[1]);c=c>this._slider.maximum||c<this._slider.minimum?this._slider.maximum:c;this._setSliderValue([w,c<w?w:c])}else this._setSliderValue(w);this._onHorizontalChange()}},_bumpSlider:function(w){var c=this._getSliderValue(),D=c,E=D,J=w;F.isArray(c)&&(E=c[0],D=c[1],J=[{change:w,useMaxValue:!0},{change:w,useMaxValue:!1}]);1E-10>Math.abs(E-this._slider.minimum)&&
0>w||1E-10>Math.abs(D-this._slider.maximum)&&0<w?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),w=this._sliderToTimeExtent(),this.onTimeExtentChange(w),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(J)},_updateThumbIndexes:function(){var w=this._getSliderValue();F.isArray(w)?(this.thumbIndexes[0]=this._toSliderIndex(w[0]),this.thumbIndexes[1]=this._toSliderIndex(w[1])):this.thumbIndexes[0]=this._toSliderIndex(w)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var w=new m,c=this._getSliderValue();if(F.isArray(c)){if(c[0]>c[1]){var D=c[0];var E=c[1]}else E=c[0],D=c[1];w.startTime=new Date(this.timeStops[this._toSliderIndex(E)]);w.endTime=new Date(this.timeStops[this._toSliderIndex(D)]);this._adjustTimeExtent(w)}else w.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(c)]):new Date(this.fullTimeExtent.startTime),w.endTime=!0===this._createTimeInstants?w.startTime:new Date(this.timeStops[this._toSliderIndex(c)]);
return w}},_adjustTimeExtent:function(w){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&w.startTime.getTime()!==w.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var c=w.startTime;c.setUTCSeconds(c.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(w=w.endTime,w.setUTCSeconds(w.getUTCSeconds()-1))}},_resetStartTime:function(w,c){switch(c){case "esriTimeUnitsSeconds":w.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":w.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":w.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":w.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":w.startTime.setUTCDate(w.startTime.getUTCDate()-w.startTime.getUTCDay());break;case "esriTimeUnitsMonths":w.startTime.setUTCDate(1);w.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":w.startTime.setUTCFullYear(w.startTime.getUTCFullYear()-w.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":w.startTime.setUTCFullYear(w.startTime.getUTCFullYear()-
w.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(w){w=Math.floor((w-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>w&&(w=0);w>=this._numStops&&(w=this._numStops-1);return w},_toSliderValue:function(w){return w*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(w){this._slider._setValueAttr(w,!1,!1)}});F.setObject("dijit.TimeSlider",X,t);return X})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L){var v={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};f=O([w,f,q],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:c,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(b,g){O.safeMixin(this,b);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===v.LAYOUT_HORIZONTAL&&(this.templateString=
D);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=E;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var b=this;this._getAllLayersMDInfo().then(function(){b._sortDimensionValues();b.dimensionValues=b.dimensionValues&&b.dimensionValues.length&&!b.useLayersDimSlices?b.dimensionValues:b._mapSortedDimensionValues;b.getUnit();b._setupSlider()});this._timer=new h.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
F.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===v.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",F.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var b=ea(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=L.create("div");J.add(this._passiveLbl1,"esriMdSliderPassiveLbl");L.place(this._passiveLbl1,b[0]);2===this._thumbCount&&(this._passiveLbl2=L.create("div"),
J.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),L.place(this._passiveLbl2,b[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(R(this.domNode,"mouseover",F.hitch(this,"activateSlider")));this._eventHandles.push(R(this.domNode,"mouseleave",F.hitch(this,"deactivateSlider")));this._eventHandles.push(R(this.domNode,H.press,F.hitch(this,"activateSlider")));this._eventHandles.push(R(this.domNode,H.release,F.hitch(this,"deactivateSlider")));this._eventHandles.push(R(this.prevBtn.domNode,
H.press,F.hitch(this,"activateSlider")));this._eventHandles.push(R(this.playPauseBtn.domNode,H.press,F.hitch(this,"activateSlider")));this._eventHandles.push(R(this.nextBtn.domNode,H.press,F.hitch(this,"activateSlider")));var b=ea(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);e.forEach(b,function(g){this._eventHandles.push(R(g,H.press,F.hitch(this,"activateSlider")));this._eventHandles.push(R(g,H.release,F.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){e.forEach(this._eventHandles,
function(b){b&&b.remove()})},activateSlider:function(){9>d("ie")&&A.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);J.remove(this.domNode,"esriMdSliderPassive");J.add(this.domNode,"esriMdSliderActive");A.set(this._passiveLbl1,"display","none");this._passiveLbl2&&A.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>d("ie"))){var b=this;this.deactivateTimer=setTimeout(function(){b.sliderActive=!1;b.updatePassiveLabels();
J.remove(b.domNode,"esriMdSliderActive");J.add(b.domNode,"esriMdSliderPassive");b._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&n.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){n.isDefined(this.value)&&(A.set(this._passiveLbl1,"display","inline-block"),this.value.length?
A.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&A.set(this._passiveLbl2,"display","none"))},increment:function(){var b=1;!this.playDirectionAscending&&this.playing&&(b=-1);this._bumpSlider(b)},decrement:function(){var b=-1;!this.playDirectionAscending&&this.playing&&(b=1);this._bumpSlider(b)},_setDimensionAttr:function(b){this._slider&&(b.dimension&&(this.dimension=b.dimension),this.dimensionValues=b.dimensionValues&&b.dimensionValues.length?b.dimensionValues:[],this.update())},
update:function(){var b=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){b._sortDimensionValues();b.getUnit();b.dimensionValues&&b.dimensionValues.length&&!b.useLayersDimSlices||(b.dimensionValues=b._mapSortedDimensionValues);b._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(b){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===v.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===v.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new G({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new P({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new x({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new z({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(b){b=b?b:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new u({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:F.hitch(this,"increment"),decrement:F.hitch(this,"decrement"),value:b||0,onChange:F.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(b){b=b?b:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new C({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:F.hitch(this,"increment"),decrement:F.hitch(this,"decrement"),value:b||[0,1],onChange:F.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();R(this._slider.incrementButton,"click",this._slider.increment);R(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(b){b=n.isDefined(b)?b:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new ba({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:F.hitch(this,
"increment"),decrement:F.hitch(this,"decrement"),value:b||0,onChange:F.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(b){b=b?b:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new V({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:F.hitch(this,
"increment"),decrement:F.hitch(this,"decrement"),value:b||[0,1],onChange:F.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(b){var g=this.dimensionValues[b];this.setDimensionInfoText(g);e.forEach(this._layers,function(W){this._updateMosaicRule(W,g);this.prefetch&&this.playing&&"esri.layers.RasterXLayer"!==W.declaredClass&&this._prefetchData(b,W)},this);this._oldValue=b;this.value=
g;this.updatePassiveLabels();this.onChange(g)},_onRangeSliderChange:function(b){if(this._update){this._snap&&(b=this._snapToNearestRange(b));var g=[this.dimensionValues[b[1]],this.dimensionValues[b[0]]];g.sort(this._sortCompareFunction);this.value=g;this.setDimensionInfoText(g);this.updatePassiveLabels();e.forEach(this._layers,function(W){this._updateMosaicRule(W,g);this.prefetch&&this.playing&&this._prefetchData(b,W)},this);this._update=!0;this._oldValue=F.clone(b);this.onChange(g)}},destroy:function(){this.inherited(arguments);
this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(b){this._slider.domNode&&L.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=e.indexOf(this.dimensionValues,this.value[0])&&0<=e.indexOf(this.dimensionValues,this.value[1]))var b=[e.indexOf(this.dimensionValues,this.value[0]),e.indexOf(this.dimensionValues,
this.value[1])];else if(n.isDefined(this.value)){var g=e.indexOf(this.dimensionValues,this.value);0<=g&&(b=g)}n.isDefined(b)||(b=this._getDefaultSliderValue());this.useDefaults&&n.isDefined(b)&&(b===this.dimensionValues.length-1||b.length&&0<=e.indexOf(b,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===v.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(b):this._createVerticalRangeSlider(b):this.layout===v.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(b):
this._createVerticalSingleSlider(b)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var b=Infinity,g=1,W;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(W=0;W<this.dimensionValues.length;W++){var N=this.dimensionValues[W];var U=Math.abs(N-0);if(U<b){b=U;var M=N}if(0===U)break}else M=this.dimensionValues[0];M=e.indexOf(this.dimensionValues,M);M=0>M?0:M;2===this._thumbCount&&(M===this.dimensionValues.length-1&&(g=-1),M=[M,M+g]);return M}},_getMultidimensionalInfo:function(b){function g(){b.getMultidimensionalInfo().then(function(N){b.multidimensionalInfo=
N;W.resolve(b)},function(N){W.reject(N)})}var W=new t;if(b.multidimensionalInfo)W.resolve(b);else if(b.loaded)g();else b.on("load",function(){g()});return W},_getAllLayersMDInfo:function(){var b=[];e.forEach(this._layers,function(g){b.push(this._getMultidimensionalInfo(g))},this);return new k(b)},_getImageLayers:function(){var b=this.map.layerIds.concat(this.map.graphicsLayerIds),g;this._layers=[];e.forEach(b,function(W){g=this.map.getLayer(W);"esri.layers.ArcGISImageServiceLayer"!==g.declaredClass&&
"esri.layers.ArcGISImageServiceVectorLayer"!==g.declaredClass&&"esri.layers.RasterLayer"!==g.declaredClass&&"esri.layers.WCSLayer"!==g.declaredClass&&"esri.layers.RasterXLayer"!==g.declaredClass||this._layers.push(g)},this);return this._layers},_sortCompareFunction:function(b,g){return n.isDefined(b)&&n.isDefined(g)?b-g:!1},_getDimensionObjects:function(){function b(N){if(N&&N.values&&N.hasRanges){var U=[];e.forEach(N.values,function(M){M.length?U=g(U,M):U.push.apply(g(U.sort(this._sortCompareFunction),
[M]))},this);U=U.sort(W._sortCompareFunction);N.decodedValues=U}return N}var g=this._merge,W=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();e.forEach(this._layers,function(N){N.multidimensionalInfo&&e.some(N.multidimensionalInfo.variables,function(U){e.some(U.dimensions,function(M){M.name!==this.dimension||M.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&
this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;e.forEach(this._layers,function(N){N.multidimensionalInfo&&e.some(N.multidimensionalInfo.variables,function(U){e.some(U.dimensions,function(M){M.name===this.dimension&&(this._allRangeValues&&M.hasRanges||this.useRanges?this._dimensionObjects.push(b(F.clone(M))):this._dimensionObjects.push(F.clone(M)))},this)},this)},this)},_merge:function(b,g){for(var W=[],N=0,U=0;N<b.length&&U<g.length;)b[N]<g[U]?W.push(b[N++]):b[N]>g[U]?W.push(g[U++]):
(W.push(g[U++]),N++);W=W.concat(b.slice(N)).concat(g.slice(U));return W=e.filter(W,function(M,Z,da){return da.indexOf(M)===Z})},_mergeRangeArrays:function(b,g){for(var W=[],N=0,U=0;N<b.length&&U<g.length;)b[N][0]<g[U][0]||b[N][0]===g[U][0]&&b[N][1]<g[U][1]?W.push(b[N++]):b[N][0]>g[U][0]||b[N][0]===g[U][0]&&b[N][1]>g[U][1]?W.push(g[U++]):(W.push(g[U++]),N++);W=W.concat(b.slice(N)).concat(g.slice(U));return W=e.filter(W,function(M,Z,da){return da.indexOf(M)===Z},this)},_sortDimensionValues:function(){var b=
0,g=this._merge,W=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(b=1;b<this._dimensionObjects.length;b++)this._mapSortedDimensionValues=g(this._mapSortedDimensionValues,this._dimensionObjects[b].decodedValues||this._dimensionObjects[b].values),
this._allRangeValues&&(this._dimensionRangeValues=W(this._dimensionRangeValues,this._dimensionObjects[b].values))},_createDimensionalDefinition:function(b,g){var W=[b];return new y({variableName:g,dimensionName:this.dimension,values:W,isSlice:1===W.length})},_updateMosaicRule:function(b,g){var W=!1,N=b.mosaicRule||b.defaultMosaicRule||new m({multidimensionalDefinition:[]}),U="esri.layers.WCSLayer"===b.declaredClass,M="esri.layers.RasterXLayer"===b.declaredClass,Z=(U?b.multidimensionalDefinition:N.multidimensionalDefinition)||
[];g.length&&g.sort(this._sortCompareFunction);e.forEach(Z,function(wa){wa.dimensionName===this.dimension&&(wa.values=[g],wa.isSlice=!this.useRanges,W=!0)},this);if(!W){var da="",oa=e.filter(b.multidimensionalInfo.variables,function(wa){return e.some(Z,function(ra){return ra.variableName&&ra.variableName.toLowerCase()===wa.name.toLowerCase()},this)},this);0===oa.length&&(oa=b.multidimensionalInfo.variables);M&&b.raster&&b.raster.defaultMultidimensionalDefinition&&b.raster.defaultMultidimensionalDefinition[0]&&
b.raster.defaultMultidimensionalDefinition[0].variableName&&e.forEach(b.raster.defaultMultidimensionalDefinition,function(wa){wa.dimensionName===this.dimension&&(da=wa.variableName)},this);da.length?(Z.push(this._createDimensionalDefinition(g,da)),W=!0):e.some(oa,function(wa){if(e.some(wa.dimensions,function(ra){if(ra.name===this.dimension){if(U||M)da=wa.name;return!0}},this))return!0},this)&&(Z.push(this._createDimensionalDefinition(g,da)),W=!0)}W&&(U&&b.setMultidimensionalDefinition(Z),M?b.setMultiDimensionalDefinition(N):
(N.multidimensionalDefinition=Z,b.setMosaicRule(N)))},_prefetchData:function(b,g){if(g&&(g.mosaicRule||g.multidimensionalDefinition)){var W,N,U=!1,M,Z=this,da;this.prefetchedValues[g.id]||(this.prefetchedValues[g.id]=[]);this.prefetchImgNodes[g.id]=[];var oa=F.clone(g._params);var wa=(N=F.clone(g.mosaicRule))&&N.multidimensionalDefinition||F.clone(g.multidimensionalDefinition);for(W=1;W<=this.prefetchFactor;W++)U=!1,e.forEach(wa,function(ra){ra.dimensionName===this.dimension&&(this.playDirectionAscending?
b.length?(this.snap?(M=this._getNextRangeIndex(b)||b,ra.values=[this.dimensionValues[M[0]],this.dimensionValues[M[1]]]):ra.values=[this.dimensionValues[(b[0]+W)%this.dimensionValues.length],this.dimensionValues[(b[1]+W)%this.dimensionValues.length]],ra.values.sort(this._sortCompareFunction)):ra.values=[this.dimensionValues[(b+W)%this.dimensionValues.length]]:b.length?(this.snap?(M=this._getNextRangeIndex(b,-1)||b,ra.values=[this.dimensionValues[M[0]],this.dimensionValues[M[1]]]):ra.values=[this.dimensionValues[(this.dimensionValues.length+
b[0]-W)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+b[1]-W)%this.dimensionValues.length]],ra.values.sort(this._sortCompareFunction)):ra.values=[this.dimensionValues[(this.dimensionValues.length+b-W)%this.dimensionValues.length]],e.some(this.prefetchedValues[g.id],function(Ba){if(X.stringify(Ba)===X.stringify(ra.values))return!0})||(U=!0,this.prefetchedValues[g.id].push(ra.values)))},this),U&&"esri.layers.WCSLayer"!==g.declaredClass&&(oa.mosaicRule=X.stringify(N.toJson()),
g.getImageUrl(this.map.extent,this.map.width,this.map.height,function(ra){da=new Image;Z.prefetchImgNodes[g.id].push(da);da.src=ra},oa))}},setDimensionInfoText:function(b){if(n.isDefined(b)){var g=this.unitSymbol||this.unit;if("number"!==typeof b){b=F.clone(b.sort(this._sortCompareFunction));if(0!==b[0]%1||0!==b[1]%1)b[0]=parseFloat(b[0].toFixed(2)),b[1]=parseFloat(b[1].toFixed(2));b="["+b[0]+", "+b[1]+"]"}else 0!==b%1&&(b=b.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+
this.dimensionAlias+" ("+g+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===v.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+b):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+b)}},setLabels:function(b){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&this.dimensionValues.length){var b=Math.ceil(this.dimensionValues.length/this.nLabels);return e.map(this.dimensionValues,function(g,W){return 0===
W%b||W===this.dimensionValues.length-1?(0!==g%1&&(g=parseFloat(g.toFixed(2))),g):""},this)}},_filterLayers:function(){return e.filter(this._layers,function(b){if(b.multidimensionalInfo&&b.visible&&b.useMapDimensionValue&&e.some(b.multidimensionalInfo.variables,function(g){if(e.some(g.dimensions,function(W){if(W.name===this.dimension)return!0},this))return!0},this))return!0},this)},_updateUI:function(){J.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":
"mdsButton mdsPlayButton";J.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(b){var g=this._slider.value;if(0<=b)!this._snap&&(0>g||g>=this.dimensionValues.length-1||g[0]>=this.dimensionValues.length-1||g[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(g)):this._slider.set("value",[0,Math.abs(g[0]-g[1])]):this._slider.set("value",
0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&g[0]<this.dimensionValues.length-1&&g[1]<this.dimensionValues.length-1?this._slider.set("value",[g[0]+1,g[1]+1]):1===this._thumbCount&&g<this.dimensionValues.length-1?this._slider.set("value",g+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(g));else if(0>=g||0>=g[0]||0>=g[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",
this._getNextRangeIndex(g,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(g[0]-g[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=g||0<=g[1])2===this._thumbCount&&0<g[1]&&0<g[0]?this._snap?this._slider.set("value",this._getNextRangeIndex(g,-1)):this._slider.set("value",[g[0]-1,g[1]-1]):1===this._thumbCount&&0<g&&this._slider.set("value",g-1)},setThumbMovingRate:function(b){this.thumbMovingRate=
b;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(b){b=b||this.dimension;var g,W;e.forEach(this._layers,function(N){N.multidimensionalInfo&&N.multidimensionalInfo.variables&&e.forEach(N.multidimensionalInfo.variables,function(U){e.forEach(U.dimensions,function(M){if(M.name===b&&M.extent&&M.extent.length&&1<M.extent.length){if(!n.isDefined(g)||M.extent[0]<g)g=M.extent[0];if(!n.isDefined(W)||M.extent[1]>W)W=M.extent[1]}},this)},this)},this);return[g,W]},setThumbCount:function(b){this._thumbCount=
2==b?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(b){var g=[];if(b&&b.mosaicRule&&b.mosaicRule.multidimensionalDefinition){var W=b.mosaicRule;var N=W.multidimensionalDefinition;e.forEach(N,function(U){U.dimensionName!==this.dimension&&g.push(U)},this);W.multidimensionalDefinition=g;b.setMosaicRule(W)}},getUnit:function(){var b=null,g=!1;this.unit=null;e.forEach(this._layers,function(W){W.multidimensionalInfo&&e.forEach(W.multidimensionalInfo.variables,
function(N){e.forEach(N.dimensions,function(U){U.name===this.dimension&&U.unit&&(null!=b||g?n.isDefined(U.unit)&&U.unit.replace("esri","").toLowerCase()!==b.toLowerCase()&&(b=null,g=!0):b=U.unit.replace("esri",""))},this)},this)},this);b&&(b=b.replace("esri",""));this.unit=b;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=g;return b},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;e.some(this._layers,function(b){if(b.fields&&b.fields.length&&e.some(b.fields,function(g){if(g.name&&
g.name===this.dimension&&g.alias)return this.dimensionAlias=g.alias,!0},this))return!0},this)},_readMosaicRule:function(){var b;e.forEach(this._layers,function(g){(g=g.mosaicRule&&g.mosaicRule.multidimensionalDefinition||g.multidimensionalDefinition)&&e.forEach(g,function(W){W&&W.dimensionName===this.dimension&&W.values&&(b=W.values.length&&W.values[0]&&W.values[0].length?W.values[0]:W.values)},this)},this);this.useRanges=n.isDefined(this.useRanges)?this.useRanges:b&&1!==b.length?!0:!1;b&&(this.useRanges?
(this._thumbCount=2,this.value=1===b.length?[b[0],this.dimensionValues[this.dimensionValues.length-1]]:b):1<b.length&&this._snap?(this._thumbCount=2,this.value=b):(this._thumbCount=1,this.useRanges=!1,this.value=b[0]))},hasUnitConflict:function(){this.getUnit();return this._hasUnitConflict},resizeSlider:function(b,g){A.set(this.domNode,{height:b+"px",width:g+"px"});A.set(this.mdSliderTable,{height:b+"px",width:g+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var b=S.getContentBox(this.domNode).h-
S.getContentBox(this.dimensionInfo).h-(S.getContentBox(this.playPauseBtnRow).h+20);10>=d("ie")&&(b-=53);var g="height: "+b+"px;";this._slider&&this._slider.domNode&&A.set(this._slider.domNode,"height",b+"px");return g},getUnitSymbol:function(){if(!n.isDefined(this.unit))return null;var b=this.unit.toLowerCase();if("meters"===b||"meter"===b)return this.unitSymbols.meter;if("pascal"===b||"pascals"===b)return this.unitSymbols.pascal},_snapToNearestRange:function(b){if(b&&b.length&&this._snap){var g,
W,N,U=this;var M=[this.dimensionValues[b[1]],this.dimensionValues[b[0]]];M.sort(this._sortCompareFunction);if(e.some(this._dimensionObjects,function(ra){if(e.some(ra.values,function(Ba){if(Ba&&Ba.length&&Ba[0]===M[0]&&Ba[1]===M[1])return!0}))return!0},this))return b;if(e.some(this._dimensionObjects,function(ra){if(e.some(ra.values,function(Ba){if(Ba&&Ba.length&&Ba[0]===M[0])return g=F.clone(Ba.sort(this._sortCompareFunction)),!0},this))return!0},this)){e.some(this.dimensionValues,function(ra,Ba){ra===
g[0]&&(W=Ba);ra===g[1]&&(N=Ba)});var Z=Math.abs(b[0]-W);var da=[W,N]}if(e.some(this._dimensionObjects,function(ra){if(e.some(ra.values,function(Ba){if(Ba&&Ba.length&&Ba[1]===M[1])return g=F.clone(Ba.sort(this._sortCompareFunction)),!0},this))return!0},this)){e.some(this.dimensionValues,function(ra,Ba){ra===g[1]&&(N=Ba);ra===g[0]&&(W=Ba)});var oa=Math.abs(b[1]-N);var wa=[W,N]}b=Z&&oa?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,da)?wa:this._oldValue&&this._oldValue.length&&
this._arraysEqual(this._oldValue,wa)?da:Z<=oa?da:wa:da||wa||b;this._update=!1;setTimeout(function(){U._slider.set("value",b)},100);return b}},_arraysEqual:function(b,g){var W;if(!n.isDefined(b)||!n.isDefined(g))return!1;if(b===g)return!0;if(b.length!==g.length)return!1;b.sort(this._sortCompareFunction);g.sort(this._sortCompareFunction);for(W=0;W<b.length;++W)if(b[W]!==g[W])return!1;return!0},_getNextRangeIndex:function(b,g){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;
var W,N,U;g=n.isDefined(g)?g:1;e.some(this._dimensionRangeValues,function(Z,da){if(this._arraysEqual(Z,[this.dimensionValues[b[0]],this.dimensionValues[b[1]]]))return W=da,!0},this);var M=this._dimensionRangeValues[0<g?(W+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+W-1)%this._dimensionRangeValues.length];e.some(this.dimensionValues,function(Z,da){Z===M[0]&&(N=da);Z===M[1]&&(U=da);if(N&&U)return!0},this);return[N,U]}});F.mixin(f,v);F.setObject("dijit.MultidimensionalSlider",
f,K);return f})},"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(O,F){return O("dijit.form.VerticalRule",F,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare","./HorizontalRuleLabels"],function(O,F){return O("dijit.form.VerticalRuleLabels",
F,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(d){return 100-d},_isHorizontal:!1})})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n,w,c,D,E,J,A,S,H,ea,L,v,b,g,W){F=F([g,q,h],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:W,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(N,U){N=N||{};this.map=N.map;this._hasUI=U?!0:!1;this.bingMapsKey=N.bingMapsKey&&
0<N.bingMapsKey.length?N.bingMapsKey:null;this.showArcGISBasemaps=!1!==N.showArcGISBasemaps;this.basemaps=N.basemaps||[];this.basemapIds=N.basemapIds;this.referenceIds=N.referenceIds;this.basemapsGroup=N.basemapsGroup;this.arcgisUrl=e.dijit._arcgisUrl;N.portalUrl&&(this.arcgisUrl=N.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=k.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(X.hitch(this,function(N){this._supportsVTL=N}));d.forEach(this.basemaps,function(N){N.id&&0!==N.id.length||(N.id=this._getUniqueId());d.forEach(N.layers,function(U){U.opacity=0<=U.opacity?U.opacity:1;U.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&d.forEach(this.basemapIds,function(N){this.map.getLayer(N)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&
d.forEach(this.referenceIds,function(N){N=this.map.getLayer(N);N._basemapGalleryLayerType="reference";N.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(X.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(X.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():R.connect(this,"onLoad",
X.hitch(this,function(){this._refreshUI()}))},select:function(N){this._select(N)},getSelected:function(){return this._selectedBasemap},get:function(N){var U;for(U=0;U<this.basemaps.length;U++)if(this.basemaps[U].id===N)return this.basemaps[U];return null},add:function(N){return N&&!N.id?(N.id=this._getUniqueId(),this.basemaps.push(N),this._refreshUI(),this.onAdd(N),!0):N&&this._isUniqueId(N.id)?(this.basemaps.push(N),this._refreshUI(),this.onAdd(N),!0):!1},remove:function(N){var U;for(U=0;U<this.basemaps.length;U++){var M=
this.basemaps[U];if(M.id===N)return this._selectedBasemap&&this._selectedBasemap.id===M.id&&(this._selectedBasemap=null),this.basemaps.splice(U,1),this._refreshUI(),this.onRemove(M),M}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(N){},onRemove:function(N){},onError:function(N){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&
0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(N){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,N):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(N))},_findArcGISBasemapsGroup:function(N){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(N);else{var U=this.arcgisUrl+"/portals/self",
M={f:"json"};M.culture=ba.locale;m({url:U,content:M,callbackParamName:"callback",load:X.hitch(this,function(Z,da){Z&&Z.useVectorBasemaps&&Z.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(X.hitch(this,function(oa){this._basemapGalleryGroupQuery=oa?Z.vectorBasemapGalleryGroupQuery:Z&&Z.basemapGalleryGroupQuery?Z.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(N)})):(this._basemapGalleryGroupQuery=Z&&Z.basemapGalleryGroupQuery?Z.basemapGalleryGroupQuery:
this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(N))}),error:X.hitch(this,function(Z,da){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(N){var U=X.hitch(this,"_findArcGISBasemaps"),M=this.arcgisUrl+"/community/groups",Z={};Z.q=this._basemapGalleryGroupQuery;Z.f="json";m({url:M,content:Z,callbackParamName:"callback",load:X.hitch(this,function(da,oa){if(0<da.results.length)U(da.results[0].id,N,da.results[0].sortField,
da.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:X.hitch(this,function(da){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(N,U,M,Z){var da=X.hitch(this,function(oa,wa,ra,Ba){var Ia=this.arcgisUrl+"/search",Ma={};Ma.q="group:"+oa+' AND type:"web map" NOT type:"web mapping application"';Ma.sortField=ra;Ma.sortOrder="asc"===Ba?"desc":"asc";Ma.num=100;Ma.f="json";m({url:Ia,
content:Ma,callbackParamName:"callback",load:X.hitch(this,function(Za,bb){if(0<Za.results.length)wa(Za.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:X.hitch(this,function(Za,bb){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});M&&Z?da(N,U,M,Z):m({url:this.arcgisUrl+"/community/groups/"+N,content:{f:"json"},callbackParamName:"callback",load:X.hitch(this,function(oa,wa){oa.sortField?da(N,U,oa.sortField,oa.sortOrder):
da(N,U,"name","desc")}),error:X.hitch(this,function(oa,wa){da(N,U,"name","desc")})})},_handleArcGISBasemapsResponse:function(N){0<N.length&&(d.forEach(N,function(U,M){if(this.bingMapsKey||!this.bingMapsKey&&U.title&&-1===U.title.indexOf("Bing Maps")){var Z={};Z.id=this._getUniqueId();Z.title=U.title;Z.thumbnailUrl="";if(U.thumbnail&&U.thumbnail.length&&(Z.thumbnailUrl=this.arcgisUrl+"/content/items/"+U.id+"/info/"+U.thumbnail,e.id)){var da=e.id.findCredential(k.urlToObject(this.arcgisUrl).path);da&&
(Z.thumbnailUrl+="?token\x3d"+da.token)}Z.itemId=U.id;Z=new b(Z,this);this.basemaps.splice(0,0,Z)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(x.empty(this.flowContainer),d.forEach(this.basemaps,function(N,U){N.id||(N.id="basemap_"+U);this.flowContainer.appendChild(this._buildNodeLayout(N))},this),x.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(N){var U=x.create("div",{id:"galleryNode_"+N.id,"class":"esriBasemapGalleryNode"}),
M=x.create("a",{href:"javascript:void(0);"},U);R.connect(M,"onclick",X.hitch(this,"_onNodeClick",N));var Z=N.title||"";N.thumbnailUrl?x.create("img",{"class":"esriBasemapGalleryThumbnail",src:N.thumbnailUrl,title:Z,alt:Z},M):x.create("img",{"class":"esriBasemapGalleryThumbnail",src:O.toUrl("./images/transparent.gif"),title:Z,alt:Z},M);N=x.create("div",{"class":"esriBasemapGalleryLabelContainer"},U);x.create("span",{innerHTML:Z,alt:Z,title:Z},N);return U},_onNodeClick:function(N,U){U.preventDefault();
this._markSelected(N);this.select(N.id)},_markSelected:function(N){N&&(d.forEach(ba.query(".esriBasemapGallerySelectedNode",this.domNode),function(U){f.remove(U,"esriBasemapGallerySelectedNode")}),(N=z.byId("galleryNode_"+N.id))&&f.add(N,"esriBasemapGallerySelectedNode"))},_select:function(N){this._selectBasemapInProgress=!0;var U=this.get(N);U?(U.layers?this._getServiceInfos(U):(N=U.getLayers(this.arcgisUrl),X.isArray(N)?this._getServiceInfos(U):N.addCallback(X.hitch(this,function(M){this._getServiceInfos(U)}))),
this._markSelected(U)):this._selectBasemapInProgress=!1},_getServiceInfos:function(N){"https:"===location.protocol&&d.forEach(N.layers,function(M){if(this._isAgolService(M.url)||this._isHostedService(M.url))M.url=M.url.replace("http:","https:")},this);this._selectedBasemap=N;var U=[];d.forEach(N.layers,function(M){M.url&&0<M.url.length&&!M.isReference&&!M.type&&(M.deferredsPos=U.length,U.push(this._getServiceInfo(M.url)))},this);0<U.length?(new C(U)).addCallback(X.hitch(this,function(M){var Z=null;
d.forEach(N.layers,function(da){if(0===da.deferredsPos||da.deferredsPos){da.serviceInfoResponse=M[da.deferredsPos][1];var oa=da.serviceInfoResponse.fullExtent;oa||(oa=da.serviceInfoResponse.extent);Z=Z?Z.union(new y(oa)):new y(oa)}},this);this.map.extent&&5>this._getIntersectionPercent(Z,this.map.extent)&&this.map.setExtent(Z,!0);this._switchBasemapLayers(N);this._updateReferenceLayer(N)})):(this._switchBasemapLayers(N),this._updateReferenceLayer(N))},_checkVTLSupport:function(){var N=new u;V("ie")?
N.resolve(!1):N.resolve(J.supported());return N},_switchBasemapLayers:function(N){var U=N.layers,M=!1,Z,da,oa;d.forEach(U,function(ra){"VectorTileLayer"===ra.type&&(M=!0)});if(M&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===U[0].type||U[0].type&&-1<U[0].type.indexOf("BingMaps")||"WebTiledLayer"===U[0].type||
"VectorTileLayer"===U[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{d.forEach(U,function(ra){if(!ra.isReference&&ra.type&&-1<ra.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var wa=0;d.forEach(U,function(ra,Ba){if(!ra.isReference){if("OpenStreetMap"===ra.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var Ia=new w({id:"layer_osm",opacity:ra.opacity})}else if(ra.type&&-1<ra.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Ia=n.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===ra.type?Ia=n.MAP_STYLE_AERIAL:"BingMapsRoad"===ra.type&&(Ia=n.MAP_STYLE_ROAD);Ia=new n({id:"layer_bing",bingMapsKey:this.bingMapsKey,
mapStyle:Ia,opacity:ra.opacity})}else if("WebTiledLayer"===ra.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Ia=ra.initialExtent||ra.fullExtent;Ia=new E(ra.templateUrl||ra.url,{visible:ra.visibility,opacity:ra.opacity,copyright:ra.copyright,fullExtent:ra.fullExtent&&new y(ra.fullExtent),initialExtent:Ia&&new y(Ia),subDomains:ra.subDomains,
tileInfo:ra.tileInfo?new A(ra.tileInfo):null,tileServers:ra.tileServers,wmtsInfo:ra.wmtsInfo})}else if("VectorTileLayer"===ra.type){Ia=new J(ra.styleUrl,{visible:ra.visibility,opacity:ra.opacity});0===Ba&&1<U.length&&this._removeBasemapLayers();var Ma=this;R.connect(Ia,"onLoad",X.hitch(this,function(Za,bb,Sa){var Na=Ma._sameSpatialReference(Sa.spatialReference,Ma.map.spatialReference);if(Ma.map.spatialReference&&!Na)Ma.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<Ma.map.getNumLevels()){if(Na=Ma._sameTilingScheme(Sa.tileInfo,Ma.map.__tileInfo),!Na){Ma.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(Ma.map.loaded){Ma.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===bb&&1===U.length&&Ma._removeBasemapLayers();Sa._basemapGalleryLayerType="basemap";Ma.map.addLayer(Sa,
Za)}},wa,Ba))}else if(ra.serviceInfoResponse&&ra.serviceInfoResponse.mapName){Z=new K(ra.serviceInfoResponse.spatialReference);da=this._sameSpatialReference(Z,this.map.spatialReference);if(this.map.spatialReference&&!da){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===ra.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(oa=this._sameTilingScheme(ra.serviceInfoResponse.tileInfo,this.map.__tileInfo),
!oa){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===ra.serviceInfoResponse.singleFusedMapCache&&-1<ra.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Ia=(0===this.map.layerIds.length||0<
this.map.getNumLevels())&&!0===ra.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(ra):this._loadAsDynamic(ra)}else if(ra.serviceInfoResponse&&ra.serviceInfoResponse.pixelSizeX){Z=new K(ra.serviceInfoResponse.spatialReference);da=this._sameSpatialReference(Z,this.map.spatialReference);if(this.map.spatialReference&&!da){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===ra.serviceInfoResponse.singleFusedMapCache&&
0<this.map.getNumLevels()&&(oa=this._sameTilingScheme(ra.serviceInfoResponse.tileInfo,this.map.__tileInfo),!oa)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}ra.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==ra.type?Ia="Raster"===ra.serviceInfoResponse.cacheType?new v(ra.url,{serviceInfo:ra.serviceInfoResponse,opacity:ra.opacity,visible:ra.visibility,bandIds:ra.bandIds&&0<ra.bandIds.length?ra.bandIds:
null}):new c(ra.url,{resourceInfo:ra.serviceInfoResponse,opacity:ra.opacity,visible:ra.visibility}):ra.serviceInfoResponse.pixelSizeX?(Ia=new H,Ia.bandIds=ra.bandIds,ra.renderingRule?Ia.renderingRule=new L(ra.renderingRule):!ra.bandIds&&ra.serviceInfoResponse.bandCount&&3<parseInt(ra.serviceInfoResponse.bandCount,10)&&(Ia.bandIds=[0,1,2]),Ia=new S(ra.url,{resourceInfo:ra.serviceInfoResponse,opacity:ra.opacity,visible:ra.visibility,imageServiceParameters:Ia})):(Ia=new ea,Ia.format="png24",ra.serviceInfoResponse.supportedImageFormatTypes&&
-1<ra.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(Ia.format="png32"),Ia=new D(ra.url,{resourceInfo:ra.serviceInfoResponse,opacity:ra.opacity,visible:ra.visibility,imageParameters:Ia}))}"VectorTileLayer"===ra.type?wa++:Ia&&(0===Ba&&this._removeBasemapLayers(),Ia._basemapGalleryLayerType="basemap",this.map.addLayer(Ia,wa),wa++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var N=this.map.layerIds,U=[];d.forEach(N,function(M){M=
this.map.getLayer(M);"basemap"===M._basemapGalleryLayerType&&U.push(M)},this);0===U.length&&0<N.length&&U.push(this.map.getLayer(N[0]));0<U.length&&d.forEach(U,function(M){this.map.removeLayer(M)},this)},_updateReferenceLayer:function(N){var U;this._removeReferenceLayer();for(U=0;U<N.layers.length;U++)!0===N.layers[U].isReference&&this._addReferenceLayer(N.layers[U])},_removeReferenceLayer:function(){var N;for(N=this.map.layerIds.length-1;0<=N;N--){var U=this.map.getLayer(this.map.layerIds[N]);"reference"===
U._basemapGalleryLayerType&&this.map.removeLayer(U)}},_addReferenceLayer:function(N){"VectorTileLayer"===N.type?this._handleReferenceServiceInfoResponse(N):this._getServiceInfo(N.url,X.hitch(this,"_handleReferenceServiceInfoResponse",N))},_handleReferenceServiceInfoResponse:function(N,U,M){N.serviceInfoResponse=U;if("VectorTileLayer"===N.type)var Z=new J(N.styleUrl,{visible:N.visibility,opacity:N.opacity});else U&&U.mapName?Z=!0===U.singleFusedMapCache?this._loadAsCached(N):this._loadAsDynamic(N):
U&&U.pixelSizeX&&(N.serviceInfoResponse.singleFusedMapCache?Z=new c(N.url,{resourceInfo:N.serviceInfoResponse,opacity:N.opacity,visible:N.visibility}):N.serviceInfoResponse.pixelSizeX?(M=new H,M.bandIds=N.bandIds,N.renderingRule?M.renderingRule=new L(N.renderingRule):!N.bandIds&&U.bandCount&&3<parseInt(U.bandCount,10)&&(M.bandIds=[0,1,2]),Z=new S(N.url,{resourceInfo:U,opacity:N.opacity,visible:N.visibility,imageServiceParameters:M})):(U=new ea,U.format="png24",N.serviceInfoResponse.supportedImageFormatTypes&&
-1<N.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(U.format="png32"),U.transparent=!0,Z=new D(N.url,{resourceInfo:N.serviceInfoResponse,opacity:N.opacity,visible:N.visibility,imageParameters:U})));Z&&(Z._basemapGalleryLayerType="reference",Z.attr("data-reference",!0),this.map.addLayer(Z))},_getServiceInfo:function(N,U){return m({url:N,content:{f:"json"},callbackParamName:"callback",load:function(M,Z){U&&U(M,Z)},error:X.hitch(this,function(M,Z){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},
_loadAsCached:function(N){var U=[];N.displayLevels||(U=d.map(N.serviceInfoResponse.tileInfo.lods,function(Z){return Z.level}));var M=null;N.exclusionAreas&&N.exclusionAreas.length&&(M=[],d.forEach(N.exclusionAreas,function(Z){M.push({minZoom:Z.minZoom,maxZoom:Z.maxZoom,minScale:Z.minScale,maxScale:Z.maxScale,geometry:new y(Z.geometry)})}));return new c(N.url,{resourceInfo:N.serviceInfoResponse,opacity:N.opacity,visible:N.visibility,exclusionAreas:M,displayLevels:N.displayLevels||U})},_loadAsDynamic:function(N){var U=
new D(N.url,{resourceInfo:N.serviceInfoResponse,opacity:N.opacity,visible:N.visibility});N.visibleLayers&&U.setVisibleLayers(N.visibleLayers);return U},_getIntersectionPercent:function(N,U){var M=U.intersects(N);if(M){M=M.getWidth()*M.getHeight();var Z=U.getWidth()*U.getHeight();return M/Z*100}return 0},_getIds:function(){var N=[];d.forEach(this.basemaps,function(U){N.push(U.id)},this);return N},_getUniqueId:function(){for(var N=","+this._getIds().toString()+",",U=0;;)if(-1<N.indexOf(",basemap_"+
U+","))U++;else return"basemap_"+U},_isUniqueId:function(N){return-1===(","+this._getIds().toString()+",").indexOf(","+N+",")?!0:!1},_isAgolService:function(N){return N?-1!==N.indexOf("/services.arcgisonline.com/")||-1!==N.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(N){return N?-1!==N.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(N,U){return N&&U&&N.wkt==U.wkt&&(N.wkid===U.wkid||t.isDefined(N.latestWkid)&&N.latestWkid===U.wkid||t.isDefined(U.latestWkid)&&N.wkid===
U.latestWkid||t.isDefined(N.latestWkid)&&N.latestWkid===U.latestWkid)||N&&U&&N.isWebMercator()&&U.isWebMercator()?!0:!1},_sameTilingScheme:function(N,U){var M=this.map;M=M.width>M.height?M.width:M.height;var Z=!1,da=!1,oa,wa;for(oa=0;oa<N.lods.length;oa++){var ra=N.lods[oa].scale;N.dpi!==U.dpi&&(ra=N.lods[oa].scale/N.dpi);for(wa=0;wa<U.lods.length;wa++){var Ba=U.lods[wa].scale;N.dpi!==U.dpi&&(Ba=U.lods[wa].scale/U.dpi);if(Math.abs(Ba-ra)/Ba<1/M)if(Z){da=!0;break}else Z=!0;if(Ba<ra)break}if(da)break}return da||
Z&&(1===N.lods.length||1===U.lods.length)?!0:!1}});X.setObject("dijit.BasemapGallery",F,e);return F})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(O,F,d,R,X,ba,V){O=O(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(P,G){P=P||{};this.id=P.id;this.itemId=P.itemId;this.layers=P.layers;this.title=
P.title||"";this.thumbnailUrl=P.thumbnailUrl;this.basemapGallery=G},getLayers:function(P){if(this.layers)return this.layers;if(this.itemId)return P=ba({url:(P||X.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:d.hitch(this,function(G,u){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),P.addCallback(d.hitch(this,function(G,u){if(G.baseMap)return this.layers=[],F.forEach(G.baseMap.baseMapLayers,
function(C){this.layers.push(new V(C))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");return[]})),P}});d.setObject("dijit.Basemap",O,X);return O})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,F,d,R){O=O(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(X){X=X||{};this.url=X.url;this.type=X.type;this.isReference=!0===X.isReference?
!0:!1;this.opacity=X.opacity;this.visibleLayers=X.visibleLayers;this.displayLevels=X.displayLevels;this.exclusionAreas=X.exclusionAreas;this.bandIds=X.bandIds;this.renderingRule=X.renderingRule;this.templateUrl=X.templateUrl;this.copyright=X.copyright;this.subDomains=X.subDomains;this.fullExtent=X.fullExtent;this.initialExtent=X.initialExtent;this.tileInfo=X.tileInfo;this.tileServers=X.tileServers;this.styleUrl=X.styleUrl}});F.setObject("dijit.BasemapLayer",O,R);return O})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f){O=F("esri.dijit.HomeButton",[ba,P,O],{templateString:C,options:{theme:"HomeButton",map:null,extent:null,fit:!1,visible:!0},constructor:function(q,h){var e=d.mixin({},this.options,q);this.domNode=h;this._i18n=z;this.set("map",e.map);this.set("theme",e.theme);this.set("visible",e.visible);this.set("extent",e.extent);this.set("fit",e.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",
loading:"loading"}},postCreate:function(){this.inherited(arguments);this.own(G(this._homeNode,V,d.hitch(this,this.home)))},startup:function(){this.inherited(arguments);this.map||this.destroy();if(this.map.loaded)this._init();else G.once(this.map,"load",d.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var q=new u,h=this.get("extent");this._showLoading();var e={extent:h};h?this.map.extent!==h?this.map.setExtent(h,this.get("fit")).then(d.hitch(this,
function(){this._hideLoading();this.emit("home",e);q.resolve(e)}),d.hitch(this,function(t){t||(t=Error("HomeButton::Error setting map extent"));e.error=t;this.emit("home",e);q.reject(t)})):(this._hideLoading(),this.emit("home",e),q.resolve(e)):(this._hideLoading(),h=Error("HomeButton::home extent is undefined"),e.error=h,this.emit("home",e),q.reject(h));return q.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||
this.set("extent",this.map.extent);this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){x.add(this._homeNode,this._css.loading)},_hideLoading:function(){x.remove(this._homeNode,this._css.loading)},_updateThemeWatch:function(q,h,e){x.remove(this.domNode,h);x.add(this.domNode,e)},_visible:function(){this.get("visible")?f.set(this.domNode,"display","block"):f.set(this.domNode,"display","none")}});d.setObject("dijit.HomeButton",O,X);return O})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(O,F,d,R,X,ba,V,P,G,u,C,z,x,f,q,h,e,t,k,m,y,K,n){O=d("esri.dijit.LocateButton",[P,u,F],{templateString:x,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new K(O.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(w,c){var D=R.mixin({},this.options,w);this.domNode=
c;this._i18n=f;var E=navigator.geolocation,J=window.hasOwnProperty("isSecureContext");(J&&window.isSecureContext||!J&&"https:"===window.location.protocol)&&E||(D.visible=!1);this.set("map",D.map);this.set("theme",D.theme);this.set("visible",D.visible);this.set("scale",D.scale);this.set("highlightLocation",D.highlightLocation);this.set("symbol",D.symbol);this.set("infoTemplate",D.infoTemplate);this.set("geolocationOptions",D.geolocationOptions);this.set("useTracking",D.useTracking);this.set("setScale",
D.setScale);this.set("centerAt",D.centerAt);this.set("timeout",D.timeout);this.set("graphicsLayer",D.graphicsLayer);this.set("clearOnTrackingStop",D.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",R.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(C(this._locateNode,G,R.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else C.once(this.get("map"),"load",R.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var w=this.get("highlightGraphic"),
c=this.get("graphicsLayer");w&&(c?c.remove(w):this.get("map").graphics.remove(w),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?e.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):e.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
e.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){q.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(w){return w?{coords:R.mixin({},w.coords),timestamp:w.timestamp}:{}},_startTracking:function(){q.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var w=navigator.geolocation.watchPosition(R.hitch(this,function(c){c=this._positionToObject(c);this._setPosition(c).then(R.hitch(this,function(D){this._locateEvent(D)}),R.hitch(this,function(D){D||(D=Error("LocateButton::Error setting the position."));this._locateError(D)}))}),R.hitch(this,function(c){this.set("tracking",!1);c||(c=Error("LocateButton::Could not get tracking position."));this._locateError(c)}),this.get("geolocationOptions"));this.set("watchId",
w)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var w=new z;this._removePrivateVars();var c=setTimeout(R.hitch(this,function(){clearTimeout(c);w.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(R.hitch(this,function(D){D=this._positionToObject(D);clearTimeout(c);this._setPosition(D).then(R.hitch(this,function(E){w.resolve(E)}),R.hitch(this,function(E){E||
(E=Error("LocateButton::Error setting map position."));w.reject(E)}))}),R.hitch(this,function(D){D||(D=Error("LocateButton::Could not get current position."));w.reject(D)}),this.get("geolocationOptions"));return w.promise},_locate:function(){var w=new z;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),w.resolve({tracking:!0})):(this._stopTracking(),w.resolve({tracking:!1})):this._getCurrentPosition().then(R.hitch(this,function(D){this._locateEvent(D);
w.resolve(D)}),R.hitch(this,function(D){D||(D=Error("LocateButton::Could not get current position."));this._locateError(D);w.reject(D)}));else{var c=Error("LocateButton::geolocation unsupported");this._locateError(c);w.reject(c)}this._setTitle();return w.promise},_projectPoint:function(w){var c=new z,D=this.get("map").spatialReference,E=D.wkid;D.isWebMercator()?(w=t.geographicToWebMercator(w),c.resolve(w)):V.defaults.geometryService&&4326!==E?(E=new n,E.geometries=[w],E.outSR=D,V.defaults.geometryService.project(E).then(R.hitch(this,
function(J){J&&J.length?c.resolve(J[0]):c.reject(Error("LocateButton::Point was not projected."))}),function(J){J||(J=Error("LocateButton::please specify a geometry service on esri/config to project."));c.reject(J)})):c.resolve(w);return c.promise},_getScale:function(w){var c=this.get("scale");return w&&w.coords?c||w.coords.accuracy||5E4:c||5E4},_createPoint:function(w){var c;w&&w.coords&&(c=new k([w.coords.longitude,w.coords.latitude],new m({wkid:4326})));return c},_setPosition:function(w){var c=
new z,D,E;this._removePrivateVars();if((this._position=w)&&w.coords){if(D=this._createPoint(w))this._graphic=E=this._createGraphic(D,w);var J=this._getScale(w);this._scale=J;D?this._projectPoint(D).then(R.hitch(this,function(A){this._graphic=E=this._createGraphic(A,w);var S={graphic:E,scale:J,position:w};this.get("setScale")&&this.get("map").setScale(J);this.get("centerAt")?this.get("map").centerAt(A).then(R.hitch(this,function(){c.resolve(S)}),R.hitch(this,function(H){H||(H=Error("LocateButton::Could not center map."));
c.reject(H)})):c.resolve(S)}),R.hitch(this,function(A){A||(A=Error("LocateButton::Error projecting point."));c.reject(A)})):(D=Error("LocateButton::Invalid point"),c.reject(D))}else D=Error("LocateButton::Invalid position"),c.reject(D);return c.promise},_createGraphic:function(w,c){if(w){var D={position:c};D=new y(w,this.get("symbol"),D,this.get("infoTemplate"))}return D},_locateEvent:function(w){if(w.graphic){var c=this.get("highlightGraphic"),D=this.get("graphicsLayer");c?(c.setGeometry(w.graphic.geometry),
c.setAttributes(w.graphic.attributes),c.setInfoTemplate(w.graphic.infoTemplate),c.setSymbol(w.graphic.symbol)):(c=w.graphic,this.get("highlightLocation")&&(D?D.add(c):this.get("map").graphics.add(c)));this.set("highlightGraphic",c)}this._hideLoading();this.emit("locate",w)},_locateError:function(w){w={graphic:this._graphic,scale:this._scale,position:this._position,error:w};this._hideLoading();this.emit("locate",w)},_showLoading:function(){this.get("useTracking")||q.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||q.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(w,c,D){q.remove(this.domNode,c);q.add(this.domNode,D)},_visible:function(){this.get("visible")?h.set(this.domNode,"display","block"):h.set(this.domNode,"display","none")}});R.setObject("dijit.LocateButton",O,ba);return O})},
"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"*noref":1}});
define("arcgisonline/viewer","require exports esri/map esri/dijit/Attribution esri/IdentityManager esri/SnappingManager esri/tasks/identify esri/tasks/geometry esri/layers/FeatureLayer esri/layers/CSVLayer esri/layers/KMLLayer esri/layers/GeoRSSLayer esri/layers/WebTiledLayer esri/layers/StreamLayer esri/layers/osm esri/layers/VectorTileLayer esri/layers/wms esri/layers/wmts esri/layers/WFSLayer esri/layers/ArcGISImageServiceVectorLayer esri/tasks/locator esri/virtualearth/VEGeocoder esri/virtualearth/VETiledLayer esri/dijit/editing/Editor esri/dijit/editing/TemplatePicker esri/dijit/Directions esri/dijit/Geocoder esri/dijit/OverviewMap esri/dijit/Scalebar esri/dijit/Legend esri/dijit/TimeSlider esri/dijit/MultidimensionalSlider esri/dijit/BasemapGallery esri/dijit/Popup esri/dijit/HomeButton esri/dijit/LocateButton esri/dijit/Search".split(" "),function(O,
F){return{}});