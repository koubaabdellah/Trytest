// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.24/esri/copyright.txt for details.//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./decluttering/debugging ../../tiling/TileKey".split(" "),function(y,z,r,w,q,t,p,e,c,a){let g=function(){function h(f,d,m){this._layer=f;this._styleRepository=d;this.devicePixelRatio=m;this._connection=this._glyphMosaic=this._spriteMosaic=
null}var k=h.prototype;k.destroy=function(){this._connection&&(this._connection.close(),this._connection=null);this._layer=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};k.start=function(){var f=z._asyncToGenerator(function*(d){this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,d);this._spriteSourcePromise.then(l=>{this._spriteMosaic=new e(1024,1024,250);this._spriteMosaic.setSpriteSource(l)});const m=
new p(this._layer.currentStyleInfo.glyphsUrl?w.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new t(1024,1024,m);this._broadcastPromise=q.open("WorkerTileHandler",{client:this,schedule:d.schedule,signal:d.signal}).then(l=>{this._connection=l;this._connection.broadcast("setStyle",this._layer.currentStyleInfo.style,d)})});return function(d){return f.apply(this,arguments)}}();k.updateStyle=function(){var f=
z._asyncToGenerator(function*(d){yield this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",d))});return function(d){return f.apply(this,arguments)}}();k.setSpriteSource=function(f){const d=new e(1024,1024,250);d.setSpriteSource(f);this._spriteMosaic=d;this._spriteSourcePromise=Promise.resolve(f);return d};k.setStyle=function(){var f=z._asyncToGenerator(function*(d,m){yield this._broadcastPromise;this._styleRepository=d;this._spriteSourcePromise=
this._layer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(l=>{this._spriteMosaic=new e(1024,1024,250);this._spriteMosaic.setSpriteSource(l)});d=new p(this._layer.currentStyleInfo.glyphsUrl?w.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new t(1024,1024,d);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",m))});return function(d,m){return f.apply(this,
arguments)}}();k.fetchTileData=function(f,d){return this._getRefKeys(f,d).then(m=>{const l=this._layer.sourceNameToSource,b=[];for(const n in l)b.push(n);return this._getSourcesData(b,m,d)})};k.parseTileData=function(f,d){const m=f&&f.data;if(!m)return Promise.resolve(null);const {sourceName2DataAndRefKey:l,transferList:b}=m;return 0===Object.keys(l).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:f.key.id,sourceName2DataAndRefKey:l,styleLayerUIDs:f.styleLayerUIDs},
{...d,transferList:b}))};k.getSprites=function(){var f=z._asyncToGenerator(function*(d){yield this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(d)});return function(d){return f.apply(this,arguments)}}();k.getGlyphs=function(f){return this._glyphMosaic.getGlyphItems(f.font,f.codePoints)};k.perfReport=function({key:f,milliseconds:d}){c.perfAdd(f,d,"ms")};k._getTilePayload=function(){var f=z._asyncToGenerator(function*(d,m,l){d=a.pool.acquire(d.id);const b=this._layer.sourceNameToSource[m],
{level:n,row:u,col:x}=d;a.pool.release(d);try{return{protobuff:yield b.requestTile(n,u,x,l),sourceName:m}}catch(A){if(r.isAbortError(A))throw A;return{protobuff:null,sourceName:m}}});return function(d,m,l){return f.apply(this,arguments)}}();k._getRefKeys=function(f,d){const m=this._layer.sourceNameToSource,l=[];for(const b in m){const n=m[b].getRefKey(f,d);l.push(n)}return r.eachAlways(l)};k._getSourcesData=function(f,d,m){const l=[];for(let b=0;b<d.length;b++)if(null==d[b].value||null==f[b])l.push(null);
else{const n=this._getTilePayload(d[b].value,f[b],m);l.push(n)}return r.eachAlways(l).then(b=>{const n={},u=[];for(let x=0;x<b.length;x++)b[x].value&&b[x].value&&b[x].value.protobuff&&0<b[x].value.protobuff.byteLength&&(n[b[x].value.sourceName]={refKey:d[x].value.id,protobuff:b[x].value.protobuff},u.push(b[x].value.protobuff));return{sourceName2DataAndRefKey:n,transferList:u}})};z._createClass(h,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}},{key:"glyphMosaic",
get:function(){return this._glyphMosaic}}]);return h}();y.TileHandler=g;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture"],function(y,z,r,w){return function(){function q(p,e,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=
new Map;this.width=p;this.height=e;this._glyphSource=c;this._binPack=new y(p-4,e-4);this._glyphData.push(new Uint8Array(p*e));this._dirties.push(!0);this._textures.push(void 0)}var t=q.prototype;t.getGlyphItems=function(p,e){const c=[],a=this._glyphSource,g=new Set,h=1/256;for(const f of e)g.add(Math.floor(f*h));const k=[];g.forEach(f=>{if(256>=f){const d=p+f;this._rangePromises.has(d)?k.push(this._rangePromises.get(d)):(f=a.getRange(p,f).then(()=>{this._rangePromises["delete"](d)},()=>{this._rangePromises["delete"](d)}),
this._rangePromises.set(d,f),k.push(f))}});return Promise.all(k).then(()=>{let f=this._glyphIndex[p];f||(f={},this._glyphIndex[p]=f);for(const n of e){var d=f[n];if(d){c[n]={sdf:!0,rect:d.rect,metrics:d.metrics,page:d.page,code:n};continue}var m=a.getGlyph(p,n);if(!m||!m.metrics)continue;d=m.metrics;let u;if(0===d.width)u=new z(0,0,0,0);else{const x=d.width+6,A=d.height+6;var l=x%4?4-x%4:4,b=A%4?4-A%4:4;1===l&&(l=5);1===b&&(b=5);u=this._binPack.allocate(x+l,A+b);u.isEmpty&&(this._dirties[this._currentPage]||
(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new y(this.width-4,this.height-4),u=this._binPack.allocate(x+l,A+b));l=this._glyphData[this._currentPage];m=m.bitmap;let B;if(m)for(let E=0;E<A;E++){b=x*E;B=this.width*(u.y+E+1)+u.x;for(let G=0;G<x;G++)l[B+G+1]=m[b+G]}}f[n]={rect:u,metrics:d,tileIDs:null,page:this._currentPage};c[n]={sdf:!0,
rect:u,metrics:d,page:this._currentPage,code:n};this._dirties[this._currentPage]=!0}return c})};t.removeGlyphs=function(p){for(const e in this._glyphIndex){const c=this._glyphIndex[e];if(!c)continue;let a;for(const g in c)if(a=c[g],a.tileIDs["delete"](p),0===a.tileIDs.size){const h=this._glyphData[a.page],k=a.rect;let f,d;for(let m=0;m<k.height;m++)for(f=this.width*(k.y+m)+k.x,d=0;d<k.width;d++)h[f+d]=0;delete c[g];this._dirties[a.page]=!0}}};t.bind=function(p,e,c,a=0){this._textures[c]||(this._textures[c]=
new w.Texture(p,{pixelFormat:r.PixelFormat.ALPHA,dataType:r.PixelType.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const g=this._textures[c];g.setSamplingMode(e);this._dirties[c]&&g.setData(this._glyphData[c]);p.bindTexture(g,a);this._dirties[c]=!1};t.dispose=function(){this._binPack=null;for(const p of this._textures)p&&p.dispose();this._textures.length=0};return q}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../webgl/Rect"],function(y,z){return function(){function r(q,t){this._height=this._width=0;this._free=[];this._width=q;this._height=t;this._free.push(new z(0,0,q,t))}var w=r.prototype;w.allocate=function(q,t){if(q>this._width||t>this._height)return new z;let p=null,e=-1;for(let c=0;c<this._free.length;++c){const a=this._free[c];q<=a.width&&t<=a.height&&(null===p||a.y<=p.y&&a.x<=p.x)&&(p=a,e=c)}if(null===p)return new z;this._free.splice(e,1);p.width<p.height?(p.width>q&&this._free.push(new z(p.x+
q,p.y,p.width-q,t)),p.height>t&&this._free.push(new z(p.x,p.y+t,p.width,p.height-t))):(p.width>q&&this._free.push(new z(p.x+q,p.y,p.width-q,p.height)),p.height>t&&this._free.push(new z(p.x,p.y+t,q,p.height-t)));return new z(p.x,p.y,q,t)};w.release=function(q){for(let t=0;t<this._free.length;++t){const p=this._free[t];if(p.y===q.y&&p.height===q.height&&p.x+p.width===q.x)p.width+=q.width;else if(p.x===q.x&&p.width===q.width&&p.y+p.height===q.y)p.height+=q.height;else if(q.y===p.y&&q.height===p.height&&
q.x+q.width===p.x)p.x=q.x,p.width+=q.width;else if(q.x===p.x&&q.width===p.width&&q.y+q.height===p.y)p.y=q.y,p.height+=q.height;else continue;this._free.splice(t,1);this.release(q)}this._free.push(q)};y._createClass(r,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);return r}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(y,z){let r=function(){function q(p){this._metrics=
[];this._bitmaps=[];if(p)for(;p.next();)switch(p.tag()){case 1:{const e=p.getMessage();for(;e.next();)switch(e.tag()){case 3:{const c=e.getMessage();let a,g,h,k,f,d,m;for(;c.next();)switch(c.tag()){case 1:a=c.getUInt32();break;case 2:g=c.getBytes();break;case 3:h=c.getUInt32();break;case 4:k=c.getUInt32();break;case 5:f=c.getSInt32();break;case 6:d=c.getSInt32();break;case 7:m=c.getUInt32();break;default:c.skip()}c.release();a&&(this._metrics[a]={width:h,height:k,left:f,top:d,advance:m},this._bitmaps[a]=
g);break}default:e.skip()}e.release();break}default:p.skip()}}var t=q.prototype;t.getMetrics=function(p){return this._metrics[p]};t.getBitmap=function(p){return this._bitmaps[p]};return q}(),w=function(){function q(){this._ranges=[]}var t=q.prototype;t.getRange=function(p){return this._ranges[p]};t.addRange=function(p,e){this._ranges[p]=e};return q}();return function(){function q(p){this._glyphInfo={};this._baseURL=p}var t=q.prototype;t.getRange=function(p,e){const c=this._getFontStack(p);if(c.getRange(e))return Promise.resolve();
const a=256*e,g=a+255;if(this._baseURL)return p=this._baseURL.replace("{fontstack}",p).replace("{range}",a+"-"+g),y(p,{responseType:"array-buffer"}).then(h=>{c.addRange(e,new r(new z(new Uint8Array(h.data),new DataView(h.data))))}).catch(()=>{c.addRange(e,new r)});c.addRange(e,new r);return Promise.resolve()};t.getGlyph=function(p,e){if(p=this._getFontStack(p)){var c=Math.floor(e/256);if(!(256<c)&&(p=p.getRange(c)))return{metrics:p.getMetrics(e),bitmap:p.getBitmap(e)}}};t._getFontStack=function(p){let e=
this._glyphInfo[p];e||(e=this._glyphInfo[p]=new w);return e};return q}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["../../../../symbols/cim/CIMSymbolHelper","./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture"],function(y,z,r,w,q){return function(){function t(e,c,a=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=
1;(0>=e||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=e;this._pageHeight=c;0<a&&(this._maxItemSize=a);this._binPack=new z(e-4,c-4)}var p=t.prototype;p.dispose=function(){this._binPack=null;this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0};p.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]};p.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]};p.getPageSize=
function(e){return e>=this._size.length?null:this._size[e]};p.setSpriteSource=function(e){this.dispose();this.pixelRatio=e.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);const c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=e};p.getSpriteItem=function(e,c=!1){var a=this._mosaicRects[e];
if(a)return a;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let g;e&&e.startsWith("dasharray-")?([a,g]=this._rasterizeDash(e),c=!0):a=this._sprites.getSpriteInfo(e);if(!a||!a.width||!a.height||0>a.width||0>a.height)return null;const h=a.width,k=a.height,[f,d,m]=this._allocateImage(h,k);if(0>=f.width)return null;this._copy(f,a,d,m,c,g);a={rect:f,width:h,height:k,sdf:a.sdf,simplePattern:!1,pixelRatio:a.pixelRatio,page:d};return this._mosaicRects[e]=a};p.getSpriteItems=function(e){const c=
{};for(const a of e)c[a.name]=this.getSpriteItem(a.name,a.repeat);return c};p.getMosaicItemPosition=function(e,c){c=(e=this.getSpriteItem(e,c))&&e.rect;if(!c)return null;c.width=e.width;c.height=e.height;return{tl:[c.x+2,c.y+2],br:[c.x+2+e.width,c.y+2+e.height],page:e.page}};p.bind=function(e,c,a=0,g=0){this._textures[a]||(this._textures[a]=new q.Texture(e,{pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,width:this._size[a][0],height:this._size[a][1]},
new Uint8Array(this._mosaicsData[a].buffer)));const h=this._textures[a];h.setSamplingMode(c);this._dirties[a]&&h.setData(new Uint8Array(this._mosaicsData[a].buffer));e.bindTexture(h,g);this._dirties[a]=!1};t._copyBits=function(e,c,a,g,h,k,f,d,m,l,b){let n=g*c+a;f=d*k+f;if(b)for(f-=k,b=-1;b<=l;b++,n=((b+l)%l+g)*c+a,f+=k)for(d=-1;d<=m;d++)h[f+d]=e[n+(d+m)%m];else for(a=0;a<l;a++){for(g=0;g<m;g++)h[f+g]=e[n+g];n+=c;f+=k}};p._copy=function(e,c,a,g,h,k){if(this._sprites&&"loaded"===this._sprites.loadStatus&&
!(a>=this._mosaicsData.length)){var f=new Uint32Array(k?k.buffer:this._sprites.image.buffer),d=this._mosaicsData[a];d&&f||console.error("Source or target images are uninitialized!");t._copyBits(f,k?c.width:this._sprites.width,c.x,c.y,d,g[0],e.x+2,e.y+2,c.width,c.height,h);this._dirties[a]=!0}};p._allocateImage=function(e,c){e+=2;c+=2;var a=Math.max(e,c);if(this._maxItemSize&&this._maxItemSize<a)return a=new r(0,0,e,c),this._mosaicsData.push(new Uint32Array(e*c)),this._dirties.push(!0),this._size.push([e,
c]),this._textures.push(void 0),[a,this._mosaicsData.length-1,[e,c]];a=e%4?4-e%4:4;let g=c%4?4-c%4:4;1===a&&(a=5);1===g&&(g=5);a=this._binPack.allocate(e+a,c+g);return 0>=a.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-
4,this._pageHeight-4),this._allocateImage(e,c)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]};p._rasterizeDash=function(e){var c=e.match(/\[(.*?)\]/);if(!c)return null;c=c[1].split(",").map(Number);e=e.slice(e.lastIndexOf("-")+1);const [a,g,h]=y.SymbolHelper.rasterizeDash(c,e);e=new Uint8Array(a.buffer);return[{x:0,y:0,width:g,height:h,sdf:!0,pixelRatio:1},e]};return t}()})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(y){function z(r,
w){return`${Math.round(10*r)/10}${w}`}y.drawColliders=function(r,w){const q=window.COLLISION_XRAY;for(let k=0;k<w.length;++k){const f=!w[k].unique.show;if(q||!f)for(const d of w[k].colliders){if(!d.enabled)continue;var t=!w[k].unique.parts[d.partIndex].show;if(!q&&t)continue;var p=d.xScreen,e=d.yScreen;const m=d.dxScreen,l=d.dyScreen;r.globalAlpha=f||t?.2:1;t=r;var c=p-1,a=e-1;t.fillStyle="green";t.fillRect(c,a,3,3);t=r;c=p+m;a=e+l;var g=d.width,h=d.height;t.strokeStyle="red";t.strokeRect(c,a,g,h);
t=r;p=p+m-1;e=e+l-1;t.fillStyle="blue";t.fillRect(p,e,3,3);r.globalAlpha=1}}};y.drawGridIndex=function(r,w){r.strokeStyle="black";const q=w.cellSize,t=w.rows,p=w.columns;for(let e=0;e<t;e++){const c=w.cells[e],a=e*q,g=(e+1)*q;for(let h=0;h<p;h++){const k=c[h],f=h*q;r.strokeRect(f,a,(h+1)*q-f,g-a);r.fillText(`cells:${k.length}`,f+4,a+12)}}};y.perfAdd=function(r,w,q){if(window.PERFORMANCE_RECORDING_STORAGE){var t=window.PERFORMANCE_RECORDING_STORAGE;t.perf=t.perf||{};t=t.perf;t[r]=t[r]||{start:null,
time:0,min:void 0,max:void 0,samples:[],unit:q};t[r].time+=w;t[r].samples.push(w);if(null==t[r].min||w<t[r].min)t[r].min=w;if(null==t[r].max||w>t[r].max)t[r].max=w}};y.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf={})};y.perfElement=function(r){if(!window.PERFORMANCE_RECORDING_STORAGE){var w=document.createElement("div");w.innerHTML="No recorded data is present because performance recording is disabled.";return w}w=document.createElement("div");
var q=window.PERFORMANCE_RECORDING_STORAGE.perf;var t='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${r}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;const p=[];for(var e in q)p.push({name:e,value:q[e].time/q[e].samples.length,sortkey:q[e].max});p.sort((f,d)=>-(f.sortkey-d.sortkey));e=p.map(f=>f.name);for(var c of e)t+="\x3ctr\x3e",t+=`<td>${c}</td>`,
t+=`<td>${z(q[c].time,q[c].unit)}</td>`,t+=`<td>${q[c].samples.length}</td>`,t+=`<td>${z(q[c].time/q[c].samples.length,q[c].unit)}</td>`,t+=`<td style="text-align: right;">${z(q[c].min,q[c].unit)}</td>`,t+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",t+=`<td>${z(q[c].max,q[c].unit)}</td>`,t+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",t+="\x3c/tr\x3e";w.innerHTML=t+"\x3ctable\x3e";t=w.querySelectorAll("td[data-distribution\x3d'1']");c=w.querySelectorAll("td[data-histogram\x3d'1']");for(let f=
0;f<t.length;f++){let d=t[f];var a=document.createElement("canvas");a.height=10;a.width=100;var g=a.getContext("2d");g.strokeStyle=r;g.beginPath();g.moveTo(0,5);g.lineTo(100,5);if(q[e[f]].max>q[e[f]].min+.001)for(const m of q[e[f]].samples){var h=(m-q[e[f]].min)/(q[e[f]].max-q[e[f]].min);g.moveTo(100*h,3);g.lineTo(100*h,7)}g.stroke();g.strokeRect((p[f].value-q[e[f]].min)/(q[e[f]].max-q[e[f]].min)*100-2,0,4,9);d.appendChild(a);d=c[f];{a=Array(50);for(g=0;g<a.length;g++)a[g]=0;for(const l of q[e[f]].samples)g=
(l-q[e[f]].min)/(q[e[f]].max-q[e[f]].min),a[1===g?a.length-1:Math.floor(g*a.length)]++;g=document.createElement("canvas");g.height=30;g.width=120;h=g.getContext("2d");h.strokeStyle=r;h.fillStyle=r;let m=0;for(var k=0;k<a.length;k++)m=Math.max(m,a[k]);for(k=0;k<a.length;k++){const l=a[k];h.fillRect(k*g.width/a.length,g.height*(1-l/m),g.width/a.length,l/m*g.height)}h.beginPath();h.moveTo(0,g.height);h.lineTo(g.width,g.height);h.stroke();d.appendChild(g)}}r=w.querySelectorAll("td");for(q=0;q<r.length;q++)r[q].style.padding=
"5px";return w};Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../core/maybe","../../tiling/TileCoverage","../../tiling/TileKey"],function(y,z,r,w,q){const t=(e,c)=>e+1/(1<<2*c);let p=function(){function e(a,g){this._tiles=new Map;this._tileCache=new z(40,h=>h.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=a.acquireTile;
this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this._container=g}var c=e.prototype;c.destroy=function(){for(const [,a]of this._tiles)a.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null};c.update=function(a){this._updateCacheSize(a);const g=this.tileInfoView;a=g.getTileCoverage(a.state,0,"smallest");const {spans:h,lodInfo:k}=a,{level:f}=k,d=this._tiles,m=new Set,l=new Set;for(const {row:n,colFrom:u,colTo:x}of h)for(let A=u;A<=x;A++){const B=q.getId(f,n,k.normalizeCol(A),
k.getWorldForColumn(A)),E=this._getOrAcquireTile(B);m.add(B);E.processed()?this._addToContainer(E):l.add(new q(B))}for(const [n,u]of d)u.isCoverage=m.has(n);for(var b of l)this._findPlaceholdersForMissingTiles(b,m);b=!1;for(const [n,u]of d)u.neededForCoverage=m.has(n),u.neededForCoverage||u.isHoldingForFade&&g.intersects(a,u.key)&&m.add(n),u.isFading&&(b=!0);for(const [n]of this._tiles)m.has(n)||this._releaseTile(n);w.pool.release(a);return!b};c.clear=function(){this._tiles.clear();this._tileCache.clear();
this._visibleTiles.clear()};c.clearCache=function(){this._tileCache.clear()};c._findPlaceholdersForMissingTiles=function(a,g){var h=[];for(const [,k]of this._tiles)this._addPlaceholderChild(h,k,a,g);h=h.reduce(t,0);1E-6>Math.abs(1-h)||this._addPlaceholderParent(a.id,g)};c._addPlaceholderChild=function(a,g,h,k){if(!(g.key.level<=h.level)&&g.hasData()){{var f=g.key;const d=f.level-h.level;f=h.row===f.row>>d&&h.col===f.col>>d&&h.world===f.world}f&&(this._addToContainer(g),k.add(g.id),a.push(g.key.level-
h.level))}};c._addPlaceholderParent=function(a,g){const h=this._tiles;for(;;){{const [f,d,m,l]=a.split("/");a=parseInt(f,10);a=0===a?null:`${a-1}/${parseInt(d,10)>>1}/${parseInt(m,10)>>1}/${parseInt(l,10)}`}if(!a||g.has(a))break;const k=h.get(a);if(k&&k.hasData()){this._addToContainer(k);g.add(k.id);break}}};c._getOrAcquireTile=function(a){let g=this._tiles.get(a);if(g)return g;(g=this._tileCache.pop(a))||(g=this.acquireTile(new q(a)));this._tiles.set(a,g);return g};c._releaseTile=function(a){const g=
this._tiles.get(a);this.releaseTile(g);this._removeFromContainer(g);this._tiles.delete(a);g.hasData()?this._tileCache.put(a,g,1):g.dispose()};c._addToContainer=function(a){let g;const h=[],k=this._container;if(!k.contains(a)){var f=this._visibleTiles;for(const [,d]of f)this._canConnectDirectly(a,d)&&h.push(d),r.isNone(g)&&this._canConnectDirectly(d,a)&&(g=d);if(r.isSome(g)){for(const d of h)g.childrenTiles.delete(d),a.childrenTiles.add(d),d.parentTile=a;g.childrenTiles.add(a);a.parentTile=g}else for(const d of h)a.childrenTiles.add(d),
d.parentTile=a;f.set(a.id,a);k.addChild(a)}};c._removeFromContainer=function(a){this._visibleTiles.delete(a.id);this._container.removeChild(a);if(r.isSome(a.parentTile)){a.parentTile.childrenTiles.delete(a);for(const g of a.childrenTiles)r.isSome(a.parentTile)&&a.parentTile.childrenTiles.add(g)}for(const g of a.childrenTiles)g.parentTile=a.parentTile;a.parentTile=null;a.childrenTiles.clear()};c._canConnectDirectly=function(a,g){a=a.key;let {level:h,row:k,col:f,world:d}=g.key;for(g=this._visibleTiles;0<
h;){h--;k>>=1;f>>=1;if(a.level===h&&a.row===k&&a.col===f&&a.world===d)return!0;if(g.has(`${h}/${k}/${f}/${d}`))break}return!1};c._updateCacheSize=function(a){a=a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var g=Math.ceil(a[0]/512)+1,h=Math.ceil(a[1]/512)+1;this._viewSize[0]=a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*g*h}};return e}();y.TileManager=p;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(y,z,r,w,q,t,p,e,c){c=function(g){function h(f,d,m,l,b,n,u=null){d=g.call(this,f,d,m,l,b,4096,4096)||this;d._memCache=u;d.type="vector-tile";d._referenced=0;d._hasSymbolBuckets=!1;d._memoryUsedByLayerData=0;d.layerData=new Map;d.layerCount=0;d.status="loading";d.allSymbolsFadingOut=!1;d.lastOpacityUpdate=0;d.symbols=new Map;d.isCoverage=!1;d.neededForCoverage=!1;d.decluttered=!1;d.invalidating=!1;d.parentTile=null;d.childrenTiles=new Set;d._processed=!1;d._referenced=1;d.styleRepository=n;
d.id=f.id;return d}z._inheritsLoose(h,g);var k=h.prototype;k.setData=function(f){this.changeDataImpl(f);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};k.deleteLayerData=function(f){let d=!1;for(const m of f)this.layerData.has(m)&&(f=this.layerData.get(m),this._memoryUsedByLayerData-=f.memoryUsed,f.type===t.BucketType.SYMBOL&&this.symbols.has(m)&&(this.symbols.delete(m),d=!0),f.destroy(),this.layerData.delete(m),this.layerCount--);r.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);d&&this.emit("symbols-changed");this.requestRender()};k.processed=function(){return this._processed};k.hasData=function(){return 0<this.layerCount};k.dispose=function(){"unloaded"!==this.status&&(a.delete(this),h._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};k.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};k.retain=function(){++this._referenced};
k.changeDataImpl=function(f){let d=!1;if(f){const {bucketsWithData:m,emptyBuckets:l}=f;f=this._createRenderBuckets(m);if(l&&0<l.byteLength){const b=new Uint32Array(l);for(const n of b)this._deleteLayerData(n)}for(const [b,n]of f)this._deleteLayerData(b),n.type===t.BucketType.SYMBOL&&(this.symbols.set(b,n.symbols),d=!0),this._memoryUsedByLayerData+=n.memoryUsed,this.layerData.set(b,n),this.layerCount++;r.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=
!1;for(const [,m]of this.layerData)m.type===t.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);d&&this.emit("symbols-changed")};k.attachWithContext=function(f){this.stage={context:f,trashDisplayObject(d){d.processDetach()},untrashDisplayObject(){return!1}}};k.setTransform=function(f,d){g.prototype.setTransform.call(this,f,d);var m=d/(f.resolution*f.pixelRatio);d=this.width/this.rangeX*m;m*=this.height/this.rangeY;const l=[0,0];f.toScreen(l,[this.x,this.y]);const b=this.transforms.tileUnitsToPixels;
w.identity(b);w.translate(b,b,l);w.rotate(b,b,Math.PI*f.rotation/180);w.scale(b,b,[d,m,1])};k._createTransforms=function(){return{dvs:q.create(),tileMat3:q.create(),tileUnitsToPixels:q.create()}};h._destroyRenderBuckets=function(f){if(f){var d=new Set;f.forEach(m=>{d.has(m)||(m.destroy(),d.add(m))});f.clear()}};k._createRenderBuckets=function(f){const d=new Map,m=new Map;for(const l of f){f=this._deserializeBucket(l,m);for(const b of f.layerUIDs)d.set(b,f)}return d};k._deserializeBucket=function(f,
d){let m=d.get(f);if(m)return m;switch((new Uint32Array(f))[0]){case t.BucketType.FILL:m=new p.FillRenderBucket(f,this.styleRepository);break;case t.BucketType.LINE:m=new p.LineRenderBucket(f,this.styleRepository);break;case t.BucketType.SYMBOL:m=new p.SymbolRenderBucket(f,this.styleRepository,this);break;case t.BucketType.CIRCLE:m=new p.CircleRenderBucket(f,this.styleRepository)}d.set(f,m);return m};k._deleteLayerData=function(f){if(this.layerData.has(f)){var d=this.layerData.get(f);this._memoryUsedByLayerData-=
d.memoryUsed;d.destroy();this.layerData.delete(f);this.layerCount--}};z._createClass(h,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<e.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<e.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||
"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return h}(c.TiledDisplayObject);const a=new Map;y.VectorTile=c;y.printAllocations=function(){a.forEach((g,h)=>{console.log(`\n${h.key}:`);g[0].forEach(k=>console.log(k));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");g[1].forEach(k=>console.log(k))})};Object.defineProperties(y,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(y,z,r,w,q,t,p,e){let c=function(){function f(m,l){this.layerUIDs=[];this.isDestroyed=!1;this.data=m;this.memoryUsed=m.byteLength;let b=1;m=new Uint32Array(m);this.layerUIDs=[];const n=
m[b++];for(let u=0;u<n;u++)this.layerUIDs[u]=m[b++];this.bufferDataOffset=b;l&&(this.layer=l.getStyleLayerByUID(this.layerUIDs[0]))}var d=f.prototype;d.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};d.prepareForRendering=function(m){r.isNone(this.data)||(this.doPrepareForRendering(m,this.data,this.bufferDataOffset),this.data=null)};z._createClass(f,[{key:"isPreparedForRendering",get:function(){return r.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);
return f}(),a=function(f){function d(l,b){b=f.call(this,l,b)||this;b.type=w.BucketType.LINE;b.lineIndexStart=0;b.lineIndexCount=0;l=new Uint32Array(l);let n=b.bufferDataOffset;b.lineIndexStart=l[n++];b.lineIndexCount=l[n++];const u=l[n++];if(0<u){const x=new Map;for(let A=0;A<u;A++){const B=l[n++],E=l[n++],G=l[n++];x.set(B,[E,G])}b.patternMap=x}b.bufferDataOffset=n;return b}z._inheritsLoose(d,f);var m=d.prototype;m.hasData=function(){return 0<this.lineIndexCount};m.triangleCount=function(){return this.lineIndexCount/
3};m.doDestroy=function(){r.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();r.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();r.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=function(l,b,n){b=new Uint32Array(b);var u=new Int32Array(b.buffer);const x=b[n++];this.lineVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,
new Int32Array(u.buffer,4*n,x));n+=x;u=b[n++];this.lineIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,u));n+=u;n=this.layer.lineMaterial;this.lineVertexArrayObject=new e.VertexArrayObject(l,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return d}(c),g=function(f){function d(l,b){b=f.call(this,l,b)||this;b.type=w.BucketType.FILL;b.fillIndexStart=0;b.fillIndexCount=0;b.outlineIndexStart=0;b.outlineIndexCount=
0;l=new Uint32Array(l);let n=b.bufferDataOffset;b.fillIndexStart=l[n++];b.fillIndexCount=l[n++];b.outlineIndexStart=l[n++];b.outlineIndexCount=l[n++];const u=l[n++];if(0<u){const x=new Map;for(let A=0;A<u;A++){const B=l[n++],E=l[n++],G=l[n++];x.set(B,[E,G])}b.patternMap=x}b.bufferDataOffset=n;return b}z._inheritsLoose(d,f);var m=d.prototype;m.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};m.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};
m.doDestroy=function(){r.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();r.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();r.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;r.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();r.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();r.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();
this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=function(l,b,n){b=new Uint32Array(b);var u=new Int32Array(b.buffer),x=b[n++];this.fillVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*n,x));n+=x;x=b[n++];this.fillIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,x));n+=x;x=b[n++];this.outlineVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,
new Int32Array(u.buffer,4*n,x));n+=x;u=b[n++];this.outlineIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,u));n+=u;b=this.layer;n=b.fillMaterial;b=b.outlineMaterial;this.fillVertexArrayObject=new e.VertexArrayObject(l,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new e.VertexArrayObject(l,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};
return d}(c),h=function(f){function d(l,b,n){b=f.call(this,l,b)||this;b.type=w.BucketType.SYMBOL;b.iconPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.symbolInstances=[];b.isIconSDF=!1;b.opacityChanged=!1;b.lastOpacityUpdate=0;b.symbols=[];const u=new Uint32Array(l),x=new Int32Array(l);l=new Float32Array(l);let A=b.bufferDataOffset;b.isIconSDF=!!u[A++];var B=u[A++];for(var E=0;E<B;E++){var G=u[A++],K=u[A++],Q=u[A++];b.iconPerPageElementsMap.set(G,[K,Q])}B=u[A++];for(E=0;E<B;E++)G=u[A++],
K=u[A++],Q=u[A++],b.glyphPerPageElementsMap.set(G,[K,Q]);B=u[A++];E=u[A++];b.iconOpacity=new Int32Array(B);b.textOpacity=new Int32Array(E);A=q.deserializeSymbols(u,x,l,A,b.symbols,n);b.bufferDataOffset=A;return b}z._inheritsLoose(d,f);var m=d.prototype;m.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};m.triangleCount=function(){let l=0;for(const [,b]of this.iconPerPageElementsMap)l+=b[1];for(const [,b]of this.glyphPerPageElementsMap)l+=b[1];return l/
3};m.doDestroy=function(){r.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();r.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();r.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();r.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;r.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();r.isSome(this.textVertexBuffer)&&
this.textVertexBuffer.dispose();r.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();r.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};m.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var l=r.unwrap(this.iconOpacity),b=r.unwrap(this.iconOpacityBuffer);0<l.length&&l.byteLength===b.size&&b.setSubData(l);l=r.unwrap(this.textOpacity);
b=r.unwrap(this.textOpacityBuffer);0<l.length&&l.byteLength===b.size&&b.setSubData(l)}};m.doPrepareForRendering=function(l,b,n){b=new Uint32Array(b);var u=new Int32Array(b.buffer),x=b[n++];this.iconVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*n,x));n+=x;x=b[n++];this.iconIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,x));n+=x;x=b[n++];this.textVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Int32Array(u.buffer,
4*n,x));n+=x;u=b[n++];this.textIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,u));n+=u;this.iconOpacityBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,r.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,r.unwrap(this.textOpacity).buffer);b=this.layer;n=b.iconMaterial;b=b.textMaterial;this.iconVertexArrayObject=new e.VertexArrayObject(l,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.iconVertexBuffer,
opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new e.VertexArrayObject(l,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return d}(c),k=function(f){function d(l,b){b=f.call(this,l,b)||this;b.type=w.BucketType.CIRCLE;b.circleIndexStart=0;b.circleIndexCount=0;l=new Uint32Array(l);let n=b.bufferDataOffset;b.circleIndexStart=l[n++];b.circleIndexCount=l[n++];b.bufferDataOffset=n;return b}
z._inheritsLoose(d,f);var m=d.prototype;m.hasData=function(){return 0<this.circleIndexCount};m.triangleCount=function(){return this.circleIndexCount/3};m.doDestroy=function(){r.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();r.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();r.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=
function(l,b,n){b=new Uint32Array(b);var u=new Int32Array(b.buffer);const x=b[n++];this.circleVertexBuffer=t.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*n,x));n+=x;u=b[n++];this.circleIndexBuffer=t.BufferObject.createIndex(l,p.Usage.STATIC_DRAW,new Uint32Array(b.buffer,4*n,u));n+=u;n=this.layer.circleMaterial;this.circleVertexArrayObject=new e.VertexArrayObject(l,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return d}(c);
y.CircleRenderBucket=k;y.FillRenderBucket=g;y.LineRenderBucket=a;y.RenderBucketBase=c;y.SymbolRenderBucket=h;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],function(y,z,r,w,q){let t=function(a){this.tile=a;this.parent=null;this.children=new Set},p=function(){function a(){this.nodes=
new Map;this.roots=new Set}var g=a.prototype;g.create=function(h){const k=new t(h);let f;const d=[];this.nodes.forEach(m=>{this._canConnectDirectly(k,m)&&d.push(m);!f&&this._canConnectDirectly(m,k)&&(f=m)});if(f){for(const m of d)f.children.delete(m),k.children.add(m),m.parent=k;f.children.add(k);k.parent=f}else{this.roots.add(k);for(const m of d)k.children.add(m),m.parent=k,this.roots.delete(m)}this.nodes.set(h.key.id,k);return k};g.destroy=function(h){r.isSome(h.parent)?(h.parent.children.delete(h),
h.children.forEach(k=>{r.isSome(h.parent)&&h.parent.children.add(k)})):this.roots.delete(h);h.children.forEach(k=>{(k.parent=h.parent)||this.roots.add(k)});this.nodes.delete(h.tile.key.id)};g.clear=function(){this.roots.clear();this.nodes.clear()};g._canConnectDirectly=function(h,k){let {level:f,row:d,col:m}=k.tile.key;for({world:k}=k.tile.key;0<f;){f--;d>>=1;m>>=1;if(h.tile.key.level===f&&h.tile.key.row===d&&h.tile.key.col===m&&h.tile.key.world===k)return!0;if(this.nodes.has(`${f}/${d}/${m}/${k}`))break}return!1};
return a}(),e=function(){function a(){this._tileGraph=new p;this._tileArray=null}var g=a.prototype;g.has=function(h){return"string"===typeof h?this._tileGraph.nodes.has(h):this._tileGraph.nodes.has(h.key.id)};g.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(h=>{this._tileArray.push(h.tile)}));return this._tileArray};g.getRoots=function(){const h=[];this._tileGraph.roots.forEach(k=>{h.push(k.tile)});return h};g.getParent=function(h){h=this._tileGraph.nodes.get("string"===
typeof h?h:h.key.id);return r.isSome(h.parent)&&h.parent.tile};g.getChildren=function(h){const k=[];this._tileGraph.nodes.get("string"===typeof h?h:h.key.id).children.forEach(f=>{k.push(f.tile)});return k};g.get=function(h){return this._tileGraph.nodes.get(h).tile};g.removeKey=function(h){h=this._tileGraph.nodes.get(h);this._tileGraph.destroy(h);this._tileArray=null};g.forEach=function(h){this._tileGraph.nodes.forEach((k,f)=>h(k.tile,f))};g.add=function(h){this._tileGraph.create(h);this._tileArray=
null};g.remove=function(h){h=this._tileGraph.nodes.get(h.key.id);this._tileGraph.destroy(h);this._tileArray=null};g.clear=function(){this._tileGraph.clear();this._tileArray=[]};return a}(),c=function(){function a(h,k,f){this._rows=Math.ceil(k/f);this._columns=Math.ceil(h/f);this._cellSize=f;this.cells=Array(this._rows);for(h=0;h<this._rows;h++)for(this.cells[h]=Array(this._columns),k=0;k<this._columns;k++)this.cells[h][k]=[]}var g=a.prototype;g.getCell=function(h,k){k=Math.min(Math.max(Math.floor(k/
this._cellSize),0),this._rows-1);h=Math.min(Math.max(Math.floor(h/this._cellSize),0),this._columns-1);return this.cells[k]&&this.cells[k][h]||null};g.getCellSpan=function(h,k,f,d){return[Math.min(Math.max(Math.floor(h/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(k/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]};z._createClass(a,[{key:"cellSize",get:function(){return this._cellSize}},
{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return a}();y.GridIndex=c;y.TileForest=e;y.TileGraph=p;y.TileNode=t;y.deserializeSymbols=function(a,g,h,k,f,d){const m=g[k++];for(let n=0;n<m;n++){const u=new q.VTLSymbol(d);u.xTile=g[k++];u.yTile=g[k++];u.hash=g[k++];u.priority=g[k++];var l=g[k++];for(var b=0;b<l;b++){const x=g[k++],A=g[k++],B=g[k++],E=g[k++],G=!!g[k++],K=g[k++],Q=h[k++],F=h[k++],M=g[k++],J=g[k++];u.colliders.push({xTile:x,yTile:A,
dxPixels:B,dyPixels:E,hard:G,partIndex:K,width:M,height:J,minLod:Q,maxLod:F})}l=a[k++];for(b=0;b<l;b++)u.textVertexRanges.push([a[k++],a[k++]]);l=a[k++];for(b=0;b<l;b++)u.iconVertexRanges.push([a[k++],a[k++]]);f.push(u)}return k};y.tileCoordChange=function(a,g,h,k,f,d){h-=f;if(0<=h)return(g>>h)+(k-(d<<h))*(a>>h);h=-h;return g-(d-(k<<h))*(a>>h)<<h};y.writeOpacityToBuffers=function(a,g,h){for(const [n,u]of a.symbols){{var k=a,f=g,d=h,m=u;const x=k.layerData.get(n);if(x.type===w.BucketType.SYMBOL){for(const A of m){m=
A.unique;var l=void 0;if(A.selectedForRendering){var b=m.parts[0];l=b.startOpacity;b=b.targetOpacity;k.allSymbolsFadingOut=k.allSymbolsFadingOut&&0===b;l=d?Math.floor(127*l)|b<<7:b?255:0;l|=l<<24|l<<16|l<<8}else l=0;for(const [B,E]of A.iconVertexRanges)for(b=B;b<B+E;b+=4)x.iconOpacity[b/4]=l;A.selectedForRendering?(l=m.parts[1],m=l.startOpacity,l=l.targetOpacity,k.allSymbolsFadingOut=k.allSymbolsFadingOut&&0===l,m=d?Math.floor(127*m)|l<<7:l?255:0,l=m<<24|m<<16|m<<8|m):l=0;for(const [B,E]of A.textVertexRanges)for(m=
B;m<B+E;m+=4)x.textOpacity[m/4]=l}x.lastOpacityUpdate=f;x.opacityChanged=!0}}}};Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){y.VTLSymbol=function(z){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=z};y.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,
targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(y,z,r,w,q,t,p,e,c,a,g,h,k){function f(d,m){if(d){const l=d.getLayoutProperty("visibility");if(!l||l.getValue()!==p.Visibility.NONE&&(void 0===d.minzoom||d.minzoom<m+1E-6)&&(void 0===d.maxzoom||d.maxzoom>=m-1E-6))return!0}return!1}a=function(d){function m(b){b=d.call(this,b)||this;b._backgroundTiles=[];b._pointToCallbacks=new Map;return b}z._inheritsLoose(m,d);var l=m.prototype;l.destroy=function(){this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=
null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null);r.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};l.setStyleResources=function(b,n,u){this._spriteMosaic=b;this._glyphMosaic=n;this._styleRepository=u;r.isNone(this._symbolFader)&&(b=new t.SymbolFader(this._styleRepository,this.children),b.on("fade-start",()=>{this.emit("fade-start");this.requestRender()}),b.on("fade-complete",
()=>{this.emit("fade-complete");this.requestRender()}),this._symbolFader=b);r.unwrap(this._symbolFader).styleRepository=u};l.setSpriteMosaic=function(b){this._spriteMosaic.dispose();this._spriteMosaic=b};l.deleteStyleLayers=function(b){r.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(b)};l.hitTest=function(){var b=z._asyncToGenerator(function*(n){const u=w.createResolver();this._pointToCallbacks.set(n,u);this.requestRender();return u.promise});return function(n){return b.apply(this,
arguments)}}();l.enterTileInvalidation=function(){for(const b of this.children)b.invalidating=!0};l.createRenderParams=function(b){return{...d.prototype.createRenderParams.call(this,b),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};l.doRender=function(b){!this.visible||b.drawPhase!==e.WGLDrawPhase.MAP&&b.drawPhase!==e.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||d.prototype.doRender.call(this,b)};
l.addChild=function(b){d.prototype.addChild.call(this,b);r.isSome(this._symbolFader)?this._symbolFader.addTile(b):b.decluttered=!0;this.requestRender();return b};l.removeChild=function(b){r.isSome(this._symbolFader)&&this._symbolFader.removeTile(b);this.requestRender();return d.prototype.removeChild.call(this,b)};l.renderChildren=function(b){const {drawPhase:n}=b;if(n===e.WGLDrawPhase.DEBUG)d.prototype.renderChildren.call(this,b);else if(this._doRender(b),0<this._pointToCallbacks.size){b.drawPhase=
e.WGLDrawPhase.HITTEST;const u=b.painter.effects.hittestVTL;u.bind(b);this._doRender(b);u.draw(b,this._pointToCallbacks);u.unbind(b);b.drawPhase=n}};l.removeAllChildren=function(){for(let b=0;b<this.children.length;b++){const n=this.children[b];r.isSome(this._symbolFader)&&this._symbolFader.removeTile(n);n.dispose()}d.prototype.removeAllChildren.call(this)};l.getStencilTarget=function(){return this.children.filter(b=>b.neededForCoverage&&b.hasData())};l.restartDeclutter=function(){r.isSome(this._symbolFader)&&
this._symbolFader.restartDeclutter()};l._doRender=function(b){const {context:n}=b;var u=this._styleRepository;if(u){var x=u.layers,A=!0;b.drawPhase===e.WGLDrawPhase.HITTEST&&(A=!1);0<u.backgroundBucketIds.length&&(b.renderPass="background",this._renderBackgroundLayers(b,u.backgroundBucketIds));d.prototype.renderChildren.call(this,b);b.drawPhase===e.WGLDrawPhase.MAP&&this._fade(b.displayLevel,b.state);if((u=this.children.filter(E=>E.visible&&E.hasData()))&&0!==u.length){for(var B of u)B.triangleCount=
0;n.setStencilWriteMask(0);n.setColorMask(!0,!0,!0,!0);n.setStencilOp(k.StencilOperation.KEEP,k.StencilOperation.KEEP,k.StencilOperation.REPLACE);n.setStencilTestEnabled(!0);n.setBlendingEnabled(!1);n.setDepthTestEnabled(!0);n.setDepthWriteEnabled(!0);n.setDepthFunction(k.CompareFunction.LEQUAL);n.setClearDepth(1);n.clear(n.gl.DEPTH_BUFFER_BIT);b.renderPass="opaque";for(B=x.length-1;0<=B;B--)this._renderStyleLayer(x[B],b,u);n.setDepthWriteEnabled(!1);n.setBlendingEnabled(A);n.setBlendFunctionSeparate(k.BlendFactor.ONE,
k.BlendFactor.ONE_MINUS_SRC_ALPHA,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);b.renderPass="translucent";for(A=0;A<x.length;A++)this._renderStyleLayer(x[A],b,u);n.setDepthTestEnabled(!1);b.renderPass="symbol";for(A=0;A<x.length;A++)this._renderStyleLayer(x[A],b,u)}n.bindVAO();n.setStencilTestEnabled(!0);n.setBlendingEnabled(!0)}};l._fade=function(b,n){r.isSome(this._symbolFader)&&(this._symbolFader.update(b,n)||this.requestRender())};l._renderStyleLayer=function(b,n,u){const {painter:x,renderPass:A}=
n;if(void 0!==b){var B=b.getLayoutProperty("visibility");if(!B||B.getValue()!==p.Visibility.NONE){switch(b.type){case p.StyleLayerType.BACKGROUND:return;case p.StyleLayerType.FILL:if("opaque"!==A&&"translucent"!==n.renderPass)return;var E="vtlFill";break;case p.StyleLayerType.LINE:if("translucent"!==A)return;E="vtlLine";break;case p.StyleLayerType.CIRCLE:if("symbol"!==A)return;E="vtlCircle";break;case p.StyleLayerType.SYMBOL:if("symbol"!==A)return;E="vtlSymbol"}u=b.type===p.StyleLayerType.SYMBOL?
u.filter(G=>G.decluttered):u.filter(G=>G.neededForCoverage);if("vtlSymbol"!==E&&(B=n.displayLevel,0===u.length||void 0!==b.minzoom&&b.minzoom>=B+1E-6||void 0!==b.maxzoom&&b.maxzoom<B-1E-6))return;B=b.uid;n.styleLayerUID=B;n.styleLayer=b;for(const G of u)if(G.layerData.has(B)){x.renderObjects(n,u,E);break}}}};l._renderBackgroundLayers=function(b,n){const {context:u,displayLevel:x,painter:A,state:B}=b,E=this._styleRepository;var G=!1;for(var K of n)if(E.getLayerById(K).type===p.StyleLayerType.BACKGROUND&&
f(E.getLayerById(K),x)){G=!0;break}if(G){G=this._tileInfoView.getTileCoverage(b.state,0,"smallest");var {spans:Q,lodInfo:F}=G,{level:M}=F,J=q.create();K=[];if(this._renderPasses){var N=this._renderPasses[0];r.isSome(this._clippingInfos)&&(N.brushes[0].prepareState(b,this._clippingInfos[0]),N.brushes[0].drawMany(b,this._clippingInfos))}N=this._backgroundTiles;var I=0;for(const {row:v,colFrom:C,colTo:H}of Q)for(let L=C;L<=H;L++){if(I<N.length){var D=N[I];D.key.set(M,v,F.normalizeCol(L),F.getWorldForColumn(L));
this._tileInfoView.getTileBounds(J,D.key,!1);D.x=J[0];D.y=J[3]}else{D=new h(M,v,F.normalizeCol(L),F.getWorldForColumn(L));const R=this._tileInfoView.getTileBounds(q.create(),D);D=new c.RenderableTile(D,R[0],R[3],512,512,4096,4096);N.push(D)}D.setTransform(B,this._tileInfoView.getTileResolution(D.key));K.push(D);I++}u.setStencilWriteMask(0);u.setColorMask(!0,!0,!0,!0);u.setStencilOp(k.StencilOperation.KEEP,k.StencilOperation.KEEP,k.StencilOperation.REPLACE);u.setStencilFunction(k.CompareFunction.EQUAL,
0,255);M=!0;b.drawPhase===e.WGLDrawPhase.HITTEST&&(M=!1);u.setStencilTestEnabled(M);for(const v of n)n=E.getLayerById(v),n.type===p.StyleLayerType.BACKGROUND&&f(n,x)&&(b.styleLayerUID=n.uid,b.styleLayer=n,A.renderObjects(b,K,"vtlBackground"));g.pool.release(G)}};return m}(a);y.VectorTileContainer=a;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../core/maybe ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(y,z,r,w,q,t,p,e,c,a,g){r=function(h){function k(d,m){var l=h.call(this)||this;l.styleRepository=d;l._tileToHandle=new Map;l._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};l._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};l._completed=!1;l._symbolRepository=new c.SymbolRepository(4096,m,()=>new t.VTLUniqueSymbol);l._symbolDeclutterer=new e.SymbolDeclutterer(m,l._symbolRepository,(b,n,u)=>new p.CollisionJob(b,n,u,l.styleRepository,l._zoom,l._viewState.rotation),(b,
n)=>{b.allSymbolsFadingOut=!0;b.lastOpacityUpdate=n;a.writeOpacityToBuffers(b,n,!0);b.decluttered=!0;b.requestRender()},(b,n)=>l.styleRepository.getStyleLayerByUID(b.styleLayerUID).z-l.styleRepository.getStyleLayerByUID(n.styleLayerUID).z,b=>{b=l.styleRepository.getStyleLayerByUID(b);return l._zoom+1E-6<b.minzoom||l._zoom-1E-6>=b.maxzoom?!1:(b=b.getLayoutProperty("visibility"))&&b.getValue()===g.Visibility.NONE?!1:!0});return l}z._inheritsLoose(k,h);var f=k.prototype;f.addTile=function(d){d.decluttered=
!1;this._tileToHandle.set(d,d.on("symbols-changed",()=>{this._symbolRepository.add(d);this.restartDeclutter()}));this._symbolRepository.add(d);this.restartDeclutter()};f.removeTile=function(d){const m=this._tileToHandle.get(d);m&&(this._symbolRepository.removeTile(d),this.restartDeclutter(),m.remove(),this._tileToHandle.delete(d))};f.update=function(d,m){this._zoom=d;this._viewState={scale:m.scale,rotation:m.rotation,center:[m.center[0],m.center[1]],size:[m.size[0],m.size[1]]};this._continueDeclutter();
return this._completed};f.restartDeclutter=function(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()};f.clear=function(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(d=>d.remove());this._tileToHandle.clear()};f.deleteStyleLayers=function(d){this._symbolRepository.deleteStyleLayers(d)};f._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,
this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(q.DECLUTTER_BUDGET))&&
this._scheduleNotifyStable()};f._scheduleNotifyStable=function(){w.isSome(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*q.FADE_DURATION)};f._notifyUnstable=function(){w.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};z._createClass(k,[{key:"stale",get:function(){return this._zoom!==
this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return k}(r);y.SymbolFader=r;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config",
"./util","../style/StyleDefinition"],function(y,z,r,w,q){let t=function(){function p(c,a,g,h,k,f){this._symbols=c;this._styleRepository=h;this._zoom=k;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new w.GridIndex(a,g,r.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*f/180);this._co=Math.cos(Math.PI*f/180);for(const d of c)for(const m of d.symbols)this._allNeededMatrices.has(m.tile)||this._allNeededMatrices.set(m.tile,
z.clone(m.tile.transforms.tileUnitsToPixels))}var e=p.prototype;e.work=function(c){const a=this._gridIndex,g=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const A=this._symbols[this._currentLayerCursor],B=this._getProperties(A.styleLayerUID);for(;this._currentSymbolCursor<A.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-g>c)return!1;var h=A.symbols[this._currentSymbolCursor];
if(!h.unique.show)continue;{var k=h,f=this._si,d=this._co,m=this._allNeededMatrices.get(h.tile),l=this._zoom;const {iconRotationAlignment:F,textRotationAlignment:M,iconTranslate:J,iconTranslateAnchor:N,textTranslate:I,textTranslateAnchor:D}=B;var b=0;for(const v of k.colliders){const [C,H]=0===v.partIndex?J:I;var n=0===v.partIndex?N:D,u=v.minLod<=l&&l<=v.maxLod;b+=u?0:1;v.enabled=u;v.xScreen=v.xTile*m[0]+v.yTile*m[3]+m[6];v.yScreen=v.xTile*m[1]+v.yTile*m[4]+m[7];n===q.TranslateAnchor.MAP?(v.xScreen+=
d*C-f*H,v.yScreen+=f*C+d*H):(v.xScreen+=C,v.yScreen+=H);q.RotationAlignment.VIEWPORT===(0===v.partIndex?F:M)?(v.dxScreen=v.dxPixels,v.dyScreen=v.dyPixels):(v.dxScreen=d*(v.dxPixels+v.width/2)-f*(v.dyPixels+v.height/2)-v.width/2,v.dyScreen=f*(v.dxPixels+v.width/2)+d*(v.dyPixels+v.height/2)-v.height/2)}0<k.colliders.length&&b===k.colliders.length&&(k.unique.show=!1)}k=h.unique;if(!k.show)continue;const {iconAllowOverlap:E,iconIgnorePlacement:G,textAllowOverlap:K,textIgnorePlacement:Q}=B;for(const F of h.colliders)if(F.enabled&&
(f=k.parts[F.partIndex],f.show)){if(d=!(F.partIndex?K:E))a:{d=F.xScreen+F.dxScreen;m=F.yScreen+F.dyScreen;l=d+F.width;b=m+F.height;const [M,J,N,I]=a.getCellSpan(d,m,l,b);for(n=J;n<=I;n++)for(u=M;u<=N;u++){var x=a.cells[n][u];for(const D of x){x=D.xScreen+D.dxScreen;const v=D.yScreen+D.dyScreen,C=x+D.width,H=v+D.height;if(!(l<x||d>C||b<v||m>H)){d=!0;break a}}}d=!1}d&&(F.hard?k.show=!1:f.show=!1)}if(k.show)for(const F of h.colliders){if(!F.enabled)continue;if(F.partIndex?Q:G)continue;if(!k.parts[F.partIndex].show)continue;
h=F.xScreen+F.dxScreen;f=F.yScreen+F.dyScreen;const [M,J,N,I]=this._gridIndex.getCellSpan(h,f,h+F.width,f+F.height);for(h=J;h<=I;h++)for(f=M;f<=N;f++)this._gridIndex.cells[h][f].push(F)}}}return!0};e._getProperties=function(c){var a=this._styleProps.get(c);if(a)return a;a=this._zoom;const g=this._styleRepository.getStyleLayerByUID(c);var h=g.getLayoutValue("symbol-placement",a)!==q.SymbolPlacement.POINT;let k=g.getLayoutValue("icon-rotation-alignment",a);k===q.RotationAlignment.AUTO&&(k=h?q.RotationAlignment.MAP:
q.RotationAlignment.VIEWPORT);let f=g.getLayoutValue("text-rotation-alignment",a);f===q.RotationAlignment.AUTO&&(f=h?q.RotationAlignment.MAP:q.RotationAlignment.VIEWPORT);h=g.getPaintValue("icon-translate",a);const d=g.getPaintValue("icon-translate-anchor",a),m=g.getPaintValue("text-translate",a),l=g.getPaintValue("text-translate-anchor",a);a={iconAllowOverlap:g.getLayoutValue("icon-allow-overlap",a),iconIgnorePlacement:g.getLayoutValue("icon-ignore-placement",a),textAllowOverlap:g.getLayoutValue("text-allow-overlap",
a),textIgnorePlacement:g.getLayoutValue("text-ignore-placement",a),iconRotationAlignment:k,textRotationAlignment:f,iconTranslateAnchor:d,iconTranslate:h,textTranslateAnchor:l,textTranslate:m};this._styleProps.set(c,a);return a};return p}();y.CollisionJob=t;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"./config"],function(y,z,r,w){function q(p,e){if(p.priority-e.priority)return p.priority-e.priority;const c=p.tile.key,a=e.tile.key;return c.world-a.world?c.world-a.world:c.level-a.level?c.level-a.level:c.row-a.row?c.row-a.row:c.col-a.col?c.col-a.col:p.xTile-e.xTile?p.xTile-e.xTile:p.yTile-e.yTile}let t=function(){function p(c,a,g,h,k,f){this._visibleTiles=c;this._symbolRepository=a;this._createCollisionJob=g;this._assignTileSymbolsOpacity=h;this._symbolLayerSorter=k;this._isLayerVisible=f;this._selectionJob=
null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var e=p.prototype;e.setScreenSize=function(c,a){this._screenWidth===c&&this._screenHeight===a||this.restart();this._screenWidth=c;this._screenHeight=a};e.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=
!0};e.continue=function(c){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var a=performance.now();if(!this._selectionJob.work(c))return!1;this._selectionJobCompleted=!0;c=Math.max(0,c-(performance.now()-a));if(0===c)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){a=performance.now();if(!this._collisionJob.work(c))return!1;
this._collisionJobCompleted=!0;c=Math.max(0,c-(performance.now()-a));if(0===c)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){a=performance.now();if(!this._opacityJob.work(c))return!1;this._opacityJobCompleted=!0;c=Math.max(0,c-(performance.now()-a));if(0===c)return!1}this._running=!1;return!0};e._createSelectionJob=function(){const c=this._symbolRepository.uniqueSymbols;for(let d=0;d<c.length;d++){const m=c[d];for(let l=0;l<m.uniqueSymbols.length;l++){const b=
m.uniqueSymbols[l];for(const n of b.tileSymbols)n.selectedForRendering=!1}}const a=[];let g=0,h=0;const k=this._isLayerVisible,f=this._symbolLayerSorter;return{work:function(d){const m=performance.now();for(;h<c.length;h++,g=0){const b=c[h];var l=b.styleLayerUID;if(!k(l)){a[h]||(a[h]={styleLayerUID:l,symbols:[]});continue}a[h]=a[h]||{styleLayerUID:l,symbols:[]};const n=a[h];for(;g<b.uniqueSymbols.length;g++){l=b.uniqueSymbols[g];if(99===g%100&&performance.now()-m>d)return!1;let u=null,x=!1,A=!1;for(const B of l.tileSymbols)if(!A||
!x){const E=B.tile;if(!u||E.isCoverage||E.neededForCoverage&&!x){u=B;if(E.neededForCoverage||E.isCoverage)A=!0;E.isCoverage&&(x=!0)}}u.selectedForRendering=!0;if(A){n.symbols.push(u);l.show=!0;for(const B of l.parts)B.show=!0}else l.show=!1}}for(const b of a)b.symbols.sort(q);return!0},get sortedSymbols(){return a.sort(f)}}};e._createOpacityJob=function(){function c(k,f){var d=k.symbols;for(const [,l]of d){var m=l;d=f;for(const b of m){m=b.unique;for(const n of m.parts)n.startOpacity+=(d-n.startTime)/
w.FADE_DURATION*(.5<n.targetOpacity?1:-1),n.startOpacity=Math.min(Math.max(n.startOpacity,0),1),n.startTime=d,n.targetOpacity=m.show&&n.show?1:0}}a(k,f);for(const l of k.childrenTiles)c(l,f)}const a=this._assignTileSymbolsOpacity,g=this._visibleTiles;let h=0;return{work(k){const f=performance.now();for(;h<g.length;h++){if(performance.now()-f>k)return!1;const d=g[h];if(r.isSome(d.parentTile))continue;const m=performance.now();c(d,m)}return!0}}};z._createClass(p,[{key:"running",get:function(){return this._running}}]);
return p}();y.SymbolDeclutterer=t;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(y,z,r,w){let q=function(){function t(e,c,a){this.tileCoordRange=e;this._visibleTiles=c;this._createUnique=a;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var p=t.prototype;
p.add=function(e,c){this._uniqueSymbolLayerArray=null;let a=this._tiles.get(e.id);a||(a={symbols:new Map},this._tiles.set(e.id,a));var g=new Map;if(c)for(var h of c)a.symbols.has(h)&&(g.set(h,a.symbols.get(h)),a.symbols.delete(h));else for(var [k]of e.layerData)a.symbols.has(k)&&(g.set(k,a.symbols.get(k)),a.symbols.delete(k));this._removeSymbols(g);c=e.symbols;g=new Map;for(const [f,d]of c)if(h=d.length,32<=h){k=this.tileCoordRange;do k/=2,h/=4;while(8<h&&64<k);h=new w.GridIndex(this.tileCoordRange,
this.tileCoordRange,k);g.set(f,{flat:d,index:h});a.symbols.set(f,{flat:d,index:h});for(const m of d)h.getCell(m.xTile,m.yTile).push(m)}else g.set(f,{flat:d}),a.symbols.set(f,{flat:d});this._addSymbols(e.key,c)};p.deleteStyleLayers=function(e){this._uniqueSymbolLayerArray=null;for(const [c,a]of this._tiles){const g=new Map;for(const h of e)a.symbols.has(h)&&(g.set(h,a.symbols.get(h)),a.symbols.delete(h));this._removeSymbols(g);0===a.symbols.size&&this._tiles.delete(c)}};p.removeTile=function(e){this._uniqueSymbolLayerArray=
null;const c=this._tiles.get(e.id);if(c){var a=new Map;for(const [g]of e.symbols)c.symbols.has(g)&&(a.set(g,c.symbols.get(g)),c.symbols.delete(g));this._removeSymbols(a);0===c.symbols.size&&this._tiles.delete(e.id)}};p._removeSymbols=function(e){for(const [a,{flat:g}]of e)for(const h of g){e=h.unique;var c=e.tileSymbols;const k=c.length-1;for(let f=0;f<k;f++)if(c[f]===h){c[f]=c[k];break}c.length=k;0===k&&(c=this._uniqueSymbolsReferences.get(a),c.delete(e),0===c.size&&this._uniqueSymbolsReferences.delete(a));
h.unique=null}};p._addSymbols=function(e,c){if(0!==c.size){var a=this._visibleTiles;for(const g of a)g.parentTile||g.key.world!==e.world||g.key.level===e.level&&!g.key.equals(e)||this._matchSymbols(g,e,c);for(const [g,h]of c)for(const k of h)r.isNone(k.unique)&&(e=this._createUnique(),k.unique=e,e.tileSymbols.push(k),c=this._uniqueSymbolsReferences.get(g),c||(c=new Set,this._uniqueSymbolsReferences.set(g,c)),c.add(e))}};p._matchSymbols=function(e,c,a){if(e.key.level>c.level){var g=e.key.level-c.level;
if(e.key.row>>g!==c.row||e.key.col>>g!==c.col)return}if(c.level>e.key.level&&(g=c.level-e.key.level,c.row>>g!==e.key.row||c.col>>g!==e.key.col))return;if(c.equals(e.key))for(var h of e.childrenTiles)this._matchSymbols(h,c,a);else{h=new Map;for(const [d,m]of a){var k=[];for(const b of m)a=w.tileCoordChange(this.tileCoordRange,b.xTile,c.level,c.col,e.key.level,e.key.col),g=w.tileCoordChange(this.tileCoordRange,b.yTile,c.level,c.row,e.key.level,e.key.row),0<=a&&a<this.tileCoordRange&&0<=g&&g<this.tileCoordRange&&
k.push({symbol:b,xTransformed:a,yTransformed:g});a=[];g=e.key.level<c.level?1:1<<e.key.level-c.level;const l=this._tiles.get(e.id).symbols.get(d);if(l){const b=l.flat;for(const n of k){var f=!1;let u;const x=n.xTransformed,A=n.yTransformed;u=r.isSome(l.index)?l.index.getCell(x,A):b;k=n.symbol;const B=k.hash;for(const E of u)if(B===E.hash&&Math.abs(x-E.xTile)<=g&&Math.abs(A-E.yTile)<=g){f=E.unique;k.unique=f;f.tileSymbols.push(k);f=!0;break}f||a.push(k)}}0<a.length&&h.set(d,a)}for(const d of e.childrenTiles)this._matchSymbols(d,
c,h)}};p._createUniqueSymbolLayerArray=function(){var e=this._uniqueSymbolsReferences;const c=Array(e.size);let a=0;for(const [g,h]of e){const k=Array(h.size);e=0;for(const f of h)k[e++]=f;c[a]={styleLayerUID:g,uniqueSymbols:k};a++}return c};z._createClass(t,[{key:"uniqueSymbols",get:function(){r.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return t}();y.SymbolRepository=q;Object.defineProperties(y,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./TiledDisplayObject"],function(y,z,r,w){w=function(q){function t(){return q.apply(this,arguments)||this}z._inheritsLoose(t,q);t.prototype._createTransforms=function(){return{dvs:r.create(),tileMat3:r.create()}};return t}(w.TiledDisplayObject);y.RenderableTile=w;Object.defineProperties(y,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,z,r,w,q,t,p,e,c,a,g,h,k,f,d,m,l){const b=w.ofType({key:"type",base:f,typeMap:{rect:d,path:l,geometry:m}});y.LayerView2DMixin=n=>{n=function(u){function x(){var B=u.apply(this,arguments)||this;B.attached=!1;B.clips=new b;B.lastUpdateId=-1;B.moving=!1;B.updateRequested=!1;return B}z._inheritsLoose(x,u);var A=x.prototype;A.initialize=function(){var B,E,G,K;const Q=null!=(B=null==(E=this.view)?void 0:E.spatialReferenceLocked)?B:!0;(null==(G=this.view)?0:G.spatialReference)&&Q&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new t("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new k.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([p.watch(()=>this.suspended,F=>{this.container&&(this.container.visible=!F);this.view&&!F&&this.updateRequested&&this.view.requestUpdate()},p.syncAndInitial),
p.watch(()=>{var F,M;return null!=(F=null==(M=this.layer)?void 0:M.opacity)?F:1},F=>{this.container&&(this.container.opacity=F)},p.syncAndInitial),p.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",F=>{this.container&&(this.container.blendMode=F)},p.syncAndInitial),p.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,F=>{this.container&&(this.container.effect=F)},p.syncAndInitial),p.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(K=this.view)&&K.whenLayerView?this.view.whenLayerView(this.layer).then(F=>{F===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};A.destroy=function(){this.processDetach();this.updateRequested=!1};A.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};A.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};A.isVisibleAtScale=function(B){const E=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!E)return!0;const {minScale:G,maxScale:K}=E;return(0===G||B<=G)&&(0===K||B>=K)};A.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};A.processUpdate=function(B){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",B),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(B)))};A.hitTest=function(B,E){return Promise.resolve(null)};A.supportsSpatialReference=function(B){return!0};A.canResume=function(){return this.spatialReferenceSupported?u.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};A.getSuspendInfo=function(){const B=u.prototype.getSuspendInfo.call(this),E=!this.spatialReferenceSupported,G=this.visibleAtCurrentScale;E&&(B.spatialReferenceNotSupported=E);G&&(B.outsideScaleRange=G);return B};z._createClass(x,
[{key:"spatialReferenceSupported",get:function(){var B;const E=null==(B=this.view)?void 0:B.spatialReference;return null==E||this.supportsSpatialReference(E)}},{key:"updating",get:function(){var B;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(B=this.updatingHandles)||!B.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return x}(n);r.__decorate([e.property()],n.prototype,
"attached",void 0);r.__decorate([e.property({type:b,set(u){u=q.referenceSetter(u,this._get("clips"),b);this._set("clips",u)}})],n.prototype,"clips",void 0);r.__decorate([e.property()],n.prototype,"container",void 0);r.__decorate([e.property()],n.prototype,"moving",void 0);r.__decorate([e.property({readOnly:!0})],n.prototype,"spatialReferenceSupported",null);r.__decorate([e.property({readOnly:!0})],n.prototype,"updateParameters",void 0);r.__decorate([e.property()],n.prototype,"updateRequested",void 0);
r.__decorate([e.property()],n.prototype,"updating",null);r.__decorate([e.property()],n.prototype,"view",void 0);r.__decorate([e.property({readOnly:!0})],n.prototype,"visibleAtCurrentScale",null);return n=r.__decorate([h.subclass("esri.views.2d.layers.LayerView2D")],n)};Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(y,z,r,w,q,t,p,e,c){r=function(a){function g(){return a.apply(this,arguments)||this}y._inheritsLoose(g,a);return g}(r.JSONSupport);return r=z.__decorate([c.subclass("esri.views.layers.support.ClipArea")],r)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,r,w,q,t,p,e){var c;w=c=function(a){function g(){var h=a.apply(this,arguments)||this;h.type="rect";h.left=null;h.right=null;h.top=null;h.bottom=null;return h}y._inheritsLoose(g,a);g.prototype.clone=function(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};y._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(e);z.__decorate([r.property({type:[Number,String],json:{write:!0}})],w.prototype,"left",void 0);z.__decorate([r.property({type:[Number,
String],json:{write:!0}})],w.prototype,"right",void 0);z.__decorate([r.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);z.__decorate([r.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);z.__decorate([r.property({readOnly:!0})],w.prototype,"version",null);return w=c=z.__decorate([p.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(y,z,r,w,q,t,p,e,c,a,g,h,k){var f;r={base:c,key:"type",typeMap:{extent:h,polygon:k}};g=f=function(d){function m(){var l=d.apply(this,arguments)||this;l.type="geometry";l.geometry=null;return l}y._inheritsLoose(m,d);m.prototype.clone=function(){return new f({geometry:this.geometry.clone()})};y._createClass(m,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return m}(g);z.__decorate([w.property({types:r,json:{read:a.fromJSON,write:!0}})],g.prototype,"geometry",void 0);z.__decorate([w.property({readOnly:!0})],
g.prototype,"version",null);return g=f=z.__decorate([e.subclass("esri.views.layers.support.Geometry")],g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(y,z,r,w,q,t,p,e){w=function(c){function a(){var g=c.apply(this,
arguments)||this;g.type="path";g.path=[];return g}y._inheritsLoose(a,c);y._createClass(a,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return a}(e);z.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);z.__decorate([r.property({readOnly:!0})],w.prototype,"version",null);return w=z.__decorate([p.subclass("esri.views.layers.support.Path")],w)})},"esri/views/2d/layers/support/Display":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../engine/Bitmap","../../engine/BitmapContainer"],function(y,z,r,w){w=function(q){function t(e){var c=q.call(this)||this;c.requestRender=c.requestRender.bind(z._assertThisInitialized(c));c._layerView=e;c._canvas=document.createElement("canvas");c._context=c._canvas.getContext("2d");c._bitmap=new r.Bitmap(null,"standard",!1);c.addChild(c._bitmap);return c}z._inheritsLoose(t,q);var p=t.prototype;p.doRender=function(e){const c=e.state,a=this._createCustomRenderParams(e),g=this._canvas,h=this._bitmap,
k=window.devicePixelRatio;g.width=c.size[0]*k;g.height=c.size[1]*k;h.resolution=c.resolution;const f=c.clone();f.pixelRatio=k;h.pixelRatio=k;a.state=f;h.x=c.viewpoint.targetGeometry.x-Math.abs(c.extent.xmax-c.extent.xmin)/2;h.y=c.viewpoint.targetGeometry.y+Math.abs(c.extent.ymax-c.extent.ymin)/2;this._layerView.render(a);h.source=g;h.rotation=c.rotation;q.prototype.doRender.call(this,{...e,state:f})};p._createCustomRenderParams=function(e){return{globalOpacity:e.globalOpacity,state:e.state,stationary:e.stationary,
pixelRatio:window.devicePixelRatio,context:this._context}};return t}(w.BitmapContainer);y.Display=w;Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(y,z,r,w){return function(q){function t(){var e=q.apply(this,arguments)||this;e._fullCacheLodInfos=null;e._levelByScale={};return e}y._inheritsLoose(t,
q);var p=t.prototype;p.getTileParentId=function(e){e=w.pool.acquire(e);const c=0===e.level?null:w.getId(e.level-1,e.row>>1,e.col>>1,e.world);w.pool.release(e);return c};p.getTileCoverage=function(e,c,a){e=q.prototype.getTileCoverage.call(this,e,c,a);if(!e)return e;const g=1<<e.lodInfo.level;e.spans=e.spans.filter(h=>0<=h.row&&h.row<g);return e};p.scaleToLevel=function(e){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[e])return this._levelByScale[e];{var c=
this._fullCacheLodInfos;if(e>c[0].scale)return c[0].level;let a;for(let g=0;g<c.length-1;g++)if(a=c[g+1],e>a.scale)return c=c[g],c.level+(c.scale-e)/(c.scale-a.scale);return c[c.length-1].level}};p._initializeFullCacheLODs=function(e){e=0===e[0].level?e.map(c=>({level:c.level,resolution:c.resolution,scale:c.scale})):z.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(c=>({level:c.level,resolution:c.resolution,scale:c.scale}));for(let c=0;c<e.length;c++)this._levelByScale[e[c].scale]=
e[c].level;this._fullCacheLodInfos=e};return t}(r)})}}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/decluttering/debugging ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ./support/Display ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(y,
z,r,w,q,t,p,e,c,a,g,h,k,f,d,m,l,b,n,u,x,A,B,E,G,K,Q){function F(J){if(t.isNone(J))return 0;switch(J.type){case "partial":return Object.keys(J.diff).length;case "complete":return Math.max(Object.keys(J.oldValue).length,Object.keys(J.newValue).length);case "collection":return Object.keys(J.added).length+Object.keys(J.changed).length+Object.keys(J.removed).length}}const M=q.getLogger("esri.views.2d.layers.VectorTileLayerView2D");q=function(J){function N(){var D=J.apply(this,arguments)||this;D._styleChanges=
[];D._fetchQueue=null;D._parseQueue=null;D._isTileHandlerReady=!1;D.fading=!1;return D}y._inheritsLoose(N,J);var I=N.prototype;I.hitTest=function(){var D=y._asyncToGenerator(function*(v,C){if(!this._tileHandlerPromise)return null;yield this._tileHandlerPromise;C=yield this._vectorTileContainer.hitTest(C);if(!C||0===C.length)return null;C=C[0]-1;var H=this._styleRepository;const L=H.getStyleLayerByUID(C);if(!L)return null;H=H.getStyleLayerIndex(L.id);return[{type:"graphic",mapPoint:v,layer:this.layer,
graphic:new r({attributes:{layerId:H,layerName:L.id,layerUID:C},layer:this.layer,sourceLayer:this.layer})}]});return function(v,C){return D.apply(this,arguments)}}();I.update=function(D){this._tileHandlerPromise&&this._isTileHandlerReady&&(D.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=D.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=
D.state,this._parseQueue.state=D.state,this._tileManager.update(D)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};I.attach=function(){const {style:D}=this.layer.currentStyleInfo;this._styleRepository=new A(D);this._tileInfoView=new G(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new n.VectorTileContainer(this._tileInfoView);this._tileHandler=new m.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);
this._start();this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0;this.notifyChange("updating");this.requestUpdate()}),this._vectorTileContainer.on("fade-complete",()=>{var v;null==(v=this._collisionBoxesDisplay)?void 0:v.requestRender();this.fading=!1;this.notifyChange("updating");this.requestUpdate()}),e.watch(()=>this.layer.symbolCollisionBoxesVisible,v=>{v?(this._collisionBoxesDisplay=new E.Display({render:C=>this._renderCollisionBoxes(C.context)}),this.container.addChild(this._collisionBoxesDisplay)):
(this.container.removeChild(this._collisionBoxesDisplay),this._collisionBoxesDisplay=null)},e.initial),this.layer.on("paint-change",v=>{if(v.isDataDriven)this._styleChanges.push({type:d.StyleUpdateType.PAINTER_CHANGED,data:v}),this.notifyChange("updating"),this.requestUpdate();else{const H=this._styleRepository;var C=H.getLayerById(v.layer);C&&(C=C.type===x.StyleLayerType.SYMBOL,H.setPaintProperties(v.layer,v.paint),C&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}}),
this.layer.on("layout-change",v=>{const C=this._styleRepository,H=C.getLayerById(v.layer);if(H){var L=h.diff(H.layout,v.layout);t.isNone(L)||(h.hasDiff(L,"visibility")&&1===F(L)?(C.setLayoutProperties(v.layer,v.layout),H.type===x.StyleLayerType.SYMBOL&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:d.StyleUpdateType.LAYOUT_CHANGED,data:v}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",
v=>{const C=this._styleRepository,H=C.getLayerById(v.layer);H&&(C.setStyleLayerVisibility(v.layer,v.visibility),H.type===x.StyleLayerType.SYMBOL&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",v=>{this._styleChanges.push({type:d.StyleUpdateType.LAYER_CHANGED,data:v});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",v=>{this._styleChanges.push({type:d.StyleUpdateType.LAYER_REMOVED,data:v});
this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",v=>{this._newSpriteSource=v.spriteSource;this._styleChanges.push({type:d.StyleUpdateType.SPRITES_CHANGED,data:null});v=this._styleRepository.layers;for(const C of v)switch(C.type){case x.StyleLayerType.SYMBOL:C.getLayoutProperty("icon-image")&&this._styleChanges.push({type:d.StyleUpdateType.LAYOUT_CHANGED,data:{layer:C.id,layout:C.layout}});break;case x.StyleLayerType.LINE:C.getPaintProperty("line-pattern")&&
this._styleChanges.push({type:d.StyleUpdateType.PAINTER_CHANGED,data:{layer:C.id,paint:C.paint,isDataDriven:C.isPainterDataDriven()}});break;case x.StyleLayerType.FILL:C.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:d.StyleUpdateType.PAINTER_CHANGED,data:{layer:C.id,paint:C.paint,isDataDriven:C.isPainterDataDriven()}})}this.notifyChange("updating");this.requestUpdate()})],this.declaredClass)};I.detach=function(){var D,v;this._stop();this.container.removeAllChildren();null==(D=this._vectorTileContainer)?
void 0:D.destroy();this._vectorTileContainer=null;null==(v=this._tileHandler)?void 0:v.destroy();this._tileHandler=null;this.handles.remove(this.declaredClass)};I.moveStart=function(){this.requestUpdate()};I.viewChange=function(){this.requestUpdate()};I.moveEnd=function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter();this.requestUpdate()};I.supportsSpatialReference=function(D){var v;return f.equals(null==(v=this.layer.tileInfo)?void 0:v.spatialReference,D)};I.canResume=
function(){let D=J.prototype.canResume.call(this);const {currentStyleInfo:v}=this.layer;if(D&&null!=v&&v.layerDefinition){const C=this.view.scale,{minScale:H,maxScale:L}=v.layerDefinition;v&&v.layerDefinition&&(H&&H<C&&(D=!1),L&&L>C&&(D=!1))}return D};I.isUpdating=function(){const D=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<D.length&&D.some(v=>v.invalidating)||this.fading};I.acquireTile=
function(D){const v=this._createVectorTile(D);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(v.key).then(C=>this._parseQueue.push({key:v.key,data:C})).then(C=>{v.once("attach",()=>this.requestUpdate());v.setData(C);this.requestUpdate();this.notifyChange("updating")}).catch(C=>{this.notifyChange("updating");p.isAbortError(C)||M.error(C)})});return v};I.releaseTile=function(D){D=D.key.id;this._fetchQueue.abort(D);this._parseQueue.abort(D);this.requestUpdate()};I._start=function(){this._stop();
this._tileManager=new l.TileManager({acquireTile:C=>this.acquireTile(C),releaseTile:C=>this.releaseTile(C),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var D=new AbortController,v=this._tileHandler.start({signal:D.signal}).then(()=>{this._fetchQueue=new K({tileInfoView:this._tileInfoView,process:(C,H)=>this._getTileData(C,H),concurrency:15});this._parseQueue=new K({tileInfoView:this._tileInfoView,process:(C,H)=>this._parseTileData(C,H),concurrency:8});
this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(C=>{this._vectorTileContainer.setStyleResources(C,this._tileHandler.glyphMosaic,this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=D;this._tileHandlerPromise=v}};I._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var D=this._tileHandlerAbortController;D&&D.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),
this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=null);this._vectorTileContainer.removeAllChildren()}};I._getTileData=function(){var D=y._asyncToGenerator(function*(v,C){v=yield this._tileHandler.fetchTileData(v,C);this.notifyChange("updating");return v});return function(v,C){return D.apply(this,arguments)}}();I._parseTileData=function(){var D=y._asyncToGenerator(function*(v,C){return this._tileHandler.parseTileData(v,
C)});return function(v,C){return D.apply(this,arguments)}}();I._applyStyleChanges=function(){var D=y._asyncToGenerator(function*(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var v=this._styleChanges;try{yield this._tileHandler.updateStyle(v)}catch(O){M.error("error applying vector-tiles style update",O.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=
!0}const C=this._styleRepository,H=[];v.forEach(O=>{O.type===d.StyleUpdateType.LAYER_REMOVED&&(O=C.getLayerById(O.data.layer))&&H.push(O.uid)});const L=[];let R;v.forEach(O=>{const P=O.data;switch(O.type){case d.StyleUpdateType.PAINTER_CHANGED:C.setPaintProperties(P.layer,P.paint);R=P.layer;break;case d.StyleUpdateType.LAYOUT_CHANGED:C.setLayoutProperties(P.layer,P.layout);R=P.layer;break;case d.StyleUpdateType.LAYER_REMOVED:C.deleteStyleLayer(P.layer);return;case d.StyleUpdateType.LAYER_CHANGED:C.setStyleLayer(P.layer,
P.index);R=P.layer.id;break;case d.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(this._newSpriteSource)),R=this._newSpriteSource=null}(O=C.getLayerById(R))&&L.push(O.uid)});v=this._vectorTileContainer.children;if(0<H.length){this._vectorTileContainer.deleteStyleLayers(H);for(var S of v)S.deleteLayerData(H)}this._fetchQueue.resume();this._parseQueue.resume();if(0<L.length){S=[];for(const O of v)v=this._fetchQueue.push(O.key).then(P=>this._parseQueue.push({key:O.key,
data:P,styleLayerUIDs:L})).then(P=>O.setData(P)),S.push(v);yield Promise.all(S)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return D.apply(this,arguments)}}();I._loadStyle=function(){var D=y._asyncToGenerator(function*(){var {style:v}=this.layer.currentStyleInfo;v=w.clone(v);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this.notifyChange("updating");
this._styleRepository=new A(v);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;const {signal:C}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,v),yield this._tileHandlerPromise}catch(H){if(!p.isAbortError(H))throw H;}C.aborted||(v=yield this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(v,this._tileHandler.glyphMosaic,
this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return D.apply(this,arguments)}}();I._createVectorTile=function(D){const v=this._tileInfoView.getTileBounds(k.create(),D);return new b.VectorTile(D,v[0],v[3],512,512,this._styleRepository)};I._renderCollisionBoxes=function(D){for(const v of this._vectorTileContainer.children)if(v.symbols){const C=[];for(const [,H]of v.symbols)C.push(...H);
u.drawColliders(D,C)}};return N}(B.LayerView2DMixin(Q));z.__decorate([c.property()],q.prototype,"_fetchQueue",void 0);z.__decorate([c.property()],q.prototype,"_parseQueue",void 0);z.__decorate([c.property()],q.prototype,"_isTileHandlerReady",void 0);z.__decorate([c.property()],q.prototype,"fading",void 0);return q=z.__decorate([g.subclass("esri.views.2d.layers.VectorTileLayerView2D")],q)});