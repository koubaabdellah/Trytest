//>>built
define("arcgisonline/pages/utils/signin","require exports tslib ../../esriGeowConfig ./storage esri/IdentityManager esri/arcgis/OAuthInfo dojo/_base/kernel dojo/Deferred".split(" "),function(u,v,h,f,l,p,q,r,m){f=h.__importDefault(f);l=h.__importDefault(l);p=h.__importDefault(p);q=h.__importDefault(q);r=h.__importDefault(r);m=h.__importDefault(m);return function(){function b(){}b.getPortalUrl=function(){var a,c=f["default"].restBaseUrl.substring(0,f["default"].restBaseUrl.indexOf("/sharing/rest")).replace("http://",
"https://");if(null===(a=f["default"].self)||void 0===a?0:a.portalHostname)c="https://"+f["default"].self.portalHostname;return c};b.setupOAuthInfo=function(a){var c={appId:b.getClientId(),portalUrl:b.getPortalUrl(),locale:r["default"].locale,popup:!1};a&&(c.forceLogin=a);a=new q["default"](c);b.esriId.registerOAuthInfos([a]);b.esriId.useSignInPage=!1};b.checkSignInStatus=function(){var a=new m["default"];b.setupOAuthInfo(!1);var c=b.getPortalUrl()+"/sharing";b.esriId.checkSignInStatus(c).then(function(d){d&&
(f["default"].userInfo=h.__assign(h.__assign({},f["default"].userInfo||{}),{username:d.userId,token:d.token,credential:d}));a.resolve(d)},function(){a.resolve(null)});return a};b.getCredential=function(a,c){var d=new m["default"];b.setupOAuthInfo(a);var e=b.getPortalUrl()+"/sharing";b.esriId.getCredential(e,c).then(function(g){d.resolve(g)},function(){d.resolve(null)});return d};b.isValidReturnUrl=function(a,c){return a?this.isValidPortalReturnUrl(c):this.isValidOnlineReturnUrl(c)};b.isValidOnlineReturnUrl=
function(a){var c=decodeURI(a),d=b.getHostName(window.location.href);a=this.getHostName(c);var e=0===c.indexOf("http://")||0===c.indexOf("https://"),g=e&&a?a.lastIndexOf(".arcgis.com"):-1,k=e&&a?a.lastIndexOf(".esri.com"):-1,n=e&&a?a.lastIndexOf(d):-1;c=-1<c.indexOf("/sharing/proxy");g=-1<g&&g+11-1===a.length-1;k=-1<k&&k+9-1===a.length-1;d=-1<n&&n+d.length-1===a.length-1;return e&&a&&(g||k||d)&&!c};b.isValidPortalReturnUrl=function(a){a=decodeURI(a);var c=b.getDomainName(window.location.hostname),
d=b.getDomainName(this.getHostName(a));return(0===a.indexOf("http://")||0===a.indexOf("https://"))&&d&&d===c};b.getHostName=function(a){a=a.match(/:\/\/(.[^/:]+)/i);return null!==a&&1<a.length&&"string"===typeof a[1]&&0<a[1].length?a[1]:null};b.getDomainName=function(a){return a.substring(a.lastIndexOf(".",a.lastIndexOf(".")-1)+1)};b.getClientId=function(){try{return l["default"].getLocalStorageItem("portalAppClientId")||l["default"].getSessionStorageItem("portalAppClientId")||"arcgisonline"}catch(a){return"arcgisonline"}};
b.checkForOrgUserOnOnlineBaseHostAndRedirect=function(a){var c=f["default"].isDebug,d=a.isPortal,e=a.user,g=a.urlKey,k=a.customBaseUrl;e=null===e||void 0===e?void 0:e.orgId;a=window.location.host===a.portalHostname;var n=!!g,t="arcgisonline"===b.getClientId();!c&&!d&&e&&a&&n&&t&&(window.location.href=window.location.href.replace(window.location.host,g+"."+k))};b.esriId=p["default"];return b}()});