/**
 * highcharts-export-csv - CBS fork of the Highcharts plugin to export the chart data to CSV, XLS or HTML table
 * @version v1.4.7-6
 */
!function(e){"object"==typeof module&&module.exports?module.exports=e:e(Highcharts)}(function(e){"use strict";function t(t,o,n,a,r){var s,l,p,c=(t.options.exporting||{}).csv||{},m=c.url||"http://www.highcharts.com/studies/csv-export/download.php";p=t.options.exporting.filename?t.options.exporting.filename:t.title?t.title.textStr.replace(/ /g,"-").toLowerCase():"chart",window.Blob&&window.navigator.msSaveOrOpenBlob?(l=new Blob([a]),window.navigator.msSaveOrOpenBlob(l,p+"."+n)):i?(s=document.createElement("a"),s.href=o,s.target="_blank",s.download=p+"."+n,t.container.append(s),s.click(),s.remove()):e.post(m,{data:a,type:r,extension:n})}var o=e.each,n=e.pick,a=e.seriesTypes,i=void 0!==document.createElement("a").download;if(e.setOptions({lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",viewData:"View data table"}}),e.Chart.prototype.getCBSMapDataRows=function(){var t=[],n={};o(this.series,function(a,i){1==i&&t.push("statcode"),a.options.isSerie?(t.push(a.name),o(a.options.data,function(t){if(t.categorie){var o=t.statcode;n[o]||(n[o]=[],n[o].serieValues=[t.categorie,t.statcode]);var a=n[o],i=t.valueString;"."!==t.valueString&&(i=e.cbsFormatNumber(t.valueString,null,"")),a.serieValues.push(i)}})):t.push(a.name)});var a=[t];for(var i in n)n.hasOwnProperty(i)&&a.push(n[i].serieValues);return a},e.Chart.prototype.getDataRows=function(){var t,a,i,r,s,l=(this.options.exporting||{}).csv||{},p=this.xAxis,c={},m=[],h=[],u=this.options.settings&&this.options.settings.hasGroupedCategories,x=l.dateFormat||"%Y-%m-%d %H:%M:%S",d=l.columnHeaderFormatter||function(t,o,n){return t instanceof e.Axis?t.options.title&&t.options.title.text||(t.isDatetimeAxis?"DateTime":"Category"):t?t.name+(n>1?" ("+o+")":""):"Category"},f=[];if("map"===this.options.chart.type)a=this.getCBSMapDataRows();else{i=0,o(this.series,function(t){var a,r=t.options.keys,s=r||t.pointArrayMap||["y"],l=s.length,m=t.requireSorting,u={},x=e.inArray(t.xAxis,p);if(o(s,function(e){u[e]=t[e+"Axis"]&&t[e+"Axis"].categories||[]}),!1!==t.options.includeInCSVExport&&!1!==t.visible){for(e.find(f,function(e){return e[0]===x})||f.push([x,i]),a=0;a<l;)h.push(d(t,s[a],s.length)),a+=1;o(t.points,function(o,r){var p,h,d=m?o.x:r;for(a=0,c[d]||(c[d]=[],c[d].xValues=[]),c[d].x=o.x,c[d].xValues[x]=o.x,t.xAxis&&"name"!==t.exportKey||(c[d].name=o.name);a<l;)p=s[a],h=o.yString||o[p],"."!==h&&"function"==typeof e.cbsFormatNumber&&(h=e.cbsFormatNumber(h,null,"")),c[d][i+a]=n(u[p][h],h),a+=1}),i+=a}});for(r in c)c.hasOwnProperty(r)&&m.push(c[r]);var g,b;for(a=[h],i=f.length;i--;)g=f[i][0],b=f[i][1],t=p[g],m.sort(function(e,t){return e.xValues[g]-t.xValues[g]}),s=d(t),a[0].splice(b,0,s),u&&a[0].splice(0,0,"Group"),o(m,function(o){var a=o.name;a||(t.isDatetimeAxis?(o.x instanceof Date&&(o.x=o.x.getTime()),a=e.dateFormat(x,o.x)):a=t.categories?n(t.names[o.x],t.categories[o.x],o.x):o.x),o.splice(b,0,a),u&&o.splice(b,0,a.parent.name)});a=a.concat(m)}return a},e.Chart.prototype.getCSV=function(e){var t="",n=this.getDataRows(),a=(this.options.exporting||{}).csv||{},i=a.itemDelimiter||",",r=a.lineDelimiter||"\n";return o(n,function(o,a){for(var s="",l=o.length,p=e?1.1.toLocaleString()[1]:".";l--;)s=o[l],s=s.name||s,"string"==typeof s&&(s='"'+s+'"'),"number"==typeof s&&","===p&&(s=s.toString().replace(".",",")),o[l]=s;t+=o.join(i),a<n.length-1&&(t+=r)}),t},e.Chart.prototype.getTable=function(e){var t="<table><thead>",n=this.getDataRows();return o(n,function(o,n){var a,i,r=n?"td":"th",s=e?1.1.toLocaleString()[1]:".";for(t+="<tr>",i=0;i<o.length;i+=1)a=o[i],"number"==typeof a?(a=a.toString(),","===s&&(a=a.replace(".",s)),t+="<"+r+' class="number">'+a+"</"+r+">"):t+="<"+r+">"+(void 0===a?"":a)+"</"+r+">";t+="</tr>",n||(t+="</thead><tbody>")}),t+="</tbody></table>"},e.Chart.prototype.downloadCSV=function(){var e=this.getCSV(!0);t(this,"data:text/csv,\ufeff"+encodeURIComponent(e),"csv",e,"text/csv")},e.Chart.prototype.downloadXLS=function(){var e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+this.getTable(!0)+"</body></html>";t(this,"data:application/vnd.ms-excel;base64,"+function(e){return window.btoa(unescape(encodeURIComponent(e)))}(e),"xls",e,"application/vnd.ms-excel")},e.Chart.prototype.viewData=function(){if(this.tableCreated)this.tableVisible?(document.getElementById("highchartsDataTable").style.display="none",this.tableVisible=!1):(document.getElementById("highchartsDataTable").style.display="block",this.tableVisible=!0);else{var e=document.createElement("div");e.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(e,this.renderTo.nextSibling),e.innerHTML=this.getTable(),e.id="highchartsDataTable",this.tableCreated=!0,this.tableVisible=!0}},e.getOptions().exporting){var r=e.getOptions().exporting.buttons.contextButton.menuItems,s={textKey:"downloadCSV",onclick:function(){this.downloadCSV()}};r.some(function(e){return e.textKey==s.textKey})||r.push(s)}a.map&&(a.map.prototype.exportKey="name"),a.mapbubble&&(a.mapbubble.prototype.exportKey="name"),a.treemap&&(a.treemap.prototype.exportKey="name")});