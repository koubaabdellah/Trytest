//>>built
define("esri/dijit/RasterFunctionEditor/utils","dojo/_base/lang dojo/_base/url dojo/has dojo/on dojo/Deferred dojo/_base/array dojo/i18n!../../nls/jsapi ../../kernel ../../request ../../lang ../../config ../../layers/ArcGISImageServiceLayer ../../layers/ImageServiceParameters ../../layers/MosaicRule ../../layers/RasterFunction ../../tasks/Geoprocessor ../../tasks/JobInfo ../../renderers/colorUtils ../../renderers/colorRampUtils ../../layers/ArcGISRenderingImageServiceLayer".split(" "),function(m,
T,y,B,U,z,V,I,J,K,L,W,X,Y,Z,aa,ba,C,M,ca){function N(a){if(a){var b=z.map([a.FromColor,a.ToColor],function(c){c=C.toRGB({h:c.Hue,s:c.Saturation,v:c.Value});return[c.r,c.g,c.b]});return{fromColor:b[0],toColor:b[1],type:"algorithmic",algorithm:a.Algorithm}}}function O(a){if(a)return a=C.toHSV(C.getDojoColor(a)),{type:"HsvColor",Hue:a.h,Saturation:a.s,Value:a.v,AlphaValue:255}}function P(a){if(a){var b=a.toJson?a.toJson():void 0;return{Algorithm:b&&b.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",
FromColor:O(a.fromColor),ToColor:O(a.toColor)}}}function Q(a,b,c){function d(g,h){return a+" ("+f[g]+" - "+f[h]+")"}var e=V.rasterFunctions.enumLabels,f={1:e.esriMonthJanuary,2:e.esriMonthFebruary,3:e.esriMonthMarch,4:e.esriMonthApril,5:e.esriMonthMay,6:e.esriMonthJune,7:e.esriMonthJuly,8:e.esriMonthAugust,9:e.esriMonthSeptember,10:e.esriMonthOctober,11:e.esriMonthNovember,12:e.esriMonthDecember};if(c&&""===c)return a.toString();e="Months"===c;c="Quarters"===c;if(!e&&!c)return a.toString();if(1==
b&&e)return a+" ("+f[+a]+")";switch(+a){case 1:return d(1,3);case 2:return d(4,6);case 3:case 7:return d(7,9);case 4:return c?d(10,12):d(4,6);case 10:return d(10,12)}return a.toString()}function D(a){return(new Date(Number(a))).toISOString().replace("Z","")}function w(a){return(new Date(a+"Z")).getTime()}function da(a,b){return a.some(function(c){return c.label===b.label}.bind(this))}function R(a){if(a&&a.type){var b,c=S,d=a.type.replace("Arguments","");if(d.toLowerCase()===c.local.toLowerCase()){var e=
a.Operation;0<=ea.indexOf(e&&e.value)&&(b="CellStatisticsFunction")}d.toLowerCase()===c.gpAdapter.toLowerCase()&&(b=(b=a.ToolName)&&b.value&&b.value.replace("_sa",""));d.toLowerCase()===c.pythonAdapter.toLowerCase()&&(a=a.ClassName,b="object"===typeof a?a.value:a);return b||d}}function E(a,b){Array.isArray(a)?a.forEach(function(c,d){b(a,d)}.bind(this)):F(a)&&Object.keys(a).forEach(function(c){b(a,c)}.bind(this))}function F(a){return null!==a&&"object"===typeof a}y={};var q,r,t,S={local:"LocalFunction",
gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},G=new Map,ea=[38,39,40,41,42,43,47,54,55,58,66,67,68,69,70,71,72,73,74,75,93,94],H=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;a=Array(a);var d=0;for(b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a};m.mixin(y,{fetchRFT:function(a,b,c,d,e){var f=new U;var g=(g=(g=a.name)&&g.slice(-8))&&".rft.xml"===g.toLowerCase();return a&&a.itemDataUrl?
g?e?this.convertRFT({url:e+"/ConvertRasterFunctionTemplate",rft:{itemId:a.id},format:"json"},b,d,c):(c("errorUtilitiesServiceNotAvailable"),f.reject(Error("errorUtilitiesServiceNotAvailable")),f.promise):J({url:a.itemDataUrl,callbackParamName:"callback",content:{f:"json"},handleAs:"json",load:b,error:c}).then(d):(c("errorRetrievingRFTItem"),f.reject(Error("errorRetrievingRFTItem")),f.promise)},convertRFT:function(a,b,c,d){var e=a.url,f=function(){t&&(t.remove(),t=null);r&&(r.remove(),r=null)};q||
(q=new aa(e),B(q,"error",f));r=B(q,"job-complete",function(g){r&&(r.remove(),r=null);g.jobInfo.jobStatus!==ba.STATUS_SUCCEEDED?(f(),d(g)):q.getResultData(g.jobInfo.jobId,"outputRasterFunction")});t=B(q,"get-result-data-complete",function(g){t&&(t.remove(),t=null);var h=g&&g.result&&g.result.value;h&&h.url&&(g={url:h.url,handleAs:"json",load:c,error:d},h=(new T(h.url)).authority,-1===L.defaults.io.corsEnabledServers.indexOf(h)&&L.defaults.io.corsEnabledServers.push(h),J(g))});a={inputRasterFunction:JSON.stringify(a.rft),
format:a.format};return q.submitJob(a,b,null,d)},getRasterJsonFromLayer:function(a){if(!a)return null;var b=a.url;b&&0<b.indexOf("?token\x3d")&&(b=b.slice(0,b.indexOf("?token\x3d")));var c=a.credential||b&&I.id.findCredential(b);K.isDefined(c)&&(b=b+"?token\x3d"+c.token,c.referer&&(b+=c.referer));b={url:b,name:a.name};a.renderingRule&&(b.renderingRule=a.renderingRule.toJson?a.renderingRule.toJson():a.renderingRule);a.mosaicRule&&(b.mosaicRule=a.mosaicRule.toJson?a.mosaicRule.toJson():a.mosaicRule);
return b},getLayerIdfromRasterValue:function(a,b){if(a&&b){var c;z.some(b,function(d){if(d&&d.url===a.url&&d.name===a.name&&a.name)return c=d.id,!0});return c}},getColorRampFromArg:function(a){if(a){var b;if(a.type&&-1<a.type.toLowerCase().indexOf("colorramp"))var c=a;else a.value&&-1<a.value.type.toLowerCase().indexOf("colorramp")&&(c=a.value);if(c)return a=c.type.toLowerCase(),"multipartcolorramp"===a?b=M.fromJson({type:"multipart",colorRamps:z.map(c.ArrayOfColorRamp,function(d){return N(d)})}):
"algorithmiccolorramp"===a&&(b=M.fromJson(N(c))),b.id=b.name=c.Name,b}},getRFxArgColorRampValue:function(a){if(a){if(a.fromColor&&a.toColor)return m.mixin(P(a),{Name:a.name});if(a.colorRamps){var b=z.map(a.colorRamps,P);return{type:"MultiPartColorRamp",NumColorRamps:b.length,ArrayOfColorRamp:b,Name:a.name}}}},RFX_VARIABLE_TYPE:"RasterFunctionVariable",RFX_TEMPLATE_TYPE:"RasterFunctionTemplate",ARGUMENT_ARRAY_TYPE:"ArgumentArray",getArgRFT:function(a){if(a){if("RasterFunctionTemplate"===a.type)return a;
if(a.value&&"RasterFunctionTemplate"===a.value.type)return a.value}},getEnumData:function(a,b,c){if(Array.isArray(a))return a.forEach(function(d){d.key=d.key.toString()}),a},getImageServiceTitle:function(a){a=a.split("/");return a[a.length-2]},isReferencedObject:function(a){if(a&&K.isDefined(a._object_ref_id))return!0},functionTypes:S,defaultRasterNodeProps:{name:"Raster",isDataset:!0,isPublic:!1,type:"RasterFunctionVariable"},getArcGISImageServiceLayerItem:function(a){if(a){a=m.clone(a);a.name||
(a.name=this.getImageServiceTitle(a.url));var b=new X;a.mosaicRule&&(b.mosaicRule=new Y(a.mosaicRule));a.renderingRule&&(b.renderingRule=new Z(a.renderingRule));b=new W(a.url,{id:a.name+(new Date).toString(),imageServiceParameters:b});b.name=a.name;return b}},filterMDInfoIfMosiacRuleIsSet:function(a){var b=m.clone(a.multidimensionalInfo),c=[],d=a.mosaicRule&&a.mosaicRule.multidimensionalDefinition;if(d&&0<d.length){var e=b.variables.filter(function(f){return d[0].variableName===f.name}.bind(this));
if(!e||0===e.length)return b;e=e[0];c=m.clone(e);c.dimensions=[];d.forEach(function(f){var g=e.dimensions.filter(function(u){return f.dimensionName===u.name}.bind(this));if(g&&0!==g.length){var h=(g=g[0])&&g.values,k=0,l=1,n=f.values&&f.values.length;switch(f.values&&f.values[0].length||n){case 1:k=h.indexOf(f.values[0]);l=k+1;break;case 2:k=h.indexOf(f.values[0][0]),l=h.indexOf(f.values[0][1])+1}h=h.slice(k,l);g.values=h;c.dimensions.push(g)}else c.dimensions=m.clone(e.dimensions)}.bind(this));b.variables=
[c]}return b},getRecurrentIntervalName:Q,getCorrespondingDimensionRange:function(a,b){var c="StdTime"===a.name,d=c&&"string"===typeof b?w(b):b,e=a.values.filter(function(f){return f[0]===d})[0];return"object"===typeof e&&c?e.map(function(f){return D(f)}):e},getFormattedDateString:D,parseFormattedDateString:w,getVariables:function(a){var b=a.selectedVariables,c=void 0===b?[]:b;return a.multiDimensionalData.variables.filter(function(d){var e=c.some(function(f){return"string"===typeof f?f===d.name:f.value===
d.name}.bind(this));return c.length?e:!0}.bind(this))},getDimensions:function(a){var b=a.variables;a=a.selectedDimension;var c=void 0===a?"":a;return(void 0===b?[]:b).reduce(function(d,e){var f=e.dimensions.filter(function(g){return c?g.name===c:!0}.bind(this));return f.length?H(d,f):d}.bind(this),[])},getFormattedDimensionValues:function(a){var b=[];a.forEach(function(c){var d=c.hasRanges,e=c.recurring,f;c.values.forEach(function(g){var h=m.clone(g);d||(h=[h]);"StdTime"===c.name&&(h=h.map(function(k){return e?
Q(k,c.interval,c.intervalUnit):D(Number(k))}.bind(this)));h=d?h.join(" \u2014 "):h.join("");f={label:h,value:e?d?g.join(" \u2014 "):g.toString():h,selected:!1,disabled:!1};da(b,f)||b.push(f)}.bind(this))}.bind(this));return b},dimensionHasRanges:function(a){var b=!1;0<a.length&&(b=a[0].hasRanges);return b},getFormattedDimensionRanges:function(a){var b=[],c=[];a.forEach(function(d){d=d.label.split(" \u2014 ");b.push({label:d[0],value:d[0],selected:!1,disabled:!1});c.push({label:d[1],value:d[1],selected:!1,
disabled:!1})});return{min:b,max:c}},applyMultidimensionalDefinitionFilter:function(a,b){var c=b&&b.dimensions&&0<b.dimensions.length;b&&"BY_RANGES"===b.definitionType?c=c&&b.minValues&&0<b.minValues.length&&b.maxValues&&0<b.maxValues.length:b&&"BY_VALUES"===b.definitionType&&(c=c&&b.values&&0<b.values.length);if(!c)return a;c=m.clone(a);c.forEach(function(d){var e=d.hasRanges,f=[],g=0<=b.dimensions.indexOf(d.name);g||(f=d.values);g&&b.dimensions.forEach(function(h,k){if(h===d.name)switch(b.definitionType){case "BY_RANGES":var l=
b.minValues[k],n=b.maxValues[k];"StdTime"===d.name&&(l=w(l),n=w(n));"boolean"===typeof l||isNaN(l)||(l=Number(l));"boolean"===typeof n||isNaN(n)||(n=Number(n));var u=-1,A=-1;if(e)for(var v=0;v<d.values.length&&!(d.values[v][0]===l&&(u=v),d.values[v][1]===n&&(A=v+1),0<=u&&1<=A);v++);else u=d.values.indexOf(l),A=d.values.indexOf(n)+1;f=H(f,d.values.slice(u,A));break;case "BY_VALUES":var x=e?b.values[k].split(" \u2014 "):[b.values[k]];"StdTime"===d.name&&(x=x.map(function(p){return w(p)}.bind(this)));
l=d.values.filter(function(p){"boolean"===typeof p||isNaN(p)||(p=Number(p));return e?p.includes(x[0])&&p.includes(x[1]):x[0]==p}.bind(this));f=H(f,l)}}.bind(this));d.values=m.clone(f)}.bind(this));return c},mapObjectByProperty:function(a,b){return a.map(function(c){return c[b]}.bind(this))},removeDuplicatesFromArray:function(a){return a.filter(function(b,c,d){return d.indexOf(b)===c}.bind(this))},UIModifier:{show:function(a){a.classList.remove("hidden")},hide:function(a){a.classList.add("hidden")}},
isArrayEqual:function(a,b){return a&&b?a.length===b.length&&a.every(function(c){return 0<=b.indexOf(c)}.bind(this)):!1},makeComboboxSelection:function(a,b){var c=!1;a.forEach(function(d){d.value[0]===b?c=d.selected=!0:d.selected=!1});c||a.unshift({label:b,value:b,selected:!0,disabled:!0})},processRFTAsLayerInput:function(a){var b=esri.isDefined(esriGeowConfig.isMultiTenant)&&!1===esriGeowConfig.isMultiTenant,c=esriGeowConfig.self.helperServices.analysis&&esriGeowConfig.self.helperServices.analysis.url?
esriGeowConfig.self.helperServices.analysis.url:"";b=(b?c:c.replace("rasteranalysis","rasterutils")).replace("SpatialAnalysisTools/GPServer","RasterRendering/ImageServer");return new ca(b,{raster:JSON.stringify(a),type:"rft"})},getFunctionName:R,coerceEnumDataForCurrentEnv:function(a,b,c){if(!c)return b;var d={};d="multitenant"!==c?{ComputeChangeFunction:{Method:[3,4,5]}}:{ZonalStatistics:{statistics_type:["CIRCULAR_MEAN"]},ComputeChangeFunction:{Method:[3,4,5]}};c=R(a);for(var e in d)if(e===c){var f=
d[e],g;for(g in f){var h=f[g];a[g]&&(b=b.filter(function(k){return!(0<=h.indexOf(k.key))}.bind(this)))}}return b},createObjectMap:function(a){var b=function(c,d){var e=c[d];F(e)&&(void 0!==e._object_id&&G.set(e._object_id,e),E(e,b))};E(a,b)},processAllComponents:E,isDefinedObject:F,getReferencedObject:function(a){return G.has(a)?G.get(a):null}});m.setObject("dijit.RasterFunctionEditor.utils",y,I);return y});