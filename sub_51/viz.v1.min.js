!function(){function w(n){return n[0]}function b(n){return n[1]}function e(n){return n.height}function o(n){return n.width}function s(n){return n.height/2}function h(n){return n.width/2}function k(n){return n.key}function u(n){return n.value}function c(n){var t;return function(i){return arguments.length?(t=i,n):t}}function t(n,t){var i;return function(r){return arguments.length?(i=r,n):typeof i!="undefined"?i:t}}function d(n){while(n>r)n-=r;while(n<0)n+=r;return n}function l(n,t,i,r,u,f){if(u<=0||r<=0)return 0;var e=n.concat().sort(d3.ascending),c=r-e.length*t+(f?t:0),s=[],h=0,o=0;return d3.range(e.length).forEach(function(n){o=(c-i*n)/(u-=e[n-1]||0);h+=e[n]*o<=i?1:0;s.push(o)}),s[h]}function a(n,t,i,r,u){var f=r,e=d3.sum(n),o=l(n,t,i,u-r,e,!1);return n.map(function(n){var r=o*n,u=(r<i?i:r)/2;return f+=2*u+t,{c:f-u,v:r,w:u,value:n,percent:n/(e||1)}})}function v(n){function t(n,t){return[n*Math.cos(t),n*Math.sin(t)]}var r=t(n[0],n[2]),u=t(n[0],n[3]),f=t(n[1],n[2]),e=t(n[1],n[3]);return["M",r,"A",n[0],n[0],"0",n[3]-n[2]>i?1:0,"1",u,"L",e,"A",n[1],n[1],"0",n[3]-n[2]>i?1:0,"0",f,"z"].join(" ")}function y(n,t,u,f,e,o){function l(n,t,r){return"A"+n+","+n+" 0 "+ +(r>i)+",1 "+t}function s(n,t){return[n*Math.cos(t),n*Math.sin(t)]}function c(n,t,u,f){var o,e,s;return u=u+(u<t?r:0),o=u-t,e=1-(o>i?r-o:o)/i,e=Math.pow(e,5),s=(u+t)/2-(u-t>i?i:0),"Q"+e*f*Math.cos(s)+","+e*f*Math.sin(s)+" "+n}var h=s(n,t),a=s(n,u),v=s(f,e),y=s(f,o);return"M"+h+l(n,a,u-t)+(t==e&&u==o?c(h,t,u,f):c(v,u,e,f)+l(f,y,o-e)+c(h,t,o,n))+"Z"}function p(n,t){ret=[];for(var i=t;i>t-n;i--)ret.push(i<0?i+n:i);return ret}var n={version:"1.1.8"},r=2*Math.PI,i=Math.PI,f=Math.PI/2;n.bP=function(){function n(o){t=o;o.each(function(){var t=d3.select(this),o=n.bars(),h=t.selectAll(".subBars").data(o.subBars).enter().append("g").attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).attr("class","subBars").append("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f),s;typeof e!="undefined"&&h.style("fill",function(n){return e(n)});s=t.selectAll(".edges").data(o.edges).enter().append("path").attr("class","edges").attr("d",function(n){return n.path}).style("fill-opacity",n.edgeOpacity());typeof e!="undefined"&&s.style("fill",function(n){return e(n)});t.selectAll(".mainBars").data(o.mainBars).enter().append("g").attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).attr("class","mainBars").append("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f).style("fill-opacity",0).on("mouseover",n.mouseover).on("mouseout",n.mouseout)})}function i(n){return-n.width}function r(n){return-n.height}function u(n){return 2*n.width}function f(n){return 2*n.height}var o,s,h,c,l,a,v,y,p,w,e,t,b,k,d,g,nt;return n.data=function(t){return arguments.length?(w=t,n):w},n.fill=function(t){return arguments.length?(e=t,n):e},n.keyPrimary=function(t){return arguments.length?(o=t,n):typeof o!="undefined"?o:function(n){return n[0]}},n.sortPrimary=function(t){return arguments.length?(d=t,n):typeof d!="undefined"?d:d3.ascending},n.keySecondary=function(t){return arguments.length?(s=t,n):typeof s!="undefined"?s:function(n){return n[1]}},n.sortSecondary=function(t){return arguments.length?(g=t,n):typeof g!="undefined"?g:d3.ascending},n.value=function(t){return arguments.length?(h=t,n):typeof h!="undefined"?h:function(n){return n[2]}},n.width=function(t){return arguments.length?(c=t,n):typeof c!="undefined"?c:400},n.height=function(t){return arguments.length?(l=t,n):typeof l!="undefined"?l:600},n.barSize=function(t){return arguments.length?(v=t,n):typeof v!="undefined"?v:35},n.min=function(t){return arguments.length?(y=t,n):typeof y!="undefined"?y:0},n.orient=function(t){return arguments.length?(a=t,n):typeof a!="undefined"?a:"vertical"},n.pad=function(t){return arguments.length?(p=t,n):typeof p!="undefined"?p:0},n.duration=function(t){return arguments.length?(k=t,n):typeof k!="undefined"?k:500},n.edgeOpacity=function(t){return arguments.length?(b=t,n):typeof b!="undefined"?b:.4},n.edgeMode=function(t){return arguments.length?(nt=t,n):typeof nt!="undefined"?nt:"curved"},n.bars=function(t){function f(n,i){return typeof t=="undefined"||t.part===i||h[t.part](n)===t.key}function c(){var t=n.min()/2;r.primary.forEach(function(n){n.height<t&&(n.height=t)});r.secondary.forEach(function(n){n.height<t&&(n.height=t)})}function e(t){function h(i){return f(i,t)?n.value()(i):0}var o=d3.nest().key(t=="primary"?n.keyPrimary():n.keySecondary()).sortKeys(t=="primary"?n.sortPrimary():n.sortSecondary()).rollup(function(n){return d3.sum(n,h)}).entries(n.data()),u=s(o,n.pad(),n.min(),0,i=="vertical"?n.height():n.width()),e=n.barSize();o.forEach(function(f,o){r[t].push({x:i=="horizontal"?(u[o].s+u[o].e)/2:t=="primary"?e/2:n.width()-e/2,y:i=="vertical"?(u[o].s+u[o].e)/2:t=="primary"?e/2:n.height()-e/2,height:i=="vertical"?(u[o].e-u[o].s)/2:e/2,width:i=="horizontal"?(u[o].e-u[o].s)/2:e/2,part:t,key:f.key,value:f.value,percent:u[o].p})})}function o(t){function e(i){return f(i,t)?n.value()(i):0}var c=t=="primary"?function(t,i){return n.sortPrimary()(t.key,i.key)}:function(t,i){return n.sortSecondary()(t.key,i.key)},o=d3.map(r[t],function(n){return n.key}),h=d3.nest().key(t=="primary"?n.keyPrimary():n.keySecondary()).sortKeys(t=="primary"?n.sortPrimary():n.sortSecondary()).key(t=="secondary"?n.keyPrimary():n.keySecondary()).sortKeys(t=="secondary"?n.sortPrimary():n.sortSecondary()).rollup(function(n){return d3.sum(n,e)}).entries(n.data());h.forEach(function(r){var f=o.get(r.key),e=s(r.values,0,0,i=="vertical"?f.y-f.height:f.x-f.width,i=="vertical"?f.y+f.height:f.x+f.width),h=n.barSize();r.values.forEach(function(o,s){u[t].push({x:i=="vertical"?t=="primary"?h/2:n.width()-h/2:(e[s].s+e[s].e)/2,y:i=="horizontal"?t=="primary"?h/2:n.height()-h/2:(e[s].s+e[s].e)/2,height:(i=="vertical"?e[s].e-e[s].s:h)/2,width:(i=="horizontal"?e[s].e-e[s].s:h)/2,part:t,primary:t=="primary"?r.key:o.key,secondary:t=="primary"?o.key:r.key,value:o.value,percent:e[s].p*f.percent,index:t=="primary"?r.key+"|"+o.key:o.key+"|"+r.key})})})}function l(){function f(n,i,r,u,f,e,o,s){if(t=="straight")return["M",n,",",i,"L",r,",",u,"L",f,",",e,"L",o,",",s,"z"].join("");var h=(n+r)/2,c=(f+o)/2;return["M",n,",",i,"C",h,",",i," ",h,",",u,",",r,",",u,"L",f,",",e,"C",c,",",e," ",c,",",s,",",o,",",s,"z"].join("")}function e(n,i,r,u,f,e,o,s){if(t=="straight")return["M",n,",",i,"L",r,",",u,"L",f,",",e,"L",o,",",s,"z"].join("");var h=(i+u)/2,c=(e+s)/2;return["M",n,",",i,"C",n,",",h," ",r,",",h,",",r,",",u,"L",f,",",e,"C",f,",",c," ",o,",",c,",",o,",",s,"z"].join("")}var r=d3.map(u.secondary,function(n){return n.index}),t=n.edgeMode();return u.primary.map(function(n){var t=r.get(n.index);return{path:i==="vertical"?f(n.x+n.width,n.y+n.height,t.x-t.width,t.y+t.height,t.x-t.width,t.y-t.height,n.x+n.width,n.y-n.height):e(n.x-n.width,n.y+n.height,t.x-t.width,t.y-t.height,t.x+t.width,t.y-t.height,n.x+n.width,n.y+n.height),primary:n.primary,secondary:n.secondary,value:n.value,percent:n.percent}})}function s(n,t,i,r,u){var c=i/(u-r-2*n.length*t),o=0,s=0,f=d3.sum(n,function(n){return n.value});n.forEach(function(n){n.value<c*f&&(o+=1,s+=n.value)});var l=f<1e-5?0:(u-r-2*n.length*t-o*i)/(f-s),e=r,h=[];return n.forEach(function(n){var r=n.value*l;h.push({s:e+t+(r<i?.5*(i-r):0),e:e+t+(r<i?.5*(i+r):r),p:f<1e-5?0:n.value/f});e+=2*t+(r<i?i:r)}),h}var r={primary:[],secondary:[]},u={primary:[],secondary:[]},h={primary:n.keyPrimary(),secondary:n.keySecondary()},i=n.orient();return e("primary"),e("secondary"),o("primary"),o("secondary"),c(),{mainBars:r.primary.concat(r.secondary),subBars:u.primary.concat(u.secondary),edges:l()}},n.update=function(e){w=e;var o=n.bars(),s=n.duration();t.selectAll(".subBars").data(o.subBars).transition().duration(s).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f);t.selectAll(".edges").data(o.edges).transition().duration(s).attr("d",function(n){return n.path}).style("fill-opacity",n.edgeOpacity());t.selectAll(".mainBars").data(o.mainBars).transition().duration(s).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f).style("fill-opacity",0)},n.mouseover=function(e){var o=n.bars(e),s;t.selectAll(".mainBars").filter(function(n){return n.part===e.part&&n.key===e.key}).select("rect").style("stroke-opacity",1);t.selectAll(".subBars").data(o.subBars).transition().duration(n.duration()).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f);s=t.selectAll(".edges").data(o.edges);s.filter(function(n){return n[e.part]===e.key}).transition().duration(n.duration()).style("fill-opacity",n.edgeOpacity()).attr("d",function(n){return n.path});s.filter(function(n){return n[e.part]!==e.key}).transition().duration(n.duration()).style("fill-opacity",0).attr("d",function(n){return n.path});t.selectAll(".mainBars").data(o.mainBars).transition().duration(n.duration()).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f)},n.mouseout=function(e){var o=n.bars();t.selectAll(".mainBars").filter(function(n){return n.part===e.part&&n.key===e.key}).select("rect").style("stroke-opacity",0);t.selectAll(".subBars").data(o.subBars).transition().duration(n.duration()).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f);t.selectAll(".edges").data(o.edges).transition().duration(n.duration()).style("fill-opacity",n.edgeOpacity()).attr("d",function(n){return n.path});t.selectAll(".mainBars").data(o.mainBars).transition().duration(n.duration()).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).select("rect").attr("x",i).attr("y",r).attr("width",u).attr("height",f)},n};n.gg=function(){function t(n){p=n;n.each(function(){var e=d3.select(this),o=t.scale(),c=t.minorTickStart(),l=t.minorTickEnd(),a=t.majorTickStart(),v=t.majorTickEnd(),y=t.ticks(),s=t.majorTicks(),p=t.labelLocation(),f=t.outerRadius(),w,n,h;e.append("circle").attr("r",f).style("fill","url(#vizgg3"+u+")").attr("class","face");e.append("circle").attr("r",t.innerRadius()).style("fill","url(#vizgg2"+u+")").style("filter","url(#vizgg5"+u+")").attr("class","innerFace");w=e.append("g");w.selectAll("line").data(y).enter().append("line").attr("class",function(n){return s(n)?"majorTicks":"minorTicks"}).attr("x1",function(n){return f*(s(n)?a:c)*Math.cos(o(n))}).attr("y1",function(n){return f*(s(n)?a:c)*Math.sin(o(n))}).attr("x2",function(n){return f*(s(n)?v:l)*Math.cos(o(n))}).attr("y2",function(n){return f*(s(n)?v:l)*Math.sin(o(n))});e.selectAll("text").data(y.filter(s)).enter().append("text").attr("class","label").attr("x",function(n){return f*p*Math.cos(o(n))}).attr("y",function(n){return f*p*Math.sin(o(n))}).attr("dy",3).text(function(n){return n});n=t.outerRadius()/r.outerRadius;h=t.scale()(t.value())*180/i+90;e.append("g").attr("transform","translate(1,1)").selectAll(".needleshadow").data([0]).enter().append("g").attr("transform","rotate("+h+")").attr("class","needleshadow").append("path").attr("d",["m 0",-130*n,5*n,175*n,-10*n,"0,z"].join(",")).style("filter","url(#vizgg6"+u+")");e.selectAll(".needle").data([0]).enter().append("g").attr("transform","rotate("+h+")").attr("class","needle").append("polygon").attr("points",[-.5*n,-130*n,.5*n,-130*n,5*n,45*n,-5*n,45*n].join(",")).style("fill","url(#vizgg4"+u+")")})}var f,e,o,s,h,c,l,a,v,y,p,u,w,b,k,d,g,nt,tt,r={innerRadius:20,outerRadius:150,angleOffset:.7,startAngle:-1.5*i,endAngle:.5*i,minorTickStart:.9,minorTickEnd:.95,majorTickStart:.82,majorTickEnd:.95,needleColor:"#de2c2c",innerFaceColor:"#999999",faceColor:"#666666",domain:[0,100],duration:500,ease:"cubicInOut",ticks:d3.range(0,101,2),majorTicks:function(n){return n%10==0},labelLocation:.7};return t.scale=function(){return d3.scale.linear().domain(t.domain()).range([r.startAngle+t.angleOffset(),r.endAngle-t.angleOffset()])},t.innerRadius=function(n){return arguments.length?(f=n,t):typeof f!="undefined"?f:r.innerRadius},t.outerRadius=function(n){return arguments.length?(e=n,t):typeof e!="undefined"?e:r.outerRadius},t.angleOffset=function(n){return arguments.length?(a=n,t):typeof a!="undefined"?a:r.angleOffset},t.labelLocation=function(n){return arguments.length?(tt=n,t):typeof tt!="undefined"?tt:r.labelLocation},t.ticks=function(n){return arguments.length?(w=n,t):typeof w!="undefined"?w:r.ticks},t.majorTicks=function(n){return arguments.length?(b=n,t):typeof b!="undefined"?b:r.majorTicks},t.minorTickStart=function(n){return arguments.length?(k=n,t):typeof k!="undefined"?k:r.minorTickStart},t.minorTickEnd=function(n){return arguments.length?(d=n,t):typeof d!="undefined"?d:r.minorTickEnd},t.majorTickStart=function(n){return arguments.length?(g=n,t):typeof g!="undefined"?g:r.majorTickStart},t.majorTickEnd=function(n){return arguments.length?(nt=n,t):typeof nt!="undefined"?nt:r.majorTickEnd},t.needleColor=function(n){return arguments.length?(o=n,t):typeof o!="undefined"?o:r.needleColor},t.innerFaceColor=function(n){return arguments.length?(s=n,t):typeof s!="undefined"?s:r.innerFaceColor},t.faceColor=function(n){return arguments.length?(h=n,t):typeof h!="undefined"?h:r.faceColor},t.domain=function(n){return arguments.length?(c=n,t):typeof c!="undefined"?c:r.domain},t.duration=function(n){return arguments.length?(v=n,t):typeof v!="undefined"?v:r.duration},t.ease=function(n){return arguments.length?(y=n,t):typeof y!="undefined"?y:r.ease},t.value=function(n){return arguments.length?(l=n,t):typeof l!="undefined"?l:.5*(r.domain[0]+r.domain[1])},t.defs=function(i,r){var f=i.append("defs"),o,s,e,v;u=r;var h=t.needleColor(),c=t.innerFaceColor(),l=t.faceColor(),a=n.defs(f).lG().id("vizgg1"+r).sel();n.defs(a).stop().offset("0").stopColor(h);n.defs(a).stop().offset("1").stopColor(d3.rgb(h).darker(1));o=n.defs(f).rG().id("vizgg2"+r).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();n.defs(o).stop().offset("0").stopColor(c);n.defs(o).stop().offset("1").stopColor(d3.rgb(c).darker(2));s=n.defs(f).rG().id("vizgg3"+r).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();n.defs(s).stop().offset("0").stopColor(l);n.defs(s).stop().offset("1").stopColor(d3.rgb(l).darker(2));n.defs(f).lG().id("vizgg4"+r).gradientUnits("userSpaceOnUse").y1("80").x1("-10").y2("80").x2("10").xlink("#vizgg1"+r);e=n.defs(f).filter().id("vizgg5"+r).sel();n.defs(e).feFlood().result("flood").floodColor("rgb(0,0,0)").floodOpacity("0.6");n.defs(e).feComposite().result("composite1").operator("in").in2("SourceGraphic").in("flood");n.defs(e).feGaussianBlur().result("blur").stdDeviation("2").in("composite1");n.defs(e).feOffset().result("offset").dy("2").dx("2");n.defs(e).feComposite().result("composite2").operator("over").in2("offset").in("SourceGraphic");v=n.defs(f).filter().x("-0.3").y("-0.3").height("1.8").width("1.8").id("vizgg6"+r).sel();n.defs(v).feGaussianBlur().stdDeviation("2")},t.setNeedle=function(n){function e(n,t){return d3.interpolateString("rotate("+n+")","rotate("+t+")")}var r=t.scale()(n)*180/i+90,u=t.scale()(t.value())*180/i+90,f=t.ease();p.selectAll(".needle").data([n]).transition().duration(t.duration()).attrTween("transform",function(){return e(u,r)}).ease(f);p.selectAll(".needleshadow").data([n]).transition().duration(t.duration()).attrTween("transform",function(){return e(u,r)}).ease(f).each("end",function(){angle=n});t.value(n)},t};n.ch=function(){function n(t){function i(n){return v([h,ft,n.startAngle,n.endAngle])}function u(n){return y(h,n.startAngle,n.endAngle,h,n.endStartAngle,n.endEndAngle)}ht=t;w||ct();t.each(function(){var t=d3.select(this),e=t.selectAll(".groups").data(o).enter().append("g").attr("class","groups").on("mouseover",n.mouseover).on("mouseout",n.mouseout),h=e.append("text").attr("class","label"),s=(1+n.labelPadding())*n.outerRadius(),l=n.label();h.filter(function(n){return n.type=="g"}).attr("x",function(n){return s*Math.cos(c(n))}).attr("y",function(n){return s*Math.sin(c(n))}).text(l).style("text-anchor",function(n){var t=c(n);return t<f||t>r-f?"start":"end"}).each(function(n){this._current=n});e.append("path").style("fill",function(n){return b(n.source)}).style("stroke",function(n){return b(n.source)}).attr("d",i).each(function(n){this._current=n}).filter(function(n){return n.type=="g"});t.append("g").attr("class","chords").selectAll(".chord").data(w).enter().append("g").attr("class","chord").append("path").each(function(n){this._current=n}).attr("d",u).style("fill",function(n){return b(n.target)}).style("opacity",n.chordOpacity()).style("stroke",function(n){return b(n.target)}).style("display",function(n){return n.display?"inline":"none"})})}function pt(t){function o(n){return v([h,ft,n.startAngle,n.endAngle])}function l(n){return y(h,n.startAngle,n.endAngle,h,n.endStartAngle,n.endEndAngle)}function a(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return l(t(n))}}function p(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return o(t(n),n)}}function w(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return u*Math.cos(c(t(n)))}}function b(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return u*Math.sin(c(t(n)))}}var i=ht.selectAll(".groups").data(t?s:n.groups()),u=(1+n.labelPadding())*n.outerRadius(),k=n.label(),e;i.select("path").transition().duration(tt).attrTween("d",p);i.select(".label").filter(function(n){return n.type=="g"}).transition().duration(tt).attrTween("x",w).attrTween("y",b).text(k).style("text-anchor",function(n){var t=c(n);return t<f||t>r-f?"start":"end"});e=n.chordOpacity();ht.select(".chords").selectAll(".chord").data(t?it:n.chords()).select("path").transition().duration(tt).attrTween("d",a).style("opacity",function(n){return n.display?e:0})}function c(n){return d((n.startAngle+n.endAngle)/2)}function ct(){t=[];et.forEach(function(n){t.indexOf(g(n))==-1&&t.push(g(n));t.indexOf(nt(n))==-1&&t.push(nt(n))});t=t.sort(st);e={};k={};t.forEach(function(n){e[n]={};k[n]={};t.forEach(function(t){e[n][t]=0;k[n][t]=!1})});et.forEach(function(n){var t=g(n),i=nt(n);e[t][i]+=ot(n);k[t][i]=!0});o=[];t.forEach(function(n,i){o.push({source:n,type:"gs",value:0,skipPad:!0,index:i});o.push({source:n,type:"g",value:d3.sum(t,function(t){return e[n][t]}),skipPad:!1,index:i})});wt(o,rt,yt,undefined,ut);w=[];o.filter(function(n){return n.type=="g"}).forEach(function(n,i){var r=p(t.length,i),u=a(r.map(function(i){return e[n.source][t[i]]}),0,0,n.startAngle,n.endAngle);r.forEach(function(r,f){var e=u[f];w.push({startAngle:e.c-e.v/2,endAngle:e.c+e.v/2,value:e.value,source:n.source,target:t[r],type:"c",display:k[n.source][t[r]],index:i,subindex:r,indexsubindex:i+"-"+r})})});var n=d3.map(w,function(n){return n.indexsubindex});w.forEach(function(t){if(t.subindex==t.index){t.endStartAngle=t.startAngle;t.endEndAngle=t.startAngle;return}var i=n.get(t.subindex+"-"+t.index);t.endStartAngle=i.startAngle;t.endEndAngle=i.startAngle});u=!1}function bt(n){function u(n){return n.endAngle+n.startAngle}var i=o.filter(function(t){return t.source==n&&t.type=="g"})[0],f,h,c;s=[];t.forEach(function(t,r){s.push({source:t,startAngle:i.startAngle,endAngle:i.endAngle,padAngle:i.padAngle,percent:i.percent,type:"gs",value:t==n?e[t][t]:0,skipPad:t==n&&k[t][t]?!1:!0,index:r});t==n?s.push({source:t,startAngle:i.startAngle,endAngle:i.endAngle,padAngle:i.padAngle,percent:i.percent,type:"g",value:i.value,skipPad:!1,index:r}):s.push({source:t,type:"g",value:e[n][t],skipPad:!1,index:r})});wt(s,rt,yt,n,ut);f=u(i);o.forEach(function(n,t){var i=s[t],e=u(n)<f;i.startAngle-=e?r:0;i.endAngle-=e?r:0});it=[];s.filter(function(n){return n.type=="g"}).forEach(function(i,r){var u=p(t.length,r),f=u.map(function(r){var u=t[r];return i.source==n?e[i.source][u]:u==n?e[u][i.source]:0}),o=a(f,0,0,i.startAngle,i.endAngle);u.forEach(function(u,f){var e=o[f];it.push({startAngle:e.c-e.v/2,endAngle:e.c+e.v/2,value:e.value,source:i.source,target:t[u],type:"c",display:i.source===n,index:r,subindex:u,indexsubindex:r+"-"+u})})});h=d3.map(it.map(function(n){return{startAngle:n.startAngle,endAngle:n.endAngle,indexsubindex:n.indexsubindex}}),function(n){return n.indexsubindex});c=d3.map(s.filter(function(n){return n.type=="gs"}),function(n){return n.source});it.forEach(function(t){var i,r;if(t.subindex==t.index){i=c.get(t.source);t.endStartAngle=i.startAngle;t.endEndAngle=i.endAngle;return}r=h.get(t.subindex+"-"+t.index);t.endStartAngle=r.startAngle;t.endEndAngle=r.endAngle;t.source!==n&&(t.startAngle=t.endAngle,t.endEndAngle=t.endStartAngle)})}function wt(n,t,i,r,u){var e=r!==undefined,f=0,s,o;if(e){for(s=!1;f<n.length;f++)if(n[f].source==r&&n[f].type=="g"){s=!0;break}s||console.log("The fixed source '"+r+"' is not a valid key")}o=d3.range(n.length);e&&(o=o.slice(f).concat(o.slice(0,f)));var c=n.filter(function(n){return(!e||n.source!==r||n.type!="g")&&!n.skipPad}).map(function(n){return n.value}),a=2*Math.PI-(e?n[f].endAngle-n[f].startAngle+2*t:0),h=e?n[f].endAngle+t:u,v=d3.sum(c),y=l(c,t,i,a<=0?0:a,v,e?!0:!1);o.slice(e?1:0).forEach(function(r){var u=y*n[r].value,f=(u<i?i-u:0)/2;n[r].startAngle=h;n[r].endAngle=h+u;n[r].padAngle=f;n[r].percent=n[r].value/(v||1);h+=u+f+(n[r].skipPad?0:t)})}var g=function(n){return n[0]},nt=function(n){return n[1]},ot=function(n){return n[2]},lt=function(n){return n.source+" ("+n.value+")"},st=d3.ascending,rt=.03,ut=0,h=180,ft=200,at=.7,vt=.02,yt=0,tt=500,u=!0,ht,et,b,t,e,k,o,w,s,it;return n.data=function(t){return arguments.length?(et=t,u=!0,n):et},n.fill=function(t){return arguments.length?(b=t,n):b},n.duration=function(t){return arguments.length?(tt=t,n):tt},n.chordOpacity=function(t){return arguments.length?(at=t,n):at},n.innerRadius=function(t){return arguments.length?(h=t,u=!0,n):h},n.outerRadius=function(t){return arguments.length?(ft=t,u=!0,n):ft},n.source=function(t){return arguments.length?(g=t,u=!0,n):g},n.target=function(t){return arguments.length?(nt=t,u=!0,n):nt},n.value=function(t){return arguments.length?(ot=t,u=!0,n):ot},n.padding=function(t){return arguments.length?(rt=t,u=!0,n):rt},n.labelPadding=function(t){return arguments.length?(vt=t,n):vt},n.sort=function(t){return arguments.length?(st=t,u=!0,n):st},n.startAngle=function(t){return arguments.length?(ut=t,u=!0,n):ut},n.chords=function(){return u&&ct(),w},n.groups=function(){return u&&ct(),o},n.label=function(t){return arguments.length?(lt=t,n):lt},n.mouseover=function(n){bt(n.source);pt(1)},n.mouseout=function(){pt(0)},n};n.defs=function(n){var t={},i=n;return t.sel=function(){return i},t.lG=function(){return i=i.append("linearGradient"),t},t.rG=function(){return i=i.append("radialGradient"),t},t.stop=function(){return i=i.append("stop"),t},t.filter=function(){return i=i.append("filter"),t},t.feFlood=function(){return i=i.append("feFlood"),t},t.feComposite=function(){return i=i.append("feComposite"),t},t.feOffset=function(){return i=i.append("feOffset"),t},t.feGaussianBlur=function(){return i=i.append("feGaussianBlur"),t},t.result=function(n){return i=i.attr("result",n),t},t.floodColor=function(n){return i=i.attr("flood-color",n),t},t.floodOpacity=function(n){return i=i.attr("flood-opacity",n),t},t.stdDeviation=function(n){return i=i.attr("stdDeviation",n),t},t.operator=function(n){return i=i.attr("operator",n),t},t.height=function(n){return i=i.attr("height",n),t},t.width=function(n){return i=i.attr("width",n),t},t.in=function(n){return i=i.attr("in",n),t},t.in2=function(n){return i=i.attr("in2",n),t},t.id=function(n){return i=i.attr("id",n),t},t.fx=function(n){return i=i.attr("fx",n),t},t.fy=function(n){return i=i.attr("fy",n),t},t.dx=function(n){return i=i.attr("dx",n),t},t.dy=function(n){return i=i.attr("dy",n),t},t.x1=function(n){return i=i.attr("x1",n),t},t.y1=function(n){return i=i.attr("y1",n),t},t.x2=function(n){return i=i.attr("x2",n),t},t.y2=function(n){return i=i.attr("y2",n),t},t.x=function(n){return i=i.attr("x",n),t},t.y=function(n){return i=i.attr("y",n),t},t.r=function(n){return i=i.attr("r",n),t},t.spreadMethod=function(n){return i=i.attr("spreadMethod",n),t},t.gradientUnits=function(n){return i=i.attr("gradientUnits",n),t},t.xlink=function(n){return i=i.attr("xlink:href",n),t},t.offset=function(n){return i=i.attr("offset",n),t},t.stopColor=function(n){return i=i.attr("stop-color",n),t},t.path=function(){return i=i.append("path"),t},t.d=function(n){return i=i.attr("d",n),t},t};n.bar=function(){function n(t){g=t;t.each(function(){var l=d3.select(this),a=n.bars(),i=n.dock(),y=i=="t",p=i=="b",w=i=="l",b=i=="r",r=i=="t"||i=="b",u=l.selectAll(".primarybars").data(a).enter().append("g").attr("class","primaryBars").attr("transform",function(n){return"translate("+n.x+","+n.y+")"}),f=u.selectAll(".secondaryBars").data(function(n){return n.values}).enter().append("g").attr("class","secondaryBars").attr("transform",function(n){return"translate("+n.x+","+n.y+")"}),c=n.fill(),v=f.append("rect").attr("width",o).attr("height",e),t=n.paddingLabel();c!==undefined&&v.style("fill",c);u.append("text").attr("class","primaryvalue").attr("x",function(n){return n.wf*n.width}).attr("y",function(n){return n.hf*n.height}).attr("dx",function(n){return 2*t*(n.wf-.5)}).attr("dy",function(n){return r?n.hf?3*t:-t:t}).style("text-anchor",function(n){return r?"middle":n.wf?"start":"end"}).text(n.valuePrimary());u.append("text").attr("class","primarykey").attr("x",function(n){return(1-n.wf)*n.width}).attr("y",function(n){return(1-n.hf)*n.height}).attr("dx",function(n){return r?0:n.wf?-t:t}).attr("dy",function(n){return r?n.hf?-t:3*t:t}).style("text-anchor",function(n){return r?"middle":n.wf?"end":"start"}).text(k);f.append("text").attr("class","secondaryvalue").attr("x",h).attr("y",s).attr("dy",t).text(n.valueSecondary()).style("text-anchor","middle")})}function i(){var i=n.keySecondary()===undefined,t=d3.nest().key(n.keyPrimary()).sortKeys(n.sortPrimary()),r;return i||(t=t.key(n.keySecondary()).sortKeys(n.sortSecondary())),r=n.value(),t=t.rollup(function(n){return d3.sum(n,r)}).entries(n.data()),i&&t.forEach(function(n){n.values=[{value:n.value}];delete n.value}),t}return n.data=c(n),n.width=t(n,400),n.height=t(n,400),n.dock=t(n,"b"),n.fill=t(n,undefined),n.paddingInner=t(n,.1),n.paddingOuter=t(n,.1),n.paddingLabel=t(n,6),n.value=t(n,b),n.keyPrimary=t(n,w),n.keySecondary=t(n,undefined),n.sortPrimary=t(n,d3.ascending),n.sortSecondary=t(n,d3.ascending),n.valuePrimary=t(n,u),n.valueSecondary=t(n,u),n.valueDomain=t(n,undefined),n.primaryKeys=function(){return d3.set(data,n.keyPrimary()).values().sort(n.sortPrimary())},n.keyScale=function(){var t=n.dock(),i={l:n.height(),r:n.height(),t:n.width(),b:n.width()};return d3.scaleBand().domain(n.primaryKeys()).range([0,i[t]]).paddingInner(n.paddingInner()).paddingOuter(n.paddingOuter())},n.valueScale=function(){var t=n.dock(),s=t=="b",h=t=="l",c=t=="r",f=n.height(),e=n.width(),l=h?[0,e]:c?[e,0]:s?[f,0]:[0,f],r=n.valueDomain();if(r==undefined){var o=i(),a=d3.min(o,function(n){return d3.sum(n.values,u)}),v=d3.max(o,function(n){return d3.sum(n.values,u)});r=[Math.min(0,a),v]}return d3.scaleLinear().domain(r).range(l)},n.bars=function(){var d=n.data(),l=n.height(),a=n.width(),r=n.dock(),g=r=="t",s=r=="b",v=r=="l",y=r=="r",t=r=="t"||r=="b",f=i(),h=n.keyScale(),c=n.valueDomain(),k=v?[0,a]:y?[a,0]:s?[l,0]:[0,l],p,w;c==undefined&&(p=d3.min(f,function(n){return d3.sum(n.values,u)}),w=d3.max(f,function(n){return d3.sum(n.values,u)}),c=[Math.min(0,p),w]);var e=d3.scaleLinear().domain(c).range(k),o=h.bandwidth(),b=e(0);return f.forEach(function(n){var i;n.value=d3.sum(n.values,u);var r=e(n.value),f=Math.abs(r-b),c=Math.min(b,r);n.width=t?o:f;n.height=t?f:o;n.x=t?h(n.key):c;n.y=t?c:h(n.key);n.wf=t?.5:v?n.value<0?0:1:n.value<0?1:0;n.hf=t?s?n.value<0?1:0:n.value<0?0:1:.5;i=s?0:y?0:0;n.values.forEach(function(r){r.primaryKey=n.key;r.secondaryKey=r.key;delete r.key;var u=e(i),f=e(i+=r.value),s=Math.abs(f-u),h=Math.min(u,f);r.width=t?o:s;r.height=t?s:o;r.x=t?0:h-n.x;r.y=t?h-n.y:0})}),f},n};n.lg=function(){function n(t){g=t;t.each(function(){var h=d3.select(this),t=n.rows(),i=n.data(),f;t=t==undefined?i.length:Math.min(t,i.length);var r=Math.ceil(i.length/t),e=d3.scaleBand().domain(d3.range(t)).range([0,n.height()]).paddingInner(n.paddingInner()),o=d3.scaleBand().domain(d3.range(r)).range([0,n.width()]),s=n.size(),c=e.bandwidth(),v=o.bandwidth(),l=n.paddingLabel(),a=d3.range(i.length).map(function(n){var t=n%r,u=(n-t)/r;return{x:o(t),y:e(u),width:s,height:c,key:i[n]}}),u=h.selectAll(".legendg").data(a,function(n){return n.key}).enter().append("g").attr("class","legendg").attr("transform",function(n){return"translate("+n.x+","+n.y+")"});u.append("text").attr("x",function(){return s+l}).attr("y",function(n){return n.height/2}).attr("dy",6).text(function(n){return n.key});u.each(n.draw());f=n.fill();f!==undefined&&u.selectAll(".legend-icon").style("fill",f)})}return n.data=c(n),n.rows=t(n,undefined),n.width=t(n,100),n.height=t(n,200),n.paddingInner=t(n,.1),n.paddingLabel=t(n,6),n.size=t(n,12),n.fill=t(n,undefined),n.rect=function(){d3.select(this).append("rect").attr("class","legend-icon").attr("height",e).attr("width",o)},n.circle=function(n){d3.select(this).append("circle").attr("class","legend-icon").attr("r",Math.min(n.height,n.width)).attr("cx",h).attr("cy",s)},n.draw=t(n,n.rect),n};this.viz=n}();