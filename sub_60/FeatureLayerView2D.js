// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.24/esri/copyright.txt for details.//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/arrayUtils ./core/has ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass".split(" "),function(f,h,g,k,E,w,B,m){g=function(n){function z(){var A=n.apply(this,arguments)||this;A.isAggregate=!0;return A}f._inheritsLoose(z,n);var l=z.prototype;l.getEffectivePopupTemplate=function(A){return this.popupTemplate?
this.popupTemplate:(A=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in A&&A.popupEnabled?A.popupTemplate:null};l.getObjectId=function(){return this.objectId};return z}(g);h.__decorate([k.property({type:Boolean})],g.prototype,"isAggregate",void 0);h.__decorate([k.property({type:[String,Number],json:{read:!0}})],g.prototype,"objectId",void 0);return g=h.__decorate([m.subclass("esri.AggregateGraphic")],g)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),
function(f,h,g,k,E,w,B,m,n,z){g=function(l){function A(c){var e=l.call(this,c)||this;e._filter=null;e.duration=k("mapview-transitions-duration");e._excludedEffectView=new z.EffectView(c);e._includedEffectView=new z.EffectView(c);return e}f._inheritsLoose(A,l);var u=A.prototype;u.transitionStep=function(c,e){this._set("scale",e);this.transitioning?(this._includedEffectView.transitionStep(c,e),this._excludedEffectView.transitionStep(c,e),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=
e,this._includedEffectView.scale=e)};u.end=function(){this._includedEffectView.end();this._excludedEffectView.end();this._filter=null};u._transitionTo=function(c){const e=this._get("featureEffect");c=E.unwrap(c);const q=E.unwrap(null==c?void 0:c.includedEffect),r=E.unwrap(null==c?void 0:c.excludedEffect),G=this._includedEffectView.canTransitionTo(q)&&this._excludedEffectView.canTransitionTo(r);this._includedEffectView.effect=q;this._excludedEffectView.effect=r;this._set("featureEffect",c);this._filter=
(null==c?void 0:c.filter)||(null==e?void 0:e.filter)||null;G||this.end()};f._createClass(A,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(c){this._get("featureEffect")!==c&&this._transitionTo(c)}},{key:"filter",get:function(){var c;return this._filter||(null==(c=E.unwrap(this.featureEffect))?void 0:c.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},
{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(c){this._set("scale",c);this._excludedEffectView.scale=c;this._includedEffectView.scale=c}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}}]);return A}(g);h.__decorate([w.property()],g.prototype,"_filter",void 0);h.__decorate([w.property()],g.prototype,"_excludedEffectView",void 0);h.__decorate([w.property()],g.prototype,
"_includedEffectView",void 0);h.__decorate([w.property()],g.prototype,"duration",void 0);h.__decorate([w.property()],g.prototype,"excludedEffects",null);h.__decorate([w.property()],g.prototype,"featureEffect",null);h.__decorate([w.property()],g.prototype,"filter",null);h.__decorate([w.property()],g.prototype,"hasEffects",null);h.__decorate([w.property()],g.prototype,"includedEffects",null);h.__decorate([w.property({value:0})],g.prototype,"scale",null);h.__decorate([w.property()],g.prototype,"transitioning",
null);return g=h.__decorate([n.subclass("esri.layers.effects.FeatureEffectView")],g)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(f,h,g,k,E,w,B,m,n,z,l,A,u,c,e,q,r){const G=k.ofType({key:"type",base:c,typeMap:{rect:e,path:r,geometry:q}});f.LayerView2DMixin=D=>{D=function(K){function O(){var C=K.apply(this,arguments)||this;C.attached=!1;C.clips=new G;C.lastUpdateId=-1;C.moving=!1;C.updateRequested=!1;return C}h._inheritsLoose(O,K);var L=O.prototype;L.initialize=function(){var C,M,T,H;const v=null!=(C=null==(M=this.view)?void 0:M.spatialReferenceLocked)?C:!0;(null==(T=this.view)?0:T.spatialReference)&&v&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new w("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new u.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([B.watch(()=>this.suspended,p=>{this.container&&(this.container.visible=!p);this.view&&!p&&this.updateRequested&&this.view.requestUpdate()},B.syncAndInitial),
B.watch(()=>{var p,x;return null!=(p=null==(x=this.layer)?void 0:x.opacity)?p:1},p=>{this.container&&(this.container.opacity=p)},B.syncAndInitial),B.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",p=>{this.container&&(this.container.blendMode=p)},B.syncAndInitial),B.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,p=>{this.container&&(this.container.effect=p)},B.syncAndInitial),B.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(H=this.view)&&H.whenLayerView?this.view.whenLayerView(this.layer).then(p=>{p===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};L.destroy=function(){this.processDetach();this.updateRequested=!1};L.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};L.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};L.isVisibleAtScale=function(C){const M=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!M)return!0;const {minScale:T,maxScale:H}=M;return(0===T||C<=T)&&(0===H||C>=H)};L.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};L.processUpdate=function(C){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",C),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(C)))};L.hitTest=function(C,M){return Promise.resolve(null)};L.supportsSpatialReference=function(C){return!0};L.canResume=function(){return this.spatialReferenceSupported?K.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};L.getSuspendInfo=function(){const C=K.prototype.getSuspendInfo.call(this),M=!this.spatialReferenceSupported,T=this.visibleAtCurrentScale;M&&(C.spatialReferenceNotSupported=M);T&&(C.outsideScaleRange=T);return C};h._createClass(O,
[{key:"spatialReferenceSupported",get:function(){var C;const M=null==(C=this.view)?void 0:C.spatialReference;return null==M||this.supportsSpatialReference(M)}},{key:"updating",get:function(){var C;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(C=this.updatingHandles)||!C.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return O}(D);g.__decorate([m.property()],D.prototype,
"attached",void 0);g.__decorate([m.property({type:G,set(K){K=E.referenceSetter(K,this._get("clips"),G);this._set("clips",K)}})],D.prototype,"clips",void 0);g.__decorate([m.property()],D.prototype,"container",void 0);g.__decorate([m.property()],D.prototype,"moving",void 0);g.__decorate([m.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);g.__decorate([m.property({readOnly:!0})],D.prototype,"updateParameters",void 0);g.__decorate([m.property()],D.prototype,"updateRequested",void 0);
g.__decorate([m.property()],D.prototype,"updating",null);g.__decorate([m.property()],D.prototype,"view",void 0);g.__decorate([m.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",null);return D=g.__decorate([A.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,h,g,k,E,w,B,m,n){g=function(z){function l(){return z.apply(this,arguments)||this}f._inheritsLoose(l,z);return l}(g.JSONSupport);return g=h.__decorate([n.subclass("esri.views.layers.support.ClipArea")],g)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(f,h,g,k,E,w,B,m){var n;k=n=function(z){function l(){var A=z.apply(this,arguments)||this;A.type="rect";A.left=null;A.right=null;A.top=null;A.bottom=null;return A}f._inheritsLoose(l,z);l.prototype.clone=function(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};f._createClass(l,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return l}(m);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"left",void 0);h.__decorate([g.property({type:[Number,
String],json:{write:!0}})],k.prototype,"right",void 0);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"top",void 0);h.__decorate([g.property({type:[Number,String],json:{write:!0}})],k.prototype,"bottom",void 0);h.__decorate([g.property({readOnly:!0})],k.prototype,"version",null);return k=n=h.__decorate([B.subclass("esri.views.layers.support.ClipRect")],k)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(f,h,g,k,E,w,B,m,n,z,l,A,u){var c;g={base:n,key:"type",typeMap:{extent:A,polygon:u}};l=c=function(e){function q(){var r=e.apply(this,arguments)||this;r.type="geometry";r.geometry=null;return r}f._inheritsLoose(q,e);q.prototype.clone=function(){return new c({geometry:this.geometry.clone()})};f._createClass(q,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return q}(l);h.__decorate([k.property({types:g,json:{read:z.fromJSON,write:!0}})],l.prototype,"geometry",void 0);h.__decorate([k.property({readOnly:!0})],
l.prototype,"version",null);return l=c=h.__decorate([m.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(f,h,g,k,E,w,B,m){k=function(n){function z(){var l=n.apply(this,
arguments)||this;l.type="path";l.path=[];return l}f._inheritsLoose(z,n);f._createClass(z,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return z}(m);h.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],k.prototype,"path",void 0);h.__decorate([g.property({readOnly:!0})],k.prototype,"version",null);return k=h.__decorate([B.subclass("esri.views.layers.support.Path")],k)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(f,h,g){function k(){k=g._asyncToGenerator(function*(w,B){if(!w)return null;switch(w.type){case "symbol":return new (yield new Promise((m,n)=>f(["./tileRenderers/SymbolTileRenderer"],z=>m(E(z)),n))).default(B);case "heatmap":return new (yield new Promise((m,n)=>f(["./tileRenderers/HeatmapTileRenderer"],z=>m(E(z)),n))).default(B)}});return k.apply(this,arguments)}const E=w=>Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"}));h.createOrReuseTileRenderer=
function(w,B){return k.apply(this,arguments)};Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(f,h,g,k,E,w,B,m,n){function z(c){return c.some(e=>e.globalId)}function l(c){return c.filter(e=>!e.error).map(e=>{var q;return null!=(q=e.objectId)?q:e.globalId})}function A(c,e){c=new Set(c);for(const q of e.values())c.add(q);return c}function u(c,e){c=new Set(c);for(const q of e.values())c.delete(q);return c}g=function(c){function e(r){r=c.call(this,r)||this;r._hasGlobalIds=!1;return r}f._inheritsLoose(e,c);var q=e.prototype;q.normalizeCtorArgs=function(r){this._queueProcessor=new n.QueueProcessor({concurrency:1,
process:r.process});return{}};q.destroy=function(){this.clear()};q.clear=function(){this._queueProcessor.clear()};q.push=function(r){const G=this._queueProcessor;var D=G.last();switch(r.type){case "update":case "refresh":if((null==D?void 0:D.type)===r.type)return;G.push(r).finally(()=>this.notifyChange("updating"));break;case "edit":(D="processed-edit"===(null==D?void 0:D.type)?D:null)&&G.popLast();r=this._mergeEdits(D,r);for(const K of r)G.push(K).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};
q._mergeEdits=function(r,G){var D,K;const {addedFeatures:O,deletedFeatures:L,updatedFeatures:C}=G.edits;if(this._hasGlobalIds=this._hasGlobalIds||z(O)||z(C)||z(L))return G=[...O,...C],[r,{type:"processed-edit",edits:{addOrModified:G,removed:L}}];G=new Set(l(null!=(D=null==r?void 0:r.edits.addOrModified)?D:[]));r=new Set(l(null!=(K=null==r?void 0:r.edits.removed)?K:[]));K=new Set([...l(O),...l(C)]);D=new Set(l(L));G=Array.from(A(u(G,D),K)).map(M=>({objectId:M}));r=Array.from(A(u(r,K),D)).map(M=>({objectId:M}));
return[{type:"processed-edit",edits:{addOrModified:G,removed:r}}]};f._createClass(e,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return e}(g);h.__decorate([k.property({readOnly:!0})],g.prototype,"updating",null);return g=h.__decorate([m.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],g)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,h,g,k,E,w,B,m,n,z){g=function(l){function A(c){c=l.call(this,c)||this;c._startupResolver=k.createResolver();c.isReady=!1;return c}f._inheritsLoose(A,l);var u=A.prototype;u.initialize=function(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))};u.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};u.startup=function(){var c=f._asyncToGenerator(function*(e,q,r,G){yield this.when();var D=this._controller.signal;
D=Array.isArray(r.source)?{transferList:r.source,signal:D}:void 0;e=e.tileInfo.toJSON();yield this._connection.invoke("startup",{service:r,config:q,tileInfo:e,tiles:G},D);this._startupResolver.resolve();this._set("isReady",!0)});return function(e,q,r,G){return c.apply(this,arguments)}}();u.updateTiles=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return k.ignoreAbortErrors(this._connection.invoke("updateTiles",e))});return function(e){return c.apply(this,arguments)}}();
u.update=function(){var c=f._asyncToGenerator(function*(e){e={config:e};yield this._startupResolver.promise;return this._connection.invoke("update",e)});return function(e){return c.apply(this,arguments)}}();u.applyUpdate=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("applyUpdate",e)});return function(e){return c.apply(this,arguments)}}();u.setHighlight=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return k.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",e))});return function(e){return c.apply(this,arguments)}}();u.stop=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;if(!this.closed)return k.ignoreAbortErrors(this._connection.invoke("stop"))});return function(){return c.apply(this,arguments)}}();u.refresh=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return k.ignoreAbortErrors(this._connection.invoke("controller.refresh",
e))});return function(e){return c.apply(this,arguments)}}();u.querySummaryStatistics=function(){var c=f._asyncToGenerator(function*(e,q,r){yield this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:q},r)});return function(e,q,r){return c.apply(this,arguments)}}();u.queryUniqueValues=function(){var c=f._asyncToGenerator(function*(e,q,r){yield this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",
{query:e.toJSON(),params:q},r)});return function(e,q,r){return c.apply(this,arguments)}}();u.queryClassBreaks=function(){var c=f._asyncToGenerator(function*(e,q,r){yield this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:q},r)});return function(e,q,r){return c.apply(this,arguments)}}();u.queryHistogram=function(){var c=f._asyncToGenerator(function*(e,q,r){yield this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",
{query:e.toJSON(),params:q},r)});return function(e,q,r){return c.apply(this,arguments)}}();u.queryFeatures=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",e.toJSON(),q)});return function(e,q){return c.apply(this,arguments)}}();u.queryVisibleFeatures=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",
e.toJSON(),q)});return function(e,q){return c.apply(this,arguments)}}();u.queryObjectIds=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",e.toJSON(),q)});return function(e,q){return c.apply(this,arguments)}}();u.queryFeatureCount=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",e.toJSON(),q)});return function(e,
q){return c.apply(this,arguments)}}();u.queryExtent=function(){var c=f._asyncToGenerator(function*(e,q){return this._connection.invoke("controller.queryExtent",e.toJSON(),q)});return function(e,q){return c.apply(this,arguments)}}();u.queryLatestObservations=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",e.toJSON(),q)});return function(e,q){return c.apply(this,arguments)}}();u.queryStatistics=
function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",e)});return function(e){return c.apply(this,arguments)}}();u.getObjectId=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",e)});return function(e){return c.apply(this,arguments)}}();u.getDisplayId=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return this._connection.invoke("controller.getDisplayId",e)});return function(e){return c.apply(this,arguments)}}();u.getFeatures=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",e)});return function(e){return c.apply(this,arguments)}}();u.getAggregates=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")});return function(){return c.apply(this,
arguments)}}();u.getAggregateValueRanges=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")});return function(){return c.apply(this,arguments)}}();u.mapValidDisplayIds=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",e)});return function(e){return c.apply(this,arguments)}}();u.onEdits=function(){var c=
f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return k.ignoreAbortErrors(this._connection.invoke("controller.onEdits",e))});return function(e){return c.apply(this,arguments)}}();u.enableEvent=function(){var c=f._asyncToGenerator(function*(e,q){yield this._startupResolver.promise;return k.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:e,value:q}))});return function(e,q){return c.apply(this,arguments)}}();u.pauseStream=function(){return k.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))};
u.resumeStream=function(){return k.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))};u._startWorker=function(){var c=f._asyncToGenerator(function*(e){try{this._connection=yield E.open("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(q){k.throwIfNotAbortError(q)}});return function(e){return c.apply(this,arguments)}}();f._createClass(A,[{key:"tileRenderer",set:function(c){this.client.tileRenderer=c}},{key:"closed",get:function(){return this._connection.closed}}]);
return A}(g.EsriPromise);h.__decorate([w.property()],g.prototype,"isReady",void 0);h.__decorate([w.property()],g.prototype,"client",void 0);h.__decorate([w.property()],g.prototype,"tileRenderer",null);return g=h.__decorate([z.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],g)})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../core/maybe","./TileCoverage","./TileKey"],function(f,h,g,k){let E=function(){function w(m){this._tiles=new Map;this.buffer=0;this.acquireTile=
m.acquireTile;this.releaseTile=m.releaseTile;this.tileInfoView=m.tileInfoView;this.buffer=m.buffer}var B=w.prototype;B.destroy=function(){};B.clear=function(){this._tiles.forEach(m=>this._releaseTile(m))};B.tileKeys=function(){const m=[];this._tiles.forEach((n,z)=>m.push(z));return m};B.update=function(m){m=this.tileInfoView.getTileCoverage(m.state,this.buffer,"closest");const {spans:n,lodInfo:z}=m,{level:l}=z,A=[],u=[],c=new Set,e=new Set;for(const {row:q,colFrom:r,colTo:G}of n)for(let D=r;D<=G;D++){const K=
k.getId(l,q,z.normalizeCol(D),z.getWorldForColumn(D)),O=this._getOrAcquireTile(A,K);c.add(K);O.isReady?O.visible=!0:e.add(O.key)}e.forEach(q=>this._addPlaceholders(c,q));this._tiles.forEach(q=>{c.has(q.key.id)||(u.push(q.key.id),this._releaseTile(q))});g.pool.release(m);return{hasMissingTiles:0<e.size,added:A,removed:u}};B._getOrAcquireTile=function(m,n){if(!this._tiles.has(n)){const z=this.acquireTile(new k(n));m.push(n);this._tiles.set(n,z);z.visible=!1}return this._tiles.get(n)};B._getTile=function(m){return this._tiles.get(m)};
B._releaseTile=function(m){this._tiles.delete(m.key.id);this.releaseTile(m)};B._addPlaceholders=function(m,n){const z=this._addPlaceholderChildren(m,n);1E-6>Math.abs(1-z)||this._addPlaceholderParent(m,n)||(this._getTile(n.id).visible=!0)};B._addPlaceholderChildren=function(m,n){let z=0;this._tiles.forEach(l=>{z+=this._addPlaceholderChild(m,l,n)});return z};B._addPlaceholderChild=function(m,n,z){if(n.key.level<=z.level||!n.hasData||!z.contains(n.key))return 0;n.visible=!0;m.add(n.key.id);return 1/
(1<<2*(n.key.level-z.level))};B._addPlaceholderParent=function(m,n){n=n.getParentKey();let z=0,l=null;for(;h.isSome(n);){if(m.has(n.id))return!0;const A=this._getTile(n.id);if(null!=A&&A.isReady)return A.visible=!0,m.add(A.key.id),!0;null!=A&&A.hasData&&A.patchCount>z&&(z=A.patchCount,l=A);n=n.getParentKey()}return l?(l.visible=!0,m.add(l.key.id),!0):!1};return w}();f.TileManager=E;Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/deprecate ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(f,h,g,k,E,w,B,m,n,z,l,A,u,c,e,q,r,G,D,K,O){const L=E.getLogger("esri.views.layers.FeatureLayerView");return C=>{C=function(M){function T(...v){v=M.call(this,...v)||this;v._updatingRequiredFieldsPromise=null;v.filter=null;v.timeExtent=null;v.layer=null;v.requiredFields=[];v.view=null;return v}f._inheritsLoose(T,M);var H=T.prototype;H.initialize=function(){this.handles.add([m.watch(()=>{var v;const p=this.layer;return[null==p?void 0:null==(v=p.elevationInfo)?void 0:v.featureExpressionInfo,
null==p?void 0:p.displayField,null==p?void 0:p.timeInfo,p&&"renderer"in p&&p.renderer,p&&"labelingInfo"in p&&p.labelingInfo,p&&"floorInfo"in p&&p.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),m.syncAndInitial),m.on(()=>{var v;return null==(v=this.view)?void 0:v.floors},"change",()=>this._handleRequiredFieldsChange()),m.on(()=>{const v=this.layer;return v&&"sublayers"in v&&v.sublayers},"change",()=>this._handleRequiredFieldsChange())])};H.highlight=
function(v){throw Error("missing implementation");};H.createQuery=function(){var v={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};v=w.isSome(this.filter)?this.filter.createQuery(v):new D(v);if("feature"===this.layer.type){const p=G.getFloorFilterClause(this);w.isSome(p)&&(v.where=v.where?`(${v.where}) AND (${p})`:p)}w.isSome(this.timeExtent)&&(v.timeExtent=w.isSome(v.timeExtent)?v.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return v};H.queryFeatures=
function(v,p){throw Error("missing implementation");};H.queryObjectIds=function(v,p){throw Error("missing implementation");};H.queryFeatureCount=function(v,p){throw Error("missing implementation");};H.queryExtent=function(v,p){throw Error("missing implementation");};H.fetchPopupFeatures=function(){var v=f._asyncToGenerator(function*(p,x){if(p=this.validateFetchPopupFeatures(x))throw p;return this.fetchClientPopupFeatures(x)});return function(p,x){return v.apply(this,arguments)}}();H._loadArcadeModules=
function(v){if(v.get("expressionInfos.length")||Array.isArray(v.content)&&v.content.some(p=>"expression"===p.type))return K.loadArcade()};H._handleRequiredFieldsChange=function(){const v=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",v);v.then(()=>{this._updatingRequiredFieldsPromise===v&&this._set("_updatingRequiredFieldsPromise",null)})};H._updateRequiredFields=function(){var v=f._asyncToGenerator(function*(){if(this.layer&&this.view){var p="3d"===this.view.type,{layer:x,
layer:{fieldsIndex:S,objectIdField:R}}=this,P="renderer"in x&&x.renderer,Q="orderBy"in x&&x.orderBy,U=x.featureReduction,I=new Set;P=yield B.eachAlways([P?P.collectRequiredFields(I,S):null,r.collectLabelingFields(I,x),p?r.collectElevationFields(I,x):null,w.isSome(this.filter)?r.collectFilterFields(I,x,this.filter):null,w.isSome(this.featureEffect)?r.collectFilterFields(I,x,this.featureEffect.filter):null,U?r.collectFeatureReductionFields(I,x,U):null,Q?r.collectOrderByInfos(I,x,Q):null]);x.timeInfo&&
this.timeExtent&&r.collectFields(I,x.fieldsIndex,[x.timeInfo.startField,x.timeInfo.endField]);"feature"===x.type&&x.floorInfo&&r.collectFields(I,x.fieldsIndex,[x.floorInfo.floorField]);"subtype-group"===x.type&&(r.collectField(I,S,x.subtypeField),Q=x.sublayers.map(W=>{var Y;return Promise.all([null==(Y=W.renderer)?void 0:Y.collectRequiredFields(I,S),r.collectLabelingFields(I,W)])}),yield B.eachAlways(Q));for(const W of P)W.error&&L.error(W.error);r.collectField(I,S,R);p&&"displayField"in x&&x.displayField&&
r.collectField(I,S,x.displayField);p=Array.from(I).sort();this._set("requiredFields",p)}});return function(){return v.apply(this,arguments)}}();H.validateFetchPopupFeatures=function(v){if(w.isNone(v))return null;for(const p of v.clientGraphics){const x=p.layer;if("popupEnabled"in x&&!x.popupEnabled)return new k("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:x});if(p.isAggregate){if(!(x.featureReduction&&"popupTemplate"in x.featureReduction&&x.featureReduction.popupEnabled&&x.featureReduction.popupTemplate))return new k("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:x})}else if("popupTemplate"in x&&!O.getFetchPopupTemplate(x,v))return new k("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:x})}};H.fetchClientPopupFeatures=function(){var v=f._asyncToGenerator(function*(p){const x=w.isSome(p)?p.clientGraphics:null;if(!x||0===x.length)return[];const S=Array(x.length),R=new Map,P=yield this.createPopupQuery(p);for(let U=0;U<x.length;U++){const I=x[U];if(I.isAggregate){S[U]=I;continue}var {layer:Q}=
I;if(!("popupEnabled"in Q))continue;const W=r.unpackFieldNames(this.layer.fieldsIndex,P.outFields);Q=O.getFetchPopupTemplate(Q,p);if(w.isNone(Q))continue;const Y=yield this._loadArcadeModules(Q);Y&&Y.arcadeUtils.hasGeometryOperations(Q)||!r.featureHasFields(W,I)?R.set(I.getObjectId(),U):S[U]=I}if("stream"===this.layer.type||0===R.size)return S.filter(Boolean);P.objectIds=Array.from(R.keys());try{const U=yield this.layer.queryFeatures(P);for(const I of U.features){const W=R.get(I.getObjectId());S[W]=
I}}catch{}return S.filter(Boolean)});return function(p){return v.apply(this,arguments)}}();H.createPopupQuery=function(){var v=f._asyncToGenerator(function*(p){const x=this.layer.createQuery(),S=new Set;var R=!1,P=w.isSome(p)&&p.clientGraphics?p.clientGraphics.map(Q=>Q.layer):[this.layer];for(const Q of P)if("popupEnabled"in Q&&(P=O.getFetchPopupTemplate(Q,p),!w.isNone(P))){R=(R=yield this._loadArcadeModules(P))&&R.arcadeUtils.hasGeometryOperations(P);R=!("point"!==this.layer.geometryType&&!R);P=
yield O.getRequiredFields(this.layer,P);for(const U of P)S.add(U)}x.returnGeometry=R;x.returnZ=R;x.returnM=R;x.outFields=Array.from(S);x.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(p=G.getFloorFilterClause(this),w.isSome(p)&&(x.where=x.where?`(${x.where}) AND (${p})`:p));return x});return function(p){return v.apply(this,arguments)}}();H.canResume=function(){return!M.prototype.canResume.call(this)||w.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};f._createClass(T,
[{key:"availableFields",get:function(){const {layer:v,layer:{fieldsIndex:p},requiredFields:x}=this;return"outFields"in v&&v.outFields?r.fixFields(p,[...r.unpackFieldNames(p,v.outFields),...x]):r.fixFields(p,x)}},{key:"effect",get:function(){g.deprecatedProperty(L,"effect",{replacement:"featureEffect",version:"4.22"});return this.featureEffect},set:function(v){g.deprecatedProperty(L,"effect",{replacement:"featureEffect",version:"4.22"});this.featureEffect=v}},{key:"featureEffect",get:function(){return this.layer&&
"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(v){void 0===v?this._clearOverride("featureEffect"):this._override("featureEffect",v)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(v){L.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return T}(C);h.__decorate([n.property()],C.prototype,"_updatingRequiredFieldsPromise",void 0);h.__decorate([n.property({readOnly:!0})],
C.prototype,"availableFields",null);h.__decorate([n.property()],C.prototype,"effect",null);h.__decorate([n.property({type:e})],C.prototype,"featureEffect",null);h.__decorate([n.property({type:q})],C.prototype,"filter",void 0);h.__decorate([n.property(c.combinedViewLayerTimeExtentProperty)],C.prototype,"timeExtent",void 0);h.__decorate([n.property()],C.prototype,"layer",void 0);h.__decorate([n.property({type:Number})],C.prototype,"maximumNumberOfFeatures",null);h.__decorate([n.property({readOnly:!0,
type:Boolean})],C.prototype,"maximumNumberOfFeaturesExceeded",null);h.__decorate([n.property({readOnly:!0})],C.prototype,"requiredFields",void 0);h.__decorate([n.property()],C.prototype,"suspended",void 0);h.__decorate([n.property()],C.prototype,"view",void 0);return C=h.__decorate([u.subclass("esri.views.layers.FeatureLayerView")],C)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(f){function h(g,k){if(null==g||!g.length)return null;g=g.filter(E=>""!==E).map(E=>
`'${E}'`);g.push("''");return`${k} IN (${g.join(",")}) OR ${k} IS NULL`}f.getFloorFilterClause=function(g){var k;const E=g.layer;return"floorInfo"in E&&null!=(k=E.floorInfo)&&k.floorField&&"floors"in g.view?h(g.view.floors,E.floorInfo.floorField):null};f.getLayerFloorFilterClause=function(g,k){var E;return"floorInfo"in k&&null!=(E=k.floorInfo)&&E.floorField?h(g,k.floorInfo.floorField):null};Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(f,h,g,k){function E(){E=h._asyncToGenerator(function*(w,B=w.popupTemplate){if(g.isNone(B))return[];const m=yield B.getRequiredFields(w.fieldsIndex);({lastEditInfoEnabled:B}=B);const {objectIdField:n,typeIdField:z,globalIdField:l,relationships:A}=w;if(m.includes("*"))return["*"];B=B?yield k.getFeatureEditFields(w):[];const u=k.fixFields(w.fieldsIndex,[...m,...B]);z&&u.push(z);u&&n&&w.fieldsIndex.has(n)&&
!u.includes(n)&&u.push(n);u&&l&&w.fieldsIndex.has(l)&&!u.includes(l)&&u.push(l);A&&A.forEach(c=>{({keyField:c}=c);u&&c&&w.fieldsIndex.has(c)&&!u.includes(c)&&u.push(c)});return u});return E.apply(this,arguments)}f.getFetchPopupTemplate=function(w,B){return w.popupTemplate?w.popupTemplate:g.isSome(B)&&B.defaultPopupTemplateEnabled&&g.isSome(w.defaultPopupTemplate)?w.defaultPopupTemplate:null};f.getRequiredFields=function(w){return E.apply(this,arguments)};Object.defineProperties(f,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(f,h,g,k,E,w,B,m,n,z){return l=>{l=function(A){function u(){return A.apply(this,
arguments)||this}f._inheritsLoose(u,A);u.prototype.initialize=function(){this.handles.add(E.on(()=>this.layer,"refresh",c=>{this.doRefresh(c.dataChanged).catch(e=>{k.isAbortError(e)||g.getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")};return u}(l);h.__decorate([w.property()],l.prototype,"layer",void 0);return l=h.__decorate([z.subclass("esri.layers.mixins.RefreshableLayerView")],l)}})}}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/rendererUtils ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(f,
h,g,k,E,w,B,m,n,z,l,A,u,c,e,q,r,G,D,K,O,L,C,M,T,H,v,p,x,S,R,P,Q,U,I){function W(ea){return ea&&"openPorts"in ea}const Y=z.getLogger("esri.views.2d.layers.FeatureLayerView2D");k=function(ea){function fa(){var a=ea.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._commandsQueue=new v({process:b=>{switch(b.type){case "processed-edit":return a._doEdit(b);case "refresh":return a._doRefresh(b.dataChanged);case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._highlightIds=new Map;
a._updateHighlight=A.debounce(f._asyncToGenerator(function*(){return a._proxy.setHighlight(Array.from(a._highlightIds.keys()))}));a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.featureEffectView=new r;a._lastDefinitionExpression=null;return a}f._inheritsLoose(fa,ea);var y=fa.prototype;y.destroy=function(){var a;l.applySome(this._updateClusterSizeTask,b=>b.remove());null==(a=this._proxy)?void 0:a.destroy();this._commandsQueue.destroy()};y.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),
this._initServiceOptions()]));this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),u.watch(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},{initial:!0,sync:!0})])};y._initProxy=function(){var a=f._asyncToGenerator(function*(){var b=this.layer;if("isTable"in b&&b.isTable)throw new B("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});const d="capabilities"in b&&b.capabilities.operations.supportsQuery;
if(("feature"===b.type||"subtype-group"===b.type)&&!d)throw new B("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:b});this._proxy&&this._proxy.destroy();b=this._createClientOptions();this._set("_proxy",new p({client:b}));return this._proxy.when()});return function(){return a.apply(this,arguments)}}();y._initServiceOptions=function(){var a=f._asyncToGenerator(function*(){this._set("_serviceOptions",yield this._createServiceOptions());return this._serviceOptions});
return function(){return a.apply(this,arguments)}}();y.highlight=function(a){var b;let d;a instanceof E?d=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?d=[a]:Array.isArray(a)&&0<a.length?d="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(t=>null==t?void 0:t.getObjectId()):w.isCollection(a)&&0<a.length&&(d=a.map(t=>null==t?void 0:t.getObjectId()).toArray());d=null==(b=d)?void 0:b.filter(t=>null!=t);if(!d||!d.length)return{remove:()=>{}};this._addHighlight(d);return{remove:()=>this._removeHighlight(d)}};
y.hasHighlight=function(){return!!this._highlightIds.size};y.hitTest=function(){var a=f._asyncToGenerator(function*(b,d){if(!this.tileRenderer)return null;d=yield this.tileRenderer.hitTest(d);if(0===d.length)return null;const {features:t,aggregates:F}=yield this._proxy.getFeatures(d);return[...F.map(J=>this._createGraphicHit(b,g.fromJSON(J))),...t.map(J=>this._createGraphicHit(b,E.fromJSON(J)))]});return function(b,d){return a.apply(this,arguments)}}();y.queryAggregates=function(){var a=f._asyncToGenerator(function*(){return(yield this._proxy.getAggregates()).map(b=>
g.fromJSON(b))});return function(){return a.apply(this,arguments)}}();y.queryStatistics=function(){return this._proxy.queryStatistics()};y.querySummaryStatistics=function(){var a=f._asyncToGenerator(function*(b,d,t){d={...d,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(b),d,t)});return function(b,d,t){return a.apply(this,arguments)}}();y.queryUniqueValues=function(){var a=f._asyncToGenerator(function*(b,d,t){d={...d,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(b),
d,t)});return function(b,d,t){return a.apply(this,arguments)}}();y.queryClassBreaks=function(){var a=f._asyncToGenerator(function*(b,d,t){d={...d,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(b),d,t)});return function(b,d,t){return a.apply(this,arguments)}}();y.queryHistogram=function(){var a=f._asyncToGenerator(function*(b,d,t){d={...d,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(b),d,t)});return function(b,d,t){return a.apply(this,arguments)}}();
y.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(d=>{d=D.fromJSON(d);d.features.forEach(t=>this._setLayersForFeature(t));return d})};y.queryVisibleFeatures=function(a,b){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),b).then(d=>{d=D.fromJSON(d);d.features.forEach(t=>this._setLayersForFeature(t));return d})};y.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};y.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),
b)};y.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};y.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(d=>({count:d.count,extent:I.fromJSON(d.extent)}))};y.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};y.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,added:d,removed:t}=this._tileStrategy.update(a);(d.length||
t.length)&&this._proxy.updateTiles({added:d,removed:t});b&&this.requestUpdate();this.notifyChange("updating")}};y.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new S.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(u.watch(()=>this.renderingConfigHash,()=>this._update(),u.initial),"attach");"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",
a=>this._edit(a)),"attach")};y.detach=function(){var a;this._commandsQueue.clear();null==(a=this._proxy)?void 0:a.stop();this.container.removeAllChildren();this.handles.remove("attach");this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};y.moveStart=function(){this.requestUpdate()};y.viewChange=function(){this.requestUpdate()};y.moveEnd=function(){this.requestUpdate()};
y.isUpdating=function(){var a;const b="renderer"in this.layer&&null!=this.layer.renderer,d=this._commandsQueue.updating,t=null!=this._updatingRequiredFieldsPromise,F=!this._proxy||!this._proxy.isReady,J=this._pipelineIsUpdating,Z=null==this.tileRenderer||(null==(a=this.tileRenderer)?void 0:a.updating);a=b&&(d||t||F||J||Z);m("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${a}\n  -> hasRenderer ${b}\n  -> hasPendingCommand ${d}\n  -> updatingRequiredFields ${t}\n  -> updatingProxy ${F}\n  -> updatingPipeline ${J}\n  -> updatingTileRenderer ${Z}\n`);
return a};y._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};y._detectQueryMode=function(){var a=f._asyncToGenerator(function*(b){var d;const t="editingInfo"in this.layer&&(null==(d=this.layer.editingInfo)?void 0:d.lastEditDate);d=!!this.layer.refreshInterval;if("path"in b&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&
!this.layer.capabilities.operations.supportsEditing&&(t||!d)&&m("featurelayer-snapshot-enabled"))try{const F=yield this.layer.queryFeatureCount(),J=m("featurelayer-snapshot-point-min-threshold");if(F<=J)return{mode:"snapshot",featureCount:F};const Z=m("featurelayer-snapshot-point-max-threshold"),aa=m("featurelayer-snapshot-point-coverage"),ba=this.view.extent,N=l.unwrap(this.layer.fullExtent),V=null==N?void 0:N.clone().intersection(ba),X=l.isSome(V)?V.width*V.height:0,ca=(null==N?NaN:N.width)*(null==
N?NaN:N.height);b=0===ca?0:X/ca;if(F<=Z&&b>=aa)return{mode:"snapshot",featureCount:F}}catch(F){Y.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:F})}return{mode:"on-demand"}});return function(b){return a.apply(this,arguments)}}();y._createServiceOptions=function(){var a=f._asyncToGenerator(function*(){var b,d=this.layer;if("stream"===d.type)return null;const {capabilities:t,objectIdField:F}=d,J=d.fields.map(da=>da.toJSON()),Z=l.isSome(d.fullExtent)&&d.fullExtent.toJSON(),
aa=x.toJSONGeometryType(d.geometryType),ba=d.timeInfo&&d.timeInfo.toJSON()||null,N=d.spatialReference?d.spatialReference.toJSON():null,V="feature"===d.type?d.globalIdField:null;let X;"ogc-feature"===d.type?X=d.source.getFeatureDefinition():W(d.source)?X=yield d.source.openPorts():d.parsedUrl&&(X=n.clone(d.parsedUrl),"dynamicDataSource"in d&&d.dynamicDataSource&&(X.query={layer:JSON.stringify({source:d.dynamicDataSource})}));d="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;
const ca=null!=(b="subtypeField"in this.layer&&this.layer.subtypeField)?b:null,{mode:ia,featureCount:ja}=yield this._detectQueryMode(X);b=this.layer.objectIdField;if("feature"===this.layer.type&&l.isSome(this.layer.orderBy)&&this.layer.orderBy.length){const da=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;da&&(b=da)}return{type:ia,timeReferenceUnknownClient:d,subtypeField:ca,featureCount:ja,globalIdField:V,maxRecordCount:t.query.maxRecordCount,tileMaxRecordCount:t.query.tileMaxRecordCount,
capabilities:t,fields:J,fullExtent:Z,geometryType:aa,objectIdField:F,source:X,timeInfo:ba,spatialReference:N,orderByFields:b}});return function(){return a.apply(this,arguments)}}();y._createMemoryServiceOptions=function(){var a=f._asyncToGenerator(function*(b){b=yield b.openPorts();return{...this._createServiceOptions(),type:"memory",source:b}});return function(b){return a.apply(this,arguments)}}();y._cleanUpQuery=function(a){a=K.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=
this.view.spatialReference);return a};y._update=function(){var a=f._asyncToGenerator(function*(){return this._commandsQueue.push({type:"update"})});return function(){return a.apply(this,arguments)}}();y._edit=function(){var a=f._asyncToGenerator(function*(b){if(this.suspended)this._clearTiles();else if(this._validateEdit(b))return this._commandsQueue.push({type:"edit",edits:b})});return function(b){return a.apply(this,arguments)}}();y.doRefresh=function(){var a=f._asyncToGenerator(function*(b){if(this._tileStrategy.tileKeys().length){if(!this.suspended||
!b)return this._commandsQueue.push({type:"refresh",dataChanged:b});this._clearTiles()}});return function(b){return a.apply(this,arguments)}}();y._clearTiles=function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())};y._validateEdit=function(a){const b="globalIdField"in this.layer&&this.layer.globalIdField,d=a.deletedFeatures.some(F=>-1===F.objectId||
!F.objectId),t=b&&this.availableFields.includes(b);return d&&!t?(Y.error(new B("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`)),null):a};y._doUpdate=function(){var a=f._asyncToGenerator(function*(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:b,filter:d}=this;yield this._updateRequiredFields();var {renderer:t}=this._getEffectiveRenderer();
this._set("_effectiveRenderer",t);var F=this._createSchemaConfig(),J=this._createConfiguration(F,d,b.filter),Z=this._lastDefinitionExpression!==J.schema.source.definitionExpression;this._lastDefinitionExpression=J.schema.source.definitionExpression;var aa=J.schema.tileRenderer,ba=this._createTileRendererHash(aa);"snapshot"===this._serviceOptions.type&&(J.schema.source.featureCount=this._serviceOptions.featureCount);if(ba!==this._tileRendererHash){yield this._initTileRenderer(aa,t);const N=this.layer,
V="stream"===N.type?yield this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(t);"stream"!==N.type&&W(N.source)&&(V.source=yield N.source.openPorts());const X={added:this._tileStrategy.tileKeys(),removed:[]};yield this._proxy.startup(this.view.featuresTilingScheme,J,V,X);this.hasHighlight()&&(yield this._proxy.setHighlight(Array.from(this._highlightIds.keys())));yield this._onceTilesUpdated();this.tileRenderer.onConfigUpdate(t)}else{"snapshot"===this._serviceOptions.type&&
Z&&(J.schema.source.featureCount=yield this.layer.queryFeatureCount());const N=yield this._proxy.update(J);(N.mesh||N.targets.aggregate)&&this._lockGPUUploads();try{yield this._proxy.applyUpdate(N)}catch(V){A.isAbortError(V)||Y.error(V)}(N.mesh||N.targets.aggregate)&&this._unlockGPUUploads();this.tileRenderer.onConfigUpdate(t);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=ba;this.tileRenderer.invalidateLabels();this.requestUpdate()}}catch(N){}});return function(){return a.apply(this,
arguments)}}();y._doEdit=function(){var a=f._asyncToGenerator(function*(b){try{yield this._proxy.onEdits(b)}catch(d){A.isAbortError(d)}});return function(b){return a.apply(this,arguments)}}();y._doRefresh=function(){var a=f._asyncToGenerator(function*(b){var d;this._lockGPUUploads();try{yield this._proxy.refresh(b)}catch(t){A.isAbortError(t)}this._unlockGPUUploads();null!=(d=this.layer)&&d.featureReduction&&this._updateClusterSizeVariable()});return function(b){return a.apply(this,arguments)}}();
y._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)};y._createUpdateClusterSizeTask=function(a,b){return u.watch(()=>this._aggregateValueRanges,d=>{this._updateClusterEffectiveRendererSizeVariable(a,b,d);this._needsClusterSizeUpdate=!0;this._uploadsLocked||this._updateClusterSizeVariable()})};y._updateClusterEffectiveRendererSizeVariable=function(){var a=f._asyncToGenerator(function*(b,d,
t){if(b.dynamicClusterSize&&"visualVariables"in b&&b.visualVariables){var F=H.findSizeVV(b.visualVariables);l.isSome(F)&&"cluster_count"===F.field&&(F=b.visualVariables.indexOf(F),b.visualVariables[F]=H.createClusterCountSizeVariable(d,t),b=b.clone(),b.dynamicClusterSize=!0,this._set("_effectiveRenderer",b))}});return function(b,d,t){return a.apply(this,arguments)}}();y._getEffectiveRenderer=function(){var a="renderer"in this.layer&&this.layer.renderer;const b=this.layer.featureReduction;l.isSome(this._updateClusterSizeTask)&&
(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(b&&"renderer"in b&&b.renderer){a=[];for(const t of null!=(d=b.fields)?d:[]){var d;H.convertAggregateFieldFromPublic(a,t)}return{renderer:b.renderer,aggregateFields:a,featureReduction:b}}return b&&"cluster"===b.type&&H.isClusterCompatibleRenderer(a)?(d=[],a=H.createClusterRenderer(d,a,b,this._aggregateValueRanges),l.applySome(this._updateClusterSizeTask,t=>t.remove()),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,
b),{renderer:a,aggregateFields:d,featureReduction:b}):{renderer:a,aggregateFields:[],featureReduction:null}};y._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};y._releaseTile=function(a){this.tileRenderer.releaseTile(a)};y._initTileRenderer=function(){var a=f._asyncToGenerator(function*(b,d){b=yield M.createOrReuseTileRenderer(b,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),
this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=b;this._set("tileRenderer",b);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(d);this.requestUpdate();return this.tileRenderer});return function(b,d){return a.apply(this,arguments)}}();y._createTileRendererHash=function(a){return`${a.type}`};y._injectOverrides=function(a){var b=l.isSome(a)?a.timeExtent:null;b=l.isSome(this.timeExtent)&&
l.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var d=null;const t="floorInfo"in this.layer&&this.layer.floorInfo;t&&(d=l.isSome(a)&&a.where,d=this._addFloorFilterClause(d));if(!this._visibilityOverrides.size&&!b&&!t)return l.isSome(a)?a.toJSON():null;a=l.isSome(a)&&a.clone()||new G;a.timeExtent=b;d&&(a.where=d);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a};y._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var d,
t=this.view.floors;if(!t||!t.length)return a;null!=(d=b.floorInfo.viewAllLevelIds)&&d.length&&(t=b.floorInfo.viewAllLevelIds);d=t.filter(F=>""!==F).map(F=>"'"+F+"'");d.push("''");b=b.floorInfo.floorField;t="("+b+" IN ({ids}) OR "+b+" IS NULL)";t=t.replace("{ids}",d.join(", "));l.isSome(a)&&a.includes(b)&&(d=new RegExp("AND \\("+b+".*NULL\\)","g"),a=a.replace(d,""),d=new RegExp("\\("+b+".*NULL\\)","g"),a=a.replace(d,""),a=a.replace(/\s+/g," ").trim());a=""!==a?"("+a+") AND "+t:t}return""!==a?a:null};
y._createConfiguration=function(a,b,d){const t="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,F="feature"===this.layer.type?this.layer.gdbVersion:void 0,J=Array(O.MAX_FILTERS);b=this._injectOverrides(b);J[0]=b;J[1]=l.isSome(d)?d.toJSON():null;a=C.createSchema(a);if(l.isNone(a))return null;d=U.getWebGLCapabilities("2d");return{availableFields:this.availableFields,gdbVersion:F,historicMoment:t,devicePixelRatio:window.devicePixelRatio||1,filters:J,schema:a,
supportsTextureFloat:d.supportsTextureFloat,maxTextureSize:d.maxTextureSize}};y._hasRequiredSupport=function(a){return"renderer"in a?T.isRendererSupported(a.renderer):!0};y._onceTilesUpdated=function(){this.requestUpdate();return u.whenOnce(()=>!this._pipelineIsUpdating)};y._lockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};y._unlockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};y._forceAttributeTextureUpload=
function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};y._createSchemaConfig=function(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in
this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0},subtypeCode:"subtypeCode"in
this.layer?this.layer.subtypeCode:void 0,subtypeField:"subtypeField"in this.layer?this.layer.subtypeField:void 0}};y._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{A.isAbortError(b)||Y.error(b)})};y._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,
a));this._updateHighlight().catch(b=>{A.isAbortError(b)||Y.error(b)})};y._setLayersForFeature=function(a){const b=this.layer;a.layer=b;a.sourceLayer=b};y._createGraphicHit=function(a,b){this._setLayersForFeature(b);l.isSome(b.geometry)&&(b.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:b,layer:this.layer,mapPoint:a}};f._createClass(fa,[{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",
get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(b=>b.labelingInfo&&b.labelsVisible)}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields;var b=this.layer;const d=this.view.floors,{definitionExpression:t}=b,F="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,J="renderer"in b&&
b.renderer,Z="feature"===b.type?b.gdbVersion:void 0,aa="feature"===b.type&&b.historicMoment?b.historicMoment.getTime():void 0,{timeExtent:ba}=this,N="customParameters"in b?JSON.stringify(b.customParameters):void 0,V="apiKey"in b?b.apiKey:void 0,X="stream"===b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null,ca=JSON.stringify(this.clips);b=b.featureReduction&&b.featureReduction.toJSON();const ia="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ja="sublayers"in
this.layer&&this.layer.sublayers.items.reduce((da,ha)=>da+`${ha.visible?1:0}.${JSON.stringify(ha.renderer)}.${ha.labelsVisible}\n.${JSON.stringify(ha.labelingInfo)}`,"");return JSON.stringify({orderBy:ia,sublayerHash:ja,subtypeCode:"subtypeCode"in this.layer&&this.layer.subtypeCode,filterHash:l.isSome(this.filter)&&this.filter.toJSON(),effectHash:l.isSome(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:X,gdbVersion:Z,definitionExpression:t,historicMoment:aa,availableFields:a,renderer:J,
labelingInfo:F,timeExtent:ba,floors:d,clipsHash:ca,featureReduction:b,customParameters:N,apiKey:V})}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}}]);return fa}(R(Q(L.LayerView2DMixin(P))));h.__decorate([c.property()],k.prototype,"_serviceOptions",void 0);h.__decorate([c.property()],k.prototype,"_proxy",void 0);h.__decorate([c.property()],
k.prototype,"_pipelineIsUpdating",void 0);h.__decorate([c.property()],k.prototype,"_effectiveRenderer",void 0);h.__decorate([c.property()],k.prototype,"_aggregateValueRanges",void 0);h.__decorate([c.property()],k.prototype,"_commandsQueue",void 0);h.__decorate([c.property()],k.prototype,"featureEffectView",void 0);h.__decorate([c.property()],k.prototype,"labelsVisible",null);h.__decorate([c.property({readOnly:!0})],k.prototype,"queryMode",null);h.__decorate([c.property()],k.prototype,"renderingConfigHash",
null);h.__decorate([c.property()],k.prototype,"tileRenderer",void 0);h.__decorate([c.property()],k.prototype,"updating",void 0);return k=h.__decorate([q.subclass("esri.views.2d.layers.FeatureLayerView2D")],k)});