var auth=(function(){String.prototype.startsWith=function(r){this.indexOf(r)===0};String.prototype.endsWith=function(r){this.lastIndexOf(r)===this.length-r.length};var c={};var i=false;var m;var k="";var b="";var q=36000;var e;var o="sign in";var h=util.getClientURL();if(h.lastIndexOf("/")!=(h.length-1)){h=h+"/"}function p(){var r=util.getClientConfig();if(r&&r.portalUrl){k=r.portalUrl}if(r&&r.clientId){b=r.clientId}if(r&&r.tokenExpirationInMinutes){q=r.tokenExpirationInMinutes}k=k.replace("http:","https:")}p();var j="";nls.load(function(){j='<div class="popup-container"><div><h2>'+jQuery.i18n.prop("common.signin.popupTitle")+'</h2></div><div class="popup-content"><div><span>'+jQuery.i18n.prop("common.signin.popupDesc")+'</span></div><div><div class="glyphicon glyphicon-ok popup-item"></div><div class="popup-item-desc"><h4>'+jQuery.i18n.prop("common.signin.popupFeature1")+'</h4></div></div><div><div class="glyphicon glyphicon-ok popup-item"></div><div class="popup-item-desc"><h4>'+jQuery.i18n.prop("common.signin.popupFeature2")+'</h4></div></div><div><div class="glyphicon glyphicon-ok popup-item"></div><div class="popup-item-desc"><h4>'+jQuery.i18n.prop("common.signin.popupFeature3")+'</h4></div></div><div><div class="glyphicon glyphicon-ok popup-item"></div><div class="popup-item-desc"><h4>'+jQuery.i18n.prop("common.signin.popupFeature4")+'</h4></div></div><div><div class="glyphicon glyphicon-ok popup-item"></div><div class="popup-item-desc"><h4>'+jQuery.i18n.prop("common.signin.popupFeature5")+"</h4></div></div></div><div><div><span>"+jQuery.i18n.prop("common.signin.popupRegNewDesc")+'</span><div><a href="'+k+'/features/free-trial.html?origin=appstudioforarcgis" target="_blank" class="popup-link">'+jQuery.i18n.prop("common.signin.popupRegNewLink")+"</a></div></div></div></div>"});function n(s){e=s;var r='<div width="100%" height="100%">';r=r+'<div id="popupCloseId" class="popup-close"><span class="glyphicon glyphicon-remove"></span></div>';r=r+j;r=r+"<iframe";r=r+' id="sign-in-frame" scrolling="yes" marginheight="0" marginwidth="0" frameborder="0"';r=r+' class="popup_iframe"';r=r+' src="'+k+"/sharing/oauth2/authorize?";r=r+"client_id="+b;r=r+"&amp;display=iframe";r=r+"&amp;redirect_uri="+h+"signedin.html";r=r+"&amp;response_type=token";r=r+"&amp;display=iframe";r=r+"&amp;expiration="+q;r=r+"&amp;locale="+nls.getLang();r=r+"&amp;parent="+h;r=r+'"></iframe>';r=r+'<div class="popup-email"><a id="subscribeToMarketing" href="#">'+jQuery.i18n.prop("common.signin.subscribeToMarket1")+'</a><span style="margin-top: 0px;" >&nbsp;'+jQuery.i18n.prop("common.signin.subscribeToMarket2")+"</span></div>";r=r+'<iframe id="auth2iframe" class="signin-subscribe" style="display:none;" src="//go.pardot.com/l/82202/2015-09-27/9wv25?locale='+nls.getLang()+'"></iframe>';r=r+"</div>";m=new BootstrapDialog({cssClass:"login-dialog",autodestroy:true,message:$(r),onshown:function(t){$("#subscribeToMarketing").click(function(){var u=$(".signin-subscribe")[0].style.display;if(u){$(".signin-subscribe")[0].style.display=""}else{$(".signin-subscribe")[0].style.display="none"}});$("#popupCloseId").click(function(){t.close()})}});m.open()}function l(r){var s="en-US";if(navigator.language){s=navigator.language}else{if(navigator.userLanguage){s=navigator.userLanguage}}if(r===s){return true}else{if(s.indexOf("-")>-1){if(s.indexOf(r)>-1){return true}}else{if(r.indexOf("-")>-1){if(r.indexOf(s)>-1){return true}}}}return false}function g(t){if(t&&t.length){var r=t.length;for(var s=0;s<r;s++){if(t[s]==="portal:user:createItem"){return true}}}return false}function a(){function s(u){return/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/gi.test(u)}var r=util.queryUrlParameters();if(r&&r.returnUrl){var t=decodeURIComponent(r.returnUrl);if(!s(t)){window.location=t}}window.location=window.location+"apps.html"}function d(r){var s=util.queryUrlParameters(r);if(s&&s.access_token){if(s.expires_in){var t=(new Date()).valueOf();Cookies.set("expires",t+s.expires_in*1000)}user.login(s.access_token,decodeURIComponent(s.username),function(u){if(m){m.close()}if(u.user.orgId){if(e){e()}a();if(!l(u.user.culture)&&!i){i=false;window.location.reload()}}else{if(u.urlKey){}else{}noOrgAccount()}})}else{if(s&&s.error==="invalid_request"){f(jQuery.i18n.prop("common.signin.pubAccountErrDesc"))}else{if(s&&s.error==="insufficient_user_level"){f(jQuery.i18n.prop("common.signin.accountLevelErrDesc"))}else{if(s){f(decodeURIComponent(s.error))}}}console.log(s)}}function f(r){BootstrapDialog.show({title:jQuery.i18n.prop("common.undefinedErrorTitle"),message:r,type:BootstrapDialog.TYPE_WARNING,buttons:[{label:jQuery.i18n.prop("common.ok"),action:function(s){s.close();window.location="index.html"}}]})}c.noOrgAccount=function(){user.logout();BootstrapDialog.show({title:jQuery.i18n.prop("common.undefinedErrorTitle"),message:jQuery.i18n.prop("common.signin.pubAccountErrDesc"),type:BootstrapDialog.TYPE_WARNING,buttons:[{label:jQuery.i18n.prop("common.ok"),action:function(r){r.close();window.location="index.html"}}]})};c.signin=function(s,r){i=r;p();if(k&&b){n(s)}else{$.get("/appstudio/rest/serverrest/getConfig").done(function(t){Cookies.set("client_config",JSON.stringify(t));p();n(s)})}};c.closeDialog=function(r){d(r)};c.signout=function(s,r){if(s&&r){window.location="https://"+s+"."+r+"/sharing/rest/oauth2/signout?client_id="+b+"&redirect_uri="+h}else{window.location="index.html"}};return c}());