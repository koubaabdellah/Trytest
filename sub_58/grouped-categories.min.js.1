(function(n){typeof module=="object"&&module.exports?module.exports=n:n(Highcharts)})(function(n){"use strict";function a(n){return JSON.parse(JSON.stringify(n))}function v(n,t){return this.userOptions=a(n),this.name=n.name||n,this.parent=t,this}function y(n){for(var t=n.length,i=0;t--;)i+=n[t];return i}function ut(n,t,i){for(n.unshift(new v(t,i));i;)i.leaves=i.leaves?i.leaves+1:1,i=i.parent}function p(n,t,i,r,f){var o=n.length,e;for(f=f?f:0,i.depth=i.depth?i.depth:0;o--;)e=n[o],e.categories?(r&&(e.parent=r),p(e.categories,t,i,e,f+1)):ut(t,e,r);i.depth=u(i.depth,f)}function r(n,t,i){t[0]===t[2]&&(t[0]=t[2]=h(t[0])-i%2/2);t[1]===t[3]&&(t[1]=t[3]=h(t[1])+i%2/2);n.push("M",t[0],t[1],"L",t[2],t[3])}function e(n,t){return n.getPosition(n.axis.horiz,t,n.axis.tickmarkOffset)}function o(n,t,i){for(var r=n.length,u;r--;)u=n[r][t],u&&o(u,t,i),i(n[r])}var s=void 0,h=Math.round,w=Math.min,u=Math.max,f=n.merge,c=n.pick,b=n.each,k=window.HighchartsAdapter&&window.HighchartsAdapter.inArray||n.inArray,t=n.Axis.prototype,i=n.Tick.prototype,d=t.init,g=t.render,nt=t.setCategories,l=i.getLabelSize,tt=i.addLabel,it=i.destroy,rt=i.render;v.prototype.toString=function(){for(var t=[],n=this;n;)t.push(n.name),n=n.parent;return t.join(", ")};t.init=function(n,t){d.call(this,n,t);typeof t=="object"&&t.categories&&this.setupGroups(t)};t.setupGroups=function(n){var e=a(n.categories),o=[],i={},s=this.options.labels,r=s.groupedOptions,h=s.style,t,l,u;for(p(e,o,i),this.categoriesTree=e,this.categories=o,this.isGrouped=i.depth!==0,this.labelsDepth=i.depth,this.labelsSizes=[],this.labelsGridPath=[],this.tickLength=n.tickLength||this.tickLength||null,this.tickWidth=c(n.tickWidth,this.isXAxis?1:0),this.directionFactor=[-1,1,1,-1][this.side],this.options.lineWidth=c(n.lineWidth,1),this.groupFontHeights=[],t=0;t<=i.depth;t++)l=r&&r[t-1],u=l&&r[t-1].style?f(h,r[t-1].style):h,this.groupFontHeights[t]=Math.round(this.chart.renderer.fontMetrics(u?u.fontSize:0).b*.3)};t.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),this.originalTickLength===s&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,g.call(this),!this.isGrouped)return this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}),!1;var n=this,u=n.options,f=n.top,e=n.left,y=e+n.width,p=f+n.height,h=n.hasVisibleSeries||n.hasData,c=n.labelsDepth,i=n.labelsGrid,l=n.horiz,w=n.labelsGridPath,a=u.drawHorizontalBorders===!1?c+1:0,t=n.opposite?l?f:y:l?p:e,v=n.tickWidth,b;for(n.userTickLength&&(c-=1),i||(i=n.labelsGrid=n.chart.renderer.path().attr({strokeWidth:v,"stroke-width":v,stroke:u.tickColor||""}).add(n.axisGroup),u.tickColor||i.addClass("highcharts-tick"));a<=c;)t+=n.groupSize(a),b=l?[e,t,y,t]:[t,f,t,p],r(w,b,v),a++;return i.attr({d:w,visibility:h?"visible":"hidden"}),n.labelGroup.attr({visibility:h?"visible":"hidden"}),o(n.categoriesTree,"categories",function(t){var i=t.tick;return i?(i.startAt+i.leaves-1<n.min||i.startAt>n.max?(i.label.hide(),i.destroyed=0):i.label.attr({visibility:h?"visible":"hidden"}),!0):!1}),!0};t.setCategories=function(n,t){this.categories&&this.cleanGroups();this.setupGroups({categories:n});this.categories=this.userOptions.categories=n;nt.call(this,this.categories,t)};t.cleanGroups=function(){var n=this.ticks;for(var t in n)n[t].parent&&delete n[t].parent;o(this.categoriesTree,"categories",function(n){var t=n.tick;return t?(t.label.destroy(),b(t,function(n,i){delete t[i]}),delete n.tick,!0):!1});this.labelsGrid=null};t.groupSize=function(n,t){var i=this.labelsSizes,f=this.directionFactor,r=this.options.labels.groupedOptions?this.options.labels.groupedOptions[n-1]:!1,e=0;return(r&&(e=f===-1?r.x?r.x:0:r.y?r.y:0),t!==s&&(i[n]=u(i[n]||0,t+10+Math.abs(e))),n===!0)?y(i)*f:i[n]?i[n]*f:0};i.addLabel=function(){var n;return(tt.call(this),!this.axis.categories||!(n=this.axis.categories[this.pos]))?!1:(this.label&&this.label.attr("text",this.axis.labelFormatter.call({axis:this.axis,chart:this.axis.chart,isFirst:this.isFirst,isLast:this.isLast,value:n.name})),this.axis.isGrouped&&this.axis.options.labels.enabled&&this.addGroupedLabels(n),!0)};i.addGroupedLabels=function(n){for(var t=this,u=this.axis,a=u.chart,r=u.options.labels,v=r.useHTML,s=r.style,e=r.groupedOptions,h={align:"center",rotation:r.rotation,x:0,y:0},y=u.horiz?"height":"width",i=0,c;t;){if(i>0&&!n.tick){this.value=n.name;var p=r.formatter?r.formatter.call(this,n):n.name,l=e&&e[i-1],o=l?f(h,e[i-1]):h,w=l&&e[i-1].style?f(s,e[i-1].style):s;delete o.style;c=a.renderer.text(p,0,0,v).attr(o).css(w).add(u.labelGroup);t.startAt=this.pos;t.childCount=n.categories.length;t.leaves=n.leaves;t.visible=this.childCount;t.label=c;t.labelOffsets={x:o.x,y:o.y};n.tick=t}t&&u.groupSize(i,t.label.getBBox()[y]);n=n.parent;t=n?t.parent=n.tick||{}:null;i++}};i.render=function(n,t,i){function vt(n){var t=0;return it?(t=k(n.name,n.parent.categories),t<0?0:t):t}var g;if(rt.call(this,n,t,i),g=this.axis.categories[this.pos],this.axis.isGrouped&&g&&!(this.pos>this.axis.max)){var v=this,l=v,f=v.axis,st=v.pos,it=v.isFirst,ht=f.max,ct=f.min,s=f.horiz,y=f.labelsGridPath,h=f.groupSize(0),b=f.tickWidth,o=e(v,st),lt=s?o.y:o.x,at=f.chart.renderer.fontMetrics(f.options.labels.style?f.options.labels.style.fontSize:0).b,nt=1,a=s&&o.x===f.pos+f.len||!s&&o.y===f.pos?-1:0,ut,p,tt,c,d,ft;for(it&&(ut=s?[f.left,o.y,f.left,o.y+f.groupSize(!0)]:f.isXAxis?[o.x,f.top,o.x+f.groupSize(!0),f.top]:[o.x,f.top+f.len,o.x+f.groupSize(!0),f.top+f.len],r(y,ut,b)),s&&f.left<o.x?r(y,[o.x-a,o.y,o.x-a,o.y+h],b):!s&&f.top<=o.y&&r(y,[o.x,o.y+a,o.x+h,o.y+a],b),h=lt+h;l.parent;){l=l.parent;var yt=vt(g),et=l.labelOffsets.x,ot=l.labelOffsets.y;tt=e(v,u(l.startAt-1,ct-1));c=e(v,w(l.startAt+l.leaves-1-yt,ht));ft=l.label.getBBox(!0);p=f.groupSize(nt);a=s&&c.x===f.pos+f.len||!s&&c.y===f.pos?-1:0;d=s?{x:(tt.x+c.x)/2+et,y:h+f.groupFontHeights[nt]+p/2+ot/2}:{x:h+p/2+et,y:(tt.y+c.y-ft.height)/2+at+ot};isNaN(d.x)||isNaN(d.y)||(l.label.attr(d),y&&(s&&f.left<c.x?r(y,[c.x-a,h,c.x-a,h+p],b):!s&&f.top<=c.y&&r(y,[h,c.y+a,h+p,c.y+a],b)));h+=p;nt++}}};i.destroy=function(){for(var n=this.parent;n;)n.destroyed=n.destroyed?n.destroyed+1:1,n=n.parent;it.call(this)};i.getLabelSize=function(){if(this.axis.isGrouped===!0){var n=l.call(this)+10,t=this.axis.labelsSizes[0];return t<n&&(this.axis.labelsSizes[0]=n),y(this.axis.labelsSizes)}return l.call(this)}});