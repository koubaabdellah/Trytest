"use strict";(self.webpackChunkafd_site=self.webpackChunkafd_site||[]).push([[1745],{39752:function(e,t,r){r.d(t,{qp:function(){return w},fC:function(){return a},Ye:function(){return p},rV:function(){return c},m_:function(){return h},tX:function(){return d},al:function(){return o},AW:function(){return Z},dc:function(){return U},Q4:function(){return l},cl:function(){return g},KT:function(){return y},Ju:function(){return P},ll:function(){return f},lF:function(){return G},$G:function(){return s},Nq:function(){return D}});var n=r(37273);function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.portal?(0,n.bw)(e.portal):e.authentication&&"string"!=typeof e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}function i(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}function s(e){return i(e).then((function(t){var r=e.folderId?"".concat(o(e),"/content/users/").concat(t,"/").concat(e.folderId,"/items/").concat(e.item.id,"/update"):"".concat(o(e),"/content/users/").concat(t,"/items/").concat(e.item.id,"/update");return e.params=Object.assign(Object.assign({},e.params),e.item),(0,n.WY)(r,e)}))}function a(e){return function(e){return e.multipart&&!e.filename?Promise.reject(new Error("The filename is required for a multipart request.")):i(e).then((function(t){var r="".concat(o(e),"/content/users/").concat(t),i="".concat(r,"/addItem");e.folderId&&(i="".concat(r,"/").concat(e.folderId,"/addItem")),e.params=Object.assign(Object.assign({},e.params),e.item);var s=(0,n.tH)(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return(0,n.WY)(i,s)}))}(Object.assign({folderId:null},e))}function c(e,t){var r=u(e,t),o=Object.assign({httpMethod:"GET"},t);return(0,n.WY)(r,o)}var u=function(e,t){var r="string"==typeof t?t:o(t);return"".concat(r,"/content/items/").concat(e)};function h(e,t){var r="".concat(u(e,t),"/data"),o=Object.assign({httpMethod:"GET",params:{}},t);return o.file&&(o.params.f=null),(0,n.WY)(r,o).catch((function(e){if(!RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i).test(e.message))throw e}))}function d(e,t){var r="".concat(u(e,t),"/groups");return(0,n.WY)(r,t)}function l(e){return i(e).then((function(t){var r="".concat(o(e),"/content/users/").concat(t,"/items/").concat(e.id,"/protect");return(0,n.WY)(r,e)}))}function f(e){return i(e).then((function(t){var r="".concat(o(e),"/content/users/").concat(t,"/items/").concat(e.id,"/unprotect");return(0,n.WY)(r,e)}))}function p(e,t){var r="".concat(o(t),"/content/groups/").concat(e),i=Object.assign(Object.assign({httpMethod:"GET"},{params:{start:1,num:100}}),t);return t&&t.paging&&(i.params=Object.assign({},t.paging)),(0,n.WY)(r,i)}function m(e){return function(e,t){var r="".concat(o(t),"/community/groups/").concat(e),i=Object.assign({httpMethod:"GET"},t);return(0,n.WY)(r,i)}(e.groupId,e).then((function(e){return e.userMembership.memberType})).catch((function(){return"none"}))}function g(e){return i(e).then((function(t){var r="".concat(o(e),"/content/users/").concat(t,"/items/").concat(e.id,"/delete");return(0,n.WY)(r,e)}))}var v=r(22951),k=r(91976),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(0,v.Z)(this,e),this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=t}return(0,k.Z)(e,[{key:"match",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.termStack=this.termStack.concat(t),this}},{key:"in",value:function(e){var t="`in(".concat(e?'"'.concat(e,'"'):"",")`");return this.hasRange||this.hasTerms?(e&&"*"!==e&&(this.q+="".concat(e,":")),this.commit()):((0,n.ZK)("".concat(t," was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified.")),this)}},{key:"startGroup",value:function(){return this.commit(),this.openGroups>0&&(this.q+=" "),this.openGroups++,this.q+="(",this}},{key:"endGroup",value:function(){return this.openGroups<=0?((0,n.ZK)("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."),this):(this.commit(),this.openGroups--,this.q+=")",this)}},{key:"and",value:function(){return this.addModifier("and")}},{key:"or",value:function(){return this.addModifier("or")}},{key:"not",value:function(){return this.addModifier("not")}},{key:"from",value:function(e){return this.hasTerms?((0,n.ZK)('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.'),this):(this.rangeStack[0]=e,this)}},{key:"to",value:function(e){return this.hasTerms?((0,n.ZK)('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.'),this):(this.rangeStack[1]=e,this)}},{key:"boost",value:function(e){return this.commit(),this.q+="^".concat(e),this}},{key:"toParam",value:function(){return this.commit(),this.cleanup(),this.q}},{key:"clone",value:function(){return this.commit(),this.cleanup(),new e(this.q+"")}},{key:"addModifier",value:function(e){return this.currentModifer?((0,n.ZK)("You have called `".concat(this.currentModifer,"()` after `").concat(e,"()`. Your current query was not modified.")),this):(this.commit(),""===this.q&&"not"!==e?((0,n.ZK)("You have called `".concat(e,"()` without calling another method to modify your query first. Try calling `match()` first.")),this):(this.currentModifer=e,this.q+=""===this.q?"":" ",this.q+="".concat(e.toUpperCase()," "),this))}},{key:"hasWhiteSpace",value:function(e){return/\s/g.test(e)}},{key:"formatTerm",value:function(e){return e instanceof Date?e.getTime():"string"==typeof e&&this.hasWhiteSpace(e)?'"'.concat(e,'"'):e}},{key:"commit",value:function(){var e=this;return this.currentModifer=void 0,this.hasRange&&(this.q+="[".concat(this.formatTerm(this.rangeStack[0])," TO ").concat(this.formatTerm(this.rangeStack[1]),"]"),this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map((function(t){return e.formatTerm(t)})).join(" "),this.termStack=[]),this}},{key:"hasTerms",get:function(){return this.termStack.length>0}},{key:"hasRange",get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]}},{key:"cleanup",value:function(){if(this.openGroups>0)for((0,n.ZK)("Automatically closing ".concat(this.openGroups," group(s). You can use `endGroup(...)` to remove this warning."));this.openGroups>0;)this.q+=")",this.openGroups--;var e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,""),e!==this.q&&(0,n.ZK)("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")}}]),e}();function E(e,t){var r,i;switch(r="string"==typeof e||e instanceof w?{httpMethod:"GET",params:{q:e}}:(0,n.tH)(e,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"}),t){case"item":i="/search";break;case"group":i="/community/groups";break;case"groupContent":if("string"==typeof e||e instanceof w||!e.groupId)return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"));i="/content/groups/".concat(e.groupId,"/search");break;default:i="/portals/self/users/search"}var s=o(r)+i;return(0,n.WY)(s,r).then((function(r){return r.nextStart&&-1!==r.nextStart&&(r.nextPage=function(){var n;return"string"==typeof e||e instanceof w?n={q:e,start:r.nextStart}:(n=e).start=r.nextStart,E(n,t)}),r}))}function y(e){return E(e,"item")}var T=r(64649),_=r(649);function O(e,t){if(0===e.length)return[];for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}function R(e){var t=e.id,r="".concat(o(e),"/community/groups/").concat(t,"/addUsers"),i=Object.assign({},e,{admins:void 0,users:void 0}),s=[].concat((0,_.Z)(I("users",e.users,i)),(0,_.Z)(I("admins",e.admins,i))).map((function(e){return function(e,t){return(0,n.WY)(e,t).catch((function(e){return{errors:[e]}}))}(r,e)}));return Promise.all(s).then(S)}function I(e,t,r){return!t||t.length<1?[]:O(t,25).map((function(t){return function(e,t,r){var n;return Object.assign({},r,(n={},(0,T.Z)(n,e,t),(0,T.Z)(n,"params",Object.assign(Object.assign({},r.params),(0,T.Z)({},e,t))),n))}(e,t,r)}))}function S(e){var t=e.filter((function(e){return e.notAdded})).reduce((function(e,t){return e.concat(t.notAdded)}),[]),r=e.filter((function(e){return e.errors})).reduce((function(e,t){return e.concat(t.errors)}),[]),n={notAdded:t};return r.length>0&&(n.errors=r),n}function A(e){var t=e.id,r=e.users,i="".concat(o(e),"/community/groups/").concat(t,"/removeUsers"),s=O(r,25).map((function(t){return r=t,o=Object.assign(Object.assign({},e),{users:r,params:{users:r}}),(0,n.WY)(i,o).catch((function(e){return{errors:[e]}}));var r,o}));return Promise.all(s).then((function(e){var t=function(t){return e.filter((function(e){return e[t]})).reduce((function(e,r){return e.concat(r[t])}),[])},r=t("errors"),n={notRemoved:t("notRemoved")};return r.length?Object.assign(Object.assign({},n),{errors:r}):n}))}function b(e){var t="".concat(o(e),"/community/groups/").concat(e.id,"/updateUsers"),r={authentication:e.authentication,params:{}};return"admin"===e.newMemberType?r.params.admins=e.users:r.params.users=e.users,(0,n.WY)(t,r)}function x(e){var t,r={httpMethod:"GET"};if("string"==typeof e)t="https://www.arcgis.com/sharing/rest/community/users/".concat(e);else{var i=e.username||e.authentication.username;t="".concat(o(e),"/community/users/").concat(encodeURIComponent(i)),r=Object.assign(Object.assign({},e),r)}return(0,n.WY)(t,r)}function U(e){var t=e.username||e.authentication.username,r="".concat(o(e),"/community/users/").concat(encodeURIComponent(t),"/tags");return(0,n.WY)(r,e)}function D(e){var t=e.user.username||e.authentication.username,r="".concat(o(e),"/community/users/").concat(encodeURIComponent(t),"/update");return e.params=Object.assign(Object.assign({},e.user),e.params),delete e.user,(0,n.WY)(r,e)}var j=r(11026);function C(e){return y({q:"id: ".concat(e.id," AND group: ").concat(e.groupId),start:1,num:10,sortField:"title",authentication:e.authentication,httpMethod:"POST"}).then((function(t){if(t.total>0)return t.results.some((function(t){return t.id===e.id}))}))}function P(e){return C(e).then((function(t){if(t)return{itemId:e.id,shortcut:!0,notSharedWith:[]};var r=e.authentication.username,n=e.owner,o=e.confirmItemControl,i=n||r;if(i!==r){var s=!1,a=!1;return Promise.all([x({username:r,authentication:e.authentication}),x({username:i,authentication:e.authentication}),m(e)]).then((function(t){var r=(0,j.Z)(t,3),n=r[0],i=r[1],c=r[2],u=!!o;return s="org_admin"===n.role&&!n.roleId,a=n.orgId!==i.orgId,function(e,t,r,n,o,i){var s=[];if(i.groupId!==e.favGroupId)if(t){if(!n)throw Error("This item can not be shared to shared editing group ".concat(i.groupId," by ").concat(e.username," as they not the item owner or org admin."));s.push(q(e,e,!1,"Error adding ".concat(e.username," as member to edit group ").concat(i.groupId,". Consequently item ").concat(i.id," was not shared to the group."),i),q(e,o,!0,"none"===r?"Error adding user ".concat(o.username," to edit group ").concat(i.groupId,". Consequently item ").concat(i.id," was not shared to the group."):"Error promoting user ".concat(o.username," to admin in edit group ").concat(i.groupId,". Consequently item ").concat(i.id," was not shared to the group."),i))}else if(n)s.push(q(e,e,!1,"Error adding ".concat(e.username," as member to view group ").concat(i.groupId,". Consequently item ").concat(i.id," was not shared to the group."),i));else if("none"===r)throw new Error("This item can not be shared by ".concat(e.username," as they are not a member of the specified group ").concat(i.groupId,"."));return s}(n,u,c,s,i,e)})).then((function(t){var r=(0,j.Z)(t,1)[0],n=(r=void 0===r?{promise:Promise.resolve({notAdded:[]}),revert:function(e){return Promise.resolve(e)}}:r).revert;return Promise.all(t.map((function(e){return e.promise}))).then((function(){return N(e,s,a)})).then((function(e){return n(e)}))}))}return N(e)})).then((function(t){if(t.notSharedWith.length)throw Error("Item ".concat(e.id," could not be shared to group ").concat(e.groupId,"."));return t}))}function N(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.authentication.username,s=e.owner||i,a="".concat(o(e),"/content/items/").concat(e.id,"/share");return(s===i||t&&!r)&&(a="".concat(o(e),"/content/users/").concat(s,"/items/").concat(e.id,"/share")),e.params={groups:e.groupId,confirmItemControl:e.confirmItemControl},(0,n.WY)(a,e)}function q(e,t,r,n,o){var i,s,a=t.groups||[],c=a.find((function(e){return e.id===o.groupId}));if(e.orgId!==t.orgId)throw Error("User ".concat(t.username," is not a member of the same org as ").concat(e.username,". Consequently they can not be added added to group ").concat(o.groupId," nor can item ").concat(o.id," be shared to the group."));if(!c&&a.length>511)throw Error("User ".concat(t.username," already has 512 groups, and can not be added to group ").concat(o.groupId,". Consequently item ").concat(o.id," can not be shared to the group."));if(c)r&&"member"===c.userMembership.memberType?(i=b({id:o.groupId,users:[t.username],newMemberType:"admin",authentication:o.authentication}).then((function(e){var t=e.results.reduce((function(e,t){return t.success||e.push(t.username),e}),[]);return Promise.resolve({notAdded:t})})).catch((function(){return{notAdded:[t.username]}})),s=function(e){return b({id:o.groupId,users:[t.username],newMemberType:"member",authentication:o.authentication}).then((function(){return e})).catch((function(){return e}))}):(i=Promise.resolve({notAdded:[]}),s=function(e){return Promise.resolve(e)});else{var u,h=r?"admins":"users";i=R((u={id:o.groupId},(0,T.Z)(u,h,[t.username]),(0,T.Z)(u,"authentication",o.authentication),u)).then((function(e){if(e.errors&&e.errors.length)throw e.errors[0];return e})).catch((function(){return{notAdded:[t.username]}})),s=function(e){return A({id:o.groupId,users:[t.username],authentication:o.authentication}).then((function(){return e}))}}return{promise:i.then((function(e){if(e.notAdded.length)throw new Error(n);return e})),revert:s}}function G(e){return C(e).then((function(t){if(!t)return Promise.resolve({itemId:e.id,shortcut:!0,notUnsharedFrom:[]});var r=e.authentication.username,i=e.owner;return Promise.all([m(e),x({username:r,authentication:e.authentication})]).then((function(t){var s=(0,j.Z)(t,2),a=s[0],c=s[1],u=(i||r)===r,h="org_admin"===c.role&&!c.roleId;if(!u&&!h&&["admin","owner"].indexOf(a)<0)throw Error("This item can not be unshared from group ".concat(e.groupId," by ").concat(r," as they not the item owner, an org admin, group admin or group owner."));return function(e){var t=e.authentication.username,r=e.owner||t,i="".concat(o(e),"/content/items/").concat(e.id,"/unshare");r===t&&(i="".concat(o(e),"/content/users/").concat(r,"/items/").concat(e.id,"/unshare"));return e.params={groups:e.groupId},(0,n.WY)(i,e)}(e)})).then((function(t){if(t.notUnsharedFrom.length)throw Error("Item ".concat(e.id," could not be unshared to group ").concat(e.groupId));return t}))}))}function Z(e){return function(e,t){var r=e||"self",i="".concat(o(t),"/portals/").concat(r),s=Object.assign({httpMethod:"GET"},t);return(0,n.WY)(i,s)}(null,e)}},37273:function(e,t,r){r.d(t,{yE:function(){return g},cv:function(){return E},tH:function(){return R},bw:function(){return U},t1:function(){return l},Ov:function(){return J},EC:function(){return j},WY:function(){return O},ZK:function(){return v}});var n=r(22951),o=r(91976),i=r(47169),s=r(67591),a=r(68513),c=r(27597);r(99467);function u(e){return Object.keys(e).some((function(t){var r=e[t];if(!r)return!1;switch(r&&r.toParam&&(r=r.toParam()),r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function h(e){var t={};return Object.keys(e).forEach((function(r){var n,o,i=e[r];if(i&&i.toParam&&(i=i.toParam()),i||0===i||"boolean"==typeof i||"string"==typeof i){var s;switch(i.constructor.name){case"Array":var a=null===(o=null===(n=i[0])||void 0===n?void 0:n.constructor)||void 0===o?void 0:o.name;s="Array"===a?i:"Object"===a?JSON.stringify(i):i.join(",");break;case"Object":s=JSON.stringify(i);break;case"Date":s=i.valueOf();break;case"Function":s=null;break;case"Boolean":s=i+"";break;default:s=i}(s||0===s||"string"==typeof s||Array.isArray(s))&&(t[r]=s)}})),t}function d(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return d(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function l(e){var t=h(e);return Object.keys(t).map((function(e){return d(e,t[e])})).join("&")}var f=r(9263);var p=r(54138);function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var o=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}var g=function(e){(0,s.Z)(r,e);var t=m(r);function r(e,o,s,a,c){var u;(0,n.Z)(this,r),u=t.call(this,e);var h=(this instanceof r?this.constructor:void 0).prototype;return Object.setPrototypeOf((0,i.Z)(u),h),e=e||"UNKNOWN_ERROR",o=o||"UNKNOWN_ERROR_CODE",u.name="ArcGISRequestError",u.message="UNKNOWN_ERROR_CODE"===o?e:"".concat(o,": ").concat(e),u.originalMessage=e,u.code=o,u.response=s,u.url=a,u.options=c,u}return(0,o.Z)(r)}((0,p.Z)(Error));function v(e){console&&console.warn&&console.warn.apply(console,[e])}var k=r(61852);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var o=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}var E="@esri/arcgis-rest-js";var y,T=function(e){(0,s.Z)(r,e);var t=w(r);function r(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AUTHENTICATION_ERROR",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AUTHENTICATION_ERROR_CODE",a=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;(0,n.Z)(this,r),(e=t.call(this,o,s,a,c,u)).name="ArcGISAuthError",e.message="AUTHENTICATION_ERROR_CODE"===s?o:"".concat(s,": ").concat(o);var h=(this instanceof r?this.constructor:void 0).prototype;return Object.setPrototypeOf((0,i.Z)(e),h),e}return(0,o.Z)(r,[{key:"retry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,o=function o(i,s){n+=1,e(t.url,t.options).then((function(e){var r=Object.assign(Object.assign({},t.options),{authentication:e});return _(t.url,r)})).then((function(e){i(e)})).catch((function(e){"ArcGISAuthError"===e.name&&n<r?o(i,s):e.name===t.name&&e.message===t.message&&n>=r?s(t):s(e)}))};return new Promise((function(e,t){o(e,t)}))}}]),r}(g);function _(e,t){var r,n=globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}},o=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},n),t),{params:Object.assign(Object.assign({},n.params),t.params),headers:Object.assign(Object.assign({},n.headers),t.headers)}),i=o.httpMethod,s=o.rawResponse,a=Object.assign({f:"json"},o.params),c=null,d={method:i,signal:o.signal,credentials:o.credentials||"same-origin"};if(o.headers&&o.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(d.credentials="include"),"string"==typeof o.authentication){var p=o.authentication;r={portal:"https://www.arcgis.com/sharing/rest",getToken:function(){return Promise.resolve(p)}},o.authentication.startsWith("AAPK")||o.suppressWarnings||globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING||(v("Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information."),globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=!0)}else r=o.authentication;var m=e;return(r?r.getToken(e).catch((function(t){return t.url=e,t.options=o,c=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(a.token=t),r&&r.getDomainCredentials&&(d.credentials=r.getDomainCredentials(e));var n={};if("GET"===d.method){a.token&&o.hideToken&&"undefined"==typeof window&&(n["X-Esri-Authorization"]="Bearer ".concat(a.token),delete a.token);var i=""===l(a)?e:e+"?"+l(a);o.maxUrlLength&&i.length>o.maxUrlLength||a.token&&o.hideToken?(d.method="POST",t.length&&o.hideToken&&(a.token=t,delete n["X-Esri-Authorization"])):e=i}var s=new RegExp("/items/.+/updateResources").test(e);return"POST"===d.method&&(d.body=function(e,t){var r=u(e)||t,n=h(e);if(r){var o=new f.Ct;return Object.keys(n).forEach((function(e){if("undefined"!=typeof Blob&&n[e]instanceof Blob){var t=n.fileName||n[e].name||e;o.append(e,n[e],t)}else o.append(e,n[e])})),o}return l(e)}(a,s)),d.headers=Object.assign(Object.assign({},n),o.headers),("undefined"==typeof window||window&&void 0===window.document)&&!d.headers.referer&&(d.headers.referer=E),u(a)||s||(d.headers["Content-Type"]="application/x-www-form-urlencoded"),globalThis.fetch?globalThis.fetch(e,d):(0,k.w)().then((function(t){return(0,t.fetch)(e,d)}))})).then((function(t){if(!t.ok){var r=t.status,n=t.statusText;throw new g(n,"HTTP ".concat(r),t,e,o)}if(s)return t;switch(a.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==a.f&&"geojson"!==a.f||s)return t;var r=function(e,t,r,n,o){if(e.code>=400){var i=e.message,s=e.code;throw new g(i,s,e,t,n)}if(e.error){var a=e.error,c=a.message,u=a.code,h=a.messageCode||u||"UNKNOWN_ERROR_CODE";if(498===u||499===u)throw o||new T(c,h,e,t,n);throw new g(c,h,e,t,n)}if("failed"===e.status||"failure"===e.status){var d,l="UNKNOWN_ERROR_CODE";try{d=JSON.parse(e.statusMessage).message,l=JSON.parse(e.statusMessage).code}catch(f){d=e.statusMessage||e.message}throw new g(d,l,e,t,n)}return e}(t,m,0,o,c);if(c){var n=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];o.authentication.federatedServers[n]={token:[],expires:new Date(Date.now()+864e5)},c=null}return r}))}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{params:{f:"json"}};return _(e,t).catch((function(e){return e instanceof T&&t.authentication&&"string"!=typeof t.authentication&&t.authentication.canRefresh&&t.authentication.refreshCredentials?e.retry((function(){return t.authentication.refreshCredentials()}),1):Promise.reject(e)}))}function R(e,t,r){var n=Object.assign(Object.assign({params:{}},r),e);return n.params=t.reduce((function(t,r){return(e[r]||"boolean"==typeof e[r]||"number"==typeof e[r]&&0===e[r])&&(t[r]=e[r]),t}),n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce((function(e,t){return n[t]&&(e[t]=n[t]),e}),{})}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var o=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}!function(e){e.TOKEN_REFRESH_FAILED="TOKEN_REFRESH_FAILED",e.GENERATE_TOKEN_FOR_SERVER_FAILED="GENERATE_TOKEN_FOR_SERVER_FAILED",e.REFRESH_TOKEN_EXCHANGE_FAILED="REFRESH_TOKEN_EXCHANGE_FAILED",e.NOT_FEDERATED="NOT_FEDERATED",e.UNKNOWN_ERROR_CODE="UNKNOWN_ERROR_CODE"}(y||(y={}));var S=function(e){(0,s.Z)(r,e);var t=I(r);function r(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNKNOWN_ERROR",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.UNKNOWN_ERROR_CODE,a=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;(0,n.Z)(this,r),e=t.call(this,o);var h=(this instanceof r?this.constructor:void 0).prototype;return Object.setPrototypeOf((0,i.Z)(e),h),e.name="ArcGISTokenRequestError",e.message="".concat(s,": ").concat(o),e.originalMessage=o,e.code=s,e.response=a,e.url=c,e.options=u,e}return(0,o.Z)(r)}((0,p.Z)(Error));function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var o=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}var b,x=function(e){(0,s.Z)(r,e);var t=A(r);function r(){var e;(0,n.Z)(this,r);e=t.call(this,"The user has denied your authorization request.");var o=(this instanceof r?this.constructor:void 0).prototype;return Object.setPrototypeOf((0,i.Z)(e),o),e.name="ArcGISAccessDeniedError",e}return(0,o.Z)(r)}((0,p.Z)(Error));function U(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError",e.ArcGISAccessDeniedError="ArcGISAccessDeniedError",e.ArcGISTokenRequestError="ArcGISTokenRequestError"}(b||(b={}));var D=3e5;function j(e,t){var r=t;return r.rawResponse=!1,O(e,r).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+1e3*e.expires_in-D),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),e.refresh_token_expires_in&&(t.refreshTokenExpires=new Date(Date.now()+1e3*e.refresh_token_expires_in-D)),t}))}var C=r(66470),P=r(55181),N=r(64013),q=r(53764);var G=r(11026);function Z(e){return!e||e.length<=0?{}:e.replace(/^#/,"").replace(/^\?/,"").split("&").reduce((function(e,t){var r=function(e){var t=e.split("="),r=(0,G.Z)(t,2),n=r[0],o=r[1];return{key:decodeURIComponent(n),value:decodeURIComponent(o)}}(t),n=r.key,o=r.value;return e[n]=o,e}),{})}var M=/^https?:\/\/(\S+)\.arcgis\.com.+/;function F(e){return M.test(e)}function W(e){if(!M.test(e))return null;var t=e.match(M)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function K(e,t){var r=U(function(e){if(!M.test(e))return e;switch(W(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=U(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(r)}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return!t&&window&&(t=window),t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function H(e){return!e&&window&&(e=window),z(e.crypto.getRandomValues(new Uint8Array(32)))}var Y=function(){function e(t){if((0,n.Z)(this,e),this.clientId=t.clientId,this._refreshToken=t.refreshToken,this._refreshTokenExpires=t.refreshTokenExpires,this._username=t.username,this.password=t.password,this._token=t.token,this._tokenExpires=t.tokenExpires,this.portal=t.portal?U(t.portal):"https://www.arcgis.com/sharing/rest",this.ssl=t.ssl,this.provider=t.provider||"arcgis",this.tokenDuration=t.tokenDuration||20160,this.redirectUri=t.redirectUri,this.server=t.server,this.federatedServers={},this.trustedDomains=[],t.server){var r=this.getServerRootUrl(t.server);this.federatedServers[r]={token:t.token,expires:t.tokenExpires}}this._pendingTokenRequests={}}return(0,o.Z)(e,[{key:"token",get:function(){return this._token}},{key:"tokenExpires",get:function(){return this._tokenExpires}},{key:"refreshToken",get:function(){return this._refreshToken}},{key:"refreshTokenExpires",get:function(){return this._refreshTokenExpires}},{key:"username",get:function(){return this._username?this._username:this._user&&this._user.username?this._user.username:void 0}},{key:"canRefresh",get:function(){return!(!this.username||!this.password)||!!(this.clientId&&this.refreshToken&&this.redirectUri)}},{key:"toCredential",value:function(){return{expires:this.tokenExpires.getTime(),server:this.server||this.portal,ssl:this.ssl,token:this.token,userId:this.username}}},{key:"getUser",value:function(e){var t=this;if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);var r="".concat(this.portal,"/community/self"),n=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=O(r,n).then((function(e){return t._user=e,t._pendingUserRequest=null,e})),this._pendingUserRequest}},{key:"getPortal",value:function(e){var t=this;if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);var r="".concat(this.portal,"/portals/self"),n=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=O(r,n).then((function(e){return t._portalInfo=e,t._pendingPortalRequest=null,e})),this._pendingPortalRequest}},{key:"getUsername",value:function(){return this.username?Promise.resolve(this.username):this.getUser().then((function(e){return e.username}))}},{key:"getToken",value:function(e,t){return r=this.portal,n=e,o=F(r),i=F(n),s=W(r),a=W(n),o&&i&&s===a||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t);var r,n,o,i,s,a}},{key:"validateAppAccess",value:function(e){return this.getToken(this.portal).then((function(t){return function(e,t){return O("".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://www.arcgis.com/sharing/rest","/oauth2/validateAppAccess"),{method:"POST",params:{f:"json",client_id:t,token:e}})}(t,e)}))}},{key:"toJSON",value:function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires||void 0,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires||void 0,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,server:this.server}}},{key:"serialize",value:function(){return JSON.stringify(this)}},{key:"enablePostMessageAuth",value:function(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)}},{key:"disablePostMessageAuth",value:function(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)}},{key:"refreshCredentials",value:function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new S("Unable to refresh token. No refresh token or password present.",y.TOKEN_REFRESH_FAILED))}},{key:"getServerRootUrl",value:function(e){var t,r=U(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/),n=(0,G.Z)(r,1)[0].match(/(https?:\/\/)(.+)/),o=(0,G.Z)(n,3),i=(o[0],o[1]),s=o[2].split("/"),a=(t=s,(0,C.Z)(t)||(0,P.Z)(t)||(0,N.Z)(t)||(0,q.Z)()),c=a[0],u=a.slice(1);return"".concat(i).concat(c.toLowerCase(),"/").concat(u.join("/"))}},{key:"getDomainCredentials",value:function(e){return this.trustedDomains&&this.trustedDomains.length&&this.trustedDomains.some((function(t){return e.startsWith(t)}))?"include":"same-origin"}},{key:"signOut",value:function(){return e.destroy(this)}},{key:"createPostMessageHandler",value:function(e){var t=this;return function(r){var n=e.indexOf(r.origin)>-1,o="arcgis:auth:requestCredential"===r.data.type,i=t.tokenExpires.getTime()>Date.now();if(n&&o){var s={};if(i)s={type:"arcgis:auth:credential",credential:t.toJSON()};else s={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Token was expired, and not returned to the child application"}};r.source.postMessage(s,r.origin)}}}},{key:"getTokenForServer",value:function(e,t){var r=this,n=this.getServerRootUrl(e),o=this.federatedServers[n];return o&&o.expires&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):(this._pendingTokenRequests[n]||(this._pendingTokenRequests[n]=this.fetchAuthorizedDomains().then((function(){return O("".concat(n,"/rest/info"),{credentials:r.getDomainCredentials(e)}).then((function(o){if(o.owningSystemUrl){if(K(o.owningSystemUrl,r.portal))return O("".concat(o.owningSystemUrl,"/sharing/rest/info"),t);throw new S("".concat(e," is not federated with ").concat(r.portal,"."),y.NOT_FEDERATED)}if(o.authInfo&&void 0!==r.federatedServers[n])return Promise.resolve({authInfo:o.authInfo});throw new S("".concat(e," is not federated with any portal and is not explicitly trusted."),y.NOT_FEDERATED)})).then((function(e){return r.token&&r.tokenExpires.getTime()<Date.now()?r.server?r.refreshCredentials().then((function(){return{token:r.token,expires:r.tokenExpires}})):r.refreshCredentials().then((function(){return r.generateTokenForServer(e.authInfo.tokenServicesUrl,n)})):r.generateTokenForServer(e.authInfo.tokenServicesUrl,n)})).then((function(e){return r.federatedServers[n]=e,delete r._pendingTokenRequests[n],e.token}))}))),this._pendingTokenRequests[n])}},{key:"generateTokenForServer",value:function(e,t){return O(e,{params:{token:this.token,serverUrl:t,expiration:this.tokenDuration}}).then((function(e){return{token:e.token,expires:new Date(e.expires-3e5)}})).catch((function(e){throw new S(e.message,y.GENERATE_TOKEN_FOR_SERVER_FAILED,e.response,e.url,e.options)}))}},{key:"getFreshToken",value:function(e){var t=this;return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshCredentials(e).then((function(){return t._pendingTokenRequests[t.portal]=null,t.token}))),this._pendingTokenRequests[this.portal])}},{key:"refreshWithUsernameAndPassword",value:function(e){var t=this,r={username:this.username,password:this.password,expiration:this.tokenDuration,client:"referer",referer:"undefined"!=typeof window&&void 0!==window.document&&window.location&&window.location.origin?window.location.origin:E};return(this.server?O("".concat(this.getServerRootUrl(this.server),"/rest/info")).then((function(t){return O(t.authInfo.tokenServicesUrl,Object.assign({params:r},e))})):O("".concat(this.portal,"/generateToken"),Object.assign({params:r},e))).then((function(e){return t.updateToken(e.token,new Date(e.expires)),t})).catch((function(e){throw new S(e.message,y.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)}))}},{key:"refreshWithRefreshToken",value:function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()-864e5<Date.now())return this.exchangeRefreshToken(e);var r=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return j("".concat(this.portal,"/oauth2/token"),r).then((function(e){return t.updateToken(e.token,e.expires)})).catch((function(e){throw new S(e.message,y.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)}))}},{key:"updateToken",value:function(e,t){return this._token=e,this._tokenExpires=t,this}},{key:"exchangeRefreshToken",value:function(e){var t=this,r=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return j("".concat(this.portal,"/oauth2/token"),r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=e.refreshTokenExpires,t})).catch((function(e){throw new S(e.message,y.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)}))}},{key:"fetchAuthorizedDomains",value:function(){var e=this;return this.server||!this.portal?Promise.resolve(this):this.getPortal().then((function(t){return t.authorizedCrossOriginDomains&&t.authorizedCrossOriginDomains.length&&(e.trustedDomains=t.authorizedCrossOriginDomains.filter((function(e){return!e.startsWith("http://")})).map((function(e){return e.startsWith("https://")?e:"https://".concat(e)}))),e}))}}],[{key:"beginOAuth2",value:function(t,r){!r&&window&&(r=window);var n=Object.assign({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",locale:"",style:"",pkce:!0},t),o=n.portal,i=n.provider,s=n.clientId,a=n.expiration,c=n.redirectUri,u=n.popup,h=n.popupWindowFeatures,d=n.locale,f=n.params,p=n.style,m=n.pkce,g=n.state||H(r),v="ARCGIS_REST_JS_AUTH_STATE_".concat(s);r.localStorage.setItem(v,g);var k,w="".concat(U(o),"/oauth2/authorize"),E={client_id:s,response_type:m?"code":"token",expiration:a,redirect_uri:c,state:JSON.stringify({id:g,originalUrl:r.location.href}),locale:d,style:p};if("arcgis"!==i&&(w="".concat(U(o),"/oauth2/social/authorize"),E.socialLoginProviderName=i,E.autoAccountCreateForSocial=!0),m){var y=H(r),_="ARCGIS_REST_JS_CODE_VERIFIER_".concat(s);r.localStorage.setItem(_,y),k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;if(!t&&window&&(t=window),e&&t.isSecureContext&&t.crypto&&t.crypto.subtle){var r=(new t.TextEncoder).encode(e);return t.crypto.subtle.digest("SHA-256",r).then((function(e){return z(new Uint8Array(e),t)}))}return Promise.resolve(null)}(y,r).then((function(e){E.code_challenge_method=e?"S256":"plain",E.code_challenge=e||y}))}else k=Promise.resolve();return k.then((function(){return w="".concat(w,"?").concat(l(E)),f&&(w="".concat(w,"&").concat(l(f))),u?new Promise((function(t,n){r.addEventListener("arcgis-rest-js-popup-auth-".concat(s),(function(r){if("access_denied"===r.detail.error){var i=new x;return n(i),i}if(r.detail.errorMessage){var a=new T(r.detail.errorMessage,r.detail.error);return n(a),a}t(new e({clientId:s,portal:o,ssl:r.detail.ssl,token:r.detail.token,tokenExpires:r.detail.expires,username:r.detail.username,refreshToken:r.detail.refreshToken,refreshTokenExpires:r.detail.refreshTokenExpires,redirectUri:c}))}),{once:!0}),r.open(w,"oauth-window",h),r.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-start"))})):void(r.location.href=w)}))}},{key:"completeOAuth2",value:function(t,r){!r&&window&&(r=window);var n=Object.assign({portal:"https://www.arcgis.com/sharing/rest",popup:!0,pkce:!0},t),o=n.portal,i=n.clientId,s=n.popup,a=n.pkce,c=n.redirectUri,u="ARCGIS_REST_JS_AUTH_STATE_".concat(i),h=r.localStorage.getItem(u),d=Z(a?r.location.search.replace(/^\?/,""):r.location.hash.replace(/^#/,"")),l=d&&d.state?JSON.parse(d.state):void 0;function f(e,t,n){return r.localStorage.removeItem(u),s&&r.opener?(r.opener.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-".concat(i),{detail:{error:t,errorMessage:e}})),void r.close()):(n&&r.history.replaceState(r.history.state,"",n),"access_denied"===t?Promise.reject(new x):Promise.reject(new T(e,t)))}function p(t,n){return r.localStorage.removeItem(u),s&&r.opener?(r.opener.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-".concat(i),{detail:Object.assign({},t)})),void r.close()):(r.history.replaceState(r.history.state,"",n),new e({clientId:i,portal:o,ssl:t.ssl,token:t.token,tokenExpires:t.expires,username:t.username,refreshToken:t.refreshToken,refreshTokenExpires:t.refreshTokenExpires,redirectUri:c||location.href.replace(location.search,"")}))}if(!h||!l)return f("No authentication state was found, call `ArcGISIdentityManager.beginOAuth2(...)` to start the authentication process.","no-auth-state");if(l.id!==h)return f("Saved client state did not match server sent state.","mismatched-auth-state");if(d.error){var m=d.error;return f(d.error_description||"Unknown error",m,l.originalUrl)}if(a&&d.code){var g=U("".concat(o,"/oauth2/token/")),v="ARCGIS_REST_JS_CODE_VERIFIER_".concat(i),k=r.localStorage.getItem(v);return r.localStorage.removeItem(v),j(g,{httpMethod:"POST",params:{client_id:i,code_verifier:k,grant_type:"authorization_code",redirect_uri:c||location.href.replace(location.search,""),code:d.code}}).then((function(e){return p(Object.assign(Object.assign({},e),l),l.originalUrl)})).catch((function(e){return f(e.originalMessage,e.code,l.originalUrl)}))}return!a&&d.access_token?Promise.resolve(p(Object.assign({token:d.access_token,expires:new Date(Date.now()+1e3*parseInt(d.expires_in,10)),ssl:"true"===d.ssl,username:d.username},l),l.originalUrl)):f("Unknown error","oauth-error",l.originalUrl)}},{key:"fromParent",value:function(t,r){var n;return!r&&window&&(r=window),new Promise((function(o,i){n=function(t){if(t.source===r.parent&&t.data)try{return o(e.parentMessageHandler(t))}catch(n){return i(n)}},r.addEventListener("message",n,!1),r.parent.postMessage({type:"arcgis:auth:requestCredential"},t)})).then((function(e){return r.removeEventListener("message",n,!1),e}))}},{key:"authorize",value:function(e,t){var r=Object.assign({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),n=r.portal,o=r.clientId,i=r.expiration,s=r.redirectUri,a=r.state,c={client_id:o,expiration:i,response_type:"code",redirect_uri:s};a&&(c.state=a);var u="".concat(n,"/oauth2/authorize?").concat(l(c));t.writeHead(301,{Location:u}),t.end()}},{key:"exchangeAuthorizationCode",value:function(t,r){var n=Object.assign({portal:"https://www.arcgis.com/sharing/rest"},t),o=n.portal,i=n.clientId,s=n.redirectUri;return j("".concat(o,"/oauth2/token"),{params:{grant_type:"authorization_code",client_id:i,redirect_uri:s,code:r}}).then((function(t){return new e({clientId:i,portal:o,ssl:t.ssl,redirectUri:s,refreshToken:t.refreshToken,refreshTokenExpires:t.refreshTokenExpires,token:t.token,tokenExpires:t.expires,username:t.username})})).catch((function(e){throw new S(e.message,y.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)}))}},{key:"deserialize",value:function(t){var r=JSON.parse(t);return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:r.refreshTokenExpires?new Date(r.refreshTokenExpires):void 0,username:r.username,password:r.password,token:r.token,tokenExpires:r.tokenExpires?new Date(r.tokenExpires):void 0,portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,server:r.server})}},{key:"fromCredential",value:function(t,r){var n=void 0===t.ssl||t.ssl,o=t.expires||Date.now()+72e5;return r.hasServer?new e({server:t.server,ssl:n,token:t.token,username:t.userId,tokenExpires:new Date(o)}):new e({portal:U(t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest"),ssl:n,token:t.token,username:t.userId,tokenExpires:new Date(o)})}},{key:"parentMessageHandler",value:function(t){if("arcgis:auth:credential"===t.data.type)return new e(t.data.credential);if("arcgis:auth:error"===t.data.type){var r=new Error(t.data.error.message);throw r.name=t.data.error.name,r}throw new Error("Unknown message type.")}},{key:"destroy",value:function(e){return function(e){var t="".concat(U(e.portal||"https://www.arcgis.com/sharing/rest"),"/oauth2/revokeToken/"),r=e.token,n=e.clientId;delete e.portal,delete e.clientId,delete e.token;var o=Object.assign(Object.assign({},e),{httpMethod:"POST",params:{client_id:n,auth_token:r}});return O(t,o).then((function(e){if(!e.success)throw new g("Unable to revoke token",500,e,t,o);return e}))}({clientId:e.clientId,portal:e.portal,token:e.refreshToken||e.token})}},{key:"fromToken",value:function(t){var r=new e(t);return r.getUser().then((function(){return r}))}},{key:"signIn",value:function(t){var r=new e(t);return r.getUser().then((function(){return r}))}}]),e}();function L(e){return console.log("DEPRECATED:, 'UserSession' is deprecated. Use 'ArcGISIdentityManager' instead."),new Y(e)}function J(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://www.arcgis.com/sharing/rest",n="".concat(r,"/oauth2/exchangeToken"),o={method:"POST",params:{f:"json",client_id:t,token:e}};return O(n,o).then((function(e){return e.token}))}L.beginOAuth2=function(){return console.warn("DEPRECATED:, 'UserSession.beginOAuth2' is deprecated. Use 'ArcGISIdentityManager.beginOAuth2' instead."),Y.beginOAuth2.apply(Y,arguments)},L.completeOAuth2=function(){return console.warn("DEPRECATED:, 'UserSession.completeOAuth2()' is deprecated. Use 'ArcGISIdentityManager.completeOAuth2()' instead."),arguments.length<=1&&console.warn("WARNING:, 'UserSession.completeOAuth2()' is now async and returns a promise the resolves to an instance of `ArcGISIdentityManager`."),Y.completeOAuth2.apply(Y,arguments)},L.fromParent=function(){return console.warn("DEPRECATED:, 'UserSession.fromParent' is deprecated. Use 'ArcGISIdentityManager.fromParent' instead."),Y.fromParent.apply(Y,arguments)},L.authorize=function(){return console.warn("DEPRECATED:, 'UserSession.authorize' is deprecated. Use 'ArcGISIdentityManager.authorize' instead."),Y.authorize.apply(Y,arguments)},L.exchangeAuthorizationCode=function(){return console.warn("DEPRECATED:, 'UserSession.exchangeAuthorizationCode' is deprecated. Use 'ArcGISIdentityManager.exchangeAuthorizationCode' instead."),Y.exchangeAuthorizationCode.apply(Y,arguments)},L.fromCredential=function(){return console.log("DEPRECATED:, 'UserSession.fromCredential' is deprecated. Use 'ArcGISIdentityManager.fromCredential' instead."),console.warn("WARNING:, 'UserSession.fromCredential' now requires a `ServerInfo` object from the JS API as a second parameter."),Y.fromCredential.apply(Y,arguments)},L.deserialize=function(){return console.log("DEPRECATED:, 'UserSession.deserialize' is deprecated. Use 'ArcGISIdentityManager.deserialize' instead."),Y.deserialize.apply(Y,arguments)}}}]);