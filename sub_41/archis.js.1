/*! archisUI - v3.0.0 - 2021-02-25 */
!function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}(),String.prototype.startsWith||!function(){"use strict";var defineProperty=function(){try{var object={},$defineProperty=Object.defineProperty,result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}(),toString={}.toString,startsWith=function(search){if(null==this)throw TypeError();var string=String(this);if(search&&"[object RegExp]"==toString.call(search))throw TypeError();var stringLength=string.length,searchString=String(search),searchLength=searchString.length,position=arguments.length>1?arguments[1]:void 0,pos=position?Number(position):0;pos!=pos&&(pos=0);var start=Math.min(Math.max(pos,0),stringLength);if(searchLength+start>stringLength)return!1;for(var index=-1;++index<searchLength;)if(string.charCodeAt(start+index)!=searchString.charCodeAt(index))return!1;return!0};defineProperty?defineProperty(String.prototype,"startsWith",{value:startsWith,configurable:!0,writable:!0}):String.prototype.startsWith=startsWith}();var ArchisApp=angular.module("archisApp",["ui.router","ngResource","ngMessages","ngCookies","ngAnimate","ngSanitize","flow","mgcrea.ngStrap","ui.bootstrap","angularLocalStorage","archis.controllers","archis.directives","archis.factories","archis.filters","archis.services","archis.validators"]);ArchisApp.config(["$provide",function($provide){return $provide.decorator("$rootScope",["$delegate",function($delegate){return $delegate.safeApply=function(fn){var phase=$delegate.$$phase;"$apply"===phase||"$digest"===phase?fn&&"function"==typeof fn&&fn():$delegate.$apply(fn)},$delegate}])}]),ArchisApp.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("archisBusySpinnerHttpInterceptor"),$httpProvider.interceptors.push(["$injector",function($injector){return $injector.get("responseInterceptor")}])}]),ArchisApp.config(["$stateProvider","$locationProvider","$urlRouterProvider","$datepickerProvider","flowFactoryProvider","$modalProvider","$popoverProvider","USER_ROLES",function($stateProvider,$locationProvider,$urlRouterProvider,$datepickerProvider,flowFactoryProvider,$modalProvider,$popoverProvider,USER_ROLES){$urlRouterProvider.otherwise("/"),$locationProvider.hashPrefix(""),$stateProvider.state("login",{url:"/login?error?cancelled",templateUrl:"partials/generic/inloggen.html",controller:"inloggenController",title:"Inloggen",data:{authorizedRoles:[USER_ROLES.guest]}}).state("loginbeheer",{url:"/loginbeheer?returnURL",templateUrl:"partials/generic/inloggen-beheer.html",controller:"inloggenBeheerController",title:"Inloggen beheer",data:{authorizedRoles:[USER_ROLES.admin]}}).state("onderzoek-overzicht",{url:"/",templateUrl:"partials/onderzoek/overzicht.html",controller:"onderzoekenController",title:"Onderzoek overzicht",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek",{url:"/onderzoek/:zaaknummer",templateUrl:"partials/onderzoek/edit-base.html",controller:"onderzoekController",title:"Onderzoek",redirectTo:"onderzoek.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/edit-stap1.html",title:"Onderzoek"}).state("onderzoek.stap2",{url:"/stap2",templateUrl:"partials/onderzoek/edit-stap2.html",title:"Onderzoek - Geometrie"}).state("onderzoek.stap3",{url:"/stap3",templateUrl:"partials/onderzoek/edit-stap3.html",title:"Onderzoek - Documenten"}).state("onderzoek.done",{url:"/done",templateUrl:"partials/onderzoek/edit-done.html",title:"Onderzoek - Samenvatting"}).state("onderzoek-veldwerk",{url:"/onderzoek/:zaaknummer/veldwerk",templateUrl:"partials/onderzoek/veldwerk/veldwerk-base.html",controller:"veldwerkController",title:"Eerste bevinding",redirectTo:"onderzoek-veldwerk.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-veldwerk.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/veldwerk/veldwerk-stap1.html",title:"Eerste bevinding"}).state("onderzoek-veldwerk.done",{url:"/done",templateUrl:"partials/onderzoek/veldwerk/veldwerk-done.html",title:"Eerste bevinding - Samenvatting"}).state("onderzoek-verwijder",{url:"/onderzoek/:zaaknummer/verwijder",templateUrl:"partials/onderzoek/verwijder/verwijder-base.html",controller:"verwijderOnderzoekController",title:"Onderzoek verwijderen",redirectTo:"onderzoek-verwijder.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-verwijder.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/verwijder/verwijder-stap1.html",title:"Onderzoek verwijderen"}).state("onderzoek-verwijder.done",{url:"/done",templateUrl:"partials/onderzoek/verwijder/verwijder-done.html",title:"Onderzoek verwijderen - Klaar"}).state("onderzoek-afmelden",{url:"/onderzoek/:zaaknummer/afmelden",templateUrl:"partials/onderzoek/afmelden/afmelden-base.html",controller:"afmeldingController",title:"Onderzoek afmelden",redirectTo:"onderzoek-afmelden.startStap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-afmelden.startStap1",{url:"/stap1",templateUrl:"partials/onderzoek/afmelden/afmelden-start-stap1.html",title:"Onderzoek afmelden"}).state("onderzoek-afmelden.startStap2",{url:"/stap2",templateUrl:"partials/onderzoek/afmelden/afmelden-start-stap2.html",title:"Onderzoek afmelden - Keuze"}).state("onderzoek-afmelden.pakbonStap1",{url:"/pakbon",templateUrl:"partials/onderzoek/afmelden/afmelden-pakbon-stap1.html",title:"Onderzoek afmelden - Pakbon"}).state("onderzoek-afmelden.done",{url:"/done",templateUrl:"partials/onderzoek/afmelden/afmelden-done.html",title:"Onderzoek afmelden - Samenvatting"}).state("onderzoek-vondstlocatie-overzicht",{url:"/onderzoek/:zaaknummer/afmelden/vondstlocaties",templateUrl:"partials/onderzoek/vondstlocatie/overzicht.html",controller:"vondstlocatieOverzichtController",title:"Onderzoek - Vondstlocatie",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-vondstlocatie",{url:"/onderzoek/:zaaknummer/afmelden/vondstlocatie/:choId",templateUrl:"partials/onderzoek/vondstlocatie/vondstlocatie-base.html",controller:"vondstlocatieController",title:"Onderzoek - Vondstlocatie",redirectTo:"onderzoek-vondstlocatie.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-vondstlocatie.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/vondstlocatie/vondstlocatie-stap1.html",title:"Onderzoek - Vondstlocatie"}).state("onderzoek-vondstlocatie.stap2",{url:"/stap2",templateUrl:"partials/onderzoek/vondstlocatie/vondstlocatie-stap2.html",title:"Onderzoek - Vondstlocatie - Details"}).state("onderzoek-vondstlocatie.stap3",{url:"/stap3",templateUrl:"partials/onderzoek/vondstlocatie/vondstlocatie-stap3.html",title:"Onderzoek - Vondstlocatie - Vondsten"}).state("onderzoek-vondstlocatie.done",{url:"/done",templateUrl:"partials/onderzoek/vondstlocatie/vondstlocatie-done.html",title:"Onderzoek - Vondstlocatie - Samenvatting"}).state("onderzoek-vondstlocatie-afmelden-doorvoeren",{url:"/onderzoek/:zaaknummer/afmeldendoorvoeren",templateUrl:"partials/onderzoek/afmelden/afmelden-base.html",controller:"afmeldingDoorvoerenController",title:"Onderzoek - Vondstlocatie - Afmelden",redirectTo:"onderzoek-vondstlocatie-afmelden-doorvoeren.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-vondstlocatie-afmelden-doorvoeren.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/afmelden/afmelden-doorvoeren.html",title:"Onderzoek - Vondstlocatie - Afmelden"}).state("onderzoek-vondstlocatie-afmelden-doorvoeren.done",{url:"/done",templateUrl:"partials/onderzoek/afmelden/afmelden-done.html",title:"Onderzoek - Vondstlocatie - Afmelden - Samenvatting"}).state("onderzoek-vondstlocatie-verwijder",{url:"/onderzoek/:zaaknummer/afmelden/vondstlocatie/:choId/verwijder",templateUrl:"partials/onderzoek/vondstlocatie/verwijder/verwijder-base.html",controller:"verwijderVondstlocatieController",title:"Onderzoek - Vondstlocatie - Verwijderen",redirectTo:"onderzoek-vondstlocatie-verwijder.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("onderzoek-vondstlocatie-verwijder.stap1",{url:"/stap1",templateUrl:"partials/onderzoek/vondstlocatie/verwijder/verwijder-stap1.html",title:"Onderzoek - Vondstlocatie - Verwijderen"}).state("onderzoek-vondstlocatie-verwijder.done",{url:"/done",templateUrl:"partials/onderzoek/vondstlocatie/verwijder/verwijder-done.html",title:"Onderzoek - Vondstlocatie - Verwijderen - Samenvatting"}).state("onderzoek-uitstel",{url:"/onderzoek/:zaaknummer/uitstel-aanvragen",templateUrl:"partials/onderzoek/uitstel/uitstel.html",controller:"uitstelController",title:"Onderzoek - Uitstel",data:{authorizedRoles:[USER_ROLES.user]}}).state("vondstmelding-overzicht",{url:"/vondstmeldingen",templateUrl:"partials/vondstmelding/overzicht.html",controller:"vondstmeldingenController",title:"Vondstmelding overzicht",data:{authorizedRoles:[USER_ROLES.user]}}).state("vondstmelding",{url:"/vondstmelding/:zaaknummer",templateUrl:"partials/vondstmelding/edit-base.html",controller:"vondstmeldingController",title:"Vondstmelding",redirectTo:"vondstmelding.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("vondstmelding.stap1",{url:"/stap1",templateUrl:"partials/vondstmelding/edit-stap1.html",title:"Vondstmelding - Vondst"}).state("vondstmelding.stap2",{url:"/stap2",templateUrl:"partials/vondstmelding/edit-stap2.html",title:"Vondstmelding - Geo"}).state("vondstmelding.stap3",{url:"/stap3",templateUrl:"partials/vondstmelding/edit-stap3.html",title:"Vondstmelding - Details"}).state("vondstmelding.done",{url:"/done",templateUrl:"partials/vondstmelding/edit-done.html",title:"Vondstmelding - Samenvatting"}).state("vondstmelding-afmelden",{url:"/vondstmelding/:zaaknummer/afmelden",templateUrl:"partials/vondstmelding/afmelden/afmelden-base.html",controller:"afmeldingVondstmeldingController",redirectTo:"vondstmelding-afmelden.stap1",title:"Vondstmelding - Afmelden",data:{authorizedRoles:[USER_ROLES.user]}}).state("vondstmelding-afmelden.stap1",{url:"/stap1",templateUrl:"partials/vondstmelding/afmelden/afmelden-stap1.html",title:"Vondstmelding - Afmelden"}).state("vondstmelding-afmelden.done",{url:"/done",templateUrl:"partials/vondstmelding/afmelden/afmelden-done.html",title:"Vondstmelding - Afmelden - Samenvatting"}).state("vondstmelding-verwijder",{url:"/vondstmelding/:zaaknummer/verwijder",templateUrl:"partials/vondstmelding/verwijder/verwijder-base.html",controller:"verwijderVondstmeldingController",title:"Vondstmelding verwijderen",redirectTo:"vondstmelding-verwijder.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("vondstmelding-verwijder.stap1",{url:"/stap1",templateUrl:"partials/vondstmelding/verwijder/verwijder-stap1.html",title:"Vondstmelding verwijderen"}).state("vondstmelding-verwijder.done",{url:"/done",templateUrl:"partials/vondstmelding/verwijder/verwijder-done.html",title:"Vondstmelding verwijderen - Klaar"}).state("releasenotes",{url:"/releasenotes",templateUrl:"partials/generic/releasenotes.html",title:"Release notes",data:{authorizedRoles:[USER_ROLES.guest]}}).state("archis2",{url:"/archis2",templateUrl:"partials/generic/archis2.html",controller:"bestandenController",title:"Archis 2 betstanden",data:{authorizedRoles:[USER_ROLES.user]}}).state("archis3",{url:"/archis3",templateUrl:"partials/generic/archis3.html",controller:"bestandenController",title:"Archis 3 bestanden",data:{authorizedRoles:[USER_ROLES.user]}}).state("error",{url:"/error?error",templateUrl:"partials/generic/error-400.html",controller:"errorController",title:"Fout",data:{authorizedRoles:[USER_ROLES.guest]}}).state("severe",{url:"/severe",templateUrl:"partials/generic/error-500.html",controller:"errorController",title:"Fout",data:{authorizedRoles:[USER_ROLES.guest]}}).state("toegangscode-overzicht",{url:"/toegangscodes",templateUrl:"partials/toegangscode/overzicht.html",controller:"toegangscodesController",title:"Toegangscode overzicht",data:{authorizedRoles:[USER_ROLES.admin]}}).state("toegangscode",{url:"/toegangscode/:code?afgesloten",templateUrl:"partials/toegangscode/edit-base.html",controller:"toegangscodeController",title:"Toegangscode",redirectTo:"toegangscode.stap1",data:{authorizedRoles:[USER_ROLES.admin]}}).state("toegangscode.stap1",{url:"/stap1",templateUrl:"partials/toegangscode/edit-stap1.html",title:"Toegangscode instellen"}).state("toegangscode.done",{url:"/done",templateUrl:"partials/toegangscode/edit-done.html",title:"Toegangscode emailen"}).state("toegangscode-verwijder",{url:"/toegangscode/:code/verwijder?afgesloten",templateUrl:"partials/toegangscode/verwijder/verwijder-base.html",controller:"verwijderToegangscodeController",title:"Toegangscode verwijderen",redirectTo:"toegangscode-verwijder.stap1",data:{authorizedRoles:[USER_ROLES.user]}}).state("toegangscode-verwijder.stap1",{url:"/stap1",templateUrl:"partials/toegangscode/verwijder/verwijder-stap1.html",title:"Toegangscode verwijderen"}).state("toegangscode-verwijder.done",{url:"/done",templateUrl:"partials/toegangscode/verwijder/verwijder-done.html",title:"Toegangscode verwijderen - Klaar"}),angular.extend($datepickerProvider.defaults,{dateFormat:"dd-MM-yyyy",modelDateFormat:"yyyy-MM-dd",dateType:"string",startWeek:1,container:"body",autoclose:!0}),angular.extend($modalProvider.defaults,{backdrop:"static"}),angular.extend($popoverProvider.defaults,{animation:"am-fade",trigger:"hover",placement:"right",container:"body"}),flowFactoryProvider.defaults={chunkSize:9007199254740992,testChunks:!0},flowFactoryProvider.factory=fustyFlowFactory}]),ArchisApp.run(["$rootScope","$state","$location","$timeout","configurationService","authenticationService","GLOBAL_EVENTS","USER_ROLES",function($rootScope,$state,$location,$timeout,configurationService,authenticationService,GLOBAL_EVENTS,USER_ROLES){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){var redirect=toState.redirectTo;redirect&&(event.preventDefault(),angular.isFunction(redirect)?redirect.call($state):$state.go(redirect,toParams))}),$rootScope.$on("$stateChangeSuccess",function(event,next){$timeout(function(){var title=next.title;title?$rootScope.pageTitle="Archis - Rijksdienst voor het Cultureel Erfgoed - "+title:$rootScope.pageTitle="Archis - Rijksdienst voor het Cultureel Erfgoed"});var nextText=next.name;nextText.indexOf(".")>-1&&(nextText=nextText.substring(0,nextText.indexOf("."))),$rootScope.currentState=nextText,authenticationService.handleStateChange(event,next)})}]),angular.module("archis.controllers",["archis.controllers.afmeldingcontroller","archis.controllers.afmeldingdoorvoerencontroller","archis.controllers.afmeldingvondstmeldingcontroller","archis.controllers.applicationcontroller","archis.controllers.bestandencontroller","archis.controllers.dialogbasecontroller","archis.controllers.dialogbeheercontroller","archis.controllers.dialogbevindingencontroller","archis.controllers.dialogmapcontroller","archis.controllers.dialogsporencontroller","archis.controllers.dialogstructurencontroller","archis.controllers.dialogvondstencontroller","archis.controllers.dialogtoegangscodelogcontroller","archis.controllers.errorcontroller","archis.controllers.inloggenbeheercontroller","archis.controllers.inloggencontroller","archis.controllers.onderzoekcontroller","archis.controllers.onderzoekencontroller","archis.controllers.toegangscodescontroller","archis.controllers.toegangscodecontroller","archis.controllers.dialogtoegangscodeaanvragencontroller","archis.controllers.uitstelcontroller","archis.controllers.veldwerkcontroller","archis.controllers.verwijdervondstlocatiecontroller","archis.controllers.verwijderonderzoekcontroller","archis.controllers.verwijdervondstmeldingcontroller","archis.controllers.verwijdertoegangscodecontroller","archis.controllers.vondstlocatiecontroller","archis.controllers.vondstlocatieoverzichtcontroller","archis.controllers.vondstmeldingcontroller","archis.controllers.vondstmeldingencontroller"]);var AfmeldingController=angular.module("archis.controllers.afmeldingcontroller",[]);AfmeldingController.controller("afmeldingController",["$scope","$state","$stateParams","$timeout","$location","$archisAlert","onderzoekService","formService","thesaurusService","onderzoekService","veldwerkService","vondstmeldingService","genericDataService","dialogFactory","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$location,$archisAlert,onderzoekService,formService,thesaurusService,onderzoekService,veldwerkService,vondstmeldingService,genericDataService,dialogFactory,archisSubNavigationHelper){$scope.isNietMuteerbaar=!1,$scope.redliningExists=!1,$scope.pveExists=!1,$scope.veldwerkMandatoryAndNotPresent=!1,$scope.veldwerkMandatoryAndNotSubmitted=!1,$scope.andere={onderzoek:null,onderzoeken:[],show:null},$scope.afmelding={zaaknummer:$stateParams.zaaknummer,documenten:null,bibliografischeGegevens:{titel:null,auteur:null,reeks:null,volgnummer:null,jaar:null},andereOnderzoeken:null,vondsten:{vondsten:null,sporen:null,structuren:null,complexen:null,toelichting:null},pakbon:null};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-afmelden.startStap1",submitsForm:!1,display:"Stap 1",title:"Onderzoek Afmelden",valid:!1},{index:2,uiSref:"onderzoek-afmelden.startStap2",submitsForm:function(){return $scope.afmeldenOnderzoek.$dirty},display:"Stap 2",title:"Onderzoek Afmelden",valid:!1},{index:10,uiSref:"onderzoek-afmelden.pakbonStap1",submitsForm:!1,display:"Pakbon Stap 1",title:"Onderzoek Afmelden - Pakbon",valid:!1},{index:11,uiSref:"onderzoek-afmelden.done",submitsForm:!0,display:"Pakbon Stap 2",title:"Onderzoek Afmelden - Pakbon",valid:!1},{index:100,uiSref:"onderzoek-afmelden.done",submitsForm:!0,display:"Snel",title:"Onderzoek Afmelden - Snel",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"afmeldenOnderzoek"),$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,$scope.snelAfmelden=onderzoekService.quickAfmelden(data),$scope.reportMandatory=onderzoekService.reportMandatory(data),archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek),$scope.pveExists=!onderzoekService.reportMandatory($scope.currentOnderzoek)||$scope.currentOnderzoek.documenten&&$scope.currentOnderzoek.documenten.length>0,$scope.pveExists||$archisAlert({title:"Geen document(en) opgevoerd",content:"Er zijn nog geen verplichte documenten opgevoerd voor dit onderzoek. Voer eerst de de verplichte documenten op voordat u verder gaat.",type:"error",container:"#alertPve"}),veldwerkService.getVeldwerk($stateParams.zaaknummer,function(data){!$scope.currentOnderzoek.archis2onderzoeksmeldingsnummer&&$scope.reportMandatory&&(data?data.hasFindings||($scope.veldwerkMandatoryAndNotSubmitted=!0,$archisAlert({title:"Geen veldwerk ingediend",content:"Er is veldwerk voor dit onderzoek opgevoerd maar nog niet ingediend. Voordat het onderzoek kan worden afgemeld moet het veldwerk zijn ingediend.",type:"error"})):($scope.veldwerkMandatoryAndNotPresent=!0,$archisAlert({title:"Geen veldwerk opgevoerd",content:"Er is momenteel nog geen veldwerk opgevoerd voor dit onderzoek. Onderzoeken van type 'Booronderzoek', 'Opgraving', 'Proefsleuven', 'Begeleiding' en 'Onderwater Archeologie' hebben deze verplichting.",type:"error"}))),$scope.veldwerkMandatoryAndNotPresent||$scope.veldwerkMandatoryAndNotSubmitted||onderzoekService.getOnderzoekAfmeldenHandmatig($stateParams.zaaknummer,function(data){if($scope.afmelding=data,data.andereOnderzoeken){var zaaknummers=data.andereOnderzoeken.split("~");onderzoekService.getOnderzoekenFromList(zaaknummers,function(data){$scope.andere.show=!0,$scope.andere.onderzoeken=data})}}),data&&($scope.isNietMuteerbaar=!0)})}),genericDataService.existsRedlining("Zaaknummer",$stateParams.zaaknummer,function(redliningExists){$scope.redliningExists=redliningExists,$scope.redliningExists||$archisAlert({title:"Geen geometrie opgevoerd",content:"Er is nog geen geometrie opgevoerd voor dit onderzoek. Voer eerst de geometrie op voordat u verder gaat.",type:"error",container:"#alertGeo"})}),thesaurusService.getReeksen(function(data){$scope.reeksen=data}),$scope.multiplePanels={activePanels:[0,1,2,3]}};$scope.saveAfmelding=function(){$scope.afmelding.afmeldingDoorvoeren=!1,formService.goToNextSection()},$scope.submitAfmelding=function(){var melding="Hiermee wordt uw onderzoeksafmelding doorgevoerd, dit onderzoek kan hierna niet meer bekeken of gewijzigd worden.\n";$scope.snelAfmelden||(melding="Als u uw onderzoeksafmelding enkel wilt opslaan kies dan voor de optie 'Afmelding Opslaan'\n\nWeet u zeker dat u door wilt gaan met afmelden?"),confirm(melding)&&($scope.afmelding.afmeldingDoorvoeren=!0,$scope.snelAfmelden?formService.goToSectionWithIndex(100):formService.goToNextSection())},$scope.submitForm=function(isFormValid,forceTussentijdsBewaaractie){if(isFormValid){var isPakbonAfmelding=formService.currentStep.uiSref.indexOf("onderzoek-afmelden.pakbonStap")!==-1,isTussentijdseBewaaractie=forceTussentijdsBewaaractie||formService.currentStep.uiSref.indexOf("onderzoek-afmelden.startStap1")!==-1&&!$scope.snelAfmelden;isTussentijdseBewaaractie?$scope.afmeldenOnderzoek.$dirty&&($scope.saveActive=!0,$archisAlert({title:"Afmeldingsgegevens worden bewaard",content:"Een moment geduld...",spinner:!0})):$archisAlert({title:"Onderzoek wordt afgemeld",content:"Een moment geduld...",spinner:!0});var afmeldenCallback=function(data){if($scope.afmelding=data,isTussentijdseBewaaractie||($scope.skipConfirm=!0),isTussentijdseBewaaractie)$scope.saveActive=!1,$archisAlert({title:"Afmelding is tussentijds opgeslagen",content:"We hebben uw gegevens succesvol ontvangen."});else{var action=$scope.afmelding.afmeldingDoorvoeren?"afgemeld":"opgeslagen",body="Het onderzoek is succesvol "+action+".";$scope.afmelding.afmeldingDoorvoeren&&(body+=" U wordt doorgestuurd naar het overzicht...",$timeout(function(){$state.go("onderzoek-overzicht")},3e3)),$archisAlert({title:"Onderzoek "+action,content:body,spinner:$scope.afmelding.afmeldingDoorvoeren})}};$scope.andere.onderzoeken&&($scope.afmelding.andereOnderzoeken=_.pluck($scope.andere.onderzoeken,"zaaknummer").join("~")),$scope.afmeldenOnderzoek.$setPristine(),isPakbonAfmelding?onderzoekService.onderzoekAfmeldenPakbon($scope.afmelding,afmeldenCallback):onderzoekService.onderzoekAfmeldenHandmatig($scope.afmelding,afmeldenCallback)}},$scope.addToAndereOnderzoeken=function(){$scope.andere.onderzoeken.push($scope.andere.onderzoek),$scope.andere.onderzoek=null,$scope.andere.anderOnderzoekText=null},init()}]);var AfmeldingDoorvoerenController=angular.module("archis.controllers.afmeldingdoorvoerencontroller",[]);AfmeldingDoorvoerenController.controller("afmeldingDoorvoerenController",["$scope","$state","$stateParams","$timeout","$archisAlert","formService","vondstlocatieService","onderzoekService","vondstmeldingService","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$archisAlert,formService,vondstlocatieService,onderzoekService,vondstmeldingService,archisSubNavigationHelper){$scope.validation={vondstlocatiesEntered:!1,allVondstlocatiesInOnderzoekHaveGeometry:!1,acceptMissingVondstlocatie:!1};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-vondstlocatie-afmelden-doorvoeren.stap1",submitsForm:!1,display:"Stap 1",title:"Onderzoek Afmelden",valid:!1},{index:2,uiSref:"onderzoek-vondstlocatie-afmelden-doorvoeren.done",submitsForm:!0,display:"Stap 2",title:"Onderzoek Afmelden",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"afmeldenOnderzoek"),$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}),vondstlocatieService.getVondstlocaties($stateParams.zaaknummer,function(data){$scope.validation.vondstlocatiesEntered=data&&data.length>0,$scope.validation.vondstlocatiesEntered?vondstlocatieService.allVondstlocatiesInOnderzoekHaveGeometry($stateParams.zaaknummer,function(data){$scope.validation.allVondstlocatiesInOnderzoekHaveGeometry=data,data||$archisAlert({title:"Afmelden niet toegestaan",content:"Er zijn vondstlocaties opgegegeven zonder geometrie binnen dit onderzoek.<br/><br/>Corrigeer alle Vondstlocaties en zorg ervoor dat alle vondstlocaties goed zijn geregistreerd."})}):$archisAlert({title:"Afmelden niet toegestaan",content:"Er moeten nog vondstlocaties worden opgegeven.<br/><br/>Indien er bij het onderzoek geen archeologische indicatoren zijn aangetroffen, kunt u het onderzoek afmeldendoor ‘Afmelden zonder vondstlocatie’ aan te vinken, en het onderzoek vervolgens af te melden."})})};$scope.afmeldenAllowed=function(){return $scope.validation.vondstlocatiesEntered&&$scope.validation.allVondstlocatiesInOnderzoekHaveGeometry||!$scope.validation.vondstlocatiesEntered&&$scope.validation.acceptMissingVondstlocatie},$scope.submitForm=function(isFormValid){if(isFormValid){var melding="Hiermee wordt uw onderzoeksafmelding doorgevoerd, dit onderzoek kan hierna niet meer bekeken of gewijzigd worden.\nWeet u zeker dat u door wilt gaan met afmelden?";if(!confirm(melding))return!1;$archisAlert({title:"Onderzoek wordt afgemeld",content:"Een moment geduld...",spinner:!0}),onderzoekService.onderzoekAfmeldenDoorvoeren($stateParams.zaaknummer,function(data){$scope.afmeldenOnderzoek.$setPristine(),$archisAlert({title:"Onderzoek wordt afgemeld",content:"Het onderzoek is succesvol afgemeld. U wordt doorgestuurd naar het overzicht...",spinner:!0}),$timeout(function(){$state.go("onderzoek-overzicht")},3e3)})}},init()}]);var AfmeldingVondstmeldingController=angular.module("archis.controllers.afmeldingvondstmeldingcontroller",[]);AfmeldingVondstmeldingController.controller("afmeldingVondstmeldingController",["$scope","$stateParams","$archisAlert","formService","vondstmeldingService",function($scope,$stateParams,$archisAlert,formService,vondstmeldingService){$scope.currentVondstmelding={},$scope.afmelding={zaaknummer:$stateParams.zaaknummer,documenten:null,bibliografischeGegevens:{titel:null,auteur:null,reeks:null,volgnummer:null,jaar:null}};var init=function(){var formSteps=[{index:1,uiSref:"vondstmelding-afmelden.stap1",submitsForm:!1,display:"Afmelden Vondstmelding",title:"Afmelden Vondstmelding",valid:!1},{index:2,uiSref:"vondstmelding-afmelden.done",submitsForm:!0,display:"Afmelden Vondstmelding",title:"Afmelden Vondstmelding",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"afmeldenVondstmelding"),$scope.formService=formService,vondstmeldingService.getVondstmelding($stateParams.zaaknummer,function(data){$scope.currentVondstmelding=data})};$scope.submitForm=function(isFormValid){isFormValid&&($archisAlert({title:"Vondstmelding wordt afgemeld",content:"Een moment geduld...",spinner:!0}),vondstmeldingService.vondstmeldingAfmelden($scope.afmelding,function(data){$archisAlert({title:"Vondstmelding afgemeld",content:"De vondstmelding is succesvol afgemeld."})}))},init()}]);var ApplicationController=angular.module("archis.controllers.applicationcontroller",[]);ApplicationController.controller("applicationController",["$scope","$state","$location","USER_ROLES","GLOBAL_EVENTS","authenticationService","configurationService","sessionService","dateHelper","arrayHelper","dialogFactory","archisSubNavigationHelper","browserCheck",function($scope,$state,$location,USER_ROLES,GLOBAL_EVENTS,authenticationService,configurationService,sessionService,dateHelper,arrayHelper,dialogFactory,archisSubNavigationHelper,browserCheck){var init=function(){configurationService.getVersion(function(data){$scope.archisVersion=data.data}),$scope.$on(GLOBAL_EVENTS.configurationLoaded,function(event,data){$scope.zoekenEnVindenUrl=configurationService.configuration.zoekenEnVindenUrl})};$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.url){var matches=toState.url.match(/^(\/(.*)\/:zaaknummer\/?)/i);matches&&matches.length>0&&toParams.zaaknummer&&archisSubNavigationHelper.determineBeheerURL(matches[2],toParams.zaaknummer)}}),$scope.$on(GLOBAL_EVENTS.badRequest,function(response,message){$state.go("error",{error:message},{skipConfirm:!0})}),$scope.$on(GLOBAL_EVENTS.notAuthorized,function(response,message){sessionService.destroy(),$state.go("login",null,{skipConfirm:!0})}),$scope.$on(GLOBAL_EVENTS.notAuthorizedAsAdmin,function(response){$state.go("loginbeheer",null,{skipConfirm:!0})}),$scope.$on(GLOBAL_EVENTS.loginSuccess,function(response,message){}),$scope.$on(GLOBAL_EVENTS.logoutSuccess,function(response,message){}),$scope.$on(GLOBAL_EVENTS.serverError,function(response,message){$state.go("severe",null,{skipConfirm:!0})}),$scope.isValidSession=function(){return sessionService.isValidSession()},$scope.logOut=function(event){confirm("U staat op het punt om zich uit te loggen uit Archis.\n\nWeet u het zeker?")||event.preventDefault()},$scope.isAdmin=function(){return sessionService.isAdmin},$scope.isAdminAuthenticated=function(){return sessionService.isAuthenticatedAdmin},$scope.showBeheerLogin=function(){var returnURL=$location.$$url;$state.go("loginbeheer",{returnURL:returnURL})},$scope.showBeheerDialog=function(){dialogFactory.openBeheerImpersonateDialog()},$scope.archisConfig=function(){return configurationService.configuration},$scope.removeFromList=arrayHelper.removeFromList,$scope.dateToYMD=dateHelper.dateToYMD,$scope.dateToDMY=dateHelper.dateToDMY,$scope.isIE=browserCheck.isIE,init()}]);var BestandenController=angular.module("archis.controllers.bestandencontroller",[]);BestandenController.controller("bestandenController",["$scope","configurationService",function($scope,configurationService){$scope.baseUrlArchis2=configurationService.configuration.bestandenArchis2Url,$scope.baseUrlArchis3=configurationService.configuration.bestandenArchis3Url}]);var DialogBaseController=angular.module("archis.controllers.dialogbasecontroller",[]);DialogBaseController.controller("dialogBaseController",["$scope","formService",function($scope,formService){$scope.dataitem={},$scope.datasourceChanged=!1,$scope.addTo=function(form){formService.submitForm(form),form.$valid?($scope.formSubmitted=!1,form.$setPristine(),$scope.datasource||($scope.datasource=[]),$scope.datasource.push($scope.dataitem),$scope.dataitem={},$scope.datasourceChanged=!0):$scope.formSubmitted=!0},$scope.removeFrom=function(item){if($scope.onDeleteOverride&&"function"==typeof $scope.onDeleteOverride)$scope.onDeleteOverride(item);else{var index=$scope.datasource.indexOf(item);index>-1&&$scope.datasource.splice(index,1)}},$scope.closeDialog=function(skipModifiedCheck){(skipModifiedCheck||$scope.datasourceChanged)&&$scope.onCloseDialog&&"function"==typeof $scope.onCloseDialog&&$scope.onCloseDialog(),$scope.$hide()}}]);var DialogBeheerController=angular.module("archis.controllers.dialogbeheercontroller",[]);DialogBeheerController.controller("dialogBeheerController",["$scope","$window","$state","$controller","$archisAlert","adminService","sessionService",function($scope,$window,$state,$controller,$archisAlert,adminService,sessionService){$controller("dialogBaseController",{$scope:$scope}),$scope.selectedOrganization=null,$scope.doRefresh=!1;var init=function(){adminService.findBetrokkenen(function(data){$scope.betrokkenen=data})};$scope.impersonate=function(){adminService.impersonate($scope.selectedOrganization.identificatieEherkenning,function(data){data?(sessionService.setImpersonation(data),$scope.selectedOrganization=null,$scope.doRefresh=!0,$archisAlert({title:"Identiteit aangepast",content:"De beheerdersidentiteit is aangepast naar organisatie: "+data.organizationNameAdmin+"<br><br>Klik op 'Ververs Pagina' om de nieuwe gegevens op te halen."})):$archisAlert({title:"Identiteit niet aangepast",
content:"De beheerdersidentiteit kon niet aangepast worden.",type:"error"})})},$scope.isImpersonating=function(){return!!sessionService.getImpersonation()},$scope.getImpersonationInfo=function(){var imp=sessionService.getImpersonation();return imp?imp.bedrijfsnaam+" ["+imp.organizationId+"]":"Niet van organisatie gewisseld."},$scope.refreshPage=function(){$state.go("onderzoek-overzicht",null,{skipConfirm:!0}),$window.location.reload()},$scope.clearImpersonation=function(){adminService.clearImpersonation(function(){sessionService.clearImpersonation(),$scope.doRefresh=!0,$archisAlert({title:"Identiteit",content:"De beheerdersidentiteit is teruggezet."})})},$scope.undoAfmelden=function(){adminService.undoAfmelden($scope.currentZaaknummer,$scope.currentType,function(data){$scope.doRefresh=!0,$archisAlert({title:"Afmelding ongedaan gemaakt",content:"De afmelding van "+$scope.currentType+" "+$scope.currentZaaknummer+" is ongedaan gemaakt."})})},$scope.changeBetrokkene=function(){adminService.changeBetrokkene($scope.currentZaaknummer,$scope.selectedOrganization.identificatieEherkenning,function(data){$scope.doRefresh=!0,$archisAlert({title:"Uitvoerder aangepast",content:"De uitvoerder van "+$scope.currentType+" "+$scope.currentZaaknummer+" is aangepast."})})},init()}]);var DialogBevindingenController=angular.module("archis.controllers.dialogbevindingencontroller",[]);DialogBevindingenController.controller("dialogBevindingenController",["$scope","$controller","thesaurusService",function($scope,$controller,thesaurusService){$controller("dialogBaseController",{$scope:$scope}),thesaurusService.getPerioden(function(data){$scope.periodes=data}),thesaurusService.getComplextypen(function(data){$scope.complextypen=data})}]);var DialogMapController=angular.module("archis.controllers.dialogmapcontroller",[]);DialogMapController.controller("dialogMapController",["$scope","$controller",function($scope,$controller){$controller("dialogBaseController",{$scope:$scope})}]);var DialogSporenController=angular.module("archis.controllers.dialogsporencontroller",[]);DialogSporenController.controller("dialogSporenController",["$scope","$controller","thesaurusService",function($scope,$controller,thesaurusService){$controller("dialogBaseController",{$scope:$scope}),thesaurusService.getSporen(function(data){$scope.sporen=data}),thesaurusService.getPerioden(function(data){$scope.periodes=data})}]);var DialogStructurenController=angular.module("archis.controllers.dialogstructurencontroller",[]);DialogStructurenController.controller("dialogStructurenController",["$scope","$controller","thesaurusService",function($scope,$controller,thesaurusService){$controller("dialogBaseController",{$scope:$scope}),thesaurusService.getStructuren(function(data){$scope.structuren=data}),thesaurusService.getPerioden(function(data){$scope.periodes=data})}]);var DialogToegangscodeAanvragenController=angular.module("archis.controllers.dialogtoegangscodeaanvragencontroller",[]);DialogToegangscodeAanvragenController.controller("dialogToegangscodeAanvragenController",["$scope","$filter","$controller","$archisAlert","toegangscodeService",function($scope,$filter,$controller,$archisAlert,toegangscodeService){$controller("dialogBaseController",{$scope:$scope}),$scope.email="",$scope.verklaring="",$scope.sendRequest=function(){$scope.formSubmitted=!0,$scope.aanvragenToegangscode.$valid&&toegangscodeService.registerToegangscode($scope.email,$scope.verklaring,function(data){$archisAlert({title:"Bericht over uw aanvraag",content:data})})}}]);var DialogToegangscodeLogController=angular.module("archis.controllers.dialogtoegangscodelogcontroller",[]);DialogToegangscodeLogController.controller("dialogToegangscodeLogController",["$scope","$filter","$controller","toegangscodeService",function($scope,$filter,$controller,toegangscodeService){$controller("dialogBaseController",{$scope:$scope}),$scope.currentPageNumber=1,$scope.itemsPerPage=10;var orderBy=$filter("orderBy"),reverse=!1;$scope.orderColumn=function(col){reverse=!reverse,$scope.auditlog=orderBy($scope.auditlog,col,reverse)};var init=function(){toegangscodeService.getAuditlog($scope.currentToegangscode,function(data){$scope.auditlog=data})};init()}]);var DialogVondstenController=angular.module("archis.controllers.dialogvondstencontroller",[]);DialogVondstenController.controller("dialogVondstenController",["$scope","$controller","thesaurusService",function($scope,$controller,thesaurusService){$controller("dialogBaseController",{$scope:$scope}),thesaurusService.getMaterialen(function(data){$scope.materialen=data}),thesaurusService.getArtefacten(function(data){$scope.artefacten=data}),thesaurusService.getPerioden(function(data){$scope.periodes=data})}]);var ErrorController=angular.module("archis.controllers.errorcontroller",[]);ErrorController.controller("errorController",["$scope","$stateParams","archisErrorFactory","formService",function($scope,$stateParams,archisErrorFactory,formService){$scope.formService=formService;var init=function(){$scope.error=archisErrorFactory.getError($stateParams.error)};init()}]);var InloggenBeheerController=angular.module("archis.controllers.inloggenbeheercontroller",[]);InloggenBeheerController.controller("inloggenBeheerController",["$scope","$state","$stateParams","$location","$archisAlert","authenticationService","formService","GLOBAL_EVENTS",function($scope,$state,$stateParams,$location,$archisAlert,authenticationService,formService,GLOBAL_EVENTS){$scope.login={password:null};var init=function(){$scope.formService=formService,$scope.returnURL=$stateParams.returnURL};$scope.verifyPassword=function(){$scope.login.password&&authenticationService.verifyPassword($scope.login.password,function(){$scope.safeApply(function(){$scope.alert=null,$scope.returnURL?$location.url(decodeURIComponent($scope.returnURL)):$state.go("onderzoek-overzicht")})},function(){$archisAlert({title:"Wachtwoord onjuist",content:"Geef het juiste wachtwoord op en probeer het opnieuw.",type:"error"})})},init()}]);var InloggenController=angular.module("archis.controllers.inloggencontroller",[]);InloggenController.controller("inloggenController",["$scope","$stateParams","configurationService","dialogFactory","GLOBAL_EVENTS",function($scope,$stateParams,configurationService,dialogFactory,GLOBAL_EVENTS){var init=function(){$scope.error=$stateParams.error,$scope.cancelled=$stateParams.cancelled,$scope.hiddenToegangscode=!0,$scope.$on(GLOBAL_EVENTS.configurationLoaded,function(event,data){$scope.maintenanceMessage=configurationService.configuration.maintenanceMessage,$scope.zoekenEnVindenUrl=configurationService.configuration.zoekenEnVindenUrl})};$scope.toggleHideToegangscode=function(){$scope.hiddenToegangscode=!$scope.hiddenToegangscode},$scope.isToegangscodeHidden=function(){return $scope.hiddenToegangscode},$scope.openToegangscodeAanvragenDialog=function(){dialogFactory.openToegangscodeAanvragenDialog()},init()}]);var OnderzoekController=angular.module("archis.controllers.onderzoekcontroller",[]);OnderzoekController.controller("onderzoekController",["$scope","$state","$stateParams","$location","$filter","$sce","$timeout","$archisAlert","configurationService","onderzoekService","genericDataService","thesaurusService","veldwerkService","formService","sessionService","dialogFactory","archisSubNavigationHelper","URL",function($scope,$state,$stateParams,$location,$filter,$sce,$timeout,$archisAlert,configurationService,onderzoekService,genericDataService,thesaurusService,veldwerkService,formService,sessionService,dialogFactory,archisSubNavigationHelper,URL){$scope.title,$scope.currentOnderzoek={},$scope.isNietMuteerbaar=!1,$scope.isSaving=!1,$scope.plaatsnamen,$scope.onderzoeken,$scope.mapUrl,$scope.datesDisabled=!1,$scope.existsRedlining=!1,$scope.validationActive={redlining:!1,voorafgaand:!1};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek.stap1",submitsForm:!1,display:"Onderzoek",title:"",valid:!1},{index:2,uiSref:"onderzoek.stap2",submitsForm:function(){return!$scope.currentOnderzoek.zaaknummer},display:"Geometrie",title:"Geometrie",valid:!1},{index:3,uiSref:"onderzoek.stap3",submitsForm:!0,display:"Documenten",title:"Documenten",valid:!1},{index:4,uiSref:"onderzoek.done",submitsForm:!0,display:"Samenvatting",title:"Samenvatting",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"meldOnderzoek"),$scope.formService=formService,$stateParams.zaaknummer&&"nieuw"!==$stateParams.zaaknummer?(onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,$scope.checkRedlining(),archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}),onderzoekService.getOnderzoekBetrokkene($stateParams.zaaknummer,function(betrokkene){$scope.betrokkene=betrokkene}),sessionService.isAuthenticatedAdmin||($stateParams.zaaknummer&&($scope.datesDisabled=!0),veldwerkService.getVeldwerk($stateParams.zaaknummer,function(data){data&&($scope.isNietMuteerbaar=!0,formService.deactivateValidCheck())})),$scope.title="Gemeld onderzoek"):($scope.currentOnderzoek=onderzoekService.initalizeNewOnderzoek(),$scope.title="Melden nieuw onderzoek"),thesaurusService.getPlaatsnamen(function(data){$scope.plaatsnamen=data}),configurationService.getOnderzoekTypeList(function(data){$scope.onderzoekTypes=data}),configurationService.getEigenschapType("Archis veldwerk: bevoegd gezag",function(data){$scope.bevoegdGezag=data})};$scope.submitForm=function(isFormValid){!$scope.isNietMuteerbaar&&isFormValid&&($scope.currentOnderzoek.zaaknummer?$scope.updateOnderzoek():$scope.createOnderzoek())},$scope.createOnderzoek=function(){$scope.isSaving=!0,onderzoekService.saveOnderzoek($scope.currentOnderzoek,function(data){$state.go($state.current,{zaaknummer:data.zaaknummer},{skipConfirm:!0}),$scope.currentOnderzoek=data,$scope.isSaving=!1,$archisAlert({title:"Onderzoek is opgeslagen",content:"We hebben het onderzoek succesvol ontvangen."}),archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)})},$scope.updateOnderzoek=function(){$scope.meldOnderzoek.$dirty?onderzoekService.updateOnderzoek($scope.currentOnderzoek,function(data){$scope.currentOnderzoek=data,$scope.isSaving=!1,$timeout(function(){$scope.meldOnderzoek.$setPristine()}),$archisAlert({title:"Onderzoek is opgeslagen",content:"We hebben het onderzoek succesvol ontvangen."}),archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}):$archisAlert({title:"Geen wijzigingen doorgevoerd",content:"U heeft geen wijzigingen doorgevoerd aan het onderzoek."})},$scope.showUpload=function(){$scope.activeMode="upload"},$scope.openMap=function(){dialogFactory.openGisNormalMapDialog($scope.currentOnderzoek)},$scope.showDraw=function(){$scope.activeMode="draw",$scope.validationActive.redlining=!0,dialogFactory.openRedliningMapDialog($scope.checkRedlining,$scope.currentOnderzoek)},$scope.drawActive=function(){return"draw"==$scope.activeMode||$scope.existsRedlining},$scope.uploadActive=function(){var result="upload"==$scope.activeMode||!(!$scope.currentOnderzoek||!$scope.currentOnderzoek.gmlDocument);return result&&"upload"==$scope.activeMode,result},$scope.checkRedlining=function(){$scope.validationActive.redlining=!0,genericDataService.existsRedlining("Zaaknummer",$scope.currentOnderzoek.zaaknummer,function(data){$scope.existsRedlining=data,$scope.validationActive.redlining=!1})},$scope.isReportMandatory=function(){return onderzoekService.reportMandatory($scope.currentOnderzoek)},$scope.getTitleForDocuments=function(){return $scope.isReportMandatory()?"Verplichte documenten *":"Documenten"},init()}]);var OnderzoekenController=angular.module("archis.controllers.onderzoekencontroller",[]);OnderzoekenController.controller("onderzoekenController",["$scope","$location","$filter","onderzoekService",function($scope,$location,$filter,onderzoekService){$scope.filterText="",$scope.currentPageNumber=1,$scope.itemsPerPage=20;var orderBy=$filter("orderBy"),reverse=!1;$scope.orderColumn=function(col){reverse=!reverse,$scope.onderzoeken=orderBy($scope.onderzoeken,col,reverse)},onderzoekService.getLopendeOnderzoeken(function(data){$scope.onderzoeken=data,$scope.orderColumn("zaaknummer")}),$scope.filterVisible=function(){return function(item){return!$scope.filterText||_contains(item.zaaknummer,$scope.filterText)||_contains(item.soort,$scope.filterText)||_contains(item.plaats,$scope.filterText)||_contains(item.naam,$scope.filterText)||_contains(item.eigenKenmerk,$scope.filterText)||_contains(item.startDatumInverted,$scope.filterText)||_contains(item.archis2onderzoeksmeldingsnummer,$scope.filterText)}};var _contains=function(input,searchstring){return input&&input.toLowerCase().indexOf(searchstring.toLowerCase())>=0}}]);var ToegangscodeController=angular.module("archis.controllers.toegangscodecontroller",[]);ToegangscodeController.controller("toegangscodeController",["$scope","$stateParams","$location","$archisAlert","genericDataService","formService","sessionService","toegangscodeService","dialogFactory",function($scope,$stateParams,$location,$archisAlert,genericDataService,formService,sessionService,toegangscodeService,dialogFactory){$scope.currentToegangscode,$scope.isNietMuteerbaar=!1;var init=function(){var formSteps=[{index:1,uiSref:"toegangscode.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"toegangscode.done",submitsForm:!0,display:"",title:"",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"editToegangscode"),$scope.formService=formService,""==$stateParams.code?$scope.currentToegangscode=toegangscodeService.initializeNewToegangscode():toegangscodeService.getToegangscode($stateParams.code,function(data){$scope.currentToegangscode=data})};$scope.submitForm=function(isFormValid){!$scope.isNietMuteerbaar&&isFormValid&&($scope.currentToegangscode.code?toegangscodeService.updateToegangscode($scope.currentToegangscode,function(data){data.code?($archisAlert({title:"Toegangscode opgeslagen",content:"De toegangscode instellingen zijn succesvol opgeslagen."}),$scope.currentToegangscode=data):($archisAlert({title:"Toegangscode niet opgeslagen",content:"De toegangscode instellingen zijn niet opgeslagen. Mogelijk is het emaiadres onjuist.",type:"error"}),$scope.currentToegangscode.email=null),$scope.editToegangscode.$setPristine()}):toegangscodeService.saveToegangscode($scope.currentToegangscode,function(data){$archisAlert({title:"Toegangscode toegekend",content:"De toegangscode is opgehaald en de instellingen zijn succesvol opgeslagen."}),$scope.currentToegangscode=data,$scope.editToegangscode.$setPristine()}),formService.formStepSubmitted=!0)},init()}]);var ToegangscodesController=angular.module("archis.controllers.toegangscodescontroller",[]);ToegangscodesController.controller("toegangscodesController",["$scope","$location","$filter","toegangscodeService","dialogFactory",function($scope,$location,$filter,toegangscodeService,dialogFactory){$scope.filterText="",$scope.currentPageNumber=1,$scope.itemsPerPage=20,$scope.emailhash="";var orderBy=$filter("orderBy"),reverse=!1;$scope.orderColumn=function(col){reverse=!reverse,$scope.toegangscodes=orderBy($scope.toegangscodes,col,reverse)},toegangscodeService.getToegangscodes(function(data){$scope.toegangscodes=data,$scope.orderColumn("toegangscode")}),$scope.filterVisible=function(){return _isEmailAddress($scope.filterText)?$scope.emailhash||toegangscodeService.getEmailHash($scope.filterText,function(data){$scope.emailhash=JSON.parse(data).emailhash}):$scope.emailhash=null,function(item){return(!$scope.filterText||$scope.emailhash&&item.emailhash==$scope.emailhash||_contains(item.code,$scope.filterText))&&(!!$scope.filterToonAfgesloten||!item.afgesloten)}};var _contains=function(input,searchstring){return input&&input.toLowerCase().indexOf(searchstring.toLowerCase())>=0},_isEmailAddress=function(str){var EMAIL_REGEXP=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;return EMAIL_REGEXP.test(str)};$scope.openToegangscodeLogDialog=function(code){console.log("Email:"+_isEmailAddress("me@example.com")),dialogFactory.openToegangscodeLogDialog({currentToegangscode:code})}}]);var UitstelController=angular.module("archis.controllers.uitstelcontroller",[]);UitstelController.controller("uitstelController",["$scope","$stateParams","formService","onderzoekService","veldwerkService","sessionService","archisSubNavigationHelper",function($scope,$stateParams,formService,onderzoekService,veldwerkService,sessionService,archisSubNavigationHelper){var init=function(){$scope.isNietMuteerbaar=!1,$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}),sessionService.isAuthenticatedAdmin||veldwerkService.getVeldwerk($stateParams.zaaknummer,function(data){data&&($scope.isNietMuteerbaar=!0)})};init()}]);var VeldwerkController=angular.module("archis.controllers.veldwerkcontroller",[]);VeldwerkController.controller("veldwerkController",["$scope","$stateParams","$location","$archisAlert","thesaurusService","onderzoekService","genericDataService","veldwerkService","formService","sessionService","vondstmeldingService","dialogFactory",function($scope,$stateParams,$location,$archisAlert,thesaurusService,onderzoekService,genericDataService,veldwerkService,formService,sessionService,vondstmeldingService,dialogFactory){$scope.currentOnderzoek,$scope.periodes,$scope.complextypen,$scope.showBevindingMessages=!1,$scope.isNietMuteerbaar=!1,$scope.redliningExists=!1,$scope.pveExists=!1,$scope.veldwerk=null,$scope.bevinding=null;var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-veldwerk.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"onderzoek-veldwerk.done",submitsForm:!0,display:"",title:"",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"meldVeldwerk"),$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,$scope.pveExists=!onderzoekService.reportMandatory($scope.currentOnderzoek)||$scope.currentOnderzoek.documenten&&$scope.currentOnderzoek.documenten.length>0,$scope.pveExists||$archisAlert({title:"Geen document(en) opgevoerd",content:"Er zijn nog geen verplichte documenten opgevoerd voor dit onderzoek. Voer eerst de de verplichte documenten op voordat u verder gaat.",type:"error",container:"#alertPve"})}),genericDataService.existsRedlining("Zaaknummer",$stateParams.zaaknummer,function(redliningExists){$scope.redliningExists=redliningExists,$scope.redliningExists||$archisAlert({title:"Geen geometrie opgegeven",content:"Er is nog geen geometrie opgegeven voor dit onderzoek. Voer eerst de geometrie op voordat u verder gaat.",type:"error"})}),onderzoekService.getOnderzoekBetrokkene($stateParams.zaaknummer,function(betrokkene){$scope.betrokkene=betrokkene}),veldwerkService.getVeldwerk($stateParams.zaaknummer,function(data){data?($scope.veldwerk=data,!sessionService.isAuthenticatedAdmin&&$scope.veldwerk.hasFindings&&($scope.isNietMuteerbaar=!0)):$scope.veldwerk=veldwerkService.initalizeNewVeldwerk($stateParams.zaaknummer)})};$scope.submitForm=function(isFormValid){isFormValid?$scope.isNietMuteerbaar||($archisAlert({title:"Veldwerk wordt ingediend",content:"Een moment geduld...",spinner:!0}),veldwerkService.saveVeldwerk($scope.veldwerk,function(data){$archisAlert({title:"Veldwerk opgeslagen",content:"Het veldwerk is succesvol opgeslagen. Klik op Indienen om de melding definitief te maken."}),$scope.isNietMuteerbaar=$scope.veldwerk.hasFindings,$scope.veldwerk=data,$scope.meldVeldwerk.$setPristine()})):$archisAlert({title:"Wijzigingen niet opgeslagen",content:"Het formulier dient correct te worden ingevuld voordat het opgeslagen kan worden."})},$scope.deleteComplex=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteComplex,$scope.veldwerk.complexen,item,$scope.currentOnderzoek.zaaknummer,"complex",$archisAlert)},$scope.openBevindingenDialog=function(){$scope.veldwerk.complexen||($scope.veldwerk.complexen=[]),dialogFactory.openBevindingenDialog(function(){$scope.submitForm($scope.meldVeldwerk.$valid)},$scope,$scope.veldwerk.complexen,$scope.deleteComplex)},$scope.setNietMuteerbaar=function(){$scope.veldwerk.hasFindings=!0},init()}]);var VerwijderOnderzoekController=angular.module("archis.controllers.verwijderonderzoekcontroller",[]);VerwijderOnderzoekController.controller("verwijderOnderzoekController",["$scope","$state","$stateParams","$timeout","$archisAlert","onderzoekService","sessionService","formService","veldwerkService","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$archisAlert,onderzoekService,sessionService,formService,veldwerkService,archisSubNavigationHelper){$scope.isNietMuteerbaar=!1,$scope.currentOnderzoek,$scope.toelichting={};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-verwijder.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"onderzoek-verwijder.done",submitsForm:!0,display:"",title:"details",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"verwijderOnderzoek"),$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}),onderzoekService.getOnderzoekBetrokkene($stateParams.zaaknummer,function(betrokkene){$scope.betrokkene=betrokkene}),sessionService.isAuthenticatedAdmin||veldwerkService.getVeldwerk($stateParams.zaaknummer,function(data){data&&($scope.isNietMuteerbaar=!0)})};$scope.submitForm=function(isFormValid){if($scope.currentOnderzoek&&!$scope.isNietMuteerbaar&&isFormValid){if(!confirm("Weet u zeker dat u het onderzoek wilt verwijderen?"))return!1;$archisAlert({title:"Onderzoek wordt verwijderd",content:"Een moment geduld...",spinner:!0}),onderzoekService.deleteOnderzoek($scope.currentOnderzoek.zaaknummer,$scope.toelichting.tekst,function(data){$scope.verwijderOnderzoek.$setPristine(),$archisAlert({title:"Onderzoek verwijderd",content:"Het onderzoek is succesvol verwijderd. U wordt doorgestuurd naar het overzicht...",spinner:!0}),$timeout(function(){$state.go("onderzoek-overzicht")},3e3)})}},init()}]);var VerwijderToegangscodeController=angular.module("archis.controllers.verwijdertoegangscodecontroller",[]);VerwijderToegangscodeController.controller("verwijderToegangscodeController",["$scope","$state","$stateParams","$timeout","$archisAlert","toegangscodeService","sessionService","formService","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$archisAlert,toegangscodeService,sessionService,formService,archisSubNavigationHelper){$scope.currentToegangscode;var init=function(){var formSteps=[{index:1,uiSref:"toegangscode-verwijder.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"toegangscode-verwijder.done",submitsForm:!0,display:"",title:"details",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"verwijderToegangscode"),$scope.formService=formService,toegangscodeService.getToegangscode($stateParams.code,function(data){$scope.currentToegangscode=data})};$scope.submitForm=function(isFormValid){if($scope.currentToegangscode&&isFormValid){if(!confirm("Weet u zeker dat u de toegamgscode wilt sluiten?"))return!1;$archisAlert({title:"Toegangscode wordt gesloten",content:"Een moment geduld...",spinner:!0}),toegangscodeService.deleteToegangscode($scope.currentToegangscode.code,function(data){$archisAlert({title:"Toegangscode gesloten",content:"De toegangscode is succesvol gesloten. U wordt doorgestuurd naar het overzicht...",spinner:!0}),$timeout(function(){$state.go("toegangscode-overzicht")},3e3)})}},init()}]);var VerwijderVondstlocatieController=angular.module("archis.controllers.verwijdervondstlocatiecontroller",[]);VerwijderVondstlocatieController.controller("verwijderVondstlocatieController",["$scope","$state","$stateParams","$timeout","$archisAlert","onderzoekService","vondstlocatieService","sessionService","formService","veldwerkService","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$archisAlert,onderzoekService,vondstlocatieService,sessionService,formService,veldwerkService,archisSubNavigationHelper){$scope.isNietMuteerbaar=!1,$scope.toelichting={};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-vondstlocatie-verwijder.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"onderzoek-vondstlocatie-verwijder.done",submitsForm:!0,display:"",title:"details",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"verwijderVondstlocatie"),$scope.formService=formService,onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,archisSubNavigationHelper.determineVeldwerkDisabled($scope.currentOnderzoek)}),vondstlocatieService.getVondstlocatie($stateParams.zaaknummer,$stateParams.choId,function(data){$scope.currentVondstlocatie=data}),onderzoekService.getOnderzoekBetrokkene($stateParams.zaaknummer,function(data){$scope.betrokkene=data})};$scope.submitForm=function(isFormValid){if($scope.currentVondstlocatie&&!$scope.isNietMuteerbaar&&isFormValid){if(!confirm("Weet u zeker dat u deze vondstlocatie wilt verwijderen?"))return!1;$archisAlert({title:"Vondstlocatie wordt verwijderd",content:"Een moment geduld...",spinner:!0}),vondstlocatieService.deleteVondstlocatie($scope.currentVondstlocatie.zaaknummer,$scope.currentVondstlocatie.choId,$scope.toelichting.tekst,function(data){$scope.verwijderVondstlocatie.$setPristine(),$archisAlert({title:"Vondstlocatie verwijderd",content:"De vondstlocatie is succesvol verwijderd. U wordt doorgestuurd naar het overzicht...",spinner:!0}),$timeout(function(){$state.go("onderzoek-vondstlocatie-overzicht",{zaaknummer:$stateParams.zaaknummer},{skipConfirm:!0})},3e3)})}},init()}]);var VerwijderVondstmeldingController=angular.module("archis.controllers.verwijdervondstmeldingcontroller",[]);VerwijderVondstmeldingController.controller("verwijderVondstmeldingController",["$scope","$state","$stateParams","$timeout","$archisAlert","vondstmeldingService","sessionService","formService","veldwerkService","archisSubNavigationHelper",function($scope,$state,$stateParams,$timeout,$archisAlert,vondstmeldingService,sessionService,formService,veldwerkService,archisSubNavigationHelper){$scope.currentVondstmelding,$scope.toelichting={};var init=function(){var formSteps=[{index:1,uiSref:"vondstmelding-verwijder.stap1",submitsForm:!1,display:"",title:"",valid:!1},{index:2,uiSref:"vondstmelding-verwijder.done",submitsForm:!0,display:"",title:"details",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"verwijderVondstmelding"),$scope.formService=formService,vondstmeldingService.getVondstmelding($stateParams.zaaknummer,function(data){$scope.currentVondstmelding=data})};$scope.submitForm=function(isFormValid){if($scope.currentVondstmelding&&isFormValid){if(!confirm("Weet u zeker dat u de vondstmelding wilt verwijderen?"))return!1;$archisAlert({title:"Vondstmelding wordt verwijderd",content:"Een moment geduld...",spinner:!0}),vondstmeldingService.deleteVondstmelding($scope.currentVondstmelding.zaaknummer,$scope.toelichting.tekst,function(data){$scope.verwijderVondstmelding.$setPristine(),$archisAlert({title:"Vondstmelding verwijderd",content:"De vondstmelding is succesvol verwijderd. U wordt doorgestuurd naar het overzicht...",spinner:!0}),$timeout(function(){$state.go("vondstmelding-overzicht")},3e3)})}},init()}]);var VondstlocatieController=angular.module("archis.controllers.vondstlocatiecontroller",[]);VondstlocatieController.controller("vondstlocatieController",["$scope","$state","$stateParams","$location","$filter","$sce","$timeout","$archisAlert","configurationService","onderzoekService","genericDataService","vondstlocatieService","vondstmeldingService","thesaurusService","veldwerkService","formService","sessionService","dialogFactory","archisSubNavigationHelper","URL",function($scope,$state,$stateParams,$location,$filter,$sce,$timeout,$archisAlert,configurationService,onderzoekService,genericDataService,vondstlocatieService,vondstmeldingService,thesaurusService,veldwerkService,formService,sessionService,dialogFactory,archisSubNavigationHelper,URL){$scope.title,$scope.currentVondstlocatie={},$scope.isNietMuteerbaar=!1,$scope.isSaving=!1,$scope.plaatsnamen,$scope.mapUrl,$scope.existsRedlining=!1,$scope.mapExtendedData={allVLChoIdsForThisOnderzoek:[]},$scope.validationActive={redlining:!1,voorafgaand:!1};var init=function(){var formSteps=[{index:1,uiSref:"onderzoek-vondstlocatie.stap1",submitsForm:!1,display:"Vondstlocatie",title:"",valid:!1},{index:2,uiSref:"onderzoek-vondstlocatie.stap2",submitsForm:function(){return!$scope.currentVondstlocatie.choId},display:"Details",title:"Details",valid:!1},{index:3,uiSref:"onderzoek-vondstlocatie.stap3",submitsForm:!1,display:"Vondsten",title:"Vondsten",valid:!1},{index:4,uiSref:"onderzoek-vondstlocatie.done",submitsForm:!0,display:"Samenvatting",title:"Samenvatting",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"meldVondstlocatie"),$scope.formService=formService,$stateParams.choId&&"nieuw"!==$stateParams.choId?(vondstlocatieService.getVondstlocatie($stateParams.zaaknummer,$stateParams.choId,function(data){$scope.currentVondstlocatie=data,$scope.checkRedlining()}),vondstlocatieService.getVondstlocaties($stateParams.zaaknummer,function(data){$scope.mapExtendedData.allVLChoIdsForThisOnderzoek=$scope.mapExtendedData.allVLChoIdsForThisOnderzoek.concat(_.pluck(data,"choId"))}),onderzoekService.getOnderzoekBetrokkene($stateParams.zaaknummer,function(betrokkene){$scope.betrokkene=betrokkene}),$scope.title="Gemelde vondstlocatie"):($scope.currentVondstlocatie=vondstlocatieService.initalizeNewVondstlocatie($stateParams.zaaknummer),$scope.title="Melden nieuwe vondstlocatie"),onderzoekService.getOnderzoek($stateParams.zaaknummer,function(data){$scope.currentOnderzoek=data,$scope.mapExtendedData.allVLChoIdsForThisOnderzoek.push(data.choId)}),thesaurusService.getPlaatsnamen(function(data){$scope.plaatsnamen=data}),thesaurusService.getVerwervingswijzen(function(data){$scope.verwervingswijzen=data}),$scope.multiplePanels={activePanels:[0,1,2,3]}};$scope.submitForm=function(isFormValid){!$scope.isNietMuteerbaar&&isFormValid?$scope.currentVondstlocatie.choId?$scope.updateVondstlocatie():$scope.createVondstlocatie():(formService.submitForm($scope.meldVondstlocatie),formService.formStepSubmitted=!0)},$scope.createVondstlocatie=function(){$scope.isSaving=!0,vondstlocatieService.saveVondstlocatie($stateParams.zaaknummer,$scope.currentVondstlocatie,function(data){$state.go($state.current,{zaaknummer:$stateParams.zaaknummer,choId:data.choId},{skipConfirm:!0}),$scope.currentVondstlocatie=data,$scope.isSaving=!1,$archisAlert({title:"Vondstlocatie is opgeslagen",content:"We hebben de vondstlocatie succesvol ontvangen."})})},$scope.updateVondstlocatie=function(){vondstlocatieService.updateVondstlocatie($stateParams.zaaknummer,$scope.currentVondstlocatie,function(data){$scope.currentVondstlocatie=data,$scope.isSaving=!1,$timeout(function(){$scope.meldVondstlocatie.$setPristine()}),$archisAlert({title:"Vondstlocatie is opgeslagen",content:"We hebben de vondstlocatie succesvol ontvangen."})})},$scope.showUpload=function(){$scope.activeMode="upload"},$scope.openMap=function(){dialogFactory.openGisNormalMapDialog($scope.currentVondstlocatie,$scope.mapExtendedData)},$scope.showDraw=function(){$scope.activeMode="draw",$scope.validationActive.redlining=!0,dialogFactory.openVondstlocatiesMapDialog($scope.checkRedlining,$scope.currentVondstlocatie,$scope.mapExtendedData)},$scope.drawActive=function(){return"draw"==$scope.activeMode||$scope.existsRedlining},$scope.checkRedlining=function(){
$scope.validationActive.redlining=!0,genericDataService.existsRedlining("ChoId",$scope.currentVondstlocatie.choId,function(data){$scope.existsRedlining=data,$scope.validationActive.redlining=!1})},$scope.deleteComplex=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteComplex,$scope.currentVondstlocatie.vondsten.complexen,item,$scope.currentVondstlocatie.zaaknummer,"complex",$archisAlert)},$scope.deleteVondst=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteVondst,$scope.currentVondstlocatie.vondsten.vondsten,item,$scope.currentVondstlocatie.zaaknummer,"vondst",$archisAlert)},$scope.deleteSpoor=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteSpoor,$scope.currentVondstlocatie.vondsten.sporen,item,$scope.currentVondstlocatie.zaaknummer,"spoor",$archisAlert)},$scope.deleteStructuur=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteStructuur,$scope.currentVondstlocatie.vondsten.structuren,item,$scope.currentVondstlocatie.zaaknummer,"structuur",$archisAlert)};var closeCallback=function(){$scope.submitForm($scope.meldVondstlocatie.$valid,!0)};$scope.openBevindingenDialog=function(){$scope.currentVondstlocatie.vondsten.complexen||($scope.currentVondstlocatie.vondsten.complexen=[]),dialogFactory.openBevindingenDialog(closeCallback,$scope,$scope.currentVondstlocatie.vondsten.complexen,$scope.deletecomplex,"complexen")},$scope.openVondstenDialog=function(){$scope.currentVondstlocatie.vondsten.vondsten||($scope.currentVondstlocatie.vondsten.vondsten=[]),dialogFactory.openVondstenDialog(closeCallback,$scope,$scope.currentVondstlocatie.vondsten.vondsten,$scope.deleteVondst)},$scope.openSporenDialog=function(){$scope.currentVondstlocatie.vondsten.sporen||($scope.currentVondstlocatie.vondsten.sporen=[]),dialogFactory.openSporenDialog(closeCallback,$scope,$scope.currentVondstlocatie.vondsten.sporen,$scope.deleteSpoor)},$scope.openStructurenDialog=function(){$scope.currentVondstlocatie.vondsten.structuren||($scope.currentVondstlocatie.vondsten.structuren=[]),dialogFactory.openStructurenDialog(closeCallback,$scope,$scope.currentVondstlocatie.vondsten.structuren,$scope.deleteStructuur)},init()}]);var VondstlocatieOverzichtController=angular.module("archis.controllers.vondstlocatieoverzichtcontroller",[]);VondstlocatieOverzichtController.controller("vondstlocatieOverzichtController",["$scope","$location","$stateParams","$filter","vondstlocatieService",function($scope,$location,$stateParams,$filter,vondstlocatieService){$scope.filterText="",$scope.currentPageNumber=1,$scope.itemsPerPage=20;var orderBy=$filter("orderBy"),reverse=!1;$scope.orderColumn=function(col){reverse=!reverse,$scope.vondstlocaties=orderBy($scope.vondstlocaties,col,reverse)},vondstlocatieService.getVondstlocaties($stateParams.zaaknummer,function(data){$scope.vondstlocaties=data,$scope.orderColumn("choId")}),$scope.getTargetParameters=function(item){return{zaaknummer:$stateParams.zaaknummer,choId:item.choId}}}]);var VondstController=angular.module("archis.controllers.vondstmeldingcontroller",[]);VondstController.controller("vondstmeldingController",["$scope","$state","$stateParams","$location","$filter","$sce","$timeout","$archisAlert","configurationService","sessionService","onderzoekService","genericDataService","vondstmeldingService","thesaurusService","veldwerkService","formService","dialogFactory","archisSubNavigationHelper","arrayHelper","stringHelper","URL",function($scope,$state,$stateParams,$location,$filter,$sce,$timeout,$archisAlert,configurationService,sessionService,onderzoekService,genericDataService,vondstmeldingService,thesaurusService,veldwerkService,formService,dialogFactory,archisSubNavigationHelper,arrayHelper,stringHelper,URL){$scope.title,$scope.currentVondstmelding={},$scope.isSaving=!1,$scope.plaatsnamen,$scope.onderzoeken,$scope.mapUrl,$scope.existsRedlining=!1,$scope.validationActive={redlining:!1,voorafgaand:!1};var init=function(){var formSteps=[{index:1,uiSref:"vondstmelding.stap1",submitsForm:!1,display:"Vondst",title:"",valid:!1},{index:2,uiSref:"vondstmelding.stap2",submitsForm:function(){return!$scope.currentVondstmelding.zaaknummer},display:"Geo",title:"Geo",valid:!1},{index:3,uiSref:"vondstmelding.stap3",submitsForm:!1,display:"Details",title:"Details",valid:!1},{index:4,uiSref:"vondstmelding.done",submitsForm:!0,display:"Samenvatting",title:"Samenvatting",valid:!1}];formService.initialize($scope,formSteps,$scope.submitForm,"meldVondst"),$scope.formService=formService,$stateParams.zaaknummer&&"nieuw"!==$stateParams.zaaknummer?(vondstmeldingService.getVondstmelding($stateParams.zaaknummer,function(data){$scope.currentVondstmelding=data,$scope.checkRedlining(),$timeout(function(){$scope.meldVondst.$setPristine()})}),$scope.title="Vondstmelding"):($scope.currentVondstmelding=vondstmeldingService.initalizeNewVondstmelding(),$scope.title="Melden nieuwe vondstmelding",$timeout(function(){$scope.meldVondst.$setPristine()})),thesaurusService.getPlaatsnamen(function(data){$scope.plaatsnamen=data}),sessionService.isAuthenticatedAdmin?configurationService.getVondstmeldingTypeListAdmin(function(data){$scope.vondstmeldingTypes=data}):configurationService.getVondstmeldingTypeList(function(data){$scope.vondstmeldingTypes=data}),$scope.$watch("currentVondstmelding",function(newValue,oldValue){$scope.meldVondst.$setDirty()},!0),$scope.multiplePanels={activePanels:[0,1,2,3]}};$scope.submitForm=function(isFormValid){isFormValid?$scope.currentVondstmelding.zaaknummer?$scope.updateVondstmelding():$scope.createVondstmelding():$archisAlert({title:"Wijzigingen niet opgeslagen",content:"Het formulier dient correct te worden ingevuld voordat het opgeslagen kan worden."})};var vondstmeldingSaveCallback=function(data){$timeout(function(){$scope.meldVondst.$setPristine(),$state.go($state.current,{zaaknummer:data.zaaknummer},{skipConfirm:!0})}),$scope.currentVondstmelding=data,$scope.isSaving=!1,$archisAlert({title:"Vondstmelding is opgeslagen",content:"We hebben de vondstmelding succesvol ontvangen."})};$scope.createVondstmelding=function(){$scope.isSaving=!0,vondstmeldingService.saveVondstmelding($scope.currentVondstmelding,vondstmeldingSaveCallback)},$scope.updateVondstmelding=function(){$scope.meldVondst.$dirty?($scope.isSaving=!0,vondstmeldingService.updateVondstmelding($scope.currentVondstmelding,vondstmeldingSaveCallback)):$archisAlert({title:"Geen wijzigingen doorgevoerd",content:"U heeft geen wijzigingen doorgevoerd aan de vondstmelding."})},$scope.openMap=function(){dialogFactory.openGisNormalMapDialog($scope.currentVondstmelding)},$scope.deleteComplex=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteComplex,$scope.currentVondstmelding.vondsten.complexen,item,$scope.currentVondstmelding.zaaknummer,"complex",$archisAlert)},$scope.deleteVondst=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteVondst,$scope.currentVondstmelding.vondsten.vondsten,item,$scope.currentVondstmelding.zaaknummer,"vondst",$archisAlert)},$scope.deleteSpoor=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteSpoor,$scope.currentVondstmelding.vondsten.sporen,item,$scope.currentVondstmelding.zaaknummer,"spoor",$archisAlert)},$scope.deleteStructuur=function(item){vondstmeldingService.deleteItemFrom(vondstmeldingService.deleteStructuur,$scope.currentVondstmelding.vondsten.structuren,item,$scope.currentVondstmelding.zaaknummer,"structuur",$archisAlert)};var dialogCloseCallback=function(){$scope.submitForm($scope.meldVondst.$valid)};$scope.openBevindingenDialog=function(){$scope.currentVondstmelding.vondsten.complexen||($scope.currentVondstmelding.vondsten.complexen=[]),dialogFactory.openBevindingenDialog(dialogCloseCallback,$scope,$scope.currentVondstmelding.vondsten.complexen,$scope.deleteComplex,"complexen")},$scope.openVondstenDialog=function(){$scope.currentVondstmelding.vondsten.vondsten||($scope.currentVondstmelding.vondsten.vondsten=[]),dialogFactory.openVondstenDialog(dialogCloseCallback,$scope,$scope.currentVondstmelding.vondsten.vondsten,$scope.deleteVondst)},$scope.openSporenDialog=function(){$scope.currentVondstmelding.vondsten.sporen||($scope.currentVondstmelding.vondsten.sporen=[]),dialogFactory.openSporenDialog(dialogCloseCallback,$scope,$scope.currentVondstmelding.vondsten.sporen,$scope.deleteSpoor)},$scope.openStructurenDialog=function(){$scope.currentVondstmelding.vondsten.structuren||($scope.currentVondstmelding.vondsten.structuren=[]),dialogFactory.openStructurenDialog(dialogCloseCallback,$scope,$scope.currentVondstmelding.vondsten.structuren,$scope.deleteStructuur)},$scope.showDraw=function(){$scope.activeMode="draw",$scope.validationActive.redlining=!0,dialogFactory.openVondstlocatiesMapDialog($scope.checkRedlining,$scope.currentVondstmelding)},$scope.drawActive=function(){return"draw"==$scope.activeMode||$scope.existsRedlining},$scope.checkRedlining=function(){$scope.validationActive.redlining=!0,genericDataService.existsRedlining("ChoId",$scope.currentVondstmelding.choIdVondstlocatie,function(data){$scope.existsRedlining=data,$scope.validationActive.redlining=!1})},init()}]);var VondstmeldingenController=angular.module("archis.controllers.vondstmeldingencontroller",[]);VondstmeldingenController.controller("vondstmeldingenController",["$scope","$location","$filter","vondstmeldingService",function($scope,$location,$filter,vondstmeldingService){$scope.filterText="",$scope.currentPageNumber=1,$scope.itemsPerPage=20;var orderBy=$filter("orderBy"),reverse=!1;$scope.orderColumn=function(col){reverse=!reverse,$scope.vondstmeldingen=orderBy($scope.vondstmeldingen,col,reverse)},vondstmeldingService.getLopendeVondstmeldingen(function(data){$scope.vondstmeldingen=data,$scope.orderColumn("zaaknummer")})}]),angular.module("archis.directives",["archis.directives.alert","archis.directives.blocker","archis.directives.breadcrumbs","archis.directives.busyspinner","archis.directives.confirmonexit","archis.directives.documentlink","archis.directives.enter","archis.directives.fieldset","archis.directives.filteredinput","archis.directives.focusonappear","archis.directives.iframeonload","archis.directives.ignoredirty","archis.directives.info","archis.directives.map","archis.directives.overviewrow","archis.directives.thesauruslink","archis.directives.spinner","archis.directives.subnavigation","archis.directives.upload"]);var archisDirectivesAlert=angular.module("archis.directives.alert",[]);archisDirectivesAlert.provider("$archisAlert",function(){this.$get=function($rootScope,$modal,$timeout,$alert){var defaults={type:"info",title:null,content:null,container:"#alert",templateUrl:"js/dist/templates/alert.provider.tmpl.html"};return function(config){var options=angular.extend({},defaults,config);angular.element(document.querySelector(options.container)).empty(),options.scope=$rootScope.$new(),angular.extend(options.scope,config),$alert(options)}}}),archisDirectivesAlert.directive("archisAlert",[function(){return{restrict:"A",replace:!0,templateUrl:"js/dist/templates/alert.directive.tmpl.html"}}]);var archisDirectivesBlocker=angular.module("archis.directives.blocker",[]);archisDirectivesBlocker.directive("blocker",["browserCheck",function(browserCheck){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"js/dist/templates/blocker.tmpl.html",scope:{message:"@",blockTitle:"@",zIndex:"@"},link:function($scope,element,attrs){$scope.fullscreen=void 0!==attrs.fullscreen,$scope.hideMessage=void 0!==attrs.hideMessage,$scope.useOldIESpinner=browserCheck.isOld}}}]);var archisDirectivesBreadcrumbs=angular.module("archis.directives.breadcrumbs",[]);archisDirectivesBlocker.directive("breadcrumbs",["formService",function(formService){return{restrict:"AE",replace:!0,templateUrl:"js/dist/templates/breadcrumbs.tmpl.html",scope:{disableNavigation:"="},controller:function($scope,formService){$scope.steps=function(){return formService.formSteps},$scope.numberOfSteps=function(){return formService.formSteps.length},$scope.currentStep=function(){return formService.currentStep},$scope.currentStepIndex=function(){return formService.currentStep.index},$scope.goToSection=function(formStep){$scope.disableNavigation||formService.goToSection(formStep)},$scope.widthPerCrumb=function(){return 100/$scope.numberOfSteps()+"%"}}}}]);var archisDirectivesBusySpinner=angular.module("archis.directives.busyspinner",[]);archisDirectivesBusySpinner.factory("archisBusySpinnerHttpInterceptor",["$rootScope","$q",function($rootScope,$q){var numLoadings=0,delayInMS=200,title=null,_handleRequest=function(config){numLoadings++,"GET"!==config.method||title?"PUT"===config.method||"POST"===config.method?title="opslaan":"DELETE"===config.method&&(title="verwijderen"):title="laden",setTimeout(function(){0!==numLoadings&&$rootScope.safeApply(function(){$rootScope.titleBusySpinner=title,$rootScope.showBusySpinner=!0})},delayInMS)},_handleResponse=function(response){numLoadings--,0===numLoadings&&$rootScope.safeApply(function(){title=null,$rootScope.titleBusySpinner=title,$rootScope.showBusySpinner=!1})};return{request:function(config){return _handleRequest(config),config||$q.when(config)},response:function(response){return _handleResponse(response),response||$q.when(response)},responseError:function(response){return _handleResponse(response),$q.reject(response)}}}]);var archisDirectivesConfirmOnExit=angular.module("archis.directives.confirmonexit",[]);archisDirectivesConfirmOnExit.directive("confirmOnExit",[function(){return{restrict:"E",require:"^form",scope:{message:"@",skipConfirm:"="},link:function($scope,element,attrs,form){$scope.disableStateChangeCheck=$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams,options){!event.defaultPrevented&&$scope.skipConfirm!==!0&&options.skipConfirm!==!0&&form.$dirty&&(confirm($scope.message)?$scope.disableStateChangeCheck():event.preventDefault())})}}}]);var archisDirectivesDocumentLink=angular.module("archis.directives.documentlink",[]);archisDirectivesDocumentLink.directive("archisDocumentLink",[function(){return{restrict:"AE",replace:!0,templateUrl:"js/dist/templates/documentlink.tmpl.html",scope:{document:"="},controller:["$scope","sessionService",function($scope,sessionService){$scope.hasValidLink=function(){return this.document.link&&this.document.link.toLowerCase().indexOf("archisarchief.cultureelerfgoed.nl")>-1},$scope.isAdminAuthenticated=function(){return sessionService.isAuthenticatedAdmin}}]}}]);var archisDirectivesEnter=angular.module("archis.directives.enter",[]);archisDirectivesEnter.directive("enter",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element,attrs){element.bind("keydown",function(event){13===event.which&&($rootScope.safeApply(function(){scope.$eval(attrs.enter,{event:event})}),event.preventDefault())})}}}]);var archisDirectivesFieldset=angular.module("archis.directives.fieldset",[]);archisDirectivesFieldset.directive("fieldset",["browserCheck","$timeout",function(browserCheck,$timeout){return{restrict:"E",link:function(scope,element,attrs){browserCheck.isIE&&scope.$watch(function(){return element.attr("disabled")},function(disabled){$timeout(function(){angular.forEach(element[0].querySelectorAll("input, select, textarea, button"),function(ele){disabled?angular.element(ele).attr("disabled",disabled):angular.element(ele).removeAttr("disabled")})},0)})}}}]);var archisDirectivesFilteredinput=angular.module("archis.directives.filteredinput",[]);archisDirectivesFilteredinput.directive("archisFilteredInput",["$compile","configurationService",function($compile,configurationService){return{restrict:"AE",require:"ngModel",scope:{model:"=ngModel",datasource:"=",name:"@",placeholder:"@",customFilter:"@",customFilterValueField:"@"},link:function(scope,element,attrs,ngModel){if(scope.required=void 0!==attrs.required,scope.stringMode=void 0!==attrs.stringMode,scope.customFilter&&!scope.customFilterValueField)throw new Error("[archisFilteredInput] custom-filter specified without specifying custom-filter-value-field.");var filterString=" for item in datasource | filter:$viewValue | similarText:$viewValue | orderBy:'score':true | limitTo:8";filterString=scope.stringMode?"item.value"+filterString:scope.customFilter?scope.customFilter+filterString.replace("similarText:$viewValue","similarText:$viewValue:'"+scope.customFilterValueField+"'"):"item as item.prefLabel"+filterString;var html='<input type="text" ng-name="name" autocomplete="off" placeholder="{{::placeholder}}" ng-model="model" ng-required="required" uib-typeahead="'+filterString+'" typeahead-wait-ms="200" typeahead-append-to-body="true" typeahead-select-on-exact="true" typeahead-editable="false" typeahead-on-select="onSelect($item, $model, $label)">',markup=$compile(html)(scope);element.replaceWith(markup),scope.onSelect=function($item,$model,$label){ngModel.$setDirty()},scope.$watch("model",function(newValue,oldValue){ngModel.$setValidity("required",!!newValue)})}}}]);var archisDirectivesFocusOnAppear=angular.module("archis.directives.focusonappear",[]);archisDirectivesFocusOnAppear.directive("focusOnAppear",["$rootScope","$timeout",function($rootScope,$timeout){return{restrict:"A",link:function(scope,element,attrs){function getOffsetTop(elem){var offsetTop=0;do isNaN(elem.offsetTop)||(offsetTop+=elem.offsetTop);while(elem=elem.offsetParent);return offsetTop}function getOffsetLeft(elem){var offsetLeft=0;do isNaN(elem.offsetLeft)||(offsetLeft+=elem.offsetLeft);while(elem=elem.offsetParent);return offsetLeft}if(element[0]){var offsetTop=getOffsetTop(element[0]),offsetLeft=getOffsetLeft(element[0]);window.scrollTo(offsetLeft,offsetTop)}}}}]);var archisDirectivesIframeOnLoad=angular.module("archis.directives.iframeonload",[]);archisDirectivesIframeOnLoad.directive("iframeOnload",["browserCheck",function(browserCheck){return{scope:{callBack:"&iframeOnload"},link:function(scope,element,attrs){var mapLoadFirstTry=!0;element.on("load",function(){return browserCheck.isIE&&mapLoadFirstTry?void(mapLoadFirstTry=!1):scope.callBack()})}}}]);var archisIgnoreDirty=angular.module("archis.directives.ignoredirty",[]);archisIgnoreDirty.directive("ignoreDirty",[function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$pristine=!1}}}]);var archisDirectivesInfo=angular.module("archis.directives.info",[]);archisDirectivesBlocker.directive("info",["$compile",function($compile){return{restrict:"E",replace:!0,scope:{message:"@"},link:function($scope,element,attrs){var useHtmlString="",placementString="",placementLeft=!1,placementRight=!1;if(void 0!==attrs.html&&(useHtmlString='data-html="true"'),void 0!==attrs.left&&(placementLeft=!0),void 0!==attrs.right&&(placementRight=!0),placementLeft&&placementRight)throw new Error("[Info popover] Can't use left and right at the same time.");placementLeft&&(placementString='data-placement="left"'),placementRight&&(placementString='data-placement="right"');var html='<div class="info-popover">\t<span class="glyphicon glyphicon-info-sign" '+useHtmlString+" "+placementString+' aria-hidden="true" bs-popover data-content="{{message}}"></span></div>',markup=$compile(html)($scope);element.replaceWith(markup)}}}]);var archisDirectivesMap=angular.module("archis.directives.map",[]);archisDirectivesMap.directive("archisMap",["$rootScope","$timeout","$sce","browserCheck","dateHelper","genericDataService","sessionService","configurationService","authenticationService",function($rootScope,$timeout,$sce,browserCheck,dateHelper,genericDataService,sessionService,configurationService,authenticationService){var _mapNormal="gisNormalMap",_mapRedlining="gisRedliningMap",_mapVondstlocaties="gisVondstlocatiesMap",_self=null,_hookDone=!1,mapEventHandler=function(msg){var jsonData=msg.data;if(!jsonData)return void console.error("Geen postMessage data aanwezig!");var data=JSON.parse(jsonData);switch(console.log("event: "+data.eventName+" args: "+data.eventArgs),data.eventName){case"loginRequired":authenticationService.generateMapLogin(function(data){_self.loginToMap(data)});break;case"loginSucceeded":_self.setMapUrl(_self.mapName);break;case"mapInitialized":_self.mapLoaded(),_self.focusMap(),_self.mapName!=_mapRedlining&&_self.mapName!=_mapVondstlocaties||_self.setSessionDefaults();break;case"vectorLayerReady":break;case"wgpMessage":console.log("Melding vanuit WGP: "+data.eventArgs);break;case"wgpError":console.log("Fout vanuit WGP: "+data.eventArgs);break;default:console.log("Raar WGP-event: "+data.eventName)}};return{restrict:"AE",replace:!0,templateUrl:"js/dist/templates/map.tmpl.html",scope:{mapName:"@",extendedData:"=",datasource:"="},link:function($scope,element,attrs){$scope.hideShowSelection=void 0!==attrs.hideShowSelection,$scope.mapState=null,$scope.frameId="wgpFrame_"+(new Date).getTime(),_hookDone=!1,_self=$scope,$scope.$on("$destroy",function(){_self=null,window.removeEventListener("message",mapEventHandler)});var clearDatasourceWatch=$scope.$watch("datasource",function(newValue,oldValue){newValue&&(clearDatasourceWatch(),$scope.initMap())});$timeout(function(){_self.wgpFrame=window.frames[_self.frameId]})},controller:["$scope",function($scope){$scope.focusDone=!1,$scope.mapUrl="",$scope.mapLayer="",$scope.initMap=function(){console.log("Init Map"),$scope.mapName==_mapVondstlocaties?$scope.mapLayer=configurationService.configuration.gisVondstlocatiesLayer:$scope.mapName==_mapRedlining?$scope.mapLayer=configurationService.configuration.gisRedliningLayer:$scope.mapName==_mapNormal?$scope.mapLayer=configurationService.configuration.gisNormalLayer:$scope.mapLayer=configurationService.configuration.gisSmallLayer,$scope.focusDone=!1,$scope.mapState="loading",$scope.hookEvents(),$scope.setMapUrl($scope.mapName)},$scope.hookEvents=function(){_hookDone||(window.addEventListener("message",mapEventHandler),_hookDone=!0)},$scope.setMapUrl=function(mapName){var mapNameFromConfig=configurationService.configuration[mapName];if(!mapNameFromConfig)throw new Error("Ongeldige kaartnaam opgegeven["+mapName+"], niet aanwezig in configuratie.");$rootScope.safeApply(function(){$scope.mapUrl=$scope.getMapUrl(mapNameFromConfig)})},$scope.getMapUrl=function(mapName){var mapSettings={host:configurationService.configuration.wgpUrl,absolutePath:"",map:mapName,plugins:"selectexternal,sessiondefaults",extparms:[]},url=mapSettings.host+mapSettings.absolutePath+"?map="+mapSettings.map+"&plugins="+mapSettings.plugins+"&cqlfilter=redlining:redlining;cho_id="+$scope._retrieveProperChoId();$scope.extendedData&&$scope.extendedData.allVLChoIdsForThisOnderzoek&&$scope.extendedData.allVLChoIdsForThisOnderzoek.forEach(function(choId){url+=" OR cho_id = "+choId}),url+="&unique="+(new Date).getTime(),console.log("Loading map from URL: "+url);var urlTrusted=$sce.trustAsResourceUrl(url);return urlTrusted},$scope.focusMap=function(){if(this.datasource){var _self=this,focusOnChoIds=function(choIds){if(choIds){Array.isArray(choIds)||(choIds=[choIds]),console.log("Focus map on cho_ids: ["+choIds+"] objectLayerName: ["+_self.mapLayer+"]");var event={eventName:"showObjects",eventArgs:{objectLayerName:_self.mapLayer,attribute:"cho_id",values:choIds}};_self._postMessage(event),_self.focusDone=!0}};focusOnChoIds(this.extendedData&&this.extendedData.allVLChoIdsForThisOnderzoek?this.extendedData.allVLChoIdsForThisOnderzoek:$scope._retrieveProperChoId())}},$scope.setSessionDefaults=function(){if(this.datasource){var fullDateString=dateHelper.dateToFullString(),event={eventName:"setSessionDefaults",eventArgs:{objectLayerName:this.mapLayer,sessionDefaults:{cho_id:$scope._retrieveProperChoId(),registratie_user:sessionService.getOrganizationId(),herkomst_id:configurationService.configuration.gisHerkomstId,document_id:configurationService.configuration.gisDocumentId,registratie_begin:fullDateString}}};$scope._postMessage(event)}},$scope.loginToMap=function(mapLogin){$scope._postMessage({eventName:"AutoLogin",eventArgs:{user:mapLogin.username,hash:mapLogin.hash,timestamp:mapLogin.timestamp}})},$scope.mapLoaded=function(){$rootScope.safeApply(function(){$scope.mapState="loaded"})},$scope._postMessage=function(event){$scope.wgpFrame&&(browserCheck.isIE?$scope.wgpFrame.postMessage(JSON.stringify(event),configurationService.configuration.wgpTargetOriginUrl):$scope.wgpFrame.contentWindow.postMessage(JSON.stringify(event),configurationService.configuration.wgpTargetOriginUrl))},$scope._retrieveProperChoId=function(){return this.datasource.choIdVondstlocatie||this.datasource.choId}}]}}]);var archisDirectivesOverviewRow=angular.module("archis.directives.overviewrow",[]);archisDirectivesOverviewRow.directive("archisOverviewRow",["$location","$state","$stateParams","dialogFactory","sessionService",function($location,$state,$stateParams,dialogFactory,sessionService){return{restrict:"EA",replace:!0,scope:{item:"=",titleProperty:"@",type:"@",target:"@",getTargetParameters:"&targetParameters"},templateUrl:"js/dist/templates/overviewrow.tmpl.html",controller:["$scope",function($scope){$scope.getTitle=function(){return $scope.item[$scope.titleProperty]},$scope.itemIsntActive=function(){return $scope.item.status&&"actief"!==$scope.item.status.toLowerCase()},$scope.isAdminAuthenticatedAndHasZaaknummerField=function(){return sessionService.isAuthenticatedAdmin&&$scope.item&&$scope.item.zaaknummer},$scope.openBeheerDialog=function(){dialogFactory.openBeheerEditDialog({currentZaaknummer:$scope.item.zaaknummer,currentType:$scope.type})},$scope.openBeheerChangeUitvoerderDialog=function(){dialogFactory.openBeheerChangeUitvoerderDialog({currentZaaknummer:$scope.item.zaaknummer,currentType:$scope.type})},$scope.open=function(){$scope.item&&$state.go($scope.target,$scope.getTargetParameters())}}]}}]);var archisDirectivesThesaurusLink=angular.module("archis.directives.thesauruslink",[]);archisDirectivesThesaurusLink.directive("thesaurusLink",[function(){return{restrict:"AE",replace:!0,templateUrl:"js/dist/templates/thesauruslink.tmpl.html",scope:{uri:"@"}}}]);var archisDirectivesSpinner=angular.module("archis.directives.spinner",[]);archisDirectivesSpinner.directive("spinner",[function(){return{restrict:"A",replace:!0,scope:{title:"@",message:"@"},link:function(scope,element,attrs){scope.showSmall=void 0!==attrs.spinnerSmall},templateUrl:"js/dist/templates/spinner.tmpl.html"}}]),window.cnt=0,window.cntCS=0;var archisDirectivesSubnavigation=angular.module("archis.directives.subnavigation",[]);archisDirectivesSubnavigation.directive("archisSubNavigation",["$rootScope","$stateParams","GLOBAL_EVENTS","onderzoekService","archisSubNavigationHelper",function($rootScope,$stateParams,GLOBAL_EVENTS,onderzoekService,archisSubNavigationHelper){return{restrict:"A",replace:!0,templateUrl:"js/dist/templates/subNavigation.tmpl.html",scope:{},controllerAs:"vm",controller:function($scope){var vm=this,init=function(){vm.veldwerkDisabled=!1,vm.toegangscode=null};$scope.$watch("currentState",function(){var inVondstlocatie=!(!$rootScope.currentState||!$rootScope.currentState.toLowerCase().startsWith("onderzoek-vondstlocatie"));vm.inVondstlocatie!=inVondstlocatie&&(vm.inVondstlocatie=inVondstlocatie)}),$scope.$watch("$stateParams.zaaknummer",function(){vm.zaaknummer=$stateParams.zaaknummer}),$scope.$watch("$stateParams.choId",function(){vm.choId=$stateParams.choId}),$scope.$watch("$stateParams.code",function(){vm.toegangscode=$stateParams.code}),$scope.$watch("$stateParams.afgesloten",function(){vm.afgesloten=$stateParams.afgesloten}),$scope.$on(GLOBAL_EVENTS.veldwerkDisabledChanged,function(event,data){vm.veldwerkDisabled=data}),vm.getState=function(){return $rootScope.currentState},vm.inOnderzoek=function(){return!(!$rootScope.currentState||!$rootScope.currentState.startsWith("onderzoek"))},vm.inVondstmelding=function(){return!(!$rootScope.currentState||!$rootScope.currentState.startsWith("vondstmelding"))},vm.inToegangscode=function(){return!(!$rootScope.currentState||!$rootScope.currentState.startsWith("toegangscode"))},vm.isNew=function(){return!(!vm.zaaknummer||"nieuw"!==vm.zaaknummer)},vm.isEditing=function(){return!(!vm.zaaknummer||!parseInt(vm.zaaknummer))},vm.getBeheerURL=function(){return archisSubNavigationHelper.getBeheerURL()},vm.isAuthenticatedAdmin=function(){return archisSubNavigationHelper.isAuthenticatedAdmin()},init()}}}]),archisDirectivesSubnavigation.factory("archisSubNavigationHelper",["$rootScope","GLOBAL_EVENTS","sessionService","onderzoekService",function($rootScope,GLOBAL_EVENTS,sessionService,onderzoekService){var _beheerURL=null;return{getBeheerURL:function(){return _beheerURL},determineBeheerURL:function(target,zaaknummer){var url=null;url=sessionService.isAuthenticatedAdmin?"#/"+target+"/"+zaaknummer+"/beheer":"#/loginbeheer?target="+target+"&zaaknummer="+zaaknummer,_beheerURL=url},determineVeldwerkDisabled:function(onderzoek){var disabled=onderzoekService.veldwerkDisabled(onderzoek);$rootScope.$broadcast(GLOBAL_EVENTS.veldwerkDisabledChanged,disabled)},isAuthenticatedAdmin:function(){return sessionService.isAuthenticatedAdmin}}}]);var archisDirectivesDialog=angular.module("archis.directives.upload",[]);archisDirectivesDialog.directive("archisUpload",["$rootScope","flowFactory","GLOBAL_EVENTS","URL",function($rootScope,flowFactory,GLOBAL_EVENTS,URL){var hiddenFileIDCounter=1;return{restrict:"A",require:["^form"],scope:{data:"=ngModel",fileType:"@",mode:"@",title:"@",acceptFilter:"@"},templateUrl:"js/dist/templates/upload.tmpl.html",link:function(scope,element,attrs,ctrls){if(scope._form=ctrls[0],scope.hiddenFileID="file-upload-"+hiddenFileIDCounter++,attrs.acceptFilter)if("image/*"===attrs.acceptFilter)scope.acceptText=attrs.acceptFilter,scope.acceptedExtensions=["jpg","jpeg","jpe","jfif","png","bmp","dib","gif","tif","tiff"];else{scope.acceptedExtensions=attrs.acceptFilter.split(",");for(var length=scope.acceptedExtensions.length,acceptText="",i=0;i<length;i++)acceptText+="."+scope.acceptedExtensions[i]+", ";acceptText=acceptText.substring(0,acceptText.lastIndexOf(",")),scope.acceptText=acceptText}},controller:["$scope",function($scope){$scope.fileType="",$scope.mode="single",$scope.uniqueId="",$scope.acceptedExtensions=null,$scope.init=function(){},$scope._isSingle=function(){return"single"===$scope.mode.toLowerCase()},$scope._dataAsArray=function(){return $scope.data?$scope._isSingle()?[$scope.data]:$scope.data:[]},$scope._getCurrentDocument=function(name){return{naam:name,bestandsnaam:name}};var showBusySpinner=function(){$rootScope.titleBusySpinner="uploaden",$rootScope.showBusySpinner=!0,window.onbeforeunload=function(event){var message="Er is momenteel nog een upload actief, weet u zeker dat u wilt afsluiten?";return"undefined"==typeof event&&(event=window.event),event&&(event.returnValue=message),message}},hideBusySpinner=function(){$rootScope.titleBusySpinner=null,$rootScope.showBusySpinner=!1,window.onbeforeunload=null};$scope.fileAdded=function(file,event){if($scope.acceptedExtensions){var index=$scope.acceptedExtensions.indexOf(file.getExtension().toLowerCase());if(index==-1)return alert("U kunt alleen bestanden uploaden met een van de volgende extensies: "+$scope.acceptedExtensions),!1}return!0},$scope.uploadStarted=function(){showBusySpinner(),$scope.uniqueId=Date.now(),this.$flow.opts.target=URL.UPLOAD+"?fileType="+$scope.fileType+"&unique="+$scope.uniqueId},$scope.uploadComplete=function(){hideBusySpinner()},$scope.fileProgress=function($file,$flow){$rootScope.titleBusySpinner="uploaden ["+Math.floor(100*$file.progress())+"%]"},$scope.fileSuccess=function(file,message){var document=$scope._getCurrentDocument(message);if($scope._isSingle())$scope.data=document;else{var documents=_.toArray($scope.data);documents.push(document),$scope.data=documents}$scope._form.$setDirty()},$scope.fileError=function(file,message){switch(message){case"401":$scope.$emit(GLOBAL_EVENTS.notAuthorized);break;default:$scope.$emit(GLOBAL_EVENTS.serverError)}},$scope.deleteDocument=function(document){confirm("Weet u zeker dat u document "+document.naam+" wilt verwijderen?")&&($scope._isSingle()?($scope.data=null,
this.$flow.files=[]):($scope.data.splice($scope.data.indexOf(document),1),this.$flow.files=_.remove(this.$flow.files,function(file){return file.name===document.naam}),0===$scope.data.length&&($scope.data=null)),$scope._form.$setDirty())}}]}}]),angular.module("archis.factories",["archis.factories.arrayhelper","archis.factories.base64Helper","archis.factories.browsercheck","archis.factories.datehelper","archis.factories.dialogfactory","archis.factories.errorfactory","archis.factories.responseinterceptor","archis.factories.stringhelper"]);var archisFactoriesArrayhelper=angular.module("archis.factories.arrayhelper",[]);archisFactoriesArrayhelper.factory("arrayHelper",function(){return{removeFromList:function(source,item){var index=source.indexOf(item);index>-1&&source.splice(index,1)}}});var archisFactoriesBase64Helper=angular.module("archis.factories.base64Helper",[]);archisFactoriesBase64Helper.factory("base64Helper",function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},decode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0,base64test=/[^A-Za-z0-9\+\/\=]/g;base64test.exec(input)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=keyStr.indexOf(input.charAt(i++)),enc2=keyStr.indexOf(input.charAt(i++)),enc3=keyStr.indexOf(input.charAt(i++)),enc4=keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output}}});var archisFactoriesBrowserCheck=angular.module("archis.factories.browsercheck",[]);archisFactoriesBrowserCheck.factory("browserCheck",function(){var browserInfo=navigator.userAgent,browserFlags={};return browserFlags.isFirefox=browserInfo.indexOf("Firefox")!=-1,browserFlags.isOpera=browserInfo.indexOf("Opera")!=-1,browserFlags.isChrome=browserInfo.indexOf("Chrome")!=-1,browserFlags.isSafari=browserInfo.indexOf("Safari")!=-1&&!browserFlags.isChrome,browserFlags.isWebkit=browserInfo.indexOf("WebKit")!=-1,browserFlags.isIE=browserInfo.indexOf("Trident")>0||navigator.userAgent.indexOf("MSIE")>0,browserFlags.isIE6=browserInfo.indexOf("MSIE 6")>0,browserFlags.isIE7=browserInfo.indexOf("MSIE 7")>0,browserFlags.isIE8=browserInfo.indexOf("MSIE 8")>0,browserFlags.isIE9=browserInfo.indexOf("MSIE 9")>0,browserFlags.isIE10=browserInfo.indexOf("MSIE 10")>0,browserFlags.isOld=browserFlags.isIE6||browserFlags.isIE7||browserFlags.isIE8||browserFlags.isIE9,browserFlags.isIE11Up=browserInfo.indexOf("MSIE")==-1&&browserInfo.indexOf("Trident")>0,browserFlags.isIE10Up=browserFlags.isIE10||browserFlags.isIE11Up,browserFlags.isIE9Up=browserFlags.isIE9||browserFlags.isIE10Up,browserFlags});var archisFactoriesDateHelper=angular.module("archis.factories.datehelper",[]);archisFactoriesDateHelper.factory("dateHelper",function(){var _getParts=function(date){var d=date.getDate(),m=date.getMonth()+1,y=date.getFullYear(),h=date.getHours(),mm=date.getMinutes(),s=date.getSeconds(),parts={d:d<=9?"0"+d:d,m:m<=9?"0"+m:m,y:y,h:h<=9?"0"+h:h,mm:mm<=9?"0"+mm:mm,s:s<=9?"0"+s:s};return parts},YMD=function(date){var d=date||new Date,parts=_getParts(d);return""+parts.y+"-"+parts.m+"-"+parts.d},DMY=function(date){var d=date||new Date,parts=_getParts(d);return""+parts.d+"-"+parts.m+"-"+parts.y},DMYHMS=function(date){var d=date||new Date,parts=_getParts(d);return DMY(d)+" "+parts.h+":"+parts.mm+":"+parts.s},_MS_PER_DAY=864e5;return{dateToYMD:function(date){return YMD(date)},dateToDMY:function(date){return DMY(date)},inputToDMYOnbekend:function(input){return input?DMY(new Date(input)):"Onbekend"},inputToDMYHMSOnbekend:function(input){return input?DMYHMS(new Date(input)):"Onbekend"},dateToFullString:function(date){var d=date||new Date,fullstring=d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2)+"T"+("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+d.getSeconds()).slice(-2)+"."+("0"+d.getMilliseconds()).slice(-3);return fullstring},dateDiffInDays:function(start,end){var result=null;if(start&&end){var dateStart=new Date(start),dateEnd=new Date(end);if(dateStart&&dateEnd){var utcStart=Date.UTC(dateStart.getFullYear(),dateStart.getMonth(),dateStart.getDate()),utcEnd=Date.UTC(dateEnd.getFullYear(),dateEnd.getMonth(),dateEnd.getDate());result=Math.floor((utcEnd-utcStart)/_MS_PER_DAY)}}return result}}});var archisDialogFactory=angular.module("archis.factories.dialogfactory",[]);archisDialogFactory.factory("dialogFactory",["$rootScope","$modal",function($rootScope,$modal){var createDialog=function(controller,template,closeCallback,$scope,datasource,deleteItem,name){var data={name:name,datasource:datasource,onDeleteOverride:deleteItem,onCloseDialog:closeCallback};createDialogExtend(controller,template,$scope,data)},createDialogExtend=function(controller,template,$scope,data){if(!data)throw new Error("[DialogFactory.createDialogExtend()] No data provided for dialog.");if(data.hasOwnProperty("datasource")&&(null==data.datasource||void 0==data.datasource))throw new Error("[DialogFactory] Passed datasource cannot be null or undefined, this loses the binding. Instantiate a new object or array as datasource before calling.");var modalScope=$scope?$scope.$new():$rootScope.$new();modalScope.$on("modal.hide",function(){modalScope.$destroy()}),data&&angular.extend(modalScope,data);var myModal=$modal({controller:controller,templateUrl:template,show:!0,scope:modalScope});myModal.$promise.then(myModal.show)},createSimpleDialog=function(controller,template){var myModal=$modal({controller:controller,templateUrl:template,show:!0});myModal.$promise.then(myModal.show)};return{openBevindingenDialog:function(closeCallback,$scope,datasource,deleteItem,name){createDialog("dialogBevindingenController","partials/dialogs/bevindingen.html",closeCallback,$scope,datasource,deleteItem,name)},openSporenDialog:function(closeCallback,$scope,datasource,deleteItem){createDialog("dialogSporenController","partials/dialogs/sporen.html",closeCallback,$scope,datasource,deleteItem)},openStructurenDialog:function(closeCallback,$scope,datasource,deleteItem){createDialog("dialogStructurenController","partials/dialogs/structuren.html",closeCallback,$scope,datasource,deleteItem)},openVondstenDialog:function(closeCallback,$scope,datasource,deleteItem){createDialog("dialogVondstenController","partials/dialogs/vondsten.html",closeCallback,$scope,datasource,deleteItem)},openGisNormalMapDialog:function(datasource,extendedData){createDialogExtend("dialogMapController","partials/dialogs/map.html",null,{mapName:"gisNormalMap",datasource:datasource,extendedData:extendedData})},openRedliningMapDialog:function(closeCallback,datasource){createDialogExtend("dialogMapController","partials/dialogs/map.html",null,{mapName:"gisRedliningMap",datasource:datasource,onCloseDialog:closeCallback})},openVondstlocatiesMapDialog:function(closeCallback,datasource,extendedData){createDialogExtend("dialogMapController","partials/dialogs/map.html",null,{mapName:"gisVondstlocatiesMap",datasource:datasource,onCloseDialog:closeCallback,extendedData:extendedData})},openBeheerImpersonateDialog:function(){createSimpleDialog("dialogBeheerController","partials/dialogs/beheer-impersonate.html")},openBeheerEditDialog:function(data){createDialogExtend("dialogBeheerController","partials/dialogs/beheer-edit.html",null,data)},openBeheerChangeUitvoerderDialog:function(data){createDialogExtend("dialogBeheerController","partials/dialogs/beheer-change-uitvoerder.html",null,data)},openToegangscodeLogDialog:function(data){createDialogExtend("dialogToegangscodeLogController","partials/dialogs/toegangscodelog.html",null,data)},openToegangscodeAanvragenDialog:function(){createSimpleDialog("dialogToegangscodeAanvragenController","partials/dialogs/toegangscode-aanvragen.html")}}}]);var archisFactoriesErrorFactory=angular.module("archis.factories.errorfactory",[]);archisFactoriesErrorFactory.factory("archisErrorFactory",function(){var archisErrors=[{code:"onderzoek.query.nok",message:"Ophalen actieve onderzoeken mislukt."},{code:"onderzoek.query.list.nok",message:"Ophalen gerelateerde onderzoekenlijst mislukt."},{code:"onderzoek.get.nok",message:"Ophalen specifiek onderzoek mislukt."},{code:"onderzoek.post.nok",message:"Toevoegen onderzoek mislukt."},{code:"onderzoek.put.nok",message:"Wijzigen onderzoek mislukt."},{code:"onderzoek.delete.nok",message:"Verwijderen onderzoek mislukt."},{code:"onderzoek.closed.nok",message:"Afsluiten onderzoek mislukt."},{code:"onderzoek.handmatig.closed.nok",message:"Handmatig afsluiten onderzoek mislukt."},{code:"onderzoek.betrokkenen.get.nok",message:"Ophalen betrokkenen van onderzoek mislukt."},{code:"onderzoek.redlining.get.nok",message:"Ophalen redlining van onderzoek mislukt."},{code:"onderzoek.geometrie.get.nok",message:"Ophalen geometrie van onderzoek mislukt."},{code:"configuration.loaded.nok",message:"Configuratie kan niet opgehaald worden."},{code:"configuration.eigenschaptype.get.nok",message:"Eigenschaptype lijst kan niet opgehaald worden."},{code:"gis.get.nok",message:"Kaartgegevens kunnen niet opgehaald worden."},{code:"veldwerk.get.nok",message:"Ophalen veldwerk mislukt."},{code:"veldwerk.post.nok",message:"Toevoegen veldwerk mislukt."},{code:"vondstmelding.query.nok",message:"Ophalen actieve vondstmeldingen mislukt."},{code:"vondstmelding.get.nok",message:"Ophalen specifieke vondstmelding mislukt."},{code:"vondstmelding.post.nok",message:"Toevoegen vondstmelding mislukt."},{code:"vondstmelding.put.nok",message:"Wijzigen vondstmelding mislukt."},{code:"vondstmelding.delete.nok",message:"Verwijderen vondstmelding mislukt."},{code:"vondst.delete.nok",message:"Verwijderen vondst mislukt."},{code:"spoor.delete.nok",message:"Verwijderen spoor mislukt."},{code:"structuur.delete.nok",message:"Verwijderen structuur mislukt."},{code:"complex.delete.nok",message:"Verwijderen complex mislukt."},{code:"thesaurus.perioden.get.nok",message:"Thesauruslijst perioden kan niet opgehaald worden."},{code:"thesaurus.plaatsnamen.get.nok",message:"Thesauruslijst plaatsnamen kan niet opgehaald worden."},{code:"thesaurus.complextypen.get.nok",message:"Thesauruslijst complextypen kan niet opgehaald worden."},{code:"thesaurus.structuren.get.nok",message:"Thesauruslijst structuren kan niet opgehaald worden."},{code:"thesaurus.materialen.get.nok",message:"Thesauruslijst materialen kan niet opgehaald worden."},{code:"thesaurus.artefacten.get.nok",message:"Thesauruslijst artefacten kan niet opgehaald worden."},{code:"thesaurus.sporen.get.nok",message:"Thesauruslijst sporen kan niet opgehaald worden."},{code:"thesaurus.reeksen.get.nok",message:"Thesauruslijst reeksen kan niet opgehaald worden."}],unknownError={code:"error.unknown",message:"Er is een onbekende fout opgetreden."};return{getError:function(code){var error=_.find(archisErrors,{code:code});return error||unknownError}}});var archisFactoriesResponseInterceptor=angular.module("archis.factories.responseinterceptor",[]);archisFactoriesResponseInterceptor.factory("responseInterceptor",function($rootScope,$q,GLOBAL_EVENTS){return{responseError:function(response){return $rootScope.$broadcast({400:GLOBAL_EVENTS.badRequest,401:GLOBAL_EVENTS.notAuthorized,403:GLOBAL_EVENTS.forbidden,419:GLOBAL_EVENTS.sessionTimeout,440:GLOBAL_EVENTS.sessionTimeout,500:GLOBAL_EVENTS.serverError}[response.status],response),$q.reject(response)}}});var archisFactoriesStringHelper=angular.module("archis.factories.stringhelper",[]);archisFactoriesStringHelper.factory("stringHelper",function(){return{capitalizeFirstLetter:function(input){var result="";return input&&(result=input.toLowerCase(),result=result.substring(0,1).toUpperCase()+result.substring(1)),result}}}),angular.module("archis.filters",["archis.filters.capitalizefirstletter","archis.filters.datetodmyonbekend","archis.filters.datetodmyhmsonbekend","archis.filters.isempty","archis.filters.lowercase","archis.filters.similartext","archis.filters.startswithletter"]);var archisFiltersCapitalizeFirstLetter=angular.module("archis.filters.capitalizefirstletter",[]);archisFiltersCapitalizeFirstLetter.filter("capitalizeFirstLetter",["stringHelper",function(stringHelper){return function(input){return stringHelper.capitalizeFirstLetter(input)}}]);var archisFiltersDateToDMYHMSOnbekend=angular.module("archis.filters.datetodmyhmsonbekend",[]);archisFiltersDateToDMYHMSOnbekend.filter("dateToDMYHMSOnbekend",["dateHelper",function(dateHelper){return function(input){var result=input;try{result=dateHelper.inputToDMYHMSOnbekend(input)}catch(error){result="fout"}return result}}]);var archisFiltersDateToDMYOnbekend=angular.module("archis.filters.datetodmyonbekend",[]);archisFiltersDateToDMYOnbekend.filter("dateToDMYOnbekend",["dateHelper",function(dateHelper){return function(input){var result=input;try{result=dateHelper.inputToDMYOnbekend(input)}catch(error){result="fout"}return result}}]);var archisFiltersIsEmpty=angular.module("archis.filters.isempty",[]);archisFiltersIsEmpty.filter("isEmpty",function(){return function(obj){return _.isEmpty(obj)}}),archisFiltersIsEmpty.filter("isNotEmpty",function(){return function(obj){return!_.isEmpty(obj)}});var archisFiltersLowerCase=angular.module("archis.filters.lowercase",[]);archisFiltersLowerCase.filter("lowerCase",[function(){return function(input){if(input&&"string"==typeof input)return input.toLowerCase();throw new Error("Filter lowerCase can only be used with a string. Currently passed type: "+typeof input)}}]);var archisFiltersSimilarText=angular.module("archis.filters.similartext",[]);archisFiltersSimilarText.filter("similarText",function(){var similar_text=function(first,second,percent){if(null===first||null===second||"undefined"==typeof first||"undefined"==typeof second)return 0;first+="",second+="";var p,q,l,sum,pos1=0,pos2=0,max=0,firstLength=first.length,secondLength=second.length;for(max=0,p=0;p<firstLength;p++)for(q=0;q<secondLength;q++){for(l=0;p+l<firstLength&&q+l<secondLength&&first.charAt(p+l)===second.charAt(q+l);l++);l>max&&(max=l,pos1=p,pos2=q)}return sum=max,sum&&(pos1&&pos2&&(sum+=similar_text(first.substr(0,pos1),second.substr(0,pos2))),pos1+max<firstLength&&pos2+max<secondLength&&(sum+=similar_text(first.substr(pos1+max,firstLength-pos1-max),second.substr(pos2+max,secondLength-pos2-max)))),percent?200*sum/(firstLength+secondLength):sum};return function(items,filter,valueFieldOverride){if(!items)throw new Error("[SimilarText] Geen items om over te filteren.");for(var i=0;i<items.length;i++){var item=items[i],value=valueFieldOverride?item[valueFieldOverride]:item.value;value=value||"",item.score=similar_text(value.toLowerCase(),filter.toLowerCase(),!0)}return items}});var archisFiltersStartsWithLetter=angular.module("archis.filters.startswithletter",[]);archisFiltersStartsWithLetter.filter("startsWithLetter",function(){return function(items,letter){if(!angular.isDefined(letter))return items;for(var filtered=[],letterMatch=new RegExp("^"+letter+".*","i"),i=0;i<items.length;i++){var item=items[i];letterMatch.test(item.zaaknummer)&&filtered.push(item)}return filtered}}),angular.module("archis.services",["archis.services.adminservice","archis.services.authenticationservice","archis.services.baseservice","archis.services.configurationservice","archis.services.formservice","archis.services.genericdataservice","archis.services.onderzoekservice","archis.services.sessionservice","archis.services.thesaurusservice","archis.services.veldwerkservice","archis.services.vondstlocatieservice","archis.services.vondstmeldingservice","archis.services.toegangscodeservice"]);var AdminService=angular.module("archis.services.adminservice",[]);AdminService.service("adminService",["$resource","sessionService","URL","USER_ROLES","baseService",function($resource,sessionService,URL,USER_ROLES,baseService){var adminImpersonateResource=$resource(URL.ADMINIMPERSONATE,{parameter:"@parameter"},{update:{method:"PUT"}}),adminBetrokkenenResource=$resource(URL.ADMINBETROKKENEN),adminUndoAfmeldingResource=$resource(URL.ADMINUNDO,{type:"@type",zaaknummer:"@zaaknummer"}),adminChangeBetrokkeneResource=$resource(URL.ADMINCHANGEBETROKKENE,{zaaknummer:"@zaaknummer",betrokkeneid:"@betrokkeneid"},{update:{method:"PUT"}});this.impersonatedOrganization=null,this.impersonate=function(organizationId,onSuccessCallback){var promise=adminImpersonateResource.update({parameter:organizationId}).$promise;baseService.execute(promise,null,null,onSuccessCallback,function(data){sessionService.setSession(data)})},this.clearImpersonation=function(onSuccessCallback){var promise=adminImpersonateResource.remove({parameter:"clear"}).$promise;baseService.execute(promise,null,null,onSuccessCallback,function(data){sessionService.setSession(data)})},this.findBetrokkenen=function(onSuccessCallback){var promise=adminBetrokkenenResource.get({unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.undoAfmelden=function(zaaknummer,type,onSuccessCallback){var promise=adminUndoAfmeldingResource.save({type:type,zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.changeBetrokkene=function(zaaknummer,betrokkeneid,onSuccessCallback){var promise=adminChangeBetrokkeneResource.update({zaaknummer:zaaknummer,betrokkeneid:betrokkeneid,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)}}]);var AuthenticationService=angular.module("archis.services.authenticationservice",[]);AuthenticationService.service("authenticationService",["$rootScope","$location","$http","$resource","sessionService","baseService","base64Helper","URL","USER_ROLES","GLOBAL_EVENTS",function($rootScope,$location,$http,$resource,sessionService,baseService,base64Helper,URL,USER_ROLES,GLOBAL_EVENTS){var self=this,authResource=$resource(URL.AUTH,{method:"@method"},{save:{method:"POST",params:{password:"@password"}}});this.handleStateChange=function(event,next){this.authorizedRoles=next.data.authorizedRoles,this.isAuthenticatedAndAuthorized(this.authorizedRoles,function(success){success||(event.preventDefault(),self.authorizedRoles.indexOf(USER_ROLES.admin_authenticated)!==-1?$rootScope.$broadcast(GLOBAL_EVENTS.notAuthorizedAsAdmin):$rootScope.$broadcast(GLOBAL_EVENTS.notAuthorized))})},this.isAuthenticatedAndAuthorized=function(authorizedRoles,isAuthenticatedAndAuthorizedCallback){this._isAuthenticated(function(isAuthenticatedResult){isAuthenticatedAndAuthorizedCallback(isAuthenticatedResult?self._isAuthorized(authorizedRoles):!1)})},this._isAuthenticated=function(isAuthenticatedCallback){sessionService.isValidSession()?isAuthenticatedCallback(!0):self.getCurrentSession(function(data){_.isEmpty(data)?sessionService.createGuestSession():(sessionService.setSession(data),$rootScope.$broadcast(GLOBAL_EVENTS.loginSuccess)),isAuthenticatedCallback(!0)})},this._isAuthorized=function(authorizedRoles){var isAuthorized=!1;if(angular.isArray(authorizedRoles)||(authorizedRoles=[authorizedRoles]),authorizedRoles.length>0){var lowestRoleLevel=_.sortByOrder(authorizedRoles,["level","asc"])[0].level;isAuthorized=sessionService.getUserLevel()>=lowestRoleLevel}return isAuthorized},this.getCurrentSession=function(onSuccessCallback){var promise=$http.get(URL.SESSION,{params:{unique:(new Date).getTime()}});baseService.execute(promise,null,null,onSuccessCallback,function(data){sessionService.setSession(data)})},this.verifyPassword=function(password,onSuccessCallback,onErrorCallback){var encodedPassword=base64Helper.encode(password),promise=authResource.save({method:"verify",password:encodedPassword}).$promise;baseService.execute(promise,null,null,function(data){data&&data.success?(sessionService.setSession(data.session),onSuccessCallback()):onErrorCallback()})},this.generateMapLogin=function(onSuccessCallback){var promise=authResource.get({method:"generatemaplogin"}).$promise;baseService.execute(promise,null,null,function(data){onSuccessCallback(data)})}}]);var BaseService=angular.module("archis.services.baseservice",[]);BaseService.service("baseService",["$rootScope","GLOBAL_EVENTS","$archisAlert",function($rootScope,GLOBAL_EVENTS,$archisAlert){this.execute=function(promise,cache,cachename,onSuccessCallback,beforeSuccessCallback,alterResponseCallback){var cacheItem=cache?cache.get(cachename):null;return cacheItem?void(onSuccessCallback&&onSuccessCallback(cacheItem)):promise.then(function(response){var _status,_data,_code;response.data?(_data=response.data.body,_status=response.data.status,_code=response.data.code):(_data=response.body,_status=response.status,_code=response.code),"OK"===_status?(beforeSuccessCallback&&beforeSuccessCallback(_data),alterResponseCallback&&(_data=alterResponseCallback(_data)),cache&&cache.put(cachename,_data),onSuccessCallback&&onSuccessCallback(_data)):_code&&"FRIENDLYERROR"==_code?$archisAlert({title:"Fout bij verwerking",content:_data,type:"error"}):$rootScope.$broadcast(GLOBAL_EVENTS.badRequest,_code)})}}]);var ConfigurationService=angular.module("archis.services.configurationservice",[]);ConfigurationService.service("configurationService",["$rootScope","$stateParams","$resource","$http","URL","GLOBAL_EVENTS","baseService",function($rootScope,$stateParams,$resource,$http,URL,GLOBAL_EVENTS,baseService){var $self=this;this._validOnderzoeksTypes=["ABE","ABO","AOP","AOW","APP","ABU","ADU","AGO","AIN","AKA","AVE"],this._validVondstmeldingTypes=["NBA","NBO","NDE","NDU","NGR","NKA","NWA","NXX","XXX"],this._destructieveOnderzoeksTypes=["ABE","ABO","AOP","AOW","APP","NBA","NBO","NGR"];var Configuration=$resource(URL.CONFIGURATION+"eigenschaptype/:naam",{naam:"@naam"},{get:{cache:!1,params:{unique:"@unique"}}}),init=function(){$self.configuration={};var promise=$http.get(URL.CONFIGURATION+"?unique="+(new Date).getTime());baseService.execute(promise,null,null,function(data){$self.configuration=data,$rootScope.$broadcast(GLOBAL_EVENTS.configurationLoaded)})};this.getEigenschapType=function(naam,onSuccessCallback){var promise=Configuration.get({naam:naam,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getOnderzoekTypeList=function(onSuccessCallback){this._getTypeList(onSuccessCallback,function(result,item){return $self._validOnderzoeksTypes.indexOf(item.key)>-1&&($self._destructieveOnderzoeksTypes.indexOf(item.key)>-1?item.group="Rapportplichtig":item.group="Niet-rapportplichtig",result.push(item)),result})},this.getVondstmeldingTypeList=function(onSuccessCallback){this._getTypeList(onSuccessCallback,function(result,item){return $self._validVondstmeldingTypes.indexOf(item.key)>-1&&result.push(item),result})},this.getVondstmeldingTypeListAdmin=function(onSuccessCallback){this._getTypeList(onSuccessCallback,function(result,item){return $self._destructieveOnderzoeksTypes.indexOf(item.key)>-1?item.group="Destructief":item.group="Non-Destructief",result.push(item),result})},this._getTypeList=function(onSuccessCallback,processItem){var promise=Configuration.get({naam:"Type onderzoek",unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){var result=[];return _.forEach(data,function(item){var matches=item.match(/^(\w{3}) - (.+$)/i);if(matches&&3==matches.length){var item={key:matches[1],value:matches[2]};result=processItem(result,item)}},this),result})},this.getVersion=function(onSuccessCallback){$http.get(URL.VERSION+"?unique="+(new Date).getTime()).then(onSuccessCallback)},init()}]),ConfigurationService.constant("URL",{CONFIGURATION:"rest/exchange/config/",ONDERZOEKEN:"rest/exchange/onderzoek/",ONDERZOEKENFROMLIST:"rest/exchange/onderzoek/fromlist",ONDERZOEKAFMELDENPAKBON:"rest/exchange/onderzoek/afmeldenpakbon",ONDERZOEKAFMELDENHANDMATIG:"rest/exchange/onderzoek/afmeldenhandmatig",ONDERZOEKAFMELDENHANDMATIGNR:"rest/exchange/onderzoek/afmeldenhandmatig/:zaaknummer",ONDERZOEKAFMELDENDOORVOEREN:"rest/exchange/onderzoek/afmeldendoorvoeren/:zaaknummer",VONDSTLOCATIES:"rest/exchange/vondstlocaties/:zaaknummer",VONDSTLOCATIE:"rest/exchange/vondstlocatie",VONDSTLOCATIEZAAKNR:"rest/exchange/vondstlocatie/:zaaknummer",VONDSTLOCATIEFULL:"rest/exchange/vondstlocatie/:zaaknummer/:parameter",VELDWERK:"rest/exchange/veldwerk/",VONDSTMELDINGEN:"rest/exchange/vondstmelding/",VONDSTMELDINGWITHTYPE:"rest/exchange/:type/:zaaknummer",VONDSTMELDINGAFMELDEN:"rest/exchange/vondstmelding/afmelden",UPLOAD:"rest/exchange/uploadFile",GENERICDATA:"rest/exchange/generic/:method/:type/:value",AUTH:"rest/auth/:method",ADMINIMPERSONATE:"rest/admin/impersonate/:parameter",ADMINBETROKKENEN:"rest/admin/betrokkenen/shortlist",ADMINUNDO:"rest/admin/undoafmelding/:type/:zaaknummer",ADMINCHANGEBETROKKENE:"rest/admin/changebetrokkene/:zaaknummer/:betrokkeneid",TOEGANGSCODE:"rest/exchange/toegangscode/",TOEGANGSCODEREGISTREREN:"rest/exchange/toegangscoderegistreren",TOEGANGSCODEAUDITLOG:"rest/exchange/toegangscode/:code/auditlog",TOEGANGSCODEMAILHASH:"rest/exchange/toegangscode/emailhash",PERIODEN:"rest/exchange/perioden",PLAATSNAMEN:"rest/exchange/plaatsnamen",COMPLEXTYPEN:"rest/exchange/complextypen",STRUCTUREN:"rest/exchange/structuren",MATERIALEN:"rest/exchange/materialen",ARTEFACTEN:"rest/exchange/artefacten",SPOREN:"rest/exchange/sporen",REEKSEN:"rest/exchange/reeksen",VERWERVINGSWIJZEN:"rest/exchange/verwervingswijzen",SESSION:"rest/auth/session",VERSION:"rest/misc/version"}),ConfigurationService.constant("GLOBAL_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",notAuthorizedAsAdmin:"auth-not-authorized-as-admin",serverError:"internal-server-error",configurationLoaded:"configuration-loaded",dialogChanged:"dialog-changed",dialogClosed:"dialog-closed",veldwerkDisabledChanged:"veldwerk-disabled-changed"}),ConfigurationService.constant("USER_ROLES",{guest:{name:"guest",level:0},user:{name:"user",level:1},admin:{name:"admin",level:2},admin_authenticated:{name:"admin_authenticated",level:3}});var FormService=angular.module("archis.services.formservice",[]);FormService.service("formService",["$rootScope","$state","$stateParams","$timeout",function($rootScope,$state,$stateParams,$timeout){$rootScope.$on("$stateChangeSuccess",function(event,next,params){this.currentStep=this._getMatchingOrFirstState(next.name)}.bind(this)),this.initialize=function(parentScope,formSteps,submitCallback,formName){this.formSteps=formSteps,this.currentStep=this._getMatchingOrFirstState($state.current.name),this.formStepSubmitted=!1,this._submitCallback=submitCallback,this._formName=formName,this._checkFormIsValid=!0;var self=this;$timeout(function(){parentScope.$watch(self._formName,function(form){self._form=form})}),$state.current.name.indexOf(".")===-1&&$state.go(this.currentStep.uiSref,null,{location:"replace",reload:$state.current})},this._getMatchingOrFirstState=function(uiSref){var result=_.find(this.formSteps,{uiSref:uiSref});if(!result&&this.formSteps&&(result=this.formSteps[0]),!result&&!$state.get(uiSref))throw new Error("[formService._getMatchingOrFirstState] No state can be found for: "+$state.current.name);return result},this.goToSection=function(newStep){var next=newStep.index>this.currentStep.index,multiStepAllowed=!0,executesMultiStep=!1;if(next){if(this.formSteps=this.updateValidityOfCurrentStep(),this.formStepSubmitted=!0,executesMultiStep=newStep.index-this.currentStep.index>1){var previousStep=this.formSteps[newStep.index-2];multiStepAllowed=!previousStep||(!this._checkFormIsValid||previousStep.valid)}var submitCancelled=!1;if(this.submitValid(newStep)&&(!executesMultiStep||executesMultiStep&&multiStepAllowed))if(this.isFormValid()){var submitCallbackResult=this._submitCallback(!0);null!=submitCallbackResult&&void 0!=submitCallbackResult&&"boolean"==typeof submitCallbackResult&&(submitCancelled=!submitCallbackResult)}else event.preventDefault()}(!submitCancelled&&next&&multiStepAllowed&&this.isFormValid()||!next)&&(this.currentStep=newStep,this.formStepSubmitted=!1,$state.go(this.currentStep.uiSref,$state.params,{location:"replace",reload:$state.current,skipConfirm:!0}))},this.goToSectionWithIndex=function(index){var newStep=_.find(this.formSteps,{index:index});this.goToSection(newStep)},this.goToSectionWithRef=function(ref){var newStep=_.find(this.formSteps,{uiSref:ref});this.goToSection(newStep)},this.updateValidityOfCurrentStep=function(){var index=_.findIndex(this.formSteps,{uiSref:this.currentStep.uiSref});return this.formSteps[index].valid=this.isFormValid(),this.formSteps},this.submitValid=function(newStep){var result=!1;if("boolean"==typeof newStep.submitsForm)result=newStep.submitsForm;else{if("function"!=typeof newStep.submitsForm)throw new Error("The specifed 'submitValid' value for step: "+newStep.uiSref+" is invalid. Can either be a boolean or a function, was: "+typeof newStep.submitsForm);result=newStep.submitsForm()}return result},this.goToNextSection=function(){var next=_.find(this.formSteps,{index:this.currentStep.index+1});this.goToSection(next)},this.goToPreviousSection=function(){var previous=_.find(this.formSteps,{index:this.currentStep.index-1});this.goToSection(previous)},this.submitForm=function(form){var foundForm=angular.element(document.querySelector('form[name="'+form.$name+'"],ng-form[name="'+form.$name+'"]'));return foundForm&&foundForm.addClass("ng-submitted"),this.isFormValid()},this.deactivateValidCheck=function(){this._checkFormIsValid=!1},this.isFormValid=function(){return!this._checkFormIsValid||this._form.$valid}}]);var GenericDataService=angular.module("archis.services.genericdataservice",[]);GenericDataService.service("genericDataService",["$resource","URL","baseService",function($resource,URL,baseService){var genericDataResource=$resource(URL.GENERICDATA,{method:"@method",type:"@type",value:"@value"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}}});this.existsRedlining=function(type,value,onSuccessCallback){var promise=genericDataResource.query({method:"existsRedlining",type:type,value:value,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.findGeometrieIds=function(type,value,onSuccessCallback){var promise=genericDataResource.query({method:"findGeometrieIds",type:type,value:value,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)}}]);var OnderzoekService=angular.module("archis.services.onderzoekservice",[]);OnderzoekService.service("onderzoekService",["$rootScope","$state","$location","$resource","$cacheFactory","$q","GLOBAL_EVENTS","URL","configurationService","baseService","sessionService","dateHelper",function($rootScope,$state,$location,$resource,$cacheFactory,$q,GLOBAL_EVENTS,URL,configurationService,baseService,sessionService,dateHelper){var onderzoekResource=$resource(URL.ONDERZOEKEN+":zaaknummer",{zaaknummer:"@zaaknummer"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}},get:{cache:!1,params:{unique:"@unique"}},update:{method:"PUT"}}),onderzoekWithTypeResource=$resource(URL.ONDERZOEKEN+":zaaknummer/:type",{zaaknummer:"@zaaknummer"},{query:{method:"GET",isArray:!1,
cache:!1,params:{unique:"@unique"}}}),onderzoekenFromListResource=$resource(URL.ONDERZOEKENFROMLIST),onderzoekAfmeldenResource=$resource(URL.ONDERZOEKAFMELDEN),onderzoekAfmeldenHandmatigResource=$resource(URL.ONDERZOEKAFMELDENHANDMATIG),onderzoekAfmeldenHandmatigNRResource=$resource(URL.ONDERZOEKAFMELDENHANDMATIGNR),onderzoekAfmeldenDoorvoerenResource=$resource(URL.ONDERZOEKAFMELDENDOORVOEREN,{zaaknummer:"@zaaknummer"});this.initalizeNewOnderzoek=function(){var onderzoek={naam:null,startDatum:null,eindDatumGepland:null,registratieDatum:dateHelper.dateToYMD(new Date),periode:null,soort:null,plaats:null,provincie:null,noodopgraving:!1,toelichting:null,bevoegdGezag:null,moeder:null,documenten:null,gmlDocument:null,eigenKenmerk:null};return onderzoek},this.getLopendeOnderzoeken=function(onSuccessCallback){var promise=onderzoekResource.query({unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){return _.forEach(data,function(item){item.startDatum&&(item.startDatumInverted=dateHelper.dateToDMY(new Date(item.startDatum)));var eindDatumGeplandDate=new Date(item.eindDatumGepland),then=eindDatumGeplandDate.setFullYear(eindDatumGeplandDate.getFullYear()+2),diff=dateHelper.dateDiffInDays(Date.now(),then);diff&&(item.isNearingAfmeldingDatum=diff>0&&diff<=configurationService.configuration.onderzoekEindDatumGeplandWarning,item.hasPassedAfmeldingDatum=diff<=0);var isAfgemeld=item.status&&"afgemeld"==item.status.toLowerCase(),message="";item.isNearingAfmeldingDatum&&!isAfgemeld&&(message+=" - Datum afronding rapport nadert \n"),item.hasPassedAfmeldingDatum&&!isAfgemeld&&(message+=" - Datum afronding rapport voorbij \n"),item.hasPve||(message+=" - Onderzoek mist PVE \n"),item.hasGeo||(message+=" - Onderzoek mist Geometrie \n"),isAfgemeld&&(message+=" - Onderzoek is afgemeld \n"),message&&(item.message=message)},this),data})},this.getOnderzoek=function(zaaknummer,onSuccessCallback){var promise=onderzoekResource.get({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getOnderzoekenFromList=function(zaaknummers,onSuccessCallback){var promise=onderzoekenFromListResource.save(zaaknummers).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.saveOnderzoek=function(onderzoek,onSuccessCallback){var promise=onderzoekResource.save(onderzoek).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.updateOnderzoek=function(onderzoek,onSuccessCallback){var promise=onderzoekResource.update(onderzoek).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteOnderzoek=function(zaaknummer,vervalreden,onSuccessCallback){var promise=onderzoekResource.remove({zaaknummer:zaaknummer,vervalreden:vervalreden}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getOnderzoekBetrokkene=function(zaaknummer,onSuccessCallback){var promise=onderzoekWithTypeResource.query({type:"betrokkenen",zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){var betrokkene=data;return betrokkene&&(betrokkene=betrokkene.length>1?_.findWhere(data,{identificatieEherkenning:sessionService.getOrganizationId()}):betrokkene[0]),betrokkene||(betrokkene={bedrijfsnaam:"Onbekend",identificatieEherkenning:-1}),betrokkene})},this.onderzoekAfmeldenPakbon=function(afmelding,onSuccessCallback){var promise=onderzoekAfmeldenResource.save(afmelding).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getOnderzoekAfmeldenHandmatig=function(zaaknummer,onSuccessCallback){var promise=onderzoekAfmeldenHandmatigNRResource.get({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.onderzoekAfmeldenHandmatig=function(afmelding,onSuccessCallback){var promise=onderzoekAfmeldenHandmatigResource.save(afmelding).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.onderzoekAfmeldenDoorvoeren=function(zaaknummer,onSuccessCallback){var promise=onderzoekAfmeldenDoorvoerenResource.save({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this._reportMandatoryList=["ABE","ABO","AOP","AOW","APP"],this._veldwerkDisabledList=["ABU","AIN","AKA"],this._quickAfmeldenList=["ABU"],this._checkOnderzoekSoort=function(list,onderzoek){var result=!(!onderzoek||!_.includes(list,onderzoek.soort));return result},this.reportMandatory=function(onderzoek){return this._checkOnderzoekSoort(this._reportMandatoryList,onderzoek)},this.veldwerkDisabled=function(onderzoek){return this._checkOnderzoekSoort(this._veldwerkDisabledList,onderzoek)},this.quickAfmelden=function(onderzoek){return this._checkOnderzoekSoort(this._quickAfmeldenList,onderzoek)}}]);var SessionService=angular.module("archis.services.sessionservice",[]);SessionService.service("sessionService",["USER_ROLES",function(USER_ROLES){this.isAdmin=!1,this.isAuthenticatedAdmin=!1,this._session=null,this._impersonatedOrganization=null,this.createGuestSession=function(){this._session={sessionId:"guestSession",organizationId:"guestId",organizationIdAdmin:null,organizationName:"",userRole:USER_ROLES.guest},this._checkRole()},this.setSession=function(session){session&&("string"==typeof session.userRole&&(session.userRole=USER_ROLES[session.userRole.toLowerCase()]),this.setImpersonation(session),this._session=session,this._checkRole())},this.isValidSession=function(){return!!(this._session&&this._session.sessionId&&"guestSession"!==this._session.sessionId&&this._session.organizationId&&"guestId"!==this._session.organizationId&&this._session.userRole&&this._session.userRole!==USER_ROLES.guest)},this.getUserRole=function(){return this._session?this._session.userRole:null},this.getBedrijfsnaam=function(){return this.isAuthenticatedAdmin?this._session.organizationName:""},this.getOrganizationId=function(){return this._session?this._session.organizationId:null},this.getUserLevel=function(){var role=this.getUserRole();return role?role.level:0},this.setImpersonation=function(session){session.organizationNameAdmin&&session.organizationIdAdmin&&(this._impersonatedOrganization={bedrijfsnaam:session.organizationNameAdmin,organizationId:session.organizationIdAdmin})},this.getImpersonation=function(){return this._impersonatedOrganization},this.clearImpersonation=function(){this._impersonatedOrganization=null},this.destroy=function(){this._session=null,this._impersonatedOrganization=null,this._checkRole()},this._checkRole=function(){this.isAdmin=!(!this.isValidSession()||this._session.userRole!==USER_ROLES.admin&&this._session.userRole!==USER_ROLES.admin_authenticated),this.isAuthenticatedAdmin=!(!this.isValidSession()||this._session.userRole!==USER_ROLES.admin_authenticated),this.isAuthenticatedAdmin?angular.element(document.querySelector("body")).addClass("admin"):angular.element(document.querySelector("body")).removeClass("admin")}}]);var ThesaurusService=angular.module("archis.services.thesaurusservice",[]);ThesaurusService.service("thesaurusService",["$rootScope","$http","$location","$cacheFactory","baseService","URL","GLOBAL_EVENTS",function($rootScope,$http,$location,$cacheFactory,baseService,URL,GLOBAL_EVENTS){var PERIODEN="perioden",PLAATSNAMEN="plaatsnamen",COMPLEXTYPEN="complextypen",STRUCTUREN="structuren",MATERIALEN="materialen",ARTEFACTEN="artefacten",SPOREN="sporen",REEKSEN="reeksen",VERWERVINGSWIJZEN="verwervingswijzen",thesaurusCache=$cacheFactory("thesaurusCache");this.getPerioden=function(onSuccessCallback){var promise=$http.get(URL.PERIODEN,{cache:!0});baseService.execute(promise,thesaurusCache,PERIODEN,onSuccessCallback,null,function(data){var index=1;return _.forEach(data,function(item){item.index=index++},this),data})},this.getPlaatsnamen=function(onSuccessCallback){var promise=$http.get(URL.PLAATSNAMEN,{cache:!0});baseService.execute(promise,thesaurusCache,PLAATSNAMEN,onSuccessCallback,null,this._alterForFilteredInput)},this.getComplextypen=function(onSuccessCallback){var promise=$http.get(URL.COMPLEXTYPEN,{cache:!0});baseService.execute(promise,thesaurusCache,COMPLEXTYPEN,onSuccessCallback)},this.getStructuren=function(onSuccessCallback){var promise=$http.get(URL.STRUCTUREN,{cache:!0});baseService.execute(promise,thesaurusCache,STRUCTUREN,onSuccessCallback)},this.getMaterialen=function(onSuccessCallback){var promise=$http.get(URL.MATERIALEN,{cache:!0});baseService.execute(promise,thesaurusCache,MATERIALEN,onSuccessCallback)},this.getArtefacten=function(onSuccessCallback){var promise=$http.get(URL.ARTEFACTEN,{cache:!0});baseService.execute(promise,thesaurusCache,ARTEFACTEN,onSuccessCallback)},this.getSporen=function(onSuccessCallback){var promise=$http.get(URL.SPOREN,{cache:!0});baseService.execute(promise,thesaurusCache,SPOREN,onSuccessCallback)},this.getReeksen=function(onSuccessCallback){var promise=$http.get(URL.REEKSEN,{cache:!0});baseService.execute(promise,thesaurusCache,REEKSEN,onSuccessCallback)},this.getVerwervingswijzen=function(onSuccessCallback){var promise=$http.get(URL.VERWERVINGSWIJZEN,{cache:!0});baseService.execute(promise,thesaurusCache,VERWERVINGSWIJZEN,onSuccessCallback)},this._alterForFilteredInput=function(data){for(var i=0;i<data.length;i++)data[i]={value:data[i]};return data}}]);var ToegangscodeService=angular.module("archis.services.toegangscodeservice",[]);ToegangscodeService.service("toegangscodeService",["$resource","GLOBAL_EVENTS","URL","baseService","dateHelper","stringHelper","arrayHelper",function($resource,GLOBAL_EVENTS,URL,baseService,dateHelper,stringHelper,arrayHelper){var toegangscodeResource=$resource(URL.TOEGANGSCODE+":code",{code:"@code"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}},get:{cache:!1,params:{unique:"@unique"}},update:{method:"PUT"},remove:{method:"DELETE"}}),toegangscodeRegistrerenResource=$resource(URL.TOEGANGSCODEREGISTREREN),toegangscodeEmailHashResource=$resource(URL.TOEGANGSCODEMAILHASH),toegangscodeAuditlogResource=$resource(URL.TOEGANGSCODEAUDITLOG,{code:"@code"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}}});this.initializeNewToegangscode=function(){return{code:null,actief:!0,aanvraagdatum:dateHelper.dateToYMD(new Date),begingeldigheid:dateHelper.dateToYMD(new Date),email:null,emailhash:null,eindgeldigheid:null,verklaring:null,toelichting:null,emailverificatie:!1}},this.getToegangscodes=function(onSuccessCallback){var promise=toegangscodeResource.query({unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getToegangscode=function(code,onSuccessCallback){var promise=toegangscodeResource.get({code:code,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.registerToegangscode=function(email,statement,onSuccessCallback){var promise=toegangscodeRegistrerenResource.save({email:email,verklaring:statement}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.saveToegangscode=function(toegangscode,onSuccessCallback){var promise=toegangscodeResource.save({},toegangscode).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.updateToegangscode=function(toegangscode,onSuccessCallback){var promise=toegangscodeResource.update({code:toegangscode.code},toegangscode).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteToegangscode=function(code,onSuccessCallback){var promise=toegangscodeResource.remove({code:code}).$promise;baseService.execute(promise,null,null,onSuccessCallback),onSuccessCallback(code)},this.getAuditlog=function(code,onSuccessCallback){var promise=toegangscodeAuditlogResource.get({code:code,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getEmailHash=function(email,onSuccessCallback){var promise=toegangscodeEmailHashResource.get({email:email,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)}}]);var VeldwerkService=angular.module("archis.services.veldwerkservice",[]);VeldwerkService.service("veldwerkService",["$rootScope","$location","$resource","GLOBAL_EVENTS","URL","baseService",function($rootScope,$location,$resource,GLOBAL_EVENTS,URL,baseService){var Veldwerk=$resource(URL.VELDWERK+":zaaknummer",{zaaknummer:"@zaaknummer"},{get:{cache:!1,params:{unique:"@unique"}},update:{method:"PUT"}});this.getVeldwerk=function(zaaknummer,onSuccessCallback){var promise=Veldwerk.get({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.saveVeldwerk=function(veldwerk,onSuccessCallback){var promise=Veldwerk.save(veldwerk).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.initalizeNewVeldwerk=function(zaaknummer){if(zaaknummer)return{zaaknummer:zaaknummer,afrondingsdatum:"",eindrapportdatum:"",complexen:[]};throw"Zaaknummer moet opgegeven worden bij initiatie veldwerk."}}]);var VondstlocatieService=angular.module("archis.services.vondstlocatieservice",[]);VondstlocatieService.service("vondstlocatieService",["$rootScope","$state","$location","$resource","$cacheFactory","$q","GLOBAL_EVENTS","URL","baseService","sessionService","dateHelper",function($rootScope,$state,$location,$resource,$cacheFactory,$q,GLOBAL_EVENTS,URL,baseService,sessionService,dateHelper){var vondstlocatiesResource=$resource(URL.VONDSTLOCATIES,{zaaknummer:"@zaaknummer"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}},get:{cache:!1,params:{unique:"@unique"}}}),vondstlocatieResource=$resource(URL.VONDSTLOCATIEZAAKNR,{zaaknummer:"@zaaknummer",choId:"@choId"},{query:{method:"GET",isArray:!1},get:{method:"GET",url:URL.VONDSTLOCATIEFULL},update:{method:"PUT"},remove:{method:"DELETE",url:URL.VONDSTLOCATIEFULL}});this.initalizeNewVondstlocatie=function(zaaknummer){var vondstlocatie={naam:null,eigenKenmerk:null,plaats:null};return vondstlocatie},this.getVondstlocaties=function(zaaknummer,onSuccessCallback){var promise=vondstlocatiesResource.query({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback,null)},this.getVondstlocatie=function(zaaknummer,choId,onSuccessCallback){var promise=vondstlocatieResource.get({zaaknummer:zaaknummer,parameter:choId,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){return _addZaaknummerToVondstlocatie(data,zaaknummer)})},this.saveVondstlocatie=function(zaaknummer,vondstlocatie,onSuccessCallback){var promise=vondstlocatieResource.save({zaaknummer:zaaknummer},vondstlocatie).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){return _addZaaknummerToVondstlocatie(data,zaaknummer)})},this.updateVondstlocatie=function(zaaknummer,vondstlocatie,onSuccessCallback){var promise=vondstlocatieResource.update({zaaknummer:zaaknummer},vondstlocatie).$promise;baseService.execute(promise,null,null,onSuccessCallback,null,function(data){return _addZaaknummerToVondstlocatie(data,zaaknummer)})},this.deleteVondstlocatie=function(zaaknummer,choId,vervalreden,onSuccessCallback){var promise=vondstlocatieResource.remove({zaaknummer:zaaknummer,parameter:choId,vervalreden:vervalreden}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.allVondstlocatiesInOnderzoekHaveGeometry=function(zaaknummer,onSuccessCallback){var promise=vondstlocatieResource.get({zaaknummer:zaaknummer,parameter:"allVondstlocatiesInOnderzoekHaveGeometry",unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)};var _addZaaknummerToVondstlocatie=function(data,zaaknummer){return data.zaaknummer=zaaknummer,data}}]);var VondstmeldingService=angular.module("archis.services.vondstmeldingservice",[]);VondstmeldingService.service("vondstmeldingService",["$resource","GLOBAL_EVENTS","URL","baseService","dateHelper","stringHelper","arrayHelper",function($resource,GLOBAL_EVENTS,URL,baseService,dateHelper,stringHelper,arrayHelper){var vondstmeldingResource=$resource(URL.VONDSTMELDINGEN+":zaaknummer",{zaaknummer:"@zaaknummer"},{query:{method:"GET",isArray:!1,cache:!1,params:{unique:"@unique"}},get:{cache:!1,params:{unique:"@unique"}},update:{method:"PUT"}}),vondstmeldingWithType=$resource(URL.VONDSTMELDINGWITHTYPE,{type:"@type",zaaknummer:"@zaaknummer"}),vondstmeldingAfmelding=$resource(URL.VONDSTMELDINGAFMELDEN);this.initalizeNewVondstmelding=function(){var vondstmelding={naam:null,registratieDatum:dateHelper.dateToYMD(new Date),vondstVerwerving:null,plaats:null,datumVondst:null,documenten:null,gmlDocument:null,vondsten:{vondsten:null,sporen:null,structuren:null,complexen:null,toelichting:null}};return vondstmelding},this.getLopendeVondstmeldingen=function(onSuccessCallback){var promise=vondstmeldingResource.query({unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.getVondstmelding=function(zaaknummer,onSuccessCallback){var promise=vondstmeldingResource.get({zaaknummer:zaaknummer,unique:(new Date).getTime()}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.saveVondstmelding=function(vondstmelding,onSuccessCallback){var promise=vondstmeldingResource.save(vondstmelding).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.updateVondstmelding=function(vondstmelding,onSuccessCallback){var promise=vondstmeldingResource.update(vondstmelding).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteVondstmelding=function(zaaknummer,vervalreden,onSuccessCallback){var promise=vondstmeldingResource.remove({zaaknummer:zaaknummer,vervalreden:vervalreden}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.vondstmeldingAfmelden=function(afmelding,onSuccessCallback){var promise=vondstmeldingAfmelding.save(afmelding).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteComplex=function(zaaknummer,choId,onSuccessCallback){var promise=vondstmeldingWithType.remove({type:"complex",zaaknummer:zaaknummer,choId:choId}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteVondst=function(zaaknummer,choId,onSuccessCallback){var promise=vondstmeldingWithType.remove({type:"vondst",zaaknummer:zaaknummer,choId:choId}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteSpoor=function(zaaknummer,choId,onSuccessCallback){var promise=vondstmeldingWithType.remove({type:"spoor",zaaknummer:zaaknummer,choId:choId}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteStructuur=function(zaaknummer,choId,onSuccessCallback){var promise=vondstmeldingWithType.remove({type:"structuur",zaaknummer:zaaknummer,choId:choId}).$promise;baseService.execute(promise,null,null,onSuccessCallback)},this.deleteItemFrom=function(deleteFn,sourceArray,itemToDel,zaaknummer,type,setAlertCallback){var capitalizedType=stringHelper.capitalizeFirstLetter(type);confirm("Weet u zeker dat u dit item wilt verwijderen?")&&(itemToDel.choId?(setAlertCallback({title:capitalizedType+" wordt verwijderd",content:"Een moment geduld...",spinner:!0}),deleteFn(zaaknummer,itemToDel.choId,function(data){data===!0?(arrayHelper.removeFromList(sourceArray,itemToDel),setAlertCallback({title:capitalizedType+" verwijderd",content:"We hebben de uw wijziging succesvol ontvangen."})):setAlertCallback({title:capitalizedType+" niet verwijderd",content:"Er is iets misgegaan bij het verwijderen van de "+type+", probeer het later nog eens."})})):arrayHelper.removeFromList(sourceArray,itemToDel))}}]),angular.module("archis.validators",["archis.validators.datefield","archis.validators.notempty","archis.validators.dateafter","archis.validators.datebefore","archis.validators.higherthan","archis.validators.istruthy","archis.validators.lowerthan","archis.validators.ngmin","archis.validators.ngmax","archis.validators.remotevalidateonderzoek"]);var archisValidatorsDateAfter=angular.module("archis.validators.dateafter",[]);archisValidatorsDateAfter.directive("dateAfter",["dateHelper",function(dateHelper){return{require:"ngModel",link:function($scope,$element,attrs,ngModelCtrl){var validate=function(modelValue){var t,f,valid=!0,comparisonModel=attrs.dateAfter;if(attrs.dateAfterAddYears){var addYears=parseInt(attrs.dateAfterAddYears),dateAfter=new Date(attrs.dateAfter);dateAfter.setFullYear(dateAfter.getFullYear()+addYears),comparisonModel=dateHelper.dateToYMD(dateAfter)}if(comparisonModel){var from=modelValue.split("-");f=new Date(from[0],from[1]-1,from[2]);var to=comparisonModel.split("-");t=new Date(to[0],to[1]-1,to[2]),valid=Date.parse(f)>=Date.parse(t)}return valid};ngModelCtrl.$validators.dateAfter=function(modelValue){return!modelValue||validate(modelValue)},attrs.$observe("dateAfter",function(){ngModelCtrl.$validate()})}}}]);var archisValidatorsDateBefore=angular.module("archis.validators.datebefore",[]);archisValidatorsDateBefore.directive("dateBefore",["dateHelper",function(dateHelper){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var validate=function(modelValue){var t,f,valid=!0,comparisonModel=attrs.dateBefore;if(attrs.dateBeforeAddYears){var addYears=parseInt(attrs.dateBeforeAddYears),dateBefore=new Date(attrs.dateBefore);dateBefore.setFullYear(dateBefore.getFullYear()+addYears),comparisonModel=dateHelper.dateToYMD(dateBefore)}if(comparisonModel){var from=modelValue.split("-");f=new Date(from[0],from[1]-1,from[2]);var to=comparisonModel.split("-");t=new Date(to[0],to[1]-1,to[2]),valid=Date.parse(f)<=Date.parse(t)}return valid};ngModelCtrl.$validators.dateBefore=function(modelValue){return!modelValue||validate(modelValue)},attrs.$observe("dateBefore",function(){ngModelCtrl.$validate()})}}}]);var archisValidatorsDateField=angular.module("archis.validators.datefield",[]);archisValidatorsDateField.directive("dateField",["$filter",function($filter){return{restrict:"A",require:"ngModel",scope:{},link:function(scope,element,attrs,ngModelCtrl){var DATE_MODEL_REGEX=/^(19[0-9]{2}|2[0-9]{3})-(0[1-9]|1[012])-([123]0|[012][1-9]|31)$/;ngModelCtrl.$parsers.unshift(function(data){return data&&ngModelCtrl.$setValidity("format",DATE_MODEL_REGEX.test(data)),data})}}}]);var archisValidatorsHigherThan=angular.module("archis.validators.higherthan",[]);archisValidatorsHigherThan.directive("higherThan",[function(){return{require:"ngModel",scope:{higherThan:"@",modelProperty:"@"},link:function(scope,element,attrs,ngModelCtrl){var validate=function(viewValue){if("object"==typeof viewValue){var comparisonModel=attrs.higherThan,comparisonProperty=viewValue;viewValue&&comparisonModel||ngModelCtrl.$setValidity("higherThan",!0),scope.modelProperty&&"object"==typeof viewValue&&(comparisonProperty=viewValue[scope.modelProperty]);var valid=!!(comparisonProperty&&comparisonModel&&Number(comparisonProperty)>=Number(comparisonModel));console.log("higherThan - CM: "+(comparisonModel||"NA")+" >= CP: "+(comparisonProperty||"NA")+" Valid: "+valid+" ViewVal: "+viewValue),ngModelCtrl.$setValidity("higherThan",ngModelCtrl.$modelValue&&"object"==typeof ngModelCtrl.$modelValue&&ngModelCtrl.$modelValue.index>=attrs.higherThan)}return viewValue};ngModelCtrl.$formatters.push(validate),attrs.$observe("higherThan",function(comparisonModel){return validate(ngModelCtrl.$viewValue)})}}}]);var archisValidatorsIsTruthy=angular.module("archis.validators.istruthy",[]);archisValidatorsIsTruthy.directive("isTruthy",[function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$validators.isTruthy=function(modelValue){return!attrs.required||modelValue&&modelValue},attrs.$observe("isTruthy",function(){ngModelCtrl.$validate()})}}}]);var archisValidatorsLowerThan=angular.module("archis.validators.lowerthan",[]);archisValidatorsLowerThan.directive("lowerThan",[function(){return{require:"ngModel",scope:{lowerThan:"@",modelProperty:"@"},link:function(scope,element,attrs,ngModelCtrl){var validate=function(viewValue){if("object"==typeof viewValue){var comparisonModel=attrs.lowerThan,comparisonProperty=viewValue;viewValue&&comparisonModel||ngModelCtrl.$setValidity("lowerThan",!0),scope.modelProperty&&"object"==typeof viewValue&&(comparisonProperty=viewValue[scope.modelProperty]);var valid=!!(comparisonProperty&&comparisonModel&&Number(comparisonProperty)<=Number(comparisonModel));console.log("lowerThan - CM: "+(comparisonModel||"NA")+" <= CP: "+(comparisonProperty||"NA")+" Valid: "+valid+" ViewVal: "+viewValue),ngModelCtrl.$setValidity("lowerThan",ngModelCtrl.$modelValue&&"object"==typeof ngModelCtrl.$modelValue&&ngModelCtrl.$modelValue.index<=attrs.lowerThan)}return viewValue};ngModelCtrl.$formatters.push(validate),attrs.$observe("lowerThan",function(comparisonModel){return validate(ngModelCtrl.$viewValue)})}}}]);var archisValidatorsNgMax=angular.module("archis.validators.ngmax",[]);archisValidatorsNgMax.directive("ngMax",[function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){function isEmpty(value){return angular.isUndefined(value)||""===value||null===value||value!==value}scope.$watch(attr.ngMax,function(){ctrl.$setViewValue(ctrl.$viewValue)});var maxValidator=function(value){var max=parseInt(attr.ngMax)||1/0;return!isEmpty(value)&&value>max?void ctrl.$setValidity("ngMax",!1):(ctrl.$setValidity("ngMax",!0),value)};ctrl.$parsers.push(maxValidator),ctrl.$formatters.push(maxValidator)}}}]);var archisValidatorsNgMin=angular.module("archis.validators.ngmin",[]);archisValidatorsNgMin.directive("ngMin",[function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){function isEmpty(value){return angular.isUndefined(value)||""===value||null===value||value!==value}scope.$watch(attr.ngMin,function(){ctrl.$setViewValue(ctrl.$viewValue)});var minValidator=function(value){var min=parseInt(attr.ngMin)||0;return!isEmpty(value)&&value<min?void ctrl.$setValidity("ngMin",!1):(ctrl.$setValidity("ngMin",!0),value)};ctrl.$parsers.push(minValidator),ctrl.$formatters.push(minValidator)}}}]);var archisValidatorsNotEmpty=angular.module("archis.validators.notempty",[]);archisValidatorsNotEmpty.directive("notEmpty",[function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$validators.notEmpty=function(modelValue){return!attrs.required||!(!modelValue||_.isEmpty(modelValue))},attrs.$observe("notEmpty",function(){ngModelCtrl.$validate()})}}}]);var archisValidatorsRemoteValidateOnderzoek=angular.module("archis.validators.remotevalidateonderzoek",[]);archisValidatorsRemoteValidateOnderzoek.directive("archisRemoteValidateOnderzoek",["$http","$timeout","URL",function($http,$timeout,URL){return{restrict:"A",require:["^form","ngModel"],scope:{startValidate:"&",endValidate:"&",validationActive:"=",model:"=?archisRemoteValidateOnderzoek"},link:function(scope,element,attrs,ctrls){var _request,_ngForm=ctrls[0],_ngModel=ctrls[1],skipPristineCheck=void 0!==attrs.skipPristineCheck,shouldProcess=function(){return skipPristineCheck||!_ngModel.$pristine},setValidation=function(response){scope.validationActive=!1,scope.endValidate&&scope.endValidate();var isValid="undefined"==typeof _ngModel.$viewValue||""===_ngModel.$viewValue||response&&response.data&&"OK"==response.data.status;_ngModel.$setValidity("archisRemoteValidateOnderzoek",isValid),_ngModel.$processing=_ngModel.$pending=_ngForm.$pending=!1,attrs.archisRemoteValidateOnderzoek&&(scope.model=isValid?response.data.body:null)},cancelRequest=function(){_request&&$timeout.cancel(_request)},handleChange=function(value){return value?shouldProcess(value)?(_ngModel.$pending||(_ngModel.$processing=_ngModel.$pending=_ngForm.$pending=!0),cancelRequest(),scope.validationActive=!0,scope.startValidate&&scope.startValidate(),_request=$timeout(function(){/^\d+$/.test(value)?$http.get(URL.ONDERZOEKEN+value+"?zaakFilter=Alle").then(setValidation):(scope.model=null,scope.validationActive=!1,_ngModel.$setValidity("archisRemoteValidateOnderzoek",!1))},400),!0):setValidation({statusText:"OK",data:{status:"OK"}}):(cancelRequest(),scope.model=null,scope.validationActive=!1,_ngModel.$setPristine(),void _ngModel.$setValidity("archisRemoteValidateOnderzoek",!0))};scope.$watch(function(){return _ngModel.$viewValue},handleChange)}}}]);