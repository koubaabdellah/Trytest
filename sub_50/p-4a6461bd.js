import{c as t}from"./p-199e5a41.js";import{t as o}from"./p-b2c66e42.js";import{l as n}from"./p-9c7f1625.js";function e(o){var n;const{config:e}=t;return"https:"===window.location.protocol||!0===(null===(n=null==e?void 0:e.self)||void 0===n?void 0:n.allSSL)?o.replace("http:","https:"):o}async function i(o,i,r={},s){const[l]=await n(["esri/request"]),{api:c}=t;return new Promise(((t,n)=>{if(3===c){const c={url:!1===r.addSSL?o:e(o),form:i,timeout:r.timeout||0},u="post"===s?Object.assign({usePost:!0},r):r;l(c,u).then(t,n)}else l(o,Object.assign(Object.assign({body:i},r),{method:s||"auto"})).then((o=>{t(o.data)})).catch((t=>n(t)))}))}async function r(o,i={},r={},s,l){const[c]=await n(["esri/request"]),{api:u}=t,a=Object.assign({},i);o.includes("f=")||!0===(null==l?void 0:l.excludeJson)||(a.f="json");const d=function(){var o,n;const{portal:e}=t;return(null===(o=null==e?void 0:e.credential)||void 0===o?void 0:o.token)||(null==e?void 0:e.token)||(null===(n=null==e?void 0:e.portalUser)||void 0===n?void 0:n.token)||""}();d&&(a.token=d),!1===r.addToken&&delete a.token;const v=!1===r.addSSL?o:e(o);if(3===u)return c(Object.assign({url:v,content:a,timeout:r.timeout||0},null==l?void 0:l.v3Request),"post"===s?Object.assign({usePost:!0},r):r);{const t=Object.assign({query:a,method:s||"auto"},r);return(await c(v,t)).data}}const s=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,15,30,30,30,30,30,30,30,30,30,30,120],l=async(t,n,e)=>{var i,l;const c=null!==(i=null==n?void 0:n.pendingStatuses)&&void 0!==i?i:["processing","partial","Pending","InProgress"],u=null!==(l=null==n?void 0:n.successStatuses)&&void 0!==l?l:["completed","Completed"];let a=0;const d=async()=>{const i=await r(t,null==n?void 0:n.requestParams,{},e),l=i.status;if(c.includes(l))return await o((v=a++,1e3*s[v>-1&&v<s.length-1?v:s.length-1])),d();if(u.includes(l))return i;throw i;var v};try{return d()}catch(t){throw console.error(t),t}};export{i as f,l as p,r}