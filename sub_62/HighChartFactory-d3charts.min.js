HighChartFactory.prototype.drawD3Chord=function(){function tt(n,t){a.classed("fade",function(n){return n.source.index!=t&&n.target.index!=t})}var i,b,l,a;if(this.errorCheck()){var k=["#35992A","#69B0E1","#ED7301","#C2BBB1","#004A68","#B52617","#07A57F","#CC9900","#B63C79","#4D4D4D","#2f7ed8","#ED7301"],r=_.union(this.meta.Columns[0].currentElements,this.meta.Columns[1].currentElements),v=[],u,y=this,d=this.preparedData.length,p,n=[],t;$.each(r,function(i,f){u=Array.apply(null,Array(r.length)).map(Number.prototype.valueOf,0);v[i]=u;for(var e=0;e<d;e++)record=y.preparedData[e],record[0]==f&&(p=r.indexOf(record[1]),u[p]=record[3]);t={};t.name=y.meta.Columns[0].namesDictionary[f];t.color=k[i];n.push(t)});var f=720,e=720,o=Math.min(f,e)/2-10,w=o-24,s=d3.format(".1%"),g=d3.svg.arc().innerRadius(w).outerRadius(o),h=d3.layout.chord().padding(.04).sortSubgroups(d3.descending).sortChords(d3.ascending),nt=d3.svg.chord().radius(w),c=d3.select("body").append("svg").attr("width",f).attr("height",e).append("g").attr("id","circle").attr("transform","translate("+f/2+","+e/2+")");c.append("circle").attr("r",o);h.matrix(v);i=c.selectAll(".group").data(h.groups).enter().append("g").attr("class","group").on("mouseover",tt);i.append("title").text(function(t,i){return n[i].name+": "+s(t.value)+" of origins"});b=i.append("path").attr("id",function(n,t){return"group"+t}).attr("d",g).style("fill",function(t,i){return n[i].color});l=i.append("text").attr("x",6).attr("dy",15);l.append("textPath").attr("xlink:href",function(n,t){return"#group"+t}).text(function(t,i){return n[i].name});l.filter(function(n,t){return b[0][t].getTotalLength()/2-16<this.getComputedTextLength()}).remove();a=c.selectAll(".chord").data(h.chords).enter().append("path").attr("class","chord").style("fill",function(t){return n[t.source.index].color}).attr("d",nt);a.append("title").text(function(t){return n[t.source.index].name+" → "+n[t.target.index].name+": "+s(t.source.value)+"\n"+n[t.target.index].name+" → "+n[t.source.index].name+": "+s(t.target.value)})}};HighChartFactory.prototype.drawD3BiPartite=function(){var n,f,i,c,u,a,v;if(this.errorCheck()){n=$("#"+this.target).width();n==0&&(n=960);f=$("#"+this.target).height();f==0&&(f=500);this.chartOptions.primaryFlow==null&&(this.chartOptions.primaryFlow=!1);this.chartOptions.showPercentages==null&&(this.chartOptions.showPercentages=!0);this.chartOptions.width==null&&(this.chartOptions.width=200);this.chartOptions.height==null&&(this.chartOptions.height=400);this.chartOptions.barSize==null&&(this.chartOptions.barSize=35);this.chartOptions.padding==null&&(this.chartOptions.padding=5);this.chartOptions.showLegend==null&&(this.chartOptions.showLegend=!0,this.chartOptions.labelWidth=0);this.chartOptions.showLabel==null&&(this.chartOptions.showLabel=!this.chartOptions.showLegend,this.chartOptions.labelWidth==null&&(this.chartOptions.labelWidth=100));this.chartOptions.percWidth=25;var o=this.categoryDimension.currentElements.length*this.chartOptions.width+(this.categoryDimension.currentElements.length-1)*190,t=50+2*this.chartOptions.labelWidth,s=(n-(t+o+this.chartOptions.labelWidth+this.chartOptions.percWidth))/2+t+o;d3.select("#"+this.target).select("svg").remove();i=d3.select("#"+this.target).append("svg").attr("width",n).attr("height",f);i.append("text").attr("x",s/2+50).attr("y",30).attr("class","d3header").style("text-anchor","middle").text(this.chartOptions.title);i.append("text").attr("x",s/2+50).attr("y",50).attr("class","d3subheader").style("text-anchor","middle").text(this.chartOptions.subtitle);var y=[],r=this,e={},p=this.chartDimensions.indexOf(this.seriesDimension),h=this.chartDimensions.indexOf(this.secondarySeriesDimension),r=this;$.each(this.chartData.series,function(n,t){$.each(t.data,function(n,i){i[p]=t.name;i[h]=r.secondarySeriesDimension.namesDictionary[i[h]]});e[t.name]=t.colour});c=r.preparedData.length;u=[];$.each(this.chartData.series,function(n,t){$.each(t.data,function(n,t){u.push(t)})});var c=u.length,l=this.chartDimensions.indexOf(this.categoryDimension),w=this.chartOptions.subtitle==null?60:80;($.each(this.categoryDimension.currentElements,function(n,f){for(var s=[],o=0;o<c;o++)u[o][l]==f&&(record=[],$.each(u[o],function(n,t){n!=l&&record.push(t)}),s.push(record));r.drawPart(i,y,s,t,w,e,r.categoryDimension.namesDictionary[f]);t=t+r.chartOptions.width+150}),this.chartOptions.showLegend)&&(a=viz.lg().data(d3.keys(e)).height(30).rows(2).width(600).fill(function(n){return e[n.key]}),v=i.append("g").attr("transform","translate(50, 475)"),v.call(a))}};HighChartFactory.prototype.drawPart=function(n,t,i,r,u,f,e){function a(n){return f[o.chartOptions.primaryFlow?n.primary:n.secondary]}function l(n,t){return d3.ascending(h.indexOf(n),h.indexOf(t))}function y(n){$.each(t,function(t,i){i.mouseover(n)});s.selectAll(".mainBars").select(".d3perc").text(function(n){return d3.format("0.0%")(n.percent)})}function p(n){$.each(t,function(t,i){i.mouseout(n)});s.selectAll(".mainBars").select(".d3perc").text(function(n){return d3.format("0.0%")(n.percent)})}var o=this,v=this.chartDimensions.indexOf(this.seriesDimension),h=[],s,c;$.each(this.chartData.series,function(n,t){h.push(t.data[0][v])});s=n.append("g").attr("transform","translate("+r+","+u+")");c=viz.bP().data(i).sortPrimary(l).sortSecondary(l).min(10).pad(this.chartOptions.padding).height(this.chartOptions.height).width(this.chartOptions.width).barSize(this.chartOptions.barSize).fill(a);s.call(c);s.append("text").attr("class","d3label").attr("x",this.chartOptions.width/2).attr("y",-10).style("text-anchor","middle").text(e);this.chartOptions.showLabel&&s.selectAll(".mainBars").append("text").attr("class","d3label").attr("x",function(n){return n.part=="primary"?-o.chartOptions.percWidth:o.chartOptions.percWidth}).attr("y",function(){return 6}).text(function(n){return n.key}).attr("text-anchor",function(n){return n.part=="primary"?"end":"start"});o=this;this.chartOptions.showPercentages&&s.selectAll(".mainBars").append("text").attr("class","d3perc").attr("x",function(n){return n.part=="primary"?-o.chartOptions.percWidth-o.chartOptions.labelWidth:o.chartOptions.percWidth+o.chartOptions.labelWidth}).attr("y",function(){return 6}).text(function(n){return d3.format("0.0%")(n.percent)}).attr("text-anchor",function(n){return n.part=="primary"?"end":"start"});s.selectAll(".mainBars").on("mouseover",y).on("mouseout",p);t.push(c)};