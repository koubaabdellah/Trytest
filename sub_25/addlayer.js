//>>built
require({cache:{"app/utils/messageBundleLoader":function(){define(["require","exports","tslib","esri/intl","esri/request"],function(J,c,a,l,p){function u(z,G){return a.__awaiter(this,void 0,void 0,function(){var D,b;return a.__generator(this,function(f){switch(f.label){case 0:D=l.normalizeMessageBundleLocale(G),f.label=1;case 1:return f.trys.push([1,3,,5]),[4,E("./js/app/"+z+"_"+D.toLowerCase()+".json")];case 2:return b=f.sent(),[2,b];case 3:return f.sent(),[4,E("./js/app/"+z+"_en.json")];case 4:return b=
f.sent(),[2,b];case 5:return[2]}})})}function E(z){return a.__awaiter(this,void 0,void 0,function(){var G,D;return a.__generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,p.default(""+z,{responseType:"json"})];case 1:return G=b.sent(),[2,(null===G||void 0===G?void 0:G.data)||{}];case 2:throw D=b.sent(),console.error("Error loading locale: "+z,D),Error(D);case 3:return[2]}})})}Object.defineProperty(c,"__esModule",{value:!0});c.fetchMessageBundles=c.createMessageBundleLoader=
c.isLoadingLocale=void 0;l=a.__importStar(l);p=a.__importDefault(p);c.isLoadingLocale=!1;c.createMessageBundleLoader=function(z){return a.__awaiter(this,void 0,void 0,function(){var G,D,b;return a.__generator(this,function(f){b=/^mapviewer\/(.+)/;l.registerMessageBundleLoader({pattern:b,fetchMessageBundle:function(h,k){return a.__awaiter(this,void 0,void 0,function(){var r,I;return a.__generator(this,function(A){switch(A.label){case 0:c.isLoadingLocale&&setTimeout(function(){return c.isLoadingLocale=
!1},250);if(k===G)return[3,2];c.isLoadingLocale=!0;return[4,u("t9n/app",k)];case 1:D=A.sent(),G=k,A.label=2;case 2:return r=b.exec(h)[1],"all"!==r?[3,3]:[2,D];case 3:return D[r]?[2,D[r]]:[3,4];case 4:return[4,u(r,k)];case 5:return I=A.sent(),[2,I]}})})}});return[2]})})};c.fetchMessageBundles=function(z,G){return a.__awaiter(this,void 0,void 0,function(){var D;return a.__generator(this,function(b){D=z.map(function(f){return l.fetchMessageBundle(f)});return[2,Promise.all(D)]})})}})},"app/widgets/panels/MapMaker/itembrowsers/AddLayer":function(){define(["require",
"exports","tslib","./AddAnything","../../../../utils/mapUtils/addToMap"],function(J,c,a,l,p){Object.defineProperty(c,"__esModule",{value:!0});l=a.__importDefault(l);p=a.__importStar(p);J=function(u){function E(){var z=null!==u&&u.apply(this,arguments)||this;z.customActions=[{name:z.messages.useAsBasemap,allowed:function(G){return p.canAddPortalItemAsBasemap(G)},asynchronous:!0,onAction:function(G){return a.__awaiter(z,void 0,void 0,function(){var D;return a.__generator(this,function(b){switch(b.label){case 0:return[4,
p.toLayer(G,this.isItemFromArcGISOnline(),this.state)];case 1:return D=b.sent(),[2,p.addLayerAsBasemap(D,this.state)]}})})}}];return z}a.__extends(E,u);E.prototype.getConfig=function(){var z=this;return{baseSections:this.getBaseSections(),customSections:this.getCustomSections(),dialogTitle:this.messages.searchLayers,searchPlaceholderText:this.messages.searchLayers,mainActionTitle:this.messages.addToMap,hideEllipses:!0,showBackBtn:!1,layoutMode:"confined",detailsPaneType:"flyover",showSubmitButton:!1,
enableMapAreaFilter:!0,asynchronousItemSelect:!0,onSelect:function(G){return a.__awaiter(z,void 0,void 0,function(){var D;return a.__generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.processItems(G)];case 1:return b.sent(),[2,Promise.resolve(!0)];case 2:return D=b.sent(),[2,Promise.reject(D)];case 3:return[2]}})})},onDeselect:this.removeItems.bind(this),addQueryParameters:this.addQueryParameters.bind(this),allowedItemTypes:[],availableItemTypeFilters:["layers",
"featureLayers","tileLayers","mapImageLayers","imageryLayers"],disableItemTypeFilters:!1,customActions:this.customActions}};E.prototype.addQueryParameters=function(){var z,G=this.state.portal,D=G.user;D=void 0===D?{}:D;G=G.isPortal;var b=D.orgId,f=['-type:"Feature Collection Template"','-type:"Stream Service"','-typekeywords:"Elevation 3D Layer"','-typekeywords:"Table"','-type:"Feed"'];D&&(void 0===b?0:b)||f.push('-typekeywords:"Requires Subscription"');G||(null===(z=null===D||void 0===D?void 0:D.userRole)||
void 0===z?0:z.canUseDemographics())||f.push('-typekeywords:"Requires Credits"');return'((type:"Map Service" OR type:"Image Service" OR type:"Feature Service" OR type:"Vector Tile Service" OR type:"OGCFeatureServer" OR type:"WMS" OR type:"WFS" OR type:"WMTS" OR type:"KML" OR type:"Table" OR (type:"Feature Collection" AND typekeywords:"Route Layer"^0.1))  AND ('+f.join(" AND ")+"))"};return E}(l.default);c.default=J})},"app/widgets/panels/MapMaker/itembrowsers/AddAnything":function(){define("require exports tslib ../../../../utils/topic ./ItemBrowser ../../../../utils/mapUtils/errorUtils ../../../../utils/mapUtils/addToMap esri/core/promiseUtils esri/core/CollectionFlattener".split(" "),
function(J,c,a,l,p,u,E,z,G){Object.defineProperty(c,"__esModule",{value:!0});l=a.__importDefault(l);p=a.__importDefault(p);E=a.__importStar(E);z=a.__importStar(z);G=a.__importDefault(G);J=function(D){function b(){return null!==D&&D.apply(this,arguments)||this}a.__extends(b,D);b.prototype.getConfig=function(){var f=this;return{baseSections:this.getBaseSections(),customSections:this.getCustomSections(),dialogTitle:this.messages.searchLayers,searchPlaceholderText:this.messages.searchLayers,mainActionTitle:this.messages.addToMap,
hideEllipses:!0,showBackBtn:!1,layoutMode:"confined",detailsPaneType:"flyover",showSubmitButton:!1,enableMapAreaFilter:!0,asynchronousItemSelect:!0,onSelect:function(h){return a.__awaiter(f,void 0,void 0,function(){var k;return a.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.processItems(h)];case 1:return[2,r.sent()];case 2:return k=r.sent(),[2,Promise.reject(k)];case 3:return[2]}})})},onDeselect:this.removeItems.bind(this),addQueryParameters:this.addQueryParameters.bind(this),
availableItemTypeFilters:"layers featureLayers tileLayers tables mapImageLayers imageryLayers".split(" "),disableItemTypeFilters:!1,customActions:[{name:this.messages.useAsBasemap,allowed:function(h){return E.canAddPortalItemAsBasemap(h)},asynchronous:!0,onAction:function(h){return a.__awaiter(f,void 0,void 0,function(){var k;return a.__generator(this,function(r){switch(r.label){case 0:return[4,E.toLayer(h,this.isItemFromArcGISOnline(),this.state)];case 1:return k=r.sent(),[2,E.addLayerAsBasemap(k,
this.state)]}})})}}]}};b.prototype.addQueryParameters=function(){var f,h=this.state.portal,k=h.user;k=void 0===k?{}:k;h=h.isPortal;var r=k.orgId,I='-type:"Feature Collection Template";-type:"Stream Service";-type:"Feature Collection";-typekeywords:"Elevation 3D Layer";-type:"Feed";-typekeywords:"Route Layer"'.split(";");k&&(void 0===r?0:r)||I.push('-typekeywords:"Requires Subscription"');h||(null===(f=null===k||void 0===k?void 0:k.userRole)||void 0===f?0:f.canUseDemographics())||I.push('-typekeywords:"Requires Credits"');
return" ("+I.join(" AND ")+")"};b.prototype.processItems=function(f){return a.__awaiter(this,void 0,void 0,function(){var h,k,r,I,A,T,S,K=this;return a.__generator(this,function(M){switch(M.label){case 0:return M.trys.push([0,7,,8]),h=this.isItemFromArcGISOnline(),[4,Promise.all(f.map(function(L){return E.toLayer(L,h,K.state)}))];case 1:return k=M.sent(),k=k.filter(function(L){return L}),null!==k&&void 0!==k&&k.length?[4,E.addLayers(k,this.state)]:[2,Promise.reject(!1)];case 2:return k=M.sent(),[4,
this.checkForErrors(k)];case 3:if(r=M.sent())return[3,6];I=this.state.mapView;return(A=this.findFirstLayer(k))?[4,E.getExtent(A,this.state)]:[3,5];case 4:T=M.sent(),I.goTo({target:T}),0<A.minScale&&I.scale>A.minScale&&(I.scale=A.minScale,I.scale>A.minScale&&(I.zoom+=1)),M.label=5;case 5:this.publishComplete(),M.label=6;case 6:return[2,Promise.resolve(k)];case 7:return(S=M.sent())&&u.showError(S,null===S||void 0===S?void 0:S.item),[2,Promise.reject(S)];case 8:return[2]}})})};b.prototype.findFirstLayer=
function(f){return(new G.default({getCollections:function(){return[f]},getChildrenFunction:function(h){return"layers"in h?h.layers:null}})).toArray().filter(function(h){return!h.isTable}).reverse()[0]};b.prototype.checkForErrors=function(f){return a.__awaiter(this,void 0,void 0,function(){var h,k=this;return a.__generator(this,function(r){h=this.state.mapView;return[2,z.eachAlways(f.map(function(I){return h.whenLayerView(I)})).then(function(I){return I.filter(function(A){return A.error&&"view:no-layerview-for-layer"!==
A.error.name})}).then(function(I){return I&&I.length?(k.processErrors(I),Promise.reject(I)):!1})]})})};b.prototype.processErrors=function(f){var h=this;(f||[]).forEach(function(k){return h.processError(k)});return!1};b.prototype.processError=function(f){var h=this.state.view.map,k=(f&&f.error||{}).details;k=k&&k.layer||{};k.id&&h.layers.remove(k);u.showError(f,k)};b.prototype.publishComplete=function(){};b.prototype.removeItems=function(f){(f&&f.length?f:[]).forEach(this.removeItem.bind(this));l.default.publish("layer-removed")};
b.prototype.removeItem=function(f){var h=this.state.mapView.map,k=h.layers;h=h.tables;var r=(k||[]).reverse().find(function(I){return I&&I.portalItem&&I.portalItem.id===f.id});r||(r=(h||[]).reverse().find(function(I){return I&&I.portalItem&&I.portalItem.id===f.id}),this.removeFromMap(r,h));r&&this.removeFromMap(r,k)};b.prototype.removeFromMap=function(f,h){f&&h.remove(f)};b.prototype.saveCurrentBasemap=function(){this.currentBasemap=this.state.map.webMap.basemap.clone()};b.prototype.resetBasemap=
function(){return a.__awaiter(this,void 0,void 0,function(){var f,h,k;return a.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),f=this.currentBasemap,[4,E.addAsBasemap(f,this.state)];case 1:return h=r.sent(),[2,h];case 2:return k=r.sent(),[2,Promise.reject(k)];case 3:return[2]}})})};return b}(p.default);c.default=J})},"app/utils/topic":function(){define(["require","exports","tslib","esri/core/Evented"],function(J,c,a,l){Object.defineProperty(c,"__esModule",{value:!0});
l=a.__importDefault(l);J=function(){function p(){}p.publish=function(u,E){return this.hub.emit.apply(this.hub,arguments)};p.subscribe=function(u,E){return this.hub.on.apply(this.hub,arguments)};p.hub=new l.default;return p}();c.default=J})},"app/utils/mapUtils/errorUtils":function(){define("require exports tslib ../topic esri/intl/substitute esri/layers/support/arcgisLayerUrl ../messageBundleLoader".split(" "),function(J,c,a,l,p,u,E){function z(b){var f=b&&b.type||"error";var h=b.name;h=void 0===
h?"":h;var k=b.details,r=b.type;k=b.item||k&&k.layer||k&&k.item||{title:""};r="warning"===(void 0===r?"error":r)?c.messagesErrors.genericWarningTitle:c.messagesErrors.genericErrorTitle;-1<h.indexOf("layerview:create-error")?r=p.substitute(c.messagesErrors.failedToAddLayer,k):"request:server"===h||"identity-manager:not-authorized"===h?(h=k&&k.title||G(b)||"",r=p.substitute(c.messagesErrors.failedToAddLayer,{title:h})):"webmap:save"===h?r=c.messagesErrors.failedToSaveMap:"csv"===h&&(r=p.substitute(c.messagesErrors.unableToAdd,
{type:"CSV"}));h=r;r=b&&b.message||c.messagesErrors.genericError;k=b&&b.name;b&&b.details?(r=(r=b.details)&&r.errors||r&&r.error||[],k=b.item||b.details.layer||b.details.item||{title:""},r=r&&r.name?D(a.__assign(a.__assign({},r),{item:k})):r.length?D(a.__assign(a.__assign({},r.shift()),{item:k})):D(b)):k?r=D(b):r&&-1<r.toLowerCase().indexOf("you do not have access to this resource")&&(r=D({name:"webmap:no-permission",message:r}));return{type:f,title:h,message:r}}function G(b){return(b=(b=(b=(null===
b||void 0===b?void 0:b.details)||"")&&b.url)&&u.parse(b))&&b.title||""}function D(b){var f=b.name,h=b.details,k=b.item||h&&(h.layer||h.item)||{},r=null===h||void 0===h?void 0:h.messageCode;if(k){var I=k.portal;I=null===I||void 0===I?void 0:I.user}else I=null;k.title=k.title||G(b)||"";var A=b&&b.message||c.messagesErrors.genericError;if(k&&"layerview:spatial-reference-incompatible"===f)A=p.substitute(c.messagesErrors.spatialReference,k);else if(k&&"featurelayerview:table-not-supported"===f)A=p.substitute(c.messagesErrors.tableNotSupported,
k);else if(k&&"layer:unsupported-layer-type"===f)b=k&&k.resourceInfo||{type:""},A=p.substitute(c.messagesErrors.unsupportedLayerType,a.__assign(a.__assign({},k),b));else if(k&&"url:unknown-item-type"===f)A=p.substitute(c.messagesErrors.unsupportedUrlType,{});else if(k&&"imageserverraster:open"===f||"imagery-layer:fetch-service-info"===f)A=c.messagesErrors.unsupportedLayer;else if("request:server"===f&&(-1<(null===A||void 0===A?void 0:A.indexOf("Unexpected token \x3c in JSON at position 0"))||-1<(null===
A||void 0===A?void 0:A.indexOf("JSON.parse: unexpected character"))))A=0===h.httpStatus?c.messagesErrors.layerNotOGCFeatures:c.messagesErrors.layerNotAdded;else if("request:server"!==f||"CONT_0155"!==r)"request:server"===f&&400===h.httpStatus||"wmtslayer:unsupported-service-data"===f?A=(null===k||void 0===k?0:k.title)?p.substitute(c.messagesErrors.layerNotAddedSecure,k):c.messagesErrors.layerNotAdded:"request:server"===f&&0===h.httpStatus&&"GeoJSON"===(null===h||void 0===h?void 0:h.type)?A=c.messagesErrors.layerNotGeoJSON:
"request:server"===f&&(503===h.httpStatus||500===h.httpStatus||400===h.httpStatus||404===h.httpStatus||301===h.httpStatus&&"GeoJSON"===(null===h||void 0===h?void 0:h.type))?A=(null===k||void 0===k?0:k.title)?p.substitute(c.messagesErrors.layerNotAddedItem,k):c.messagesErrors.layerNotAdded:"TypeError"===f?A=c.messagesErrors.layerNotAdded:"request:not-secure"===f?A=c.messagesErrors.httpNotAllowed:"webmap:save"===f?A=p.substitute(c.messagesErrors.layerNotSaved,k):"web-document-write:property-required"===
f?A=p.substitute(c.messagesErrors.webMapPropRequired,h):"webmap:unsupported-version"===f?A=p.substitute(c.messagesErrors.webMapUnsupportedVersion,k):"webmap:no-permission"===f?A=p.substitute(c.messagesErrors.webMapNoPermission,k):"basemap:spatial-reference-incompatible"===f?A=p.substitute(c.messagesErrors.basemapIncompatibleSR,k):"basemap:spatial-reference-incompatible-layers"===f?A=p.substitute(c.messagesErrors.basemapLayersIncompatibleSR,k):"basemap:spatial-reference-incompatible-basemap"===f?A=
p.substitute(c.messagesErrors.basemapIncompatible,k):"basemap:arcgis-layers:url-mismatch"===f?A=c.messagesErrors.basemapNotAvailable:"feature-layer-source:unsupported-type"===f||"ogc-feature-layer:missing-property"===f?(b=k&&k.title||G(b),A=p.substitute(c.messagesErrors.unsupportedLayerType,{type:b||"Layer"})):"identity-manager:not-authorized"===f||"request:server"===f&&403===h.httpStatus?(k=(null===k||void 0===k?void 0:k.portalItem)||k,k=null===k||void 0===k?void 0:k.typeKeywords,k=-1<(null===k||
void 0===k?void 0:k.indexOf("Requires Subscription"))||-1<(null===k||void 0===k?void 0:k.indexOf("Requires Credits"))||!1,b=G(b),A=k?p.substitute((null===I||void 0===I?0:I.isOrgUser)?c.messagesErrors.subscriptionContentOrg:c.messagesErrors.subscriptionContentPublic,{title:b||""}):p.substitute(c.messagesErrors.failedToAddLayer,{title:b||""})):-1<(null===A||void 0===A?void 0:A.indexOf("Unable to identify latitudeField and/or longitudeField from"))?A=c.messagesErrors.unableToAddCSV:"shortcut:invalid"===
f?A=p.substitute(c.messagesErrors.shortcutInvalid,{name:b.currentCommand.alias}):"forms:missingRequiredField"===f?A=c.messagesErrors.missingRequiredField:"csv-layer:location-fields-not-found"===f?A=c.messagesErrors.csvLayerLocationFieldsNotFound:"wfs-layer:kvp-encoding-not-supported"===f?A=c.messagesErrors.wfsEncodingNotSupported:"web-document-write:unsupported-feature-effect"===f&&(A=c.tempErrorMessage);return A}Object.defineProperty(c,"__esModule",{value:!0});c.getErrorInfo=c.showError=c.fetchErrorMessages=
c.messagesErrors=c.tempErrorMessage=void 0;l=a.__importDefault(l);p=a.__importStar(p);u=a.__importStar(u);c.tempErrorMessage="Close the Filter pane before saving.";c.fetchErrorMessages=function(){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(f){switch(f.label){case 0:return[4,E.fetchMessageBundles(["mapviewer/errors"])];case 1:return b=f.sent()[0],c.messagesErrors=b,[2]}})})};c.showError=function(b,f){b=z(a.__assign(a.__assign({},b&&b.error||b),{item:f}));
l.default.publish("alert/show",b)};c.getErrorInfo=z})},"app/utils/mapUtils/addToMap":function(){define("require exports tslib esri/layers/MapImageLayer esri/Basemap ./errorUtils esri/layers/Layer ../../utils/LayerUtil ../../utils/project ../../utils/layerUtils ../../utils/appUtils esri/layers/support/arcgisLayerUrl ../../utils/topic esri/core/Collection esri/portal/PortalItem esri/core/urlUtils esri/geometry/projection esri/support/basemapUtils esri/geometry/support/spatialReferenceUtils esri/geometry/SpatialReference esri/core/reactiveUtils".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r,I,A,T,S,K,M){function L(e){return!!/^(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/i.test(e)}function x(e){e=e.trim();var w=L(e);e=b.parseUrl(e);return!w||"https"===(null===e||void 0===e?void 0:e.protocol)}function y(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v;return a.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,
8,,9]),[4,C(e,w)];case 1:return(m=t.sent())?null!==m&&void 0!==m&&m.loadAll?[4,m.loadAll()]:[3,3]:[3,6];case 2:return n=t.sent(),[3,5];case 3:return[4,m.load()];case 4:n=t.sent(),t.label=5;case 5:return n,[2,m];case 6:return[2,Promise.reject(!1)];case 7:return[3,9];case 8:return v=t.sent(),u.showError(v),[2,Promise.reject(v)];case 9:return[2]}})})}function C(e,w){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(m){switch(m.label){case 0:return(null===e||void 0===
e?void 0:e.type)in{OGCFeatureServer:1,WFS:1}?[4,ja(e,w)]:[3,2];case 1:return[2,m.sent()];case 2:return B(e)?[4,ra(e)]:[3,4];case 3:return[2,m.sent()];case 4:return[4,E.default.fromPortalItem({portalItem:e})];case 5:return[2,m.sent()]}})})}function B(e){return b.includes((null===e||void 0===e?void 0:e.typeKeywords)||[],"Location Tracking Service")}function R(e,w,m){var n,v;m=m.config.urlParameters;var t=(null===e||void 0===e?void 0:e.allSubLayers)||(null===e||void 0===e?void 0:e.layers)||(null===e||
void 0===e?void 0:e.sublayers);if(!(m&&e&&t&&t.length)||e.isTable)return e;var d=(w=w.split("?layers\x3d")[1])&&-1<w.indexOf("show:")&&w.split(":")[1].split(",")||[],g=!m||(null===(n=m.layerIds)||void 0===n?0:n.length)&&1===(null===(v=null===m||void 0===m?void 0:m.layers)||void 0===v?void 0:v.length)?m.layerIds:null;if(!(d&&d.length||(null===g||void 0===g?0:g.length)))return e;d&&t.forEach(function(q){return q.visible=-1<d.indexOf(q.layerId+"")||-1<d.indexOf(q.id+"")});if(null===g||void 0===g?0:g.length)e.layers=
new k.default(t.filter(function(q){return-1===g.indexOf(q.layerId)}));return e}function P(e,w,m){return a.__awaiter(this,void 0,void 0,function(){var n,v,t;return a.__generator(this,function(d){switch(d.label){case 0:return[4,e.load()];case 1:return d.sent(),n=e&&e.portalItem||{},v=e&&"group"===e.type&&!n.isFeatureCollection&&!B(n),t=w.hideTypes,e.type in t&&(e.listMode="hide-children"),v?m?[3,3]:[4,ia(e,w)]:[3,6];case 2:return d.sent(),[3,5];case 3:return[4,X(e,w)];case 4:d.sent(),d.label=5;case 5:return[3,
8];case 6:return[4,da(e,w)];case 7:d.sent(),d.label=8;case 8:return[2,e]}})})}function F(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t;return a.__generator(this,function(d){switch(d.label){case 0:return m=w.mapView,n=m.map,v=n.tables||new k.default,[4,la(e,!1,w)];case 1:return t=d.sent(),v.add(t),m.map.tables=v,h.default.publish("table-added"),[2,Promise.resolve(!0)]}})})}function U(e){var w=[];null===e||void 0===e?void 0:e.forEach(function(m){var n,v=m&&m.portalItem||{};v="group"===
(null===m||void 0===m?void 0:m.type)&&(null===(n=null===m||void 0===m?void 0:m.tables)||void 0===n?void 0:n.length)&&!v.isFeatureCollection;w=w.concat(v?((null===m||void 0===m?void 0:m.layers.items)||[]).concat((null===m||void 0===m?void 0:m.tables.items)||[]):[m])});return w||[]}function ea(e){var w,m=[];m=e&&e.portalItem||{};m="group"===(null===e||void 0===e?void 0:e.type)&&(null===(w=null===e||void 0===e?void 0:e.tables)||void 0===w?0:w.length)&&!m.isFeatureCollection?null===e||void 0===e?void 0:
e.tables.items.slice():[];e.tables=null;return m||[]}function da(e,w){var m;return a.__awaiter(this,void 0,void 0,function(){var n,v,t,d,g,q,H,Q;return a.__generator(this,function(N){switch(N.label){case 0:n=w.mapView,v=n.map,t=e.type,N.label=1;case 1:return N.trys.push([1,10,,11]),[4,O(e)];case 2:N.sent();D.checkPopup(e);if(!e.isTable)return[3,3];ha(e,v);return[3,9];case 3:if("imagery-tile"!==t&&"imagery"!==t&&"web-tile"!==t&&!D.isSameSpatialReference(e,null===n||void 0===n?void 0:n.spatialReference))return[3,
4];v.layers.add(e);return[3,9];case 4:return!D.supportsExportMap(e)||D.isTilesOnly(e)?[3,6]:[4,Z(e,v)];case 5:return N.sent(),[3,9];case 6:d=v.basemap;g=null===d||void 0===d?void 0:d.baseLayers;q=null===d||void 0===d?void 0:d.referenceLayers;H=null===(m=v.allLayers)||void 0===m?void 0:m.filter(function(fa){return!(null===g||void 0===g?0:g.includes(fa))&&!q.includes(fa)});if(null===H||void 0===H||!H.length)return[3,7];u.showError({name:"basemap:spatial-reference-incompatible"},e);return[2,Promise.reject({error:{name:"basemap:spatial-reference-incompatible"},
item:e})];case 7:return[4,aa(e,w)];case 8:N.sent(),N.label=9;case 9:return[2,e];case 10:return Q=N.sent(),[2,Promise.reject(Q)];case 11:return[2]}})})}function ha(e,w){var m=w.tables||new k.default;m.add(e);w.tables=m}function Z(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n;return a.__generator(this,function(v){switch(v.label){case 0:if("map-image"!==(null===e||void 0===e?void 0:e.type))return[3,1];n=e;return[3,3];case 1:return[4,V(e)];case 2:n=v.sent(),v.label=3;case 3:return m=n,
w.layers.add(m),[2,m]}})})}function ia(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t,d,g,q,H,Q;return a.__generator(this,function(N){switch(N.label){case 0:return m=w.mapView,n=w.config,v=n.urlParameters,t=m.map,d=e.layers,[4,e.loadAll()];case 1:N.sent();g=ea(e);q=g.filter(function(fa){return ma(fa,v)});t.tables.addMany(q);H=d.filter(function(fa){return!fa.isTable&&ma(fa,v)});if(!(1<H.length))return[3,2];H.forEach(function(fa){return D.checkPopup(fa)});e.layers=H;t.layers.add(e);
return[3,4];case 2:if(!H.length)return[3,4];Q=H.shift();return[4,Q.load()];case 3:N.sent(),D.checkPopup(Q),t.layers.add(Q),N.label=4;case 4:return[2]}})})}function X(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t,d,g,q,H;return a.__generator(this,function(Q){switch(Q.label){case 0:return m=w.mapView,n=w.config,v=n.urlParameters,t=m.map,d=e.layers,[4,e.loadAll()];case 1:return Q.sent(),g=ea(e),q=g.filter(function(N){return ma(N,v)}),t.tables.addMany(q),[4,Promise.all(d.toArray().map(function(N){return N.load()}))];
case 2:return H=Q.sent(),H.filter(function(N){return ma(N,v)}).forEach(function(N){D.checkPopup(N);t.layers.add(na(e,N))}),[2]}})})}function aa(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n;return a.__generator(this,function(v){switch(v.label){case 0:return"not-loaded"!==e.loadStatus?[3,2]:[4,e.load()];case 1:v.sent(),v.label=2;case 2:return m=w.mapView,[4,Y(e,m)];case 3:return n=v.sent(),[2,pa(n,w)]}})})}function pa(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,
t,d,g;return a.__generator(this,function(q){switch(q.label){case 0:m=w.mapView,n=w.map,v=n.webMap,t=v.basemap,q.label=1;case 1:return q.trys.push([1,4,,5]),d=T.findSpatialReference(m,e).spatialReference,!d||S.equals(m.spatialReference,d)||A.isLoaded()||A.canProjectWithoutEngine(m.spatialReference,d)?[3,3]:[4,A.load()];case 2:q.sent(),q.label=3;case 3:return v.basemap=e,d&&!S.equals(m.spatialReference,d)&&(m.spatialReference=d),h.default.publish("basemaplayer-added"),w.mapView=m,[2,e];case 4:return g=
q.sent(),u.showError(g,t),[3,5];case 5:return[2]}})})}function ma(e,w){var m,n,v;if(!e||!w||"group"===(null===e||void 0===e?void 0:e.type))return!0;var t=!w||(null===(m=w.layerIds)||void 0===m?0:m.length)&&1===(null===(n=null===w||void 0===w?void 0:w.layers)||void 0===n?void 0:n.length)?w.layerIds:null;return-1<(w.layers||[]).indexOf(null===(v=e.portalItem)||void 0===v?void 0:v.id)&&(null===t||void 0===t?0:t.length)&&-1===t.indexOf(e.layerId)?!1:!0}function na(e,w){w.title=e.title+" - "+w.title;return w}
function O(e){return a.__awaiter(this,void 0,void 0,function(){var w;return a.__generator(this,function(m){switch(m.label){case 0:return(w=D.isDynamicLayer(e))&&e.loadAll?[4,e.loadAll()]:[3,2];case 1:return m.sent(),[2,e];case 2:return[2,Promise.resolve(e)]}})})}function W(e,w){var m;w=w.map;var n=w.basemap,v=null===n||void 0===n?void 0:n.baseLayers,t=null===n||void 0===n?void 0:n.referenceLayers;return(w=null===(m=w.allLayers)||void 0===m?void 0:m.filter(function(d){return!(null===v||void 0===v?
0:v.includes(d))&&!t.includes(d)}))&&w.length?w.every(function(d){return(null===d||void 0===d?0:d.tileInfo)&&"imagery-tile"!==(null===d||void 0===d?void 0:d.type)&&"imagery"!==(null===d||void 0===d?void 0:d.type)?D.isSameSpatialReference(e,null===d||void 0===d?void 0:d.spatialReference):!0}):!0}function ba(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t,d,g,q,H;return a.__generator(this,function(Q){switch(Q.label){case 0:return m=w.map,n=w.mapView,v=m.webMap,t=v.basemap,d=t.baseLayers,
g=(e||[]).every(function(N){return d.includes(N)}),q=e.some(function(N){return N.isTable}),H=e.some(function(N){return!N.isTable}),n.updating?[4,M.whenOnce(function(){return!n.updating})]:[3,2];case 1:Q.sent(),Q.label=2;case 2:return q&&h.default.publish("table-added"),H&&!g&&h.default.publish("layer-added"),[2]}})})}function Y(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t;return a.__generator(this,function(d){switch(d.label){case 0:var g=e.title;var q=e.type;var H=e.supportedSpatialReferences,
Q=e.spatialReferences,N=w.spatialReference;"wmts"===q&&(null===H||void 0===H?0:H.length)?q=H[0]:"wms"===q&&(null===Q||void 0===Q?0:Q.length)?(q=ca(N,Q),e.spatialReference=q):q=e.spatialReference;m={baseLayers:[e],title:g,spatialReference:q};d.label=1;case 1:return d.trys.push([1,6,,7]),n=new p.default(m),null!==n&&void 0!==n&&n.loadAll?[4,n.loadAll()]:[3,3];case 2:return v=d.sent(),[3,5];case 3:return[4,n.load()];case 4:v=d.sent(),d.label=5;case 5:return v,[2,n];case 6:return t=d.sent(),u.showError(t,
e),[3,7];case 7:return[2]}})})}function ca(e,w){return w.find(function(m){return S.equals(e,new K.default({wkid:m}))})||(null===w||void 0===w?0:w.length)?w[0]:e}function la(e,w,m){return a.__awaiter(this,void 0,void 0,function(){var n,v,t;return a.__generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,6,,7]),w?[3,2]:[4,y(e,m)];case 1:return v=d.sent(),[3,4];case 2:return[4,ka(e)];case 3:v=d.sent(),d.label=4;case 4:return n=v,[4,n.load()];case 5:return d.sent(),[2,n];case 6:return(t=
d.sent())&&u.showError(t,e),[3,7];case 7:return[2]}})})}function ka(e){return a.__awaiter(this,void 0,void 0,function(){var w,m,n,v;return a.__generator(this,function(t){switch(t.label){case 0:return w={portal:{url:"https://www.arcgis.com"},id:e.id},m=new r.default(w),[4,m.load()];case 1:return t.sent(),[4,y(m)];case 2:return n=t.sent(),n.portalItem=null,"group"===n.type&&(v=(n.allLayers||[]).concat(n.allTables||[]),(v||[]).forEach(function(d){return d.portalItem=null})),[2,n]}})})}function V(e){return a.__awaiter(this,
void 0,void 0,function(){var w,m;return a.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),w=new l.default({url:e.url}),[4,w.load()];case 1:return n.sent(),[2,w];case 2:return m=n.sent(),u.showError(m,e),[3,3];case 3:return[2]}})})}function oa(e){var w,m;return a.__awaiter(this,void 0,void 0,function(){var n,v,t,d,g;return a.__generator(this,function(q){switch(q.label){case 0:return q.trys.push([0,6,,7]),n=qa(e),[4,z.fromUrl(n.path)];case 1:v=q.sent();if(null===(w=
n.query)||void 0===w?0:w.where)v.definitionExpression=null===(m=n.query)||void 0===m?void 0:m.where;return null!==v&&void 0!==v&&v.loadAll?[4,v.loadAll()]:[3,3];case 2:return t=q.sent(),[3,5];case 3:return[4,v.load()];case 4:t=q.sent(),q.label=5;case 5:return t,[2,v];case 6:return d=q.sent(),g=(null===d||void 0===d?void 0:d.details)||{},g.url=e,d.details=g,u.showError(d),[2,Promise.reject(d)];case 7:return[2]}})})}function qa(e){var w=I.urlToObject(e),m=null===e||void 0===e?void 0:e.indexOf("/query?");
w&&-1<m&&(w.path=e.substring(0,m));return w||{path:e}}function ja(e,w){switch(e.type){case "OGCFeatureServer":var m=sa(e);break;case "WFS":m=ta(e,w);break;default:console.log("Unknown OGC Layer Type")}return m}function sa(e){var w=this;return new Promise(function(m,n){return a.__awaiter(w,void 0,void 0,function(){var v,t,d;return a.__generator(this,function(g){switch(g.label){case 0:return[4,(new Promise(function(q,H){J(["../../widgets/panels/MapMaker/itembrowsers/OGCLayerModal"],q,H)})).then(a.__importStar)];
case 1:return v=g.sent(),t=(null===e||void 0===e?0:e.loaded)?e:new r.default(e),[4,t.load()];case 2:return g.sent(),d=new v.default({item:t}),d.on("close",function(q){return m(q)}),[2]}})})})}function ta(e,w){var m=this;return new Promise(function(n,v){return a.__awaiter(m,void 0,void 0,function(){var t,d,g;return a.__generator(this,function(q){switch(q.label){case 0:return[4,(new Promise(function(H,Q){J(["../../widgets/panels/MapMaker/itembrowsers/OGCWFSLayerModal"],H,Q)})).then(a.__importStar)];
case 1:return t=q.sent(),d=(null===e||void 0===e?0:e.loaded)?e:new r.default(e),[4,d.load()];case 2:return q.sent(),g=new t.default({item:d,state:w}),g.on("close",function(H){return n(H)}),[2]}})})})}function ra(e){var w=this;return new Promise(function(m){return a.__awaiter(w,void 0,void 0,function(){var n,v;return a.__generator(this,function(t){switch(t.label){case 0:return[4,(new Promise(function(d,g){J(["../../utils/trackViewLayer"],d,g)})).then(a.__importStar)];case 1:return n=t.sent(),[4,n.toTrackViewLayer(e)];
case 2:return v=t.sent(),m(v),[2]}})})})}Object.defineProperty(c,"__esModule",{value:!0});c.getExtent=c.toTrackViewLayer=c.toWFSLayer=c.toOGCAPILayer=c.toOGCLayer=c.layerUrlToObject=c.toLayerFromUrl=c.toMapImageLayer=c.toLayerFromAGOL=c.toLayer=c.toBasemap=c.isLayerCompatible=c.addAsBasemap=c.addLayerAsBasemap=c.addLayerToBasemap=c.addAsMapImageLayer=c.addLayersAsBasemap=c.addTables=c.addLayers=c.filterSublayers=c.getLayerFromId=c.getLayerFromUrl=c.isSecureUrl=c.validURL=c.canAddPortalItemAsBasemap=
void 0;l=a.__importDefault(l);p=a.__importDefault(p);E=a.__importDefault(E);z=a.__importStar(z);D=a.__importStar(D);b=a.__importStar(b);f=a.__importStar(f);h=a.__importDefault(h);k=a.__importDefault(k);r=a.__importDefault(r);I=a.__importStar(I);A=a.__importStar(A);T=a.__importStar(T);S=a.__importStar(S);K=a.__importDefault(K);M=a.__importStar(M);c.canAddPortalItemAsBasemap=function(e){e=e.type;return(null===e||void 0===e?void 0:e.toLowerCase())in{"image service":!0,"imagery-tile":!0,"map service":!0,
"vector tile service":!0,wms:!0,wmts:!0}||!1};c.validURL=L;c.isSecureUrl=x;c.getLayerFromUrl=function(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n;return a.__generator(this,function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),v=e.split("?layers\x3d")[0],!x(e)&&f.isHostedAgolService(v)&&(v=v.replace("http:","https:")),[4,oa(v)];case 1:return m=v.sent(),R(m,e,w),[2,m];case 2:return n=v.sent(),u.showError(n),[2,Promise.reject(n)];case 3:return[2]}})})};c.getLayerFromId=y;
c.filterSublayers=R;c.addLayers=function(e,w,m){return a.__awaiter(this,void 0,void 0,function(){var n,v,t,d,g,q,H;return a.__generator(this,function(Q){switch(Q.label){case 0:return n=null===w||void 0===w?void 0:w.config,v=null===n||void 0===n?void 0:n.urlParameters,t=e.filter(function(N){return ma(N,v)}),d=w.mapView,g=d.map,q=[],H=[g.layers.on("change",function(N){return q=q.concat(N.added||[])}),g.tables.on("change",function(N){return q=q.concat(N.added||[])})],[4,Promise.all(t.map(function(N){return P(N,
w,m)}))];case 1:return Q.sent(),H.forEach(function(N){return N.remove()}),ba(q,w),[2,q]}})})};c.addTables=function(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n;return a.__generator(this,function(v){switch(v.label){case 0:return m=U(e&&e.length?e:[]),n=m.map(function(t){return F(t,w)}),[4,Promise.all(n)];case 1:return[2,v.sent()]}})})};c.addLayersAsBasemap=function(e,w){return a.__awaiter(this,void 0,void 0,function(){var m;return a.__generator(this,function(n){switch(n.label){case 0:return m=
e.map(function(v){return aa(v,w)}),[4,Promise.all(m)];case 1:return[2,n.sent()]}})})};c.addAsMapImageLayer=Z;c.addLayerToBasemap=function(e,w){return a.__awaiter(this,void 0,void 0,function(){var m,n,v,t,d,g,q;return a.__generator(this,function(H){switch(H.label){case 0:m=w.mapView;n=m.map;v=n.basemap;t=v.baseLayers;d=e.type;if("map-image"!==d&&"imagery-tile"!==d&&"imagery"!==d&&!D.isSameSpatialReference(e,m.spatialReference))return[3,1];t.add(e);return[2,Promise.resolve(e)];case 1:return[4,W(e,m)];
case 2:return q=(g=H.sent())?"basemap:spatial-reference-incompatible":"basemap:spatial-reference-incompatible-layers",u.showError({name:q},e),[2,Promise.reject({error:{name:q}})]}})})};c.addLayerAsBasemap=aa;c.addAsBasemap=pa;c.isLayerCompatible=W;c.toBasemap=Y;c.toLayer=la;c.toLayerFromAGOL=ka;c.toMapImageLayer=V;c.toLayerFromUrl=oa;c.layerUrlToObject=qa;c.toOGCLayer=ja;c.toOGCAPILayer=sa;c.toWFSLayer=ta;c.toTrackViewLayer=ra;c.getExtent=function(e,w){var m=w.mapView;return G.getExtent(e,m,(null===
e||void 0===e?0:e.portalItem)?!1:!0).then(function(n){var v=m.extent,t=n&&n.intersection(v),d=n&&n.intersects(v);if(d){t=t.get("width")*t.get("height");var g=v.get("width")*v.get("height");t<g/200?d=!1:n.get("width")*n.get("height")<g/1E3&&(d=!1)}return d?v:n})}})},"esri/layers/MapImageLayer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../TimeExtent ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/Sublayer ./support/sublayerUtils ./support/versionUtils".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r,I,A,T,S,K,M,L,x,y,C,B,R,P,F,U,ea,da,ha,Z,ia,X,aa){u=function(pa){function ma(...O){O=pa.call(this,...O)||this;O.datesInUnknownTimezone=!1;O.dpi=96;O.gdbVersion=null;O.imageFormat="png24";O.imageMaxHeight=2048;O.imageMaxWidth=2048;O.imageTransparency=!0;O.isReference=null;O.labelsVisible=!1;O.operationalLayerType="ArcGISMapServiceLayer";O.sourceJSON=null;O.sublayers=null;O.type="map-image";O.url=null;return O}J._inheritsLoose(ma,pa);var na=ma.prototype;na.normalizeCtorArgs=
function(O,W){return"string"===typeof O?{url:O,...W}:O};na.load=function(O){const W=z.isSome(O)?O.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},O).catch(D.throwIfAbortError).then(()=>this._fetchService(W)));return Promise.resolve(this)};na.readImageFormat=function(O,W){return(O=W.supportedImageFormatTypes)&&O.includes("PNG32")?"png32":"png24"};na.writeSublayers=function(O,W,ba,Y){if(this.loaded&&O){O=O.slice().reverse().flatten(({sublayers:V})=>V&&V.toArray().reverse()).toArray();
ba=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const V=T.nameToId(Y.origin);V===T.OriginId.PORTAL_ITEM?(ba=this.createSublayersForOrigin("service").sublayers,ba=X.shouldWriteSublayerStructure(O,ba,T.OriginId.SERVICE)):V>T.OriginId.PORTAL_ITEM&&(ba=this.createSublayersForOrigin("portal-item"),ba=X.shouldWriteSublayerStructure(O,ba.sublayers,T.nameToId(ba.origin)))}var ca=[],la={writeSublayerStructure:ba,...Y},ka=ba;O.forEach(V=>
{const oa=V.write({},la);ca.push(oa);ka=ka||"user"===V.originOf("visible")});ca.some(V=>1<Object.keys(V).length)&&(W.layers=ca);ka&&(W.visibleLayers=O.filter(V=>V.visible).map(V=>V.id))}};na.createExportImageParameters=function(O,W,ba,Y){var ca=Y&&Y.pixelRatio||1;O&&10<=this.version&&(O=O.clone().shiftCentralMeridian());var la=new Z.ExportImageParameters({layer:this,floors:null==Y?void 0:Y.floors,scale:K.getScale({extent:O,width:W})*ca});const ka=la.toJSON();la.destroy();la=!Y||!Y.rotation||10.3>
this.version?{}:{rotation:-Y.rotation};var V=O&&O.spatialReference;V=V.wkid||JSON.stringify(V.toJSON());ka.dpi*=ca;ca={};if(null!=Y&&Y.timeExtent){const {start:oa,end:qa}=Y.timeExtent.toJSON();ca.time=oa&&qa&&oa===qa?""+oa:`${null==oa?"null":oa},${null==qa?"null":qa}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(ca.time="null,null");return{bbox:O&&O.xmin+","+O.ymin+","+O.xmax+","+O.ymax,bboxSR:V,imageSR:V,size:W+","+ba,...ka,...la,...ca}};na.fetchImage=function(){var O=J._asyncToGenerator(function*(W,
ba,Y,ca){var la;W={responseType:"image",signal:null!=(la=null==ca?void 0:ca.signal)?la:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(W,ba,Y,ca),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}};const ka=this.parsedUrl.path+"/export";if(null!=W.query.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)throw new p("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,
{query:W.query});return a(ka,W).then(V=>V.data).catch(V=>{if(D.isAbortError(V))throw V;throw new p("mapimagelayer:image-fetch-error",`Unable to load image: ${ka}`,{error:V});})});return function(W,ba,Y,ca){return O.apply(this,arguments)}}();na.fetchRecomputedExtents=function(){var O=J._asyncToGenerator(function*(W={}){({data:W}=yield a(this.url,{...W,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}}));const {extent:ba,fullExtent:Y,timeExtent:ca}=W;W=ba||Y;return{fullExtent:W&&
S.fromJSON(W),timeExtent:ca&&l.fromJSON({start:ca[0],end:ca[1]})}});return function(){return O.apply(this,arguments)}}();na.loadAll=function(){return E.loadAll(this,O=>{O(this.allSublayers)})};na.serviceSupportsSpatialReference=function(O){return aa.serviceSupportsSpatialReference(this,O)};na._fetchService=function(){var O=J._asyncToGenerator(function*(W){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:ba,ssl:Y}=yield a(this.parsedUrl.path,{query:{f:"json",
...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:W});Y&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=ba;this.read(ba,{origin:"service",url:this.parsedUrl})}});return function(W){return O.apply(this,arguments)}}();return ma}(C.BlendLayer(da.TemporalLayer(U.ScaleRangeLayer(ea.SublayersOwner(x.ArcGISMapService(y.ArcGISService(R.OperationalLayer(P.PortalLayer(G.MultiOriginJSONMixin(F.RefreshableLayer(L.APIKeyMixin(B.CustomParametersMixin(u.HandleOwnerMixin(M))))))))))))));
c.__decorate([b.property({type:Boolean})],u.prototype,"datesInUnknownTimezone",void 0);c.__decorate([b.property()],u.prototype,"dpi",void 0);c.__decorate([b.property()],u.prototype,"gdbVersion",void 0);c.__decorate([b.property()],u.prototype,"imageFormat",void 0);c.__decorate([r.reader("imageFormat",["supportedImageFormatTypes"])],u.prototype,"readImageFormat",null);c.__decorate([b.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],u.prototype,"imageMaxHeight",void 0);c.__decorate([b.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],
u.prototype,"imageMaxWidth",void 0);c.__decorate([b.property()],u.prototype,"imageTransparency",void 0);c.__decorate([b.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],u.prototype,"isReference",void 0);c.__decorate([b.property({json:{read:!1,write:!1}})],u.prototype,"labelsVisible",void 0);c.__decorate([b.property({type:["ArcGISMapServiceLayer"]})],u.prototype,"operationalLayerType",void 0);c.__decorate([b.property({json:{read:!1,write:!1}})],u.prototype,
"popupEnabled",void 0);c.__decorate([b.property()],u.prototype,"sourceJSON",void 0);c.__decorate([b.property({json:{write:{ignoreOrigin:!0}}})],u.prototype,"sublayers",void 0);c.__decorate([A.writer("sublayers",{layers:{type:[ia]},visibleLayers:{type:[k.Integer]}})],u.prototype,"writeSublayers",null);c.__decorate([b.property({type:["show","hide","hide-children"]})],u.prototype,"listMode",void 0);c.__decorate([b.property({json:{read:!1},readOnly:!0,value:"map-image"})],u.prototype,"type",void 0);c.__decorate([b.property(ha.url)],
u.prototype,"url",void 0);return u=c.__decorate([I.subclass("esri.layers.MapImageLayer")],u)})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(J,c){function a(l,p){p=c.getMetersPerUnitForSR(p);return l/(p*c.inchesPerMeter*96)}J.getExtentForScale=function(l,p){const u=l.extent;l=l.width;p=a(p,u.spatialReference);return u.clone().expand(p*l/u.width)};J.getResolutionForScale=a;J.getScale=function(l,p){p=p||l.extent;l=l.width;const u=c.getMetersPerUnitForSR(p&&
p.spatialReference);return p&&l?p.width/l*u*c.inchesPerMeter*96:0};J.getScaleForResolution=function(l,p){p=c.getMetersPerUnitForSR(p);return l*p*c.inchesPerMeter*96};Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r,I){J.ArcGISMapService=A=>{A=function(T){function S(){var M=T.apply(this,arguments)||this;M.capabilities=void 0;M.copyright=null;M.fullExtent=null;M.legendEnabled=!0;M.spatialReference=null;M.version=void 0;return M}c._inheritsLoose(S,T);var K=S.prototype;K.readCapabilities=function(M,L){var x,y,C=L.capabilities&&L.capabilities.split(",").map(ia=>ia.toLowerCase().trim());if(!C)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,
supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var B=this.type;M=C.includes("data");const R=C.includes("query"),P=C.includes("map"),F=!!L.exportTilesAllowed;C=C.includes("tilemap");const U="tile"!==B&&!!L.supportsDynamicLayers,ea="tile"!==B&&(!L.tileInfo||U),da="tile"!==B&&(!L.tileInfo||U);B="tile"!==B;const ha=L.cimVersion&&E.Version.parse(L.cimVersion),Z=null!=(x=null==ha?void 0:ha.since(1,4))?x:!1;x=null!=(y=null==ha?void 0:ha.since(2,0))?y:!1;return{operations:{supportsExportMap:P,
supportsExportTiles:F,supportsIdentify:R,supportsQuery:M,supportsTileMap:C},exportMap:P?{supportsArcadeExpressionForLabeling:Z,supportsSublayersChanges:B,supportsDynamicLayers:U,supportsSublayerVisibility:ea,supportsSublayerDefinitionExpression:da,supportsCIMSymbols:x}:null,exportTiles:F?{maxExportTilesCount:+L.maxExportTilesCount}:null}};K.readVersion=function(M,L){(M=L.currentVersion)||(M=L.hasOwnProperty("capabilities")||L.hasOwnProperty("tables")?10:L.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return M};K.fetchSublayerInfo=function(){var M=c._asyncToGenerator(function*(L,x){yield this.fetchAllLayersAndTables(x);return this._allLayersAndTablesMap.get(L)});return function(L,x){return M.apply(this,arguments)}}();K.fetchAllLayersAndTables=function(){var M=c._asyncToGenerator(function*(L){yield this.load(L);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=l(u.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(y=>
{this._allLayersAndTablesMap=new Map;for(const C of y.data.layers)this._allLayersAndTablesMap.set(C.id,C);return{result:y.data}},y=>({error:y})));const x=yield this._allLayersAndTablesPromise;p.throwIfAborted(L);if("result"in x)return x.result;throw x.error;});return function(L){return M.apply(this,arguments)}}();return S}(A);a.__decorate([z.property({readOnly:!0})],A.prototype,"capabilities",void 0);a.__decorate([f.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount",
"supportsDynamicLayers","tileInfo"])],A.prototype,"readCapabilities",null);a.__decorate([z.property({json:{read:{source:"copyrightText"}}})],A.prototype,"copyright",void 0);a.__decorate([z.property({type:k})],A.prototype,"fullExtent",void 0);a.__decorate([z.property(I.id)],A.prototype,"id",void 0);a.__decorate([z.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],A.prototype,"legendEnabled",void 0);a.__decorate([z.property(I.popupEnabled)],
A.prototype,"popupEnabled",void 0);a.__decorate([z.property({type:r})],A.prototype,"spatialReference",void 0);a.__decorate([z.property({readOnly:!0})],A.prototype,"version",void 0);a.__decorate([f.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],A.prototype,"readVersion",null);return A=a.__decorate([h.subclass("esri.layers.mixins.ArcGISMapService")],A)};Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/Version":function(){define(["exports",
"./Error"],function(J,c){let a=function(){function l(u,E,z=""){this.major=u;this.minor=E;this._context=z}var p=l.prototype;p.lessThan=function(u,E){return this.major<u||u===this.major&&this.minor<E};p.since=function(u,E){return!this.lessThan(u,E)};p.validate=function(u){if(this.major!==u.major)throw new c((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:u});
};p.clone=function(){return new l(this.major,this.minor,this._context)};l.parse=function(u,E=""){const [z,G]=u.split(".");var D=/^\s*\d+\s*$/;if(!z||!z.match||!z.match(D))throw new c((E&&E+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:u});if(!G||!G.match||!G.match(D))throw new c((E&&E+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:u});u=parseInt(z,10);D=parseInt(G,10);return new l(u,D,E)};return l}();J.Version=
a;Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r,I,A){function T(L,x){const y=[],C={};if(!L)return y;L.forEach(B=>{const R=new I;R.read(B,x);C[R.id]=R;null!=B.parentLayerId&&-1!==B.parentLayerId?(B=C[B.parentLayerId],B.sublayers||(B.sublayers=[]),B.sublayers.unshift(R)):y.unshift(R)});return y}function S(L,x){L&&L.forEach(y=>{x(y);y.sublayers&&y.sublayers.length&&S(y.sublayers,x)})}const K=E.getLogger("esri.layers.TileLayer"),M=l.ofType(I);J.SublayersOwner=L=>{L=function(x){function y(...B){var R=x.call(this,
...B)||this;R.allSublayers=new p({getCollections:()=>[R.sublayers],getChildrenFunction(P){return P.sublayers}});R.sublayersSourceJSON={[r.OriginId.SERVICE]:{},[r.OriginId.PORTAL_ITEM]:{},[r.OriginId.WEB_SCENE]:{},[r.OriginId.WEB_MAP]:{}};R.own(z.watch(()=>R.sublayers,(P,F)=>R._handleSublayersChange(P,F),z.sync));return R}c._inheritsLoose(y,x);var C=y.prototype;C.readSublayers=function(B,R){if(R&&B){var {sublayersSourceJSON:P}=this,F=r.nameToId(R.origin);if(!(F<r.OriginId.SERVICE||(P[F]={context:R,
visibleLayers:B.visibleLayers||P[F].visibleLayers,layers:B.layers||P[F].layers},F>r.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:U,origin:ea}=this.createSublayersForOrigin("web-document");B=f.getProperties(this);B.setDefaultOrigin(ea);this._set("sublayers",new M(U));B.setDefaultOrigin("user")}}};C.findSublayerById=function(B){return this.allSublayers.find(R=>R.id===B)};C.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
C.createSublayersForOrigin=function(B){const R="web-document"===B?r.nameToId("web-map"):r.nameToId(B);let P=r.OriginId.SERVICE;B=this.sublayersSourceJSON[r.OriginId.SERVICE].layers;let F=this.sublayersSourceJSON[r.OriginId.SERVICE].context,U=null;var ea=[r.OriginId.PORTAL_ITEM,r.OriginId.WEB_SCENE,r.OriginId.WEB_MAP].filter(aa=>aa<=R);for(var da of ea)ea=this.sublayersSourceJSON[da],A.isSublayerOverhaul(ea.layers)&&(P=da,B=ea.layers,F=ea.context,ea.visibleLayers&&(U={visibleLayers:ea.visibleLayers,
context:ea.context}));da=[r.OriginId.PORTAL_ITEM,r.OriginId.WEB_SCENE,r.OriginId.WEB_MAP].filter(aa=>aa>P&&aa<=R);let ha=null;for(var Z of da){const {layers:aa,visibleLayers:pa,context:ma}=this.sublayersSourceJSON[Z];aa&&(ha={layers:aa,context:ma});pa&&(U={visibleLayers:pa,context:ma})}Z=T(B,F);const ia=new Map,X=new Set;if(ha)for(const aa of ha.layers)ia.set(aa.id,aa);if(U)for(const aa of U.visibleLayers)X.add(aa);S(Z,aa=>{ha&&aa.read(ia.get(aa.id),ha.context);U&&aa.read({defaultVisibility:X.has(aa.id)},
U.context)});return{origin:r.idToName(P),sublayers:new M({items:Z})}};C.read=function(B,R){x.prototype.read.call(this,B,R);this.readSublayers(B,R)};C._handleSublayersChange=function(B,R){R&&(R.forEach(P=>{P.parent=null;P.layer=null}),this.handles.remove("sublayers-owner"));B&&(B.forEach(P=>{P.parent=this;P.layer=this}),this.handles.add([B.on("after-add",({item:P})=>{P.parent=this;P.layer=this}),B.on("after-remove",({item:P})=>{P.parent=null;P.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(B.on("before-changes",
P=>{K.error(new u("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));P.preventDefault()}),"sublayers-owner"))};return y}(L);a.__decorate([G.property({readOnly:!0})],L.prototype,"allSublayers",void 0);a.__decorate([G.property({readOnly:!0,type:l.ofType(I)})],L.prototype,"serviceSublayers",void 0);a.__decorate([G.property({value:null,type:M,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],L.prototype,"sublayers",void 0);
a.__decorate([G.property({readOnly:!0})],L.prototype,"sublayersSourceJSON",void 0);return L=a.__decorate([k.subclass("esri.layers.mixins.SublayersOwner")],L)};J.forEachSublayer=S;Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./arcgisLayerUrl ./FeatureType ./Field ./FieldsIndex ./LabelClass ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r,I,A,T,S,K,M,L,x,y,C,B,R,P,F,U,ea,da,ha,Z,ia,X,aa,pa,ma,na,O,W,ba,Y,ca,la,ka){function V(n){return n&&"esriSMS"===n.type}function oa(n,v,t){var d;n=this.originIdOf(v)>=X.nameToId(t.origin);return{ignoreOrigin:!0,allowNull:n,enabled:t?"map-image"===(null==(d=t.layer)?void 0:d.type)&&(t.writeSublayerStructure||n):!1}}function qa(n,v,t){var d;return{enabled:t?"tile"===(null==(d=t.layer)?void 0:d.type)&&this._isOverridden(v):!1}}function ja(n,v,t){return{ignoreOrigin:!0,
enabled:t&&t.writeSublayerStructure||!1}}function sa(n,v,t){return{ignoreOrigin:!0,enabled:t?t.writeSublayerStructure||this.originIdOf(v)>=X.nameToId(t.origin):!1}}const ta=n=>Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}));var ra;const e=y.getLogger("esri.layers.support.Sublayer");let w=0;const m=new Set;m.add("layer");m.add("parent");m.add("loaded");m.add("loadStatus");m.add("loadError");m.add("loadWarnings");l=ra=function(n){function v(d){d=
n.call(this,d)||this;d.capabilities=void 0;d.fields=null;d.fullExtent=null;d.globalIdField=null;d.legendEnabled=!0;d.objectIdField=null;d.popupEnabled=!0;d.popupTemplate=null;d.sourceJSON=null;d.title=null;d.typeIdField=null;d.types=null;return d}c._inheritsLoose(v,n);var t=v.prototype;t.load=function(){var d=c._asyncToGenerator(function*(g){var q=this;this.addResolvingPromise(c._asyncToGenerator(function*(){var H;if(!q.layer&&!q.url)throw new S("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",
{sublayer:q});let Q=null;if(!q.layer||q.originIdOf("url")>X.OriginId.SERVICE||"data-layer"===(null==(H=q.source)?void 0:H.type))Q=(yield I(q.url,{responseType:"json",query:{f:"json"},...g})).data;else{var N;H=q.id;"map-layer"===(null==(N=q.source)?void 0:N.type)&&(H=q.source.mapLayerId);Q=yield q.layer.fetchSublayerInfo(H,g)}Q&&(q.sourceJSON=Q,q.read({layerDefinition:Q},{origin:"service"}))})());return this});return function(g){return d.apply(this,arguments)}}();t.readCapabilities=function(d,g){g=
g.layerDefinition||g;d=(d=g.capabilities||d)?d.toLowerCase().split(",").map(H=>H.trim()):[];const q=this.url?aa.parse(this.url):null;d=d.includes(C.isSome(q)&&"MapServer"===q.serverType?"data":"query");return{exportMap:{supportsModification:!!g.canModifyLayer},operations:{supportsQuery:d}}};t.readGlobalIdFieldFromService=function(d,g){g=g.layerDefinition||g;if(g.globalIdField)return g.globalIdField;if(g.fields)for(const q of g.fields)if("esriFieldTypeGlobalID"===q.type)return q.name};t.writeLabelingInfo=
function(d,g,q,H){d&&d.length&&(g.layerDefinition={drawingInfo:{labelingInfo:d.map(Q=>Q.write({},H))}})};t.readMinScale=function(d,g){return g.minScale||g.layerDefinition&&g.layerDefinition.minScale||0};t.readMaxScale=function(d,g){return g.maxScale||g.layerDefinition&&g.layerDefinition.maxScale||0};t.readObjectIdFieldFromService=function(d,g){g=g.layerDefinition||g;if(g.objectIdField)return g.objectIdField;if(g.fields)for(const q of g.fields)if("esriFieldTypeOID"===q.type)return q.name};t.readOpacity=
function(d,g){d=g.layerDefinition;return 1-.01*(null!=d.transparency?d.transparency:d.drawingInfo.transparency)};t.writeOpacity=function(d,g,q,H){g.layerDefinition={drawingInfo:{transparency:100-100*d}}};t.writeParent=function(d,g){g.parentLayerId=this.parent&&this.parent!==this.layer?ia.ensureInteger(this.parent.id):-1};t.castSublayers=function(d){return ia.ensureType(T.ofType(ra),d)};t.writeSublayers=function(d,g,q){this.get("sublayers.length")&&(g[q]=this.sublayers.map(H=>H.id).toArray().reverse())};
t.readTypeIdField=function(d,g){g=g.layerDefinition||g;let q=g.typeIdField;q&&g.fields&&(q=q.toLowerCase(),d=g.fields.find(H=>H.name.toLowerCase()===q))&&(q=d.name);return null};t.writeVisible=function(d,g,q,H){g[q]=this.getAtOrigin("defaultVisibility","service")||d};t.clone=function(){const {store:d}=U.getProperties(this),g=new ra;U.getProperties(g).store=d.clone(m);this.commitProperty("url");g._lastParsedUrl=this._lastParsedUrl;return g};t.createPopupTemplate=function(d){return la.createPopupTemplate(this,
d)};t.createQuery=function(){return new ca({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};t.createFeatureLayer=function(){var d=c._asyncToGenerator(function*(){var g,q;if(this.hasOwnProperty("sublayers"))return null;const H=null==(g=this.layer)?void 0:g.parsedUrl;g=new (yield new Promise((Q,N)=>J(["../FeatureLayer"],fa=>Q(ta(fa)),N))).default({url:H.path});H&&this.source&&("map-layer"===this.source.type?g.layerId=this.source.mapLayerId:g.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&
(g.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(g.definitionExpression=this.definitionExpression);this.floorInfo&&(g.floorInfo=L.clone(this.floorInfo));this.originIdOf("labelingInfo")>X.OriginId.SERVICE&&(g.labelingInfo=L.clone(this.labelingInfo));this.originIdOf("labelsVisible")>X.OriginId.DEFAULTS&&(g.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>X.OriginId.DEFAULTS&&(g.legendEnabled=this.legendEnabled);this.originIdOf("visible")>X.OriginId.DEFAULTS&&
(g.visible=this.visible);this.originIdOf("minScale")>X.OriginId.DEFAULTS&&(g.minScale=this.minScale);this.originIdOf("maxScale")>X.OriginId.DEFAULTS&&(g.maxScale=this.maxScale);this.originIdOf("opacity")>X.OriginId.DEFAULTS&&(g.opacity=this.opacity);this.originIdOf("popupTemplate")>X.OriginId.DEFAULTS&&(g.popupTemplate=L.clone(this.popupTemplate));this.originIdOf("renderer")>X.OriginId.SERVICE&&(g.renderer=L.clone(this.renderer));"data-layer"===(null==(q=this.source)?void 0:q.type)&&(g.dynamicDataSource=
this.source.clone());this.originIdOf("title")>X.OriginId.DEFAULTS&&(g.title=this.title);"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>X.OriginId.DEFAULTS&&(g.customParameters=this.layer.customParameters);"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>X.OriginId.DEFAULTS&&(g.customParameters=this.layer.customParameters);return g});return function(){return d.apply(this,arguments)}}();t.getField=function(d){return this.fieldsIndex.get(d)};t.getFeatureType=
function(d){const {typeIdField:g,types:q}=this;if(!g||!d)return null;const H=d.attributes?d.attributes[g]:void 0;if(null==H)return null;let Q=null;q.some(N=>{const {id:fa}=N;if(null==fa)return!1;fa.toString()===H.toString()&&(Q=N);return!!Q});return Q};t.getFieldDomain=function(d,g){return(g=this.getFeatureType(g&&g.feature))&&(g=g.domains&&g.domains[d])&&"inherited"!==g.type?g:this._getLayerDomain(d)};t.queryFeatures=function(){var d=c._asyncToGenerator(function*(g=this.createQuery(),q){var H,Q,
N,fa,wa,xa;yield this.load();if(null==(H=this.capabilities)||null==(Q=H.operations)||!Q.supportsQuery)throw new S("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:ya},{default:za}]=yield Promise.all([new Promise((ua,va)=>J(["../../rest/query/operations/query"],ua,va)),new Promise((ua,va)=>J(["../../rest/support/FeatureSet"],Aa=>ua(ta(Aa)),va))]);g=yield ya(this.url,ca.from(g),null!=(N=null==(fa=this.layer)?void 0:fa.spatialReference)?N:null,{...q,query:{...null==
(wa=this.layer)?void 0:wa.customParameters,token:null==(xa=this.layer)?void 0:xa.apiKey}});N=za.fromJSON(g.data);if(null!=N&&N.features)for(const ua of N.features)ua.sourceLayer=this;return N});return function(){return d.apply(this,arguments)}}();t.toExportImageJSON=function(d){var g;const q={id:this.id,source:(null==(g=this.source)?void 0:g.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};d=R.sqlAnd(d,this.definitionExpression);C.isSome(d)&&(q.definitionExpression=d);const H=["renderer","labelingInfo",
"opacity","labelsVisible"].reduce((Q,N)=>{Q[N]=this.originIdOf(N);return Q},{});Object.keys(H).some(Q=>H[Q]>X.OriginId.SERVICE)&&(d=q.drawingInfo={},H.renderer>X.OriginId.SERVICE&&(d.renderer=this.renderer?this.renderer.toJSON():null),H.labelsVisible>X.OriginId.SERVICE&&(d.showLabels=this.labelsVisible),this.labelsVisible&&H.labelingInfo>X.OriginId.SERVICE&&(d.labelingInfo=this.labelingInfo?this.labelingInfo.map(Q=>Q.write({},{origin:"service",layer:this.layer})):null,d.showLabels=!0),H.opacity>X.OriginId.SERVICE&&
(d.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(d.renderer));return q};t._assignDefaultSymbolColors=function(d){this._forEachSimpleMarkerSymbols(d,g=>{g.color||"esriSMSX"!==g.style&&"esriSMSCross"!==g.style||(g.color=g.outline&&g.outline.color?g.outline.color:[0,0,0,0])})};t._forEachSimpleMarkerSymbols=function(d,g){if(d){const q="uniqueValueInfos"in d?d.uniqueValueInfos:"classBreakInfos"in d?d.classBreakInfos:[];for(const H of q)V(H.symbol)&&g(H.symbol);"symbol"in d&&V(d.symbol)&&
g(d.symbol);"defaultSymbol"in d&&V(d.defaultSymbol)&&g(d.defaultSymbol)}};t._setAndNotifyLayer=function(d,g){const q=this.layer,H=this._get(d);let Q,N;switch(d){case "definitionExpression":case "floorInfo":Q="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":Q="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":Q="supportsDynamicLayers",N="supportsModification"}const fa=U.getProperties(this).getDefaultOrigin();
if("service"!==fa){if(Q&&!1===this.get(`layer.capabilities.exportMap.${Q}`)){this._logLockedError(d,`capability not available 'layer.capabilities.exportMap.${Q}'`);return}if(N&&!1===this.get(`capabilities.exportMap.${N}`)){this._logLockedError(d,`capability not available 'capabilities.exportMap.${N}'`);return}}"source"===d&&"not-loaded"!==this.loadStatus?this._logLockedError(d,"'source' can't be changed after calling sublayer.load()"):(this._set(d,g),"service"!==fa&&H!==g&&q&&q.emit&&q.emit("sublayer-update",
{propertyName:d,target:this}))};t._handleSublayersChange=function(d,g){g&&(g.forEach(q=>{q.parent=null;q.layer=null}),this.handles.removeAll());d&&(d.forEach(q=>{q.parent=this;q.layer=this.layer}),this.handles.add([d.on("after-add",({item:q})=>{q.parent=this;q.layer=this.layer}),d.on("after-remove",({item:q})=>{q.parent=null;q.layer=null}),d.on("before-changes",q=>{const H=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==H||H||(e.error(new S("sublayer:sublayers-non-modifiable",
"Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),q.preventDefault())})]))};t._logLockedError=function(d,g){e.error(new S("sublayer:locked",`Property '${String(d)}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:g,sublayer:this,layer:this.layer}))};t._getLayerDomain=function(d){return(d=this.fieldsIndex.get(d))?d.domain:null};c._createClass(v,[{key:"definitionExpression",set:function(d){this._setAndNotifyLayer("definitionExpression",
d)}},{key:"fieldsIndex",get:function(){return new na(this.fields||[])}},{key:"floorInfo",set:function(d){this._setAndNotifyLayer("floorInfo",d)}},{key:"id",get:function(){const d=this._get("id");return null==d?w++:d},set:function(d){this._get("id")!==d&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",d))}},{key:"labelingInfo",set:function(d){this._setAndNotifyLayer("labelingInfo",
d)}},{key:"labelsVisible",set:function(d){this._setAndNotifyLayer("labelsVisible",d)}},{key:"layer",set:function(d){this._set("layer",d);this.sublayers&&this.sublayers.forEach(g=>g.layer=d)}},{key:"listMode",set:function(d){this._set("listMode",d)}},{key:"minScale",set:function(d){this._setAndNotifyLayer("minScale",d)}},{key:"maxScale",set:function(d){this._setAndNotifyLayer("maxScale",d)}},{key:"effectiveScaleRange",get:function(){const {minScale:d,maxScale:g}=this;return{minScale:d,maxScale:g}}},
{key:"opacity",set:function(d){this._setAndNotifyLayer("opacity",d)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(d){if(d)for(const g of d.getSymbols())if(A.isSymbol3D(g)){e.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",d)}},{key:"source",get:function(){return this._get("source")||new Y.MapLayerSource({mapLayerId:this.id})},set:function(d){this._setAndNotifyLayer("source",d)}},{key:"sublayers",
set:function(d){this._handleSublayersChange(d,this._get("sublayers"));this._set("sublayers",d)}},{key:"url",get:function(){var d,g;const q=null!=(d=null==(g=this.layer)?void 0:g.parsedUrl)?d:this._lastParsedUrl;d=this.source;if(!q)return null;this._lastParsedUrl=q;if("map-layer"===(null==d?void 0:d.type))return`${q.path}/${d.mapLayerId}`;d={layer:JSON.stringify({source:this.source})};return`${q.path}/dynamicLayer?${P.objectToQuery(d)}`},set:function(d){d?this._override("url",d):this._clearOverride("url")}},
{key:"visible",set:function(d){this._setAndNotifyLayer("visible",d)}}]);return v}(K.HandleOwnerMixin(B.MultiOriginJSONMixin(M.IdentifiableMixin(x))));l.test={isMapImageLayerOverridePolicy:n=>n===ja||n===oa,isTileImageLayerOverridePolicy:n=>n===qa};a.__decorate([F.property({readOnly:!0})],l.prototype,"capabilities",void 0);a.__decorate([da.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],l.prototype,"readCapabilities",null);a.__decorate([F.property({type:String,
value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:oa}}})],l.prototype,"definitionExpression",null);a.__decorate([F.property({type:[ma],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],l.prototype,"fields",void 0);a.__decorate([F.property({readOnly:!0})],l.prototype,"fieldsIndex",null);a.__decorate([F.property({type:W,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",
overridePolicy:oa},origins:{"web-scene":{read:!1,write:!1}}}})],l.prototype,"floorInfo",null);a.__decorate([F.property({type:ka,json:{read:{source:"layerDefinition.extent"}}})],l.prototype,"fullExtent",void 0);a.__decorate([F.property({type:String})],l.prototype,"globalIdField",void 0);a.__decorate([da.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],l.prototype,"readGlobalIdFieldFromService",null);a.__decorate([F.property({type:ia.Integer,json:{write:{ignoreOrigin:!0}}})],
l.prototype,"id",null);a.__decorate([F.property({value:null,type:[O],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ja}}})],l.prototype,"labelingInfo",null);a.__decorate([Z.writer("labelingInfo")],l.prototype,"writeLabelingInfo",null);a.__decorate([F.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ja}}})],
l.prototype,"labelsVisible",null);a.__decorate([F.property({value:null})],l.prototype,"layer",null);a.__decorate([F.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:sa}}})],l.prototype,"legendEnabled",void 0);a.__decorate([F.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],l.prototype,"listMode",null);a.__decorate([F.property({type:Number,
value:0,json:{write:{overridePolicy:ja}}})],l.prototype,"minScale",null);a.__decorate([da.reader("minScale",["minScale","layerDefinition.minScale"])],l.prototype,"readMinScale",null);a.__decorate([F.property({type:Number,value:0,json:{write:{overridePolicy:ja}}})],l.prototype,"maxScale",null);a.__decorate([da.reader("maxScale",["maxScale","layerDefinition.maxScale"])],l.prototype,"readMaxScale",null);a.__decorate([F.property({readOnly:!0})],l.prototype,"effectiveScaleRange",null);a.__decorate([F.property({type:String})],
l.prototype,"objectIdField",void 0);a.__decorate([da.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],l.prototype,"readObjectIdFieldFromService",null);a.__decorate([F.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ja}}})],l.prototype,"opacity",null);a.__decorate([da.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],l.prototype,"readOpacity",null);a.__decorate([Z.writer("opacity")],
l.prototype,"writeOpacity",null);a.__decorate([F.property({json:{type:ia.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:ja}}})],l.prototype,"parent",void 0);a.__decorate([Z.writer("parent")],l.prototype,"writeParent",null);a.__decorate([F.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(n,v){return!v.disablePopup}},write:{target:"disablePopup",overridePolicy:sa,writer(n,v,t){v[t]=!n}}}})],l.prototype,"popupEnabled",void 0);a.__decorate([F.property({type:p,
json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:sa}}})],l.prototype,"popupTemplate",void 0);a.__decorate([F.property({readOnly:!0})],l.prototype,"defaultPopupTemplate",null);a.__decorate([F.property({types:r.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ja},origins:{"web-scene":{types:r.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ja}}}}})],l.prototype,"renderer",null);a.__decorate([F.property({types:{key:"type",
base:null,typeMap:{"data-layer":ba.DataLayerSource,"map-layer":Y.MapLayerSource}},cast(n){if(n){if("mapLayerId"in n)return ia.ensureClass(Y.MapLayerSource,n);if("dataSource"in n)return ia.ensureClass(ba.DataLayerSource,n)}return n},json:{name:"layerDefinition.source",write:{overridePolicy:ja}}})],l.prototype,"source",null);a.__decorate([F.property()],l.prototype,"sourceJSON",void 0);a.__decorate([F.property({value:null,json:{type:[ia.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ja}}})],
l.prototype,"sublayers",null);a.__decorate([ea.cast("sublayers")],l.prototype,"castSublayers",null);a.__decorate([Z.writer("sublayers")],l.prototype,"writeSublayers",null);a.__decorate([F.property({type:String,json:{name:"name",write:{overridePolicy:sa}}})],l.prototype,"title",void 0);a.__decorate([F.property({type:String})],l.prototype,"typeIdField",void 0);a.__decorate([da.reader("typeIdField",["layerDefinition.typeIdField"])],l.prototype,"readTypeIdField",null);a.__decorate([F.property({type:[pa],
json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],l.prototype,"types",void 0);a.__decorate([F.property({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:qa}}})],l.prototype,"url",null);a.__decorate([F.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ja}}})],l.prototype,"visible",null);a.__decorate([Z.writer("visible")],l.prototype,"writeVisible",null);return l=ra=a.__decorate([ha.subclass("esri.layers.support.Sublayer")],
l)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(J,c,a){function l(p,u){if(!p||!p.length||c.isNone(u))return!0;u=u.slice().reverse().flatten(({sublayers:G})=>G&&G.toArray().reverse()).map(G=>G.id).toArray();if(p.length>u.length)return!1;let E=0;const z=u.length;for(const {id:G}of p){for(;E<z&&u[E]!==G;)E++;if(E>=z)return!1}return!0}J.isExportDynamic=function(p,u,E){return p.some(z=>{const G=z.source;return!(!G||
"map-layer"===G.type&&G.mapLayerId===z.id&&(c.isNone(G.gdbVersion)||G.gdbVersion===E))||z.originIdOf("renderer")>a.OriginId.SERVICE||z.originIdOf("labelingInfo")>a.OriginId.SERVICE||z.originIdOf("opacity")>a.OriginId.SERVICE||z.originIdOf("labelsVisible")>a.OriginId.SERVICE})?!0:!l(p,u)};J.isSublayerOverhaul=function(p){return!!p&&p.some(u=>null!=u.minScale||u.layerDefinition&&null!=u.layerDefinition.minScale)};J.shouldWriteSublayerStructure=function(p,u,E){return u.flatten(({sublayers:z})=>z).length!==
p.length||p.some(z=>z.originIdOf("minScale")>E||z.originIdOf("maxScale")>E||z.originIdOf("renderer")>E||z.originIdOf("labelingInfo")>E||z.originIdOf("opacity")>E||z.originIdOf("labelsVisible")>E||z.originIdOf("source")>E)?!0:!l(p,u)};Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/sql ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./commonProperties ./floorFilterUtils ./sublayerUtils".split(" "),
function(J,c,a,l,p,u,E,z,G,D,b,f,h,k,r){const I={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};J.ExportImageParameters=function(A){function T(K){K=A.call(this,K)||this;K.floors=null;K.scale=0;return K}c._inheritsLoose(T,A);var S=T.prototype;S.destroy=function(){this.layer=null};S.toJSON=
function(){var K=this.layer;K={dpi:K.dpi,format:K.imageFormat,transparent:K.imageTransparency,gdbVersion:K.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?K.dynamicLayers=this.dynamicLayers:K={...K,layers:this.layers,layerDefs:this.layerDefs};return K};c._createClass(T,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const K=this.visibleSublayers.map(M=>{const L=k.getLayerFloorFilterClause(this.floors,M);return M.toExportImageJSON(L)});return K.length?JSON.stringify(K):
null}},{key:"hasDynamicLayers",get:function(){return this.layer&&r.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(K){this._get("layer")!==K&&(this._set("layer",K),this.handles.remove("layer"),K&&this.handles.add([K.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),K.on("sublayer-update",M=>this.notifyChange(I[M.propertyName]))],"layer"))}},{key:"layers",get:function(){const K=this.visibleSublayers;return K?K.length?
"show:"+K.map(M=>M.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var K;const M=!(null==(K=this.floors)||!K.length);K=this.visibleSublayers.filter(L=>null!=L.definitionExpression||M&&null!=L.floorInfo);return K.length?JSON.stringify(K.reduce((L,x)=>{var y=k.getLayerFloorFilterClause(this.floors,x);y=E.sqlAnd(y,x.definitionExpression);u.isSome(y)&&(L[x.id]=y);return L},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");
this.commitProperty("timeExtent");const K=this.layer;K&&(K.commitProperty("dpi"),K.commitProperty("imageFormat"),K.commitProperty("imageTransparency"),K.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const K=[];if(!this.layer)return K;var M=this.layer.sublayers;const L=x=>{const y=this.scale,C=0===x.minScale||y<=x.minScale,B=0===x.maxScale||y>=x.maxScale;x.visible&&(0===y||C&&B)&&(x.sublayers?x.sublayers.forEach(L):K.unshift(x))};M&&M.forEach(L);
M=this._get("visibleSublayers");return!M||M.length!==K.length||M.some((x,y)=>K[y]!==x)?K:M}}]);return T}(p.HandleOwnerMixin(l));a.__decorate([z.property({readOnly:!0})],J.ExportImageParameters.prototype,"dynamicLayers",null);a.__decorate([z.property()],J.ExportImageParameters.prototype,"floors",void 0);a.__decorate([z.property({readOnly:!0})],J.ExportImageParameters.prototype,"hasDynamicLayers",null);a.__decorate([z.property()],J.ExportImageParameters.prototype,"layer",null);a.__decorate([z.property({readOnly:!0})],
J.ExportImageParameters.prototype,"layers",null);a.__decorate([z.property({readOnly:!0})],J.ExportImageParameters.prototype,"layerDefs",null);a.__decorate([z.property({type:Number})],J.ExportImageParameters.prototype,"scale",void 0);a.__decorate([z.property(h.combinedViewLayerTimeExtentProperty)],J.ExportImageParameters.prototype,"timeExtent",void 0);a.__decorate([z.property({readOnly:!0})],J.ExportImageParameters.prototype,"version",null);a.__decorate([z.property({readOnly:!0})],J.ExportImageParameters.prototype,
"visibleSublayers",null);J.ExportImageParameters=a.__decorate([f.subclass("esri.layers.mixins.ExportImageParameters")],J.ExportImageParameters);Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(J){function c(a,l){if(null==a||!a.length)return null;a=a.filter(p=>""!==p).map(p=>`'${p}'`);a.push("''");return`${l} IN (${a.join(",")}) OR ${l} IS NULL`}J.getFloorFilterClause=function(a){var l;
const p=a.layer;return"floorInfo"in p&&null!=(l=p.floorInfo)&&l.floorField&&"floors"in a.view?c(a.view.floors,p.floorInfo.floorField):null};J.getLayerFloorFilterClause=function(a,l){var p;return"floorInfo"in l&&null!=(p=l.floorInfo)&&p.floorField?c(a,l.floorInfo.floorField):null};Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"app/utils/LayerUtil":function(){define("require exports tslib esri/layers/Layer esri/request esri/layers/support/arcgisLayerUrl".split(" "),
function(J,c,a,l,p,u){function E(x){return a.__awaiter(this,void 0,void 0,function(){var y;return a.__generator(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,4]),[4,l.default.fromArcGISServerUrl(x)];case 1:return y=C.sent(),[3,4];case 2:return C.sent(),[4,G(null===x||void 0===x?void 0:x.url)];case 3:return y=C.sent(),[3,4];case 4:return[2,y]}})})}function z(x,y,C){return a.__awaiter(this,void 0,void 0,function(){var B;return a.__generator(this,function(R){try{return B=D(x,y).then(b).then(function(P){var F=
a.__assign(a.__assign(a.__assign({},P.properties),{url:P.url||y}),C);return Promise.resolve(new P.constructor(F))}),[2,B]}catch(P){return[2,Promise.reject(P)]}})})}function G(x,y,C){return a.__awaiter(this,void 0,void 0,function(){var B,R,P;return a.__generator(this,function(F){switch(F.label){case 0:return(R="csv"===y)?[3,2]:[4,T(x)];case 1:R=F.sent(),F.label=2;case 2:if(!R)return[3,3];B="csv";return[3,10];case 3:(F="wfs"===y)||(F=x.toLowerCase().endsWith("/wfsserver")||-1<x.toLowerCase().lastIndexOf("/wfs"));
if(!F)return[3,4];B="wfs";return[3,10];case 4:(F="wms"===y)||(F=x.toLowerCase().endsWith("/wmsserver")||-1<x.toLowerCase().lastIndexOf("/wms")||x.toLowerCase().endsWith("/ows"));if(!F)return[3,5];B="wms";return[3,10];case 5:if(!("wmts"===y||-1<x.toLowerCase().lastIndexOf("/wmts")))return[3,6];B="wmts";return[3,10];case 6:(F="geojson"===y)||(F=S(x,"geojson")||S(x,"json"));if(!F)return[3,7];B="geojson";return[3,10];case 7:return(P="kml"===y)?[3,9]:[4,A(x)];case 8:P=F.sent(),F.label=9;case 9:if(P)B=
"kml";else{var U;(U="georss"===y)||(U=S(x,"rss")||S(x,"xml")||-1<x.toLowerCase().lastIndexOf("/rss"));U&&(B="georss")}F.label=10;case 10:return[2,z(B,x,C)]}})})}function D(x,y){switch(x){case "csv":return Promise.resolve({className:"CSVLayer"});case "wms":return f(y);case "wfs":return k(y);case "wmts":return h(y);case "geojson":return Promise.resolve({className:"GeoJSONLayer"});case "kml":return Promise.resolve({className:"KMLLayer"});case "georss":return Promise.resolve({className:"GeoRSSLayer"});
default:return Promise.reject({error:{name:"url:unknown-item-type"}})}}function b(x){return Promise.all([(new Promise(function(y,C){J(["esri/layers/"+x.className],y,C)})).then(a.__importStar)]).then(function(y){var C;return{constructor:null===(C=y[0])||void 0===C?void 0:C.default,properties:x.properties||{},url:x.url}})}function f(x){return a.__awaiter(this,void 0,void 0,function(){var y;return a.__generator(this,function(C){y={className:"WMSLayer"};return[2,y]})})}function h(x){return a.__awaiter(this,
void 0,void 0,function(){var y;return a.__generator(this,function(C){y={className:"WMTSLayer"};return[2,y]})})}function k(x){return a.__awaiter(this,void 0,void 0,function(){var y,C;return a.__generator(this,function(B){switch(B.label){case 0:return y={className:"WFSLayer"},[4,r(x)];case 1:return(C=B.sent())?[2,C]:[2,y]}})})}function r(x){return a.__awaiter(this,void 0,void 0,function(){var y,C,B,R,P,F;return a.__generator(this,function(U){switch(U.label){case 0:y=/\/arcgis\/services\//gi;C=x.replace(y,
"/arcgis/rest/services/");B=u.isArcGISUrl(C);if(!B)return[3,5];R=u.parse(C);P=R.serverType;F=R.url;U.label=1;case 1:return U.trys.push([1,3,,4]),[4,L(F.path)];case 2:return U.sent(),[2,Promise.resolve({className:I(P.toLowerCase()),url:F.path})];case 3:return U.sent(),[2,Promise.resolve(null)];case 4:return[3,6];case 5:return[2,Promise.resolve(null)];case 6:return[2]}})})}function I(x){switch(x){case "imageserver":return"ImageryLayer";case "mapserver":return"MapImageLayer"}}function A(x){return a.__awaiter(this,
void 0,void 0,function(){var y;return a.__generator(this,function(C){switch(C.label){case 0:return S(x,"kml")||S(x,"kmz")?[2,!0]:[3,1];case 1:if(!x.endsWith("/data")||!K(x))return[3,6];C.label=2;case 2:return C.trys.push([2,4,,5]),[4,M(x)];case 3:return y=C.sent(),[2,"KML"===y.type];case 4:return C.sent(),[2,!1];case 5:return[3,7];case 6:return[2,!1];case 7:return[2]}})})}function T(x){return a.__awaiter(this,void 0,void 0,function(){var y;return a.__generator(this,function(C){switch(C.label){case 0:return-1<
(null===x||void 0===x?void 0:x.indexOf("?format\x3dcsv"))?[2,!0]:[3,1];case 1:return S(x,"csv")?[2,!0]:[3,2];case 2:if(!x.endsWith("/data")||!K(x))return[3,7];C.label=3;case 3:return C.trys.push([3,5,,6]),[4,M(x)];case 4:return y=C.sent(),[2,"CSV"===(null===y||void 0===y?void 0:y.type)];case 5:return C.sent(),[2,!1];case 6:return[3,8];case 7:return[2,!1];case 8:return[2]}})})}function S(x,y){return x.split(".").pop().split(/#|\?/)[0].toLowerCase()===y}function K(x){return/^(.*?)\b\/sharing\/rest\/content\/items\/[a-f\d]{32}\b/gi.test(x)}
function M(x){return a.__awaiter(this,void 0,void 0,function(){var y,C,B,R;return a.__generator(this,function(P){switch(P.label){case 0:return P.trys.push([0,2,,3]),y=/^(.*?)\b\/sharing\/rest\/content\/items\/[a-f\d]{32}\b/gi,C=x.match(y)[0],[4,L(C)];case 1:return B=P.sent(),[2,B];case 2:return R=P.sent(),[2,Promise.reject(R)];case 3:return[2]}})})}function L(x){return a.__awaiter(this,void 0,void 0,function(){var y;return a.__generator(this,function(C){switch(C.label){case 0:return[4,p.default(x,
{responseType:"json",query:{f:"json"}})];case 1:return y=C.sent(),[2,y.data]}})})}Object.defineProperty(c,"__esModule",{value:!0});c.isSupported=c.parseServiceUrl=c.fromType=c.fromUrl=void 0;l=a.__importDefault(l);p=a.__importDefault(p);u=a.__importStar(u);c.fromUrl=function(x,y,C){return a.__awaiter(this,void 0,void 0,function(){var B,R,P,F,U,ea,da,ha;return a.__generator(this,function(Z){switch(Z.label){case 0:R=u.isArcGISUrl(x),Z.label=1;case 1:return Z.trys.push([1,7,,8]),!y||R&&"wmts"!==y&&"wms"!==
y?[4,E({url:x,properties:a.__assign({},C)})]:[3,3];case 2:return P=Z.sent(),[3,5];case 3:return[4,G(x,y,C)];case 4:P=Z.sent(),Z.label=5;case 5:return B=P,[4,B.load()];case 6:return Z.sent(),F=this.isSupported(B),F.isSupported?[2,B]:[2,Promise.reject(F.error)];case 7:return U=Z.sent(),ea=x,da=R?u.parse(ea):{},da.type=(null===B||void 0===B?void 0:B.title)||y||"",da.url=ea,ha=a.__assign(a.__assign({},U.details||{}),da),[2,Promise.reject(a.__assign(a.__assign({},U),{details:ha}))];case 8:return[2]}})})};
c.fromType=z;c.parseServiceUrl=function(x){var y=x.match(/^(.*?)\b\/arcgis\/rest\/services\//gi);return y&&y.length?y[0]:x};c.isSupported=function(x){var y=x.url,C=x.type,B=y&&u.isArcGISUrl(y)?u.parse(y):{};B.type=x.title;B.url=y;return{isSupported:C in{"imagery-tile":1,imagery:1,tile:1,feature:1,"vector-tile":1,group:1,csv:1,kml:1,"geo-rss":1,geojson:1,"map-image":1,wms:1,wmts:1}?!0:!1,error:{name:"feature-layer-source:unsupported-type",details:a.__assign({},B)}}}})},"app/utils/project":function(){define("require exports tslib esri/config esri/geometry/Extent esri/geometry/support/webMercatorUtils esri/rest/geometryService esri/rest/support/ProjectParameters".split(" "),
function(J,c,a,l,p,u,E,z){var G=this;Object.defineProperty(c,"__esModule",{value:!0});c.getExtent=c.project=void 0;l=a.__importDefault(l);p=a.__importDefault(p);u=a.__importStar(u);E=a.__importStar(E);z=a.__importDefault(z);c.project=function(f,h){h=h.spatialReference;var k=l.default.geometryServiceUrl;if(u.canProject(f,h))return f=u.project(f,h),Promise.resolve(f);var r=new z.default;r.geometries=[f];r.outSpatialReference=h;return E.project(k,r).then(function(I){return I[0]})};c.getExtent=function(f,
h,k){return a.__awaiter(G,void 0,void 0,function(){var r,I,A,T,S,K,M,L,x,y;return a.__generator(this,function(C){switch(C.label){case 0:return"route"!==(null===f||void 0===f?void 0:f.type)?[3,1]:[2,null===(x=f.routeInfo.geometry)||void 0===x?void 0:x.extent];case 1:return r=f.portalItem,I=!r||!(null===r||void 0===r?0:r.extent)||D(r),[4,c.project(new p.default({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:{wkid:4326}}),h)];case 2:return A=C.sent(),I&&r&&r.extent?[4,c.project(r.extent,h)]:[3,
4];case 3:return S=C.sent(),[3,5];case 4:S=null,C.label=5;case 5:return T=S,(K=(null===f||void 0===f?void 0:f.layers)&&((null===r||void 0===r?void 0:r.typeKeywords)||[]).find(function(B){return"Location Tracking Service"===B})||!1)&&(f=(null===(y=null===f||void 0===f?void 0:f.layers)||void 0===y?void 0:y.getItemAt(0))||f),I?[3,6]:[2,Promise.resolve(A)];case 6:return k||!T?[3,7]:[2,Promise.resolve(T)];case 7:if(!f.createQuery||!f.queryExtent)return[3,8];M=f.createQuery();M.outSpatialReference=h.spatialReference;
return[2,f.queryExtent(M).then(function(B){return B&&B.extent||f.fullExtent||A},function(){return f.fullExtent||A})];case 8:return f.fullExtent?[4,c.project(f.fullExtent,h)]:[3,10];case 9:return L=C.sent(),[3,11];case 10:L=A,C.label=11;case 11:return[2,L]}})})};var D=function(f){if(f&&f.extent){var h=u.geographicToWebMercator(f.extent).extent;f=h.xmax;var k=h.ymax;h=u.xyToLngLat(h.xmin,h.ymin);f=u.xyToLngLat(f,k);return b(h[0],-180,180)||b(f[0],-180,180)||b(h[1],-90,90)||b(f[1],-90,90)?!0:!1}return!1},
b=function(f,h,k){return f>=h&&f<=k}})},"app/utils/layerUtils":function(){define(["require","exports","tslib","esri/request","esri/layers/support/arcgisLayerUrl"],function(J,c,a,l,p){function u(b,f){return(b.supportedSpatialReferences||[]).find(function(h){return h.equals(f)})?!0:!1}function E(b){var f=b.layers,h=b.popupTemplate;b.popupEnabled&&!h&&b.createPopupTemplate&&(b.popupTemplate=b.createPopupTemplate());(null===f||void 0===f?0:f.length)&&f.forEach(function(k){return E(k)})}function z(b){var f,
h,k={geojson:1,csv:1},r=(null===b||void 0===b?void 0:b.layer)||b;r=r&&r.url&&"Feature Layer"===(null===(f=null===r||void 0===r?void 0:r.sourceJSON)||void 0===f?void 0:f.type);f=null===b||void 0===b?void 0:b.isTable;var I=(null===(h=null===b||void 0===b?void 0:b.layer)||void 0===h?void 0:h.type)||(null===b||void 0===b?void 0:b.type);return b.url&&I in k||r||f}function G(b){return(b=(b&&b.layer||b).type)&&("map-layer"===b||"map-image"===b||"tile"===b)}function D(b){return b&&b.get&&b.get("capabilities.exportMap.supportsDynamicLayers")||
!1}Object.defineProperty(c,"__esModule",{value:!0});c.isSupportedChartsLayer=c.fetchUpdates=c.isImageryLayerRF=c.isImageryLayer=c.isMapImageLayer=c.supportsData=c.supportsExportTiles=c.supportsEditing=c.supportsModification=c.supportsExportMap=c.supportsQuery=c.isTilesOnly=c.hasLiveData=c.canCluster=c.isTrackViewLayer=c.isBasemapLayer=c.isLikeFeatureLayer=c.isDynamicLayer=c.getCacheMaxAge=c.checkPopup=c.checkWMTSSpatialReferences=c.isSameSpatialReference=void 0;l=a.__importDefault(l);p=a.__importStar(p);
c.isSameSpatialReference=function(b,f){var h=(b||{}).tileInfo,k={};return"wmts"===b.type&&u(b,f)?!0:!(b.type in k)&&f&&(null===h||void 0===h?0:h.spatialReference)?f.equals(h.spatialReference):"map-image"!==b.type&&"imagery"!==b.type&&"wmts"!==b.type||!b.spatialReference?!0:f.equals(b.spatialReference)};c.checkWMTSSpatialReferences=u;c.checkPopup=E;c.getCacheMaxAge=function(b){var f=b.sourceJSON,h=b.portalItem;b=null===h||void 0===h?void 0:h.isHostedService;h=(null===h||void 0===h?void 0:h.advancedSettings)||
{};f=(f=(null===f||void 0===f?void 0:f.cacheMaxAge)||(null===h||void 0===h?void 0:h.cacheMaxAge))?parseInt(f):b?30:6;return Math.ceil(f/60*100)/100};c.isDynamicLayer=function(b){var f=b&&b.layer;return G(b)?f?D(f):D(b):!1};c.isLikeFeatureLayer=z;c.isBasemapLayer=function(b,f){f=f.basemap;return f.baseLayers.concat(f.referenceLayers).flatten(function(h){return(null===h||void 0===h?void 0:h.allSublayers)||(null===h||void 0===h?void 0:h.sublayers)||(null===h||void 0===h?void 0:h.layers)}).includes(b)};
c.isTrackViewLayer=function(b){return(b=b.portalItem)&&((null===b||void 0===b?void 0:b.typeKeywords)||[]).find(function(f){return"Location Tracking Service"===f})||!1};c.canCluster=function(b){var f=b.geometryType,h=b.type,k=b.renderer;k=k&&k.type;return!("feature"===h&&!b.url)&&"point"===f&&"stream"!==h&&"heatmap"!==k&&"pie-chart"!==k};c.hasLiveData=function(b){var f;return(null===(f=null===b||void 0===b?void 0:b.timeInfo)||void 0===f?0:f.hasLiveData)?!0:!1};c.isTilesOnly=function(b){var f;b=b.sourceJSON;
return-1<(null===(f=null===b||void 0===b?void 0:b.capabilities)||void 0===f?void 0:f.toLowerCase().split(",").map(function(h){return h.trim()}).indexOf("tilesonly"))||!1};c.supportsQuery=function(b){return(b=b&&b.layer||b)&&(b&&b.get&&b.get("capabilities.operations.supportsQuery")||!1)};c.supportsExportMap=function(b){return b&&(b&&b.get&&b.get("capabilities.operations.supportsExportMap")||!1)};c.supportsModification=function(b){return b&&(b&&b.get?b.get("capabilities.exportMap.supportsModification"):
!0)};c.supportsEditing=function(b){return b&&(b&&b.get&&b.get("capabilities.operations.supportsEditing")||!1)};c.supportsExportTiles=function(b){return b&&b.get&&b.get("capabilities.exportTiles")||!1};c.supportsData=function(b){return b&&b.get&&b.get("capabilities.operations.supportsIdentify")||!1};c.isMapImageLayer=G;c.isImageryLayer=function(b){var f={imagery:1,"imagery-tile":1};return(b=(b&&b.layer||b).type)&&b in f};c.isImageryLayerRF=function(b){var f={imagery:1};return(b=(b&&b.layer||b).type)&&
b in f};c.fetchUpdates=function(b){return l.default(b.url,{responseType:"json",query:{returnUpdates:!0,f:"json"}}).then(function(f){return f.data})};c.isSupportedChartsLayer=function(b){var f,h,k,r,I,A,T,S=(null===(f=null===b||void 0===b?void 0:b.layer)||void 0===f?void 0:f.type)||(null===b||void 0===b?void 0:b.type);S=b.url&&"csv"===S;f=!0===(null===(k=null===(h=b.portalItem)||void 0===h?void 0:h.typeKeywords)||void 0===k?void 0:k.includes("Location Tracking Service"));k=void 0!==b.url&&!0===p.isHostedAgolService(b.url);
h=!!k&&void 0===(null===(r=null===b||void 0===b?void 0:b.sourceJSON)||void 0===r?void 0:r.sqlParserVersion)&&10.91<=b.version;r=k&&void 0===(null===(I=null===b||void 0===b?void 0:b.sourceJSON)||void 0===I?void 0:I.sqlParserVersion)||10.91<=b.version&&!0===(null===(T=null===(A=null===b||void 0===b?void 0:b.sourceJSON)||void 0===A?void 0:A.sqlParserVersion)||void 0===T?void 0:T.includes("PG_"));I=z(b)&&!S&&(r||h);return void 0!==b&&I&&!f}})},"app/utils/appUtils":function(){define(["require","exports"],
function(J,c){Object.defineProperty(c,"__esModule",{value:!0});c.clamp=c.isRTL=c.find=c.isNodeVisible=c.toggleNode=c.hideNode=c.showNode=c.parseUrl=c.concatUnique=c.filterOut=c.includes=c.objectToArray=c.stripStringTags=c.urlToObject=void 0;c.urlToObject=function(){var a=this,l={};(window.location.search||"?").substr(1).replace(/([^&=]+)=?([^&]*)(?:&+|$)/g,function(p,u,E){l[u]=a.stripStringTags(decodeURIComponent(E));return""});return l};c.stripStringTags=function(a){return a.replace(/<\/?[^>]+>/g,
"")};c.objectToArray=function(a){return Object.keys(a).map(function(l){return a[l]})};c.includes=function(a,l){return-1<a.indexOf(l)};c.filterOut=function(a,l){return a.filter(function(p){return-1===l.indexOf(p)})};c.concatUnique=function(a,l){var p=[].concat(a||[]);l.forEach(function(u){u&&-1===p.indexOf(u)&&p.push(u)});return p};c.parseUrl=function(a){var l=document.createElement("a");l.href=a;for(var p=l.protocol.replace(":",""),u=l.hostname||window.location.host,E=l.port,z=l.search,G={},D=l.search.replace(/^\?/,
"").split("\x26"),b=D.length,f=0,h;f<b;f++)D[f]&&(h=D[f].split("\x3d"),G[h[0]]=h[1]);return{source:a,protocol:p,host:u,port:E,query:z,params:G,file:(l.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:l.hash.replace("#",""),path:l.pathname.replace(/^([^\/])/,"/$1"),relative:(l.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:l.pathname.replace(/^\//,"").split("/")}};c.showNode=function(a){(a="string"===typeof a?document.querySelector(a):a)&&a.classList.remove("hide")};c.hideNode=function(a){(a=
"string"===typeof a?document.querySelector(a):a)&&a.classList.add("hide")};c.toggleNode=function(a){this[a&&a.classList.contains("hide")?"showNode":"hideNode"](a)};c.isNodeVisible=function(a){return a&&a.classList.contains("hide")?!1:!0};c.find=function(a,l){for(var p,u=0;u<a.length;u++)if(p=a[u],l(p))return p;return null};c.isRTL=function(){return"rtl"===document.getElementsByTagName("html")[0].getAttribute("dir")};c.clamp=function(a,l,p){return Math.min(Math.max(a,l),p)}})}}});
define(["require","exports","tslib","../../../../utils/messageBundleLoader","../itembrowsers/AddLayer"],function(J,c,a,l,p){Object.defineProperty(c,"__esModule",{value:!0});c.createWidget=void 0;p=a.__importDefault(p);c.createWidget=function(u){return a.__awaiter(this,void 0,void 0,function(){var E,z,G,D,b,f,h,k;return a.__generator(this,function(r){switch(r.label){case 0:return E=u.state,z=E.portal,G=E.mapView,D=u.container||document.createElement("div"),[4,l.fetchMessageBundles(["mapviewer/mapMaker",
"mapviewer/common"])];case 1:return b=r.sent(),f=b[0],h=b[1],k=new p.default({view:G,portal:z,container:D,messages:f,messagesCommon:h}),k.createItemBrowser(),[2,{destroy:function(){k.destroy()}}]}})})}});