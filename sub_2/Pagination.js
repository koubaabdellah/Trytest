//>>built
define("dgrid/extensions/Pagination","../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),function(E,F,G,B,u,v,y,C,z,d,H,I){function J(a){a.noDataNode?(d(a.noDataNode,"!"),delete a.noDataNode):a.cleanup();a.contentNode.innerHTML=""}function D(a){if(a.loadingNode)d(a.loadingNode,"!"),delete a.loadingNode;
else if(a._oldPageNodes){for(var b in a._oldPageNodes)a.removeRow(a._oldPageNodes[b]);delete a._oldPageNodes;a._oldPageObserver&&(a._oldPageObserver.cancel(),a._numObservers--,delete a._oldPageObserver)}delete a._isLoading}return F("dgrid.extensions.Pagination",E,{rowsPerPage:10,pagingTextBox:!1,previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:I,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);
var a=this,b=this.paginationNode=d(this.footerNode,"div.dgrid-pagination"),c=this.paginationStatusNode=d(b,"div.dgrid-status"),k=this.i18nPagination;c.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();c.innerHTML=C.substitute(k.status,{start:1,end:1,total:0});b=this.paginationNavigationNode=d(b,"div.dgrid-navigation");this.firstLastArrows&&(c=this.paginationFirstNode=d(b,"span.dgrid-first.dgrid-page-link","\u00ab"),c.setAttribute("aria-label",k.gotoFirst),c.tabIndex=0);
this.previousNextArrows&&(c=this.paginationPreviousNode=d(b,"span.dgrid-previous.dgrid-page-link","\u2039"),c.setAttribute("aria-label",k.gotoPrev),c.tabIndex=0);this.paginationLinksNode=d(b,"span.dgrid-pagination-links");this.previousNextArrows&&(c=this.paginationNextNode=d(b,"span.dgrid-next.dgrid-page-link","\u203a"),c.setAttribute("aria-label",k.gotoNext),c.tabIndex=0);this.firstLastArrows&&(c=this.paginationLastNode=d(b,"span.dgrid-last.dgrid-page-link","\u00bb"),c.setAttribute("aria-label",
k.gotoLast),c.tabIndex=0);this._listeners.push(v(b,".dgrid-page-link:click,.dgrid-page-link:keydown",function(g){if("keydown"!==g.type||13===g.keyCode)if(g=this.className,!(a._isLoading||-1<g.indexOf("dgrid-page-disabled"))){var h=a._currentPage;var f=Math.ceil(a._total/a.rowsPerPage);this===a.paginationPreviousNode?a.gotoPage(h-1):this===a.paginationNextNode?a.gotoPage(h+1):this===a.paginationFirstNode?a.gotoPage(1):this===a.paginationLastNode?a.gotoPage(f):"dgrid-page-link"===g&&a.gotoPage(+this.innerHTML)}}))},
destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var a=this.pageSizeOptions,b=this.paginationSizeSelect;if(a&&a.length){if(!b){b=this.paginationSizeSelect=d(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+this.i18nPagination.rowsPerPage+"]");var c=this._paginationSizeChangeHandle=v(b,"change",B.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)}));this._listeners.push(c)}for(c=
b.options.length=0;c<a.length;c++)d(b,"option",a[c],{value:a[c],selected:this.rowsPerPage===a[c]});this._updateRowsPerPageOption()}else a&&a.length||!b||(d(b,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove())},_setPageSizeOptions:function(a){this.pageSizeOptions=a&&a.sort(function(b,c){return b-c});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var a=this.rowsPerPage,b=this.pageSizeOptions,c=this.paginationSizeSelect;c&&(0>G.indexOf(b,a)?this._setPageSizeOptions(b.concat([a])):
c.value=""+a)},_setRowsPerPage:function(a){this.rowsPerPage=a;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function a(m,w){if(c.pagingTextBox&&m==h&&1<l){var p=d(g,"input.dgrid-page-input[type\x3dtext][value\x3d$]",h);p.setAttribute("aria-label",k.jumpPage);c._pagingTextBoxHandle=v(p,"change",function(){var A=+this.value;!isNaN(A)&&0<A&&A<=l&&c.gotoPage(+this.value)});e&&"INPUT"===e.tagName&&p.focus()}else{var x=m===h;p=d(g,"span"+(x?".dgrid-page-disabled":"")+".dgrid-page-link",
m+(w?" ":""));p.setAttribute("aria-label",k.gotoPage);p.tabIndex=x?-1:0;r===m&&(x?m<l?r++:q.focus():p.focus());x||(q=p)}}function b(m,w){d(m,(w?".":"!")+"dgrid-page-disabled");m.tabIndex=w?-1:0}var c=this,k=this.i18nPagination,g=this.paginationLinksNode,h=this._currentPage,f=this.pagingLinks,n=this.paginationNavigationNode,l=Math.ceil(this._total/this.rowsPerPage),t=this._pagingTextBoxHandle,e=document.activeElement,r,q;e&&H.contains(this.paginationNavigationNode,e)?"dgrid-page-link"===e.className&&
(r=+e.innerHTML):e=null;t&&t.remove();g.innerHTML="";y(".dgrid-first, .dgrid-previous",n).forEach(function(m){b(m,1===h)});y(".dgrid-last, .dgrid-next",n).forEach(function(m){b(m,h>=l)});if(f&&0<l){a(1,!0);n=h-f;for(2<n?d(g,"span.dgrid-page-skip","..."):n=2;n<Math.min(h+f+1,l);n++)a(n,!0);h+f+1<l&&d(g,"span.dgrid-page-skip","...");1<l&&a(l)}else c.pagingTextBox&&a(h);e&&-1===e.tabIndex&&(f=y("[tabindex\x3d'0']",this.paginationNavigationNode),e===this.paginationPreviousNode||e===this.paginationFirstNode?
e=f[0]:f.length&&(e=f[f.length-1]),e&&e.focus())},refresh:function(){var a=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(b){setTimeout(function(){v.emit(a.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:a,results:b})},0);return b})},_onNotification:function(a){a.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(a,b){var c=this,k=this.inherited(arguments);this._lastCollection=null;b||(this._topLevelRequest&&this._topLevelRequest!==
a&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof a.cancel&&(this._topLevelRequest=a),u.when(a,function(){c._topLevelRequest&&delete c._topLevelRequest}));return k},insertRow:function(){var a=this._oldPageNodes,b=this.inherited(arguments);a&&b===a[b.id]&&delete a[b.id];return b},gotoPage:function(a){var b=this,c=new u;this._trackError(function(){var k=b.rowsPerPage,g=(a-1)*k,h=B.mixin(b.get("queryOptions"),{start:g,count:k}),f=b.contentNode,n;if(b.showLoadingMessage){J(b);
var l=b.loadingNode=d(f,"div.dgrid-loading");l.innerHTML=b.loadingMessage}else{b._oldPageNodes=l={};f=f.children;var t=0;for(n=f.length;t<n;t++)l[f[t].id]=f[t];b._oldPageObserver=b.observers.pop()}b._isLoading=!0;var e=b.store.query(b.query,h);u.when(b.renderArray(e,null,h),function(r){D(b);b.scrollTo({y:0});u.when(e.total,function(q){q||(b.noDataNode&&(d(b.noDataNode,"!"),delete b.noDataNode),b.noDataNode=d(b.contentNode,"div.dgrid-no-data"),b.noDataNode.innerHTML=b.noDataMessage);b.paginationStatusNode.innerHTML=
C.substitute(b.i18nPagination.status,{start:Math.min(g+1,q),end:Math.min(q,g+k),total:q});b._total=q;b._currentPage=a;b._rowsOnPage=r.length;b._updateNavigation()});(7>z("ie")||z("ie")&&z("quirks"))&&b.resize();c.resolve(e)},function(r){D(b);c.reject(r)});return c.promise})||c.reject();return c.promise}})});