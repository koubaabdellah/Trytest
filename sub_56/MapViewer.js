!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(window,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";var i={init:function(t,e){if(t.clientId)return window.addEventListener("message",this._handleJsonMessage.bind(this)),this.userData=t,this.userData.homeAppOrigin=this._getHomeAppOrigin(this.userData.orgUrlKey,this.userData.environment,this.userData.portal)+"pages/ago_web_worker.html#",this.userData.iframe=this.createIframe(this.userData.homeAppOrigin,this.userData.orgUrlKey,this.userData.environment),this.currentClientCallback=e,this.resources=t.resources||null,this.portalConnectionEstablished=!1,this.portal=this._readyPortalForTransport(t.portal,t.orgUrlKey),this.portalUser=this._readyPortalUserForTransport(t.portalUser),this},_handleJsonMessage:function(t,e){try{var r=JSON.parse(t.data)}catch(t){return this.currentClientCallback({success:!1,error:t})}return this.currentClientCallback(r)},performAction:function(t,e,r,i){this.portalConnectionEstablished||(r=r||{},this.resources&&(r.resources=this.resources),r.portal=this.portal,r.portalUser=this.portalUser,this.portalConnectionEstablished=!0),this.currentClientCallback=i,this.requestResource(t,e,"string"==typeof r?r:JSON.stringify(r))},_getHomeAppOrigin:function(t,e,r){if(r&&r.isPortal&&r.url)return r.url+"/home/";var i=location.protocol;return!e||"devext"!==e&&"qa"!==e?i+"//"+(t?t+".maps.":"")+"arcgis.com/home/":t?i+"//"+(t||"")+".maps"+e+".arcgis.com/home/":i+"//"+("devext"===e?e:"qaext")+".arcgis.com/home/"},_getOriginOfUrl:function(t){return(t=t||window.location).protocol+"//"+t.hostname+(t.port?":"+t.port:"")},_readyPortalForTransport:function(t,e){return{urlKey:e,portalUrl:t.portalUrl,customBaseUrl:t.customBaseUrl,allSLL:t.allSSL,isPortal:t.isPortal,httpPort:t.httpPort,httpsPort:t.httpsPort,allowedBetaFeatures:t.allowedBetaFeatures,portalHostname:t.portalHostname,portalProperties:this._getEnabledProperties(t.portalProperties,["openData"]),subscriptionInfo:this._getEnabledProperties(t.subscriptionInfo,["hubSettings"]),helperServices:this._getBooleanProperties(t.helperServices,["rasterAnalytics","orthoMapping","locationTracking"])}},_getEnabledProperties:function(t,e){var r={};return t&&e.forEach(function(e){t[e]&&(r[e]={enabled:t[e].enabled})}),r},_getBooleanProperties:function(t,e){var r={};return t&&e.forEach(function(e){t[e]&&(r[e]=!0)}),r},_readyPortalUserForTransport:function(t){return{username:t.username,credential:{token:t.credential.token},orgId:t.orgId,role:t.role,privileges:t.privileges,isOrgAdmin:t.isOrgAdmin,userLicenseTypeId:t.userLicenseTypeId}},createIframe:function(t,e,r){return t+="origin="+this._getOriginOfUrl(),t+="&clientId="+this.userData.clientId,this._create("iframe",{src:t,style:"display:none;"},document.body)},_create:function(t,e,r){if("string"!=typeof t)throw"Error in _create: element must be a string";var i=document.createElement(t);if("object"!=typeof e||Array.isArray(e))throw"Error in _create: attributes must be defined in an object";return null!==e&&Object.keys(e).forEach(function(t){"innerHTML"===t?i.innerHTML=e[t]:i.setAttribute(t,e[t])}),null!=r&&r.appendChild(i),i},_addEvent:function(t,e,r){t.attachEvent?t.attachEvent("on"+e,r):t.addEventListener(e,r)},requestResource:function(t,e,r){this.userData.iframe.contentWindow.postMessage({name:t,action:e,data:r},this.userData.homeAppOrigin)}};r.d(e,"a",function(){return s});class s{constructor(t){this.item=null,this.portal=null,this.i18n=null,this.config=null,this.cookie=null,this.defaultNavStructure=null,this.navResources=null,this.GlobalNavLink=null,this.navLinks=null,this.fetchNotifications=()=>[],this.deleteNotifications=()=>[],this.portal=t.portal,this.config=t.config,this.item=t.item,this.i18n=t.i18n,this.fetchNotifications=t.fetchNotifications,this.deleteNotifications=t.deleteNotifications,this.noUserThumbnailUrl=t.noUserThumbnailUrl||"img/no-user-thumb.jpg",this.GlobalNavLink={init:function(t,e){return this.label=t,this.href=e.href?"function"==typeof e.href?e.href():e.href:"#",e.data&&(this.data=e.data),e.active&&(this.active=e.active),e.openInNewTab&&(this.newContext=e.openInNewTab),this}}}getNavStructure(t){return this.defaultNavStructure=this.getDefaultNavStructure(this.i18n),this.navLinks=this.buildNavLinks(this.portal),this.portal.user?this.getSignedInNavStructure(t.public,t.org):this.getSignedOutNavStructure(t.product,t.signedOut),this.setBrand(),this.setAccount(),this.setNotifications().then(()=>this.defaultNavStructure)}getSignedOutNavStructure(t,e){return this.defaultNavStructure.header.menus=[this.filterAndCreateLinks(this.showProductLinks()?t:e,this.i18n.globalNav.links)],this.defaultNavStructure}getSignedInNavStructure(t,e){return this.defaultNavStructure.header.menus=[this.filterAndCreateLinks(this.isPublicAccount()?t:e,this.i18n.globalNav.links)],this.defaultNavStructure}generateGlobalNavResources(){if(!this.canAccessAppLauncher())return;this.portal.isPortal||(this.defaultNavStructure.header.apps=this.appsJson(null)),this.cookie=function(t){const e=`${t}=`,r=decodeURIComponent(document.cookie).split(";");for(var i=0;i<r.length;i++){let t=r[i];for(;" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(e))return t.substring(e.length,t.length)}return""}("esri_auth"),this.portal.user.credential={token:this.cookie.token},this.portal.portalUrl=this.getPortalRestUrl();const t={noStrings:!0,resources:["AppLauncher"],clientId:"arcgisonline",orgUrlKey:this.portal.urlKey,environment:this.getEnvironment(),portal:this.portal,portalUser:this.portal.user};this.navResources=i.init(t,this.getApps.bind(this))}getPortalRestUrl(){return"https://"+(this.portal.urlKey?this.portal.urlKey+"."+this.portal.customBaseUrl:this.portal.portalHostname)+"/sharing/rest/"}getEnvironment(){const t=location.href.split(".")[1].replace("maps","");return"arcgis"===t?"devext":t||"production"}canAccessAppLauncher(){return this.portal.user&&this.portal.user.orgId}appsJson(t){return Object.assign({text:{intro:"Drag and drop your favorite apps in any order to customize your app launcher",confirm:"Got it.",showMore:"Show More",dragAppsHere:"Drag apps here that you don't use very often."},label:"Your Apps",disableDragDrop:!1,loading:!t},t)}updateAppLauncherComponent(t){this.updateComponent("header:update:apps",document.querySelector(".esri-header-apps"),this.appsJson(t))}updateNotificationsComponent(t){this.defaultNavStructure.header.notifications.messages=t,this.updateComponent("header:update:notifications",document.querySelector(".esri-header-notifications"),this.getDefaultNotifications(t)),0===t.length&&this.updateComponent("header:menu:close",document.querySelector(".esri-header-notifications"))}getDefaultNotifications(t){const{label:e,dismissLabel:r,dismissAllLabel:i,clearAllLabel:s,emptyMessageLabel:o}=this.i18n.globalNav.notifications;return{label:e,dismissAllLabel:i,dismissLabel:r,clearAllLabel:s,emptyMessage:{image:{path:["M15.5 1A14.5 14.5 0 1 0 30 15.5 14.5 14.5 0 0 0 15.5 1zm0 28.1a13.6 13.6 0 1 1 13.6-13.6 13.615 13.615 0 0 1-13.6 13.6zM8.581 17.276l.637-.636 3.288 3.098 10.073-9.92.637.637-10.71 10.556z"],viewBox:"0 0 32 32"},text:o},messages:t||[]}}waitToSetupAppLauncher(t){let e=setInterval(()=>{document.querySelector(".esri-header-apps")&&(this.updateAppLauncherComponent(t),clearInterval(e))},200)}createAppLauncher(t){t&&(t.primary&&t.primary.length||t.secondary&&t.secondary.length)&&(document.querySelector(".esri-header-apps")?this.updateAppLauncherComponent(t):this.waitToSetupAppLauncher(t),document.querySelector(".esri-header-barrier").addEventListener("header:apps:reorder",function(t){this.navResources.performAction("AppLauncher","setApps",t.detail.icons,()=>({}))}.bind(this)))}getApps(t){t.success&&this.navResources.performAction("AppLauncher","getApps",{noStrings:!0},this.createAppLauncher.bind(this))}updateComponent(t,e,r){const i=document.createEvent("CustomEvent");i.initCustomEvent(t,!0,!0,r),e.dispatchEvent(i)}setNotifications(){const{portal:t,defaultNavStructure:e}=this,r=t.user;e.header.notifications;return r?(this.listenForDismissNotification(),this.fetchNotifications(t).then(t=>{return e.header.notifications.messages=t,t})):(delete e.header.notifications,Promise.resolve([]))}listenForDismissNotification(){document.addEventListener("header:click:notifications:dismiss",function(t){this.deleteNotifications(this.portal.portalUrl,this.portal.user,t.detail).then(t=>{const e=t.reduce((t,e)=>(e.data&&e.data.success&&t.push(e.data.notificationId),t),[]);this.updateNotificationsComponent((this.defaultNavStructure.header.notifications.messages||[]).filter(t=>e.indexOf(t.id)<0))},()=>{this.updateNotificationsComponent([])})}.bind(this))}setAccount(){const{portal:t,defaultNavStructure:e}=this,r=t.user,i=e.header.account;if(r){this.generateGlobalNavResources();const t={name:r.fullName,id:r.username,group:"",image:r.getThumbnailUrl()||this.noUserThumbnailUrl};i.user=t,this.defaultNavStructure.header.account.menus=this.filterAndCreateLinks(["myProfile","mySettings","myEsri","training","esriCommunity","help"],this.i18n.globalNav.links)}else delete e.header.account.user}setBrand(){const{item:t={},defaultNavStructure:e,portal:r}=this,i=e.header.brand,s=t&&t.title||this.i18n.globalNav.newTitle;i.brandText=s,document.querySelector("title").textContent=s,i.editTitle=!!(r&&r.user&&(!t||t&&t.canUpdate))}showProductLinks(){return!this.portal.id&&!this.portal.access&&!this.portal.isPortal}getHelpUrl(){return this.portal.isPortal?this.getPortalHelpUrl():this.portal.helpBase||"support.html"}getPortalHelpUrl(){const t=this.portal.helpBase+"portal/";return t&&t.indexOf("/enterprise.arcgis.com/")>-1?t:this.portal.allSSL||"https:"===location.protocol||this.usePortalSSL()||"7443"===location.port?this.getSecureUrl(location.protocol+"//"+location.host)+t:t}usePortalSSL(){return!1===this.portal.isMultiTenant||this.portal.isPortal&&this.portal.portalHostname&&!this.portal.portalHostname.match(/:7080\//)&&80!==this.portal.httpPort&&443!==this.portal.httpsPort&&"https:"===location.protocol}getBaseUrl(){return location.protocol+"//"+(this.portal.urlKey?this.portal.urlKey+"."+this.portal.customBaseUrl:this.portal.portalHostname)}getSecureUrl(t){let e=null;return t||(t=this.getBaseUrl()),this.portal.portalMode&&"singletenant"===this.portal.portalMode&&this.portal.httpsPort?(location.port?(e=t.replace(location.port,this.portal.httpsPort),this.portal.isPortal&&(e=e.replace(this.portal.httpPort,this.portal.httpsPort))):e=t.replace(location.hostname,location.hostname+":"+this.portal.httpsPort),(e=e.replace("http:","https:")).replace(/\:80\//,"/").replace(/\:443\//,"/")):t.replace("http:","https:")}filterAndCreateLinks(t,e){const r=[];return t.forEach(function(t){const i=this.navLinks[t];!i||"show"in i&&!i.show||r.push(this.createGlobalNavLink(e[t]||t,i))},this),r}createGlobalNavLink(t,e){return Object.create(this.GlobalNavLink).init(t,e)}buildNavLinks(t){const e=this.getBaseUrl(),r=this.portal,i=r&&r.portalProperties&&r.portalProperties.topNav?r.portalProperties.topNav:{},{gallery:s,scene:o,groups:n}=i;i.notebook;const a=this.portal&&this.portal.user&&this.portal.id===this.portal.user.orgId;return{myProfile:{href:e+"/home/user.html"},mySettings:{href:e+"/home/user.html#settings"},pricing:{href:e+"/features/plans/pricing.html"},overview:{href:e+"/features/features.html"},groups:{show:!n||"all"===n||"members"===n&&a,href:e+"/home/groups.html"},myContent:{href:e+"/home/content.html"},help:{href:this.getHelpUrl.bind(this),openInNewTab:!0},gallery:{show:t.id&&"noOne"!==s&&(!s||"all"===s||"members"===s&&a),href:e+"/home/gallery.html"},home_link:{show:!this.isPublicAccount(),href:e+"/home/index.html"},scene:{show:!o||"all"===o||"members"===o&&a||"sceneCreators"===o&&a&&this.canCreateItem(),href:e+"/home/webscene/viewer.html"},notebook:{show:this.isNotebooksEnabled()&&this.canCreateNotebooks(),href:e+"/home/notebook/notebook.html"},myAccount:{show:this.orgPageRestrictionsDoNotApply()&&this.canViewOrgUsers(),href:e+"/home/organization.html"},esriCommunity:{show:this.showEsriLinks(),href:this.getEsriCommunityUrl.bind(this),openInNewTab:!0},myEsri:{show:this.showEsriLinks(),href:this.getMyEsriUrl.bind(this),openInNewTab:!0},training:{show:this.showEsriLinks(),href:this.getEsriTrainingUrl.bind(this),openInNewTab:!0}}}getMyEsriUrl(){return this.generateEsriLoginHandlerUrl(this.config.myEsriLink)}getEsriCommunityUrl(){return this.generateEsriLoginHandlerUrl(this.config.esriCommunityLink)}generateEsriLoginHandlerUrl(t){const e=this.getDevEnviroment(),r="https://accounts"+(e?"dev"===e?"-dev":"-stg":"")+".esri.com/",i="&authBaseUrl="+this.getRestBaseUrl().replace("/sharing/rest/","");return r+"LoginHandler/switchuser?"+("username="+this.portal.user.username+"&redirect_uri="+t+i)}getEsriTrainingUrl(){const t="//www.esri.com/training/main/arcgis-online-administrators",e="//www.esri.com/training/main/arcgis-online-publishers",r="//www.esri.com/training/main/arcgis-online-users",i="//www.esri.com/training/main/arcgis-online-training",s="//www.esri.com/training/main/arcgis-online-training";let o;return this.portal.user&&this.portal.user.role?this.isAdmin()||this.isBasedOnAdmin()?o=t:this.isPublisher()||this.isBasedOnPublisher()?o=e:this.isUser()||this.isBasedOnUser()?o=r:this.isCustom()&&(o=s):o=i,this.generateEsriLoginHandlerUrl(window.location.protocol+o)}getRestBaseUrl(){const t=this.getHomeContext();return location.protocol+"//"+location.host+t+"sharing/rest/"}getHomeContext(){const t=window.location.pathname.split("/").filter(t=>t),e=t&&t.length?t[0]:"/";return"/"!==e&&"home"!==e?`${e}`:e}getDevEnviroment(){const t=this.portal.portalHostname;return-1!==t.indexOf("dev")?"dev":-1!==t.indexOf("qa")?"qa":null}orgPageRestrictionsDoNotApply(){const t=this.portal.user;return!this.config.restrictOrganizationPageToAdmin||(!this.portal.id||t.role&&"account_admin"===t.role)}canViewOrgUsers(){return this.portal.user&&this.portal.user.privileges&&this.portal.user.privileges.indexOf("portal:user:viewOrgUsers")>-1}canCreateNotebooks(){return this.portal.user&&this.portal.user.privileges&&this.portal.user.privileges.indexOf("premium:publisher:createNotebooks")>-1}canCreateItem(){return this.portal.user&&this.portal.user.privileges&&this.portal.user.privileges.indexOf("portal:user:createItem")>-1}isNotebooksEnabled(){const{portal:t}=this,e=this.subscriptionIsTrial();return t&&t.isPortal?t.supportsHostedNotebooks:!e}showEsriLinks(){return!this.portal.isPortal&&this.portal.user&&"both"===this.portal.user.userType}subscriptionIsTrial(){return!this.portal.isPortal&&this.portal.subscriptionInfo&&("Trial"===this.portal.subscriptionInfo.type||"Trial Press"===this.portal.subscriptionInfo.type)}isDefined(t){return null!=t}isBasedOnUser(){return this.isUser()||this.isDefined(this.portal.user.role)&&("org_user"===this.portal.user.role||"account_user"===this.portal.user.role)}isCustom(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&this.isDefined(this.portal.id)&&this.portal.id>0}isPublisher(){return this.isDefined(this.portal.id)&&("org_publisher"===this.portal.id||"account_publisher"===this.portal.id)}isUser(){return this.isDefined(this.portal.id)&&("org_user"===this.portal.id||"account_user"===this.portal.id)}isAdmin(){return this.isDefined(this.portal.id)&&("org_admin"===this.portal.id||"account_admin"===this.portal.id)}isPublicAccount(){return!this.portal.urlKey&&!this.portal.isPortal&&this.portal.user}isBasedOnPublisher(){return this.isPublisher()||this.isDefined(this.portal.user.role)&&("org_publisher"===this.portal.user.role||"account_publisher"===this.portal.user.role)}isBasedOnAdmin(){return this.isAdmin()||this.isDefined(this.portal.user.role)&&("org_admin"===this.portal.user.role||"account_admin"===this.portal.user.role)}getDefaultNavStructure(t){return{header:{theme:"app",collapseMenus:[!0,!1],brand:{label:"Map Maker",brandText:"Map Maker",image:null,width:30,height:30},menus:[[{label:t.globalNav.account.profile,href:"#user-menu-link-1"},{label:t.globalNav.account.myEsri,href:"#user-menu-link-2"},{label:t.globalNav.account.training,href:"#user-menu-link-3"},{label:t.globalNav.account.community,href:"#user-menu-link-4"}]],account:{label:t.globalNav.account.label,controls:{signin:t.globalNav.account.signin,signout:t.globalNav.account.signout,switch:t.globalNav.account.switch},menus:[{label:"My profile",href:"./user.html"},{label:"My settings",href:"./user.html#settings"},{label:"my esri",href:"#",data:{agoMethod:"goMyesri"}},{label:"training",href:"#",data:{agoMethod:"goTraining"}},{label:"community & forums",href:"#",data:{agoMethod:"goEsriCommunity"}},{label:"help",href:"http://doc.arcgis.com/en/arcgis-online/"}],user:{}},notifications:{label:t.globalNav.notifications.label,dismissAllLabel:t.globalNav.notifications.dismissAllLabel,dismissLabel:t.globalNav.notifications.dismissLabel,clearAllLabel:t.globalNav.notifications.clearAllLabel,emptyMessage:{image:{path:["M15.5 1A14.5 14.5 0 1 0 30 15.5 14.5 14.5 0 0 0 15.5 1zm0 28.1a13.6 13.6 0 1 1 13.6-13.6 13.615 13.615 0 0 1-13.6 13.6zM8.581 17.276l.637-.636 3.288 3.098 10.073-9.92.637.637-10.71 10.556z"],viewBox:"0 0 32 32"},text:t.globalNav.notifications.emptyMessageLabel},messages:[]}}}}}},function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return s});var i=r(0);class s extends i.a{spawnStructure(){return this.getNavStructure({signedOut:["home_link","gallery","map","scene","groups","help"],product:["ArcGIS","overview","pricing","map","scene","groups"],public:["ArcGIS","overview","pricing","map","scene","groups","myContent"],org:["home_link","gallery","map","scene","notebook","groups","myContent","myAccount"]})}}}])});
//# sourceMappingURL=MapViewer.js.map