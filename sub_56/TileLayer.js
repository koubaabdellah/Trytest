// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.24/esri/copyright.txt for details.//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(v,p,c,f,q,z,y,
n,x,u,L,K,U){v.ArcGISCachedService=G=>{G=function(B){function O(){var I=B.apply(this,arguments)||this;I.copyright=null;I.minScale=0;I.maxScale=0;I.spatialReference=null;I.tileInfo=null;I.tilemapCache=null;return I}p._inheritsLoose(O,B);var M=O.prototype;M.readMinScale=function(I,V){return null!=V.minLOD&&null!=V.maxLOD?I:0};M.readMaxScale=function(I,V){return null!=V.minLOD&&null!=V.maxLOD?I:0};M.readTilemapCache=function(I,V){return V.capabilities&&V.capabilities.includes("Tilemap")?new K.TilemapCache({layer:this}):
null};p._createClass(O,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return O}(G);c.__decorate([q.property({json:{read:{source:"copyrightText"}}})],G.prototype,"copyright",void 0);c.__decorate([q.property()],G.prototype,"minScale",void 0);c.__decorate([x.reader("service","minScale")],G.prototype,"readMinScale",null);c.__decorate([q.property()],G.prototype,"maxScale",void 0);c.__decorate([x.reader("service","maxScale")],G.prototype,"readMaxScale",null);c.__decorate([q.property({type:U})],
G.prototype,"spatialReference",void 0);c.__decorate([q.property({readOnly:!0})],G.prototype,"supportsBlankTile",null);c.__decorate([q.property(L.serviceTileInfoProperty)],G.prototype,"tileInfo",void 0);c.__decorate([q.property()],G.prototype,"tilemapCache",void 0);c.__decorate([x.reader("service","tilemapCache",["capabilities"])],G.prototype,"readTilemapCache",null);c.__decorate([q.property()],G.prototype,"version",void 0);return G=c.__decorate([u.subclass("esri.layers.mixins.ArcGISCachedService")],
G)};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(v,p){function c(q,z,y,n){if(!q)return null;const {minScale:x,maxScale:u,minLOD:L,maxLOD:K}=z;if(null!=L&&null!=K)return n&&n.ignoreMinMaxLOD?p.fromJSON(q):p.fromJSON({...q,lods:q.lods.filter(({level:U})=>null!=U&&U>=L&&U<=K)});if(0!==x&&0!==u){const U=x?Math.round(1E4*x)/1E4:Infinity,G=u?Math.round(1E4*u)/
1E4:-Infinity;return p.fromJSON({...q,lods:q.lods.filter(B=>{B=Math.round(1E4*B.scale)/1E4;return B<=U&&B>=G})})}return p.fromJSON(q)}const f={type:p,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:c}}}}};v.readServiceTileInfo=c;v.serviceTileInfoProperty=f;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(v,p,c,f,q,z,y,n,x,u,L,K,U,G,B,O,M,I,V){var Y;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});f=Y=function(C){function w(d){d=C.call(this,d)||this;d.dpi=96;d.format=null;d.origin=null;d.minScale=0;d.maxScale=0;d.size=null;d.spatialReference=null;return d}v._inheritsLoose(w,C);w.create=function(d=
{}){const {resolutionFactor:k=1,scales:g,size:b=256,spatialReference:h=B.WebMercator,numLODs:m=24}=d;if(!M.isValid(h)){d=[];if(g)for(var r=0;r<g.length;r++){var A=g[r];d.push({level:r,scale:A,resolution:A})}else for(r=5E-4,A=m-1;0<=A;A--)d.unshift({level:A,scale:r,resolution:r}),r*=2;return new Y({dpi:96,lods:d,origin:new G(0,0,h),size:[b,b],spatialReference:h})}r=M.getInfo(h);d=d.origin?new G({x:d.origin.x,y:d.origin.y,spatialReference:h}):r?new G({x:r.origin[0],y:r.origin[1],spatialReference:h}):
new G({x:0,y:0,spatialReference:h});r=1/(39.37*z.getMetersPerUnitForSR(h)*96);A=[];if(g)for(var N=0;N<g.length;N++){var Q=g[N];A.push({level:N,scale:Q,resolution:Q*r})}else{var P=M.isGeographic(h)?512/b*5.916575275917094E8:256/b*5.91657527591555E8;N=Math.ceil(m/k);A.push({level:0,scale:P,resolution:P*r});for(Q=1;Q<N;Q++)P/=2**k,A.push({level:Q,scale:P,resolution:P*r})}return new Y({dpi:96,lods:A,origin:d,size:[b,b],spatialReference:h})};var H=w.prototype;H.readOrigin=function(d,k){return G.fromJSON({spatialReference:k.spatialReference,
...d})};H.readSize=function(d,k){return[k.cols,k.rows]};H.writeSize=function(d,k){k.cols=d[0];k.rows=d[1]};H.zoomToScale=function(d){const k=this.scales;if(0>=d)return k[0];if(d>=k.length-1)return k[k.length-1];{const g=Math.floor(d);return k[g]/(k[g]/k[g+1])**(d-g)}};H.scaleToZoom=function(d){const k=this.scales,g=k.length-1;let b=0;for(;b<g;b++){const h=k[b],m=k[b+1];if(h<=d)break;if(m===d)return b+1;if(h>d&&m<d)return b+Math.log(h/d)/Math.log(h/m)}return b};H.snapScale=function(d,k=.95){d=this.scaleToZoom(d);
return d%Math.floor(d)>=k?this.zoomToScale(Math.ceil(d)):this.zoomToScale(Math.floor(d))};H.tileAt=function(d,k,g,b){var h=this.lodAt(d);if(!h)return null;let m;if("number"===typeof k)m=k,k=g;else{if(M.equals(k.spatialReference,this.spatialReference))m=k.x,k=k.y;else{b=I.project(k,this.spatialReference);if(q.isNone(b))return null;m=b.x;k=b.y}b=g}g=h.resolution*this.size[0];h=h.resolution*this.size[1];b||(b={id:null,level:0,row:0,col:0,extent:O.create()});b.level=d;b.row=Math.floor((this.origin.y-
k)/h+.001);b.col=Math.floor((m-this.origin.x)/g+.001);this.updateTileInfo(b);return b};H.updateTileInfo=function(d,k=Y.ExtrapolateOptions.NONE){var g=this.lodAt(d.level);g||k!==Y.ExtrapolateOptions.POWER_OF_TWO||(k=this.lods[this.lods.length-1],k.level<d.level&&(g=k));if(g){var b=d.level-g.level;k=g.resolution*this.size[0]/2**b;g=g.resolution*this.size[1]/2**b;d.id=`${d.level}/${d.row}/${d.col}`;d.extent||(d.extent=O.create());d.extent[0]=this.origin.x+d.col*k;d.extent[1]=this.origin.y-(d.row+1)*
g;d.extent[2]=d.extent[0]+k;d.extent[3]=d.extent[1]+g}};H.upsampleTile=function(d){const k=this._upsampleLevels[d.level];if(!k||-1===k.parentLevel)return!1;d.level=k.parentLevel;d.row=Math.floor(d.row/k.factor+.001);d.col=Math.floor(d.col/k.factor+.001);this.updateTileInfo(d);return!0};H.getTileBounds=function(d,k){var {resolution:g}=this.lodAt(k.level);const b=g*this.size[0];g*=this.size[1];d[0]=this.origin.x+k.col*b;d[1]=this.origin.y-(k.row+1)*g;d[2]=d[0]+b;d[3]=d[1]+g;return d};H.lodAt=function(d){return this._levelToLOD&&
this._levelToLOD[d]||null};H.clone=function(){return Y.fromJSON(this.write({}))};H.getOrCreateCompatible=function(d,k){if(256===this.size[0]&&256===this.size[1])return 256===d?this:null;const g=[],b=this.lods.length;for(let h=0;h<b;h++){const m=this.lods[h];g.push(new V({level:m.level,scale:m.scale,resolution:m.resolution*k}))}return new Y({size:[d,d],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:g})};H._initializeUpsampleLevels=
function(){const d=this.lods;this._upsampleLevels=[];let k=null;for(let g=0;g<d.length;g++){const b=d[g];this._upsampleLevels[b.level]={parentLevel:k?k.level:-1,factor:k?k.resolution/b.resolution:0};k=b}};v._createClass(w,[{key:"isWrappable",get:function(){const {spatialReference:d,origin:k}=this;if(d&&k){const g=M.getInfo(d);return d.isWrappable&&Math.abs(g.origin[0]-k.x)<=g.dx}return!1}},{key:"lods",set:function(d){let k=0,g=0;const b=[];this._levelToLOD={};d&&(k=-Infinity,g=Infinity,d.forEach(h=>
{b.push(h.scale);k=h.scale>k?h.scale:k;g=h.scale<g?h.scale:g;this._levelToLOD[h.level]=h}));this._set("scales",b);this._set("minScale",k);this._set("maxScale",g);this._set("lods",d);this._initializeUpsampleLevels()}}]);return w}(f.JSONSupport);p.__decorate([y.property({type:Number,json:{write:!0}})],f.prototype,"compressionQuality",void 0);p.__decorate([y.property({type:Number,json:{write:!0}})],f.prototype,"dpi",void 0);p.__decorate([y.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,
write:!1}}}})],f.prototype,"format",void 0);p.__decorate([y.property({readOnly:!0})],f.prototype,"isWrappable",null);p.__decorate([y.property({type:G,json:{write:!0}})],f.prototype,"origin",void 0);p.__decorate([L.reader("origin")],f.prototype,"readOrigin",null);p.__decorate([y.property({type:[V],value:null,json:{write:!0}})],f.prototype,"lods",null);p.__decorate([y.property({readOnly:!0})],f.prototype,"minScale",void 0);p.__decorate([y.property({readOnly:!0})],f.prototype,"maxScale",void 0);p.__decorate([y.property({readOnly:!0})],
f.prototype,"scales",void 0);p.__decorate([y.property({cast:C=>Array.isArray(C)?C:"number"===typeof C?[C,C]:[256,256]})],f.prototype,"size",void 0);p.__decorate([L.reader("size",["rows","cols"])],f.prototype,"readSize",null);p.__decorate([U.writer("size",{cols:{type:u.Integer},rows:{type:u.Integer}})],f.prototype,"writeSize",null);p.__decorate([y.property({type:B,json:{write:!0}})],f.prototype,"spatialReference",void 0);f=Y=p.__decorate([K.subclass("esri.layers.support.TileInfo")],f);(function(C){C=
C.ExtrapolateOptions||(C.ExtrapolateOptions={});C[C.NONE=0]="NONE";C[C.POWER_OF_TWO=1]="POWER_OF_TWO"})(f||(f={}));return f})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(v,p,c,f,q,z,y,n){var x;c=x=function(u){function L(K){K=
u.call(this,K)||this;K.cols=null;K.level=0;K.levelValue=null;K.origin=null;K.resolution=0;K.rows=null;K.scale=0;return K}v._inheritsLoose(L,u);L.prototype.clone=function(){return new x({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return L}(c.JSONSupport);p.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);p.__decorate([f.property({type:y.Integer,
json:{write:!0}})],c.prototype,"level",void 0);p.__decorate([f.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);p.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);p.__decorate([f.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);p.__decorate([f.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,
"rows",void 0);p.__decorate([f.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=x=p.__decorate([n.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/byteSizeEstimations ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(v,p,c,f,q,z,y,n,x,u,L,K,U,G,B,O,M,I,V,Y,C){var w;const H=x.getLogger("esri.layers.support.TilemapCache");v.TilemapCache=w=function(d){function k(b){b=d.call(this,b)||this;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2*z.ByteSizeUnit.MEGABYTES;b.request=f;b._prefetchingEnabled=!0;return b}p._inheritsLoose(k,d);var g=k.prototype;g.initialize=function(){this._tilemapCache=new u(this.cacheByteSize);this.own([U.watch(()=>{const {layer:b}=this;return[null==b?void 0:
b.parsedUrl,null==b?void 0:b.tileServers,null==b?void 0:b.apiKey,null==b?void 0:b.customParameters]},()=>this._initializeTilemapDefinition()),U.watch(()=>{var b,h;return null==(b=this.layer)?void 0:null==(h=b.tileInfo)?void 0:h.lods},b=>this._initializeAvailableLevels(b),U.syncAndInitial)]);this._initializeTilemapDefinition()};g.castLevels=function(b){return 2>=b?(H.error("Minimum levels for Tilemap is 3, but got ",b),3):b};g.fetchTilemap=function(b,h,m,r){if(!this._availableLevels[b])return Promise.reject(new y("tilemap-cache:level-unavailable",
`Level ${b} is unavailable in the service`));const A=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,h,m,A))return Promise.resolve(b);const N=r&&r.signal;r={...r,signal:null};return new Promise((Q,P)=>{K.onAbort(N,()=>P(K.createAbortError()));const S=C.tilemapDefinitionId(A);let D=this._pendingTilemapRequests[S];if(!D){D=C.Tilemap.fromDefinition(A,r).then(F=>{this._tilemapCache.put(S,F,F.byteSize);return F});const l=()=>delete this._pendingTilemapRequests[S];this._pendingTilemapRequests[S]=
D;D.then(l,l)}D.then(Q,P)})};g.getAvailability=function(b,h,m){return this._availableLevels[b]?(b=this._tilemapFromCache(b,h,m,this._tmpTilemapDefinition))?b.getAvailability(h,m):"unknown":"unavailable"};g.fetchAvailability=function(b,h,m,r){return this._availableLevels[b]?this.fetchTilemap(b,h,m,r).catch(A=>A).then(A=>{if(A instanceof C.Tilemap){A=A.getAvailability(h,m);if("unavailable"===A)throw new y("tile-map:tile-unavailable","Tile is not available",{level:b,row:h,col:m});return A}if(K.isAbortError(A))throw A;
return"unknown"}):Promise.reject(new y("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};g.fetchAvailabilityUpsample=function(b,h,m,r,A){r.level=b;r.row=h;r.col=m;const N=this.layer.tileInfo;N.updateTileInfo(r);const Q=this.fetchAvailability(b,h,m,A).catch(P=>{if(K.isAbortError(P))throw P;if(N.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw P;});this._fetchAvailabilityUpsamplePrefetch(r.id,b,h,m,A,Q);return Q};g._fetchAvailabilityUpsamplePrefetch=
function(){var b=p._asyncToGenerator(function*(h,m,r,A,N,Q){if(this._prefetchingEnabled){var P=`prefetch-${h}`;if(!this.handles.has(P)){var S=new AbortController;Q.then(()=>S.abort(),()=>S.abort());var D=!1;this.handles.add({remove(){D||(D=!0,S.abort())}},P);yield G.waitTicks(10,S.signal).catch(()=>{});D||(D=!0,this.handles.remove(P));if(!K.isAborted(S))for(h={id:h,level:m,row:r,col:A},N={...N,signal:S.signal},m=this.layer.tileInfo,r=0;w._prefetches.length<w._maxPrefetch&&m.upsampleTile(h);++r){const l=
this.fetchAvailability(h.level,h.row,h.col,N);w._prefetches.push(l);A=()=>{w._prefetches.removeUnordered(l)};l.then(A,A)}}}});return function(h,m,r,A,N,Q){return b.apply(this,arguments)}}();g._initializeTilemapDefinition=function(){var b;if(this.layer.parsedUrl){var {parsedUrl:h,apiKey:m,customParameters:r}=this.layer;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:h.path,query:B.objectToQuery({...h.query,...r,token:null!=m?m:null==(b=h.query)?void 0:b.token}),tileServers:this.layer.tileServers,
request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};g._tilemapFromCache=function(b,h,m,r){r.level=b;r.row=h-h%this.size;r.col=m-m%this.size;b=C.tilemapDefinitionId(r);return this._tilemapCache.get(b)};g._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(h=>this._availableLevels[h.level]=!0)};p._createClass(k,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},
set prefetchingEnabled(h){b._prefetchingEnabled=h},hasTilemap(h,m,r){return!!b._tilemapFromCache(h,m,r,b._tmpTilemapDefinition)}}}}]);return k}(n.HandleOwnerMixin(q));v.TilemapCache._maxPrefetch=4;v.TilemapCache._prefetches=new L({initialSize:w._maxPrefetch});c.__decorate([O.property({constructOnly:!0,type:Number})],v.TilemapCache.prototype,"levels",void 0);c.__decorate([V.cast("levels")],v.TilemapCache.prototype,"castLevels",null);c.__decorate([O.property({readOnly:!0,type:Number})],v.TilemapCache.prototype,
"size",null);c.__decorate([O.property({constructOnly:!0,type:Number})],v.TilemapCache.prototype,"cacheByteSize",void 0);c.__decorate([O.property({constructOnly:!0})],v.TilemapCache.prototype,"layer",void 0);c.__decorate([O.property({constructOnly:!0})],v.TilemapCache.prototype,"request",void 0);v.TilemapCache=w=c.__decorate([Y.subclass("esri.layers.support.TilemapCache")],v.TilemapCache);Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/byteSizeEstimations":function(){define(["exports"],
function(v){function p(c){return 32+c.length}v.ByteSizeUnit=void 0;(function(c){c[c.KILOBYTES=1024]="KILOBYTES";c[c.MEGABYTES=1048576]="MEGABYTES";c[c.GIGABYTES=1073741824]="GIGABYTES"})(v.ByteSizeUnit||(v.ByteSizeUnit={}));v.estimateAttributesObjectSize=function(c){if(!c)return 0;let f=32;for(const q in c)if(c.hasOwnProperty(q)){const z=c[q];switch(typeof z){case "string":f+=p(z);break;case "number":f+=16;break;case "boolean":f+=4}}return f};v.estimateFixedArraySize=function(c,f){return 32+c.length*
f};v.estimateNumberByteSize=function(){return 16};v.estimateStringByteSize=p;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(v,p,c,f,q){function z(n){if("vector-tile"===n.service.type)var x=`${n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;else x=n.service.tileServers,x=`${x&&x.length?
x[n.row%x.length]:n.service.url}/tilemap/${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`;(n=n.service.query)&&(x=`${x}?${n}`);return x}let y=function(){function n(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var x=n.prototype;x.getAvailability=function(u,L){if("unknown"!==this._allAvailability)return this._allAvailability;u=(u-this.location.top)*this.location.width+(L-this.location.left);L=u>>3;const K=this._tileAvailabilityBitSet;return 0>
L||L>K.length?"unknown":K[L]&1<<u%8?"available":"unavailable"};x._updateFromData=function(u){let L=!0,K=!0;const U=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let G=0;for(let B=0;B<u.length;B++){const O=B%8;u[B]?(K=!1,U[G]|=1<<O):L=!1;7===O&&++G}K?this._allAvailability="unavailable":L?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=U,this.byteSize+=U.length)};n.fromDefinition=function(u,L){const K=u.service.request||p,{row:U,
col:G,width:B,height:O}=u,M={query:{f:"json"}};L=L?{...M,...L}:M;return K(z(u),L).then(I=>I.data).catch(I=>{if(I&&I.details&&422===I.details.httpStatus)return{location:{top:U,left:G,width:B,height:O},valid:!0,data:c.constant(B*O,0)};throw I;}).then(I=>{if(I.location&&(I.location.top!==U||I.location.left!==G||I.location.width!==B||I.location.height!==O))throw new f("tilemap:location-mismatch","Tilemap response for different location than requested",{response:I,definition:{top:U,left:G,width:B,height:O}});
return n.fromJSON(I)})};n.fromJSON=function(u){n._validateJSON(u);const L=new n;L.location=Object.freeze(q.clone(u.location));L._updateFromData(u.data);return Object.freeze(L)};n._validateJSON=function(u){if(!u||!u.location)throw new f("tilemap:missing-location","Location missing from tilemap response");if(!1===u.valid)throw new f("tilemap:invalid","Tilemap response was marked as invalid");if(!u.data)throw new f("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(u.data))throw new f("tilemap:data-mismatch",
"Data must be an array of numbers");if(u.data.length!==u.location.width*u.location.height)throw new f("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return n}();v.Tilemap=y;v.tilemapDefinitionId=function(n){return`${n.level}/${n.row}/${n.col}/${n.width}/${n.height}`};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(v,p,c,f,q,z,y,n,x,u,L,K,U,G,B,O){v.ArcGISMapService=M=>{M=function(I){function V(){var C=I.apply(this,arguments)||this;C.capabilities=void 0;C.copyright=null;C.fullExtent=null;C.legendEnabled=!0;C.spatialReference=null;C.version=void 0;return C}p._inheritsLoose(V,I);var Y=V.prototype;Y.readCapabilities=function(C,w){var H,d,k=w.capabilities&&w.capabilities.split(",").map(S=>S.toLowerCase().trim());if(!k)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,
supportsTileMap:!1},exportMap:null,exportTiles:null};var g=this.type;C=k.includes("data");const b=k.includes("query"),h=k.includes("map"),m=!!w.exportTilesAllowed;k=k.includes("tilemap");const r="tile"!==g&&!!w.supportsDynamicLayers,A="tile"!==g&&(!w.tileInfo||r),N="tile"!==g&&(!w.tileInfo||r);g="tile"!==g;const Q=w.cimVersion&&y.Version.parse(w.cimVersion),P=null!=(H=null==Q?void 0:Q.since(1,4))?H:!1;H=null!=(d=null==Q?void 0:Q.since(2,0))?d:!1;return{operations:{supportsExportMap:h,supportsExportTiles:m,
supportsIdentify:b,supportsQuery:C,supportsTileMap:k},exportMap:h?{supportsArcadeExpressionForLabeling:P,supportsSublayersChanges:g,supportsDynamicLayers:r,supportsSublayerVisibility:A,supportsSublayerDefinitionExpression:N,supportsCIMSymbols:H}:null,exportTiles:m?{maxExportTilesCount:+w.maxExportTilesCount}:null}};Y.readVersion=function(C,w){(C=w.currentVersion)||(C=w.hasOwnProperty("capabilities")||w.hasOwnProperty("tables")?10:w.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return C};Y.fetchSublayerInfo=
function(){var C=p._asyncToGenerator(function*(w,H){yield this.fetchAllLayersAndTables(H);return this._allLayersAndTablesMap.get(w)});return function(w,H){return C.apply(this,arguments)}}();Y.fetchAllLayersAndTables=function(){var C=p._asyncToGenerator(function*(w){yield this.load(w);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=f(z.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(d=>{this._allLayersAndTablesMap=
new Map;for(const k of d.data.layers)this._allLayersAndTablesMap.set(k.id,k);return{result:d.data}},d=>({error:d})));const H=yield this._allLayersAndTablesPromise;q.throwIfAborted(w);if("result"in H)return H.result;throw H.error;});return function(w){return C.apply(this,arguments)}}();return V}(M);c.__decorate([n.property({readOnly:!0})],M.prototype,"capabilities",void 0);c.__decorate([K.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers",
"tileInfo"])],M.prototype,"readCapabilities",null);c.__decorate([n.property({json:{read:{source:"copyrightText"}}})],M.prototype,"copyright",void 0);c.__decorate([n.property({type:G})],M.prototype,"fullExtent",void 0);c.__decorate([n.property(O.id)],M.prototype,"id",void 0);c.__decorate([n.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],M.prototype,"legendEnabled",void 0);c.__decorate([n.property(O.popupEnabled)],M.prototype,
"popupEnabled",void 0);c.__decorate([n.property({type:B})],M.prototype,"spatialReference",void 0);c.__decorate([n.property({readOnly:!0})],M.prototype,"version",void 0);c.__decorate([K.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],M.prototype,"readVersion",null);return M=c.__decorate([U.subclass("esri.layers.mixins.ArcGISMapService")],M)};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/Version":function(){define(["exports",
"./Error"],function(v,p){let c=function(){function f(z,y,n=""){this.major=z;this.minor=y;this._context=n}var q=f.prototype;q.lessThan=function(z,y){return this.major<z||z===this.major&&this.minor<y};q.since=function(z,y){return!this.lessThan(z,y)};q.validate=function(z){if(this.major!==z.major)throw new p((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:z});
};q.clone=function(){return new f(this.major,this.minor,this._context)};f.parse=function(z,y=""){const [n,x]=z.split(".");var u=/^\s*\d+\s*$/;if(!n||!n.match||!n.match(u))throw new p((y&&y+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:z});if(!x||!x.match||!x.match(u))throw new p((y&&y+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:z});z=parseInt(n,10);u=parseInt(x,10);return new f(z,u,y)};return f}();v.Version=
c;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(v,p,c,f,q,z,y,n,x,u,L,K,U,G,B,O,M){function I(w,H){const d=[],k={};if(!w)return d;w.forEach(g=>{const b=new O;b.read(g,H);k[b.id]=b;null!=g.parentLayerId&&-1!==g.parentLayerId?(g=k[g.parentLayerId],g.sublayers||(g.sublayers=[]),g.sublayers.unshift(b)):d.unshift(b)});return d}function V(w,H){w&&w.forEach(d=>{H(d);d.sublayers&&d.sublayers.length&&V(d.sublayers,H)})}const Y=y.getLogger("esri.layers.TileLayer"),C=f.ofType(O);v.SublayersOwner=w=>{w=function(H){function d(...g){var b=H.call(this,
...g)||this;b.allSublayers=new q({getCollections:()=>[b.sublayers],getChildrenFunction(h){return h.sublayers}});b.sublayersSourceJSON={[B.OriginId.SERVICE]:{},[B.OriginId.PORTAL_ITEM]:{},[B.OriginId.WEB_SCENE]:{},[B.OriginId.WEB_MAP]:{}};b.own(n.watch(()=>b.sublayers,(h,m)=>b._handleSublayersChange(h,m),n.sync));return b}p._inheritsLoose(d,H);var k=d.prototype;k.readSublayers=function(g,b){if(b&&g){var {sublayersSourceJSON:h}=this,m=B.nameToId(b.origin);if(!(m<B.OriginId.SERVICE||(h[m]={context:b,
visibleLayers:g.visibleLayers||h[m].visibleLayers,layers:g.layers||h[m].layers},m>B.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:r,origin:A}=this.createSublayersForOrigin("web-document");g=K.getProperties(this);g.setDefaultOrigin(A);this._set("sublayers",new C(r));g.setDefaultOrigin("user")}}};k.findSublayerById=function(g){return this.allSublayers.find(b=>b.id===g)};k.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
k.createSublayersForOrigin=function(g){const b="web-document"===g?B.nameToId("web-map"):B.nameToId(g);let h=B.OriginId.SERVICE;g=this.sublayersSourceJSON[B.OriginId.SERVICE].layers;let m=this.sublayersSourceJSON[B.OriginId.SERVICE].context,r=null;var A=[B.OriginId.PORTAL_ITEM,B.OriginId.WEB_SCENE,B.OriginId.WEB_MAP].filter(l=>l<=b);for(var N of A)A=this.sublayersSourceJSON[N],M.isSublayerOverhaul(A.layers)&&(h=N,g=A.layers,m=A.context,A.visibleLayers&&(r={visibleLayers:A.visibleLayers,context:A.context}));
N=[B.OriginId.PORTAL_ITEM,B.OriginId.WEB_SCENE,B.OriginId.WEB_MAP].filter(l=>l>h&&l<=b);let Q=null;for(var P of N){const {layers:l,visibleLayers:F,context:W}=this.sublayersSourceJSON[P];l&&(Q={layers:l,context:W});F&&(r={visibleLayers:F,context:W})}P=I(g,m);const S=new Map,D=new Set;if(Q)for(const l of Q.layers)S.set(l.id,l);if(r)for(const l of r.visibleLayers)D.add(l);V(P,l=>{Q&&l.read(S.get(l.id),Q.context);r&&l.read({defaultVisibility:D.has(l.id)},r.context)});return{origin:B.idToName(h),sublayers:new C({items:P})}};
k.read=function(g,b){H.prototype.read.call(this,g,b);this.readSublayers(g,b)};k._handleSublayersChange=function(g,b){b&&(b.forEach(h=>{h.parent=null;h.layer=null}),this.handles.remove("sublayers-owner"));g&&(g.forEach(h=>{h.parent=this;h.layer=this}),this.handles.add([g.on("after-add",({item:h})=>{h.parent=this;h.layer=this}),g.on("after-remove",({item:h})=>{h.parent=null;h.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(g.on("before-changes",h=>{Y.error(new z("tilelayer:sublayers-non-modifiable",
"ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));h.preventDefault()}),"sublayers-owner"))};return d}(w);c.__decorate([x.property({readOnly:!0})],w.prototype,"allSublayers",void 0);c.__decorate([x.property({readOnly:!0,type:f.ofType(O)})],w.prototype,"serviceSublayers",void 0);c.__decorate([x.property({value:null,type:C,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],w.prototype,"sublayers",void 0);c.__decorate([x.property({readOnly:!0})],w.prototype,"sublayersSourceJSON",
void 0);return w=c.__decorate([G.subclass("esri.layers.mixins.SublayersOwner")],w)};v.forEachSublayer=V;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./arcgisLayerUrl ./FeatureType ./Field ./FieldsIndex ./LabelClass ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent".split(" "),
function(v,p,c,f,q,z,y,n,x,u,L,K,U,G,B,O,M,I,V,Y,C,w,H,d,k,g,b,h,m,r,A,N,Q,P,S,D,l,F,W,Z,ba,ka,da,la,qa,va,wa){function ma(T){return T&&"esriSMS"===T.type}function na(T,aa,E){var a;T=this.originIdOf(aa)>=D.nameToId(E.origin);return{ignoreOrigin:!0,allowNull:T,enabled:E?"map-image"===(null==(a=E.layer)?void 0:a.type)&&(E.writeSublayerStructure||T):!1}}function ra(T,aa,E){var a;return{enabled:E?"tile"===(null==(a=E.layer)?void 0:a.type)&&this._isOverridden(aa):!1}}function ca(T,aa,E){return{ignoreOrigin:!0,
enabled:E&&E.writeSublayerStructure||!1}}function ia(T,aa,E){return{ignoreOrigin:!0,enabled:E?E.writeSublayerStructure||this.originIdOf(aa)>=D.nameToId(E.origin):!1}}const sa=T=>Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));var ja;const oa=d.getLogger("esri.layers.support.Sublayer");let xa=0;const fa=new Set;fa.add("layer");fa.add("parent");fa.add("loaded");fa.add("loadStatus");fa.add("loadError");fa.add("loadWarnings");f=ja=function(T){function aa(a){a=
T.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}p._inheritsLoose(aa,T);var E=aa.prototype;E.load=function(){var a=p._asyncToGenerator(function*(e){var t=this;this.addResolvingPromise(p._asyncToGenerator(function*(){var J;if(!t.layer&&!t.url)throw new V("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",
{sublayer:t});let R=null;if(!t.layer||t.originIdOf("url")>D.OriginId.SERVICE||"data-layer"===(null==(J=t.source)?void 0:J.type))R=(yield O(t.url,{responseType:"json",query:{f:"json"},...e})).data;else{var X;J=t.id;"map-layer"===(null==(X=t.source)?void 0:X.type)&&(J=t.source.mapLayerId);R=yield t.layer.fetchSublayerInfo(J,e)}R&&(t.sourceJSON=R,t.read({layerDefinition:R},{origin:"service"}))})());return this});return function(e){return a.apply(this,arguments)}}();E.readCapabilities=function(a,e){e=
e.layerDefinition||e;a=(a=e.capabilities||a)?a.toLowerCase().split(",").map(J=>J.trim()):[];const t=this.url?l.parse(this.url):null;a=a.includes(k.isSome(t)&&"MapServer"===t.serverType?"data":"query");return{exportMap:{supportsModification:!!e.canModifyLayer},operations:{supportsQuery:a}}};E.readGlobalIdFieldFromService=function(a,e){e=e.layerDefinition||e;if(e.globalIdField)return e.globalIdField;if(e.fields)for(const t of e.fields)if("esriFieldTypeGlobalID"===t.type)return t.name};E.writeLabelingInfo=
function(a,e,t,J){a&&a.length&&(e.layerDefinition={drawingInfo:{labelingInfo:a.map(R=>R.write({},J))}})};E.readMinScale=function(a,e){return e.minScale||e.layerDefinition&&e.layerDefinition.minScale||0};E.readMaxScale=function(a,e){return e.maxScale||e.layerDefinition&&e.layerDefinition.maxScale||0};E.readObjectIdFieldFromService=function(a,e){e=e.layerDefinition||e;if(e.objectIdField)return e.objectIdField;if(e.fields)for(const t of e.fields)if("esriFieldTypeOID"===t.type)return t.name};E.readOpacity=
function(a,e){a=e.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};E.writeOpacity=function(a,e,t,J){e.layerDefinition={drawingInfo:{transparency:100-100*a}}};E.writeParent=function(a,e){e.parentLayerId=this.parent&&this.parent!==this.layer?S.ensureInteger(this.parent.id):-1};E.castSublayers=function(a){return S.ensureType(I.ofType(ja),a)};E.writeSublayers=function(a,e,t){this.get("sublayers.length")&&(e[t]=this.sublayers.map(J=>J.id).toArray().reverse())};
E.readTypeIdField=function(a,e){e=e.layerDefinition||e;let t=e.typeIdField;t&&e.fields&&(t=t.toLowerCase(),a=e.fields.find(J=>J.name.toLowerCase()===t))&&(t=a.name);return null};E.writeVisible=function(a,e,t,J){e[t]=this.getAtOrigin("defaultVisibility","service")||a};E.clone=function(){const {store:a}=r.getProperties(this),e=new ja;r.getProperties(e).store=a.clone(fa);this.commitProperty("url");e._lastParsedUrl=this._lastParsedUrl;return e};E.createPopupTemplate=function(a){return va.createPopupTemplate(this,
a)};E.createQuery=function(){return new qa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};E.createFeatureLayer=function(){var a=p._asyncToGenerator(function*(){var e,t;if(this.hasOwnProperty("sublayers"))return null;const J=null==(e=this.layer)?void 0:e.parsedUrl;e=new (yield new Promise((R,X)=>v(["../FeatureLayer"],ea=>R(sa(ea)),X))).default({url:J.path});J&&this.source&&("map-layer"===this.source.type?e.layerId=this.source.mapLayerId:e.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&
(e.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(e.definitionExpression=this.definitionExpression);this.floorInfo&&(e.floorInfo=w.clone(this.floorInfo));this.originIdOf("labelingInfo")>D.OriginId.SERVICE&&(e.labelingInfo=w.clone(this.labelingInfo));this.originIdOf("labelsVisible")>D.OriginId.DEFAULTS&&(e.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>D.OriginId.DEFAULTS&&(e.legendEnabled=this.legendEnabled);this.originIdOf("visible")>D.OriginId.DEFAULTS&&
(e.visible=this.visible);this.originIdOf("minScale")>D.OriginId.DEFAULTS&&(e.minScale=this.minScale);this.originIdOf("maxScale")>D.OriginId.DEFAULTS&&(e.maxScale=this.maxScale);this.originIdOf("opacity")>D.OriginId.DEFAULTS&&(e.opacity=this.opacity);this.originIdOf("popupTemplate")>D.OriginId.DEFAULTS&&(e.popupTemplate=w.clone(this.popupTemplate));this.originIdOf("renderer")>D.OriginId.SERVICE&&(e.renderer=w.clone(this.renderer));"data-layer"===(null==(t=this.source)?void 0:t.type)&&(e.dynamicDataSource=
this.source.clone());this.originIdOf("title")>D.OriginId.DEFAULTS&&(e.title=this.title);"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>D.OriginId.DEFAULTS&&(e.customParameters=this.layer.customParameters);"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>D.OriginId.DEFAULTS&&(e.customParameters=this.layer.customParameters);return e});return function(){return a.apply(this,arguments)}}();E.getField=function(a){return this.fieldsIndex.get(a)};E.getFeatureType=
function(a){const {typeIdField:e,types:t}=this;if(!e||!a)return null;const J=a.attributes?a.attributes[e]:void 0;if(null==J)return null;let R=null;t.some(X=>{const {id:ea}=X;if(null==ea)return!1;ea.toString()===J.toString()&&(R=X);return!!R});return R};E.getFieldDomain=function(a,e){return(e=this.getFeatureType(e&&e.feature))&&(e=e.domains&&e.domains[a])&&"inherited"!==e.type?e:this._getLayerDomain(a)};E.queryFeatures=function(){var a=p._asyncToGenerator(function*(e=this.createQuery(),t){var J,R,
X,ea,ta,ua;yield this.load();if(null==(J=this.capabilities)||null==(R=J.operations)||!R.supportsQuery)throw new V("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:ya},{default:za}]=yield Promise.all([new Promise((ha,pa)=>v(["../../rest/query/operations/query"],ha,pa)),new Promise((ha,pa)=>v(["../../rest/support/FeatureSet"],Aa=>ha(sa(Aa)),pa))]);e=yield ya(this.url,qa.from(e),null!=(X=null==(ea=this.layer)?void 0:ea.spatialReference)?X:null,{...t,query:{...null==
(ta=this.layer)?void 0:ta.customParameters,token:null==(ua=this.layer)?void 0:ua.apiKey}});X=za.fromJSON(e.data);if(null!=X&&X.features)for(const ha of X.features)ha.sourceLayer=this;return X});return function(){return a.apply(this,arguments)}}();E.toExportImageJSON=function(a){var e;const t={id:this.id,source:(null==(e=this.source)?void 0:e.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};a=b.sqlAnd(a,this.definitionExpression);k.isSome(a)&&(t.definitionExpression=a);const J=["renderer","labelingInfo",
"opacity","labelsVisible"].reduce((R,X)=>{R[X]=this.originIdOf(X);return R},{});Object.keys(J).some(R=>J[R]>D.OriginId.SERVICE)&&(a=t.drawingInfo={},J.renderer>D.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null),J.labelsVisible>D.OriginId.SERVICE&&(a.showLabels=this.labelsVisible),this.labelsVisible&&J.labelingInfo>D.OriginId.SERVICE&&(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(R=>R.write({},{origin:"service",layer:this.layer})):null,a.showLabels=!0),J.opacity>D.OriginId.SERVICE&&
(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));return t};E._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,e=>{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.color=e.outline&&e.outline.color?e.outline.color:[0,0,0,0])})};E._forEachSimpleMarkerSymbols=function(a,e){if(a){const t="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const J of t)ma(J.symbol)&&e(J.symbol);"symbol"in a&&ma(a.symbol)&&
e(a.symbol);"defaultSymbol"in a&&ma(a.defaultSymbol)&&e(a.defaultSymbol)}};E._setAndNotifyLayer=function(a,e){const t=this.layer,J=this._get(a);let R,X;switch(a){case "definitionExpression":case "floorInfo":R="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":R="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":R="supportsDynamicLayers",X="supportsModification"}const ea=r.getProperties(this).getDefaultOrigin();
if("service"!==ea){if(R&&!1===this.get(`layer.capabilities.exportMap.${R}`)){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${R}'`);return}if(X&&!1===this.get(`capabilities.exportMap.${X}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${X}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,e),"service"!==ea&&J!==e&&t&&t.emit&&t.emit("sublayer-update",
{propertyName:a,target:this}))};E._handleSublayersChange=function(a,e){e&&(e.forEach(t=>{t.parent=null;t.layer=null}),this.handles.removeAll());a&&(a.forEach(t=>{t.parent=this;t.layer=this.layer}),this.handles.add([a.on("after-add",({item:t})=>{t.parent=this;t.layer=this.layer}),a.on("after-remove",({item:t})=>{t.parent=null;t.layer=null}),a.on("before-changes",t=>{const J=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==J||J||(oa.error(new V("sublayer:sublayers-non-modifiable",
"Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),t.preventDefault())})]))};E._logLockedError=function(a,e){oa.error(new V("sublayer:locked",`Property '${String(a)}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:e,sublayer:this,layer:this.layer}))};E._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};p._createClass(aa,[{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",
a)}},{key:"fieldsIndex",get:function(){return new Z(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?xa++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",
a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(e=>e.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:e}=this;return{minScale:a,maxScale:e}}},
{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const e of a.getSymbols())if(M.isSymbol3D(e)){oa.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new la.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",
set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){var a,e;const t=null!=(a=null==(e=this.layer)?void 0:e.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!t)return null;this._lastParsedUrl=t;if("map-layer"===(null==a?void 0:a.type))return`${t.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${t.path}/dynamicLayer?${h.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},
{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return aa}(Y.HandleOwnerMixin(g.MultiOriginJSONMixin(C.IdentifiableMixin(H))));f.test={isMapImageLayerOverridePolicy:T=>T===ca||T===na,isTileImageLayerOverridePolicy:T=>T===ra};c.__decorate([m.property({readOnly:!0})],f.prototype,"capabilities",void 0);c.__decorate([N.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],f.prototype,"readCapabilities",null);c.__decorate([m.property({type:String,
value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:na}}})],f.prototype,"definitionExpression",null);c.__decorate([m.property({type:[W],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],f.prototype,"fields",void 0);c.__decorate([m.property({readOnly:!0})],f.prototype,"fieldsIndex",null);c.__decorate([m.property({type:ka,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",
overridePolicy:na},origins:{"web-scene":{read:!1,write:!1}}}})],f.prototype,"floorInfo",null);c.__decorate([m.property({type:wa,json:{read:{source:"layerDefinition.extent"}}})],f.prototype,"fullExtent",void 0);c.__decorate([m.property({type:String})],f.prototype,"globalIdField",void 0);c.__decorate([N.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],f.prototype,"readGlobalIdFieldFromService",null);c.__decorate([m.property({type:S.Integer,json:{write:{ignoreOrigin:!0}}})],
f.prototype,"id",null);c.__decorate([m.property({value:null,type:[ba],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ca}}})],f.prototype,"labelingInfo",null);c.__decorate([P.writer("labelingInfo")],f.prototype,"writeLabelingInfo",null);c.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ca}}})],
f.prototype,"labelsVisible",null);c.__decorate([m.property({value:null})],f.prototype,"layer",null);c.__decorate([m.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ia}}})],f.prototype,"legendEnabled",void 0);c.__decorate([m.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],f.prototype,"listMode",null);c.__decorate([m.property({type:Number,
value:0,json:{write:{overridePolicy:ca}}})],f.prototype,"minScale",null);c.__decorate([N.reader("minScale",["minScale","layerDefinition.minScale"])],f.prototype,"readMinScale",null);c.__decorate([m.property({type:Number,value:0,json:{write:{overridePolicy:ca}}})],f.prototype,"maxScale",null);c.__decorate([N.reader("maxScale",["maxScale","layerDefinition.maxScale"])],f.prototype,"readMaxScale",null);c.__decorate([m.property({readOnly:!0})],f.prototype,"effectiveScaleRange",null);c.__decorate([m.property({type:String})],
f.prototype,"objectIdField",void 0);c.__decorate([N.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],f.prototype,"readObjectIdFieldFromService",null);c.__decorate([m.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ca}}})],f.prototype,"opacity",null);c.__decorate([N.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],f.prototype,"readOpacity",null);c.__decorate([P.writer("opacity")],
f.prototype,"writeOpacity",null);c.__decorate([m.property({json:{type:S.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:ca}}})],f.prototype,"parent",void 0);c.__decorate([P.writer("parent")],f.prototype,"writeParent",null);c.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(T,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:ia,writer(T,aa,E){aa[E]=!T}}}})],f.prototype,"popupEnabled",void 0);c.__decorate([m.property({type:q,
json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ia}}})],f.prototype,"popupTemplate",void 0);c.__decorate([m.property({readOnly:!0})],f.prototype,"defaultPopupTemplate",null);c.__decorate([m.property({types:B.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca},origins:{"web-scene":{types:B.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca}}}}})],f.prototype,"renderer",null);c.__decorate([m.property({types:{key:"type",
base:null,typeMap:{"data-layer":da.DataLayerSource,"map-layer":la.MapLayerSource}},cast(T){if(T){if("mapLayerId"in T)return S.ensureClass(la.MapLayerSource,T);if("dataSource"in T)return S.ensureClass(da.DataLayerSource,T)}return T},json:{name:"layerDefinition.source",write:{overridePolicy:ca}}})],f.prototype,"source",null);c.__decorate([m.property()],f.prototype,"sourceJSON",void 0);c.__decorate([m.property({value:null,json:{type:[S.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ca}}})],
f.prototype,"sublayers",null);c.__decorate([A.cast("sublayers")],f.prototype,"castSublayers",null);c.__decorate([P.writer("sublayers")],f.prototype,"writeSublayers",null);c.__decorate([m.property({type:String,json:{name:"name",write:{overridePolicy:ia}}})],f.prototype,"title",void 0);c.__decorate([m.property({type:String})],f.prototype,"typeIdField",void 0);c.__decorate([N.reader("typeIdField",["layerDefinition.typeIdField"])],f.prototype,"readTypeIdField",null);c.__decorate([m.property({type:[F],
json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],f.prototype,"types",void 0);c.__decorate([m.property({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:ra}}})],f.prototype,"url",null);c.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ca}}})],f.prototype,"visible",null);c.__decorate([P.writer("visible")],f.prototype,"writeVisible",null);return f=ja=c.__decorate([Q.subclass("esri.layers.support.Sublayer")],
f)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(v,p,c){function f(q,z){if(!q||!q.length||p.isNone(z))return!0;z=z.slice().reverse().flatten(({sublayers:x})=>x&&x.toArray().reverse()).map(x=>x.id).toArray();if(q.length>z.length)return!1;let y=0;const n=z.length;for(const {id:x}of q){for(;y<n&&z[y]!==x;)y++;if(y>=n)return!1}return!0}v.isExportDynamic=function(q,z,y){return q.some(n=>{const x=n.source;return!(!x||
"map-layer"===x.type&&x.mapLayerId===n.id&&(p.isNone(x.gdbVersion)||x.gdbVersion===y))||n.originIdOf("renderer")>c.OriginId.SERVICE||n.originIdOf("labelingInfo")>c.OriginId.SERVICE||n.originIdOf("opacity")>c.OriginId.SERVICE||n.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!f(q,z)};v.isSublayerOverhaul=function(q){return!!q&&q.some(z=>null!=z.minScale||z.layerDefinition&&null!=z.layerDefinition.minScale)};v.shouldWriteSublayerStructure=function(q,z,y){return z.flatten(({sublayers:n})=>n).length!==
q.length||q.some(n=>n.originIdOf("minScale")>y||n.originIdOf("maxScale")>y||n.originIdOf("renderer")>y||n.originIdOf("labelingInfo")>y||n.originIdOf("opacity")>y||n.originIdOf("labelsVisible")>y||n.originIdOf("source")>y)?!0:!f(q,z)};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})}}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),function(v,
p,c,f,q,z,y,n,x,u,L,K,U,G,B,O,M,I,V,Y,C,w,H,d,k,g,b,h,m,r,A,N){const Q="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");q=function(P){function S(...l){l=
P.call(this,...l)||this;l.listMode="show";l.isReference=null;l.operationalLayerType="ArcGISTiledMapServiceLayer";l.resampling=!0;l.sourceJSON=null;l.spatialReference=null;l.path=null;l.sublayers=null;l.type="tile";l.url=null;return l}v._inheritsLoose(S,P);var D=S.prototype;D.normalizeCtorArgs=function(l,F){return"string"===typeof l?{url:l,...F}:l};D.load=function(l){const F=z.isSome(l)?l.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},l).catch(n.throwIfAbortError).then(()=>
this._fetchService(F)));return Promise.resolve(this)};D.readSpatialReference=function(l,F){return(l=l||F.tileInfo&&F.tileInfo.spatialReference)&&M.fromJSON(l)};D.writeSublayers=function(l,F,W,Z){if(this.loaded&&l){l=l.slice().reverse().flatten(({sublayers:da})=>da&&da.toArray().reverse()).toArray();var ba=[],ka={writeSublayerStructure:!1,...Z};l.forEach(da=>{da=da.write({},ka);ba.push(da)});ba.some(da=>1<Object.keys(da).length)&&(F.layers=ba)}};D.castTileServers=function(l){return Array.isArray(l)?
l.map(F=>x.urlToObject(F).path):null};D.fetchTile=function(l,F,W,Z={}){({signal:Z}=Z);l=this.getTileUrl(l,F,W);return c(l,{responseType:"image",signal:Z,query:{...this.refreshParameters}}).then(ba=>ba.data)};D.getTileUrl=function(l,F,W){const Z=x.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ba=this.tileServers;return`${ba&&ba.length?ba[F%ba.length]:this.parsedUrl.path}/tile/${l}/${F}/${W}${Z?"?"+Z:
""}`};D._fetchService=function(l){return(new Promise((F,W)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new f("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");F({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new f("tile-layer:undefined-url","layer's url is not defined");var Z=r.parse(this.parsedUrl.path);if(z.isSome(Z)&&"ImageServer"===Z.serverType)throw new f("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:l}).then(F,W)}})).then(F=>{F.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=F.data;this.read(F.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!r.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,l).then(W=>{this.read({currentVersion:W})}).catch(()=>{})})};D._fetchServerVersion=function(l,F){if(!r.isArcGISUrl(l))return Promise.reject();
l=l.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(l,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:F}).then(W=>{if(W.data&&W.data.currentVersion)return W.data.currentVersion;throw new f("tile-layer:version-not-available");})};D._getMapName=function(l){return(l=l.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&l[2]};D._getDefaultAttribution=
function(l){if(l){l=l.toLowerCase();for(let W=0,Z=Q.length;W<Z;W++){var F=Q[W];if(F.toLowerCase().includes(l))return x.makeAbsolute("//static.arcgis.com/attribution/"+F)}}};D._getDefaultTileServers=function(l){const F=-1!==l.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),W=-1!==l.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return F||W?[l,l.replace(F?/server\.arcgisonline/i:/services\.arcgisonline/i,F?"services.arcgisonline":"server.arcgisonline")]:[]};v._createClass(S,[{key:"attributionDataUrl",
get:function(){var l;const F=null==(l=this.parsedUrl)?void 0:l.path.toLowerCase();return F&&this._getDefaultAttribution(this._getMapName(F))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return S}(H.BlendLayer(m.SublayersOwner(h.ScaleRangeLayer(k.OperationalLayer(g.PortalLayer(Y.ArcGISCachedService(C.ArcGISMapService(w.ArcGISService(y.MultiOriginJSONMixin(q.HandleOwnerMixin(b.RefreshableLayer(V.APIKeyMixin(d.CustomParametersMixin(I))))))))))))));
p.__decorate([u.property({readOnly:!0})],q.prototype,"attributionDataUrl",null);p.__decorate([u.property({type:["show","hide","hide-children"]})],q.prototype,"listMode",void 0);p.__decorate([u.property({json:{read:!0,write:!0}})],q.prototype,"blendMode",void 0);p.__decorate([u.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],q.prototype,"isReference",void 0);p.__decorate([u.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],q.prototype,"operationalLayerType",
void 0);p.__decorate([u.property({type:Boolean})],q.prototype,"resampling",void 0);p.__decorate([u.property()],q.prototype,"sourceJSON",void 0);p.__decorate([u.property({type:M})],q.prototype,"spatialReference",void 0);p.__decorate([G.reader("spatialReference",["spatialReference","tileInfo"])],q.prototype,"readSpatialReference",null);p.__decorate([u.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],q.prototype,"path",void 0);p.__decorate([u.property({readOnly:!0})],
q.prototype,"sublayers",void 0);p.__decorate([O.writer("sublayers",{layers:{type:[N]}})],q.prototype,"writeSublayers",null);p.__decorate([u.property({json:{read:!1,write:!1}})],q.prototype,"popupEnabled",void 0);p.__decorate([u.property()],q.prototype,"tileServers",null);p.__decorate([U.cast("tileServers")],q.prototype,"castTileServers",null);p.__decorate([u.property({readOnly:!0,json:{read:!1}})],q.prototype,"type",void 0);p.__decorate([u.property(A.url)],q.prototype,"url",void 0);q=p.__decorate([B.subclass("esri.layers.TileLayer")],
q);q.prototype.fetchTile.__isDefault__=!0;return q});