var HighChartFactory=function(n,t,i,r,u){this.id=n;this.targetPrefix=t;this.target=this.targetPrefix+"container";this.chartOptions=i;this.isOpen=r;this.languageID=u;this.languageID==null&&(this.languageID=0);this.callback=null;this.cancelled=null;this.meta=null;this.data=null;this.preparedData=null;this.dateFormat=null;this.chartData=null;this.description=null;this.defaultPaletteString="sectcijf";this.injectedSelections={};this.injectedSelectionColumns=[];this.seriesDimension=null;this.secondarySeriesDimension=null;this.markerDimension=null;this.categoryDimension=null;this.geoDimension=null;this.valueDimension=null;this.timeDimension=null;this.multiSelectionColumnIndex=null;this.keyDimensions=[];this.chartDimensions=[];this.reducableDimensions=[];this.extendedCategoryItem=null;this.minimized=!1;this.error=null;this.errorCode=null;this.chart=null;this.singleSelectionDimension=null;this.subTitleExtension=null;this.exporting=!0;this.borderWidth=0;this.setDefaultPaletteString=function(n){n!=null&&(this.defaultPaletteString=n)};this.getFunc=function(){return this.chartOptions!=null&&!_.isUndefined(this.chartOptions.func)?this.chartOptions.func.substring(1):"drawHighChart"}};HighChartFactory.prototype.theme={labelFontSize:"11px",axisFontSize:"9px",titleFontSize:"12px",titleFontWeight:"bold",subtitleFontSize:"11px",creditsFontSize:"9px",tooltipFontSize:"10px",legendFontSize:"10px",exportFontSize:"10px",mapNavigationFontSize:"7px",legendItemMarginTop:2,legendItemMarginBottom:2};HighChartFactory.prototype.basicChartTypes=["areaspline","area","column","line","spline","bar","scatter","masterdetail","map","bipartite"];HighChartFactory.prototype.dutchnumbers=["","tien","honderd","duizend","miljoen","miljard","biljoen","biljard"];HighChartFactory.prototype.englishnumbers=["","ten","hundred","thousand","million","billion","trillion","quadrillion"];HighChartFactory.prototype.hostName="dataservice.wecr.wur.nl";HighChartFactory.prototype.initialize=function(n,t,i){this.initializeTarget();var f=this.isOpen?"/MetaBaseOpenServices/RestServices.svc":"/MetaBaseServices/RestServicesProtected.svc",e=t!=null?t:"/data/combined/cached/json/",o=i!=null?i:"?id="+this.id+"&lang="+this.languageID,s="https://"+this.hostName+f+e+o,r=this;jQuery.support.cors=!0;try{$.ajax({url:s,cache:!1,dataType:"json",type:"GET",xhrFields:{withCredentials:!this.isOpen},error:function(t,i,u){r.errorCode=t.status;r.error==null&&(r.error=u);n(r)},success:function(t){r.handleData(t[Object.keys(t)[0]],n)}})}catch(u){this.errorCode=u.number;this.error=u;n(this)}finally{$("body").css("cursor","default")}};HighChartFactory.prototype.getURLParam=function(n,t){for(var r,u=n.split("&"),i=0;i<u.length;i++)if(r=u[i].split("="),r[0]==t)return r[1]};HighChartFactory.prototype.handleData=function(n,t){try{this.storeResults(n,t);this.checkAndPrepareForCharting(t)}catch(i){this.errorCode=i.number;this.error=i;t(this)}finally{$("body").css("cursor","default")}};HighChartFactory.prototype.initializeNoCache=function(n){this.initialize(n,"/data/combined/json/")};HighChartFactory.prototype.initializeForBinternet=function(n,t,i){this.isOpen=!1;this.subTitleExtension=t;this.initialize(n,"/data/binternet/json/","?id="+this.id+"&bn="+t+"&uds="+i)};HighChartFactory.prototype.initializeWithData=function(n,t){this.initializeTarget();this.handleData(t,n)};HighChartFactory.prototype.initializeTarget=function(){$('<div id="'+this.targetPrefix+'boxes" class="boxes"><\/div>').appendTo($("#"+this.targetPrefix));$('<div id="'+this.targetPrefix+'container" class="plot"><\/div>').appendTo($("#"+this.targetPrefix));$("body").css("cursor","progress");this.cancelled=!1};HighChartFactory.prototype.storeResults=function(n,t){var f,e,i,r,u;try{if(this.meta=n.DataSet.MetaInformation,this.data=n.DataSet.Data.slice(),this.callback=t,this.timeDimension=_.findWhere(this.meta.Columns,{IsTime:!0}),this.timeDimension!=null&&(this.timeDimension.columnIndex=this.meta.Columns.indexOf(this.timeDimension)),f=_.where(this.meta.Columns,{IsGeo:!0}),f.length==1&&(this.geoDimension=f[0]),this.geoDimension!=null&&(this.geoDimension.columnIndex=this.meta.Columns.indexOf(this.geoDimension)),this.valueDimension=_.findWhere(this.meta.Columns,{IsValue:!0}),this.valueDimension!=null)for(this.valueDimension.columnIndex=this.meta.Columns.indexOf(this.valueDimension),e=this.data.length,i=0;i<e;i++)this.data[i][this.valueDimension.columnIndex]=this.data[i][this.valueDimension.columnIndex]?+this.data[i][this.valueDimension.columnIndex]:null;this.description=n.Description;r=null;u=this;$.each(this.injectedSelections,function(n,t){var i=parseInt(n),f=_.findWhere(u.meta.Columns,{ClassificationID:parseInt(n)});r=_.findWhere(u.meta.Columns,{ClassificationID:parseInt(n)});r.selections=t;u.injectedSelectionColumns.push(r)})}catch(o){throw"Webservice call failed";}if(this.data==undefined)throw"Webservice did not return data";};HighChartFactory.prototype.checkAndPrepareForCharting=function(n){this.checkOptions();this.prepareForCharting(n)};HighChartFactory.prototype.checkOptions=function(){if(_.isUndefined(this.meta.DefaultChartOptions)||(this.chartOptions=JSON.parse(this.meta.DefaultChartOptions)),this.chartOptions==null)throw new Error(999,"No options specified");if(_.isUndefined(this.chartOptions.legend)&&(this.chartOptions.legend={}),this.chartOptions.legend.itemStyle={fontSize:this.theme.legendFontSize,fontWeight:"normal"},this.chartOptions.legend.borderWidth=1,this.chartOptions.legend.borderRadius=2,this.chartOptions.legend.symbolRadius=0,this.chartOptions.legend.itemMarginBottom=this.theme.legendItemMarginBottom,this.chartOptions.legend.itemMarginTop=this.theme.legendItemMarginTop,_.isUndefined(this.chartOptions.chartType))throw"No chart type specified in options";if(_.isUndefined(this.chartOptions.func))throw"No plotting function specified in options";if(_.isUndefined(this.chartOptions.dimensions))throw"No dimensions specified in options";if(this.meta.Columns.length!=this.chartOptions.dimensions.length+1)throw new Error(200,"Data dimensionality differs from options");};HighChartFactory.prototype.prepareForCharting=function(n){this.setDimensionTypes();this.setInitialSelections();this.createNamesDict();this.prepareData();this.createGUI();this.buildChartData();this.cancelled||(n(this),this.minimized||this.setToolTips())};HighChartFactory.prototype.setDimensionTypes=function(){var t,n=this;$.each(this.chartOptions.dimensions,function(i,r){if(t=n.meta.Columns[i],r.column=t,n.multiSelectionColumnIndex==i){t.columnIndex=i;n.keyDimensions.push(t);return}if(!_.isUndefined(r.series)){n.seriesDimension=t;n.seriesDimension.columnIndex=i;n.keyDimensions.push(t);return}if(!_.isUndefined(r.marker)){n.markerDimension=t;marker=n.chartOptions.dimensions[i].marker;n.markerDimension.columnIndex=i;n.keyDimensions.push(t);return}if(!_.isUndefined(r.category)){n.categoryDimension=t;n.geoDimension==null&&t.IsGeo&&(n.geoDimension=t,n.geoDimension.columnIndex=i);_.isUndefined(r.date)||(n.dateFormat=r.date);n.categoryDimension.columnIndex=i;n.keyDimensions.push(t);return}if(!_.isUndefined(r.secondarySeries)){n.secondarySeriesDimension=t;n.secondarySeriesDimension.columnIndex=i;n.keyDimensions.push(t);return}if(n.meta.Columns[i].IsGeo&&!_.isUndefined(n.meta.Map)){n.keyDimensions.push(t);return}n.reducableDimensions.push(t)})};HighChartFactory.prototype.setInitialSelections=function(){var n,t=this;$.each(this.meta.Columns,function(i,r){var e,u,f;r.IsValue||t.injectedSelectionColumns.indexOf(r)>=0||(n=t.chartOptions.dimensions[i],r.selections=_.isUndefined(n.initialSelection)?[]:n.initialSelection,_.isEmpty(r.selections)||(e=_.uniq(t.data.map(function(n){return n[i]})),u=[],$.each(r.UniqueElements,function(n,t){e.indexOf(t[0])<0||u.push(t)}),r.UniqueElements=u,r.selections[0].substring(0,1)=="%"&&(f=r.UniqueElements.length-r.selections[0].substring(1,r.selections[0].length)-1,f>=0&&(r.selections=[r.UniqueElements[f][0]]))))})};HighChartFactory.prototype.createNamesDict=function(){var n=this,r,i,t;_.isUndefined(this.chartOptions.dimensions[this.categoryDimension.columnIndex].extendLastWith)||this.chartOptions.dimensions[this.categoryDimension.columnIndex].extendLastWith==""||(r=_.uniq(this.data.map(function(t){return t[n.categoryDimension.columnIndex]})),i=[],$.each(this.categoryDimension.UniqueElements,function(n,t){r.indexOf(t[0])<0||i.push(t)}),this.categoryDimension.UniqueElements=i,this.extendedCategoryItem=this.categoryDimension.UniqueElements[this.categoryDimension.UniqueElements.length-1][1],this.categoryDimension.UniqueElements[this.categoryDimension.UniqueElements.length-1][1]=this.extendedCategoryItem+" "+this.chartOptions.dimensions[this.categoryDimension.columnIndex].extendLastWith);$.each(this.meta.Columns,function(i,r){var f,u;r.IsValue||(u={},t={},f=!_.isUndefined(n.chartOptions.dimensions[i].names),f&&$.each(n.chartOptions.dimensions[i].names,function(n,i){t[i.name]=i.displayname}),_.isEmpty(r.UniqueElements)&&(u=_.uniq(n.data.map(function(n){return n[i]})),$.each(u,function(n,t){r.UniqueElements.push([t,t])})),$.each(r.UniqueElements,function(n,i){u[i[0]]=i[1];f&&t[i[0]]!=null&&(u[i[0]]=t[i[0]])}),r.namesDictionary=u)})};HighChartFactory.prototype.prepareData=function(){this.preparedData=this.subsetAndRescale();var n=this;$.each(this.meta.Columns,function(t,i){i.IsValue||(i.currentElements=_.isEmpty(i.selections)?_.uniq(n.preparedData.map(function(n){return n[t]})):i.selections,i.currentElements=_.sortBy(i.currentElements,function(n){return+n}))});this.preparedData=this.summarise()};HighChartFactory.prototype.subsetAndRescale=function(){var u=[],f={},e={},i,n,r,o,t;for($.each(this.chartOptions.dimensions[this.seriesDimension.columnIndex].series,function(n,t){_.isUndefined(t.multiplier)||(f[t.name]=t.multiplier);!_.isUndefined(t.changeSign)&&t.changeSign&&(e[t.name]=-1)}),o=this.data.length,t=0;t<o;t++)(r=this.data[t],i=!0,$.each(this.meta.Columns,function(n,t){_.isEmpty(t.selections)||_.contains(t.selections,r[n])||(i=!1)}),i)&&(n=r.slice(0),multiplier=f[n[this.seriesDimension.columnIndex]]||1,sign=e[n[this.seriesDimension.columnIndex]]||1,n[this.valueDimension.columnIndex]!=0&&(n[this.valueDimension.columnIndex]=n[this.valueDimension.columnIndex]?n[this.valueDimension.columnIndex]*multiplier*sign:null),u.push(n));return u};HighChartFactory.prototype.summarise=function(){var e=[],r,n=this,u,i,f,o,s,t;for(this.multiSelectionColumnIndex==null&&this.injectedSelectionColumn!=null&&this.injectedSelectionElements!=null&&this.injectedSelectionElements.length>1&&(this.mergeSelectionAndSeries(this.injectedSelectionColumn.columnIndex,this.seriesDimension.columnIndex),u=[],this.seriesDimension.elementMappings={},$.each(this.seriesDimension.currentElements,function(t,r){$.each(n.injectedSelectionColumn.currentElements,function(t,f){i=r+" ("+f+")";u.push(i);n.seriesDimension.elementMappings[i]=r;n.seriesDimension.namesDictionary[i]=n.seriesDimension.namesDictionary[r]+" ("+f+")"})}),this.seriesDimension.currentElements=u),f=this.keyDimensions.slice(0),f.push(this.valueDimension),this.chartDimensions=[],s=this.preparedData.length,t=0;t<s;t++)o=this.preparedData[t],r=[],$.each(f,function(i,u){(r.push(o[u.columnIndex]),t>0)||n.chartDimensions.push(u)}),e.push(r);return e};HighChartFactory.prototype.mergeSelectionAndSeries=function(n,t){for(var r=this.preparedData.length,i=0;i<r;i++)this.preparedData[i][t]=this.preparedData[i][t]+" ("+this.preparedData[i][n]+")"};HighChartFactory.prototype.createGUI=function(){var n="#"+this.targetPrefix+"boxes";$(n).empty();this.createSelectionBoxes(n);this.createPercentageCheckBox(n)};HighChartFactory.prototype.createSelectionBoxes=function(n){var i,r=0,u,t=this;$.each(this.chartOptions.dimensions,function(f,e){var s,o,h;_.isUndefined(e.initialSelection)||t.minimized||(r++,t.singleSelectionDimension=t.meta.Columns[f],e.column!=t.injectedSelectionColumn)&&(i=(n+"_"+e.column.Name).substring(1),$(n).append($('<div id="'+i+'"><\/div>')),$(n+" > div").last().append($("<label><\/label>").attr("class","control-label")).append($("<select><\/select>").attr("class","subset")),$(n+" .control-label").last().attr("for",e.column.Name).text(t.capitalize(e.column.Name)+":"),s=$(n+" .subset").last(),o=(n+"_"+e.column.Name+"_select").substring(1).replace(/ /g,"_"),s.attr("id",o),$.each(e.column.namesDictionary,function(n,t){s.append($("<option><\/option>"));s.find("option").last().attr("value",n).text(t)}),u=e.column.selections[e.column.selections.length-1],$("#"+o).val(u),$("#"+o).html($("#"+o+" option").sort(function(n,t){return n.text==t.text?0:n.text<t.text?-1:1})),$("#"+o).change(function(){e.column.selections=[];e.column.selections.push(this.value);t.refresh()}),h=e.width==null?150:e.width,$("#"+o).chosen({disable_search_threshold:15,width:h+"px"}))});r!=1&&(this.singleSelectionDimension=null)};HighChartFactory.prototype.capitalize=function(n){return n[0].toUpperCase()+n.slice(1)};HighChartFactory.prototype.createPercentageCheckBox=function(n){var i=this,t;!_.isUndefined(this.chartOptions.percentageCheckBox)&&this.chartOptions.percentageCheckBox&&(t=(n+"_squaredFour").substring(1),$(n).append($("<div><\/div>").attr("class","squaredFour").append($("<input><\/input>").attr("class","tooltip").attr("type","checkbox").attr("id",t).attr("name","percent")).append($("<label><\/label>").attr("for",t))),$("#"+t).change(function(){var n=$(this).is(":checked");i.chartOptions.stacking=n?"percent":"normal";i.refresh()}))};HighChartFactory.prototype.buildChartData=function(){return(this.checkDrawingMethod(),_.contains(this.basicChartTypes,this.chartOptions.chartType))?(this.chartData=this.normalisedToSeries(),1):this.chartOptions.chartType==="arearange"?(this.chartData=this.arearange(),1):this.chartOptions.chartType==="treemap"?(this.chartData=this.treemap(),1):0};HighChartFactory.prototype.checkDrawingMethod=function(){this.chartOptions.chartType==="arearange"&&this.chartOptions.func!=="_drawHighChart_AreaRange"&&(this.error="Invalid combination of chart type and drawing method");this.chartOptions.chartType==="masterdetail"&&this.chartOptions.func!=="_drawHighChart_MasterDetail"&&(this.error="Invalid combination of chart type and drawing method");this.chartOptions.chartType!=="column"&&this.chartOptions.chartType!=="line"||this.chartOptions.func==="_drawHighChart"||this.chartOptions.func==="_drawHighChart_2axes"||this.chartOptions.func==="_drawHighChart_3axes"||(this.error="Invalid combination of chart type and drawing method")};HighChartFactory.prototype.normalisedToSeries=function(){var a=_.isUndefined(this.chartOptions.selectSeries)?!1:this.chartOptions.selectSeries,v=_.isUndefined(this.chartOptions.selectSeriesNumber)?!1:this.chartOptions.selectSeriesNumber,p=_.isUndefined(this.chartOptions.lineMarker)?!0:this.chartOptions.lineMarker,w=!a,r,t=[],e,u=!0,o={},s,h,y,i,f,n,c,l;for(this.chartOptions.dimensions[this.seriesDimension.columnIndex].series.length>0?$.each(this.chartOptions.dimensions[this.seriesDimension.columnIndex].series,function(n,t){if(t.order==null||o[t.name]!=null)return u=!1,!1;o[t.name]=t.order}):u=!1,u&&this.seriesDimension.currentElements.sort(function(n,t){return(s=o[n],h=o[t],s==h)?0:s>h?1:-1}),u||(!_.isUndefined(this.chartOptions.sortedSeries)&&this.chartOptions.sortedSeries&&(t=this.seriesDimension.currentElements.sort(),u=!0),!_.isUndefined(this.chartOptions.reversedSeries)&&this.chartOptions.reversedSeries&&(t=this.seriesDimension.currentElements.reverse())),y=this.seriesDimension.currentElements.length,n=0;n<y;n++)e=[],r=this.seriesDimension.namesDictionary[this.seriesDimension.currentElements[n]],r==null&&(r=this.seriesDimension.currentElements[n]),this.secondarySeriesDimension==null?this.getSeriesData(n,e):this.getSeriesWithSecondarySeriesData(n,e),t[n]={name:r,data:e,visible:w,marker:{enabled:p}},i=this.seriesOption(this.seriesDimension.currentElements[n],"colour"),i!=null&&(t[n].colour=i),i=this.seriesOption(this.seriesDimension.currentElements[n],"yAxis"),i!=null&&(t[n].yAxis=i),i=this.seriesOption(this.seriesDimension.currentElements[n],"type"),i!=null&&(t[n].type=i),i=this.seriesOption(this.seriesDimension.currentElements[n],"suffix"),i==null&&(i=this.suffix(0)),f=this.seriesOption(this.seriesDimension.currentElements[n],"decimals"),f==null&&(f=this.getDecimals(0)),t[n].tooltip={valueSuffix:" "+i,valueDecimals:f},t[n].decimals=f,i=this.seriesOption(this.seriesDimension.currentElements[n],"decimalPlaces"),i!=null&&(t[n].decimalPlaces=i);if(a)for(v||t[0]==null||(t[0].visible=!0),n=t.length-1;n>t.length-1-Math.min(v,t.length);n--)t[n].visible=!0;return c=[],l=this,$.each(this.categoryDimension.currentElements,function(n,t){r=l.dateFormat==undefined?l.categoryDimension.namesDictionary[t]:t;c.push(r)}),u||(!_.isUndefined(this.chartOptions.sortedSeries)&&this.chartOptions.sortedSeries&&this.arraySort(t,"name"),this.chartOptions.chartType==="column"&&this.chartOptions.stacking==="normal"&&this.arraySort(t,"data"),!_.isUndefined(this.chartOptions.reversedSeries)&&this.chartOptions.reversedSeries&&(t=t.reverse())),{series:t,categories:c}};HighChartFactory.prototype.getSeriesData=function(n,t){for(var i,r,o,u,h=this.chartDimensions.indexOf(this.seriesDimension),c=this.chartDimensions.indexOf(this.categoryDimension),s=this.chartDimensions.indexOf(this.markerDimension),f=this.chartDimensions.indexOf(this.valueDimension),l=this.categoryDimension.currentElements.length,a=this.preparedData.length,e=0;e<l;e++){for(r=null,i=0;i<a;i++)if(this.preparedData[i][h]==this.seriesDimension.currentElements[n]&&this.preparedData[i][c]==this.categoryDimension.currentElements[e]){s<0?r=this.preparedData[i][f]:(o=this.preparedData[i][s],dataVal=this.preparedData[i][f]==undefined?null:this.preparedData[i][f],u=_.findWhere(marker,{name:o}),r=u==null?{y:dataVal}:{y:dataVal,marker:u.option});break}t.push(r)}return t};HighChartFactory.prototype.getSeriesWithSecondarySeriesData=function(n,t){for(var u,i,r,f=this.chartDimensions.indexOf(this.seriesDimension),e=this.chartDimensions.indexOf(this.secondarySeriesDimension),o=this.chartDimensions.indexOf(this.categoryDimension),h=this.chartDimensions.indexOf(this.valueDimension),c=this.secondarySeriesDimension.currentElements.length,l=this.categoryDimension.currentElements.length,a=this.preparedData.length,s=0;s<l;s++)for(r=null,u=0;u<c;u++)for(i=0;i<a;i++)if(this.preparedData[i][f]==this.seriesDimension.currentElements[n]&&this.preparedData[i][o]==this.categoryDimension.currentElements[s]&&this.preparedData[i][e]==this.secondarySeriesDimension.currentElements[u]){r=[];r[f]=this.preparedData[i][f];r[o]=this.preparedData[i][o];r[e]=this.preparedData[i][e];r[h]=this.preparedData[i][h];t.push(r);break}return t};HighChartFactory.prototype.seriesOption=function(n,t){var r=this.seriesDimension.elementMappings!=null&&this.seriesDimension.elementMappings[n]!=null?this.seriesDimension.elementMappings[n]:n,u=this.chartOptions.dimensions[this.seriesDimension.columnIndex].series,i;try{i=_.findWhere(u,{name:r})[t]}catch(f){i=null}return i};HighChartFactory.prototype.suffix=function(n){var t,i,r;if(this.chartOptions.stacking=="percent")return"";if(!_.isUndefined(this.chartOptions.suffix))return this.chartOptions.suffix;t=this.chartOptions.dimensions[this.seriesDimension.columnIndex].series;i=this.seriesDimension.currentElements[n];try{r=_.findWhere(t,{name:i}).suffix}catch(u){return""}return r};HighChartFactory.prototype.getDecimals=function(n){var i,r,t;if(!_.isUndefined(this.chartOptions.decimals))return this.chartOptions.decimals;i=this.chartOptions.dimensions[this.seriesDimension.columnIndex].series;r=this.seriesDimension.currentElements[n];try{t=_.findWhere(i,{name:r}).decimals}catch(u){return null}return _.isNumber(t)?t:null};HighChartFactory.prototype.arraySort=function(n,t,i){var r=this;n.sort(function(n,u){var f=r.arraySum(n[t]),e=r.arraySum(u[t]);return f==e?0:i?f<e?1:-1:f>e?1:-1})};HighChartFactory.prototype.arraySum=function(n){return _.reduce(n,function(n,t){return n+t},0)};HighChartFactory.prototype.sortByOrder=function(n,t){var i,r;x.sort(function(n,u){return(i=t[n.name],r=t[u.name],i==r)?0:i>r?1:-1})};HighChartFactory.prototype.arearange=function(){var s=null,h=this.chartOptions.dimensions[this.seriesDimension.columnIndex].series,e,c,l,v,f,i,t,o,r,n,w;try{e=_.findWhere(h,{avg:!0});c=e.name;_.isUndefined(e.extendLastWith)||(s=e.extendLastWith)}catch(it){this.error="Average series not specified in chart options"}try{l=_.findWhere(h,{low:!0}).name}catch(it){this.error="Low range series not specified in chart options"}try{v=_.findWhere(h,{high:!0}).name}catch(it){this.error="High range series not specified in chart options"}var b=this.seriesDimension.namesDictionary[c],k=this.seriesDimension.namesDictionary[l]+" - "+this.seriesDimension.namesDictionary[v],d=this.chartDimensions.indexOf(this.seriesDimension),y=this.chartDimensions.indexOf(this.valueDimension),g=this.chartDimensions.indexOf(this.timeDimension),u=[],o,p=_.sortBy(this.timeDimension.currentElements,function(n){return n}),nt=p.length,tt=this.preparedData.length;for(f=0;f<nt;f++){for(i=Array(4),i.splice(0,1,Date.UTC(p[f],0,1)),t=0;t<tt;t++)this.preparedData[t][g]===p[f]&&(o=this.preparedData[t][d],o===c?(r=this.roundTo(this.preparedData[t][y],this.chartOptions.decimals),i.splice(1,1,r)):o===l?(r=this.roundTo(this.preparedData[t][y],this.chartOptions.decimals),i.splice(2,1,r)):o===v&&(r=this.roundTo(this.preparedData[t][y],this.chartOptions.decimals),i.splice(3,1,r)));u.push(i)}n=[];w=[];for(a in u)n.push(u[a].slice(0,2)),u[a].splice(1,1),w.push(u[a]);return s!=null&&(n[n.length-1]={dataLabels:{enabled:!0,x:-5,y:-10,overflow:!0,crop:!1,formatter:function(){return this.series.showDataLabels?s:""}},x:n[n.length-1][0],y:n[n.length-1][1]}),{avg:n,range:w,avgName:b,rangeName:k}};HighChartFactory.prototype.treemap=function(){var b=_.isUndefined(this.chartOptions.selectSeries)?!1:this.chartOptions.selectSeries,k=_.isUndefined(this.chartOptions.selectSeriesNumber)?!1:this.chartOptions.selectSeriesNumber,ft=_.isUndefined(this.chartOptions.lineMarker)?!0:this.chartOptions.lineMarker,et=!b,u,nt=this.chartDimensions.indexOf(this.seriesDimension),tt=this.chartDimensions.indexOf(this.categoryDimension),d=this.chartDimensions.indexOf(this.markerDimension),c=this.chartDimensions.indexOf(this.valueDimension),t=[],l,g,a,f=!0,o={},v,y,s,h,r,i,e,n,p,w;this.chartOptions.dimensions[this.seriesDimension.columnIndex].series.length>0?$.each(this.chartOptions.dimensions[this.seriesDimension.columnIndex].series,function(n,t){if(t.order==null||o[t.name]!=null)return f=!1,!1;o[t.name]=t.order}):f=!1;f&&this.seriesDimension.currentElements.sort(function(n,t){return(v=o[n],y=o[t],v==y)?0:v>y?1:-1});f||(!_.isUndefined(this.chartOptions.sortedSeries)&&this.chartOptions.sortedSeries&&(t=this.seriesDimension.currentElements.sort(),f=!0),!_.isUndefined(this.chartOptions.reversedSeries)&&this.chartOptions.reversedSeries&&(t=this.seriesDimension.currentElements.reverse()));var it=this.seriesDimension.currentElements.length,rt=this.categoryDimension.currentElements.length,ut=this.preparedData.length;for(n=0;n<it;n++){for(l=[],u=this.seriesDimension.namesDictionary[this.seriesDimension.currentElements[n]],u==null&&(u=this.seriesDimension.currentElements[n]),h=0;h<rt;h++){for(s=null,r=0;r<ut;r++)if(this.preparedData[r][nt]==this.seriesDimension.currentElements[n]&&this.preparedData[r][tt]==this.categoryDimension.currentElements[h]){d<0?s=this.preparedData[r][c]:(g=this.preparedData[r][d],dataVal=this.preparedData[r][c]==undefined?null:this.preparedData[r][c],a=_.findWhere(marker,{name:g}),s=a==null?{y:dataVal}:{y:dataVal,marker:a.option});break}l.push(s)}t[n]={name:u,value:l[0],colorValue:n+1};i=this.seriesOption(this.seriesDimension.currentElements[n],"yAxis");i!=null&&(t[n].yAxis=i);i=this.seriesOption(this.seriesDimension.currentElements[n],"type");i!=null&&(t[n].type=i);i=this.seriesOption(this.seriesDimension.currentElements[n],"suffix");i==null&&(i=this.suffix(0));e=this.seriesOption(this.seriesDimension.currentElements[n],"decimals");e==null&&(e=this.getDecimals(0));t[n].tooltip={valueSuffix:" "+i,valueDecimals:e};t[n].decimals=e;i=this.seriesOption(this.seriesDimension.currentElements[n],"decimalPlaces");i!=null&&(t[n].decimalPlaces=i)}if(b)for(k||t[0]==null||(t[0].visible=!0),n=t.length-1;n>t.length-1-Math.min(k,t.length);n--)t[n].visible=!0;return p=[],w=this,$.each(this.categoryDimension.currentElements,function(n,t){u=w.dateFormat==undefined?w.categoryDimension.namesDictionary[t]:t;p.push(u)}),f||(!_.isUndefined(this.chartOptions.sortedSeries)&&this.chartOptions.sortedSeries&&this.arraySort(t,"name"),this.chartOptions.chartType==="column"&&this.arraySort(t,"data"),!_.isUndefined(this.chartOptions.reversedSeries)&&this.chartOptions.reversedSeries&&(t=t.reverse())),{series:{type:"treemap",layoutAlgorithm:"squarified",data:t},categories:p}};HighChartFactory.prototype.roundTo=function(n,t){if(!t)return n;var i=Math.pow(10,t);return Math.round(n*i)/i};HighChartFactory.prototype.setToolTips=function(){var t=this.languageID?"Relative / Absolute":"Relatief / Absoluut",n="#"+this.targetPrefix+"boxes",i=$(n+" .squaredFour label").qtip({content:t,style:{classes:"qtip-bootstrap myStyle"},show:{event:"mouseenter",effect:function(){$(this).slideDown(90)},ready:!0},hide:{event:"mouseleave",effect:function(){$(this).slideUp(90)},delay:250,inactive:5e3},position:{at:"center right",my:"center left",target:$(n+" .squaredFour label"),adjust:{mouse:!1,x:10,y:0},viewport:$(".highcharts-container")}})};HighChartFactory.prototype.refresh=function(){this.destroyLegendTooltip();this.prepareData();var n=this;this.buildChartData()&&this.callback(this)};HighChartFactory.prototype.destroyTooltips=function(){this.destroyLegendTooltip();this.destroyPercentageBoxTooltip()};HighChartFactory.prototype.destroyLegendTooltip=function(){x=$(".highcharts-legend").qtip("api");x!=null&&(x.hide(),x.disable(!0))};HighChartFactory.prototype.destroyPercentageBoxTooltip=function(){var n=$(".squaredFour label").qtip("api");n!=null&&(n.hide(),n.disable(!0))};HighChartFactory.prototype.destroyChart=function(){this.cancelled=!0;this.chart!=null&&(this.destroyTooltips(),this.chart.destroy(),this.chart=null)};HighChartFactory.prototype.refreshChartOptions=function(){try{this.extendedCategoryItem!=null&&(this.categoryDimension.UniqueElements[this.categoryDimension.UniqueElements.length-1][1]=this.extendedCategoryItem,this.extendedCategoryItem==null);this.error=null;this.chartData=null;this.keyDimensions=[];this.chartDimensions=[];this.reducableDimensions=[];this.emptyTarget();this.checkAndPrepareForCharting(this.callback)}catch(n){this.error="Cannot create chart. "+n.message;this.errorCheck()}};HighChartFactory.prototype.emptyTarget=function(){$("#"+this.targetPrefix+"boxes").empty();$("#"+this.targetPrefix+"container").empty()};HighChartFactory.prototype.getOriginalData=function(){var n={},t={},i;return t.MetaInformation=this.meta,i=this.data.slice(),i.shift(),t.Data=i,n.DataSet=t,n.Description=this.description,n.Id=this.id,n};
