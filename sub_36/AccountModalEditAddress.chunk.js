webpackJsonp([12],{582:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(102),n=r(282),o=r(16),a=r(570),i=r(283),d=r(284),c=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var u="Adres[AdresseerbareAdresID]",l="Adres[Label]",f="Adres[Zipcode]",m="Adres[Housenumber]",A="Adres[HousenumberAdd]",h="Adres[Address]",v="Adres[City]",b="Adres[District]",p="Adres[IsActief]",w="Adres[IsPrimair]",y="Afwezigheidsrooster[AfwezigheidID]",g="Afwezigheidsrooster[Aanwezig]",k="address-edit-errors",S=document.querySelector("[js-hook-"+k+"]"),C="[js-hook-form-streetname]",R="js-form-item",j="form__item--lap-active",O=function(e){function AccountModalEditAddress(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AccountModalEditAddress);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(AccountModalEditAddress.__proto__||Object.getPrototypeOf(AccountModalEditAddress)).call(this,e));return t.formItems=[].concat(function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t.element.querySelectorAll("."+R))),t.streetNameBlock=t.element.querySelector(C),o.a.$on("modal[modal-edit-address]::open",function(e,r){var s=r.button;if(s){var n={addressId:u,addressLabel:l,addressZipcode:f,addressHousenumber:m,addressHousenumberAdd:A,addressAddress:h,addressCity:v,addressDistrict:b,addressIsActive:p,addressIsPrimair:w,addressAbsenceRoster:y,addressHasAbsenceRoster:g};Object.keys(n).forEach(function(e){var r=t.inputs[n[e]];if(void 0!==r){var o=s.dataset[e]?s.dataset[e]:"";if(r.setAttribute("value",o),"addressAbsenceRoster"!==e){if("hidden"!==r.type&&o){var a=r.closest("."+R);if(!a)return;a.classList.add(j)}}else"false"===s.dataset.addressHasAbsenceRoster?r.setAttribute("checked","checked"):r.removeAttribute("checked")}})}}),o.a.$on("modal[modal-edit-address]::close",function(){t.element.reset(),Object(i.a)(k),t.formItems.forEach(function(e){e.classList.remove(j)}),t.element.removeChild(t.streetNameBlock)}),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AccountModalEditAddress,n["default"]),c(AccountModalEditAddress,[{key:"formId",get:function get(){return"edit-address"}}]),c(AccountModalEditAddress,[{key:"onFormChange",value:function onFormChange(e){var t=this;"change"===e.eventType&&Object(a.a)(this.state,e,f,m,A).then(function(e){return!e||(t.loading=!0,Object(a.b)(t.element,t.state,f,m,A))}).then(function(e){if(e){if(t.state.isValid&&(t.loading=!1),e.Adres){var r=e.Adres,s=r.Gemeente,n=r.Plaatsnaam,o=r.Straatnaam;t.inputs["Adres[Address]"].value=o,t.inputs["Adres[City]"].value=n,t.inputs["Adres[District]"].value=s,t.showStreetnameBlock(!0,o+", "+n)}}else t.loading=!1,t.showStreetnameBlock(!1)}).catch(function(){t.loading=!1})}},{key:"onFormSubmit",value:function onFormSubmit(){var e=this;this.formSubmitTimeout&&clearTimeout(this.formSubmitTimeout),this.loading=!0,this.formSubmitTimeout=setTimeout(function(){Object(i.a)(k),Promise.all([e.updateAddress(),e.updateAbsenceRoster()]).then(function(t){t.every(function(e){return e})?window.location.reload():(e.loading=!1,Object(i.b)(S,window.messages.validationAddressChange,k))})},500)}},{key:"updateAddress",value:function updateAddress(){var e=new FormData(this.element);return e.set("method",window.EnvironmentSettings.api.changeAddress),this.executeCall(e)}},{key:"updateAbsenceRoster",value:function updateAbsenceRoster(){var e=this.element.elements["Afwezigheidsrooster[AfwezigheidID]"];if(e.checked){if(""!==e.value)return this.removeAbsenceRoster(e.value)}else if(""===e.value)return this.addAbsenceRoster(e);return Promise.resolve(!0)}},{key:"removeAbsenceRoster",value:function removeAbsenceRoster(e){var t=new FormData;return t.set("method",window.EnvironmentSettings.api.removeAwayScheduleV2),t.set("AfwezigheidsRoosterID",e),this.executeCall(t)}},{key:"addAbsenceRoster",value:function addAbsenceRoster(){var e=new FormData,t=!0,r=!1,s=void 0;try{for(var n,o=this.element.elements[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;a.name.startsWith("Adres")&&e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster]"+a.name.replace(/^Adres/,"[Adres]"),a.value)}}catch(e){r=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw s}}var i=new Date;i.setUTCHours(23),i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0);var d=i.toISOString().replace(/(\.[0-9]+)?Z?$/,"");return e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster][DatumTijdBegin]",d),e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster][DuurInMinuten]",480),e.set("method",window.EnvironmentSettings.api.addAwayScheduleV2),this.executeCall(e)}},{key:"executeCall",value:function executeCall(e){return s.a.get(window.EnvironmentSettings.endpoint+Object(d.a)(e),{},!1,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){return e.data.success}).catch(function(){return Object(i.b)(S,window.messages.validationRequestFailed,k),!1})}},{key:"showStreetnameBlock",value:function showStreetnameBlock(e,t){this.streetNameBlock&&(e?(this.streetNameBlock.textContent=t,this.streetNameBlock.classList.remove("u-hidden")):this.streetNameBlock.classList.add("u-hidden"))}}]),AccountModalEditAddress}();t.default=O}});