!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={};t(r),e.AGOWebWorkerInterface=r}}(this,function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={init:function(e,t){if(e.clientId)return window.addEventListener("message",this._handleJsonMessage.bind(this)),this.userData=e,this.userData.homeAppOrigin=this._getHomeAppOrigin(this.userData.orgUrlKey,this.userData.environment,this.userData.portal)+"pages/ago_web_worker.html#",this.userData.iframe=this.createIframe(this.userData.homeAppOrigin,this.userData.orgUrlKey,this.userData.environment),this.currentClientCallback=t,this.resources=e.resources||null,this.portalConnectionEstablished=!1,this.portal=this._readyPortalForTransport(e.portal,e.orgUrlKey),this.portalUser=this._readyPortalUserForTransport(e.portalUser),this},_handleJsonMessage:function(e,t){try{var r=JSON.parse(e.data)}catch(e){return this.currentClientCallback({success:!1,error:e})}return this.currentClientCallback(r)},performAction:function(e,t,r,o){this.portalConnectionEstablished||(r=r||{},this.resources&&(r.resources=this.resources),r.portal=this.portal,r.portalUser=this.portalUser,this.portalConnectionEstablished=!0),this.currentClientCallback=o,this.requestResource(e,t,"string"==typeof r?r:JSON.stringify(r))},_getHomeAppOrigin:function(e,t,r){if(r&&r.isPortal&&r.url)return r.url+"/home/";var o=location.protocol;return!t||"devext"!==t&&"qa"!==t?o+"//"+(e?e+".maps.":"")+"arcgis.com/home/":e?o+"//"+(e||"")+".maps"+t+".arcgis.com/home/":o+"//"+("devext"===t?t:"qaext")+".arcgis.com/home/"},_getOriginOfUrl:function(e){return(e=e||window.location).protocol+"//"+e.hostname+(e.port?":"+e.port:"")},_readyPortalForTransport:function(e,t){return{urlKey:t,portalUrl:e.portalUrl,customBaseUrl:e.customBaseUrl,allSLL:e.allSSL,isPortal:e.isPortal,httpPort:e.httpPort,httpsPort:e.httpsPort,allowedBetaFeatures:e.allowedBetaFeatures,portalHostname:e.portalHostname,portalProperties:this._getEnabledProperties(e.portalProperties,["openData"]),subscriptionInfo:this._getEnabledProperties(e.subscriptionInfo,["hubSettings"]),helperServices:this._getBooleanProperties(e.helperServices,["rasterAnalytics","orthoMapping","locationTracking"])}},_getEnabledProperties:function(t,e){var r={};return t&&e.forEach(function(e){t[e]&&(r[e]={enabled:t[e].enabled})}),r},_getBooleanProperties:function(t,e){var r={};return t&&e.forEach(function(e){t[e]&&(r[e]=!0)}),r},_readyPortalUserForTransport:function(e){return{username:e.username,credential:{token:e.credential.token},orgId:e.orgId,role:e.role,privileges:e.privileges,isOrgAdmin:e.isOrgAdmin,userLicenseTypeId:e.userLicenseTypeId}},createIframe:function(e,t,r){return e+="origin="+this._getOriginOfUrl(),e+="&clientId="+this.userData.clientId,this._create("iframe",{src:e,style:"display:none;"},document.body)},_create:function(e,t,r){if("string"!=typeof e)throw"Error in _create: element must be a string";var o=document.createElement(e);if("object"!==n(t)||Array.isArray(t))throw"Error in _create: attributes must be defined in an object";return null!==t&&Object.keys(t).forEach(function(e){"innerHTML"===e?o.innerHTML=t[e]:o.setAttribute(e,t[e])}),null!=r&&r.appendChild(o),o},_addEvent:function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r)},requestResource:function(e,t,r){this.userData.iframe.contentWindow.postMessage({name:e,action:t,data:r},this.userData.homeAppOrigin)}};e.default=t});