/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See LICENSE.md for details.
 * v1.0.0-beta.304
 */
import{r as t,c as i,h as a,F as e,a as n}from"./p-07000a47.js";import{C as s,I as o,S as l}from"./p-0e9c177b.js";import{g as c,f as r,q as h}from"./p-9510b839.js";import{g as m}from"./p-d97b63fe.js";import{g as u}from"./p-d0ba5b72.js";import{c as d}from"./p-8c3b967b.js";import{c as p,d as f}from"./p-86830e39.js";import{T as v,a as y}from"./p-73fe59d9.js";const g=["ArrowUp","ArrowDown"],x=["ArrowUp","ArrowDown","End","Home"];let b=class{constructor(a){t(this,a),this.calciteActionMenuOpenChange=i(this,"calciteActionMenuOpenChange",7),this.expanded=!1,this.open=!1,this.overlayPositioning="absolute",this.placement="auto",this.actionElements=[],this.mutationObserver=d("mutation",(()=>this.getActions())),this.guid=`calcite-action-menu-${u()}`,this.menuId=`${this.guid}-menu`,this.menuButtonId=`${this.guid}-menu-button`,this.activeMenuItemIndex=-1,this.connectMenuButtonEl=()=>{const{el:t,menuButtonId:i,menuId:a,open:e,label:n}=this,s=c(t,l.trigger)||this.defaultMenuButtonEl;this.menuButtonEl!==s&&(this.disconnectMenuButtonEl(),this.menuButtonEl=s,this.setTooltipReferenceElement(),s&&(s.active=e,s.setAttribute("aria-controls",a),s.setAttribute("aria-expanded",e.toString()),s.setAttribute("aria-haspopup","true"),s.id||(s.id=i),s.label||(s.label=n),s.text||(s.text=n),s.addEventListener("click",this.menuButtonClick),s.addEventListener("keydown",this.menuButtonKeyDown),s.addEventListener("keyup",this.menuButtonKeyUp)))},this.disconnectMenuButtonEl=()=>{const{menuButtonEl:t}=this;t&&(t.removeEventListener("click",this.menuButtonClick),t.removeEventListener("keydown",this.menuButtonKeyDown),t.removeEventListener("keyup",this.menuButtonKeyUp))},this.setDefaultMenuButtonEl=t=>{this.defaultMenuButtonEl=t,this.connectMenuButtonEl()},this.handleCalciteActionClick=()=>{this.open=!1,this.setFocus()},this.menuButtonClick=()=>{this.toggleOpen()},this.setTooltipReferenceElement=()=>{const{el:t,expanded:i,menuButtonEl:a}=this,e=c(t,l.tooltip),n="SLOT"===(null==e?void 0:e.tagName)?e.assignedElements()[0]:e;"CALCITE-TOOLTIP"===(null==n?void 0:n.tagName)&&(n.referenceElement=i?null:a)},this.updateAction=(t,i)=>{const{guid:a,activeMenuItemIndex:e}=this,n=`${a}-action-${i}`;t.tabIndex=-1,t.setAttribute("role","menuitem"),t.id||(t.id=n),t.active=i===e},this.updateActions=t=>{null==t||t.forEach(this.updateAction)},this.getActions=()=>{const{el:t}=this,i=c(t,{all:!0,matches:"calcite-action"});this.updateActions(i),this.actionElements=i,this.connectMenuButtonEl()},this.menuButtonKeyUp=t=>{const{key:i}=t,{actionElements:a}=this;this.isValidKey(i,g)&&(t.preventDefault(),a.length&&(this.toggleOpen(!0),this.handleActionNavigation(i,a)))},this.menuButtonKeyDown=t=>{const{key:i}=t;this.isValidKey(i,g)&&t.preventDefault()},this.menuActionsContainerKeyDown=t=>{const{key:i}=t,{actionElements:a,activeMenuItemIndex:e}=this;if("Tab"!==i)if(" "!==i&&"Enter"!==i)this.isValidKey(i,x)&&t.preventDefault();else{t.preventDefault();const i=a[e];i?i.click():this.toggleOpen(!1)}else this.open=!1},this.menuActionsContainerKeyUp=t=>{const{key:i}=t,{actionElements:a}=this;"Escape"!==i?this.isValidKey(i,x)&&(t.preventDefault(),a.length&&this.handleActionNavigation(i,a)):this.toggleOpen(!1)},this.handleActionNavigation=(t,i)=>{const a=this.activeMenuItemIndex;"Home"===t&&(this.activeMenuItemIndex=0),"End"===t&&(this.activeMenuItemIndex=i.length-1),"ArrowUp"===t&&(this.activeMenuItemIndex=m(Math.max(a-1,-1),i.length)),"ArrowDown"===t&&(this.activeMenuItemIndex=m(a+1,i.length))},this.toggleOpenEnd=()=>{this.setFocus(),this.el.removeEventListener("calcitePopoverOpen",this.toggleOpenEnd)},this.toggleOpen=(t=!this.open)=>{this.el.addEventListener("calcitePopoverOpen",this.toggleOpenEnd),this.open=t}}connectedCallback(){var t;null===(t=this.mutationObserver)||void 0===t||t.observe(this.el,{childList:!0,subtree:!0}),this.getActions(),p(this)}disconnectedCallback(){var t;null===(t=this.mutationObserver)||void 0===t||t.disconnect(),this.disconnectMenuButtonEl(),f(this)}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(t){this.activeMenuItemIndex=this.open?0:-1,this.menuButtonEl&&(this.menuButtonEl.active=t),this.calciteActionMenuOpenChange.emit(t)}closeCalciteActionMenuOnClick(t){t.composedPath().includes(this.el)||(this.open=!1)}activeMenuItemIndexHandler(){this.updateActions(this.actionElements)}async setFocus(){r(this.open?this.menuEl:this.menuButtonEl)}renderMenuButton(){const{el:t,label:i,scale:e}=this,n=a("slot",{name:l.trigger},a("calcite-action",{class:s.defaultTrigger,icon:o.menu,ref:this.setDefaultMenuButtonEl,scale:e,text:i}));return c(t,l.tooltip)?a("calcite-tooltip-manager",null,n):n}renderMenuItems(){const{actionElements:t,activeMenuItemIndex:i,open:e,menuId:n,menuButtonEl:o,label:l,placement:c,overlayPositioning:r}=this,h=t[i];return a("calcite-popover",{disablePointer:!0,label:l,offsetDistance:0,open:e,overlayPositioning:r,placement:c,referenceElement:o},a("div",{"aria-activedescendant":(null==h?void 0:h.id)||null,"aria-labelledby":null==o?void 0:o.id,class:s.menu,id:n,onClick:this.handleCalciteActionClick,onKeyDown:this.menuActionsContainerKeyDown,onKeyUp:this.menuActionsContainerKeyUp,ref:t=>this.menuEl=t,role:"menu",tabIndex:-1},a("slot",null)))}render(){return a(e,null,this.renderMenuButton(),this.renderMenuItems(),a("slot",{name:l.tooltip}))}getAssignedElements(){return Array.from(this.el.querySelectorAll("slot")).map((t=>t.assignedElements({flatten:!0}))).reduce(((t,i)=>t.concat(i)),[])}isValidKey(t,i){return!!i.find((i=>i===t))}get el(){return n(this)}static get watchers(){return{expanded:["expandedHandler"],open:["openHandler"],activeMenuItemIndex:["activeMenuItemIndexHandler"]}}};b.style="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{box-sizing:border-box;display:flex;flex-direction:column;background-color:var(--calcite-ui-foreground-1);font-size:var(--calcite-font-size-1);color:var(--calcite-ui-text-2)}.menu ::slotted(calcite-action){margin:0.125rem;display:flex;outline-offset:0;outline-color:transparent;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out}::slotted(calcite-action[active]){outline:2px solid var(--calcite-ui-brand);outline-offset:0px}.default-trigger{position:relative;height:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;height:100%;flex:0 1 auto;align-self:stretch}.menu{flex-direction:column;flex-wrap:nowrap;outline:2px solid transparent;outline-offset:2px}";let w=class{constructor(i){t(this,i),this.hoverTimeouts=new WeakMap,this.selector=`[${v}]`,this.queryTooltip=t=>{const{el:i}=this;if(!t.includes(i))return null;const a=t.find((t=>{var i;return null===(i=null==t?void 0:t.hasAttribute)||void 0===i?void 0:i.call(t,v)}));if(!a)return null;const e=a.getAttribute(v);return h(i,{id:e})},this.clearHoverTimeout=t=>{const{hoverTimeouts:i}=this;i.has(t)&&(window.clearTimeout(i.get(t)),i.delete(t))},this.closeExistingTooltip=()=>{const{tooltipEl:t}=this;t&&this.toggleTooltip(t,!1)},this.focusTooltip=({tooltip:t,value:i})=>{this.closeExistingTooltip(),i&&this.clearHoverTimeout(t),this.toggleTooltip(t,i)},this.toggleTooltip=(t,i)=>{t.open=i,i&&(this.tooltipEl=t)},this.hoverToggle=({tooltip:t,value:i})=>{const{hoverTimeouts:a}=this;a.delete(t),i&&this.closeExistingTooltip(),this.toggleTooltip(t,i)},this.hoverTooltip=({tooltip:t,value:i})=>{this.clearHoverTimeout(t);const{hoverTimeouts:a}=this,e=window.setTimeout((()=>this.hoverToggle({tooltip:t,value:i})),y);a.set(t,e)},this.activeTooltipHover=t=>{const{tooltipEl:i,hoverTimeouts:a}=this,{type:e}=t;i&&("mouseover"===e&&t.composedPath().includes(i)?this.clearHoverTimeout(i):"mouseout"!==e||a.has(i)||this.hoverTooltip({tooltip:i,value:!1}))},this.hoverEvent=(t,i)=>{const a=this.queryTooltip(t.composedPath());this.activeTooltipHover(t),a&&this.hoverTooltip({tooltip:a,value:i})},this.focusEvent=(t,i)=>{const a=this.queryTooltip(t.composedPath());a&&a!==this.clickedTooltip?this.focusTooltip({tooltip:a,value:i}):this.clickedTooltip=null}}render(){return a("slot",null)}keyUpHandler(t){if("Escape"===t.key){const{tooltipEl:t}=this;t&&(this.clearHoverTimeout(t),this.toggleTooltip(t,!1))}}mouseEnterShow(t){this.hoverEvent(t,!0)}mouseLeaveHide(t){this.hoverEvent(t,!1)}clickHandler(t){const i=this.queryTooltip(t.composedPath());this.clickedTooltip=i,i&&this.toggleTooltip(i,!1)}focusShow(t){this.focusEvent(t,!0)}blurHide(t){this.focusEvent(t,!1)}get el(){return n(this)}};w.style="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-scale{animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:block}";export{b as calcite_action_menu,w as calcite_tooltip_manager}