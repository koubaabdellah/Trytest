!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("jquery"),require("spine"),require("app-data"),require("messages"),require("jquery-ui-touch-punch"),require("jquery-ui/ui/widgets/draggable"),require("jquery-ui/ui/widgets/mouse"),require("jquery-ui/ui/widgets/resizable"),require("qti-engine"),require("playerUrl"),require("startConfig"),require("qti-data"),require("rootContext"),require("qti-engine/storage"));else if("function"==typeof define&&define.amd)define(["jquery","spine","app-data","messages","jquery-ui-touch-punch","jquery-ui/ui/widgets/draggable","jquery-ui/ui/widgets/mouse","jquery-ui/ui/widgets/resizable","qti-engine","playerUrl","startConfig","qti-data","rootContext","qti-engine/storage"],e);else{var n="object"==typeof exports?e(require("jquery"),require("spine"),require("app-data"),require("messages"),require("jquery-ui-touch-punch"),require("jquery-ui/ui/widgets/draggable"),require("jquery-ui/ui/widgets/mouse"),require("jquery-ui/ui/widgets/resizable"),require("qti-engine"),require("playerUrl"),require("startConfig"),require("qti-data"),require("rootContext"),require("qti-engine/storage")):e(t.jquery,t.spine,t["app-data"],t.messages,t["jquery-ui-touch-punch"],t["jquery-ui/ui/widgets/draggable"],t["jquery-ui/ui/widgets/mouse"],t["jquery-ui/ui/widgets/resizable"],t["qti-engine"],t.playerUrl,t.startConfig,t["qti-data"],t.rootContext,t["qti-engine/storage"]);for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(this,function(t,e,n,i,a,o,s,r,l,c,u,p,d,f){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="../static/js/",e(e.s=45)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){var i,a;i=[n(6)],void 0!==(a=function(t){function e(t){this.messages=t}return e.prototype={getMessage:function(t,e,n){var i=this.messages[t];if(!i)return n||"Message not found and no default: '"+t+"'";if(void 0!==e&&null!==e){e=[].concat(e);for(var a=0;a<e.length;a++)i=i.replace("{"+a+"}",e[a])}return i},setMessage:function(t,e){this.messages[t]=e},getMessagesForTemplate:function(){var t={};for(var e in this.messages)if(this.messages.hasOwnProperty(e)){var n=e.replace(/\./g,"_");t[n]=this.messages[e]}return t}},new e(t||{})}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(1),n(0)],void 0!==(a=function(t,e){return t.Class.sub({PLAYER_RECONNECT:"/player/reconnect",PLAYER_RESUME:"/player/resume",config:null,init:function(t){this.config=e.extend({},t)},relativePath:function(){return window.location.pathname.indexOf("/preview/")>=0?window.location.pathname.split("/preview/")[0]:window.location.pathname.split("/player/")[0]},resume:function(t){var n=this.relativePath();e.ajax({url:n+t,type:"GET",success:function(t){document.location=n+t},error:function(t,e,n){console.log(t,e,n)}})}})}.apply(e,i))&&(t.exports=a)},function(t,e){t.exports=n},function(t,e,n){var i,a;i=[n(1),n(0),n(11),n(2),n(12),n(14),n(13),n(7)],void 0!==(a=function(t,e,n,i){var a=[],o=t.Controller.sub({content:{title:null,text:null,custom:null,buttons:null},dialog:null,dialogBody:null,minWidth:320,minHeight:200,modal:!0,resizable:!1,movable:!1,overlayBackground:"overlayBackground",dialogClose:!1,type:null,init:function(){var t={modal:this.modal,draggable:this.movable,dialogTitle:this.content.title,paragraph:this.content.text,custom:this.content.custom,buttons:this.content.buttons,className:this.className,overlayBackground:this.overlayBackground,dialogClose:this.dialogClose};e(this.el).append(n(t)),this.modal&&this.el.addClass("overlay"),this.dialog=e(this.el).find(".dialog"),a.push(this.dialog[0]),this.dialogBody=e(this.el).find(".dialog-inner")},open:function(){e(this.el).on("click.dialogClose",".dialog-close",this.proxy(function(){this.close()})),e(this.el).on("click.makeOnTop",this.proxy(function(){this.makeOnTop()})),this.modal&&null!==this.content.buttons&&e(document).on("keydown.tabBetweenButtons",this.proxy(this.handleKeyDown)),(this.resizable&&!1!==this.resizable||this.movable&&!1!==this.movable)&&this.rePosition(),e(this.el).addClass("active"),e(this.el).show(0,this.proxy(function(){this.dialog.find(".buttons button:last").focus(),this.makeOnTop()}))},close:function(){e(this.el).off("click.dialogClose"),e(this.el).off("click.makeOnTop"),this.modal&&null!==this.content.buttons&&e(document).off("keydown.tabBetweenButtons",this.proxy(this.handleKeyDown)),e(this.el).removeClass("active"),e(this.el).hide()},remove:function(){e(this.el).remove()},makeDraggable:function(){var t=this,n=t.dialogBody.find(".dialogContent");try{t.dialog.draggable("destroy")}catch(t){}t.dialog.draggable({handle:".drag-handler",containment:e(t.el).parent(),scroll:!1,start:function(){t.makeOnTop(),n.css("visibility","hidden")},stop:function(){n.css("visibility","visible")}}).addClass("draggable")},makeOnTop:function(){e(a).css("z-index",999),e(this.el).find(".dialog").css("z-index",1e3)},appendTo:function(){o.__super__.appendTo.apply(this,arguments),this.movable&&!1!==this.movable&&this.makeDraggable(),this.resizable&&!1!==this.resizable&&this.makeResizable()},makeResizable:function(){var t=this,n=t.dialogBody.find(".dialogContent");try{t.dialog.resizable("destroy")}catch(t){}t.dialog.resizable({containment:e(t.el).parent(),minHeight:t.minHeight,minWidth:t.minWidth,start:function(){n.hide()},stop:function(){n.show()}})},rePosition:function(){var t=this,n=e(t.el).parent();(parseInt(t.dialog.css("marginTop"),10)<0||parseInt(t.dialog.css("marginLeft"),10)<0)&&t.dialog.css({left:parseInt(n.width()/2,10)-parseInt(t.dialog.width()/2,10)+"px",top:parseInt(n.height()/2,10)-parseInt(t.dialog.height()/2,10)+"px",margin:"0px"})},handleKeyDown:function(t){if(9==t.which){t.preventDefault();var e,n;e=this.el.find(".buttons button:focus").index()||0,n=this.el.find(".buttons button"),t.shiftKey?--e<0&&(e=n.length-1):++e>n.length-1&&(e=0),n.eq(e).focus()}}});return o.getOkDialog=function(){function t(t,n){var a=[].concat(t);t=a.shift(),e=new o({className:"ok",events:{"click button.ok":"handleButtonOkClick"},content:{title:i.getMessage(t+".dialog.title"),text:i.getMessage(t+".dialog.ok.description",a),buttons:'<button class="ok">'+i.getMessage(t+".dialog.button.ok")+"</button>"},type:t,handleButtonOkClick:function(){"function"==typeof n&&n.call(this),this.close()}}),e.appendTo("body"),e.open()}var e;return{getInstance:function(n,i){return e?e.open():t(n,i)}}}(),o.getConfirmDialog=function(){function t(t,n,a){var s=[].concat(t);t=s.shift(),e=new o({className:"confirm",events:{"click button.ok":"handleButtonOkClick","click button.cancel":"handleButtonCancelClick"},content:{title:i.getMessage(t+".dialog.title"),text:i.getMessage(t+".dialog.confirm.description",s),buttons:'<button class="ok">'+i.getMessage(t+".dialog.button.yes")+'</button><button class="cancel">'+i.getMessage(t+".dialog.button.no")+"</button>"},handleButtonOkClick:function(){"function"==typeof n&&n.call(this),this.close()},handleButtonCancelClick:function(){"function"==typeof a&&a.call(this),this.close()}}),e.appendTo("body"),e.open()}var e;return{getInstance:function(n,i,a){return e?e.type!==n[0]?(e.remove(),t(n,i,a)):e.open():t(n,i,a)}}}(),o.getReconnectDialog=function(){function t(t,s,r,l){var c=l;return t=[].concat(t).shift(),n=new o({className:"ok reconnect",overlayBackground:"offline",movable:!1,resizable:!1,content:{title:i.getMessage(t+".dialog.title"),text:i.getMessage(t+".dialog.text.description"),buttons:'<button id="reconnectButton" disabled class="ok">'+i.getMessage(t+".dialog.button.yes")+"</button>"},events:{"click button.ok":"handleReconnectClick"},handleReconnectClick:function(){"function"==typeof s&&s.call(this)}}),n.openAppendToBody=function(){c&&c.navigator.clearTimeout(),n.appendTo("body"),n.open(),e("#reconnectButton").attr("disabled","disabled"),a=setInterval(function(){"function"==typeof r&&r().done(function(t,n,i){clearInterval(a),e("#reconnectButton").removeAttr("disabled")})},2e3)},n}var n,a;return{getInstance:function(e,i,a,o){return n||t(e,i,a,o)}}}(),o.getSpinnerDialog=function(){function t(t){return t=[].concat(t).shift(),e=new o({className:"ok reconnect-spinner",overlayBackground:"offline",movable:!1,resizable:!1,content:{title:i.getMessage(t+".dialog.title"),text:i.getMessage(t+".dialog.text.description"),buttons:'<svg class="spinner" width="65px" height="65px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg>'}}),e.openAppendToBody=function(){e.appendTo("body"),e.open()},e}var e;return{getInstance:function(n){return e||t(n)}}}(),o}.apply(e,i))&&(t.exports=a)},function(t,e){t.exports=i},function(t,e){t.exports=a},function(t,e,n){var i,a,o;/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
!function(n,s){"object"==typeof e&&e&&"string"!=typeof e.nodeName?s(e):(a=[e],i=s,void 0!==(o="function"==typeof i?i.apply(e,a):i)&&(t.exports=o))}(0,function(t){function e(t){return"function"==typeof t}function n(t){return g(t)?"array":typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(t,e){return null!=t&&"object"==typeof t&&e in t}function o(t,e){return m.call(t,e)}function s(t){return!o(v,t)}function r(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return b[t]})}function l(e,n){function a(t){if("string"==typeof t&&(t=t.split(x,2)),!g(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(i(t[0])+"\\s*"),r=new RegExp("\\s*"+i(t[1])),l=new RegExp("\\s*"+i("}"+t[1]))}if(!e)return[];var o,r,l,d=[],f=[],h=[],m=!1,v=!1;a(n||t.tags);for(var b,q,R,D,I,S,A=new p(e);!A.eos();){if(b=A.pos,R=A.scanUntil(o))for(var C=0,E=R.length;C<E;++C)D=R.charAt(C),s(D)?h.push(f.length):v=!0,f.push(["text",D,b,b+1]),b+=1,"\n"===D&&function(){if(m&&!v)for(;h.length;)delete f[h.pop()];else h=[];m=!1,v=!1}();if(!A.scan(o))break;if(m=!0,q=A.scan(k)||"name",A.scan(y),"="===q?(R=A.scanUntil(T),A.scan(T),A.scanUntil(r)):"{"===q?(R=A.scanUntil(l),A.scan(w),A.scanUntil(r),q="&"):R=A.scanUntil(r),!A.scan(r))throw new Error("Unclosed tag at "+A.pos);if(I=[q,R,b,A.pos],f.push(I),"#"===q||"^"===q)d.push(I);else if("/"===q){if(!(S=d.pop()))throw new Error('Unopened section "'+R+'" at '+b);if(S[1]!==R)throw new Error('Unclosed section "'+S[1]+'" at '+b)}else"name"===q||"{"===q||"&"===q?v=!0:"="===q&&a(R)}if(S=d.pop())throw new Error('Unclosed section "'+S[1]+'" at '+A.pos);return u(c(f))}function c(t){for(var e,n,i=[],a=0,o=t.length;a<o;++a)(e=t[a])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function u(t){for(var e,n,i=[],a=i,o=[],s=0,r=t.length;s<r;++s)switch(e=t[s],e[0]){case"#":case"^":a.push(e),o.push(e),a=e[4]=[];break;case"/":n=o.pop(),n[5]=e[2],a=o.length>0?o[o.length-1][4]:i;break;default:a.push(e)}return i}function p(t){this.string=t,this.tail=t,this.pos=0}function d(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function f(){this.cache={}}var h=Object.prototype.toString,g=Array.isArray||function(t){return"[object Array]"===h.call(t)},m=RegExp.prototype.test,v=/\S/,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},y=/\s*/,x=/\s+/,T=/\s*=/,w=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;p.prototype.eos=function(){return""===this.tail},p.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},p.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},d.prototype.push=function(t){return new d(t,this)},d.prototype.lookup=function(t){var n,i=this.cache;if(i.hasOwnProperty(t))n=i[t];else{for(var o,s,r=this,l=!1;r;){if(t.indexOf(".")>0)for(n=r.view,o=t.split("."),s=0;null!=n&&s<o.length;)s===o.length-1&&(l=a(n,o[s])),n=n[o[s++]];else n=r.view[t],l=a(r.view,t);if(l)break;r=r.parent}i[t]=n}return e(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(t,e){var n=this.cache,i=n[t];return null==i&&(i=n[t]=l(t,e)),i},f.prototype.render=function(t,e,n){var i=this.parse(t),a=e instanceof d?e:new d(e);return this.renderTokens(i,a,n,t)},f.prototype.renderTokens=function(t,e,n,i){for(var a,o,s,r="",l=0,c=t.length;l<c;++l)s=void 0,a=t[l],o=a[0],"#"===o?s=this.renderSection(a,e,n,i):"^"===o?s=this.renderInverted(a,e,n,i):">"===o?s=this.renderPartial(a,e,n,i):"&"===o?s=this.unescapedValue(a,e):"name"===o?s=this.escapedValue(a,e):"text"===o&&(s=this.rawValue(a)),void 0!==s&&(r+=s);return r},f.prototype.renderSection=function(t,n,i,a){function o(t){return s.render(t,n,i)}var s=this,r="",l=n.lookup(t[1]);if(l){if(g(l))for(var c=0,u=l.length;c<u;++c)r+=this.renderTokens(t[4],n.push(l[c]),i,a);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)r+=this.renderTokens(t[4],n.push(l),i,a);else if(e(l)){if("string"!=typeof a)throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,a.slice(t[3],t[5]),o),null!=l&&(r+=l)}else r+=this.renderTokens(t[4],n,i,a);return r}},f.prototype.renderInverted=function(t,e,n,i){var a=e.lookup(t[1]);if(!a||g(a)&&0===a.length)return this.renderTokens(t[4],e,n,i)},f.prototype.renderPartial=function(t,n,i){if(i){var a=e(i)?i(t[1]):i[t[1]];return null!=a?this.renderTokens(this.parse(a),n,i,a):void 0}},f.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},f.prototype.escapedValue=function(e,n){var i=n.lookup(e[1]);if(null!=i)return t.escape(i)},f.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.0",t.tags=["{{","}}"];var q=new f;return t.clearCache=function(){return q.clearCache()},t.parse=function(t,e){return q.parse(t,e)},t.render=function(t,e,i){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+n(t)+'" was given as the first argument for mustache#render(template, view, partials)');return q.render(t,e,i)},t.to_html=function(n,i,a,o){var s=t.render(n,i,a);if(!e(o))return s;o(s)},t.escape=r,t.Scanner=p,t.Context=d,t.Writer=f,t})},function(t,e,n){var i,a;i=[n(1)],void 0!==(a=function(t){return t.Class.sub({_timeRemaining:null,_timeStamp:null,init:function(t){this.setTime(t||0)},setTime:function(t){return this._timeRemaining=t,this._timeStamp=(new Date).getTime(),this._timeRemaining},getTime:function(){var t=((new Date).getTime()-this._timeStamp)/1e3;return this.setTime(this._timeRemaining-t)}})}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(0)],void 0!==(a=function(t){var e={logUrl:null,log:function(e,n){return t.ajax({type:"POST",url:this.logUrl,data:JSON.stringify({context:navigator.userAgent,details:e,type:n||"LOG"}),contentType:"application/json; charset=utf-8"})},error:function(t,n,i){var a=[n,i,t].join(" : ");e.log(a,"ERROR")},jQueryAjaxError:function(t,n,i){if(403!==n.status){var a=[i.url,n.status,n.statusText].join(" : ");i.url.indexOf(e.logUrl)>-1||e.log(a,"AJAXERROR")}}};return e}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i=n(15);t.exports=function(){var t=new i.Template({code:function(t,e,n){var i=this;return i.b(n=n||""),i.s(i.f("modal",t,e,1),t,e,0,10,53,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('<div class="'),i.b(i.v(i.f("overlayBackground",t,e,0))),i.b('"></div>'),i.b("\n"+n)}),t.pop()),i.b('<div class="dialog '),i.b(i.v(i.f("className",t,e,0))),i.b('">'),i.b("\n"+n),i.b('    <div class="dialog-inner">'),i.b("\n"+n),i.s(i.f("draggable",t,e,1),t,e,0,152,298,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('        <div class="dialog-header">'),i.b("\n"+n),i.b('            <div class="drag-handler">'),i.b("\n"+n),i.b("                <h3>"),i.b(i.t(i.f("dialogTitle",t,e,0))),i.b("</h3>"),i.b("\n"+n),i.b("            </div>"),i.b("\n"+n)}),t.pop()),i.b("            "),i.s(i.f("dialogClose",t,e,1),t,e,0,341,374,"{{ }}")&&(i.rs(t,e,function(t,e,n){n.b('<div class="dialog-close">×</div>')}),t.pop()),i.b("\n"+n),i.s(i.f("draggable",t,e,1),t,e,0,413,437,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b("        </div>"),i.b("\n"+n)}),t.pop()),i.s(i.f("draggable",t,e,1),t,e,1,0,0,"")||(i.b("        <h3>"),i.b(i.t(i.f("dialogTitle",t,e,0))),i.b("</h3>"),i.b("\n"+n)),i.s(i.f("draggable",t,e,1),t,e,0,555,604,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('        <div class="dialogContent">'),i.b("\n"+n)}),t.pop()),i.s(i.f("paragraph",t,e,1),t,e,0,645,693,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b("            <p>"),i.b(i.t(i.f("paragraph",t,e,0))),i.b("</p>"),i.b("\n"+n)}),t.pop()),i.s(i.f("custom",t,e,1),t,e,0,731,802,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('            <div class="customContent">'),i.b(i.t(i.f("custom",t,e,0))),i.b("</div>"),i.b("\n"+n)}),t.pop()),i.s(i.f("buttons",t,e,1),t,e,0,838,904,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('            <div class="buttons">'),i.b(i.t(i.f("buttons",t,e,0))),i.b("</div>"),i.b("\n"+n)}),t.pop()),i.s(i.f("draggable",t,e,1),t,e,0,943,967,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b("        </div>"),i.b("\n"+n)}),t.pop()),i.b("    </div>"),i.b("\n"+n),i.s(i.f("modal",t,e,1),t,e,0,1003,1011,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b("</div>"),i.b("\n"+n)}),t.pop()),i.fl()},partials:{},subs:{}},'{{#modal}}\n<div class="{{overlayBackground}}"></div>\n{{/modal}}\n<div class="dialog {{className}}">\n    <div class="dialog-inner">\n        {{#draggable}}\n        <div class="dialog-header">\n            <div class="drag-handler">\n                <h3>{{{dialogTitle}}}</h3>\n            </div>\n        {{/draggable}}\n            {{#dialogClose}}<div class="dialog-close">×</div>{{/dialogClose}}\n        {{#draggable}}\n        </div>\n        {{/draggable}}\n        {{^draggable}}\n        <h3>{{{dialogTitle}}}</h3>\n        {{/draggable}}\n        {{#draggable}}\n        <div class="dialogContent">\n            {{/draggable}}\n            {{#paragraph}}\n            <p>{{{paragraph}}}</p>\n            {{/paragraph}}\n            {{#custom}}\n            <div class="customContent">{{{custom}}}</div>\n            {{/custom}}\n            {{#buttons}}\n            <div class="buttons">{{{buttons}}}</div>\n            {{/buttons}}\n            {{#draggable}}\n        </div>\n        {{/draggable}}\n    </div>\n{{#modal}}\n</div>\n{{/modal}}',i);return t.render.apply(t,arguments)}},function(t,e){t.exports=o},function(t,e){t.exports=s},function(t,e){t.exports=r},function(t,e,n){var i=n(16);i.Template=n(17).Template,i.template=i.Template,t.exports=i},function(t,e,n){!function(t){function e(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function n(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function i(t,e,n){if(e.charAt(n)!=t.charAt(0))return!1;for(var i=1,a=t.length;i<a;i++)if(e.charAt(n+i)!=t.charAt(i))return!1;return!0}function a(e,n,i,r){var l=[],c=null,u=null,p=null;for(u=i[i.length-1];e.length>0;){if(p=e.shift(),u&&"<"==u.tag&&!(p.tag in T))throw new Error("Illegal content in < super tag.");if(t.tags[p.tag]<=t.tags.$||o(p,r))i.push(p),p.nodes=a(e,p.tag,i,r);else{if("/"==p.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+p.n);if(c=i.pop(),p.n!=c.n&&!s(p.n,c.n,r))throw new Error("Nesting error: "+c.n+" vs. "+p.n);return c.end=p.i,l}"\n"==p.tag&&(p.last=0==e.length||"\n"==e[0].tag)}l.push(p)}if(i.length>0)throw new Error("missing closing tag: "+i.pop().n);return l}function o(t,e){for(var n=0,i=e.length;n<i;n++)if(e[n].o==t.n)return t.tag="#",!0}function s(t,e,n){for(var i=0,a=n.length;i<a;i++)if(n[i].c==t&&n[i].o==e)return!0}function r(t){var e=[];for(var n in t)e.push('"'+c(n)+'": function(c,p,t,i) {'+t[n]+"}");return"{ "+e.join(",")+" }"}function l(t){var e=[];for(var n in t.partials)e.push('"'+c(n)+'":{name:"'+c(t.partials[n].name)+'", '+l(t.partials[n])+"}");return"partials: {"+e.join(",")+"}, subs: "+r(t.subs)}function c(t){return t.replace(b,"\\\\").replace(g,'\\"').replace(m,"\\n").replace(v,"\\r").replace(y,"\\u2028").replace(x,"\\u2029")}function u(t){return~t.indexOf(".")?"d":"f"}function p(t,e){var n="<"+(e.prefix||""),i=n+t.n+w++;return e.partials[i]={name:t.n,partials:{}},e.code+='t.b(t.rp("'+c(i)+'",c,p,"'+(t.indent||"")+'"));',i}function d(t,e){e.code+="t.b(t.t(t."+u(t.n)+'("'+c(t.n)+'",c,p,0)));'}function f(t){return"t.b("+t+");"}var h=/\S/,g=/\"/g,m=/\n/g,v=/\r/g,b=/\\/g,y=/\u2028/,x=/\u2029/;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(a,o){function s(){f.length>0&&(g.push({tag:"_t",text:new String(f)}),f="")}function r(){for(var e=!0,n=b;n<g.length;n++)if(!(e=t.tags[g[n].tag]<t.tags._v||"_t"==g[n].tag&&null===g[n].text.match(h)))return!1;return e}function l(t,e){if(s(),t&&r())for(var n,i=b;i<g.length;i++)g[i].text&&((n=g[i+1])&&">"==n.tag&&(n.indent=g[i].text.toString()),g.splice(i,1));else e||g.push({tag:"\n"});m=!1,b=g.length}var c=a.length,u=0,p=null,d=null,f="",g=[],m=!1,v=0,b=0,y="{{",x="}}";for(o&&(o=o.split(" "),y=o[0],x=o[1]),v=0;v<c;v++)0==u?i(y,a,v)?(--v,s(),u=1):"\n"==a.charAt(v)?l(m):f+=a.charAt(v):1==u?(v+=y.length-1,d=t.tags[a.charAt(v+1)],p=d?a.charAt(v+1):"_v","="==p?(v=function(t,e){var i="="+x,a=t.indexOf(i,e),o=n(t.substring(t.indexOf("=",e)+1,a)).split(" ");return y=o[0],x=o[o.length-1],a+i.length-1}(a,v),u=0):(d&&v++,u=2),m=v):i(x,a,v)?(g.push({tag:p,n:n(f),otag:y,ctag:x,i:"/"==p?m-y.length:v+x.length}),f="",v+=x.length-1,u=0,"{"==p&&("}}"==x?v++:e(g[g.length-1]))):f+=a.charAt(v);return l(m,!0),g};var T={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(e,n,i){return"{code: function (c,p,i) { "+t.wrapMain(e.code)+" },"+l(e)+"}"};var w=0;t.generate=function(e,n,i){w=0;var a={code:"",subs:{},partials:{}};return t.walk(e,a),i.asString?this.stringify(a,n,i):this.makeTemplate(a,n,i)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,e,n){var i=this.makePartials(t);return i.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(i,e,this,n)},t.makePartials=function(t){var e,n={subs:{},partials:t.partials,name:t.name};for(e in n.partials)n.partials[e]=this.makePartials(n.partials[e]);for(e in t.subs)n.subs[e]=new Function("c","p","t","i",t.subs[e]);return n},t.codegen={"#":function(e,n){n.code+="if(t.s(t."+u(e.n)+'("'+c(e.n)+'",c,p,1),c,p,0,'+e.i+","+e.end+',"'+e.otag+" "+e.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(e.nodes,n),n.code+="});c.pop();}"},"^":function(e,n){n.code+="if(!t.s(t."+u(e.n)+'("'+c(e.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(e.nodes,n),n.code+="};"},">":p,"<":function(e,n){var i={partials:{},code:"",subs:{},inPartial:!0};t.walk(e.nodes,i);var a=n.partials[p(e,n)];a.subs=i.subs,a.partials=i.partials},$:function(e,n){var i={subs:{},code:"",partials:n.partials,prefix:e.n};t.walk(e.nodes,i),n.subs[e.n]=i.code,n.inPartial||(n.code+='t.sub("'+c(e.n)+'",c,p,i);')},"\n":function(t,e){e.code+=f('"\\n"'+(t.last?"":" + i"))},_v:function(t,e){e.code+="t.b(t.v(t."+u(t.n)+'("'+c(t.n)+'",c,p,0)));'},_t:function(t,e){e.code+=f('"'+c(t.text)+'"')},"{":d,"&":d},t.walk=function(e,n){for(var i,a=0,o=e.length;a<o;a++)(i=t.codegen[e[a].tag])&&i(e[a],n);return n},t.parse=function(t,e,n){return n=n||{},a(t,"",[],n.sectionTags||[])},t.cache={},t.cacheKey=function(t,e){return[t,!!e.asString,!!e.disableLambda,e.delimiters,!!e.modelGet].join("||")},t.compile=function(e,n){n=n||{};var i=t.cacheKey(e,n),a=this.cache[i];if(a){var o=a.partials;for(var s in o)delete o[s].instance;return a}return a=this.generate(this.parse(this.scan(e,n.delimiters),e,n),e,n),this.cache[i]=a}}(e)},function(t,e,n){!function(t){function e(t,e,n){var i;return e&&"object"==typeof e&&(void 0!==e[t]?i=e[t]:n&&e.get&&"function"==typeof e.get&&(i=e.get(t))),i}function n(t,e,n,i,a,o){function s(){}function r(){}s.prototype=t,r.prototype=t.subs;var l,c=new s;c.subs=new r,c.subsText={},c.buf="",i=i||{},c.stackSubs=i,c.subsText=o;for(l in e)i[l]||(i[l]=e[l]);for(l in i)c.subs[l]=i[l];a=a||{},c.stackPartials=a;for(l in n)a[l]||(a[l]=n[l]);for(l in a)c.partials[l]=a[l];return c}function i(t){return String(null===t||void 0===t?"":t)}function a(t){return t=i(t),u.test(t)?t.replace(o,"&amp;").replace(s,"&lt;").replace(r,"&gt;").replace(l,"&#39;").replace(c,"&quot;"):t}t.Template=function(t,e,n,i){t=t||{},this.r=t.code||this.r,this.c=n,this.options=i||{},this.text=e||"",this.partials=t.partials||{},this.subs=t.subs||{},this.buf=""},t.Template.prototype={r:function(t,e,n){return""},v:a,t:i,render:function(t,e,n){return this.ri([t],e||{},n)},ri:function(t,e,n){return this.r(t,e,n)},ep:function(t,e){var i=this.partials[t],a=e[i.name];if(i.instance&&i.base==a)return i.instance;if("string"==typeof a){if(!this.c)throw new Error("No compiler available.");a=this.c.compile(a,this.options)}if(!a)return null;if(this.partials[t].base=a,i.subs){e.stackText||(e.stackText={});for(key in i.subs)e.stackText[key]||(e.stackText[key]=void 0!==this.activeSub&&e.stackText[this.activeSub]?e.stackText[this.activeSub]:this.text);a=n(a,i.subs,i.partials,this.stackSubs,this.stackPartials,e.stackText)}return this.partials[t].instance=a,a},rp:function(t,e,n,i){var a=this.ep(t,n);return a?a.ri(e,n,i):""},rs:function(t,e,n){var i=t[t.length-1];if(!p(i))return void n(t,e,this);for(var a=0;a<i.length;a++)t.push(i[a]),n(t,e,this),t.pop()},s:function(t,e,n,i,a,o,s){var r;return(!p(t)||0!==t.length)&&("function"==typeof t&&(t=this.ms(t,e,n,i,a,o,s)),r=!!t,!i&&r&&e&&e.push("object"==typeof t?t:e[e.length-1]),r)},d:function(t,n,i,a){var o,s=t.split("."),r=this.f(s[0],n,i,a),l=this.options.modelGet,c=null;if("."===t&&p(n[n.length-2]))r=n[n.length-1];else for(var u=1;u<s.length;u++)o=e(s[u],r,l),void 0!==o?(c=r,r=o):r="";return!(a&&!r)&&(a||"function"!=typeof r||(n.push(c),r=this.mv(r,n,i),n.pop()),r)},f:function(t,n,i,a){for(var o=!1,s=null,r=!1,l=this.options.modelGet,c=n.length-1;c>=0;c--)if(s=n[c],void 0!==(o=e(t,s,l))){r=!0;break}return r?(a||"function"!=typeof o||(o=this.mv(o,n,i)),o):!a&&""},ls:function(t,e,n,a,o){var s=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(i(t.call(e,a)),e,n)),this.options.delimiters=s,!1},ct:function(t,e,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(e,n)},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ms:function(t,e,n,i,a,o,s){var r,l=e[e.length-1],c=t.call(l);return"function"==typeof c?!!i||(r=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,l,n,r.substring(a,o),s)):c},mv:function(t,e,n){var a=e[e.length-1],o=t.call(a);return"function"==typeof o?this.ct(i(o.call(a)),a,n):o},sub:function(t,e,n,i){var a=this.subs[t];a&&(this.activeSub=t,a(e,n,this,i),this.activeSub=!1)}};var o=/&/g,s=/</g,r=/>/g,l=/\'/g,c=/\"/g,u=/[&<>\"\']/,p=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(e)},function(t,e,n){var i,a;i=[n(1),n(0),n(4)],void 0!==(a=function(t,e,n){return t.Class.sub({config:null,healthcheckUrl:null,init:function(t){this.config=e.extend({},t),this.healthcheckUrl=n.healthcheckUrl},call:function(){var t=this;return e.ajax({type:"GET",url:t.healthcheckUrl,processData:!1,contentType:!1})}})}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(0),n(8)],void 0!==(a=function(t,e){function n(n,i){function a(){v.addClass("focus")}function o(){v.removeClass("focus")}function r(t){g.prop("selectedIndex",b);var e=d.removeClass("selected").filter(":nth("+b+")").addClass("selected"),n=f.scrollTop(),i=e.position().top,a=n+(i+e.outerHeight()),o=f.height();a>=n?f.scrollTop(a-o):a<n&&f.scrollTop(a-o),h.text(e.text()),t&&g.trigger("change")}function c(t){b=g.prop("selectedIndex"),(40===t.which||38===t.which||13===t.which&&m)&&t.preventDefault(),40===t.which?b=b<d.length-1?b+1:b:38===t.which&&(b=b?b-1:b),r(),13!==t.which&&27!==t.which||p()}function u(){v.addClass("open").trigger("fancy.select.open"),a(),b=g.prop("selectedIndex"),r(),l.on("keydown",c),m=!0}function p(t){m&&(v.removeClass("open"),o(),l.off("keydown",c),m=!1)}var d,f,h,g=t(i),m=!1,v={choice:g[0].options[g[0].selectedIndex].innerHTML,options:[]},b=0;g.find("option").each(function(e){v.options.push({key:t.trim(this.innerHTML),value:this.getAttribute("value")})}),v=t(e.render(s,v)),v.delegate("li","click",function(){var t=this.getAttribute("data-value");t!==g.val()&&(g.val(t),b=g.prop("selectedIndex"),r(!0))}).click(function(t){m?p():u(),g.focus(),t.stopPropagation()}),f=v.find("ul"),d=f.find("li"),h=v.find(".choice"),v.insertAfter(g),g.css({position:"absolute",left:-9999}).show().on("keyup change",function(t){var e=g.prop("selectedIndex");b!==e&&(b=e),r()}).focus(a).blur(o).attr("tabindex","0"),l.on("click",p),l.on("fancy.select.open",function(){this!==v[0]&&p()})}function i(n,i){function a(){l.addClass("focus")}function o(){l.removeClass("focus")}i=t(i);var s,l={choice:i.val()};l=t(e.render(r,l)),l.insertAfter(i),l.append(i),l.css({overflow:"hidden",position:"relative"}),s=l.find(".choice"),i.css({border:"500px solid transparent",position:"absolute",top:0,right:0,opacity:0}).attr("tabindex","0").change(function(){var t=i.val();s.text(t.length>22?t.substr(0,15)+"..."+t.substr(t.length-6):t)}).focus(a).blur(o)}function a(e,n){var i=t(n),a=t('<span class="fancy-checkbox"><span></span></span>');a.toggleClass("disabled",this.disabled),a.toggleClass("checked",this.checked),a.click(function(t){n.disabled||(t.stopPropagation(),t.preventDefault(),i.click())}),i.change(function(){n.disabled||a.toggleClass("checked",this.checked)}),i.focus(function(){n.disabled||a.addClass("focus")}).blur(function(){n.disabled||a.removeClass("focus")}),i.before(a),i.css({position:"absolute",left:-99999}).attr("tabindex","0")}function o(e,n){var i=t(n),a=t('<span class="fancy-radio"><span></span></span>');c.push({radio:this,replacement:a}),a.toggleClass("disabled",this.disabled),a.toggleClass("checked",this.checked),a.click(function(t){n.disabled||(t.stopPropagation(),t.preventDefault(),i.click())}),i.change(function(){n.disabled||t.each(c,function(t,e){e.replacement.toggleClass("checked",e.radio.checked)})}),i.focus(function(){n.disabled||a.addClass("focus")}).blur(function(){n.disabled||a.removeClass("focus")}),i.before(a),i.css({position:"absolute",left:-99999}).attr("tabindex","0")}var s="".concat('<span class="fancy-select">','<span class="choice">{{choice}}</span>',"<ul>","{{#options}}",'<li data-value="{{value}}" data-key="{{key}}"><span>{{key}}</span></li>',"{{/options}}","</ul>",'<span class="button">select</span>',"</span>"),r="".concat('<span class="fancy-file">','<span class="choice">{{choice}}</span>','<span class="button">browse</span>',"</span>"),l=t(document),c=[],u={select:!0,file:!0,checkbox:!0,radio:!0,text:!0,textarea:!0};t.fn.fancyForm=function(e){return e=t.extend({},u,e),e.select&&this.find("select:not([multiple])").each(n),e.file&&this.find("input[type=file]").each(i),e.checkbox&&this.find("input[type=checkbox]").each(a),e.radio&&this.find("input[type=radio]").each(o),e.text&&this.find("input[type=text]").attr("tabindex","0").addClass("fancy-text"),e.textarea&&this.find("textarea").attr("tabindex","0").addClass("fancy-textarea"),this}}.apply(e,i))&&(t.exports=a)},function(t,e){t.exports=l},function(t,e){t.exports=c},function(t,e,n){var i,a;i=[n(1),n(0),n(4),n(23),n(3)],void 0!==(a=function(t,e,n,i,a){var o;return t.Class.sub({config:null,appData:null,commons:null,init:function(t){this.config=e.extend({},t,i),this.appData=n,this.commons=new a},start:function(t,n){function i(){if((s+=1)>parseInt(a.appData.navigationMaxAttempts,10))return a.config.reconnectDialog.openAppendToBody(),void a.enableStartButton(n);e.ajax({type:"POST",url:t,processData:!1,contentType:!1}).done(function(t){if("showReconnectScreen"===t)return a.config.reconnectDialog.openAppendToBody(),void a.enableStartButton(n);var e=a.commons.relativePath();document.location=e+t}).fail(function(){o=setTimeout(function(){i()},a.appData.navigationRetryDelay)})}var a=this,s=0;a.disableStartButton(n),i()},enableStartButton:function(t){t.removeAttr("disabled"),t.removeClass("pulse")},disableStartButton:function(t){t.attr("disabled","disabled"),t.addClass("pulse")},clearTimeout:function(){clearTimeout(o)},startAssessment:function(){this.start(this.config.url,e(this.config.btnStartId))},startAssessmentTestPart:function(){var t=this.config.url+"/"+document.location.pathname.split("/").pop();this.start(t,e(this.config.testpartStartButton))}})}.apply(e,i))&&(t.exports=a)},function(t,e){t.exports=u},function(t,e,n){var i,a;i=[n(1),n(0)],void 0!==(a=function(t,e){window.qadeEnableHeartbeatLog=function(){sessionStorage.setItem("qadeHeartbeatLogging","enabled")},window.qadeDisableHeartbeatLog=function(){sessionStorage.removeItem("qadeHeartbeatLogging")};var n,i,a=0,o=t.Class.sub({init:function(t){this.config=e.extend({},t),this.config.pulse=1e3*this.config.pulse},start:function(){clearTimeout(n),i=e.ajax({url:this.config.monitor,context:this,contentType:"application/json; charset=UTF-8",dataType:"json"}).done(function(t){parseInt(a,10)>0&&(a=0),this.beat(t)}).fail(function(t){parseInt(this.config.threshold,10)>0&&(a++,parseInt(a,10)>=parseInt(this.config.threshold,10)&&(t.sessionState="AUTO_PAUSED")),this.beat(t)})},stop:function(){clearTimeout(n)},isResolved:function(){return"pending"!==i.state()},beat:function(t){var e=sessionStorage.getItem("qadeHeartbeatLogging");null!==e&&"enabled"===e&&console.log(t),this.trigger("beat",t),this.queue()},queue:function(){var t=this;n=setTimeout(function(){t.start()},this.config.pulse)}});return o.include(t.Events),o}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(0),n(21)],void 0!==(a=function(t,e){function n(t){this.itemResult=t.itemResult,this.itemRefIdentifier=t.itemRefIdentifier,this.navUrl=t.navUrl,this.navigationMaxAttempts=t.navigationMaxAttempts,this.navigationRetryDelay=t.navigationRetryDelay}var i,a,o=!1;return n.prototype={pendingFor:{},itemResult:null,itemRefIdentifier:null,navUrl:null,navTimeout:null,goTo:function(e,n,i,o){if(void 0!==a&&"pending"===a.state()){var s=t.Deferred();return s.reject({message:"The previous navigation call still being processed. Not possible to process call for identifier ==> "+o}),s.promise()}return this.doRequest.call(this,{navigationIntent:e||null,actor:n||null,confirmed:i||!1},o)},available:function(){return!o&&!this.hasPending()},isDisabled:function(){return o},disable:function(){o=!0},enable:function(){o=!1},hasPending:function(){return Object.keys(this.pendingFor).length>0},isPendingFor:function(t){return void 0===this.pendingFor[t]?null:this.pendingFor[t]},releasePendingFor:function(t){void 0!==this.pendingFor[t]&&delete this.pendingFor[t]},releasePendingForAll:function(){if(this.hasPending())for(var t in this.pendingFor)this.pendingFor.hasOwnProperty(t)&&delete this.pendingFor[t]},clearTimeout:function(){clearTimeout(i)},doRequest:function(n,s){function r(o,s){if((c+=1)>parseInt(l.navigationMaxAttempts,10))return a.reject(o,s);t.ajax({type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",url:l.navUrl,data:JSON.stringify(t.extend({itemResult:u,itemRefIdentifier:l.itemRefIdentifier||""},n))}).done(function(t){a.resolve(t)}).fail(function(t,n,a){if(t&&t.responseText&&""!==t.responseText){var o=JSON.parse(t.responseText);"PAUSED"===o.sessionState&&(document.location=e+o.destination)}i=setTimeout(function(){r(a,t)},l.navigationRetryDelay)})}var l=this,c=0;if(a=t.Deferred(),this.hasPending()&&null===this.isPendingFor(s)||o)return a.reject({message:"Navigator is "+(this.hasPending()?"busy":"disabled")}),a.promise();null===this.isPendingFor(s)&&(this.pendingFor[s]=!0);var u="";return this.itemResult&&(u="string"==typeof this.itemResult?this.itemResult:this.itemResult.toString()),r(),a.promise()}},n}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(0),n(1),n(20),n(25),n(5),n(21),n(2),n(10),n(9),n(24),n(18),n(22),n(3)],void 0!==(a=function(t,e,n,i,a,o,s,r,l,c,u,p,d){var f,h=a.getConfirmDialog,g=a.getOkDialog,m=a.getReconnectDialog,v=a.getSpinnerDialog;return e.Controller.sub({qtiForm:null,appData:null,qtiData:null,confirmedTimeout:!1,lastItemResult:null,heartbeat:null,reconnectDialog:null,spinnerDialog:null,healthcheck:null,player:null,commons:null,events:{"click [data-qade-log]":"handleLog","submit form#qtiform":"preventDefault","change form#qtiform":"updateItemResult","click button.marking":"handleMarking","click button#assessmentStartButton":"handleStartAssessment","click button#testpartStartButton":"handleTestPart"},init:function(){this._deferred=t.Deferred(),this._promise=this._deferred.promise(),this.navigator=new i({itemRefIdentifier:this.qtiData.itemRefIdentifier,navUrl:this.appData.navUrl,navigationMaxAttempts:this.appData.navigationMaxAttempts,navigationRetryDelay:this.appData.navigationRetryDelay}),this.commons=new d,this.setupHeartbeat(),this.healthcheck=new u,this.setupOfflineScenario(),this.player=new p({reconnectDialog:this.reconnectDialog,spinnerDialog:this.spinnerDialog}),this.done(this.proxy(this.activate)),this.initQTI()},activate:function(){t(this.el).on("click","[data-qade-destination]",this.proxy(this.navigate)),t(this.el).on("updateItemResult","form#qtiform",this.proxy(this.updateItemResult)),t(this.player.config.btnStartId).removeAttr("disabled"),t(this.player.config.btnTestPartId).removeAttr("disabled"),this.startHeartbeat()},setupOfflineScenario:function(){this.reconnectDialog=m.getInstance("reconnect",t.proxy(this.reconnect,this),t.proxy(this.healthcheck.call,this.healthcheck),this),this.spinnerDialog=v.getInstance("spinner")},clearTimeout:function(){clearTimeout(f)},reconnect:function(){var e=this,n=parseInt(e.appData.reconnectDelay,10),i=t.proxy(e._doNavigate,e);e.reconnectDialog.close(),e.spinnerDialog.openAppendToBody(),f=setTimeout(function(){t.ajax({url:e.appData.reconnectUrl,context:this,contentType:"application/json; charset=UTF-8",dataType:"json"}).done(function(t){e.spinnerDialog.close(),t.reconnect=!0,i(t)}).fail(function(t,n,i){try{if(t&&t.responseText&&""!==t.responseText){var a=JSON.parse(t.responseText);"OPEN"===a.sessionState||"STARTED"===a.sessionState?e.player.startAssessment():"PAUSED"!==a.sessionState&&"ABORTED"!==a.sessionState||e._doNavigate(a)}else e.spinnerDialog.close(),e.reconnectDialog.openAppendToBody()}catch(n){e.handleIllegalSessionState(t,i)}})},n)},setupHeartbeat:function(){if("REVIEW"!==this.appData.mode&&-1!==this.appData.heartbeatInterval){(this.heartbeat=new c({pulse:this.appData.heartbeatInterval,monitor:this.appData.heartbeatUrl,threshold:this.appData.heartbeatOfflineThreshold})).bind("beat",this.proxy(function(t){t.exceptionName?(this.stopHeartbeat(),this.trigger("qade.error",t,"HEARTBEATERROR")):t.responseJSON&&t.responseJSON.exceptionName?(this.stopHeartbeat(),this.trigger("qade.error",t.responseJSON,"HEARTBEATERROR")):403===t.status?(this.stopHeartbeat(),this.handleIllegalSessionState(t)):"AUTO_PAUSED"===t.sessionState?(this.stopHeartbeat(),this.player.clearTimeout(),this.navigator.clearTimeout(),this.spinnerDialog.close(),this.reconnectDialog.openAppendToBody()):t.timeRemaining>-1&&(this.setRemainingTimeType(t.remainingTimeType),this.setRemainingTime(t.timeRemaining))})),t(this.el).bind("qade.navigate",this.proxy(function(){this.stopHeartbeat()})),t(this.el).bind("qade.navigate-cancelled",this.proxy(function(){this.startHeartbeat()}))}},handleStartAssessment:function(){this.player.startAssessment()},handleTestPart:function(){this.player.startAssessmentTestPart()},handleMarking:function(){var e=t(".marking:first"),n=t('[data-ref-id="'+this.qtiData.itemRefIdentifier+'"]'),i=t.ajax({type:"PUT",url:e.data("href")});i.done(t.proxy(function(i){var a=e.data(i?"text-unmarked":"text-marked");e.text(a).add(n).toggleClass("marked",i),t(this.el).trigger("qade-mark-question",{button:e,texts:a})},this)),i.fail(t.proxy(function(t){console.log("Marking failed!"),this.handleIllegalSessionState(t)},this))},handleIllegalSessionState:function(t,e){try{if(t&&t.responseText&&""!==t.responseText){var n=JSON.parse(t.responseText);switch(n.sessionState){case"AUTO_PAUSED":this.stopHeartbeat(),this.reconnectDialog.openAppendToBody();break;case"STARTED":case"PAUSED":this.stopHeartbeat(),this._doNavigate(n);break;case"ABORTED":this.stopHeartbeat(),g.getInstance("session.aborted",function(){document.location=sessionStorage.getItem("qade-exceptionexiturl")});break;default:r.error(t.responseText,"application.js",264)}}else r.error(e,"application.js",268)}catch(e){r.error(e,"application.js",271),r.error(t,"application.js",272)}this.el.trigger("qade.forbidden",t)},done:function(t){return this._promise.done(t)},hasAssessment:function(){return this.qtiForm.length&&this.qtiData.xml},initQTI:function(e){if(!this.hasAssessment())return void this._deferred.resolve();var i=this.qtiData,a=this.qtiForm;e=e||i.itemResult;var o=this.appData.readOnly||0===this.qtiData.remainingTime,s=this.commons.relativePath(),r={el:a[0],baseURI:s+"/player/content/",xmlNode:t.parseXML(i.xml),itemRefIdentifier:i.itemRefIdentifier,itemResult:e?t.parseXML(e):"",readOnly:o};this.clearQTI(),this.qtiEngine=new n(r),this.qtiEngine.done(this.proxy(function(){this._deferred.resolve(),t(this.el).trigger("qti.render"),i.remainingTime>-1&&(this.countdown=new l(i.remainingTime))})),null===this.lastItemResult?this.itemResult=this.lastItemResult=this.navigator.itemResult=new n.ItemResult(this.qtiEngine):this.itemResult=new n.ItemResult(this.qtiEngine),this.qtiEngine.render()},getRemainingTime:function(){return this.countdown?this.countdown.getTime():this.qtiData.remainingTime},setRemainingTime:function(t){this.countdown&&this.countdown.setTime(t)},getRemainingTimeType:function(){return this.qtiData.remainingTimeType},setRemainingTimeType:function(t){this.qtiData.remainingTimeType=t},renderInReadOnly:function(){this.appData.readOnly=!0,this.setLastItemResult(this.itemResult.toString()),this.navigator.itemResult=this.getLastItemResult(),this.initQTI(this.itemResult.toString())},setLastItemResult:function(t){this.lastItemResult=t},getLastItemResult:function(){return this.lastItemResult},clearQTI:function(){this.qtiForm.html("")},_doNavigate:function(e){function n(){if(e.destination){var n=o+e.destination;n!==document.location.pathname||e.reconnect?(a.navigator.disable(),t(a.el).trigger("qade.exit"),"showReconnectScreen"===e.destination?(a.stopHeartbeat(),a.reconnectDialog.openAppendToBody()):document.location=n):(t(a.el).trigger("qade.navigate-cancelled"),a.navigator.releasePendingForAll())}else e.exceptionName&&(a.trigger("qade.error",e,"NAVIGATIONERROR"),a.navigator.releasePendingForAll())}var i=!1,a=this;a.trigger("qade.navigate",[function(){i=!0},n]),i||n()},handleLog:function(t){var e=t.target,n=e.getAttribute("data-qade-log"),i=e.getAttribute("data-qade-logtype");n&&r.log(n,i)},goTo:function(t,e,n,i){return this.stopHeartbeat(),this.navigator.goTo(t,e,n,i)},navigate:function(e){var n=this,i=e.target,a=i.getAttribute("data-qade-destination"),o=i.getAttribute("data-qade-dialog"),s=t.proxy(n._doNavigate,n);if(n.requestIdentifier="RAID"+Date.now,a&&n.navigator.available()){n.toggleNavigationPulseAnimation(a,!0);n.goTo(a,"user",n.confirmedTimeout,n.requestIdentifier,o).done(function(t){t.confirmationRequired?"timeExpired"===t.confirmationRequired&&(n.appData.skipDialogTimeExpired||n.appData.skipDialogOnItemTimeExpired)?n.handleNavigateConfirmed(n,a,"timeout",s):"unanswered"===t.confirmationRequired&&n.appData.skipDialogUnanswered?n.handleNavigateConfirmed(n,a,"unanswered",s):("submitTestPart"===t.confirmationRequired||"submitAssessment"===t.confirmationRequired)&&n.appData.skipDialogSubmit||"skipDialogSubmit"===o?n.handleNavigateConfirmed(n,a,"submit",s):"submitTestPartUnanswered"!==t.confirmationRequired&&"submitAssessmentUnanswered"!==t.confirmationRequired||!n.appData.skipDialogSubmitUnanswered?n.handleConfirmationDialog(n,a,t,s):n.appData.skipDialogSubmit?n.handleNavigateConfirmed(n,a,"submitUnanswered",s):("submitTestPartUnanswered"===t.confirmationRequired?t.confirmationRequired="submitTestPart":"submitAssessmentUnanswered"===t.confirmationRequired&&(t.confirmationRequired="submitAssessment"),n.handleConfirmationDialog(n,a,t,s)):s(t)}).fail(t.proxy(function(t,e){n.handleNavigateFailure(n.requestIdentifier,e,t)},n))}},toggleNavigationPulseAnimation:function(e,n){switch(e){case"key:NEXT":t(".next").toggleClass("pulse",n);break;case"key:PREVIOUS":t(".prev").toggleClass("pulse",n);break;default:var i=t('span[data-qade-destination="'+e+'"]');if(i.parent("div#navbar-items-active").length>0)break;i.find(".navigation-item").toggleClass("pulse",n)}},handleConfirmationDialog:function(t,e,n,i){t.startHeartbeat(),h.getInstance.call(t,[n.confirmationRequired,s.getMessage("this."+t.qtiData.remainingTimeType)],function(){t.handleNavigateConfirmed(t,e,"user",i)},function(){t.navigator.releasePendingFor(t.requestIdentifier),"timeExpired"===n.confirmationRequired&&(t.confirmedTimeout=!0),t.toggleNavigationPulseAnimation(e,!1)})},handleNavigateConfirmed:function(e,n,i,a){e.navigator.releasePendingFor(e.requestIdentifier);var o=e.goTo(n,i,!0,e.requestIdentifier);o.done(a),o.fail(t.proxy(function(t,n){e.handleNavigateFailure(e.requestIdentifier,n)},this))},handleNavigateFailure:function(t,e,n){this.handleIllegalSessionState(e,n),this.navigator.releasePendingFor(t),this.stopHeartbeat(),this.spinnerDialog.close(),this.reconnectDialog.openAppendToBody()},preventDefault:function(t){t.preventDefault()},stopHeartbeat:function(){this.heartbeat&&this.heartbeat.stop()},startHeartbeat:function(){this.heartbeat&&this.heartbeat.start()},updateItemResult:function(){var e=this;setTimeout(function(){var n=e.lastItemResult.toString();t(document).trigger("itemResultupdated",n)},250)}})}.apply(e,i))&&(t.exports=a)},,,,function(t,e){},function(t,e){},,,,function(t,e,n){var i,a;i=[n(0),n(1)],void 0!==(a=function(t,e){function n(t){return("00"+t).slice(-2)}return e.Controller.sub({time:0,type:"hidden",init:function(){this.setTime(this.time),this.setType(this.type)},setTime:function(t){this.el.text(this.format(t)),this.el.trigger("qti-timeupdate",t)},setType:function(t){this.el.attr({class:"qade-clock "+t,title:this.el.data("title-"+t.toLowerCase())})},format:function(t){t=Math.round(t);var e=t%60;t-=e;var i=t/60%60;return t-=60*i,[n(t/60/60),n(i),n(e)].join(":")}})}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(5),n(2),n(0),n(53),n(9)],void 0!==(a=function(t,e,n,i,a){function o(){if("ITEM-PREVIEW"===r.appData.mode)location.href=i;else{r.requestIdentifier="RAID"+Date.now();var t=r.goTo("key:NEXT","timeout",!0,r.requestIdentifier);t.done(n.proxy(r._doNavigate,r)),t.fail(n.proxy(function(t,e){this.handleIllegalSessionState(e,t),r.navigator.releasePendingFor(r.requestIdentifier)},r))}}var s,r,l,c,u,p,d={updateClock:function(){l.setTime(r.getRemainingTime()),l.setType(r.getRemainingTimeType())},start:function(){d.stop(),d.updateClock(),s=setInterval(function(){d.updateClock(),r.getRemainingTime()<=0&&(r.renderInReadOnly(),r.appData.skipDialogTimeExpired||r.appData.skipDialogOnItemTimeExpired?o():p.getInstance(["timeExpired",e.getMessage("this."+r.getRemainingTimeType())],o,function(){r.confirmedTimeout=!0}),d.stop())},100)},stop:function(){clearInterval(s)}},f={start:function(){f.stop(),s=setInterval(function(){var t=u.getTime();t>0?l.setTime(t):f.stop()},100)},stop:function(){clearInterval(s)}};return{getInstance:function(e,n){return c||(r=e,l=n,p=t[r.appData.linear?"getOkDialog":"getConfirmDialog"],r.qtiForm.length?c=d:(u=new a(r.getRemainingTime()),c=f)),c}}}.apply(e,i))&&(t.exports=a)},function(t,e,n){var i,a;i=[n(0),n(1),n(4),n(10),n(5)],void 0!==(a=function(t,e,n,i,a){var o,s=null,r=a.getOkDialog;return e.Class.sub({timebehaviour:null,init:function(){o=this,this.setupExceptionLogging()},setupExceptionLogging:function(){i.logUrl=n.logUrl,window.onerror=i.error,t(document).ajaxError(i.jQueryAjaxError)},setTimebehaviourReference:function(t){this.timebehaviour=t},getExceptionMessage:function(t){return{message:t.message||"no message",exceptionId:t.exceptionId||"no exception id",exceptionName:t.exceptionName||"no exception name",serverName:t.serverName||"no server name",exceptionExitUrl:t.exceptionExitUrl||"no exception exit url"}},handleException:function(t,e){"AssessmentSessionCookieNotFoundException"===t.exceptionName?null===s&&(s=!0,null!==o.timebehaviour&&o.timebehaviour.stop(),r.getInstance(t.exceptionName,function(){var e=sessionStorage.getItem("qade-exceptionexiturl");document.location=e||t.exceptionExitUrl}),i.log(o.getExceptionMessage(t),e||"ERROR")):i.log(o.getExceptionMessage(t),e||"ERROR")}})}.apply(e,i))&&(t.exports=a)},,,,function(t,e){t.exports=p},,,,function(t,e,n){var i,a;i=[n(0),n(41),n(4),n(26),n(37),n(5),n(10),n(9),n(35),n(36),n(19),n(30),n(31)],void 0!==(a=function(t,e,i,a,o,s,r,l,c,u){var p,d,f=new o;t.ajaxSetup({cache:!1,accepts:{json:"application/json"}}),new Promise(function(t){t()}).then(function(){var t=[n(56)];(function(t){t.setDefaultId(i.sessionId)}).apply(null,t)}).catch(n.oe),t(function(){function n(){localStorage.setItem("touch_device","true"),window.removeEventListener("touchstart",n)}var o=new a({el:document,qtiForm:t("#qtiform"),qtiData:e,appData:i});o.bind("qade.error",f.handleException),o.bind("timeBehaviour.stop",function(){p&&"function"==typeof p.stop&&p.stop()}),e.remainingTime>-1&&(d=new c({el:t(".qade-clock"),time:o.getRemainingTime(),type:o.getRemainingTimeType()}),p=u.getInstance(o,d),f.setTimebehaviourReference(p)),t(o.el).bind("qti.render",function(){o.qtiForm.fancyForm({select:!1})}),o.done(function(){o.qtiForm.find("input,textarea,select").filter(":visible").first().focus(),p&&0!==e.remainingTime&&p.start()});var s=!1;t(document).on("click",".toggleCorrectAnswer",function(){var t=this.getAttribute("data-text-correctAnswer"),e=this.getAttribute("data-text-yourAnswer"),n=s?null:i.correctAnswerXML;o.initQTI(n),this.innerHTML=s?t:e,s=!s,o.qtiForm.toggleClass("correctAnswer",s)}),window.addEventListener("touchstart",n)})}.apply(e,i))&&(t.exports=a)},,,,,,,,function(t,e){t.exports=d},,,function(t,e){t.exports=f}])});