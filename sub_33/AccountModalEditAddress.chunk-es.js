webpackJsonp([12],{251:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t(9),i=t(153),d=t(2),a=t(239),o=t(154),n=t(155);const c="Adres[AdresseerbareAdresID]",l="Adres[Label]",m="Adres[Zipcode]",h="Adres[Housenumber]",u="Adres[HousenumberAdd]",A="Adres[Address]",f="Adres[City]",b="Adres[District]",w="Adres[IsActief]",g="Adres[IsPrimair]",p="Afwezigheidsrooster[AfwezigheidID]",v="Afwezigheidsrooster[Aanwezig]",k="address-edit-errors",S=document.querySelector(`[js-hook-${k}]`),R="[js-hook-form-streetname]",j="u-hidden",C="js-form-item",D="form__item--lap-active";s.default=class AccountModalEditAddress extends i.default{get formId(){return"edit-address"}constructor(e){super(e),this.formItems=[...this.element.querySelectorAll(`.${C}`)],this.streetNameBlock=this.element.querySelector(R),d.a.$on("modal[modal-edit-address]::open",(e,s)=>{const t=s.button;if(!t)return;const r={addressId:c,addressLabel:l,addressZipcode:m,addressHousenumber:h,addressHousenumberAdd:u,addressAddress:A,addressCity:f,addressDistrict:b,addressIsActive:w,addressIsPrimair:g,addressAbsenceRoster:p,addressHasAbsenceRoster:v};Object.keys(r).forEach(e=>{const s=this.inputs[r[e]];if(void 0===s)return;const i=t.dataset[e]?t.dataset[e]:"";if(s.setAttribute("value",i),"addressAbsenceRoster"!==e){if("hidden"!==s.type&&i){const e=s.closest(`.${C}`);if(!e)return;e.classList.add(D)}}else"false"===t.dataset.addressHasAbsenceRoster?s.setAttribute("checked","checked"):s.removeAttribute("checked")})}),d.a.$on("modal[modal-edit-address]::close",()=>{this.element.reset(),Object(o.a)(k),this.formItems.forEach(e=>{e.classList.remove(D)}),this.element.removeChild(this.streetNameBlock)})}onFormChange(e){"change"===e.eventType&&Object(a.a)(this.state,e,m,h,u).then(e=>!e||(this.loading=!0,Object(a.b)(this.element,this.state,m,h,u))).then(e=>{if(e){if(this.state.isValid&&(this.loading=!1),e.Adres){var s=e.Adres;const t=s.Gemeente,r=s.Plaatsnaam,i=s.Straatnaam;this.inputs["Adres[Address]"].value=i,this.inputs["Adres[City]"].value=r,this.inputs["Adres[District]"].value=t,this.showStreetnameBlock(!0,`${i}, ${r}`)}}else this.loading=!1,this.showStreetnameBlock(!1)}).catch(()=>{this.loading=!1})}onFormSubmit(){this.formSubmitTimeout&&clearTimeout(this.formSubmitTimeout),this.loading=!0,this.formSubmitTimeout=setTimeout(()=>{Object(o.a)(k),Promise.all([this.updateAddress(),this.updateAbsenceRoster()]).then(e=>{e.every(e=>e)?window.location.reload():(this.loading=!1,Object(o.b)(S,window.messages.validationAddressChange,k))})},500)}updateAddress(){const e=new FormData(this.element);return e.set("method",window.EnvironmentSettings.api.changeAddress),this.executeCall(e)}updateAbsenceRoster(){const e=this.element.elements["Afwezigheidsrooster[AfwezigheidID]"];if(e.checked){if(""!==e.value)return this.removeAbsenceRoster(e.value)}else if(""===e.value)return this.addAbsenceRoster(e);return Promise.resolve(!0)}removeAbsenceRoster(e){const s=new FormData;return s.set("method",window.EnvironmentSettings.api.removeAwayScheduleV2),s.set("AfwezigheidsRoosterID",e),this.executeCall(s)}addAbsenceRoster(){const e=new FormData;for(var s of this.element.elements)s.name.startsWith("Adres")&&e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster]"+s.name.replace(/^Adres/,"[Adres]"),s.value);let t=new Date;t.setUTCHours(23),t.setUTCMinutes(0),t.setUTCSeconds(0),t.setUTCMilliseconds(0);let r=t.toISOString().replace(/(\.[0-9]+)?Z?$/,"");return e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster][DatumTijdBegin]",r),e.set("AfwezigheidsRoosterWrapper[DagelijksTerugkerendRooster][DuurInMinuten]",480),e.set("method",window.EnvironmentSettings.api.addAwayScheduleV2),this.executeCall(e)}executeCall(e){return r.a.get(window.EnvironmentSettings.endpoint+Object(n.a)(e),{},!1,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(e=>e.data.success).catch(()=>(Object(o.b)(S,window.messages.validationRequestFailed,k),!1))}showStreetnameBlock(e,s){this.streetNameBlock&&(e?(this.streetNameBlock.textContent=s,this.streetNameBlock.classList.remove(j)):this.streetNameBlock.classList.add(j))}}}});