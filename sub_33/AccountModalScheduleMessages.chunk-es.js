webpackJsonp([9],{248:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t(0),a=t.n(i),o=t(9),r=t(153),d=t(2),n=t(241),u=t(154),h=t(155);const l="[js-hook-customise-times]",m="u-hidden",c="TimeBegin",p="TimeEnd",g="AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][DuurInMinuten]",k="DateBegin",f="DateEnd",T="AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][DatumTijdBegin]",b="AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][DatumEind]",D="AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][Adres][AdresseerbareAdresID]",S="no-end-date",v="time-errors",A=document.querySelector(`[js-hook-form-schedule-messages] [js-hook-${v}]`),j="submit-errors",w=document.querySelector(`[js-hook-form-schedule-messages] [js-hook-${j}]`);const y=(e,s)=>s.diff(e,"minutes");s.default=class AccountModalScheduleMessages extends r.default{get formId(){return"schedule-messages"}constructor(e){super(e),this.action=this.element.getAttribute("action"),this.customiseTimesBlock=this.element.querySelector(l),d.a.$on("modal[modal-schedule-messages]::close",()=>{this.steps.reset(),this.steps.loading=!1}),d.a.$on("form-steps[schedule-messages]::step-change",(e,s)=>{this.checkWeekdayValidity(s)})}onFormChange(e){this.steps&&!this.steps.loading&&this.steps.isValid(),this.checkAddressValidity(),this.checkWeekdayValidity(this.steps.currentStep),"change"===e.eventType&&(this.state.fields["choose-times"].input.checked?(this.customiseTimes(!0),this.setDateTime(),this.state.fields[S].input.checked?this.setNoEndDate(!0):this.setNoEndDate(!1)):(this.customiseTimes(!1),this.setIndefiniteTime()))}onFormSubmit(){this.steps.loading=!0,this.formSubmitTimeout&&clearTimeout(this.formSubmitTimeout),this.formSubmitTimeout=setTimeout(()=>{this.prepareScheduleCall(window.EnvironmentSettings.api.addAwayScheduleV2).then(e=>{Promise.all(e.map(e=>this.changeScheduleCall(e))).then(e=>{this.steps.loading=!1,e.includes(!1)?Object(u.b)(w,window.messages.validationRequestFailed,j):(Object(u.a)(j),d.a.$trigger("form-steps[schedule-messages]::next"))})})},500)}prepareScheduleCall(e){const s=Object.keys(this.inputs).reduce((e,s)=>(-1!==s.indexOf(D)&&this.inputs[s].checked&&e.push(s),e),[]);return new Promise(t=>{t(s.map(t=>{const i=new FormData(this.element);return i.set("method",e),i.delete("choose-times"),i.delete("DateBegin"),i.delete("DateEnd"),i.delete("TimeBegin"),i.delete("TimeEnd"),s.forEach(e=>i.delete(e)),i.set(D,this.inputs[t].value),i}))})}changeScheduleCall(e){return o.a.get(window.EnvironmentSettings.endpoint+Object(h.a)(e),{},!1,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(e=>!!e.data.success).catch(()=>!1)}customiseTimes(e){[...this.customiseTimesBlock.querySelectorAll("input")].forEach(s=>{e?s.removeAttribute("disabled"):s.setAttribute("disabled","")}),e?this.customiseTimesBlock.classList.remove(m):this.customiseTimesBlock.classList.add(m)}setDateTime(){const e=a()(`${this.inputs[k].value} ${this.inputs[c].value}`,"DD-MM-YYYY HH:mm"),s=a()(this.inputs[f].value,"DD-MM-YYYY"),t=a()(this.inputs[c].value,"HH:mm"),i=a()(this.inputs[p].value,"HH:mm"),o=y(t,i);o>0?(Object(u.a)(v),this.inputs[g].value=o,this.inputs[T].value=e.format("YYYY-MM-DDTHH:mm:ss.SSS[Z]"),this.inputs[b].value=s.format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")):Object(u.b)(A,window.messages.validationTimeDifference,v)}setIndefiniteTime(){this.inputs[g].value=1440,this.inputs[T].value=a()().format(),this.inputs[b].value=a()().add(100,"years").format()}setNoEndDate(e){e?(this.inputs[f].setAttribute("disabled",""),this.inputs[b].value=a()().add(100,"years").format()):(this.inputs[f].removeAttribute("disabled"),this.setDateTime())}checkAddressValidity(){Object(n.a)(this.state.fields,"AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][Adres][AdresseerbareAdresID]")||(this.steps.disableStep=!0)}checkWeekdayValidity(e){1!==e||Object(n.a)(this.state.fields,"AfwezigheidsRoosterWrapper[WekelijksTerugkerendRooster][WeekPatroon]")||(this.steps.disableStep=!0)}}}});